import{c as commonjsGlobal,g as getDefaultExportFromCjs,r as reactExports,R as React}from"./index-c52b4654.js";const person1="/assets/person1-59094681.jpg",person2="/assets/person2-1b3188f1.jpg",person3="/assets/person3-b0872c6e.jpg";var AgoraRTC_NProduction={exports:{}};(function(o,e){(function(d,h){o.exports=h()})(commonjsGlobal,function(){function d(r,i){return i.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(l){if(l!=="default"&&!(l in r)){var p=Object.getOwnPropertyDescriptor(s,l);Object.defineProperty(r,l,p.get?p:{enumerable:!0,get:function(){return s[l]}})}})}),Object.freeze(r)}var h=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{},f=function(r){try{return!!r()}catch{return!0}},g=!f(function(){var r=function(){}.bind();return typeof r!="function"||r.hasOwnProperty("prototype")}),A=g,C=Function.prototype,k=C.bind,j=C.call,_t=A&&k.bind(j,j),_n=A?function(r){return r&&_t(r)}:function(r){return r&&function(){return j.apply(r,arguments)}},ue=_n({}.isPrototypeOf),Ei=function(r){return r&&r.Math==Math&&r},_s=Ei(typeof globalThis=="object"&&globalThis)||Ei(typeof window=="object"&&window)||Ei(typeof self=="object"&&self)||Ei(typeof h=="object"&&h)||function(){return this}()||Function("return this")(),_c=g,_u=Function.prototype,_d=_u.apply,_l=_u.call,nE=typeof Reflect=="object"&&Reflect.apply||(_c?_l.bind(_d):function(){return _l.apply(_d,arguments)}),sE=function(r){return typeof r=="function"},vE={},mE=!f(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),yE=g,BE=Function.prototype.call,t_=yE?BE.bind(BE):function(){return BE.apply(BE,arguments)},vf={},fE={}.propertyIsEnumerable,hE=Object.getOwnPropertyDescriptor,bE=hE&&!fE.call({1:2},1);vf.f=bE?function(r){var i=hE(this,r);return!!i&&i.enumerable}:fE;var _h,tE,aE=function(r,i){return{enumerable:!(1&r),configurable:!(2&r),writable:!(4&r),value:i}},TE=_n,OE=TE({}.toString),e_=TE("".slice),NE=function(r){return e_(OE(r),8,-1)},y_=_n,YE=f,H_=NE,FS=_s.Object,gT=y_("".split),CS=YE(function(){return!FS("z").propertyIsEnumerable(0)})?function(r){return H_(r)=="String"?gT(r,""):FS(r)}:FS,K6=_s.TypeError,A0=function(r){if(r==null)throw K6("Can't call method on "+r);return r},H6=CS,Y6=A0,ZS=function(r){return H6(Y6(r))},z6=sE,aS=function(r){return typeof r=="object"?r!==null:z6(r)},tR={},cN=tR,uN=_s,J6=sE,QL=function(r){return J6(r)?r:void 0},wS=function(r,i){return arguments.length<2?QL(cN[r])||QL(uN[r]):cN[r]&&cN[r][i]||uN[r]&&uN[r][i]},OR=wS("navigator","userAgent")||"",$L=_s,dN=OR,ZL=$L.process,t1=$L.Deno,e1=ZL&&ZL.versions||t1&&t1.version,n1=e1&&e1.v8;n1&&(tE=(_h=n1.split("."))[0]>0&&_h[0]<4?1:+(_h[0]+_h[1])),!tE&&dN&&(!(_h=dN.match(/Edge\/(\d+)/))||_h[1]>=74)&&(_h=dN.match(/Chrome\/(\d+)/))&&(tE=+_h[1]);var $R=tE,r1=$R,X6=f,lN=!!Object.getOwnPropertySymbols&&!X6(function(){var r=Symbol();return!String(r)||!(Object(r)instanceof Symbol)||!Symbol.sham&&r1&&r1<41}),i1=lN&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Q6=wS,$6=sE,Z6=ue,tW=i1,eW=_s.Object,hN=tW?function(r){return typeof r=="symbol"}:function(r){var i=Q6("Symbol");return $6(i)&&Z6(i.prototype,eW(r))},nW=_s.String,C0=function(r){try{return nW(r)}catch{return"Object"}},rW=sE,iW=C0,oW=_s.TypeError,BS=function(r){if(rW(r))return r;throw oW(iW(r)+" is not a function")},sW=BS,pN=function(r,i){var s=r[i];return s==null?void 0:sW(s)},fN=t_,EN=sE,_N=aS,aW=_s.TypeError,w0={exports:{}},o1=_s,cW=Object.defineProperty,uW=function(r,i){try{cW(o1,r,{value:i,configurable:!0,writable:!0})}catch{o1[r]=i}return i},s1="__core-js_shared__",mN=_s[s1]||uW(s1,{}),a1=mN;(w0.exports=function(r,i){return a1[r]||(a1[r]=i!==void 0?i:{})})("versions",[]).push({version:"3.20.3",mode:"pure",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.20.3/LICENSE",source:"https://github.com/zloirock/core-js"});var dW=A0,lW=_s.Object,eR=function(r){return lW(dW(r))},hW=eR,pW=_n({}.hasOwnProperty),DT=Object.hasOwn||function(r,i){return pW(hW(r),i)},fW=_n,EW=0,_W=Math.random(),mW=fW(1 .toString),gN=function(r){return"Symbol("+(r===void 0?"":r)+")_"+mW(++EW+_W,36)},gW=_s,vW=w0.exports,c1=DT,yW=gN,u1=lN,d1=i1,GI=vW("wks"),AR=gW.Symbol,l1=AR&&AR.for,bW=d1?AR:AR&&AR.withoutSetter||yW,Lb=function(r){if(!c1(GI,r)||!u1&&typeof GI[r]!="string"){var i="Symbol."+r;u1&&c1(AR,r)?GI[r]=AR[r]:GI[r]=d1&&l1?l1(i):bW(i)}return GI[r]},TW=t_,h1=aS,p1=hN,SW=pN,RW=function(r,i){var s,l;if(i==="string"&&EN(s=r.toString)&&!_N(l=fN(s,r))||EN(s=r.valueOf)&&!_N(l=fN(s,r))||i!=="string"&&EN(s=r.toString)&&!_N(l=fN(s,r)))return l;throw aW("Can't convert object to primitive value")},IW=Lb,OW=_s.TypeError,AW=IW("toPrimitive"),CW=function(r,i){if(!h1(r)||p1(r))return r;var s,l=SW(r,AW);if(l){if(i===void 0&&(i="default"),s=TW(l,r,i),!h1(s)||p1(s))return s;throw OW("Can't convert object to primitive value")}return i===void 0&&(i="number"),RW(r,i)},wW=hN,N0=function(r){var i=CW(r,"string");return wW(i)?i:i+""},f1=aS,vN=_s.document,NW=f1(vN)&&f1(vN.createElement),yN=function(r){return NW?vN.createElement(r):{}},DW=yN,E1=!mE&&!f(function(){return Object.defineProperty(DW("div"),"a",{get:function(){return 7}}).a!=7}),PW=mE,kW=t_,LW=vf,MW=aE,UW=ZS,xW=N0,jW=DT,VW=E1,_1=Object.getOwnPropertyDescriptor;vE.f=PW?_1:function(r,i){if(r=UW(r),i=xW(i),VW)try{return _1(r,i)}catch{}if(jW(r,i))return MW(!kW(LW.f,r,i),r[i])};var FW=f,BW=sE,GW=/#|\.prototype\./,qI=function(r,i){var s=WW[qW(r)];return s==HW||s!=KW&&(BW(i)?FW(i):!!i)},qW=qI.normalize=function(r){return String(r).replace(GW,".").toLowerCase()},WW=qI.data={},KW=qI.NATIVE="N",HW=qI.POLYFILL="P",m1=qI,YW=BS,zW=g,JW=_n(_n.bind),WI=function(r,i){return YW(r),i===void 0?r:zW?JW(r,i):function(){return r.apply(i,arguments)}},gS={},g1=mE&&f(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),v1=_s,XW=aS,QW=v1.String,$W=v1.TypeError,vS=function(r){if(XW(r))return r;throw $W(QW(r)+" is not an object")},ZW=mE,t5=E1,e5=g1,D0=vS,y1=N0,n5=_s.TypeError,bN=Object.defineProperty,r5=Object.getOwnPropertyDescriptor,i5="enumerable",o5="configurable",s5="writable";gS.f=ZW?e5?function(r,i,s){if(D0(r),i=y1(i),D0(s),typeof r=="function"&&i==="prototype"&&"value"in s&&s5 in s&&!s.writable){var l=r5(r,i);l&&l.writable&&(r[i]=s.value,s={configurable:o5 in s?s.configurable:l.configurable,enumerable:i5 in s?s.enumerable:l.enumerable,writable:!1})}return bN(r,i,s)}:bN:function(r,i,s){if(D0(r),i=y1(i),D0(s),t5)try{return bN(r,i,s)}catch{}if("get"in s||"set"in s)throw n5("Accessors not supported");return"value"in s&&(r[i]=s.value),r};var a5=gS,c5=aE,CR=mE?function(r,i,s){return a5.f(r,i,c5(1,s))}:function(r,i,s){return r[i]=s,r},P0=_s,u5=nE,d5=_n,l5=sE,h5=vE.f,p5=m1,ZR=tR,f5=WI,tI=CR,b1=DT,E5=function(r){var i=function(s,l,p){if(this instanceof i){switch(arguments.length){case 0:return new r;case 1:return new r(s);case 2:return new r(s,l)}return new r(s,l,p)}return u5(r,this,arguments)};return i.prototype=r.prototype,i},vT=function(r,i){var s,l,p,_,b,P,x,H,B=r.target,z=r.global,Wt=r.stat,_r=r.proto,Di=z?P0:Wt?P0[B]:(P0[B]||{}).prototype,Fi=z?ZR:ZR[B]||tI(ZR,B,{})[B],Gi=Fi.prototype;for(p in i)s=!p5(z?p:B+(Wt?".":"#")+p,r.forced)&&Di&&b1(Di,p),b=Fi[p],s&&(P=r.noTargetGet?(H=h5(Di,p))&&H.value:Di[p]),_=s&&P?P:i[p],s&&typeof b==typeof _||(x=r.bind&&s?f5(_,P0):r.wrap&&s?E5(_):_r&&l5(_)?d5(_):_,(r.sham||_&&_.sham||b&&b.sham)&&tI(x,"sham",!0),tI(Fi,p,x),_r&&(b1(ZR,l=B+"Prototype")||tI(ZR,l,{}),tI(ZR[l],p,_),r.real&&Gi&&!Gi[p]&&tI(Gi,p,_)))},_5=Math.ceil,m5=Math.floor,TN=function(r){var i=+r;return i!=i||i===0?0:(i>0?m5:_5)(i)},g5=TN,v5=Math.min,y5=function(r){return r>0?v5(g5(r),9007199254740991):0},nR=function(r){return y5(r.length)},b5=BS,T5=eR,S5=CS,R5=nR,I5=_s.TypeError,T1=function(r){return function(i,s,l,p){b5(s);var _=T5(i),b=S5(_),P=R5(_),x=r?P-1:0,H=r?-1:1;if(l<2)for(;;){if(x in b){p=b[x],x+=H;break}if(x+=H,r?x<0:P<=x)throw I5("Reduce of empty array with no initial value")}for(;r?x>=0:P>x;x+=H)x in b&&(p=s(p,b[x],x,_));return p}},O5={left:T1(!1),right:T1(!0)},A5=f,SN=function(r,i){var s=[][r];return!!s&&A5(function(){s.call(null,i||function(){throw 1},1)})},k0=NE(_s.process)=="process",C5=O5.left,S1=$R,w5=k0;vT({target:"Array",proto:!0,forced:!SN("reduce")||!w5&&S1>79&&S1<83},{reduce:function(r){var i=arguments.length;return C5(this,r,i,i>1?arguments[1]:void 0)}});var N5=tR,rR=function(r){return N5[r+"Prototype"]},D5=rR("Array").reduce,P5=ue,k5=D5,RN=Array.prototype,R1=function(r){var i=r.reduce;return r===RN||P5(RN,r)&&i===RN.reduce?k5:i},iR=R1;let I1=!0,O1=!0;function L0(r,i,s){const l=r.match(i);return l&&l.length>=s&&parseInt(l[s],10)}function wR(r,i,s){if(!r.RTCPeerConnection)return;const l=r.RTCPeerConnection.prototype,p=l.addEventListener;l.addEventListener=function(b,P){if(b!==i)return p.apply(this,arguments);const x=H=>{const B=s(H);B&&(P.handleEvent?P.handleEvent(B):P(B))};return this._eventMap=this._eventMap||{},this._eventMap[i]||(this._eventMap[i]=new Map),this._eventMap[i].set(P,x),p.apply(this,[b,x])};const _=l.removeEventListener;l.removeEventListener=function(b,P){if(b!==i||!this._eventMap||!this._eventMap[i])return _.apply(this,arguments);if(!this._eventMap[i].has(P))return _.apply(this,arguments);const x=this._eventMap[i].get(P);return this._eventMap[i].delete(P),this._eventMap[i].size===0&&delete this._eventMap[i],Object.keys(this._eventMap).length===0&&delete this._eventMap,_.apply(this,[b,x])},Object.defineProperty(l,"on"+i,{get(){return this["_on"+i]},set(b){this["_on"+i]&&(this.removeEventListener(i,this["_on"+i]),delete this["_on"+i]),b&&this.addEventListener(i,this["_on"+i]=b)},enumerable:!0,configurable:!0})}function L5(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(I1=r,r?"adapter.js logging disabled":"adapter.js logging enabled")}function M5(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(O1=!r,"adapter.js deprecation warnings "+(r?"disabled":"enabled"))}function A1(){if(typeof window=="object"){if(I1)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function IN(r,i){O1&&console.warn(r+" is deprecated, please use "+i+" instead.")}function U5(r){const i={browser:null,version:null};if(r===void 0||!r.navigator)return i.browser="Not a browser.",i;const{navigator:s}=r;if(s.mozGetUserMedia)i.browser="firefox",i.version=L0(s.userAgent,/Firefox\/(\d+)\./,1);else if(s.webkitGetUserMedia||r.isSecureContext===!1&&r.webkitRTCPeerConnection)i.browser="chrome",i.version=L0(s.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!r.RTCPeerConnection||!s.userAgent.match(/AppleWebKit\/(\d+)\./))return i.browser="Not a supported browser.",i;i.browser="safari",i.version=L0(s.userAgent,/AppleWebKit\/(\d+)\./,1),i.supportsUnifiedPlan=r.RTCRtpTransceiver&&"currentDirection"in r.RTCRtpTransceiver.prototype}return i}function C1(r){return Object.prototype.toString.call(r)==="[object Object]"}function w1(r){var i;return C1(r)?iR(i=Object.keys(r)).call(i,function(s,l){const p=C1(r[l]),_=p?w1(r[l]):r[l],b=p&&!Object.keys(_).length;return _===void 0||b?s:Object.assign(s,{[l]:_})},{}):r}function N1(r,i,s){const l=s?"outbound-rtp":"inbound-rtp",p=new Map;if(i===null)return p;const _=[];return r.forEach(b=>{b.type==="track"&&b.trackIdentifier===i.id&&_.push(b)}),_.forEach(b=>{r.forEach(P=>{P.type===l&&P.trackId===b.id&&function x(H,B,z){B&&!z.has(B.id)&&(z.set(B.id,B),Object.keys(B).forEach(Wt=>{Wt.endsWith("Id")?x(H,H.get(B[Wt]),z):Wt.endsWith("Ids")&&B[Wt].forEach(_r=>{x(H,H.get(_r),z)})}))}(r,P,p)})}),p}var x5=w0.exports,j5=gN,D1=x5("keys"),M0=function(r){return D1[r]||(D1[r]=j5(r))},V5=!f(function(){function r(){}return r.prototype.constructor=null,Object.getPrototypeOf(new r)!==r.prototype}),F5=_s,B5=DT,G5=sE,q5=eR,W5=V5,P1=M0("IE_PROTO"),ON=F5.Object,K5=ON.prototype,AN=W5?ON.getPrototypeOf:function(r){var i=q5(r);if(B5(i,P1))return i[P1];var s=i.constructor;return G5(s)&&i instanceof s?s.prototype:i instanceof ON?K5:null},k1=_s,H5=sE,Y5=k1.String,z5=k1.TypeError,J5=_n,X5=vS,Q5=function(r){if(typeof r=="object"||H5(r))return r;throw z5("Can't set "+Y5(r)+" as a prototype")},$5=Object.setPrototypeOf||("__proto__"in{}?function(){var r,i=!1,s={};try{(r=J5(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(s,[]),i=s instanceof Array}catch{}return function(l,p){return X5(l),Q5(p),i?r(l,p):l.__proto__=p,l}}():void 0),U0={},Z5=TN,tK=Math.max,eK=Math.min,CN=function(r,i){var s=Z5(r);return s<0?tK(s+i,0):eK(s,i)},nK=ZS,rK=CN,iK=nR,L1=function(r){return function(i,s,l){var p,_=nK(i),b=iK(_),P=rK(l,b);if(r&&s!=s){for(;b>P;)if((p=_[P++])!=p)return!0}else for(;b>P;P++)if((r||P in _)&&_[P]===s)return r||P||0;return!r&&-1}},oK={includes:L1(!0),indexOf:L1(!1)},x0={},wN=DT,sK=ZS,aK=oK.indexOf,cK=x0,M1=_n([].push),U1=function(r,i){var s,l=sK(r),p=0,_=[];for(s in l)!wN(cK,s)&&wN(l,s)&&M1(_,s);for(;i.length>p;)wN(l,s=i[p++])&&(~aK(_,s)||M1(_,s));return _},NN=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],uK=U1,dK=NN.concat("length","prototype");U0.f=Object.getOwnPropertyNames||function(r){return uK(r,dK)};var DN={};DN.f=Object.getOwnPropertySymbols;var lK=wS,hK=U0,pK=DN,fK=vS,EK=_n([].concat),_K=lK("Reflect","ownKeys")||function(r){var i=hK.f(fK(r)),s=pK.f;return s?EK(i,s(r)):i},x1=DT,mK=_K,gK=vE,vK=gS,PN={},yK=U1,bK=NN,kN=Object.keys||function(r){return yK(r,bK)},TK=mE,SK=g1,RK=gS,IK=vS,OK=ZS,AK=kN;PN.f=TK&&!SK?Object.defineProperties:function(r,i){IK(r);for(var s,l=OK(i),p=AK(i),_=p.length,b=0;_>b;)RK.f(r,s=p[b++],l[s]);return r};var j0,j1=wS("document","documentElement"),CK=vS,wK=PN,V1=NN,NK=x0,DK=j1,PK=yN,F1=M0("IE_PROTO"),LN=function(){},B1=function(r){return"<script>"+r+"<\/script>"},G1=function(r){r.write(B1("")),r.close();var i=r.parentWindow.Object;return r=null,i},V0=function(){try{j0=new ActiveXObject("htmlfile")}catch{}var r,i;V0=typeof document<"u"?document.domain&&j0?G1(j0):((i=PK("iframe")).style.display="none",DK.appendChild(i),i.src="javascript:",(r=i.contentWindow.document).open(),r.write(B1("document.F=Object")),r.close(),r.F):G1(j0);for(var s=V1.length;s--;)delete V0.prototype[V1[s]];return V0()};NK[F1]=!0;var F0=Object.create||function(r,i){var s;return r!==null?(LN.prototype=CK(r),s=new LN,LN.prototype=null,s[F1]=r):s=V0(),i===void 0?s:wK.f(s,i)},kK=_n("".replace),LK=String(Error("zxcasd").stack),q1=/\n\s*at [^:]*:[^\n]*/,MK=q1.test(LK),UK=aS,xK=CR,eI={},jK=eI,VK=Lb("iterator"),FK=Array.prototype,W1={};W1[Lb("toStringTag")]="z";var MN=String(W1)==="[object z]",BK=_s,GK=MN,qK=sE,B0=NE,WK=Lb("toStringTag"),KK=BK.Object,HK=B0(function(){return arguments}())=="Arguments",oR=GK?B0:function(r){var i,s,l;return r===void 0?"Undefined":r===null?"Null":typeof(s=function(p,_){try{return p[_]}catch{}}(i=KK(r),WK))=="string"?s:HK?B0(i):(l=B0(i))=="Object"&&qK(i.callee)?"Arguments":l},YK=oR,K1=pN,zK=eI,JK=Lb("iterator"),H1=function(r){if(r!=null)return K1(r,JK)||K1(r,"@@iterator")||zK[YK(r)]},XK=t_,QK=BS,$K=vS,ZK=C0,tH=H1,eH=_s.TypeError,nH=t_,Y1=vS,rH=pN,iH=WI,oH=t_,sH=vS,aH=C0,cH=function(r){return r!==void 0&&(jK.Array===r||FK[VK]===r)},uH=nR,z1=ue,dH=function(r,i){var s=arguments.length<2?tH(r):i;if(QK(s))return $K(XK(s,r));throw eH(ZK(r)+" is not iterable")},lH=H1,J1=function(r,i,s){var l,p;Y1(r);try{if(!(l=rH(r,"return"))){if(i==="throw")throw s;return s}l=nH(l,r)}catch(_){p=!0,l=_}if(i==="throw")throw s;if(p)throw l;return Y1(l),s},hH=_s.TypeError,G0=function(r,i){this.stopped=r,this.result=i},X1=G0.prototype,q0=function(r,i,s){var l,p,_,b,P,x,H,B=s&&s.that,z=!(!s||!s.AS_ENTRIES),Wt=!(!s||!s.IS_ITERATOR),_r=!(!s||!s.INTERRUPTED),Di=iH(i,B),Fi=function(_p){return l&&J1(l,"normal",_p),new G0(!0,_p)},Gi=function(_p){return z?(sH(_p),_r?Di(_p[0],_p[1],Fi):Di(_p[0],_p[1])):_r?Di(_p,Fi):Di(_p)};if(Wt)l=r;else{if(!(p=lH(r)))throw hH(aH(r)+" is not iterable");if(cH(p)){for(_=0,b=uH(r);b>_;_++)if((P=Gi(r[_]))&&z1(X1,P))return P;return new G0(!1)}l=dH(r,p)}for(x=l.next;!(H=oH(x,l)).done;){try{P=Gi(H.value)}catch(_p){J1(l,"throw",_p)}if(typeof P=="object"&&P&&z1(X1,P))return P}return new G0(!1)},pH=oR,fH=_s.String,nI=function(r){if(pH(r)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return fH(r)},EH=nI,_H=aE,mH=!f(function(){var r=Error("a");return!("stack"in r)||(Object.defineProperty(r,"stack",_H(1,7)),r.stack!==7)}),gH=vT,vH=_s,yH=ue,bH=AN,W0=$5,TH=function(r,i,s){for(var l=mK(i),p=vK.f,_=gK.f,b=0;b<l.length;b++){var P=l[b];x1(r,P)||s&&x1(s,P)||p(r,P,_(i,P))}},Q1=F0,K0=CR,UN=aE,SH=function(r,i){if(MK&&typeof r=="string")for(;i--;)r=kK(r,q1,"");return r},RH=function(r,i){UK(i)&&"cause"in i&&xK(r,"cause",i.cause)},IH=q0,OH=function(r,i){return r===void 0?arguments.length<2?"":i:EH(r)},AH=mH,CH=Lb("toStringTag"),H0=vH.Error,wH=[].push,KI=function(r,i){var s,l=arguments.length>2?arguments[2]:void 0,p=yH(xN,this);W0?s=W0(new H0,p?bH(this):xN):(s=p?this:Q1(xN),K0(s,CH,"Error")),i!==void 0&&K0(s,"message",OH(i)),AH&&K0(s,"stack",SH(s.stack,1)),RH(s,l);var _=[];return IH(r,wH,{that:_}),K0(s,"errors",_),s};W0?W0(KI,H0):TH(KI,H0,{name:!0});var xN=KI.prototype=Q1(H0.prototype,{constructor:UN(1,KI),message:UN(1,""),name:UN(1,"AggregateError")});gH({global:!0},{AggregateError:KI});var NH=sE,jN=mN,DH=_n(Function.toString);NH(jN.inspectSource)||(jN.inspectSource=function(r){return DH(r)});var Y0,HI,z0,VN=jN.inspectSource,PH=sE,kH=VN,$1=_s.WeakMap,LH=PH($1)&&/native code/.test(kH($1)),Z1=_s,FN=_n,MH=aS,UH=CR,BN=DT,GN=mN,xH=M0,jH=x0,tM="Object already initialized",qN=Z1.TypeError,VH=Z1.WeakMap;if(LH||GN.state){var NR=GN.state||(GN.state=new VH),FH=FN(NR.get),eM=FN(NR.has),BH=FN(NR.set);Y0=function(r,i){if(eM(NR,r))throw new qN(tM);return i.facade=r,BH(NR,r,i),i},HI=function(r){return FH(NR,r)||{}},z0=function(r){return eM(NR,r)}}else{var rI=xH("state");jH[rI]=!0,Y0=function(r,i){if(BN(r,rI))throw new qN(tM);return i.facade=r,UH(r,rI,i),i},HI=function(r){return BN(r,rI)?r[rI]:{}},z0=function(r){return BN(r,rI)}}var DR,nM,rM,J0={set:Y0,get:HI,has:z0,enforce:function(r){return z0(r)?HI(r):Y0(r,{})},getterFor:function(r){return function(i){var s;if(!MH(i)||(s=HI(i)).type!==r)throw qN("Incompatible receiver, "+r+" required");return s}}},WN=mE,GH=DT,iM=Function.prototype,qH=WN&&Object.getOwnPropertyDescriptor,KN=GH(iM,"name"),oM={EXISTS:KN,PROPER:KN&&function(){}.name==="something",CONFIGURABLE:KN&&(!WN||WN&&qH(iM,"name").configurable)},WH=CR,X0=function(r,i,s,l){l&&l.enumerable?r[i]=s:WH(r,i,s)},KH=f,HH=sE,YH=F0,sM=AN,zH=X0,HN=Lb("iterator"),aM=!1;[].keys&&("next"in(rM=[].keys())?(nM=sM(sM(rM)))!==Object.prototype&&(DR=nM):aM=!0);var JH=DR==null||KH(function(){var r={};return DR[HN].call(r)!==r});HH((DR=JH?{}:YH(DR))[HN])||zH(DR,HN,function(){return this});var cM={IteratorPrototype:DR,BUGGY_SAFARI_ITERATORS:aM},XH=oR,QH=MN?{}.toString:function(){return"[object "+XH(this)+"]"},$H=MN,ZH=gS.f,t8=CR,e8=DT,n8=QH,uM=Lb("toStringTag"),YI=function(r,i,s,l){if(r){var p=s?r:r.prototype;e8(p,uM)||ZH(p,uM,{configurable:!0,value:i}),l&&!$H&&t8(p,"toString",n8)}},r8=cM.IteratorPrototype,i8=F0,o8=aE,s8=YI,a8=eI,c8=function(){return this},u8=vT,d8=t_,l8=function(r,i,s,l){var p=i+" Iterator";return r.prototype=i8(r8,{next:o8(+!l,s)}),s8(r,p,!1,!0),a8[p]=c8,r},h8=AN,p8=YI,dM=X0,lM=eI,f8=oM.PROPER,Q0=cM.BUGGY_SAFARI_ITERATORS,YN=Lb("iterator"),hM="keys",$0="values",pM="entries",E8=function(){return this},fM=function(r,i,s,l,p,_,b){l8(s,i,l);var P,x,H,B=function(_p){if(_p===p&&Fi)return Fi;if(!Q0&&_p in _r)return _r[_p];switch(_p){case hM:case $0:case pM:return function(){return new s(this,_p)}}return function(){return new s(this)}},z=i+" Iterator",Wt=!1,_r=r.prototype,Di=_r[YN]||_r["@@iterator"]||p&&_r[p],Fi=!Q0&&Di||B(p),Gi=i=="Array"&&_r.entries||Di;if(Gi&&(P=h8(Gi.call(new r)))!==Object.prototype&&P.next&&(p8(P,z,!0,!0),lM[z]=E8),f8&&p==$0&&Di&&Di.name!==$0&&(Wt=!0,Fi=function(){return d8(Di,this)}),p)if(x={values:B($0),keys:_?Fi:B(hM),entries:B(pM)},b)for(H in x)(Q0||Wt||!(H in _r))&&dM(_r,H,x[H]);else u8({target:i,proto:!0,forced:Q0||Wt},x);return b&&_r[YN]!==Fi&&dM(_r,YN,Fi,{name:p}),lM[i]=Fi,x},_8=ZS,EM=eI,_M=J0;gS.f;var m8=fM,mM="Array Iterator",g8=_M.set,v8=_M.getterFor(mM);m8(Array,"Array",function(r,i){g8(this,{type:mM,target:_8(r),index:0,kind:i})},function(){var r=v8(this),i=r.target,s=r.kind,l=r.index++;return!i||l>=i.length?(r.target=void 0,{value:void 0,done:!0}):s=="keys"?{value:l,done:!1}:s=="values"?{value:i[l],done:!1}:{value:[l,i[l]],done:!1}},"values"),EM.Arguments=EM.Array;var gM=_s.Promise,y8=X0,b8=wS,T8=gS,S8=mE,vM=Lb("species"),R8=ue,I8=_s.TypeError,yM=Lb("iterator"),bM=!1;try{var O8=0,TM={next:function(){return{done:!!O8++}},return:function(){bM=!0}};TM[yM]=function(){return this},Array.from(TM,function(){throw 2})}catch{}var A8=_n,C8=f,SM=sE,w8=oR,N8=VN,RM=function(){},D8=[],IM=wS("Reflect","construct"),zN=/^\s*(?:class|function)\b/,P8=A8(zN.exec),k8=!zN.exec(RM),zI=function(r){if(!SM(r))return!1;try{return IM(RM,D8,r),!0}catch{return!1}},OM=function(r){if(!SM(r))return!1;switch(w8(r)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return k8||!!P8(zN,N8(r))}catch{return!0}};OM.sham=!0;var JI,iI,AM,JN,XN=!IM||C8(function(){var r;return zI(zI.call)||!zI(Object)||!zI(function(){r=!0})||r})?OM:zI,L8=XN,M8=C0,U8=_s.TypeError,CM=vS,x8=function(r){if(L8(r))return r;throw U8(M8(r)+" is not a constructor")},j8=Lb("species"),wM=function(r,i){var s,l=CM(r).constructor;return l===void 0||(s=CM(l)[j8])==null?i:x8(s)},QN=_n([].slice),NM=/(?:ipad|iphone|ipod).*applewebkit/i.test(OR),zT=_s,V8=nE,F8=WI,DM=sE,B8=DT,G8=f,PM=j1,q8=QN,kM=yN,W8=NM,K8=k0,$N=zT.setImmediate,ZN=zT.clearImmediate,H8=zT.process,tD=zT.Dispatch,Y8=zT.Function,LM=zT.MessageChannel,z8=zT.String,sD=0,XI={},J8="onreadystatechange";try{JI=zT.location}catch{}var uD=function(r){if(B8(XI,r)){var i=XI[r];delete XI[r],i()}},ED=function(r){return function(){uD(r)}},MM=function(r){uD(r.data)},UM=function(r){zT.postMessage(z8(r),JI.protocol+"//"+JI.host)};$N&&ZN||($N=function(r){var i=q8(arguments,1);return XI[++sD]=function(){V8(DM(r)?r:Y8(r),void 0,i)},iI(sD),sD},ZN=function(r){delete XI[r]},K8?iI=function(r){H8.nextTick(ED(r))}:tD&&tD.now?iI=function(r){tD.now(ED(r))}:LM&&!W8?(JN=(AM=new LM).port2,AM.port1.onmessage=MM,iI=F8(JN.postMessage,JN)):zT.addEventListener&&DM(zT.postMessage)&&!zT.importScripts&&JI&&JI.protocol!=="file:"&&!G8(UM)?(iI=UM,zT.addEventListener("message",MM,!1)):iI=J8 in kM("script")?function(r){PM.appendChild(kM("script")).onreadystatechange=function(){PM.removeChild(this),uD(r)}}:function(r){setTimeout(ED(r),0)});var QI,PR,$I,oI,_D,vD,yD,xM,jM={set:$N,clear:ZN},X8=_s,Q8=/ipad|iphone|ipod/i.test(OR)&&X8.Pebble!==void 0,$8=/web0s(?!.*chrome)/i.test(OR),kR=_s,VM=WI,Z8=vE.f,TD=jM.set,tY=NM,eY=Q8,nY=$8,SD=k0,FM=kR.MutationObserver||kR.WebKitMutationObserver,BM=kR.document,GM=kR.process,Z0=kR.Promise,qM=Z8(kR,"queueMicrotask"),WM=qM&&qM.value;WM||(QI=function(){var r,i;for(SD&&(r=GM.domain)&&r.exit();PR;){i=PR.fn,PR=PR.next;try{i()}catch(s){throw PR?oI():$I=void 0,s}}$I=void 0,r&&r.enter()},tY||SD||nY||!FM||!BM?!eY&&Z0&&Z0.resolve?((yD=Z0.resolve(void 0)).constructor=Z0,xM=VM(yD.then,yD),oI=function(){xM(QI)}):SD?oI=function(){GM.nextTick(QI)}:(TD=VM(TD,kR),oI=function(){TD(QI)}):(_D=!0,vD=BM.createTextNode(""),new FM(QI).observe(vD,{characterData:!0}),oI=function(){vD.data=_D=!_D}));var rY=WM||function(r){var i={fn:r,next:void 0};$I&&($I.next=i),PR||(PR=i,oI()),$I=i},sI={},KM=BS,iY=function(r){var i,s;this.promise=new r(function(l,p){if(i!==void 0||s!==void 0)throw TypeError("Bad Promise constructor");i=l,s=p}),this.resolve=KM(i),this.reject=KM(s)};sI.f=function(r){return new iY(r)};var oY=vS,sY=aS,aY=sI,HM=function(r,i){if(oY(r),sY(i)&&i.constructor===r)return i;var s=aY.f(r);return(0,s.resolve)(i),s.promise},cY=_s,tO=function(r){try{return{error:!1,value:r()}}catch(i){return{error:!0,value:i}}},YM=function(){this.head=null,this.tail=null};YM.prototype={add:function(r){var i={item:r,next:null};this.head?this.tail.next=i:this.head=i,this.tail=i},get:function(){var r=this.head;if(r)return this.head=r.next,this.tail===r&&(this.tail=null),r.item}};var RD,zM,ID,uY=typeof window=="object",eO=vT,GS=_s,dY=wS,sR=t_,OD=gM,lY=function(r,i,s){for(var l in i)s&&s.unsafe&&r[l]?r[l]=i[l]:y8(r,l,i[l],s);return r},hY=YI,pY=function(r){var i=b8(r),s=T8.f;S8&&i&&!i[vM]&&s(i,vM,{configurable:!0,get:function(){return this}})},AD=BS,nO=sE,fY=aS,EY=function(r,i){if(R8(i,r))return r;throw I8("Incorrect invocation")},_Y=VN,JM=q0,mY=function(r,i){if(!i&&!bM)return!1;var s=!1;try{var l={};l[yM]=function(){return{next:function(){return{done:s=!0}}}},r(l)}catch{}return s},gY=wM,XM=jM.set,CD=rY,vY=HM,yY=function(r,i){var s=cY.console;s&&s.error&&(arguments.length==1?s.error(r):s.error(r,i))},QM=sI,wD=tO,bY=YM,ND=J0,TY=m1,SY=uY,rO=k0,$M=$R,RY=Lb("species"),NS="Promise",ZM=ND.getterFor(NS),IY=ND.set,OY=ND.getterFor(NS),AY=OD&&OD.prototype,DS=OD,iO=AY,tU=GS.TypeError,DD=GS.document,PD=GS.process,aI=QM.f,CY=aI,wY=!!(DD&&DD.createEvent&&GS.dispatchEvent),eU=nO(GS.PromiseRejectionEvent),nU="unhandledrejection",oO=TY(NS,function(){var r=_Y(DS),i=r!==String(DS);if(!i&&$M===66||!iO.finally)return!0;if($M>=51&&/native code/.test(r))return!1;var s=new DS(function(p){p(1)}),l=function(p){p(function(){},function(){})};return(s.constructor={})[RY]=l,!(s.then(function(){})instanceof l)||!i&&SY&&!eU}),NY=oO||!mY(function(r){DS.all(r).catch(function(){})}),rU=function(r){var i;return!(!fY(r)||!nO(i=r.then))&&i},iU=function(r,i){var s,l,p,_=i.value,b=i.state==1,P=b?r.ok:r.fail,x=r.resolve,H=r.reject,B=r.domain;try{P?(b||(i.rejection===2&&PY(i),i.rejection=1),P===!0?s=_:(B&&B.enter(),s=P(_),B&&(B.exit(),p=!0)),s===r.promise?H(tU("Promise-chain cycle")):(l=rU(s))?sR(l,s,x,H):x(s)):H(_)}catch(z){B&&!p&&B.exit(),H(z)}},oU=function(r,i){r.notified||(r.notified=!0,CD(function(){for(var s,l=r.reactions;s=l.get();)iU(s,r);r.notified=!1,i&&!r.rejection&&DY(r)}))},sU=function(r,i,s){var l,p;wY?((l=DD.createEvent("Event")).promise=i,l.reason=s,l.initEvent(r,!1,!0),GS.dispatchEvent(l)):l={promise:i,reason:s},!eU&&(p=GS["on"+r])?p(l):r===nU&&yY("Unhandled promise rejection",s)},DY=function(r){sR(XM,GS,function(){var i,s=r.facade,l=r.value;if(aU(r)&&(i=wD(function(){rO?PD.emit("unhandledRejection",l,s):sU(nU,s,l)}),r.rejection=rO||aU(r)?2:1,i.error))throw i.value})},aU=function(r){return r.rejection!==1&&!r.parent},PY=function(r){sR(XM,GS,function(){var i=r.facade;rO?PD.emit("rejectionHandled",i):sU("rejectionhandled",i,r.value)})},cI=function(r,i,s){return function(l){r(i,l,s)}},uI=function(r,i,s){r.done||(r.done=!0,s&&(r=s),r.value=i,r.state=2,oU(r,!0))},LD=function(r,i,s){if(!r.done){r.done=!0,s&&(r=s);try{if(r.facade===i)throw tU("Promise can't be resolved itself");var l=rU(i);l?CD(function(){var p={done:!1};try{sR(l,i,cI(LD,p,r),cI(uI,p,r))}catch(_){uI(p,_,r)}}):(r.value=i,r.state=1,oU(r,!1))}catch(p){uI({done:!1},p,r)}}};oO&&(iO=(DS=function(r){EY(this,iO),AD(r),sR(RD,this);var i=ZM(this);try{r(cI(LD,i),cI(uI,i))}catch(s){uI(i,s)}}).prototype,(RD=function(r){IY(this,{type:NS,done:!1,notified:!1,parent:!1,reactions:new bY,rejection:!1,state:0,value:void 0})}).prototype=lY(iO,{then:function(r,i){var s=OY(this),l=aI(gY(this,DS));return s.parent=!0,l.ok=!nO(r)||r,l.fail=nO(i)&&i,l.domain=rO?PD.domain:void 0,s.state==0?s.reactions.add(l):CD(function(){iU(l,s)}),l.promise},catch:function(r){return this.then(void 0,r)}}),zM=function(){var r=new RD,i=ZM(r);this.promise=r,this.resolve=cI(LD,i),this.reject=cI(uI,i)},QM.f=aI=function(r){return r===DS||r===ID?new zM(r):CY(r)}),eO({global:!0,wrap:!0,forced:oO},{Promise:DS}),hY(DS,NS,!1,!0),pY(NS),ID=dY(NS),eO({target:NS,stat:!0,forced:oO},{reject:function(r){var i=aI(this);return sR(i.reject,void 0,r),i.promise}}),eO({target:NS,stat:!0,forced:!0},{resolve:function(r){return vY(this===ID?DS:this,r)}}),eO({target:NS,stat:!0,forced:NY},{all:function(r){var i=this,s=aI(i),l=s.resolve,p=s.reject,_=wD(function(){var b=AD(i.resolve),P=[],x=0,H=1;JM(r,function(B){var z=x++,Wt=!1;H++,sR(b,i,B).then(function(_r){Wt||(Wt=!0,P[z]=_r,--H||l(P))},p)}),--H||l(P)});return _.error&&p(_.value),s.promise},race:function(r){var i=this,s=aI(i),l=s.reject,p=wD(function(){var _=AD(i.resolve);JM(r,function(b){sR(_,i,b).then(s.resolve,l)})});return p.error&&l(p.value),s.promise}});var kY=t_,LY=BS,MY=sI,UY=tO,xY=q0;vT({target:"Promise",stat:!0},{allSettled:function(r){var i=this,s=MY.f(i),l=s.resolve,p=s.reject,_=UY(function(){var b=LY(i.resolve),P=[],x=0,H=1;xY(r,function(B){var z=x++,Wt=!1;H++,kY(b,i,B).then(function(_r){Wt||(Wt=!0,P[z]={status:"fulfilled",value:_r},--H||l(P))},function(_r){Wt||(Wt=!0,P[z]={status:"rejected",reason:_r},--H||l(P))})}),--H||l(P)});return _.error&&p(_.value),s.promise}});var jY=BS,VY=wS,FY=t_,BY=sI,GY=tO,qY=q0,cU="No one promise resolved";vT({target:"Promise",stat:!0},{any:function(r){var i=this,s=VY("AggregateError"),l=BY.f(i),p=l.resolve,_=l.reject,b=GY(function(){var P=jY(i.resolve),x=[],H=0,B=1,z=!1;qY(r,function(Wt){var _r=H++,Di=!1;B++,FY(P,i,Wt).then(function(Fi){Di||z||(z=!0,p(Fi))},function(Fi){Di||z||(Di=!0,x[_r]=Fi,--B||_(new s(x,cU)))})}),--B||_(new s(x,cU))});return b.error&&_(b.value),l.promise}});var uU=gM,WY=wS,KY=sE,HY=wM,dU=HM;vT({target:"Promise",proto:!0,real:!0,forced:!!uU&&f(function(){uU.prototype.finally.call({then:function(){}},function(){})})},{finally:function(r){var i=HY(this,WY("Promise")),s=KY(r);return this.then(s?function(l){return dU(i,r()).then(function(){return l})}:r,s?function(l){return dU(i,r()).then(function(){throw l})}:r)}});var MD=_n,YY=TN,zY=nI,JY=A0,XY=MD("".charAt),lU=MD("".charCodeAt),QY=MD("".slice),hU=function(r){return function(i,s){var l,p,_=zY(JY(i)),b=YY(s),P=_.length;return b<0||b>=P?r?"":void 0:(l=lU(_,b))<55296||l>56319||b+1===P||(p=lU(_,b+1))<56320||p>57343?r?XY(_,b):l:r?QY(_,b,b+2):p-56320+(l-55296<<10)+65536}},$Y={codeAt:hU(!1),charAt:hU(!0)}.charAt,ZY=nI,pU=J0,_z=fM,fU="String Iterator",tJ=pU.set,eJ=pU.getterFor(fU);_z(String,"String",function(r){tJ(this,{type:fU,string:ZY(r),index:0})},function(){var r,i=eJ(this),s=i.string,l=i.index;return l>=s.length?{value:void 0,done:!0}:(r=$Y(s,l),i.index+=r.length,{value:r,done:!1})});var nJ=tR.Promise,rJ={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},iJ=_s,oJ=oR,sJ=CR,EU=eI,_U=Lb("toStringTag");for(var UD in rJ){var mU=iJ[UD],xD=mU&&mU.prototype;xD&&oJ(xD)!==_U&&sJ(xD,_U,UD),EU[UD]=EU.Array}var gU=nJ,SE=gU;const vU=A1;function yU(r,i){const s=r&&r.navigator;if(!s.mediaDevices)return;const l=function(b){if(typeof b!="object"||b.mandatory||b.optional)return b;const P={};return Object.keys(b).forEach(x=>{if(x==="require"||x==="advanced"||x==="mediaSource")return;const H=typeof b[x]=="object"?b[x]:{ideal:b[x]};H.exact!==void 0&&typeof H.exact=="number"&&(H.min=H.max=H.exact);const B=function(z,Wt){return z?z+Wt.charAt(0).toUpperCase()+Wt.slice(1):Wt==="deviceId"?"sourceId":Wt};if(H.ideal!==void 0){P.optional=P.optional||[];let z={};typeof H.ideal=="number"?(z[B("min",x)]=H.ideal,P.optional.push(z),z={},z[B("max",x)]=H.ideal,P.optional.push(z)):(z[B("",x)]=H.ideal,P.optional.push(z))}H.exact!==void 0&&typeof H.exact!="number"?(P.mandatory=P.mandatory||{},P.mandatory[B("",x)]=H.exact):["min","max"].forEach(z=>{H[z]!==void 0&&(P.mandatory=P.mandatory||{},P.mandatory[B(z,x)]=H[z])})}),b.advanced&&(P.optional=(P.optional||[]).concat(b.advanced)),P},p=function(b,P){if(i.version>=61)return P(b);if((b=JSON.parse(JSON.stringify(b)))&&typeof b.audio=="object"){const x=function(H,B,z){B in H&&!(z in H)&&(H[z]=H[B],delete H[B])};x((b=JSON.parse(JSON.stringify(b))).audio,"autoGainControl","googAutoGainControl"),x(b.audio,"noiseSuppression","googNoiseSuppression"),b.audio=l(b.audio)}if(b&&typeof b.video=="object"){let x=b.video.facingMode;x=x&&(typeof x=="object"?x:{ideal:x});const H=i.version<66;if(x&&(x.exact==="user"||x.exact==="environment"||x.ideal==="user"||x.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||H)){let B;if(delete b.video.facingMode,x.exact==="environment"||x.ideal==="environment"?B=["back","rear"]:x.exact!=="user"&&x.ideal!=="user"||(B=["front"]),B)return s.mediaDevices.enumerateDevices().then(z=>{let Wt=(z=z.filter(_r=>_r.kind==="videoinput")).find(_r=>B.some(Di=>_r.label.toLowerCase().includes(Di)));return!Wt&&z.length&&B.includes("back")&&(Wt=z[z.length-1]),Wt&&(b.video.deviceId=x.exact?{exact:Wt.deviceId}:{ideal:Wt.deviceId}),b.video=l(b.video),vU("chrome: "+JSON.stringify(b)),P(b)})}b.video=l(b.video)}return vU("chrome: "+JSON.stringify(b)),P(b)},_=function(b){return i.version>=64?b:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[b.name]||b.name,message:b.message,constraint:b.constraint||b.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=function(b,P,x){p(b,H=>{s.webkitGetUserMedia(H,P,B=>{x&&x(_(B))})})}.bind(s),s.mediaDevices.getUserMedia){const b=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(P){return p(P,x=>b(x).then(H=>{if(x.audio&&!H.getAudioTracks().length||x.video&&!H.getVideoTracks().length)throw H.getTracks().forEach(B=>{B.stop()}),new DOMException("","NotFoundError");return H},H=>SE.reject(_(H))))}}}function bU(r){r.MediaStream=r.MediaStream||r.webkitMediaStream}function TU(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("ontrack"in r.RTCPeerConnection.prototype)){Object.defineProperty(r.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const i=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",l=>{let p;p=r.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(b=>b.track&&b.track.id===l.track.id):{track:l.track};const _=new Event("track");_.track=l.track,_.receiver=p,_.transceiver={receiver:p},_.streams=[s.stream],this.dispatchEvent(_)}),s.stream.getTracks().forEach(l=>{let p;p=r.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(b=>b.track&&b.track.id===l.id):{track:l};const _=new Event("track");_.track=l,_.receiver=p,_.transceiver={receiver:p},_.streams=[s.stream],this.dispatchEvent(_)})},this.addEventListener("addstream",this._ontrackpoly)),i.apply(this,arguments)}}else wR(r,"track",i=>(i.transceiver||Object.defineProperty(i,"transceiver",{value:{receiver:i.receiver}}),i))}function SU(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("getSenders"in r.RTCPeerConnection.prototype)&&"createDTMFSender"in r.RTCPeerConnection.prototype){const i=function(p,_){return{track:_,get dtmf(){return this._dtmf===void 0&&(_.kind==="audio"?this._dtmf=p.createDTMFSender(_):this._dtmf=null),this._dtmf},_pc:p}};if(!r.RTCPeerConnection.prototype.getSenders){r.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const p=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(b,P){let x=p.apply(this,arguments);return x||(x=i(this,b),this._senders.push(x)),x};const _=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(b){_.apply(this,arguments);const P=this._senders.indexOf(b);P!==-1&&this._senders.splice(P,1)}}const s=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(p){this._senders=this._senders||[],s.apply(this,[p]),p.getTracks().forEach(_=>{this._senders.push(i(this,_))})};const l=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(p){this._senders=this._senders||[],l.apply(this,[p]),p.getTracks().forEach(_=>{const b=this._senders.find(P=>P.track===_);b&&this._senders.splice(this._senders.indexOf(b),1)})}}else if(typeof r=="object"&&r.RTCPeerConnection&&"getSenders"in r.RTCPeerConnection.prototype&&"createDTMFSender"in r.RTCPeerConnection.prototype&&r.RTCRtpSender&&!("dtmf"in r.RTCRtpSender.prototype)){const i=r.RTCPeerConnection.prototype.getSenders;r.RTCPeerConnection.prototype.getSenders=function(){const s=i.apply(this,[]);return s.forEach(l=>l._pc=this),s},Object.defineProperty(r.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function RU(r){if(!r.RTCPeerConnection)return;const i=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[s,l,p]=arguments;if(arguments.length>0&&typeof s=="function")return i.apply(this,arguments);if(i.length===0&&(arguments.length===0||typeof s!="function"))return i.apply(this,[]);const _=function(P){const x={};return P.result().forEach(H=>{const B={id:H.id,timestamp:H.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[H.type]||H.type};H.names().forEach(z=>{B[z]=H.stat(z)}),x[B.id]=B}),x},b=function(P){return new Map(Object.keys(P).map(x=>[x,P[x]]))};if(arguments.length>=2){const P=function(x){l(b(_(x)))};return i.apply(this,[P,s])}return new SE((P,x)=>{i.apply(this,[function(H){P(b(_(H)))},x])}).then(l,p)}}function IU(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&r.RTCRtpReceiver))return;if(!("getStats"in r.RTCRtpSender.prototype)){const s=r.RTCPeerConnection.prototype.getSenders;s&&(r.RTCPeerConnection.prototype.getSenders=function(){const p=s.apply(this,[]);return p.forEach(_=>_._pc=this),p});const l=r.RTCPeerConnection.prototype.addTrack;l&&(r.RTCPeerConnection.prototype.addTrack=function(){const p=l.apply(this,arguments);return p._pc=this,p}),r.RTCRtpSender.prototype.getStats=function(){const p=this;return this._pc.getStats().then(_=>N1(_,p.track,!0))}}if(!("getStats"in r.RTCRtpReceiver.prototype)){const s=r.RTCPeerConnection.prototype.getReceivers;s&&(r.RTCPeerConnection.prototype.getReceivers=function(){const l=s.apply(this,[]);return l.forEach(p=>p._pc=this),l}),wR(r,"track",l=>(l.receiver._pc=l.srcElement,l)),r.RTCRtpReceiver.prototype.getStats=function(){const l=this;return this._pc.getStats().then(p=>N1(p,l.track,!1))}}if(!("getStats"in r.RTCRtpSender.prototype)||!("getStats"in r.RTCRtpReceiver.prototype))return;const i=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof r.MediaStreamTrack){const s=arguments[0];let l,p,_;return this.getSenders().forEach(b=>{b.track===s&&(l?_=!0:l=b)}),this.getReceivers().forEach(b=>(b.track===s&&(p?_=!0:p=b),b.track===s)),_||l&&p?SE.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):l?l.getStats():p?p.getStats():SE.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}function OU(r){r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(_=>this._shimmedLocalStreams[_][0])};const i=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(_,b){if(!b)return i.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const P=i.apply(this,arguments);return this._shimmedLocalStreams[b.id]?this._shimmedLocalStreams[b.id].indexOf(P)===-1&&this._shimmedLocalStreams[b.id].push(P):this._shimmedLocalStreams[b.id]=[b,P],P};const s=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(_){this._shimmedLocalStreams=this._shimmedLocalStreams||{},_.getTracks().forEach(x=>{if(this.getSenders().find(H=>H.track===x))throw new DOMException("Track already exists.","InvalidAccessError")});const b=this.getSenders();s.apply(this,arguments);const P=this.getSenders().filter(x=>b.indexOf(x)===-1);this._shimmedLocalStreams[_.id]=[_].concat(P)};const l=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(_){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[_.id],l.apply(this,arguments)};const p=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(_){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},_&&Object.keys(this._shimmedLocalStreams).forEach(b=>{const P=this._shimmedLocalStreams[b].indexOf(_);P!==-1&&this._shimmedLocalStreams[b].splice(P,1),this._shimmedLocalStreams[b].length===1&&delete this._shimmedLocalStreams[b]}),p.apply(this,arguments)}}function AU(r,i){if(!r.RTCPeerConnection)return;if(r.RTCPeerConnection.prototype.addTrack&&i.version>=65)return OU(r);const s=r.RTCPeerConnection.prototype.getLocalStreams;r.RTCPeerConnection.prototype.getLocalStreams=function(){const H=s.apply(this);return this._reverseStreams=this._reverseStreams||{},H.map(B=>this._reverseStreams[B.id])};const l=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(H){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},H.getTracks().forEach(B=>{if(this.getSenders().find(z=>z.track===B))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[H.id]){const B=new r.MediaStream(H.getTracks());this._streams[H.id]=B,this._reverseStreams[B.id]=H,H=B}l.apply(this,[H])};const p=r.RTCPeerConnection.prototype.removeStream;function _(H,B){let z=B.sdp;return Object.keys(H._reverseStreams||[]).forEach(Wt=>{const _r=H._reverseStreams[Wt],Di=H._streams[_r.id];z=z.replace(new RegExp(Di.id,"g"),_r.id)}),new RTCSessionDescription({type:B.type,sdp:z})}function b(H,B){let z=B.sdp;return Object.keys(H._reverseStreams||[]).forEach(Wt=>{const _r=H._reverseStreams[Wt],Di=H._streams[_r.id];z=z.replace(new RegExp(_r.id,"g"),Di.id)}),new RTCSessionDescription({type:B.type,sdp:z})}r.RTCPeerConnection.prototype.removeStream=function(H){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.apply(this,[this._streams[H.id]||H]),delete this._reverseStreams[this._streams[H.id]?this._streams[H.id].id:H.id],delete this._streams[H.id]},r.RTCPeerConnection.prototype.addTrack=function(H,B){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const z=[].slice.call(arguments,1);if(z.length!==1||!z[0].getTracks().find(Di=>Di===H))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(Di=>Di.track===H))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const _r=this._streams[B.id];if(_r)_r.addTrack(H),SE.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const Di=new r.MediaStream([H]);this._streams[B.id]=Di,this._reverseStreams[Di.id]=B,this.addStream(Di)}return this.getSenders().find(Di=>Di.track===H)},["createOffer","createAnswer"].forEach(function(H){const B=r.RTCPeerConnection.prototype[H],z={[H](){const Wt=arguments;return arguments.length&&typeof arguments[0]=="function"?B.apply(this,[_r=>{const Di=_(this,_r);Wt[0].apply(null,[Di])},_r=>{Wt[1]&&Wt[1].apply(null,_r)},arguments[2]]):B.apply(this,arguments).then(_r=>_(this,_r))}};r.RTCPeerConnection.prototype[H]=z[H]});const P=r.RTCPeerConnection.prototype.setLocalDescription;r.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=b(this,arguments[0]),P.apply(this,arguments)):P.apply(this,arguments)};const x=Object.getOwnPropertyDescriptor(r.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(r.RTCPeerConnection.prototype,"localDescription",{get(){const H=x.get.apply(this);return H.type===""?H:_(this,H)}}),r.RTCPeerConnection.prototype.removeTrack=function(H){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!H._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(H._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let B;this._streams=this._streams||{},Object.keys(this._streams).forEach(z=>{this._streams[z].getTracks().find(Wt=>H.track===Wt)&&(B=this._streams[z])}),B&&(B.getTracks().length===1?this.removeStream(this._reverseStreams[B.id]):B.removeTrack(H.track),this.dispatchEvent(new Event("negotiationneeded")))}}function VD(r,i){!r.RTCPeerConnection&&r.webkitRTCPeerConnection&&(r.RTCPeerConnection=r.webkitRTCPeerConnection),r.RTCPeerConnection&&i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const l=r.RTCPeerConnection.prototype[s],p={[s](){return arguments[0]=new(s==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};r.RTCPeerConnection.prototype[s]=p[s]})}function CU(r,i){wR(r,"negotiationneeded",s=>{const l=s.target;if(!(i.version<72||l.getConfiguration&&l.getConfiguration().sdpSemantics==="plan-b")||l.signalingState==="stable")return s})}var wU=Object.freeze({__proto__:null,shimMediaStream:bU,shimOnTrack:TU,shimGetSendersWithDtmf:SU,shimGetStats:RU,shimSenderReceiverGetStats:IU,shimAddTrackRemoveTrackWithNative:OU,shimAddTrackRemoveTrack:AU,shimPeerConnection:VD,fixNegotiationNeeded:CU,shimGetUserMedia:yU,shimGetDisplayMedia:function(r,i){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(typeof i=="function"?r.navigator.mediaDevices.getDisplayMedia=function(s){return i(s).then(l=>{const p=s.video&&s.video.width,_=s.video&&s.video.height,b=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:l,maxFrameRate:b||3}},p&&(s.video.mandatory.maxWidth=p),_&&(s.video.mandatory.maxHeight=_),r.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function NU(r,i){const s=r&&r.navigator,l=r&&r.MediaStreamTrack;if(s.getUserMedia=function(p,_,b){IN("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(p).then(_,b)},!(i.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const p=function(b,P,x){P in b&&!(x in b)&&(b[x]=b[P],delete b[P])},_=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(b){return typeof b=="object"&&typeof b.audio=="object"&&(b=JSON.parse(JSON.stringify(b)),p(b.audio,"autoGainControl","mozAutoGainControl"),p(b.audio,"noiseSuppression","mozNoiseSuppression")),_(b)},l&&l.prototype.getSettings){const b=l.prototype.getSettings;l.prototype.getSettings=function(){const P=b.apply(this,arguments);return p(P,"mozAutoGainControl","autoGainControl"),p(P,"mozNoiseSuppression","noiseSuppression"),P}}if(l&&l.prototype.applyConstraints){const b=l.prototype.applyConstraints;l.prototype.applyConstraints=function(P){return this.kind==="audio"&&typeof P=="object"&&(P=JSON.parse(JSON.stringify(P)),p(P,"autoGainControl","mozAutoGainControl"),p(P,"noiseSuppression","mozNoiseSuppression")),b.apply(this,[P])}}}}function DU(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function FD(r,i){if(typeof r!="object"||!r.RTCPeerConnection&&!r.mozRTCPeerConnection)return;!r.RTCPeerConnection&&r.mozRTCPeerConnection&&(r.RTCPeerConnection=r.mozRTCPeerConnection),i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(p){const _=r.RTCPeerConnection.prototype[p],b={[p](){return arguments[0]=new(p==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),_.apply(this,arguments)}};r.RTCPeerConnection.prototype[p]=b[p]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},l=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[p,_,b]=arguments;return l.apply(this,[p||null]).then(P=>{if(i.version<53&&!_)try{P.forEach(x=>{x.type=s[x.type]||x.type})}catch(x){if(x.name!=="TypeError")throw x;P.forEach((H,B)=>{P.set(B,Object.assign({},H,{type:s[H.type]||H.type}))})}return P}).then(_,b)}}function PU(r){if(typeof r!="object"||!r.RTCPeerConnection||!r.RTCRtpSender||r.RTCRtpSender&&"getStats"in r.RTCRtpSender.prototype)return;const i=r.RTCPeerConnection.prototype.getSenders;i&&(r.RTCPeerConnection.prototype.getSenders=function(){const l=i.apply(this,[]);return l.forEach(p=>p._pc=this),l});const s=r.RTCPeerConnection.prototype.addTrack;s&&(r.RTCPeerConnection.prototype.addTrack=function(){const l=s.apply(this,arguments);return l._pc=this,l}),r.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):SE.resolve(new Map)}}function kU(r){if(typeof r!="object"||!r.RTCPeerConnection||!r.RTCRtpSender||r.RTCRtpSender&&"getStats"in r.RTCRtpReceiver.prototype)return;const i=r.RTCPeerConnection.prototype.getReceivers;i&&(r.RTCPeerConnection.prototype.getReceivers=function(){const s=i.apply(this,[]);return s.forEach(l=>l._pc=this),s}),wR(r,"track",s=>(s.receiver._pc=s.srcElement,s)),r.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function LU(r){r.RTCPeerConnection&&!("removeStream"in r.RTCPeerConnection.prototype)&&(r.RTCPeerConnection.prototype.removeStream=function(i){IN("removeStream","removeTrack"),this.getSenders().forEach(s=>{s.track&&i.getTracks().includes(s.track)&&this.removeTrack(s)})})}function MU(r){r.DataChannel&&!r.RTCDataChannel&&(r.RTCDataChannel=r.DataChannel)}function UU(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const i=r.RTCPeerConnection.prototype.addTransceiver;i&&(r.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const l=s.length>0;l&&s.forEach(_=>{if("rid"in _&&!/^[a-z0-9]{0,16}$/i.test(_.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in _&&!(parseFloat(_.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in _&&!(parseFloat(_.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const p=i.apply(this,arguments);if(l){const{sender:_}=p,b=_.getParameters();(!("encodings"in b)||b.encodings.length===1&&Object.keys(b.encodings[0]).length===0)&&(b.encodings=s,_.sendEncodings=s,this.setParametersPromises.push(_.setParameters(b).then(()=>{delete _.sendEncodings}).catch(()=>{delete _.sendEncodings})))}return p})}function xU(r){if(typeof r!="object"||!r.RTCRtpSender)return;const i=r.RTCRtpSender.prototype.getParameters;i&&(r.RTCRtpSender.prototype.getParameters=function(){const s=i.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function jU(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const i=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?SE.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}function VU(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const i=r.RTCPeerConnection.prototype.createAnswer;r.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?SE.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}var FU=Object.freeze({__proto__:null,shimOnTrack:DU,shimPeerConnection:FD,shimSenderGetStats:PU,shimReceiverGetStats:kU,shimRemoveStream:LU,shimRTCDataChannel:MU,shimAddTransceiver:UU,shimGetParameters:xU,shimCreateOffer:jU,shimCreateAnswer:VU,shimGetUserMedia:NU,shimGetDisplayMedia:function(r,i){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(r.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const l=new DOMException("getDisplayMedia without video constraints is undefined");return l.name="NotFoundError",l.code=8,SE.reject(l)}return s.video===!0?s.video={mediaSource:i}:s.video.mediaSource=i,r.navigator.mediaDevices.getUserMedia(s)})}});function BU(r){if(typeof r=="object"&&r.RTCPeerConnection){if("getLocalStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in r.RTCPeerConnection.prototype)){const i=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addStream=function(s){this._localStreams||(this._localStreams=[]),this._localStreams.includes(s)||this._localStreams.push(s),s.getAudioTracks().forEach(l=>i.call(this,l,s)),s.getVideoTracks().forEach(l=>i.call(this,l,s))},r.RTCPeerConnection.prototype.addTrack=function(s){for(var l=arguments.length,p=new Array(l>1?l-1:0),_=1;_<l;_++)p[_-1]=arguments[_];return p&&p.forEach(b=>{this._localStreams?this._localStreams.includes(b)||this._localStreams.push(b):this._localStreams=[b]}),i.apply(this,arguments)}}"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(i);if(s===-1)return;this._localStreams.splice(s,1);const l=i.getTracks();this.getSenders().forEach(p=>{l.includes(p.track)&&this.removeTrack(p)})})}}function GU(r){if(typeof r=="object"&&r.RTCPeerConnection&&("getRemoteStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in r.RTCPeerConnection.prototype))){Object.defineProperty(r.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=l=>{l.streams.forEach(p=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(p))return;this._remoteStreams.push(p);const _=new Event("addstream");_.stream=p,this.dispatchEvent(_)})})}});const i=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(l){l.streams.forEach(p=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(p)>=0)return;s._remoteStreams.push(p);const _=new Event("addstream");_.stream=p,s.dispatchEvent(_)})}),i.apply(s,arguments)}}}function qU(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const i=r.RTCPeerConnection.prototype,s=i.createOffer,l=i.createAnswer,p=i.setLocalDescription,_=i.setRemoteDescription,b=i.addIceCandidate;i.createOffer=function(x,H){const B=arguments.length>=2?arguments[2]:arguments[0],z=s.apply(this,[B]);return H?(z.then(x,H),SE.resolve()):z},i.createAnswer=function(x,H){const B=arguments.length>=2?arguments[2]:arguments[0],z=l.apply(this,[B]);return H?(z.then(x,H),SE.resolve()):z};let P=function(x,H,B){const z=p.apply(this,[x]);return B?(z.then(H,B),SE.resolve()):z};i.setLocalDescription=P,P=function(x,H,B){const z=_.apply(this,[x]);return B?(z.then(H,B),SE.resolve()):z},i.setRemoteDescription=P,P=function(x,H,B){const z=b.apply(this,[x]);return B?(z.then(H,B),SE.resolve()):z},i.addIceCandidate=P}function WU(r){const i=r&&r.navigator;if(i.mediaDevices&&i.mediaDevices.getUserMedia){const s=i.mediaDevices,l=s.getUserMedia.bind(s);i.mediaDevices.getUserMedia=p=>l(KU(p))}!i.getUserMedia&&i.mediaDevices&&i.mediaDevices.getUserMedia&&(i.getUserMedia=function(s,l,p){i.mediaDevices.getUserMedia(s).then(l,p)}.bind(i))}function KU(r){return r&&r.video!==void 0?Object.assign({},r,{video:w1(r.video)}):r}function HU(r){if(!r.RTCPeerConnection)return;const i=r.RTCPeerConnection;r.RTCPeerConnection=function(s,l){if(s&&s.iceServers){const p=[];for(let _=0;_<s.iceServers.length;_++){let b=s.iceServers[_];!b.hasOwnProperty("urls")&&b.hasOwnProperty("url")?(IN("RTCIceServer.url","RTCIceServer.urls"),b=JSON.parse(JSON.stringify(b)),b.urls=b.url,delete b.url,p.push(b)):p.push(s.iceServers[_])}s.iceServers=p}return new i(s,l)},r.RTCPeerConnection.prototype=i.prototype,"generateCertificate"in i&&Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get:()=>i.generateCertificate})}function YU(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function zU(r){const i=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const l=this.getTransceivers().find(_=>_.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&l?l.direction==="sendrecv"?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":l.direction==="recvonly"&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):s.offerToReceiveAudio!==!0||l||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const p=this.getTransceivers().find(_=>_.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&p?p.direction==="sendrecv"?p.setDirection?p.setDirection("sendonly"):p.direction="sendonly":p.direction==="recvonly"&&(p.setDirection?p.setDirection("inactive"):p.direction="inactive"):s.offerToReceiveVideo!==!0||p||this.addTransceiver("video",{direction:"recvonly"})}return i.apply(this,arguments)}}function JU(r){typeof r!="object"||r.AudioContext||(r.AudioContext=r.webkitAudioContext)}var XU=Object.freeze({__proto__:null,shimLocalStreamsAPI:BU,shimRemoteStreamsAPI:GU,shimCallbacksAPI:qU,shimGetUserMedia:WU,shimConstraints:KU,shimRTCIceServerUrls:HU,shimTrackEventTransceiver:YU,shimCreateOfferLegacy:zU,shimAudioContext:JU}),aJ=`	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF`,cJ=A0,uJ=nI,QU=_n("".replace),sO=`[	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF]`,dJ=RegExp("^"+sO+sO+"*"),lJ=RegExp(sO+sO+"*$"),BD=function(r){return function(i){var s=uJ(cJ(i));return 1&r&&(s=QU(s,dJ,"")),2&r&&(s=QU(s,lJ,"")),s}},hJ={start:BD(1),end:BD(2),trim:BD(3)},pJ=oM.PROPER,fJ=f,$U=aJ,EJ=hJ.trim;vT({target:"String",proto:!0,forced:function(r){return fJ(function(){return!!$U[r]()||"âÂá "[r]()!=="âÂá "||pJ&&$U[r].name!==r})}("trim")},{trim:function(){return EJ(this)}});var _J=rR("String").trim,mJ=ue,gJ=_J,GD=String.prototype,qS=function(r){var i=r.trim;return typeof r=="string"||r===GD||mJ(GD,r)&&i===GD.trim?gJ:i},WD={exports:{}};(function(r){const i={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};i.localCName=i.generateIdentifier(),i.splitLines=function(s){return qS(s).call(s).split(`
`).map(l=>qS(l).call(l))},i.splitSections=function(s){return s.split(`
m=`).map((l,p)=>{var _;return qS(_=p>0?"m="+l:l).call(_)+`\r
`})},i.getDescription=function(s){const l=i.splitSections(s);return l&&l[0]},i.getMediaSections=function(s){const l=i.splitSections(s);return l.shift(),l},i.matchPrefix=function(s,l){return i.splitLines(s).filter(p=>p.indexOf(l)===0)},i.parseCandidate=function(s){let l;l=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const p={foundation:l[0],component:{1:"rtp",2:"rtcp"}[l[1]]||l[1],protocol:l[2].toLowerCase(),priority:parseInt(l[3],10),ip:l[4],address:l[4],port:parseInt(l[5],10),type:l[7]};for(let _=8;_<l.length;_+=2)switch(l[_]){case"raddr":p.relatedAddress=l[_+1];break;case"rport":p.relatedPort=parseInt(l[_+1],10);break;case"tcptype":p.tcpType=l[_+1];break;case"ufrag":p.ufrag=l[_+1],p.usernameFragment=l[_+1];break;default:p[l[_]]===void 0&&(p[l[_]]=l[_+1])}return p},i.writeCandidate=function(s){const l=[];l.push(s.foundation);const p=s.component;p==="rtp"?l.push(1):p==="rtcp"?l.push(2):l.push(p),l.push(s.protocol.toUpperCase()),l.push(s.priority),l.push(s.address||s.ip),l.push(s.port);const _=s.type;return l.push("typ"),l.push(_),_!=="host"&&s.relatedAddress&&s.relatedPort&&(l.push("raddr"),l.push(s.relatedAddress),l.push("rport"),l.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(l.push("tcptype"),l.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(l.push("ufrag"),l.push(s.usernameFragment||s.ufrag)),"candidate:"+l.join(" ")},i.parseIceOptions=function(s){return s.substr(14).split(" ")},i.parseRtpMap=function(s){let l=s.substr(9).split(" ");const p={payloadType:parseInt(l.shift(),10)};return l=l[0].split("/"),p.name=l[0],p.clockRate=parseInt(l[1],10),p.channels=l.length===3?parseInt(l[2],10):1,p.numChannels=p.channels,p},i.writeRtpMap=function(s){let l=s.payloadType;s.preferredPayloadType!==void 0&&(l=s.preferredPayloadType);const p=s.channels||s.numChannels||1;return"a=rtpmap:"+l+" "+s.name+"/"+s.clockRate+(p!==1?"/"+p:"")+`\r
`},i.parseExtmap=function(s){const l=s.substr(9).split(" ");return{id:parseInt(l[0],10),direction:l[0].indexOf("/")>0?l[0].split("/")[1]:"sendrecv",uri:l[1]}},i.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+`\r
`},i.parseFmtp=function(s){const l={};let p;const _=s.substr(s.indexOf(" ")+1).split(";");for(let x=0;x<_.length;x++){var b,P;p=qS(b=_[x]).call(b).split("="),l[qS(P=p[0]).call(P)]=p[1]}return l},i.writeFmtp=function(s){let l="",p=s.payloadType;if(s.preferredPayloadType!==void 0&&(p=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const _=[];Object.keys(s.parameters).forEach(b=>{s.parameters[b]!==void 0?_.push(b+"="+s.parameters[b]):_.push(b)}),l+="a=fmtp:"+p+" "+_.join(";")+`\r
`}return l},i.parseRtcpFb=function(s){const l=s.substr(s.indexOf(" ")+1).split(" ");return{type:l.shift(),parameter:l.join(" ")}},i.writeRtcpFb=function(s){let l="",p=s.payloadType;return s.preferredPayloadType!==void 0&&(p=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(_=>{l+="a=rtcp-fb:"+p+" "+_.type+(_.parameter&&_.parameter.length?" "+_.parameter:"")+`\r
`}),l},i.parseSsrcMedia=function(s){const l=s.indexOf(" "),p={ssrc:parseInt(s.substr(7,l-7),10)},_=s.indexOf(":",l);return _>-1?(p.attribute=s.substr(l+1,_-l-1),p.value=s.substr(_+1)):p.attribute=s.substr(l+1),p},i.parseSsrcGroup=function(s){const l=s.substr(13).split(" ");return{semantics:l.shift(),ssrcs:l.map(p=>parseInt(p,10))}},i.getMid=function(s){const l=i.matchPrefix(s,"a=mid:")[0];if(l)return l.substr(6)},i.parseFingerprint=function(s){const l=s.substr(14).split(" ");return{algorithm:l[0].toLowerCase(),value:l[1].toUpperCase()}},i.getDtlsParameters=function(s,l){return{role:"auto",fingerprints:i.matchPrefix(s+l,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(s,l){let p="a=setup:"+l+`\r
`;return s.fingerprints.forEach(_=>{p+="a=fingerprint:"+_.algorithm+" "+_.value+`\r
`}),p},i.parseCryptoLine=function(s){const l=s.substr(9).split(" ");return{tag:parseInt(l[0],10),cryptoSuite:l[1],keyParams:l[2],sessionParams:l.slice(3)}},i.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?i.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},i.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const l=s.substr(7).split("|");return{keyMethod:"inline",keySalt:l[0],lifeTime:l[1],mkiValue:l[2]?l[2].split(":")[0]:void 0,mkiLength:l[2]?l[2].split(":")[1]:void 0}},i.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},i.getCryptoParameters=function(s,l){return i.matchPrefix(s+l,"a=crypto:").map(i.parseCryptoLine)},i.getIceParameters=function(s,l){const p=i.matchPrefix(s+l,"a=ice-ufrag:")[0],_=i.matchPrefix(s+l,"a=ice-pwd:")[0];return p&&_?{usernameFragment:p.substr(12),password:_.substr(10)}:null},i.writeIceParameters=function(s){let l="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(l+=`a=ice-lite\r
`),l},i.parseRtpParameters=function(s){const l={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},p=i.splitLines(s)[0].split(" ");for(let _=3;_<p.length;_++){const b=p[_],P=i.matchPrefix(s,"a=rtpmap:"+b+" ")[0];if(P){const x=i.parseRtpMap(P),H=i.matchPrefix(s,"a=fmtp:"+b+" ");switch(x.parameters=H.length?i.parseFmtp(H[0]):{},x.rtcpFeedback=i.matchPrefix(s,"a=rtcp-fb:"+b+" ").map(i.parseRtcpFb),l.codecs.push(x),x.name.toUpperCase()){case"RED":case"ULPFEC":l.fecMechanisms.push(x.name.toUpperCase())}}}return i.matchPrefix(s,"a=extmap:").forEach(_=>{l.headerExtensions.push(i.parseExtmap(_))}),l},i.writeRtpDescription=function(s,l){let p="";p+="m="+s+" ",p+=l.codecs.length>0?"9":"0",p+=" UDP/TLS/RTP/SAVPF ",p+=l.codecs.map(b=>b.preferredPayloadType!==void 0?b.preferredPayloadType:b.payloadType).join(" ")+`\r
`,p+=`c=IN IP4 0.0.0.0\r
`,p+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,l.codecs.forEach(b=>{p+=i.writeRtpMap(b),p+=i.writeFmtp(b),p+=i.writeRtcpFb(b)});let _=0;return l.codecs.forEach(b=>{b.maxptime>_&&(_=b.maxptime)}),_>0&&(p+="a=maxptime:"+_+`\r
`),l.headerExtensions&&l.headerExtensions.forEach(b=>{p+=i.writeExtmap(b)}),p},i.parseRtpEncodingParameters=function(s){const l=[],p=i.parseRtpParameters(s),_=p.fecMechanisms.indexOf("RED")!==-1,b=p.fecMechanisms.indexOf("ULPFEC")!==-1,P=i.matchPrefix(s,"a=ssrc:").map(Wt=>i.parseSsrcMedia(Wt)).filter(Wt=>Wt.attribute==="cname"),x=P.length>0&&P[0].ssrc;let H;const B=i.matchPrefix(s,"a=ssrc-group:FID").map(Wt=>Wt.substr(17).split(" ").map(_r=>parseInt(_r,10)));B.length>0&&B[0].length>1&&B[0][0]===x&&(H=B[0][1]),p.codecs.forEach(Wt=>{if(Wt.name.toUpperCase()==="RTX"&&Wt.parameters.apt){let _r={ssrc:x,codecPayloadType:parseInt(Wt.parameters.apt,10)};x&&H&&(_r.rtx={ssrc:H}),l.push(_r),_&&(_r=JSON.parse(JSON.stringify(_r)),_r.fec={ssrc:x,mechanism:b?"red+ulpfec":"red"},l.push(_r))}}),l.length===0&&x&&l.push({ssrc:x});let z=i.matchPrefix(s,"b=");return z.length&&(z=z[0].indexOf("b=TIAS:")===0?parseInt(z[0].substr(7),10):z[0].indexOf("b=AS:")===0?1e3*parseInt(z[0].substr(5),10)*.95-16e3:void 0,l.forEach(Wt=>{Wt.maxBitrate=z})),l},i.parseRtcpParameters=function(s){const l={},p=i.matchPrefix(s,"a=ssrc:").map(P=>i.parseSsrcMedia(P)).filter(P=>P.attribute==="cname")[0];p&&(l.cname=p.value,l.ssrc=p.ssrc);const _=i.matchPrefix(s,"a=rtcp-rsize");l.reducedSize=_.length>0,l.compound=_.length===0;const b=i.matchPrefix(s,"a=rtcp-mux");return l.mux=b.length>0,l},i.writeRtcpParameters=function(s){let l="";return s.reducedSize&&(l+=`a=rtcp-rsize\r
`),s.mux&&(l+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(l+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),l},i.parseMsid=function(s){let l;const p=i.matchPrefix(s,"a=msid:");if(p.length===1)return l=p[0].substr(7).split(" "),{stream:l[0],track:l[1]};const _=i.matchPrefix(s,"a=ssrc:").map(b=>i.parseSsrcMedia(b)).filter(b=>b.attribute==="msid");return _.length>0?(l=_[0].value.split(" "),{stream:l[0],track:l[1]}):void 0},i.parseSctpDescription=function(s){const l=i.parseMLine(s),p=i.matchPrefix(s,"a=max-message-size:");let _;p.length>0&&(_=parseInt(p[0].substr(19),10)),isNaN(_)&&(_=65536);const b=i.matchPrefix(s,"a=sctp-port:");if(b.length>0)return{port:parseInt(b[0].substr(12),10),protocol:l.fmt,maxMessageSize:_};const P=i.matchPrefix(s,"a=sctpmap:");if(P.length>0){const x=P[0].substr(10).split(" ");return{port:parseInt(x[0],10),protocol:x[1],maxMessageSize:_}}},i.writeSctpDescription=function(s,l){let p=[];return p=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+l.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+l.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+l.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+l.port+" "+l.protocol+` 65535\r
`],l.maxMessageSize!==void 0&&p.push("a=max-message-size:"+l.maxMessageSize+`\r
`),p.join("")},i.generateSessionId=function(){return Math.random().toString().substr(2,21)},i.writeSessionBoilerplate=function(s,l,p){let _;const b=l!==void 0?l:2;return _=s||i.generateSessionId(),`v=0\r
o=`+(p||"thisisadapterortc")+" "+_+" "+b+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},i.getDirection=function(s,l){const p=i.splitLines(s);for(let _=0;_<p.length;_++)switch(p[_]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return p[_].substr(2)}return l?i.getDirection(l):"sendrecv"},i.getKind=function(s){return i.splitLines(s)[0].split(" ")[0].substr(2)},i.isRejected=function(s){return s.split(" ",2)[1]==="0"},i.parseMLine=function(s){const l=i.splitLines(s)[0].substr(2).split(" ");return{kind:l[0],port:parseInt(l[1],10),protocol:l[2],fmt:l.slice(3).join(" ")}},i.parseOLine=function(s){const l=i.matchPrefix(s,"o=")[0].substr(2).split(" ");return{username:l[0],sessionId:l[1],sessionVersion:parseInt(l[2],10),netType:l[3],addressType:l[4],address:l[5]}},i.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const l=i.splitLines(s);for(let p=0;p<l.length;p++)if(l[p].length<2||l[p].charAt(1)!=="=")return!1;return!0},r.exports=i})(WD);var dI=WD.exports,vJ=Object.freeze(d({__proto__:null,default:dI},[WD.exports]));function aO(r){if(!r.RTCIceCandidate||r.RTCIceCandidate&&"foundation"in r.RTCIceCandidate.prototype)return;const i=r.RTCIceCandidate;r.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const l=new i(s),p=dI.parseCandidate(s.candidate),_=Object.assign(l,p);return _.toJSON=function(){return{candidate:_.candidate,sdpMid:_.sdpMid,sdpMLineIndex:_.sdpMLineIndex,usernameFragment:_.usernameFragment}},_}return new i(s)},r.RTCIceCandidate.prototype=i.prototype,wR(r,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new r.RTCIceCandidate(s.candidate),writable:"false"}),s))}function KD(r){!r.RTCIceCandidate||r.RTCIceCandidate&&"relayProtocol"in r.RTCIceCandidate.prototype||wR(r,"icecandidate",i=>{if(i.candidate){const s=dI.parseCandidate(i.candidate.candidate);s.type==="relay"&&(i.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return i})}function cO(r,i){if(!r.RTCPeerConnection)return;"sctp"in r.RTCPeerConnection.prototype||Object.defineProperty(r.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(P){if(!P||!P.sdp)return!1;const x=dI.splitSections(P.sdp);return x.shift(),x.some(H=>{const B=dI.parseMLine(H);return B&&B.kind==="application"&&B.protocol.indexOf("SCTP")!==-1})},l=function(P){const x=P.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(x===null||x.length<2)return-1;const H=parseInt(x[1],10);return H!=H?-1:H},p=function(P){let x=65536;return i.browser==="firefox"&&(x=i.version<57?P===-1?16384:2147483637:i.version<60?i.version===57?65535:65536:2147483637),x},_=function(P,x){let H=65536;i.browser==="firefox"&&i.version===57&&(H=65535);const B=dI.matchPrefix(P.sdp,"a=max-message-size:");return B.length>0?H=parseInt(B[0].substr(19),10):i.browser==="firefox"&&x!==-1&&(H=2147483637),H},b=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,i.browser==="chrome"&&i.version>=76){const{sdpSemantics:P}=this.getConfiguration();P==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const P=l(arguments[0]),x=p(P),H=_(arguments[0],P);let B;B=x===0&&H===0?Number.POSITIVE_INFINITY:x===0||H===0?Math.max(x,H):Math.min(x,H);const z={};Object.defineProperty(z,"maxMessageSize",{get:()=>B}),this._sctp=z}return b.apply(this,arguments)}}function uO(r){if(!r.RTCPeerConnection||!("createDataChannel"in r.RTCPeerConnection.prototype))return;function i(l,p){const _=l.send;l.send=function(){const b=arguments[0],P=b.length||b.size||b.byteLength;if(l.readyState==="open"&&p.sctp&&P>p.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+p.sctp.maxMessageSize+" bytes)");return _.apply(l,arguments)}}const s=r.RTCPeerConnection.prototype.createDataChannel;r.RTCPeerConnection.prototype.createDataChannel=function(){const l=s.apply(this,arguments);return i(l,this),l},wR(r,"datachannel",l=>(i(l.channel,l.target),l))}function HD(r){if(!r.RTCPeerConnection||"connectionState"in r.RTCPeerConnection.prototype)return;const i=r.RTCPeerConnection.prototype;Object.defineProperty(i,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(i,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const l=i[s];i[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=p=>{const _=p.target;if(_._lastConnectionState!==_.connectionState){_._lastConnectionState=_.connectionState;const b=new Event("connectionstatechange",p);_.dispatchEvent(b)}return p},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),l.apply(this,arguments)}})}function YD(r,i){if(!r.RTCPeerConnection||i.browser==="chrome"&&i.version>=71||i.browser==="safari"&&i.version>=605)return;const s=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(l){if(l&&l.sdp&&l.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const p=l.sdp.split(`
`).filter(_=>qS(_).call(_)!=="a=extmap-allow-mixed").join(`
`);r.RTCSessionDescription&&l instanceof r.RTCSessionDescription?arguments[0]=new r.RTCSessionDescription({type:l.type,sdp:p}):l.sdp=p}return s.apply(this,arguments)}}function dO(r,i){if(!r.RTCPeerConnection||!r.RTCPeerConnection.prototype)return;const s=r.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(i.browser==="chrome"&&i.version<78||i.browser==="firefox"&&i.version<68||i.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?SE.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),SE.resolve())})}function lO(r,i){if(!r.RTCPeerConnection||!r.RTCPeerConnection.prototype)return;const s=r.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(r.RTCPeerConnection.prototype.setLocalDescription=function(){let l=arguments[0]||{};if(typeof l!="object"||l.type&&l.sdp)return s.apply(this,arguments);if(l={type:l.type,sdp:l.sdp},!l.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":l.type="offer";break;default:l.type="answer"}return l.sdp||l.type!=="offer"&&l.type!=="answer"?s.apply(this,[l]):(l.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(_=>s.apply(this,[_]))})}var yJ=Object.freeze({__proto__:null,shimRTCIceCandidate:aO,shimRTCIceCandidateRelayProtocol:KD,shimMaxMessageSize:cO,shimSendThrowTypeError:uO,shimConnectionState:HD,removeExtmapAllowMixed:YD,shimAddIceCandidateNullOrEmpty:dO,shimParameterlessSetLocalDescription:lO});let Mb,u_;(function(){let{window:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=A1,l=U5(r),p={browserDetails:l,commonShim:yJ,extractVersion:L0,disableLog:L5,disableWarnings:M5,sdp:vJ};switch(l.browser){case"chrome":if(!wU||!VD||!i.shimChrome)return s("Chrome shim is not included in this adapter release."),p;if(l.version===null)return s("Chrome shim can not determine version, not shimming."),p;s("adapter.js shimming chrome."),p.browserShim=wU,dO(r,l),lO(r),yU(r,l),bU(r),VD(r,l),TU(r),AU(r,l),SU(r),RU(r),IU(r),CU(r,l),aO(r),KD(r),HD(r),cO(r,l),uO(r),YD(r,l);break;case"firefox":if(!FU||!FD||!i.shimFirefox)return s("Firefox shim is not included in this adapter release."),p;s("adapter.js shimming firefox."),p.browserShim=FU,dO(r,l),lO(r),NU(r,l),FD(r,l),DU(r),LU(r),PU(r),kU(r),MU(r),UU(r),xU(r),jU(r),VU(r),aO(r),HD(r),cO(r,l),uO(r);break;case"safari":if(!XU||!i.shimSafari)return s("Safari shim is not included in this adapter release."),p;s("adapter.js shimming safari."),p.browserShim=XU,dO(r,l),lO(r),HU(r),zU(r),qU(r),BU(r),GU(r),YU(r),WU(r),JU(r),aO(r),KD(r),cO(r,l),uO(r),YD(r,l);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),function(r){r.WIN_10="Windows 10",r.WIN_81="Windows 8.1",r.WIN_8="Windows 8",r.WIN_7="Windows 7",r.WIN_VISTA="Windows Vista",r.WIN_SERVER_2003="Windows Server 2003",r.WIN_XP="Windows XP",r.WIN_2000="Windows 2000",r.ANDROID="Android",r.HARMONY_OS="HarmonyOS",r.OPEN_BSD="Open BSD",r.SUN_OS="Sun OS",r.LINUX="Linux",r.IOS="iOS",r.MAC_OS="Mac OS",r.QNX="QNX",r.UNIX="UNIX",r.BEOS="BeOS",r.OS_2="OS/2",r.SEARCH_BOT="Search Bot"}(Mb||(Mb={})),function(r){r.CHROME="Chrome",r.SAFARI="Safari",r.EDGE="Edge",r.FIREFOX="Firefox",r.OPERA="OPR",r.QQ="QQBrowser",r.WECHAT="MicroMessenger"}(u_||(u_={}));var zD={exports:{}};(function(r,i){(function(s,l){var p="function",_="undefined",b="object",P="string",x="major",H="model",B="name",z="type",Wt="vendor",_r="version",Di="architecture",Fi="console",Gi="mobile",_p="tablet",_f="smarttv",cE="wearable",RE="embedded",dE="Amazon",lE="Apple",oE="ASUS",EE="BlackBerry",r_="Firefox",DE="Google",g_="Huawei",l_="LG",x_="Microsoft",_y="Motorola",L_="Opera",wT="Samsung",eE="Sharp",uE="Sony",gE="Xiaomi",UE="Zebra",$E="Facebook",pE="Chromium OS",Vt="Mac OS",_o=function(D_){for(var K_={},E_=0;E_<D_.length;E_++)K_[D_[E_].toUpperCase()]=D_[E_];return K_},ga=function(D_,K_){return typeof D_===P&&rE(K_).indexOf(rE(D_))!==-1},rE=function(D_){return D_.toLowerCase()},jE=function(D_,K_){if(typeof D_===P)return D_=D_.replace(/^\s\s*/,""),typeof K_===_?D_:D_.substring(0,350)},v_=function(D_,K_){for(var E_,ST,VS,P_,QE,NT,IR=0;IR<K_.length&&!QE;){var AS=K_[IR],q6=K_[IR+1];for(E_=ST=0;E_<AS.length&&!QE&&AS[E_];)if(QE=AS[E_++].exec(D_))for(VS=0;VS<q6.length;VS++)NT=QE[++ST],typeof(P_=q6[VS])===b&&P_.length>0?P_.length===2?typeof P_[1]==p?this[P_[0]]=P_[1].call(this,NT):this[P_[0]]=P_[1]:P_.length===3?typeof P_[1]!==p||P_[1].exec&&P_[1].test?this[P_[0]]=NT?NT.replace(P_[1],P_[2]):l:this[P_[0]]=NT?P_[1].call(this,NT,P_[2]):l:P_.length===4&&(this[P_[0]]=NT?P_[3].call(this,NT.replace(P_[1],P_[2])):l):this[P_]=NT||l;IR+=2}},_b=function(D_,K_){for(var E_ in K_)if(typeof K_[E_]===b&&K_[E_].length>0){for(var ST=0;ST<K_[E_].length;ST++)if(ga(K_[E_][ST],D_))return E_==="?"?l:E_}else if(ga(K_[E_],D_))return E_==="?"?l:E_;return D_},mS={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},SR={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[_r,[B,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[_r,[B,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[B,_r],[/opios[\/ ]+([\w\.]+)/i],[_r,[B,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[_r,[B,L_]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[B,_r],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[_r,[B,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[_r,[B,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[_r,[B,"WeChat"]],[/konqueror\/([\w\.]+)/i],[_r,[B,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[_r,[B,"IE"]],[/yabrowser\/([\w\.]+)/i],[_r,[B,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[B,/(.+)/,"$1 Secure Browser"],_r],[/\bfocus\/([\w\.]+)/i],[_r,[B,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[_r,[B,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[_r,[B,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[_r,[B,"Dolphin"]],[/coast\/([\w\.]+)/i],[_r,[B,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[_r,[B,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[_r,[B,r_]],[/\bqihu|(qi?ho?o?|360)browser/i],[[B,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[B,/(.+)/,"$1 Browser"],_r],[/(comodo_dragon)\/([\w\.]+)/i],[[B,/_/g," "],_r],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[B,_r],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[B],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[B,$E],_r],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[B,_r],[/\bgsa\/([\w\.]+) .*safari\//i],[_r,[B,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[_r,[B,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[B,"Chrome WebView"],_r],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[_r,[B,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[B,_r],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[_r,[B,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[_r,B],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[B,[_r,_b,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[B,_r],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[B,"Netscape"],_r],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[_r,[B,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[B,_r],[/(cobalt)\/([\w\.]+)/i],[B,[_r,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[Di,"amd64"]],[/(ia32(?=;))/i],[[Di,rE]],[/((?:i[346]|x)86)[;\)]/i],[[Di,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[Di,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[Di,"armhf"]],[/windows (ce|mobile); ppc;/i],[[Di,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[Di,/ower/,"",rE]],[/(sun4\w)[;\)]/i],[[Di,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[Di,rE]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[H,[Wt,wT],[z,_p]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[H,[Wt,wT],[z,Gi]],[/\((ip(?:hone|od)[\w ]*);/i],[H,[Wt,lE],[z,Gi]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[H,[Wt,lE],[z,_p]],[/(macintosh);/i],[H,[Wt,lE]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[H,[Wt,eE],[z,Gi]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[H,[Wt,g_],[z,_p]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[H,[Wt,g_],[z,Gi]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[H,/_/g," "],[Wt,gE],[z,Gi]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[H,/_/g," "],[Wt,gE],[z,_p]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[H,[Wt,"OPPO"],[z,Gi]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[H,[Wt,"Vivo"],[z,Gi]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[H,[Wt,"Realme"],[z,Gi]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[H,[Wt,_y],[z,Gi]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[H,[Wt,_y],[z,_p]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[H,[Wt,l_],[z,_p]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[H,[Wt,l_],[z,Gi]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[H,[Wt,"Lenovo"],[z,_p]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[H,/_/g," "],[Wt,"Nokia"],[z,Gi]],[/(pixel c)\b/i],[H,[Wt,DE],[z,_p]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[H,[Wt,DE],[z,Gi]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[H,[Wt,uE],[z,Gi]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[H,"Xperia Tablet"],[Wt,uE],[z,_p]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[H,[Wt,"OnePlus"],[z,Gi]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[H,[Wt,dE],[z,_p]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[H,/(.+)/g,"Fire Phone $1"],[Wt,dE],[z,Gi]],[/(playbook);[-\w\),; ]+(rim)/i],[H,Wt,[z,_p]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[H,[Wt,EE],[z,Gi]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[H,[Wt,oE],[z,_p]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[H,[Wt,oE],[z,Gi]],[/(nexus 9)/i],[H,[Wt,"HTC"],[z,_p]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[Wt,[H,/_/g," "],[z,Gi]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[H,[Wt,"Acer"],[z,_p]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[H,[Wt,"Meizu"],[z,Gi]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[Wt,H,[z,Gi]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[Wt,H,[z,_p]],[/(surface duo)/i],[H,[Wt,x_],[z,_p]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[H,[Wt,"Fairphone"],[z,Gi]],[/(u304aa)/i],[H,[Wt,"AT&T"],[z,Gi]],[/\bsie-(\w*)/i],[H,[Wt,"Siemens"],[z,Gi]],[/\b(rct\w+) b/i],[H,[Wt,"RCA"],[z,_p]],[/\b(venue[\d ]{2,7}) b/i],[H,[Wt,"Dell"],[z,_p]],[/\b(q(?:mv|ta)\w+) b/i],[H,[Wt,"Verizon"],[z,_p]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[H,[Wt,"Barnes & Noble"],[z,_p]],[/\b(tm\d{3}\w+) b/i],[H,[Wt,"NuVision"],[z,_p]],[/\b(k88) b/i],[H,[Wt,"ZTE"],[z,_p]],[/\b(nx\d{3}j) b/i],[H,[Wt,"ZTE"],[z,Gi]],[/\b(gen\d{3}) b.+49h/i],[H,[Wt,"Swiss"],[z,Gi]],[/\b(zur\d{3}) b/i],[H,[Wt,"Swiss"],[z,_p]],[/\b((zeki)?tb.*\b) b/i],[H,[Wt,"Zeki"],[z,_p]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[Wt,"Dragon Touch"],H,[z,_p]],[/\b(ns-?\w{0,9}) b/i],[H,[Wt,"Insignia"],[z,_p]],[/\b((nxa|next)-?\w{0,9}) b/i],[H,[Wt,"NextBook"],[z,_p]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[Wt,"Voice"],H,[z,Gi]],[/\b(lvtel\-)?(v1[12]) b/i],[[Wt,"LvTel"],H,[z,Gi]],[/\b(ph-1) /i],[H,[Wt,"Essential"],[z,Gi]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[H,[Wt,"Envizen"],[z,_p]],[/\b(trio[-\w\. ]+) b/i],[H,[Wt,"MachSpeed"],[z,_p]],[/\btu_(1491) b/i],[H,[Wt,"Rotor"],[z,_p]],[/(shield[\w ]+) b/i],[H,[Wt,"Nvidia"],[z,_p]],[/(sprint) (\w+)/i],[Wt,H,[z,Gi]],[/(kin\.[onetw]{3})/i],[[H,/\./g," "],[Wt,x_],[z,Gi]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[H,[Wt,UE],[z,_p]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[H,[Wt,UE],[z,Gi]],[/smart-tv.+(samsung)/i],[Wt,[z,_f]],[/hbbtv.+maple;(\d+)/i],[[H,/^/,"SmartTV"],[Wt,wT],[z,_f]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[Wt,l_],[z,_f]],[/(apple) ?tv/i],[Wt,[H,"Apple TV"],[z,_f]],[/crkey/i],[[H,"Chromecast"],[Wt,DE],[z,_f]],[/droid.+aft(\w)( bui|\))/i],[H,[Wt,dE],[z,_f]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[H,[Wt,eE],[z,_f]],[/(bravia[\w ]+)( bui|\))/i],[H,[Wt,uE],[z,_f]],[/(mitv-\w{5}) bui/i],[H,[Wt,gE],[z,_f]],[/Hbbtv.*(technisat) (.*);/i],[Wt,H,[z,_f]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[Wt,jE],[H,jE],[z,_f]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[z,_f]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[Wt,H,[z,Fi]],[/droid.+; (shield) bui/i],[H,[Wt,"Nvidia"],[z,Fi]],[/(playstation [345portablevi]+)/i],[H,[Wt,uE],[z,Fi]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[H,[Wt,x_],[z,Fi]],[/((pebble))app/i],[Wt,H,[z,cE]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[H,[Wt,lE],[z,cE]],[/droid.+; (glass) \d/i],[H,[Wt,DE],[z,cE]],[/droid.+; (wt63?0{2,3})\)/i],[H,[Wt,UE],[z,cE]],[/(quest( 2| pro)?)/i],[H,[Wt,$E],[z,cE]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[Wt,[z,RE]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[H,[z,Gi]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[H,[z,_p]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[z,_p]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[z,Gi]],[/(android[-\w\. ]{0,9});.+buil/i],[H,[Wt,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[_r,[B,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[_r,[B,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[B,_r],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[_r,B]],os:[[/microsoft (windows) (vista|xp)/i],[B,_r],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[B,[_r,_b,mS]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[B,"Windows"],[_r,_b,mS]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[_r,/_/g,"."],[B,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[B,Vt],[_r,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[_r,B],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[B,_r],[/\(bb(10);/i],[_r,[B,EE]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[_r,[B,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[_r,[B,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[_r,[B,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[_r,[B,"watchOS"]],[/crkey\/([\d\.]+)/i],[_r,[B,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[B,pE],_r],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[B,_r],[/(sunos) ?([\w\.\d]*)/i],[[B,"Solaris"],_r],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[B,_r]]},sS=function(D_,K_){if(typeof D_===b&&(K_=D_,D_=l),!(this instanceof sS))return new sS(D_,K_).getResult();var E_=typeof s!==_&&s.navigator?s.navigator:l,ST=D_||(E_&&E_.userAgent?E_.userAgent:""),VS=E_&&E_.userAgentData?E_.userAgentData:l,P_=K_?function(QE,NT){var IR={};for(var AS in QE)NT[AS]&&NT[AS].length%2==0?IR[AS]=NT[AS].concat(QE[AS]):IR[AS]=QE[AS];return IR}(SR,K_):SR;return this.getBrowser=function(){var QE={};return QE.name=l,QE.version=l,v_.call(QE,ST,P_.browser),QE.major=function(NT){return typeof NT===P?NT.replace(/[^\d\.]/g,"").split(".")[0]:l}(QE.version),E_&&E_.brave&&typeof E_.brave.isBrave==p&&(QE.name="Brave"),QE},this.getCPU=function(){var QE={};return QE.architecture=l,v_.call(QE,ST,P_.cpu),QE},this.getDevice=function(){var QE={};return QE.vendor=l,QE.model=l,QE.type=l,v_.call(QE,ST,P_.device),!QE.type&&VS&&VS.mobile&&(QE.type=Gi),QE.model=="Macintosh"&&E_&&typeof E_.standalone!==_&&E_.maxTouchPoints&&E_.maxTouchPoints>2&&(QE.model="iPad",QE.type=_p),QE},this.getEngine=function(){var QE={};return QE.name=l,QE.version=l,v_.call(QE,ST,P_.engine),QE},this.getOS=function(){var QE={};return QE.name=l,QE.version=l,v_.call(QE,ST,P_.os),!QE.name&&VS&&VS.platform!="Unknown"&&(QE.name=VS.platform.replace(/chrome os/i,pE).replace(/macos/i,Vt)),QE},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ST},this.setUA=function(QE){return ST=typeof QE===P&&QE.length>350?jE(QE,350):QE,this},this.setUA(ST),this};sS.VERSION="0.7.34",sS.BROWSER=_o([B,_r,x]),sS.CPU=_o([Di]),sS.DEVICE=_o([H,Wt,z,Fi,Gi,_f,_p,cE,RE]),sS.ENGINE=sS.OS=_o([B,_r]),r.exports&&(i=r.exports=sS),i.UAParser=sS;var RR=typeof s!==_&&(s.jQuery||s.Zepto);if(RR&&!RR.ua){var BI=new sS;RR.ua=BI.getResult(),RR.ua.get=function(){return BI.getUA()},RR.ua.set=function(D_){BI.setUA(D_);var K_=BI.getResult();for(var E_ in K_)RR.ua[E_]=K_[E_]}}})(typeof window=="object"?window:h)})(zD,zD.exports);const JD=new zD.exports;let XD,UT,WS=JD.getResult(),QD=null;function i_(r){if(!QD){r&&JD.setUA(r),WS=JD.getResult();const i=function(_){if(_.engine.name==="Blink"&&_.browser.name!=="WeChat")return u_.CHROME;switch(_.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return u_.CHROME;case"Safari":case"Mobile Safari":return u_.SAFARI;case"Edge":return u_.EDGE;case"Firefox":return u_.FIREFOX;case"QQBrowser":return u_.QQ;case"Opera":return u_.OPERA;case"WeChat":return u_.WECHAT;default:return _.browser.name||""}}(WS),s=function(_){let b;return b=_.engine.name==="Blink"?_.engine.version||"":_.browser.version||"",b.split(".")[0]}(WS),l=function(_){switch(_.os.name){case"Windows":return _.os.version?_.os.name+" "+_.os.version:_.os.name;default:return _.os.name||""}}(WS),p=WS.os.version;if(!(i&&s&&l&&p))return{name:i,version:s,os:l,osVersion:p};QD={name:i,version:s,os:l,osVersion:p}}return QD}function ZU(){return i_().os}function _x(){const r=i_();return"".concat(r.os," ").concat(r.osVersion)}function hO(){const r=i_();return!!(WS.engine.name==="WebKit"&&r.os===Mb.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&r.name!==u_.SAFARI||fT()&&r.name!==u_.SAFARI)}function bJ(){const r=i_();if(hO()){if(r.os===Mb.MAC_OS)return!0;if(r.os===Mb.IOS){const i=WS.os.version&&WS.os.version.split(".");if(i&&Number(i[0])===14&&i[1]&&Number(i[1])>=3||i&&Number(i[0])>14)return!0}}return!1}function TJ(){return WS.engine.name==="WebKit"}function $D(){return i_().name===u_.CHROME}function pT(){return i_().name===u_.SAFARI}function A_(){return i_().name===u_.FIREFOX}function fT(){return i_().os===Mb.IOS}function ZD(r){const i=i_();return!(i.name!==u_.CHROME||!i.osVersion)&&Number(i.version)>=r}function t2(r){const i=i_();return!(i.name!==u_.EDGE||!i.osVersion)&&Number(i.version)>=r}function e2(r){const i=i_();return!(i.name!==u_.OPERA||!i.osVersion)&&Number(i.version)>=r}function n2(){const r=i_();return!(r.name!==u_.CHROME||!r.osVersion)&&Number(r.version)<=90}function r2(){const r=i_();if(r.os!==Mb.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return Number(i[0])<14||Number(i[0])===14&&Number(i[1])<=6}function lI(){const r=i_();if(r.os!==Mb.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return Number(i[0])===15}function tP(){const r=i_();if(r.os!==Mb.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return Number(i[0])===16}function i2(){const r=i_();if(r.os!==Mb.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return Number(i[0])===15&&Number(i[1])>=1}function PS(){return pT()&&navigator.maxTouchPoints>0}function o2(){return i_().name===u_.WECHAT}function s2(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function LR(){const r=i_();return r.name===u_.EDGE||r.name===u_.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function pO(){return ZU()===Mb.ANDROID}function ZI(){const r=i_();return pO()&&(r.name===u_.CHROME||r.name===u_.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}(function(r){r.L1T1="L1T1",r.L1T2="L1T2",r.L1T3="L1T3",r.L2T1_KEY="L2T1_KEY",r.L2T2_KEY="L2T2_KEY",r.L2T3_KEY="L2T3_KEY",r.L3T1_KEY="L3T1_KEY",r.L3T2_KEY="L3T2_KEY",r.L3T3_KEY="L3T3_KEY"})(XD||(XD={})),function(r){r.CERTIFICATE="certificate",r.CODEC="codec",r.CANDIDATE_PAIR="candidate-pair",r.LOCAL_CANDIDATE="local-candidate",r.REMOTE_CANDIDATE="remote-candidate",r.INBOUND="inbound-rtp",r.TRACK="track",r.OUTBOUND="outbound-rtp",r.PC="peer-connection",r.REMOTE_INBOUND="remote-inbound-rtp",r.REMOTE_OUTBOUND="remote-outbound-rtp",r.TRANSPORT="transport",r.CSRC="csrc",r.DATA_CHANNEL="data-channel",r.STREAM="stream",r.SENDER="sender",r.RECEIVER="receiver"}(UT||(UT={}));var a2={exports:{}},SJ=vT,RJ=mE,c2=gS.f;SJ({target:"Object",stat:!0,forced:Object.defineProperty!==c2,sham:!RJ},{defineProperty:c2});var u2=tR.Object,IJ=a2.exports=function(r,i,s){return u2.defineProperty(r,i,s)};u2.defineProperty.sham&&(IJ.sham=!0);var d2=a2.exports;function $(r,i,s){return i in r?d2(r,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[i]=s,r}var eP,nP={exports:{}},l2=function(r,i){return function(){for(var s=new Array(arguments.length),l=0;l<s.length;l++)s[l]=arguments[l];return r.apply(i,s)}},OJ=l2,rP=Object.prototype.toString,iP=(eP=Object.create(null),function(r){var i=rP.call(r);return eP[i]||(eP[i]=i.slice(8,-1).toLowerCase())});function MR(r){return r=r.toLowerCase(),function(i){return iP(i)===r}}function oP(r){return Array.isArray(r)}function fO(r){return r===void 0}var h2=MR("ArrayBuffer");function p2(r){return r!==null&&typeof r=="object"}function EO(r){if(iP(r)!=="object")return!1;var i=Object.getPrototypeOf(r);return i===null||i===Object.prototype}var AJ=MR("Date"),CJ=MR("File"),wJ=MR("Blob"),NJ=MR("FileList");function sP(r){return rP.call(r)==="[object Function]"}var DJ=MR("URLSearchParams");function aP(r,i){if(r!=null)if(typeof r!="object"&&(r=[r]),oP(r))for(var s=0,l=r.length;s<l;s++)i.call(null,r[s],s,r);else for(var p in r)Object.prototype.hasOwnProperty.call(r,p)&&i.call(null,r[p],p,r)}var cP,PJ=(cP=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(r){return cP&&r instanceof cP}),yT={isArray:oP,isArrayBuffer:h2,isBuffer:function(r){return r!==null&&!fO(r)&&r.constructor!==null&&!fO(r.constructor)&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)},isFormData:function(r){var i="[object FormData]";return r&&(typeof FormData=="function"&&r instanceof FormData||rP.call(r)===i||sP(r.toString)&&r.toString()===i)},isArrayBufferView:function(r){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(r):r&&r.buffer&&h2(r.buffer)},isString:function(r){return typeof r=="string"},isNumber:function(r){return typeof r=="number"},isObject:p2,isPlainObject:EO,isUndefined:fO,isDate:AJ,isFile:CJ,isBlob:wJ,isFunction:sP,isStream:function(r){return p2(r)&&sP(r.pipe)},isURLSearchParams:DJ,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:aP,merge:function r(){var i={};function s(_,b){EO(i[b])&&EO(_)?i[b]=r(i[b],_):EO(_)?i[b]=r({},_):oP(_)?i[b]=_.slice():i[b]=_}for(var l=0,p=arguments.length;l<p;l++)aP(arguments[l],s);return i},extend:function(r,i,s){return aP(i,function(l,p){r[p]=s&&typeof l=="function"?OJ(l,s):l}),r},trim:function(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")},stripBOM:function(r){return r.charCodeAt(0)===65279&&(r=r.slice(1)),r},inherits:function(r,i,s,l){r.prototype=Object.create(i.prototype,l),r.prototype.constructor=r,s&&Object.assign(r.prototype,s)},toFlatObject:function(r,i,s){var l,p,_,b={};i=i||{};do{for(p=(l=Object.getOwnPropertyNames(r)).length;p-- >0;)b[_=l[p]]||(i[_]=r[_],b[_]=!0);r=Object.getPrototypeOf(r)}while(r&&(!s||s(r,i))&&r!==Object.prototype);return i},kindOf:iP,kindOfTest:MR,endsWith:function(r,i,s){r=String(r),(s===void 0||s>r.length)&&(s=r.length),s-=i.length;var l=r.indexOf(i,s);return l!==-1&&l===s},toArray:function(r){if(!r)return null;var i=r.length;if(fO(i))return null;for(var s=new Array(i);i-- >0;)s[i]=r[i];return s},isTypedArray:PJ,isFileList:NJ},hI=yT;function f2(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var E2=function(r,i,s){if(!i)return r;var l;if(s)l=s(i);else if(hI.isURLSearchParams(i))l=i.toString();else{var p=[];hI.forEach(i,function(b,P){b!=null&&(hI.isArray(b)?P+="[]":b=[b],hI.forEach(b,function(x){hI.isDate(x)?x=x.toISOString():hI.isObject(x)&&(x=JSON.stringify(x)),p.push(f2(P)+"="+f2(x))}))}),l=p.join("&")}if(l){var _=r.indexOf("#");_!==-1&&(r=r.slice(0,_)),r+=(r.indexOf("?")===-1?"?":"&")+l}return r},kJ=yT;function _O(){this.handlers=[]}_O.prototype.use=function(r,i,s){return this.handlers.push({fulfilled:r,rejected:i,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1},_O.prototype.eject=function(r){this.handlers[r]&&(this.handlers[r]=null)},_O.prototype.forEach=function(r){kJ.forEach(this.handlers,function(i){i!==null&&r(i)})};var LJ=_O,MJ=yT,_2=yT;function pI(r,i,s,l,p){Error.call(this),this.message=r,this.name="AxiosError",i&&(this.code=i),s&&(this.config=s),l&&(this.request=l),p&&(this.response=p)}_2.inherits(pI,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var m2=pI.prototype,g2={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(r){g2[r]={value:r}}),Object.defineProperties(pI,g2),Object.defineProperty(m2,"isAxiosError",{value:!0}),pI.from=function(r,i,s,l,p,_){var b=Object.create(m2);return _2.toFlatObject(r,b,function(P){return P!==Error.prototype}),pI.call(b,r.message,i,s,l,p),b.name=r.name,_&&Object.assign(b,_),b};var fI=pI,v2={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},yS=yT,y2=function(r,i){i=i||new FormData;var s=[];function l(p){return p===null?"":yS.isDate(p)?p.toISOString():yS.isArrayBuffer(p)||yS.isTypedArray(p)?typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}return function p(_,b){if(yS.isPlainObject(_)||yS.isArray(_)){if(s.indexOf(_)!==-1)throw Error("Circular reference detected in "+b);s.push(_),yS.forEach(_,function(P,x){if(!yS.isUndefined(P)){var H,B=b?b+"."+x:x;if(P&&!b&&typeof P=="object"){if(yS.endsWith(x,"{}"))P=JSON.stringify(P);else if(yS.endsWith(x,"[]")&&(H=yS.toArray(P)))return void H.forEach(function(z){!yS.isUndefined(z)&&i.append(B,l(z))})}p(P,B)}}),s.pop()}else i.append(b,l(_))}(r),i},uP=fI,mO=yT,UJ=mO.isStandardBrowserEnv()?{write:function(r,i,s,l,p,_){var b=[];b.push(r+"="+encodeURIComponent(i)),mO.isNumber(s)&&b.push("expires="+new Date(s).toGMTString()),mO.isString(l)&&b.push("path="+l),mO.isString(p)&&b.push("domain="+p),_===!0&&b.push("secure"),document.cookie=b.join("; ")},read:function(r){var i=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},xJ=function(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)},jJ=function(r,i){return i?r.replace(/\/+$/,"")+"/"+i.replace(/^\/+/,""):r},b2=function(r,i){return r&&!xJ(i)?jJ(r,i):i},dP=yT,VJ=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],T2=yT,FJ=T2.isStandardBrowserEnv()?function(){var r,i=/(msie|trident)/i.test(navigator.userAgent),s=document.createElement("a");function l(p){var _=p;return i&&(s.setAttribute("href",_),_=s.href),s.setAttribute("href",_),{href:s.href,protocol:s.protocol?s.protocol.replace(/:$/,""):"",host:s.host,search:s.search?s.search.replace(/^\?/,""):"",hash:s.hash?s.hash.replace(/^#/,""):"",hostname:s.hostname,port:s.port,pathname:s.pathname.charAt(0)==="/"?s.pathname:"/"+s.pathname}}return r=l(window.location.href),function(p){var _=T2.isString(p)?l(p):p;return _.protocol===r.protocol&&_.host===r.host}}():function(){return!0},lP=fI;function S2(r){lP.call(this,r??"canceled",lP.ERR_CANCELED),this.name="CanceledError"}yT.inherits(S2,lP,{__CANCEL__:!0});var gO=S2,t0=yT,BJ=function(r,i,s){var l=s.config.validateStatus;s.status&&l&&!l(s.status)?i(new uP("Request failed with status code "+s.status,[uP.ERR_BAD_REQUEST,uP.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):r(s)},GJ=UJ,qJ=E2,WJ=b2,KJ=function(r){var i,s,l,p={};return r&&dP.forEach(r.split(`
`),function(_){if(l=_.indexOf(":"),i=dP.trim(_.substr(0,l)).toLowerCase(),s=dP.trim(_.substr(l+1)),i){if(p[i]&&VJ.indexOf(i)>=0)return;p[i]=i==="set-cookie"?(p[i]?p[i]:[]).concat([s]):p[i]?p[i]+", "+s:s}}),p},HJ=FJ,YJ=v2,KS=fI,zJ=gO,JJ=function(r){var i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return i&&i[1]||""},XJ=function(r){return new Promise(function(i,s){var l,p=r.data,_=r.headers,b=r.responseType;function P(){r.cancelToken&&r.cancelToken.unsubscribe(l),r.signal&&r.signal.removeEventListener("abort",l)}t0.isFormData(p)&&t0.isStandardBrowserEnv()&&delete _["Content-Type"];var x=new XMLHttpRequest;if(r.auth){var H=r.auth.username||"",B=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";_.Authorization="Basic "+btoa(H+":"+B)}var z=WJ(r.baseURL,r.url);function Wt(){if(x){var Fi="getAllResponseHeaders"in x?KJ(x.getAllResponseHeaders()):null,Gi={data:b&&b!=="text"&&b!=="json"?x.response:x.responseText,status:x.status,statusText:x.statusText,headers:Fi,config:r,request:x};BJ(function(_p){i(_p),P()},function(_p){s(_p),P()},Gi),x=null}}if(x.open(r.method.toUpperCase(),qJ(z,r.params,r.paramsSerializer),!0),x.timeout=r.timeout,"onloadend"in x?x.onloadend=Wt:x.onreadystatechange=function(){x&&x.readyState===4&&(x.status!==0||x.responseURL&&x.responseURL.indexOf("file:")===0)&&setTimeout(Wt)},x.onabort=function(){x&&(s(new KS("Request aborted",KS.ECONNABORTED,r,x)),x=null)},x.onerror=function(){s(new KS("Network Error",KS.ERR_NETWORK,r,x,x)),x=null},x.ontimeout=function(){var Fi=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded",Gi=r.transitional||YJ;r.timeoutErrorMessage&&(Fi=r.timeoutErrorMessage),s(new KS(Fi,Gi.clarifyTimeoutError?KS.ETIMEDOUT:KS.ECONNABORTED,r,x)),x=null},t0.isStandardBrowserEnv()){var _r=(r.withCredentials||HJ(z))&&r.xsrfCookieName?GJ.read(r.xsrfCookieName):void 0;_r&&(_[r.xsrfHeaderName]=_r)}"setRequestHeader"in x&&t0.forEach(_,function(Fi,Gi){p===void 0&&Gi.toLowerCase()==="content-type"?delete _[Gi]:x.setRequestHeader(Gi,Fi)}),t0.isUndefined(r.withCredentials)||(x.withCredentials=!!r.withCredentials),b&&b!=="json"&&(x.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&x.addEventListener("progress",r.onDownloadProgress),typeof r.onUploadProgress=="function"&&x.upload&&x.upload.addEventListener("progress",r.onUploadProgress),(r.cancelToken||r.signal)&&(l=function(Fi){x&&(s(!Fi||Fi&&Fi.type?new zJ:Fi),x.abort(),x=null)},r.cancelToken&&r.cancelToken.subscribe(l),r.signal&&(r.signal.aborted?l():r.signal.addEventListener("abort",l))),p||(p=null);var Di=JJ(z);Di&&["http","https","file"].indexOf(Di)===-1?s(new KS("Unsupported protocol "+Di+":",KS.ERR_BAD_REQUEST,r)):x.send(p)})},ET=yT,R2=function(r,i){MJ.forEach(r,function(s,l){l!==i&&l.toUpperCase()===i.toUpperCase()&&(r[i]=s,delete r[l])})},I2=fI,QJ=y2,$J={"Content-Type":"application/x-www-form-urlencoded"};function O2(r,i){!ET.isUndefined(r)&&ET.isUndefined(r["Content-Type"])&&(r["Content-Type"]=i)}var A2,vO={transitional:v2,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(A2=XJ),A2),transformRequest:[function(r,i){if(R2(i,"Accept"),R2(i,"Content-Type"),ET.isFormData(r)||ET.isArrayBuffer(r)||ET.isBuffer(r)||ET.isStream(r)||ET.isFile(r)||ET.isBlob(r))return r;if(ET.isArrayBufferView(r))return r.buffer;if(ET.isURLSearchParams(r))return O2(i,"application/x-www-form-urlencoded;charset=utf-8"),r.toString();var s,l=ET.isObject(r),p=i&&i["Content-Type"];if((s=ET.isFileList(r))||l&&p==="multipart/form-data"){var _=this.env&&this.env.FormData;return QJ(s?{"files[]":r}:r,_&&new _)}return l||p==="application/json"?(O2(i,"application/json"),function(b,P,x){if(ET.isString(b))try{return(P||JSON.parse)(b),ET.trim(b)}catch(H){if(H.name!=="SyntaxError")throw H}return(x||JSON.stringify)(b)}(r)):r}],transformResponse:[function(r){var i=this.transitional||vO.transitional,s=i&&i.silentJSONParsing,l=i&&i.forcedJSONParsing,p=!s&&this.responseType==="json";if(p||l&&ET.isString(r)&&r.length)try{return JSON.parse(r)}catch(_){if(p)throw _.name==="SyntaxError"?I2.from(_,I2.ERR_BAD_RESPONSE,this,null,this.response):_}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:null},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};ET.forEach(["delete","get","head"],function(r){vO.headers[r]={}}),ET.forEach(["post","put","patch"],function(r){vO.headers[r]=ET.merge($J)});var hP=vO,ZJ=yT,t7=hP,C2=function(r){return!(!r||!r.__CANCEL__)},w2=yT,pP=function(r,i,s){var l=this||t7;return ZJ.forEach(s,function(p){r=p.call(l,r,i)}),r},e7=C2,n7=hP,r7=gO;function fP(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new r7}var JT=yT,N2=function(r,i){i=i||{};var s={};function l(H,B){return JT.isPlainObject(H)&&JT.isPlainObject(B)?JT.merge(H,B):JT.isPlainObject(B)?JT.merge({},B):JT.isArray(B)?B.slice():B}function p(H){return JT.isUndefined(i[H])?JT.isUndefined(r[H])?void 0:l(void 0,r[H]):l(r[H],i[H])}function _(H){if(!JT.isUndefined(i[H]))return l(void 0,i[H])}function b(H){return JT.isUndefined(i[H])?JT.isUndefined(r[H])?void 0:l(void 0,r[H]):l(void 0,i[H])}function P(H){return H in i?l(r[H],i[H]):H in r?l(void 0,r[H]):void 0}var x={url:_,method:_,data:_,baseURL:b,transformRequest:b,transformResponse:b,paramsSerializer:b,timeout:b,timeoutMessage:b,withCredentials:b,adapter:b,responseType:b,xsrfCookieName:b,xsrfHeaderName:b,onUploadProgress:b,onDownloadProgress:b,decompress:b,maxContentLength:b,maxBodyLength:b,beforeRedirect:b,transport:b,httpAgent:b,httpsAgent:b,cancelToken:b,socketPath:b,responseEncoding:b,validateStatus:P};return JT.forEach(Object.keys(r).concat(Object.keys(i)),function(H){var B=x[H]||p,z=B(H);JT.isUndefined(z)&&B!==P||(s[H]=z)}),s},D2="0.27.2",i7=D2,aR=fI,EP={};["object","boolean","number","function","string","symbol"].forEach(function(r,i){EP[r]=function(s){return typeof s===r||"a"+(i<1?"n ":" ")+r}});var P2={};EP.transitional=function(r,i,s){function l(p,_){return"[Axios v"+i7+"] Transitional option '"+p+"'"+_+(s?". "+s:"")}return function(p,_,b){if(r===!1)throw new aR(l(_," has been removed"+(i?" in "+i:"")),aR.ERR_DEPRECATED);return i&&!P2[_]&&(P2[_]=!0,console.warn(l(_," has been deprecated since v"+i+" and will be removed in the near future"))),!r||r(p,_,b)}};var k2=yT,o7=E2,L2=LJ,M2=function(r){return fP(r),r.headers=r.headers||{},r.data=pP.call(r,r.data,r.headers,r.transformRequest),r.headers=w2.merge(r.headers.common||{},r.headers[r.method]||{},r.headers),w2.forEach(["delete","get","head","post","put","patch","common"],function(i){delete r.headers[i]}),(r.adapter||n7.adapter)(r).then(function(i){return fP(r),i.data=pP.call(r,i.data,i.headers,r.transformResponse),i},function(i){return e7(i)||(fP(r),i&&i.response&&(i.response.data=pP.call(r,i.response.data,i.response.headers,r.transformResponse))),Promise.reject(i)})},yO=N2,s7=b2,U2={assertOptions:function(r,i,s){if(typeof r!="object")throw new aR("options must be an object",aR.ERR_BAD_OPTION_VALUE);for(var l=Object.keys(r),p=l.length;p-- >0;){var _=l[p],b=i[_];if(b){var P=r[_],x=P===void 0||b(P,_,r);if(x!==!0)throw new aR("option "+_+" must be "+x,aR.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new aR("Unknown option "+_,aR.ERR_BAD_OPTION)}},validators:EP},EI=U2.validators;function _I(r){this.defaults=r,this.interceptors={request:new L2,response:new L2}}_I.prototype.request=function(r,i){typeof r=="string"?(i=i||{}).url=r:i=r||{},(i=yO(this.defaults,i)).method?i.method=i.method.toLowerCase():this.defaults.method?i.method=this.defaults.method.toLowerCase():i.method="get";var s=i.transitional;s!==void 0&&U2.assertOptions(s,{silentJSONParsing:EI.transitional(EI.boolean),forcedJSONParsing:EI.transitional(EI.boolean),clarifyTimeoutError:EI.transitional(EI.boolean)},!1);var l=[],p=!0;this.interceptors.request.forEach(function(z){typeof z.runWhen=="function"&&z.runWhen(i)===!1||(p=p&&z.synchronous,l.unshift(z.fulfilled,z.rejected))});var _,b=[];if(this.interceptors.response.forEach(function(z){b.push(z.fulfilled,z.rejected)}),!p){var P=[M2,void 0];for(Array.prototype.unshift.apply(P,l),P=P.concat(b),_=Promise.resolve(i);P.length;)_=_.then(P.shift(),P.shift());return _}for(var x=i;l.length;){var H=l.shift(),B=l.shift();try{x=H(x)}catch(z){B(z);break}}try{_=M2(x)}catch(z){return Promise.reject(z)}for(;b.length;)_=_.then(b.shift(),b.shift());return _},_I.prototype.getUri=function(r){r=yO(this.defaults,r);var i=s7(r.baseURL,r.url);return o7(i,r.params,r.paramsSerializer)},k2.forEach(["delete","get","head","options"],function(r){_I.prototype[r]=function(i,s){return this.request(yO(s||{},{method:r,url:i,data:(s||{}).data}))}}),k2.forEach(["post","put","patch"],function(r){function i(s){return function(l,p,_){return this.request(yO(_||{},{method:r,headers:s?{"Content-Type":"multipart/form-data"}:{},url:l,data:p}))}}_I.prototype[r]=i(),_I.prototype[r+"Form"]=i(!0)});var a7=_I,c7=gO;function mI(r){if(typeof r!="function")throw new TypeError("executor must be a function.");var i;this.promise=new Promise(function(l){i=l});var s=this;this.promise.then(function(l){if(s._listeners){var p,_=s._listeners.length;for(p=0;p<_;p++)s._listeners[p](l);s._listeners=null}}),this.promise.then=function(l){var p,_=new Promise(function(b){s.subscribe(b),p=b}).then(l);return _.cancel=function(){s.unsubscribe(p)},_},r(function(l){s.reason||(s.reason=new c7(l),i(s.reason))})}mI.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},mI.prototype.subscribe=function(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]},mI.prototype.unsubscribe=function(r){if(this._listeners){var i=this._listeners.indexOf(r);i!==-1&&this._listeners.splice(i,1)}},mI.source=function(){var r;return{token:new mI(function(i){r=i}),cancel:r}};var u7=mI,d7=yT,x2=yT,l7=l2,bO=a7,h7=N2,xT=function r(i){var s=new bO(i),l=l7(bO.prototype.request,s);return x2.extend(l,bO.prototype,s),x2.extend(l,s),l.create=function(p){return r(h7(i,p))},l}(hP);xT.Axios=bO,xT.CanceledError=gO,xT.CancelToken=u7,xT.isCancel=C2,xT.VERSION=D2,xT.toFormData=y2,xT.AxiosError=fI,xT.Cancel=xT.CanceledError,xT.all=function(r){return Promise.all(r)},xT.spread=function(r){return function(i){return r.apply(null,i)}},xT.isAxiosError=function(r){return d7.isObject(r)&&r.isAxiosError===!0},nP.exports=xT,nP.exports.default=xT;var jT=nP.exports;class p7{constructor(i){$(this,"logger",void 0),$(this,"prefixLists",[]),this.logger=i}debug(){for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];this.logger.debug(...this.prefixLists,...s)}info(){for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];this.logger.info(...this.prefixLists,...s)}warning(){for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];this.logger.warning(...this.prefixLists,...s)}error(){for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];this.logger.error(...this.prefixLists,...s)}prefix(i){return this.prefixLists.push(i),this}popPrefix(){return this.prefixLists.pop(),this}}class I_{constructor(){$(this,"_events",{}),$(this,"addListener",this.on)}getListeners(i){return this._events[i]?this._events[i].map(s=>s.listener):[]}on(i,s){this._events[i]||(this._events[i]=[]);const l=this._events[i];this._indexOfListener(l,s)===-1&&l.push({listener:s,once:!1})}once(i,s){this._events[i]||(this._events[i]=[]);const l=this._events[i];this._indexOfListener(l,s)===-1&&l.push({listener:s,once:!0})}off(i,s){if(!this._events[i])return;const l=this._events[i],p=this._indexOfListener(l,s);p!==-1&&l.splice(p,1),this._events[i].length===0&&delete this._events[i]}removeAllListeners(i){i?delete this._events[i]:this._events={}}emit(i){this._events[i]||(this._events[i]=[]);const s=this._events[i].map(b=>b);for(var l=arguments.length,p=new Array(l>1?l-1:0),_=1;_<l;_++)p[_-1]=arguments[_];for(let b=0;b<s.length;b+=1){const P=s[b];P.once&&this.off(i,P.listener),P.listener.apply(this,p||[])}}safeEmit(i){for(var s=arguments.length,l=new Array(s>1?s-1:0),p=1;p<s;p++)l[p-1]=arguments[p];[...this._events[i]||[]].forEach(_=>{_.once&&this.off(i,_.listener);try{_.listener.apply(this,l)}catch(b){_e.error("safeEmit event:".concat(i," error ").concat(b==null?void 0:b.toString()))}})}_indexOfListener(i,s){let l=i.length;for(;l--;)if(i[l].listener===s)return l;return-1}}const TO=new class extends I_{reportLogUploadError(r){this.emit("REPORT_LOG_UPLOAD",r)}};let _i;(function(r){r.UNEXPECTED_ERROR="UNEXPECTED_ERROR",r.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",r.TIMEOUT="TIMEOUT",r.INVALID_PARAMS="INVALID_PARAMS",r.NOT_READABLE="NOT_READABLE",r.NOT_SUPPORTED="NOT_SUPPORTED",r.INVALID_OPERATION="INVALID_OPERATION",r.OPERATION_ABORTED="OPERATION_ABORTED",r.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",r.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",r.NETWORK_ERROR="NETWORK_ERROR",r.NETWORK_TIMEOUT="NETWORK_TIMEOUT",r.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",r.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",r.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",r.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",r.ELECTRON_IS_NULL="ELECTRON_IS_NULL",r.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",r.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",r.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",r.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",r.TRACK_IS_DISABLED="TRACK_IS_DISABLED",r.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",r.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",r.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",r.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",r.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",r.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",r.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",r.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",r.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",r.UID_CONFLICT="UID_CONFLICT",r.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",r.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",r.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",r.INVALID_TRACK="INVALID_TRACK",r.SENDER_NOT_FOUND="SENDER_NOT_FOUND",r.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",r.SET_ANSWER_FAILED="SET_ANSWER_FAILED",r.ICE_FAILED="ICE_FAILED",r.PC_CLOSED="PC_CLOSED",r.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",r.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",r.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",r.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",r.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",r.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",r.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",r.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",r.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",r.INVALID_REMOTE_USER="INVALID_REMOTE_USER",r.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",r.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",r.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",r.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",r.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",r.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",r.WS_ABORT="WS_ABORT",r.WS_DISCONNECT="WS_DISCONNECT",r.WS_ERR="WS_ERR",r.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",r.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",r.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",r.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",r.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",r.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",r.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",r.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",r.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",r.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",r.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",r.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",r.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",r.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",r.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",r.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",r.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",r.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",r.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",r.INVALID_PLUGIN="INVALID_PLUGIN",r.DISCONNECT_P2P="DISCONNECT_P2P",r.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",r.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",r.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",r.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",r.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",r.PROHIBITED_OPERATION="PROHIBITED_OPERATION",r.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"})(_i||(_i={}));class _a extends Error{constructor(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",l=arguments.length>2?arguments[2]:void 0;super(s),$(this,"code",void 0),$(this,"message",void 0),$(this,"data",void 0),$(this,"name","AgoraRTCException"),this.code=i,this.message="AgoraRTCError ".concat(this.code,": ").concat(s),this.data=l}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return i==="error"&&_e.error(this.toString()),i==="warning"&&_e.warning(this.toString()),this}throw(){throw this.print(),this}}const j_={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function _P(r,i){const s=Math.floor(i.timeout*Math.pow(i.timeoutFactor,r));return Math.min(i.maxRetryTimeout,s)}function bS(r,i,s,l){const p=Object.assign({},j_,l);let _=p.timeout;const b=async()=>{await function(H){return new SE(B=>{window.setTimeout(B,H)})}(_),_*=p.timeoutFactor,_=Math.min(p.maxRetryTimeout,_)};let P=!1;const x=new SE(async(H,B)=>{i=i||(()=>!1),s=s||(()=>!0);for(let z=0;z<p.maxRetryCount;z+=1){if(P)return B(new _a(_i.OPERATION_ABORTED));try{const Wt=await r();if(!i(Wt,z)||z+1===p.maxRetryCount)return H(Wt);await b()}catch(Wt){if(!s(Wt,z)||z+1===p.maxRetryCount)return B(Wt);await b()}}});return x.cancel=()=>P=!0,x}function mP(){const r=new Date;return r.toTimeString().split(" ")[0]+":"+r.getMilliseconds()}function j2(){const r=new Date,i=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return i?(i==null?void 0:i[0])+":"+r.getUTCMilliseconds():r.toTimeString().split(" ")[0]+":"+r.getMilliseconds()}const XT={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},SO=Date.now(),e0=r=>{for(const i in XT)if(Object.prototype.hasOwnProperty.call(XT,i)&&XT[i]===r)return i;return"DEFAULT"},_e=new class{constructor(){$(this,"proxyServerURL",void 0),$(this,"logLevel",XT.DEBUG),$(this,"uploadState","collecting"),$(this,"uploadLogWaitingList",[]),$(this,"uploadLogUploadingList",[]),$(this,"uploadErrorCount",0),$(this,"currentLogID",0),$(this,"url",void 0),$(this,"extLog",(r,i)=>{this.appendLogToWaitingList(r,...i)})}debug(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];const l=[XT.DEBUG].concat(i);this.log.apply(this,l)}info(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];const l=[XT.INFO].concat(i);this.log.apply(this,l)}warning(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];const l=[XT.WARNING].concat(i);this.log.apply(this,l)}error(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];const l=[XT.ERROR].concat(i);this.log.apply(this,l)}upload(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];const l=[XT.DEBUG].concat(i);this.uploadLog.apply(this,l)}setLogLevel(r){r=Math.min(Math.max(0,r),4),this.logLevel=r}enableLogUpload(){f_("UPLOAD_LOG",!0)}disableLogUpload(){f_("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(r){this.proxyServerURL=r}prefix(r){return new p7(this).prefix(r)}log(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];if(Date.now()-SO<100)return void setTimeout(()=>{this.log(...i)},Date.now()-SO);const l=Math.max(0,Math.min(4,i[0]));if(i[0]=mP()+" Agora-SDK [".concat(e0(l),"]:"),this.appendLogToWaitingList(l,...i),l<this.logLevel)return;const p=mP()+" %cAgora-SDK [".concat(e0(l),"]:");let _=[];if(!kc("USE_NEW_LOG"))switch(l){case XT.DEBUG:_=[p,"color: #64B5F6;"].concat(i.slice(1)),console.log.apply(console,_);break;case XT.INFO:_=[p,"color: #1E88E5; font-weight: bold;"].concat(i.slice(1)),console.log.apply(console,_);break;case XT.WARNING:_=[p,"color: #FB8C00; font-weight: bold;"].concat(i.slice(1)),console.warn.apply(console,_);break;case XT.ERROR:_=[p,"color: #B00020; font-weight: bold;"].concat(i.slice(1)),console.error.apply(console,_)}}uploadLog(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];if(Date.now()-SO<100)return void setTimeout(()=>{this.uploadLog(...i)},Date.now()-SO);const l=Math.max(0,Math.min(4,i[0]));i[0]=mP()+" Agora-SDK [".concat(e0(l),"]:"),this.appendLogToWaitingList(l,...i)}appendLogToWaitingList(r){if(!kc("UPLOAD_LOG"))return;for(var i=arguments.length,s=new Array(i>1?i-1:0),l=1;l<i;l++)s[l-1]=arguments[l];Array.isArray(s[0])?s[0][0]=j2()+" Agora-SDK [".concat(e0(r),"]:"):s[0]=j2()+" Agora-SDK [".concat(e0(r),"]:");let p="";s.forEach(_=>{typeof _=="object"&&(_=JSON.stringify(_)),p+="".concat(_," ")}),this.uploadLogWaitingList.push({payload_str:p,log_level:r,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const r=this.uploadLogUploadingList,i={sdk_version:QT,process_id:kc("PROCESS_ID"),payload:JSON.stringify(r)};return bS(async()=>{const s=await jT.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(kc("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(kc("LOG_UPLOAD_SERVER"),"/upload/v1")),i,{responseType:"text"});if(s.data!=="OK"){const l=new Error("unexpected upload log response");throw l.response=s,l}},()=>(this.uploadLogUploadingList=[],!1),s=>(s.response?TO.reportLogUploadError({status:s.response.status,data:s.response.data,headers:s.response.headers,message:s.message}):s.request?TO.reportLogUploadError({status:s.request.status,message:s.message}):TO.reportLogUploadError({status:-1,message:s.message}),!0),{timeout:kc("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:kc("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,kc("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),kc("UPLOAD_LOG_INTERVAL"))}).catch(r=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),kc("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),kc("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}},gP="v4.18.2-0-g8d83af1d-dirty(7/11/2023, 7:07:15 PM)",QT=function(r){if(r.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return r;const i=r.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(i&&i[1]&&i[2]){const l=i[1],p=i[2];return"".concat(l,".").concat(p)}const s=r.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(s&&s[1]&&s[2]){const l=s[1],p=s[2];return"".concat(l,".").concat(100*(Number(p)+1))}return"4.0.0.999"}("4.18.2"),vP=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),V2=["CHINA","GLOBAL"],VT=function(){const r="us".concat("erna","me"),i="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const l=s.join(""),p=[];for(let P=0;P<6;P++)p.push("1");const _=p.join(""),b={};return b[r]=l,b[i]=_,Object.assign(b,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=VT;const f7={"90p":zE(160,90),"90p_1":zE(160,90),"120p":zE(160,120,15,30,65),"120p_1":zE(160,120,15,30,65),"120p_3":zE(120,120,15,30,50),"120p_4":zE(212,120),"180p":zE(320,180,15,30,140),"180p_1":zE(320,180,15,30,140),"180p_3":zE(180,180,15,30,100),"180p_4":zE(240,180,15,30,120),"240p":zE(320,240,15,40,200),"240p_1":zE(320,240,15,40,200),"240p_3":zE(240,240,15,40,140),"240p_4":zE(424,240,15,40,220),"360p":zE(640,360,15,80,400),"360p_1":zE(640,360,15,80,400),"360p_3":zE(360,360,15,80,260),"360p_4":zE(640,360,30,80,600),"360p_6":zE(360,360,30,80,400),"360p_7":zE(480,360,15,80,320),"360p_8":zE(480,360,30,80,490),"360p_9":zE(640,360,15,80,800),"360p_10":zE(640,360,24,80,800),"360p_11":zE(640,360,24,80,1e3),"480p":zE(640,480,15,100,500),"480p_1":zE(640,480,15,100,500),"480p_2":zE(640,480,30,100,1e3),"480p_3":zE(480,480,15,100,400),"480p_4":zE(640,480,30,100,750),"480p_6":zE(480,480,30,100,600),"480p_8":zE(848,480,15,100,610),"480p_9":zE(848,480,30,100,930),"480p_10":zE(640,480,10,100,400),"720p":zE(1280,720,15,120,1130),"720p_1":zE(1280,720,15,120,1130),"720p_2":zE(1280,720,30,120,2e3),"720p_3":zE(1280,720,30,120,1710),"720p_5":zE(960,720,15,120,910),"720p_6":zE(960,720,30,120,1380),"1080p":zE(1920,1080,15,120,2080),"1080p_1":zE(1920,1080,15,120,2080),"1080p_2":zE(1920,1080,30,120,3e3),"1080p_3":zE(1920,1080,30,120,3150),"1080p_5":zE(1920,1080,60,120,4780),"1440p":zE(2560,1440,30,120,4850),"1440p_1":zE(2560,1440,30,120,4850),"1440p_2":zE(2560,1440,60,120,7350),"4k":zE(3840,2160,30,120,8910),"4k_1":zE(3840,2160,30,120,8910),"4k_3":zE(3840,2160,60,120,13500)},E7={"480p":cS(640,480,5),"480p_1":cS(640,480,5),"480p_2":cS(640,480,30),"480p_3":cS(640,480,15),"720p":cS(1280,720,5),"720p_1":cS(1280,720,5),"720p_2":cS(1280,720,30),"720p_3":cS(1280,720,15),"1080p":cS(1920,1080,5),"1080p_1":cS(1920,1080,5),"1080p_2":cS(1920,1080,30),"1080p_3":cS(1920,1080,15)},_7={"1SL1TL":bP(1,1),"3SL3TL":bP(3,3),"2SL3TL":bP(2,3)};function UR(r){return r||(r="480p_1"),typeof r=="string"?Object.assign({},f7[r]):r}function yP(r){return typeof r=="string"?Object.assign({},E7[r]):r}function RO(r){return typeof r=="string"?Object.assign({},_7[r]):r}const m7={speech_low_quality:gI(16e3,!1),speech_standard:gI(32e3,!1,18),music_standard:gI(48e3,!1),standard_stereo:gI(48e3,!0,56),high_quality:gI(48e3,!1,128),high_quality_stereo:gI(48e3,!0,192)};function IO(r){return typeof r=="string"?Object.assign({},m7[r]):r}function f_(r,i,s){Object.keys(RT).includes(r)&&(!s&&Object.keys(xR).includes(r)||(RT[r]=i))}function kc(r){return RT[r]}const RT={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:V2,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION:2e3,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}},xR={};function gI(r,i,s){return{sampleRate:r,stereo:i,bitrate:s}}function zE(r,i,s,l,p){return{width:r,height:i,frameRate:s,bitrateMin:l,bitrateMax:p}}function cS(r,i,s,l,p){return{width:{max:r},height:{max:i},frameRate:s,bitrateMin:l,bitrateMax:p}}function bP(r,i){return{numSpatialLayers:r,numTemporalLayers:i}}vP||(RT.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],RT.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],RT.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],RT.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],RT.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],RT.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],RT.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",RT.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",RT.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",RT.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",RT.AREAS=["NORTH_AMERICA","OVERSEA"]);const g7=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],jR=[],n0=[];function VR(r,i){return!!i&&jR.some(s=>s.uid===r&&s.channelName===i)}var v7=N0,y7=gS,b7=aE,TP=function(r,i,s){var l=v7(i);l in r?y7.f(r,l,b7(0,s)):r[l]=s},F2=CN,T7=nR,S7=TP,R7=_s.Array,I7=Math.max,B2=function(r,i,s){for(var l=T7(r),p=F2(i,l),_=F2(s===void 0?l:s,l),b=R7(I7(_-p,0)),P=0;p<_;p++,P++)S7(b,P,r[p]);return b.length=P,b},G2=B2,O7=Math.floor,SP=function(r,i){var s=r.length,l=O7(s/2);return s<8?A7(r,i):C7(r,SP(G2(r,0,l),i),SP(G2(r,l),i),i)},A7=function(r,i){for(var s,l,p=r.length,_=1;_<p;){for(l=_,s=r[_];l&&i(r[l-1],s)>0;)r[l]=r[--l];l!==_++&&(r[l]=s)}return r},C7=function(r,i,s,l){for(var p=i.length,_=s.length,b=0,P=0;b<p||P<_;)r[b+P]=b<p&&P<_?l(i[b],s[P])<=0?i[b++]:s[P++]:b<p?i[b++]:s[P++];return r},w7=SP,q2=OR.match(/firefox\/(\d+)/i),N7=!!q2&&+q2[1],D7=/MSIE|Trident/.test(OR),W2=OR.match(/AppleWebKit\/(\d+)\./),P7=!!W2&&+W2[1],k7=vT,K2=_n,L7=BS,M7=eR,U7=nR,H2=nI,RP=f,x7=w7,j7=SN,Y2=N7,V7=D7,z2=$R,J2=P7,cR=[],X2=K2(cR.sort),F7=K2(cR.push),B7=RP(function(){cR.sort(void 0)}),G7=RP(function(){cR.sort(null)}),q7=j7("sort"),Q2=!RP(function(){if(z2)return z2<70;if(!(Y2&&Y2>3)){if(V7)return!0;if(J2)return J2<603;var r,i,s,l,p="";for(r=65;r<76;r++){switch(i=String.fromCharCode(r),r){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(l=0;l<47;l++)cR.push({k:i+l,v:s})}for(cR.sort(function(_,b){return b.v-_.v}),l=0;l<cR.length;l++)i=cR[l].k.charAt(0),p.charAt(p.length-1)!==i&&(p+=i);return p!=="DGBEFHACIJK"}});k7({target:"Array",proto:!0,forced:B7||!G7||!q7||!Q2},{sort:function(r){r!==void 0&&L7(r);var i=M7(this);if(Q2)return r===void 0?X2(i):X2(i,r);var s,l,p=[],_=U7(i);for(l=0;l<_;l++)l in i&&F7(p,i[l]);for(x7(p,function(b){return function(P,x){return x===void 0?-1:P===void 0?1:b!==void 0?+b(P,x)||0:H2(P)>H2(x)?1:-1}}(r)),s=p.length,l=0;l<s;)i[l]=p[l++];for(;l<_;)delete i[l++];return i}});var W7=rR("Array").sort,K7=ue,H7=W7,IP=Array.prototype,OP=function(r){var i=r.sort;return r===IP||K7(IP,r)&&i===IP.sort?H7:i};function vI(r,i){if(typeof r!="boolean")throw new _a(_i.INVALID_PARAMS,"Invalid ".concat(i,": The value is of the boolean type."))}function Qm(r,i,s){if(!s.includes(r))throw new _a(_i.INVALID_PARAMS,"".concat(i," can only be set as ").concat(JSON.stringify(s)))}function __(r,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4,p=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(r<s||r>l||p&&!Y7(r))throw new _a(_i.INVALID_PARAMS,"invalid ".concat(i,": the value range is [").concat(s,", ").concat(l,"]. integer only"))}function AP(r,i){if(typeof r!="number"){if(!(r.min||r.max||r.ideal||r.exact))throw new _a(_i.INVALID_PARAMS,"".concat(i," is not a valid ConstrainLong"));r.min!==void 0&&__(r.min,"".concat(i,".min"),0,1/0),r.max!==void 0&&__(r.max,"".concat(i,".max"),1,1/0),r.exact!==void 0&&__(r.exact,"".concat(i,".exact"),1,1/0),r.ideal!==void 0&&__(r.ideal,"".concat(i,".ideal"),1,1/0)}else __(r,i,1,1/0)}function tT(r,i){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,p=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(r==null)throw new _a(_i.INVALID_PARAMS,"".concat(i||"param"," cannot be empty"));if(!$2(r,s,l,p))throw new _a(_i.INVALID_PARAMS,"Invalid ".concat(i||"string param",": Length of the string: [").concat(s,",").concat(l,"].").concat(p?" ASCII characters only.":""))}function HS(r,i){if(!Array.isArray(r))throw new _a(_i.INVALID_PARAMS,"".concat(i," should be an array"))}function CP(r){if(typeof r!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(r))throw _e.error("Invalid Channel Name ".concat(r)),new _a(_i.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function wP(r){if(i=r,!(typeof i=="number"&&Math.floor(i)===i&&0<=i&&i<=4294967295||$2(r,1,255)))throw _e.error("Invalid UID ".concat(r," ").concat(typeof r)),new _a(_i.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var i;typeof r=="string"&&_e.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function T_(r){return r==null}function $2(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,l=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof r=="string"&&r.length<=s&&r.length>=i&&(!l||z7(r))}function Y7(r){return typeof r=="number"&&r%1==0}function z7(r){if(typeof r!="string")return!1;for(let i=0;i<r.length;i+=1){const s=r.charCodeAt(i);if(s<0||s>255)return!1}return!0}let Z2,_j,eT;(function(r){r.FREE="free",r.UPLOADING="uploading"})(Z2||(Z2={})),function(r){r[r.MISC=0]="MISC",r[r.INTERNAL_EVENT=1]="INTERNAL_EVENT",r[r.PUBLIC_EVENT=2]="PUBLIC_EVENT",r[r.WEB_EVENT=3]="WEB_EVENT",r[r.INTERNAL_API=4]="INTERNAL_API",r[r.WEB_API=5]="WEB_API",r[r.PUBLIC_API=6]="PUBLIC_API"}(_j||(_j={})),function(r){r.NONE="none",r.INIT="init",r.CANPLAY="canplay",r.PLAYING="playing",r.PAUSED="paused",r.SUSPEND="suspend",r.STALLED="stalled",r.WAITING="waiting",r.ERROR="error",r.DESTROYED="destroyed",r.ABORT="abort",r.ENDED="ended",r.EMPTIED="emptied",r.LOADEDDATA="loadeddata"}(eT||(eT={}));const NP={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};function J7(r){return tT(r.reportId,"params.reportId",0,100,!1),tT(r.category,"params.category",0,100,!1),tT(r.event,"params.event",0,100,!1),tT(r.label,"params.label",0,100,!1),__(r.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}const X7={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let _g,O_,$j,DP,V_,S_,FR,YS,yI,r0,FT,nT,kE,PP,o_,WE,bT,d_,wE,LE,PT,GE,tV,IT;function eV(r){return __(r.timeout,"config.timeout",0,1e5),__(r.timeoutFactor,"config.timeoutFactor",0,100,!1),__(r.maxRetryCount,"config.maxRetryConfig",0,1/0),__(r.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function Q7(r){return Qm(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Qm(r.mode,"config.mode",["rtc","live"]),r.audioCodec!==void 0&&Qm(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&tT(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&nV(r.turnServer),r.httpRetryConfig!==void 0&&eV(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&eV(r.websocketRetryConfig),!0}function i0(r){if(!Array.isArray(r)||r.length<1)return!1;try{r.forEach(i=>{if(!i.urls)throw Error()})}catch{return!1}return!0}function nV(r){return tT(r.turnServerURL,"turnServerURL"),tT(r.username,"username"),tT(r.password,"password"),r.udpport&&__(r.udpport,"udpport",1,99999,!0),r.forceturn&&vI(r.forceturn,"forceturn"),r.security&&vI(r.security,"security"),r.tcpport&&__(r.tcpport,"tcpport",1,99999,!0),!0}function rV(r){return r.level!==void 0&&Qm(r.level,"level",[1,2,3]),!0}(function(r){r.PUBLISH="publish",r.SUBSCRIBE="subscribe",r.WS_COMPRESSOR_INIT="ws_compressor_init",r.SESSION_INIT="session_init",r.JOIN_CHOOSE_SERVER="join_choose_server",r.REQ_USER_ACCOUNT="req_user_account",r.JOIN_GATEWAY="join_gateway",r.REJOIN_GATEWAY="rejoin_gateway",r.STREAM_SWITCH="stream_switch",r.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",r.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",r.FIRST_VIDEO_RECEIVED="first_video_received",r.FIRST_AUDIO_RECEIVED="first_audio_received",r.FIRST_VIDEO_DECODE="first_video_decode",r.FIRST_AUDIO_DECODE="first_audio_decode",r.ON_ADD_AUDIO_STREAM="on_add_audio_stream",r.ON_ADD_VIDEO_STREAM="on_add_video_stream",r.ON_UPDATE_STREAM="on_update_stream",r.ON_REMOVE_STREAM="on_remove_stream",r.USER_ANALYTICS="req_user_analytics",r.PC_STATS="pc_stats"})(_g||(_g={})),function(r){r.SESSION="io.agora.pb.Wrtc.Session",r.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",r.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",r.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",r.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",r.PUBLISH="io.agora.pb.Wrtc.Publish",r.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",r.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",r.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",r.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",r.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",r.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",r.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",r.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",r.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",r.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",r.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",r.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",r.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",r.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",r.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",r.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",r.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",r.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",r.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",r.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",r.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",r.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",r.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",r.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",r.PC_STATS="io.agora.pb.Wrtc.PCStats"}(O_||(O_={})),function(r){r[r.WORKER_EVENT=156]="WORKER_EVENT",r[r.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}($j||($j={})),function(r){r[r.SESSION=26]="SESSION",r[r.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",r[r.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",r[r.JOIN_GATEWAY=28]="JOIN_GATEWAY",r[r.PUBLISH=30]="PUBLISH",r[r.SUBSCRIBE=29]="SUBSCRIBE",r[r.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",r[r.STREAM_SWITCH=32]="STREAM_SWITCH",r[r.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",r[r.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",r[r.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",r[r.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",r[r.API_INVOKE=41]="API_INVOKE",r[r.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",r[r.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",r[r.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",r[r.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",r[r.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",r[r.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",r[r.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",r[r.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",r[r.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",r[r.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",r[r.WORKER_EVENT=156]="WORKER_EVENT",r[r.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",r[r.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",r[r.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",r[r.USER_ANALYTICS=1e4]="USER_ANALYTICS",r[r.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(DP||(DP={})),function(r){r.CREATE_CLIENT="createClient",r.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",r.SET_AREA="setArea",r.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",r.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",r.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",r.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",r.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",r.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",r.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",r.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",r.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",r.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",r.START_PROXY_SERVER="Client.startProxyServer",r.STOP_PROXY_SERVER="Client.stopProxyServer",r.SET_PROXY_SERVER="Client.setProxyServer",r.SET_TURN_SERVER="Client.setTurnServer",r.SET_CLIENT_ROLE="Client.setClientRole",r.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",r.ENABLE_DUAL_STREAM="Client.enableDualStream",r.DISABLE_DUAL_STREAM="Client.disableDualStream",r.JOIN="Client.join",r.LEAVE="Client.leave",r.PUBLISH="Client.publish",r.UNPUBLISH="Client.unpublish",r.SUBSCRIBE="Client.subscribe",r.MASS_SUBSCRIBE="Client.massSubscribe",r.MASS_UNSUBSCRIBE="Client.massUnsubscribe",r.UNSUBSCRIBE="Client.unsubscribe",r.RENEW_TOKEN="Client.renewToken",r.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",r.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",r.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",r.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",r.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",r.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",r.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",r.DATACHANNEL_FAILBACK="Client._datachannelFailback",r.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",r.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",r.START_LIVE_STREAMING="Client.startLiveStreaming",r.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",r.STOP_LIVE_STREAMING="Client.stopLiveStreaming",r.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",r.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",r.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",r.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",r.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",r.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",r.SET_CONFIG_DISTRIBUTE="_configDistribute",r.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",r.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",r.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",r.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",r.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",r.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",r.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",r.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",r.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",r.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",r.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",r.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",r.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",r.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",r.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",r.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",r.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",r.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",r.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",r.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",r.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",r.STREAM_TYPE_CHANGE="streamTypeChange",r.CONNECTION_STATE_CHANGE="connectionStateChange",r.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",r.IMAGE_MODERATION_UPLOAD="imageModerationUpload"}(V_||(V_={})),function(r){r.TRACER="tracer"}(S_||(S_={})),function(r){r.IDLE="IDLE",r.INITING="INITING",r.INITEND="INITEND"}(FR||(FR={})),function(r){r.STATE_CHANGE="state_change",r.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",r.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",r.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(YS||(YS={})),function(r){r[r.ACCESS_POINT=101]="ACCESS_POINT",r[r.UNILBS=201]="UNILBS",r[r.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(yI||(yI={})),function(r){r[r.IIIEGAL_APPID=1]="IIIEGAL_APPID",r[r.IIIEGAL_UID=2]="IIIEGAL_UID",r[r.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(r0||(r0={})),function(r){r[r.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",r[r.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",r[r.INTERNAL_ERROR=8]="INTERNAL_ERROR",r[r.NO_AUTHORIZED=9]="NO_AUTHORIZED",r[r.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",r[r.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",r[r.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",r[r.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",r[r.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",r[r.USER_OVERLOAD=16]="USER_OVERLOAD",r[r.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",r[r.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(FT||(FT={})),function(r){r[r.NO_FLAG_SET=100]="NO_FLAG_SET",r[r.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",r[r.INVALID_FALG_SET=102]="INVALID_FALG_SET",r[r.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",r[r.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",r[r.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",r[r.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",r[r.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",r[r.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",r[r.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",r[r.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",r[r.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",r[r.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",r[r.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",r[r.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",r[r.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",r[r.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",r[r.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",r[r.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(nT||(nT={})),function(r){r[r.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",r[r.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",r[r.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",r[r.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",r[r.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",r[r.K_TICKET_INVALID=7]="K_TICKET_INVALID",r[r.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",r[r.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",r[r.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",r[r.K_UID_BANNED=14]="K_UID_BANNED",r[r.K_IP_BANNED=15]="K_IP_BANNED",r[r.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",r[r.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",r[r.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",r[r.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",r[r.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",r[r.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",r[r.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",r[r.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",r[r.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",r[r.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",r[r.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",r[r.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",r[r.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",r[r.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",r[r.ERR_INVALID_UID=117]="ERR_INVALID_UID",r[r.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",r[r.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",r[r.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",r[r.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",r[r.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",r[r.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",r[r.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",r[r.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",r[r.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",r[r.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",r[r.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",r[r.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",r[r.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",r[r.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",r[r.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",r[r.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",r[r.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",r[r.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",r[r.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",r[r.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",r[r.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",r[r.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",r[r.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",r[r.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",r[r.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",r[r.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",r[r.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",r[r.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",r[r.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",r[r.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",r[r.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",r[r.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",r[r.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",r[r.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",r[r.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",r[r.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",r[r.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(kE||(kE={})),function(r){r[r.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",r[r.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",r[r.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(PP||(PP={})),function(r){r.LEAVE="LEAVE",r.NETWORK_ERROR="NETWORK_ERROR",r.SERVER_ERROR="SERVER_ERROR",r.UID_BANNED="UID_BANNED",r.IP_BANNED="IP_BANNED",r.CHANNEL_BANNED="CHANNEL_BANNED",r.FALLBACK="FALLBACK",r.LICENSE_MISSING="LICENSE_MISSING",r.LICENSE_EXPIRED="LICENSE_EXPIRED",r.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",r.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",r.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",r.LICENSE_ILLEGAL="LICENSE_ILLEGAL"}(o_||(o_={})),function(r){r.CONNECTION_STATE_CHANGE="connection-state-change",r.MEDIA_RECONNECT_START="media-reconnect-start",r.MEDIA_RECONNECT_END="media-reconnect-end",r.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",r.USER_JOINED="user-joined",r.USER_LEAVED="user-left",r.USER_PUBLISHED="user-published",r.USER_UNPUBLISHED="user-unpublished",r.USER_INFO_UPDATED="user-info-updated",r.CLIENT_BANNED="client-banned",r.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",r.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",r.VOLUME_INDICATOR="volume-indicator",r.CRYPT_ERROR="crypt-error",r.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",r.NETWORK_QUALITY="network-quality",r.STREAM_TYPE_CHANGED="stream-type-changed",r.STREAM_FALLBACK="stream-fallback",r.RECEIVE_METADATA="receive-metadata",r.STREAM_MESSAGE="stream-message",r.LIVE_STREAMING_ERROR="live-streaming-error",r.LIVE_STREAMING_WARNING="live-streaming-warning",r.INJECT_STREAM_STATUS="stream-inject-status",r.EXCEPTION="exception",r.ERROR="error",r.P2P_LOST="p2p_lost",r.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",r.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",r.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",r.PUBLISHED_USER_LIST="published-user-list",r.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",r.CONTENT_INSPECT_ERROR="content-inspect-error",r.CONTENT_INSPECT_RESULT="content-inspect-result",r.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(WE||(WE={})),function(r){r.NETWORK_ERROR="NETWORK_ERROR",r.SERVER_ERROR="SERVER_ERROR",r.MULTI_IP="MULTI_IP",r.TIMEOUT="TIMEOUT",r.OFFLINE="OFFLINE",r.LEAVE="LEAVE",r.P2P_FAILED="P2P_FAILED",r.FALLBACK="FALLBACK"}(bT||(bT={})),function(r){r.CONNECTING="connecting",r.CONNECTED="connected",r.RECONNECTING="reconnecting",r.CLOSED="closed"}(d_||(d_={})),function(r){r.WS_CONNECTED="ws_connected",r.WS_RECONNECTING="ws_reconnecting",r.WS_CLOSED="ws_closed",r.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",r.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",r.ON_BINARY_DATA="on_binary_data",r.REQUEST_RECOVER="request_recover",r.REQUEST_JOIN_INFO="request_join_info",r.REQUEST_REJOIN_INFO="req_rejoin_info",r.IS_P2P_DISCONNECTED="is_p2p_dis",r.DISCONNECT_P2P="dis_p2p",r.ABORT_P2P_EXECUTION="abort_p2p_execution",r.NEED_RENEW_SESSION="need-sid",r.REPORT_JOIN_GATEWAY="report_join_gateway",r.REQUEST_TIMEOUT="request_timeout",r.REQUEST_SUCCESS="request_success",r.JOIN_RESPONSE="join_response",r.DATACHANNEL_PRECONNECT="datachannel_preconnect",r.DATACHANNEL_CONNECTING="datachannel_connecting",r.DATACHANNEL_FAILBACK="datachannel_failback"}(wE||(wE={})),function(r){r.PING="ping",r.PING_BACK="ping_back",r.JOIN="join_v3",r.REJOIN="rejoin_v3",r.LEAVE="leave",r.SET_CLIENT_ROLE="set_client_role",r.PUBLISH="publish",r.UNPUBLISH="unpublish",r.SUBSCRIBE="subscribe",r.SUBSCRIBE_STREAMS="subscribe_streams",r.UNSUBSCRIBE="unsubscribe",r.UNSUBSCRIBE_STREAMS="unsubscribe_streams",r.SUBSCRIBE_CHANGE="subscribe_change",r.TRAFFIC_STATS="traffic_stats",r.RENEW_TOKEN="renew_token",r.SWITCH_VIDEO_STREAM="switch_video_stream",r.DEFAULT_VIDEO_STREAM="default_video_stream",r.SET_FALLBACK_OPTION="set_fallback_option",r.GATEWAY_INFO="gateway_info",r.CONTROL="control",r.SEND_METADATA="send_metadata",r.DATA_STREAM="data_stream",r.PICK_SVC_LAYER="pick_svc_layer",r.RESTART_ICE="restart_ice",r.CONNECT_PC="connect_pc",r.SET_VIDEO_PROFILE="set_video_profile",r.SET_PARAMETER="set_parameter"}(LE||(LE={})),function(r){r.PUBLISH_STATS="publish_stats",r.PUBLISH_RELATED_STATS="publish_related_stats",r.SUBSCRIBE_STATS="subscribe_stats",r.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",r.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",r.DENOISER_STATS="denoiser_stats",r.TRANSPORT_STATS="transport_stats",r.EXTENSION_USAGE_STATS="extension_usage_stats"}(PT||(PT={})),function(r){r.ON_USER_ONLINE="on_user_online",r.ON_USER_OFFLINE="on_user_offline",r.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",r.ON_PUBLISH_STREAM="on_publish_stream",r.ON_UPLINK_STATS="on_uplink_stats",r.ON_P2P_LOST="on_p2p_lost",r.ON_REMOVE_STREAM="on_remove_stream",r.ON_ADD_AUDIO_STREAM="on_add_audio_stream",r.ON_ADD_VIDEO_STREAM="on_add_video_stream",r.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",r.ON_USER_BANNED="on_user_banned",r.ON_USER_LICENSE_BANNED="on_user_license_banned",r.ON_NOTIFICATION="on_notification",r.ON_CRYPT_ERROR="on_crypt_error",r.MUTE_AUDIO="mute_audio",r.MUTE_VIDEO="mute_video",r.UNMUTE_AUDIO="unmute_audio",r.UNMUTE_VIDEO="unmute_video",r.ON_P2P_OK="on_p2p_ok",r.RECEIVE_METADATA="receive_metadata",r.ON_DATA_STREAM="on_data_stream",r.ENABLE_LOCAL_VIDEO="enable_local_video",r.DISABLE_LOCAL_VIDEO="disable_local_video",r.ENABLE_LOCAL_AUDIO="enable_local_audio",r.DISABLE_LOCAL_AUDIO="disable_local_audio",r.ON_PUBLISHED_USER_LIST="on_published_user_list"}(GE||(GE={})),function(r){r.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",r.NEED_ANSWER="NEED_ANSWER",r.NEED_RENEGOTIATE="NEED_RENEGOTIATE",r.P2P_LOST="P2P_LOST",r.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",r.NEED_UNPUB="NEED_UNPUB",r.NEED_UNSUB="NEED_UNSUB",r.NEED_UPLOAD="NEED_UPLOAD",r.NEED_CONTROL="NEED_CONTROL",r.START_RECONNECT="START_RECONNECT",r.END_RECONNECT="END_RECONNECT",r.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(tV||(tV={})),function(r){r.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",r.RECEIVE_TRACK_BUFFER="receive_track_buffer",r.ON_AUDIO_BUFFER="on_audio_buffer",r.UPDATE_SOURCE="update_source"}(IT||(IT={}));const kP={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},LP={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},iV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},$7={uplinkNetworkQuality:0,downlinkNetworkQuality:0},oV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let xE,Y_,uR;(function(r){r.CONNECTED="websocket:connected",r.RECONNECTING="websocket:reconnecting",r.WILL_RECONNECT="websocket:will_reconnect",r.CLOSED="websocket:closed",r.FAILED="websocket:failed",r.ON_MESSAGE="websocket:on_message",r.REQUEST_NEW_URLS="websocket:request_new_urls",r.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",r.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"})(xE||(xE={})),function(r){r.TRANSCODE="mix_streaming",r.RAW="raw_streaming",r.INJECT="inject_streaming"}(Y_||(Y_={})),function(r){r[r.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",r[r.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",r[r.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",r[r.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",r[r.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",r[r.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",r[r.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",r[r.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",r[r.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",r[r.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",r[r.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(uR||(uR={}));const Z7={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},MP={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function UP(r,i){tT(r.url,"".concat(i,".url"),1,1e3,!1),T_(r.x)||__(r.x,"".concat(i,".x"),0,1e4),T_(r.y)||__(r.y,"".concat(i,".y"),0,1e4),T_(r.width)||__(r.width,"".concat(i,".width"),0,1e4),T_(r.height)||__(r.height,"".concat(i,".height"),0,1e4),T_(r.zOrder)||__(r.zOrder,"".concat(i,".zOrder"),0,255),T_(r.alpha)||__(r.alpha,"".concat(i,".alpha"),0,1,!1)}const t9={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},e9={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};let uS,bI,k_,sV,rT,TS,_T,dR,z_,R_,F_,OO,ME,X_,TI,xP,jP,o0,lR,SI,JE;function aV(r){if(!r.channelName)throw new _a(_i.INVALID_PARAMS,"invalid channelName in info");if(typeof r.uid!="number")throw new _a(_i.INVALID_PARAMS,"invalid uid in info, uid must be a number");return r.token&&tT(r.token,"info.token",1,2047),wP(r.uid),CP(r.channelName),!0}function cV(r){return Qm(r,"mediaSource",["screen","window","application"]),!0}(function(r){r.WARNING="@live_uap-warning",r.ERROR="@line_uap-error",r.PUBLISH_STREAM_STATUS="@live_uap-publish-status",r.INJECT_STREAM_STATUS="@live_uap-inject-status",r.WORKER_STATUS="@live_uap-worker-status",r.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(uS||(uS={})),function(r){r.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(bI||(bI={})),function(r){r[r.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",r[r.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",r[r.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",r[r.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",r[r.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",r[r.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",r[r.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",r[r.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",r[r.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",r[r.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",r[r.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",r[r.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",r[r.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",r[r.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",r[r.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",r[r.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",r[r.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",r[r.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(k_||(k_={})),function(r){r.CONNECT_FAILED="connect failed",r.CONNECT_TIMEOUT="connect timeout",r.WS_DISCONNECTED="websocket disconnected",r.REQUEST_TIMEOUT="request timeout",r.REQUEST_FAILED="request failed",r.WAIT_STATUS_TIMEOUT="wait status timeout",r.WAIT_STATUS_ERROR="wait status error",r.BAD_STATE="bad state",r.WS_ABORT="ws abort",r.AP_REQUEST_TIMEOUT="AP request timeout",r.AP_JSON_PARSE_ERROR="AP json parse error",r.AP_REQUEST_ERROR="AP request error",r.AP_REQUEST_ABORT="AP request abort"}(sV||(sV={})),function(r){r[r.SetSdkProfile=0]="SetSdkProfile",r[r.SetSourceChannel=1]="SetSourceChannel",r[r.SetSourceUserId=2]="SetSourceUserId",r[r.SetDestChannel=3]="SetDestChannel",r[r.StartPacketTransfer=4]="StartPacketTransfer",r[r.StopPacketTransfer=5]="StopPacketTransfer",r[r.UpdateDestChannel=6]="UpdateDestChannel",r[r.Reconnect=7]="Reconnect",r[r.SetVideoProfile=8]="SetVideoProfile"}(rT||(rT={})),function(r){r.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",r.NETWORK_CONNECTED="NETWORK_CONNECTED",r.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",r.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",r.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",r.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",r.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",r.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",r.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",r.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(TS||(TS={})),function(r){r.RELAY_STATE_IDLE="RELAY_STATE_IDLE",r.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",r.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",r.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(_T||(_T={})),function(r){r.RELAY_OK="RELAY_OK",r.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",r.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",r.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(dR||(dR={})),function(r){r.High="high",r.Low="low",r.Audio="audio",r.Screen="screen",r.ScreenLow="screen_low"}(z_||(z_={})),function(r){r.DISCONNECT="disconnect",r.CONNECTION_STATE_CHANGE="connection-state-change",r.NETWORK_QUALITY="network-quality",r.STREAM_TYPE_CHANGE="stream-type-change",r.IS_P2P_DISCONNECTED="is-p2p-dis",r.DISCONNECT_P2P="dis-p2p",r.REQUEST_NEW_GATEWAY_LIST="req-gate-url",r.NEED_RENEW_SESSION="need-sid",r.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",r.JOIN_RESPONSE="join-response",r.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",r.RESET_CONNECTION_EVENTS="reset-connection-events",r.DATACHANNEL_PRECONNECT="datachannel_preconnect",r.DATACHANNEL_FAILBACK="datachannel_failback",r.RESET_SIGNAL="reset-signal"}(R_||(R_={})),function(r){r[r.Nothing=0]="Nothing",r[r.Audio=1]="Audio",r[r.LwoVideo=2]="LwoVideo",r[r.Video=4]="Video",r[r.Data=8]="Data"}(F_||(F_={})),function(r){r[r.websocket=0]="websocket",r[r.datachannel=1]="datachannel"}(OO||(OO={})),function(r){r.NEED_RENEGOTIATE="@need_renegotiate",r.NEED_REPLACE_TRACK="@need_replace_track",r.NEED_CLOSE="@need_close",r.NEED_ENABLE_TRACK="@need_enable_track",r.NEED_DISABLE_TRACK="@need_disable_track",r.NEED_SESSION_ID="@need_sid",r.SET_OPTIMIZATION_MODE="@set_optimization_mode",r.GET_STATS="@get_stats",r.GET_LOW_VIDEO_TRACK="@get_low_video_track",r.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",r.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",r.NEED_MUTE_TRACK="@need_mute_track",r.NEED_UNMUTE_TRACK="@need_unmute_track"}(ME||(ME={})),function(r){r.SCREEN_TRACK="screen_track",r.CUSTOM_TRACK="custome_track",r.LOW_STREAM="low_stream"}(X_||(X_={})),function(r){r[r.HIGH_STREAM=0]="HIGH_STREAM",r[r.LOW_STREAM=1]="LOW_STREAM"}(TI||(TI={})),function(r){r[r.HIGH_STREAM=0]="HIGH_STREAM",r[r.LOW_STREAM=1]="LOW_STREAM"}(xP||(xP={})),function(r){r[r.DISABLE=0]="DISABLE",r[r.LOW_STREAM=1]="LOW_STREAM",r[r.AUDIO_ONLY=2]="AUDIO_ONLY"}(jP||(jP={})),function(r){r.TRANSCEIVER_UPDATED="transceiver-updated"}(o0||(o0={})),function(r){r.SOURCE_STATE_CHANGE="source-state-change",r.TRACK_ENDED="track-ended",r.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",r.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",r.CLOSED="closed"}(lR||(lR={})),function(r){r.FIRST_FRAME_DECODED="first-frame-decoded",r.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(SI||(SI={})),function(r){r.CHINA="CHINA",r.ASIA="ASIA",r.NORTH_AMERICA="NORTH_AMERICA",r.EUROPE="EUROPE",r.JAPAN="JAPAN",r.INDIA="INDIA",r.KOREA="KOREA",r.HKMC="HKMC",r.US="US",r.OCEANIA="OCEANIA",r.SOUTH_AMERICA="SOUTH_AMERICA",r.AFRICA="AFRICA",r.OVERSEA="OVERSEA",r.GLOBAL="GLOBAL",r.EXTENSIONS="EXTENSIONS"}(JE||(JE={}));const n9=[JE.AFRICA,JE.ASIA,JE.CHINA,JE.EUROPE,JE.GLOBAL,JE.INDIA,JE.JAPAN,JE.NORTH_AMERICA,JE.OCEANIA,JE.OVERSEA,JE.SOUTH_AMERICA];let Eg;(function(r){r.CHINA="CN",r.ASIA="AS",r.NORTH_AMERICA="NA",r.EUROPE="EU",r.JAPAN="JP",r.INDIA="IN",r.KOREA="KR",r.HKMC="HK",r.US="US",r.OCEANIA="OC",r.SOUTH_AMERICA="SA",r.AFRICA="AF",r.OVERSEA="OVERSEA",r.GLOBAL="GLOBAL",r.EXTENSIONS="GLOBAL"})(Eg||(Eg={}));const AO={CHINA:{},ASIA:{CODE:Eg.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Eg.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Eg.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Eg.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Eg.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Eg.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Eg.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Eg.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Eg.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Eg.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Eg.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Eg.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Eg.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};let s0,uV,VE,Fg,SS,IE,Q_,XE,uT,hR,iT,OT,BT,GT,J_,kS,C_,RS,dV,kT,$T,pR;vP&&(AO.CHINA={CODE:Eg.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(r){r.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(s0||(s0={}));class CO extends I_{constructor(i,s){super(),$(this,"onICEConnectionStateChange",void 0),$(this,"onConnectionStateChange",void 0),$(this,"onDTLSTransportStateChange",void 0),$(this,"onDTLSTransportError",void 0),$(this,"onICETransportStateChange",void 0),$(this,"onFirstAudioReceived",void 0),$(this,"onFirstVideoReceived",void 0),$(this,"onFirstAudioDecoded",void 0),$(this,"onFirstVideoDecoded",void 0),$(this,"onFirstVideoDecodedTimeout",void 0),$(this,"onSelectedLocalCandidateChanged",void 0),$(this,"onSelectedRemoteCandidateChanged",void 0),$(this,"establishPromise",void 0)}}(function(r){r.SEND="sendonly",r.RECV="recvonly",r.SENDRECV="sendrecv",r.INACTIVE="inactive"})(uV||(uV={})),function(r){r.VIDEO="video",r.AUDIO="audio"}(VE||(VE={})),function(r){r[r.UDP=0]="UDP",r[r.TCP=1]="TCP",r[r.RELAY=2]="RELAY"}(Fg||(Fg={})),function(r){r[r.FIRST_CONNECTION=0]="FIRST_CONNECTION",r[r.TCP_RESTART=1]="TCP_RESTART",r[r.RELAY_RESTART=2]="RELAY_RESTART",r[r.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",r[r.OLD_RESTART=11]="OLD_RESTART",r[r.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(SS||(SS={})),function(r){r.LocalVideoTrack="videoTrack",r.LocalAudioTrack="audioTrack",r.LocalVideoLowTrack="videoLowTrack"}(IE||(IE={})),function(r){r.New="new",r.Connected="connected",r.Reconnecting="reconnecting",r.Disconnected="disconnected"}(Q_||(Q_={})),function(r){r.StateChange="stateChange",r.IceConnectionStateChange="iceConnectionStateChange",r.RequestMuteLocal="requestMuteLocal",r.RequestUnmuteLocal="requestUnmuteLocal",r.RequestRePublish="requestRePublish",r.RequestReSubscribe="requestReSubscribe",r.RequestUploadStats="requestUploadStats",r.MediaReconnectStart="MediaReconnectStart",r.MediaReconnectEnd="MediaReconnectEnd",r.NeedSignalRTT="NeedSignalRTT",r.RequestRestartICE="RequestRestartIce",r.PeerConnectionStateChange="PeerConnectionStateChange",r.RequestReconnect="RequestReconnect",r.RequestReconnectPC="RequestReconnectPC",r.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",r.P2PLost="P2PLost",r.UpdateVideoEncoder="UpdateVideoEncoder",r.ConnectionTypeChange="ConnectionTypeChange",r.RequestLowStreamParameter="RequestLowStreamParameter",r.QueryClientConnectionState="QueryClientConnectionState"}(XE||(XE={})),function(r){r.ONLINE="ONLINE",r.OFFLINE="OFFLINE"}(uT||(uT={})),function(r){r.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",r.ONLINE="ONLINE",r.OFFLINE="OFFLINE"}(hR||(hR={})),function(r){r.ON_TRACK="on_track",r.ON_NODE="on_node"}(iT||(iT={})),function(r){r.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",r.REQUEST_CONSTRAINTS="request_constraints"}(OT||(OT={})),function(r){r.CONNECTING="CONNECTING",r.RECONNECTING="RECONNECTING",r.CONNECTED="CONNECTED",r.CLOSED="CLOSED"}(BT||(BT={})),function(r){r[r.CONNECT_AP=0]="CONNECT_AP",r[r.AP_CONNECTED=1]="AP_CONNECTED",r[r.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",r[r.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",r[r.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",r[r.CONNECT_WORKER=5]="CONNECT_WORKER",r[r.WORKER_CONNECTED=6]="WORKER_CONNECTED",r[r.CLOSED=7]="CLOSED"}(GT||(GT={})),function(r){r.CONNECTION_STATE_CHANGE="connection-state-change",r.STATE_CHANGE="state-change",r.INSPECT_RESULT="inspect-result",r.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",r.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(J_||(J_={})),function(r){r.NETWORK_ERROR="NETWORK_ERROR",r.SERVER_ERROR="SERVER_ERROR",r.MULTI_IP="MULTI_IP",r.TIMEOUT="TIMEOUT",r.OFFLINE="OFFLINE",r.LEAVE="LEAVE",r.P2P_FAILED="P2P_FAILED",r.FALLBACK="FALLBACK"}(kS||(kS={})),function(r){r.CONNECTED="transmitter:connected",r.RECONNECTING="transmitter:reconnecting",r.WILL_RECONNECT="transmitter:will_reconnect",r.CLOSED="transmitter:closed",r.FAILED="transmitter:failed",r.ON_MESSAGE="transmitter:on_message",r.REQUEST_NEW_URLS="transmitter:request_new_urls",r.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",r.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",r.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",r.FAILBACK="transmitter:failback"}(C_||(C_={})),function(r){r.CAMERA_CHANGED="camera-changed",r.MICROPHONE_CHANGED="microphone-changed",r.PLAYBACK_DEVICE_CHANGED="playback-device-changed",r.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",r.AUTOPLAY_FAILED="autoplay-failed",r.SECURITY_POLICY_VIOLATION="security-policy-violation"}(RS||(RS={})),function(r){r[r.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",r[r.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",r[r.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",r[r.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",r[r.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",r[r.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",r[r.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",r[r.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",r[r.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",r[r.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",r[r.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",r[r.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",r[r.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",r[r.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",r[r.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",r[r.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",r[r.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",r[r.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",r[r.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",r[r.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(dV||(dV={})),function(r){r.CONNECTING="CONNECTING",r.RECONNECTING="RECONNECTING",r.CONNECTED="CONNECTED",r.CLOSED="CLOSED"}(kT||(kT={})),function(r){r.CONNECTION_STATE_CHANGE="connection-state-change",r.STATE_CHANGE="state-change",r.INSPECT_RESULT="inspect-result",r.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",r.REQUEST_NEW_WORKER_URL="request-new-worker-url"}($T||($T={})),function(r){r[r.CONNECT_AP=0]="CONNECT_AP",r[r.AP_CONNECTED=1]="AP_CONNECTED",r[r.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",r[r.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",r[r.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",r[r.CONNECT_WORKER=5]="CONNECT_WORKER",r[r.WORKER_CONNECTED=6]="WORKER_CONNECTED",r[r.CLOSED=7]="CLOSED"}(pR||(pR={}));const dT={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1};function M_(){return dT}let Z_;(function(r){r[r.CHOOSE_SERVER=11]="CHOOSE_SERVER",r[r.CLOUD_PROXY=18]="CLOUD_PROXY",r[r.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",r[r.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(Z_||(Z_={}));var r9=NE,a0=Array.isArray||function(r){return r9(r)=="Array"},i9=_s,lV=a0,o9=XN,s9=aS,a9=Lb("species"),hV=i9.Array,c9=function(r){var i;return lV(r)&&(i=r.constructor,(o9(i)&&(i===hV||lV(i.prototype))||s9(i)&&(i=i[a9])===null)&&(i=void 0)),i===void 0?hV:i},pV=function(r,i){return new(c9(r))(i===0?0:i)},u9=WI,d9=CS,l9=eR,h9=nR,p9=pV,fV=_n([].push),fR=function(r){var i=r==1,s=r==2,l=r==3,p=r==4,_=r==6,b=r==7,P=r==5||_;return function(x,H,B,z){for(var Wt,_r,Di=l9(x),Fi=d9(Di),Gi=u9(H,B),_p=h9(Fi),_f=0,cE=z||p9,RE=i?cE(x,_p):s||b?cE(x,0):void 0;_p>_f;_f++)if((P||_f in Fi)&&(_r=Gi(Wt=Fi[_f],_f,Di),r))if(i)RE[_f]=_r;else if(_r)switch(r){case 3:return!0;case 5:return Wt;case 6:return _f;case 2:fV(RE,Wt)}else switch(r){case 4:return!1;case 7:fV(RE,Wt)}return _?-1:l||p?p:RE}},EV={forEach:fR(0),map:fR(1),filter:fR(2),some:fR(3),every:fR(4),find:fR(5),findIndex:fR(6),filterReject:fR(7)},f9=EV.forEach,_V=SN("forEach")?[].forEach:function(r){return f9(this,r,arguments.length>1?arguments[1]:void 0)};vT({target:"Array",proto:!0,forced:[].forEach!=_V},{forEach:_V});var E9=rR("Array").forEach,_9=oR,m9=DT,g9=ue,v9=E9,VP=Array.prototype,y9={DOMTokenList:!0,NodeList:!0},b9=function(r){var i=r.forEach;return r===VP||g9(VP,r)&&i===VP.forEach||m9(y9,_9(r))?v9:i},T9=eR,mV=kN;vT({target:"Object",stat:!0,forced:f(function(){mV(1)})},{keys:function(r){return mV(T9(r))}});var S9=tR.Object.keys,R9=R1,I9=vT,O9=a0,A9=_n([].reverse),gV=[1,2];I9({target:"Array",proto:!0,forced:String(gV)===String(gV.reverse())},{reverse:function(){return O9(this)&&(this.length=this.length),A9(this)}});var C9=rR("Array").reverse,w9=ue,N9=C9,FP=Array.prototype,D9=function(r){var i=r.reverse;return r===FP||w9(FP,r)&&i===FP.reverse?N9:i},P9=f,k9=$R,L9=Lb("species"),vV=function(r){return k9>=51||!P9(function(){var i=[];return(i.constructor={})[L9]=function(){return{foo:1}},i[r](Boolean).foo!==1})},M9=vT,U9=_s,yV=a0,x9=XN,j9=aS,bV=CN,V9=nR,F9=ZS,B9=TP,G9=Lb,q9=QN,W9=vV("slice"),K9=G9("species"),BP=U9.Array,H9=Math.max;M9({target:"Array",proto:!0,forced:!W9},{slice:function(r,i){var s,l,p,_=F9(this),b=V9(_),P=bV(r,b),x=bV(i===void 0?b:i,b);if(yV(_)&&(s=_.constructor,(x9(s)&&(s===BP||yV(s.prototype))||j9(s)&&(s=s[K9])===null)&&(s=void 0),s===BP||s===void 0))return q9(_,P,x);for(l=new(s===void 0?BP:s)(H9(x-P,0)),p=0;P<x;P++,p++)P in _&&B9(l,p,_[P]);return l.length=p,l}});var Y9=rR("Array").slice,z9=ue,J9=Y9,GP=Array.prototype,X9=function(r){var i=r.slice;return r===GP||z9(GP,r)&&i===GP.slice?J9:i};function iE(r,i,s,l,p){var _,b,P,x={};return b9(_=S9(l)).call(_,function(H){x[H]=l[H]}),x.enumerable=!!x.enumerable,x.configurable=!!x.configurable,("value"in x||x.initializer)&&(x.writable=!0),x=R9(b=D9(P=X9(s).call(s)).call(P)).call(b,function(H,B){return B(r,i,H)||H},x),p&&x.initializer!==void 0&&(x.value=x.initializer?x.initializer.call(p):void 0,x.initializer=void 0),x.initializer===void 0&&(d2(r,i,x),x=null),x}var Q9=rR("Array").keys,$9=oR,Z9=DT,tX=ue,eX=Q9,qP=Array.prototype,nX={DOMTokenList:!0,NodeList:!0},BR=function(r){var i=r.keys;return r===qP||tX(qP,r)&&i===qP.keys||Z9(nX,$9(r))?eX:i};function TV(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function SV(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?TV(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):TV(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}let wO=0,WP=0;function dS(r,i,s,l){return new SE((p,_)=>{i.timeout=i.timeout||kc("HTTP_CONNECT_TIMEOUT"),i.responseType=i.responseType||"json",i.data&&!s?(i.data=JSON.stringify(i.data),wO+=wI(i.data)):s&&(i.data.size?wO+=i.data.size:i.data instanceof FormData?wO+=function(b){let P=0;return/DingTalk/i.test(navigator.userAgent)&&b.realFormData&&(b=b.realFormData),b.forEach(x=>{P+=typeof x=="string"?wI(x):x.size}),P+138}(i.data):wO+=wI(JSON.stringify(i.data))),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json",i.method="POST",i.url=r,jT.request(i).then(b=>{typeof b.data=="string"?WP+=wI(b.data):b.data instanceof ArrayBuffer||b.data instanceof Uint8Array?WP+=b.data.byteLength:WP+=wI(JSON.stringify(b.data)),l&&p({data:b.data,headers:b.headers}),p(b.data)}).catch(b=>{jT.isCancel(b)?_(new _a(_i.OPERATION_ABORTED,"cancel token canceled")):b.code==="ECONNABORTED"?_(new _a(_i.NETWORK_TIMEOUT,b.message)):b.response?_(new _a(_i.NETWORK_RESPONSE_ERROR,b.response.status)):_(new _a(_i.NETWORK_ERROR,b.message))})})}async function rX(r,i){const s=new Blob([i.data],{type:"buffer"});return await dS(r,SV(SV({},i),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const B_=new class extends I_{set networkState(r){_e.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+r),this.emit(hR.NETWORK_STATE_CHANGE,r,this._networkState),r===uT.ONLINE?this.emit(hR.ONLINE):r===uT.OFFLINE&&(this.onlineWaiter=new SE(i=>{this.once(hR.ONLINE,()=>{this.onlineWaiter=void 0,i(uT.ONLINE)})}),this.emit(hR.OFFLINE)),this._networkState=r}get networkState(){return this._networkState}constructor(){super(),$(this,"_moduleName","network-indicator"),$(this,"_networkState",uT.ONLINE),$(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=uT.ONLINE}),window.addEventListener("offline",()=>{this.networkState=uT.OFFLINE})}};let KP=!1;const qT=new class extends I_{constructor(){super(...arguments),$(this,"onAutoplayFailed",void 0),$(this,"onAudioAutoplayFailed",void 0)}};function RV(){if(i_(),!KP){const r=i=>{i.preventDefault(),KP=!1,ZI()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};KP=!0,ZI()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),_e.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),qT.onAutoplayFailed?qT.onAutoplayFailed():qT.onAudioAutoplayFailed?_e.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):_e.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),qT.emit("autoplay-failed")}}function HP(r){return new TextEncoder().encode(r)}const IV=function(r,i){const s=new Uint8Array(r.byteLength+i.byteLength);return s.set(new Uint8Array(r),0),s.set(new Uint8Array(i),r.byteLength),s},iX=async r=>function(i,s){let l="";return new Uint8Array(i).forEach(p=>{l+=p.toString(s).padStart(2,"0")}),l}(await crypto.subtle.digest("SHA-256",HP(r)),16);function OV(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function FE(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?OV(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):OV(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}function PE(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(i,s,l){const p=l.value;if(typeof p=="function"){const _=r.className||i.__className__||(i.constructor.name==="AgoraRTCClient"?"Client":i.constructor.name);l.value=function(){for(var b=arguments.length,P=new Array(b),x=0;x<b;x++)P[x]=arguments[x];let H=P;if(r.argsMap)try{H=r.argsMap(this,...P)}catch(z){_e.warning(z),H=[]}try{JSON.stringify(H)}catch{_e.warning("arguments for method ".concat(_,".").concat(String(s)," not serializable for apiInvoke.")),H=[]}const B=(r.report||AE).reportApiInvoke(this._sessionId||null,{name:"".concat(_,".").concat(String(s)),options:H,tag:S_.TRACER,reportResult:r.reportResult},r.throttleTime);try{const z=p.apply(this,P);return z instanceof SE?z.then(Wt=>(B.onSuccess(r.reportResult&&Wt),Wt)).catch(Wt=>{throw B.onError(Wt),Wt}):(B.onSuccess(r.reportResult&&z),z)}catch(z){throw B.onError(z),z}}}return l}}const AE=new class{constructor(){$(this,"baseInfoMap",new Map),$(this,"proxyServer",void 0),$(this,"clientList",jR),$(this,"eventUploadTimer",void 0),$(this,"setSessionIdTimer",void 0),$(this,"url",void 0),$(this,"backupUrl",void 0),$(this,"_appId",void 0),$(this,"keyEventUploadPendingItems",[]),$(this,"normalEventUploadPendingItems",[]),$(this,"apiInvokeUploadPendingItems",[]),$(this,"apiInvokeCount",0),$(this,"ltsList",[]),$(this,"lastSendNormalEventTime",Date.now()),$(this,"customReportCounterTimer",void 0),$(this,"customReportCount",0),$(this,"extApiInvoke",async r=>{for(const i of r){const s=FE(FE({},i),{},{sid:null,invokeId:++this.apiInvokeCount,tag:S_.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),kc("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),kc("EVENT_REPORT_SEND_INTERVAL"))}adjustSessionStartTime(r){if(!this.baseInfoMap.has(r)&&!this.baseInfoMap.get(r))return void _e.error("adjust session ".concat(r," start time, sid is not exist or info is undefined"));const i=this.baseInfoMap.get(r),s=Date.now(),l=i.startTime;i.startTime=s,_e.debug("rewrite session ".concat(r," startTime: ").concat(s," , ").concat(s-l,"ms")),this.baseInfoMap.set(r,i)}setAppId(r){this._appId=r}reportApiInvoke(r,i,s){i.timeout=i.timeout||6e4,i.reportResult=i.reportResult===void 0||i.reportResult;const l=Date.now();this.apiInvokeCount+=1;const p=this.apiInvokeCount,_=()=>({tag:i.tag,invokeId:p,sid:r,name:i.name,apiInvokeTime:l,options:i.options,states:i.states||null}),b=!!kc("SHOW_REPORT_INVOKER_LOG");b&&_e.info("".concat(i.name," start"),i.options);let P=!1;sT(i.timeout).then(()=>{P||(this.sendApiInvoke(FE(FE({},_()),{},{error:_i.API_INVOKE_TIMEOUT,success:!1})),_e.debug("".concat(i.name," timeout")))});const x=new _a(_i.UNEXPECTED_ERROR,"".concat(i.name,": this api invoke is end"));return{onSuccess:H=>{const B=()=>{if(P)throw x;return P=!0,this.sendApiInvoke(FE(FE({},_()),{},{success:!0},i.reportResult&&{result:H})),b&&_e.info("".concat(i.name," onSuccess")),H};return s?GF(B,i.name+"Success",s,()=>P=!0):B()},onError:H=>{const B=()=>{if(P)throw H;P=!0,this.sendApiInvoke(FE(FE({},_()),{},{success:!1,error:H})),b&&_e.info("".concat(i.name," onFailure"),H.toString())};return s?GF(B,i.name+"Error",s,()=>P=!0):B()}}}sessionInit(r,i){if(this.baseInfoMap.has(r))return;const s=Date.now(),l=this.createBaseInfo(r,s);l.cname=i.cname;const p=Object.assign({},{willUploadConsoleLog:kc("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:vP?"global":"oversea",areas:kc("AREAS")&&kc("AREAS").join(",")},i.extend),_=Date.now(),b=FE(FE({},l),{},{eventType:_g.SESSION_INIT,appid:i.appid,browser:navigator.userAgent,build:gP,lts:_,elapse:_-s,extend:JSON.stringify(p),mode:i.mode,process:kc("PROCESS_ID"),appType:kc("APP_TYPE"),success:!0,version:QT});this.send({type:O_.SESSION,data:b},!0)}joinChooseServer(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const l=s.info,p=Date.now(),_=FE(FE({},l),{},{eventType:_g.JOIN_CHOOSE_SERVER,lts:p,eventElapse:p-i.lts,chooseServerAddr:i.csAddr,errorCode:i.ec,elapse:p-s.startTime,success:i.succ,chooseServerAddrList:JSON.stringify(i.serverList),uid:i.uid?parseInt(i.uid):null,cid:i.cid?parseInt(i.cid):null,chooseServerIp:i.csIp||"",opid:i.opid,unilbsServerIds:i.unilbsServerIds,extend:i.extend||void 0,isHttp3:i.isHttp3});this.send({type:O_.JOIN_CHOOSE_SERVER,data:_},!0)}reqUserAccount(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const l=s.info,p=Date.now(),_=FE(FE({},l),{},{eventType:_g.REQ_USER_ACCOUNT,lts:p,success:i.success,serverAddress:i.serverAddr,stringUid:i.stringUid,uid:i.uid,errorCode:i.errorCode,elapse:p-s.startTime,eventElapse:p-i.lts,extend:JSON.stringify(i.extend)});this.send({type:O_.REQ_USER_ACCOUNT,data:_},!0)}joinGateway(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const l=s.info;i.vid&&(l.vid=i.vid),l.uid=i.uid,l.cid=i.cid;const p=Date.now(),{firstSuccess:_,avoidJoinStartTime:b,isProxy:P,addr:x}=i,H=p-(_&&b?b:s.startTime),B=FE(FE({},l),{},{eventType:_g.JOIN_GATEWAY,lts:p,gatewayAddr:i.addr,success:i.succ,errorCode:i.ec,elapse:H,eventElapse:p-i.lts,firstSuccess:_,signalChannel:i.signalChannel}),z=B.success?1:0;if(i.succ&&(s.lastJoinSuccessTime=p),_)this.send({type:O_.JOIN_GATEWAY,data:B},!0);else{let Wt;if(x)if(P){const Di=x.match(/h=(\d{1,3}-){3}\d{1,3}/g),Fi=x.match(/p=[0-9]{1,6}/g);Wt={isSuccess:z,gatewayIp:Di&&Di.length?Di[0].split("=")[1].replace(/-/g,"."):"",port:Fi&&Fi.length?Fi[0].split("=")[1]:"",isProxy:P?1:0}}else{const Di=x.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),Fi=x.match(/:[0-9]{1,6}/g);Wt={isSuccess:z,gatewayIp:Di&&Di.length?Di[0].split("//")[1].replace(/-/g,"."):"",port:Fi&&Fi.length?Fi[0].split(":")[1]:"",isProxy:P?1:0}}else Wt={isSuccess:z,gatewayIp:"",port:"",isProxy:P?1:0};delete B.success,delete B.eventType,delete B.firstSuccess,B.vid=Number(B.vid);const _r=Object.assign({},B,Wt,{eventType:_g.REJOIN_GATEWAY});this.send({type:O_.RE_JOIN_GATEWAY,data:_r},!0)}}joinChannelTimeout(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const l=Date.now(),p=FE(FE({},s.info),{},{lts:l,timeout:i,elapse:l-s.startTime});this.send({type:O_.JOIN_CHANNEL_TIMEOUT,data:p},!0)}publish(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const l=s.info,p=Date.now(),_=FE(FE({},l),{},{eventType:_g.PUBLISH,lts:p,eventElapse:i.eventElapse,elapse:p-s.startTime,success:i.succ,errorCode:i.ec,videoName:i.videoName,audioName:i.audioName,screenName:i.screenName,screenshare:i.screenshare,audio:i.audio,video:i.video,p2pid:i.p2pid,publishRequestid:i.publishRequestid});this.send({type:O_.PUBLISH,data:_},!0)}subscribe(r,i,s){const l=this.baseInfoMap.get(r);if(!l)return;const p=l.info,_=Date.now(),b=FE(FE({},p),{},{eventType:_g.SUBSCRIBE,lts:_,eventElapse:i.eventElapse,elapse:_-l.startTime,success:i.succ,errorCode:i.ec,video:i.video,audio:i.audio,subscribeRequestid:i.subscribeRequestid,p2pid:i.p2pid},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof i.peerid=="string"?b.peerSuid=i.peerid:b.peer=i.peerid,this.send({type:O_.SUBSCRIBE,data:b},!0)}wsCompressorInit(r){var i;const s=[...BR(i=this.baseInfoMap).call(i)],l=s.length?s[0]:"UnableToGetSid",p=this.baseInfoMap.get(l);if(!p)return;const _=p.info,b=Date.now(),P=FE(FE({},_),{},{eventType:_g.WS_COMPRESSOR_INIT,lts:b,eventElapse:r.eventElapse,elapse:b-p.startTime,status:r.status?1:2});this.send({type:O_.WS_COMPRESSOR_INIT,data:P},!0)}firstRemoteVideoDecode(r,i,s,l){const p=this.baseInfoMap.get(r);if(!p)return;const _=p.info,b=Date.now(),P=FE(FE(FE({},_),l),{},{elapse:b-p.startTime,eventType:i,lts:b,firstDecodeFrame:Math.max(b-p.startTime,0),apEnd:Math.max(l.apEnd-p.startTime,0),apStart:Math.max(l.apStart-p.startTime,0),joinGwEnd:Math.max(l.joinGwEnd-p.startTime,0),joinGwStart:Math.max(l.joinGwStart-p.startTime,0),pcEnd:Math.max(l.pcEnd-p.startTime,0),pcStart:Math.max(l.pcStart-p.startTime,0),subscriberEnd:Math.max(l.subscriberEnd-p.startTime,0),subscriberStart:Math.max(l.subscriberStart-p.startTime,0),videoAddNotify:Math.max(l.videoAddNotify-p.startTime,0)});this.send({type:s,data:P},!0)}firstRemoteFrame(r,i,s,l){const p=this.baseInfoMap.get(r);if(!p)return;const _=p.info,b=Date.now(),P=FE(FE(FE({},_),l),{},{elapse:b-p.startTime,eventType:i,lts:b});this.send({type:s,data:P},!0)}pcStats(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const l=s.info,p=Date.now(),_=FE(FE(FE({},l),i),{},{vid:l.vid===void 0?0:Number(l.vid),elapse:p-s.startTime,eventType:_g.PC_STATS,lts:p});this.send({type:O_.PC_STATS,data:_},!0)}onGatewayStream(r,i,s,l){const p=this.baseInfoMap.get(r);if(!p)return;const _=p.info,b=Date.now(),P=FE(FE(FE({},_),l),{},{eventType:i,lts:b});this.send({type:s,data:P},!0)}streamSwitch(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const l=s.info,p=Date.now(),_=FE(FE({},l),{},{eventType:_g.STREAM_SWITCH,lts:p,isDual:i.isdual,elapse:p-s.startTime,success:i.succ});this.send({type:O_.STREAM_SWITCH,data:_},!0)}requestProxyAppCenter(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const l=s.info,p=Date.now(),_=FE(FE({},l),{},{eventType:_g.REQUEST_PROXY_APPCENTER,lts:p,eventElapse:p-i.lts,elapse:p-s.startTime,APAddr:i.APAddr,workerManagerList:i.workerManagerList,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:O_.REQUEST_PROXY_APPCENTER,data:_},!0)}requestProxyWorkerManager(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const l=s.info,p=Date.now(),_=FE(FE({},l),{},{eventType:_g.REQUEST_PROXY_WORKER_MANAGER,lts:p,eventElapse:p-i.lts,elapse:p-s.startTime,workerManagerAddr:i.workerManagerAddr,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:O_.REQUEST_PROXY_WORKER_MANAGER,data:_},!0)}setProxyServer(r){this.proxyServer=r,r?_e.debug("reportProxyServerurl: ".concat(r)):_e.debug("disable reportProxyServerurl: ".concat(r))}peerPublishStatus(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const l=s.info,p=Date.now(),_=FE(FE({},l),{},{subscribeElapse:i.subscribeElapse,peer:i.peer,peerPublishDuration:Math.max(i.audioPublishDuration,i.videoPublishDuration),audiotag:i.audioPublishDuration>0?1:-1,videotag:i.videoPublishDuration>0?1:-1,lts:p,elapse:p-s.startTime,joinChannelSuccessElapse:p-(s.lastJoinSuccessTime||p),peerPublishDurationVideo:i.videoPublishDuration,peerPublishDurationAudio:i.audioPublishDuration});this.send({type:O_.PEER_PUBLISH_STATUS,data:_},!0)}workerEvent(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const l=s.info,p=Date.now();(function(_,b,P){const x=_[b];if(!x||typeof x!="string")return[_];_[b]="";const H=wI(JSON.stringify(_));let B=0;const z=[];let Wt=0;for(let _r=0;_r<x.length;_r++)Wt+=x.charCodeAt(_r)<=127?1:3,Wt<=P-H||(z[z.length]=WR(WR({},_),{},{[b]:x.substring(B,_r)}),B=_r,Wt=x.charCodeAt(_r)<=127?1:3);return B!==x.length-1&&(z[z.length]=WR(WR({},_),{},{[b]:x.substring(B)})),z})(FE(FE(FE({},l),i),{},{elapse:p-s.startTime,lts:p,productType:"WebRTC"}),"payload",1300).forEach(_=>this.send({type:O_.WORKER_EVENT,data:_},!0))}apworkerEvent(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const l=s.info,p=Date.now(),_=FE(FE(FE({},l),i),{},{elapse:p-s.startTime,lts:p});this.send({type:O_.AP_WORKER_EVENT,data:_},!0)}joinWebProxyAP(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const l=s.info,p=Date.now(),_=FE(FE(FE({},l),i),{},{elapse:p-s.startTime,lts:p,extend:i.extend||void 0});this.send({type:O_.JOIN_WEB_PROXY_AP,data:_},!0)}WebSocketQuit(r,i){const s=this.baseInfoMap.get(r);if(!s)return;const l=s.info,p=Date.now(),_=FE(FE(FE({},l),i),{},{elapse:p-s.startTime,lts:p});this.send({type:O_.WEBSOCKET_QUIT,data:_},!0)}async sendCustomReportMessage(r,i){if(this.customReportCount+=i.length,this.customReportCount>kc("CUSTOM_REPORT_LIMIT"))throw new _a(_i.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),l=i.map(p=>({type:O_.USER_ANALYTICS,data:FE(FE({sid:r},p),{},{lts:s})}));try{kc("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(l):await this.postDataToStatsCollector(l)}catch(p){throw _e.error("send custom report message failed",p.toString()),new _a(_i.CUSTOM_REPORT_SEND_FAILED,p.message)}}autoplayFailed(r,i,s,l){if(!r)return;const p=this.baseInfoMap.get(r);if(!p)return;const _=p.info,b=Date.now(),P=FE(FE({},_),{},{vid:_.vid===void 0?0:Number(_.vid),lts:b,elapse:b-p.startTime,cbRegistered:qT.onAutoplayFailed||qT.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:i,trackId:l,extend:void 0});this.send({type:O_.AUTOPLAY_FAILED,data:P},!0)}sendApiInvoke(r){const i=kc("NOT_REPORT_EVENT");if(r.tag&&i.includes&&i.includes(r.tag))return!1;if(r.sid===null)return this.apiInvokeUploadPendingItems.push(r),!1;const s=this.baseInfoMap.get(r.sid);if(!s)return this.apiInvokeUploadPendingItems.push(r),!1;const{cname:l,uid:p,cid:_}=s.info;r.lts=r.lts||Date.now();let b;if(r.error)if(r.error instanceof _a){const{code:x,message:H}=r.error;b=x||H||r.error.toString()}else b=r.error.toString();const P={invokeId:r.invokeId,sid:r.sid,cname:l,cid:_,uid:p,lts:r.lts,success:r.success,elapse:r.lts-s.startTime,execElapse:r.lts-r.apiInvokeTime,apiName:r.name,options:r.options?JSON.stringify(r.options):void 0,execStates:r.states?JSON.stringify(r.states):void 0,execResult:r.result?JSON.stringify(r.result):void 0,errorCode:r.error?b:void 0,errorMsg:r.error?JSON.stringify(r.error):void 0};return this.send({type:O_.API_INVOKE,data:P},!1),!0}appendSessionId(){this.clientList.forEach(r=>{if(r._sessionId){const i=this.apiInvokeUploadPendingItems.length;for(let s=0;s<i;s++){const l=this.apiInvokeUploadPendingItems.shift();l&&(l.sid=r._sessionId,this.sendApiInvoke(Object.assign({},l)))}}})}send(r,i){if(i)return this.keyEventUploadPendingItems.push(r),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(r),this.normalEventUploadPendingItems.length>kc("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(r,i){const s=[],l=[];for(;r.length;){const _=r.shift();s.length<20?s.push(_):l.push(_)}r.push(...l);for(const _ of[...s]){var p;this.ltsList.indexOf(_.data.lts)!==-1?(_.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(_.data.lts)):(this.ltsList.push(_.data.lts),OP(p=this.ltsList).call(p,(b,P)=>b-P))}return i||(this.lastSendNormalEventTime=Date.now()),kc("ENABLE_EVENT_REPORT")&&s.length&&(kc("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((_=>b=>{kc("EVENT_REPORT_RETRY")&&(i?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(_):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(_),this.normalEventUploadPendingItems.length>kc("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-kc("NORMAL_EVENT_QUEUE_CAPACITY")),_e.warning("report: drop normal events"))))})(s)),r}async postDataToStatsCollector2(r){B_.networkState===uT.OFFLINE&&await SE.race([B_.onlineWaiter,sT(2*j_.maxRetryTimeout)]);const i=p=>{let _=new Uint8Array;return p.forEach(b=>{const P=HP(JSON.stringify(b.data)),x=new ArrayBuffer(5),H=(z=>{let Wt=0;return Object.entries(O_).forEach(_r=>{let[Di,Fi]=_r;Fi===z.type&&(Wt=DP[Di])}),Wt})(b),B=new DataView(x);B.setUint16(0,P.byteLength,!0),B.setUint8(2,255&H),B.setUint8(3,H>>>8&255),B.setUint8(4,H>>>16&255),_=IV(_,new Uint8Array(x)),_=IV(_,P)}),_},s="event";let l=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(kc("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(kc("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let p=0;p<2;p+=1){p===1&&(l=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(kc("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(kc("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await dS(l,{timeout:1e4,data:i(r),headers:FE(FE({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(_){if(p===1)throw _;continue}return}}async postDataToStatsCollector(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:r.map(_=>JSON.stringify(_)),vid:(_=>{const b=_&&_.data.sid&&this.baseInfoMap.get(_.data.sid);return b&&b.info.vid&&+b.info.vid||0})(r[0])};B_.networkState===uT.OFFLINE&&await SE.race([B_.onlineWaiter,sT(2*j_.maxRetryTimeout)]);const l=i?"/events/proto-raws":"/events/messages";let p=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(kc("EVENT_REPORT_DOMAIN"),"&p=").concat(kc("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat(kc("EVENT_REPORT_DOMAIN"),":").concat(kc("STATS_COLLECTOR_PORT")).concat(l));for(let _=0;_<2;_+=1){_===1&&(p=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(kc("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(kc("STATS_COLLECTOR_PORT"),"&d=").concat(l):"https://".concat(kc("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(kc("STATS_COLLECTOR_PORT")).concat(l)));try{i?await rX(p,{timeout:1e4,data:s}):await dS(p,{timeout:1e4,data:s})}catch(b){if(_===1)throw b;continue}return}}createBaseInfo(r,i){const s=Object.assign({},X7);return s.sid=r,this.baseInfoMap.set(r,{info:s,startTime:i}),s}reportResourceTiming(r,i){const s=performance.getEntriesByName(r),l=s[s.length-1];l&&this.reportApiInvoke(i,{name:"Client.resourceTiming",options:l,tag:S_.TRACER}).onSuccess()}};TO.on("REPORT_LOG_UPLOAD",r=>{r.networkState=B_.networkState,AE.reportApiInvoke(null,{name:"logUploadError",options:r,tag:S_.TRACER})});class AV extends I_{constructor(i,s){super(),$(this,"trackMediaType",void 0),$(this,"_ID",void 0),$(this,"_rtpTransceiver",void 0),$(this,"_lowRtpTransceiver",void 0),$(this,"_hints",[]),$(this,"_isClosed",!1),$(this,"_originMediaStreamTrack",void 0),$(this,"_mediaStreamTrack",void 0),$(this,"_external",{}),this._ID=s||b_(8,"track-"),this._originMediaStreamTrack=i,this._mediaStreamTrack=i,function(l){n0.includes(l)||n0.push(l)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(i){if(!i){const s=AE.reportApiInvoke(null,{name:V_.GET_MEDIA_STREAM_TRACK,options:[],tag:S_.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?s.onSuccess(this._mediaStreamTrack.label):s.onSuccess("")}return this._mediaStreamTrack}getRTCRtpTransceiver(i){return i===TI.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(i){const s=n0.indexOf(i);s!==-1&&n0.splice(s,1)}(this),this.emit(lR.CLOSED)}_updateRtpTransceiver(i,s){if(s===TI.LOW_STREAM){if(this._lowRtpTransceiver===i)return;this._lowRtpTransceiver=i}else{if(this._rtpTransceiver===i)return;this._rtpTransceiver=i}this.emit(o0.TRANSCEIVER_UPDATED,i,s)}}let _m,oX=1;class mT{constructor(i){$(this,"lockingPromise",SE.resolve()),$(this,"locks",0),$(this,"name",""),$(this,"lockId",void 0),this.lockId=oX++,i&&(this.name=i),_e.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(i){let s;this.locks+=1,_e.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof i=="string"?i:""));const l=new SE(_=>{s=()=>{this.locks-=1,_e.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof i=="string"?i:"")),_()}}),p=this.lockingPromise.then(()=>s);return this.lockingPromise=this.lockingPromise.then(()=>l),p}}function RI(r,i){return function(s,l,p){const _=p.value;if(typeof _!="function")throw new Error("Cannot use mutex on object property.");return p.value=async function(){const b=this[i];if(!b)throw new Error("mutex property key ".concat(i," doesn't exist on ").concat(r));const P=await b.lock("From ".concat(r,".").concat(l));try{for(var x=arguments.length,H=new Array(x),B=0;B<x;B++)H[B]=arguments[B];return await _.apply(this,H)}finally{P()}},p}}class YP extends AV{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}constructor(i,s){super(i,s),$(this,"_enabled",!0),$(this,"_muted",!1),$(this,"_isExternalTrack",!1),$(this,"_isClosed",!1),$(this,"_enabledMutex",void 0),$(this,"processor",void 0),$(this,"_processorContext",void 0),$(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new mT("".concat(this.getTrackId())),i.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var i,s;return(i=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&i!==void 0?i:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,_e.debug("[".concat(this.getTrackId(),"] close")),this.emit(ME.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(i,s){let l=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=l,i!==this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop(),i.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=i,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await N_(this,ME.NEED_REPLACE_TRACK,this),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){_e.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(lR.TRACK_ENDED)}stateCheck(i,s){if(_e.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(i,": ").concat(s,"]")),vI(s,i),this._enabled&&this._muted&&i==="enabled"&&s===!1)throw new _a(_i.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&i==="muted"&&s===!0)throw new _a(_i.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function CV(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}(function(r){r.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",r.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",r.IOS_INTERRUPTION_START="ios-interruption-start",r.IOS_INTERRUPTION_END="ios-interruption-end",r.STATE_CHANGE="state-change"})(_m||(_m={}));const wV=window.AudioContext||window.webkitAudioContext;let WT=null;const s_=new class extends I_{constructor(){super(...arguments),$(this,"prevState",void 0),$(this,"curState",void 0),$(this,"currentTime",void 0),$(this,"currentTimeStuckAt",void 0),$(this,"interruptDetectorTrack",void 0),$(this,"onLocalAudioTrackMute",()=>{_e.info("ios15-interruption-start"),this.emit(_m.IOS_15_16_INTERRUPTION_START)}),$(this,"onLocalAudioTrackUnmute",async()=>{_e.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?_e.info("ios15-interruption-end-canceled"):(WT&&await WT.suspend(),this.emit(_m.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(r){_e.debug("webaudio bindInterruptDetectorTrack ".concat(r.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=r,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(r){_e.debug("webaudio unbindInterruptDetectorTrack ".concat(r.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===r&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function sX(){if(!wV)return void _e.error("your browser is not support web audio");_e.info("create audio context");const r=function(i){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?CV(Object(l),!0).forEach(function(p){$(i,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(l)):CV(Object(l)).forEach(function(p){Object.defineProperty(i,p,Object.getOwnPropertyDescriptor(l,p))})}return i}({},kc("WEBAUDIO_INIT_OPTIONS"));_e.debug("audio context init option:",JSON.stringify(r)),WT=new wV(r),s_.curState=WT.state,WT.onstatechange=()=>{s_.prevState=s_.curState,s_.curState=WT?WT.state:void 0;const{prevState:i,curState:s}=s_,l=s==="running",p=s==="interrupted",_=i==="running",b=i==="suspended",P=i==="interrupted",x=i_().osVersion;(fT()||PS())&&_&&p&&(_e.info("ios".concat(x,"-interruption-start")),s_.emit(_m.IOS_INTERRUPTION_START)),(fT()||PS())&&(b||P)&&l&&(_e.info("ios".concat(x,"-interruption-end")),s_.emit(_m.IOS_INTERRUPTION_END)),i!==s&&(_e.debug("AudioContext State Change","".concat(i,"=>").concat(s)),s_.emit(_m.STATE_CHANGE))},setInterval(()=>{var i;const s=(i=WT)===null||i===void 0?void 0:i.currentTime;s_.currentTime!==s?(s_.currentTimeStuckAt&&(_e.debug("AudioContext current time resume at ".concat(s)),s_.currentTimeStuckAt=void 0),s_.currentTime=s):(s!==s_.currentTimeStuckAt&&(AE.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:S_.TRACER}).onSuccess(),_e.warning("AudioContext current time stuck at ".concat(s))),s_.currentTimeStuckAt=s)},5e3),async function(i){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let l,p=!1,_=!1,b=!1;function P(Gi){i.state==="running"?x(!1):fT()||PS()?i.state==="suspended"&&(x(!0),Gi&&i.resume().then(B,B)):i.state!=="closed"&&(x(!0),Gi&&i.resume().then(B,B))}function x(Gi){if(p!==Gi){p=Gi;for(let _p=0,_f=s;_p<_f.length;_p+=1){const cE=_f[_p];Gi?window.addEventListener(cE,z,{capture:!0,passive:!0}):window.removeEventListener(cE,z,{capture:!0,passive:!0})}}}function H(){P(!0)}function B(){P(!1)}function z(){P(!0)}function Wt(Gi){if(!b)if(l.paused)if(Gi){_r(!1),b=!0;let _p;try{_p=l.play(),_p?_p.then(Di,Di):(l.addEventListener("playing",Di),l.addEventListener("abort",Di),l.addEventListener("error",Di))}catch{Di()}}else _r(!0);else _r(!1)}function _r(Gi){if(_!==Gi){_=Gi;for(let _p=0,_f=s;_p<_f.length;_p++){const cE=_f[_p];Gi?window.addEventListener(cE,Fi,{capture:!0,passive:!0}):window.removeEventListener(cE,Fi,{capture:!0,passive:!0})}}}function Di(){l.removeEventListener("playing",Di),l.removeEventListener("abort",Di),l.removeEventListener("error",Di),b=!1,Wt(!1)}function Fi(){Wt(!0)}if(fT()){const Gi=i.createMediaStreamDestination(),_p=document.createElement("div");_p.innerHTML="<audio x-webkit-airplay='deny'></audio>",l=_p.children.item(0),l.controls=!1,l.disableRemotePlayback=!0,l.preload="auto",l.srcObject=Gi.stream,Wt(!0)}s_.on(_m.STATE_CHANGE,H),P(!1)}(WT)}function II(){if(!WT){if(sX(),!WT)throw new _a(_i.NOT_SUPPORTED,"can not create audio context");return WT}return WT}function NV(){return!!WT}function GR(r){if(function(){if(zP!==null)return zP;const l=II(),p=l.createBufferSource(),_=l.createGain(),b=l.createGain();p.connect(_),p.connect(b),p.disconnect(_);let P=!1;try{p.disconnect(_)}catch{P=!0}return p.disconnect(),zP=P,P}())return;const i=r.connect,s=r.disconnect;r.connect=(l,p,_)=>(r._inputNodes||(r._inputNodes=[]),r._inputNodes.includes(l)||(l instanceof AudioNode?(r._inputNodes.push(l),i.call(r,l,p,_)):i.call(r,l,p)),r),r.disconnect=(l,p,_)=>{s.call(r),l?nL(r._inputNodes,l):r._inputNodes=[];for(const b of r._inputNodes)i.call(r,b)}}let zP=null;function DV(r,i){let s=!1;const l=1/i;if(kc("DISABLE_WEBAUDIO")){const p=window.setInterval(()=>{s?window.clearInterval(p):r(performance.now()/1e3)},1e3*l)}else{const p=II();let _=p.createGain();_.gain.value=0,_.connect(p.destination);const b=()=>{if(s)return void(_=null);const P=p.createOscillator();P.onended=b,P.connect(_),P.start(0),P.stop(p.currentTime+l),r(p.currentTime)};b()}return()=>{s=!0}}class PV{constructor(){$(this,"context",void 0),$(this,"analyserNode",void 0),$(this,"sourceNode",void 0),this.context=II(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(i){if(i!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=i,i==null||i.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||fT()||PS()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const i=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(i);else{const l=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(l);for(let p=0;p<i.length;++p)i[p]=l[p]/128-1}const s=iR(i).call(i,(l,p)=>l+p*p,0)/i.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var i,s;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{_e.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class kV extends I_{get processSourceNode(){return this.sourceNode}set processedNode(i){var s;if(!this.isDestroyed&&this._processedNode!==i){try{var l;(l=this.sourceNode)===null||l===void 0||l.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=i,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),$(this,"outputNode",void 0),$(this,"outputTrack",void 0),$(this,"isPlayed",!1),$(this,"sourceNode",void 0),$(this,"context",void 0),$(this,"audioBufferNode",void 0),$(this,"destNode",void 0),$(this,"audioOutputLevel",0),$(this,"volumeLevelAnalyser",void 0),$(this,"_processedNode",void 0),$(this,"playNode",void 0),$(this,"isDestroyed",!1),$(this,"onNoAudioInput",void 0),$(this,"isNoAudioInput",!1),$(this,"_noAudioInputCount",0),this.context=II(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),GR(this.outputNode),this.volumeLevelAnalyser=new PV}startGetAudioBuffer(i){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(i),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(IT.ON_AUDIO_BUFFER,function(l){for(let p=0;p<l.outputBuffer.numberOfChannels;p+=1){const _=l.outputBuffer.getChannelData(p);for(let b=0;b<_.length;b+=1)_[b]=0}return l.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!M_().webAudioMediaStreamDest)throw new _a(_i.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(i){this.context.state!=="running"&&IS(()=>{s_.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=i||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(i>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;fT()||PS()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let l;s.getFloatTimeDomainData?(l=new Float32Array(s.fftSize),s.getFloatTimeDomainData(l)):(l=new Uint8Array(s.fftSize),s.getByteTimeDomainData(l));let p=!1;for(let _=0;_<l.length;_++)l[_]!==0&&(p=!0);return p?(this.isNoAudioInput=!1,!0):(await sT(200),await this.checkHasAudioInput(i?i+1:1)&&p)}getAudioVolume(){return this.outputNode.gain.value}setVolume(i){this.outputNode.gain.setValueAtTime(i,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var i,s;(i=this.processedNode)===null||i===void 0||i.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var i;this.processedNode?(i=this.processedNode)===null||i===void 0||i.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class JP extends kV{get isFreeze(){return!1}constructor(i,s,l){var p;if(super(),$(this,"sourceNode",void 0),$(this,"track",void 0),$(this,"clonedTrack",void 0),$(this,"audioElement",void 0),$(this,"isCurrentTrackCloned",!1),$(this,"isRemoteTrack",!1),$(this,"originVolumeLevelAnalyser",void 0),$(this,"rebuildWebAudio",async()=>{if(_e.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void _e.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>_e.info("resume success")),_e.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const P=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?P.stop():this.isCurrentTrackCloned=!0;const x=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(x),GR(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const H=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(H,this.context.currentTime),GR(this.outputNode),this.emit(IT.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=x,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),i.kind!=="audio")throw new _a(_i.UNEXPECTED_ERROR);this.track=i;const _=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(_),GR(this.sourceNode),l){const P=l.clone();P.enabled=!0,this.clonedTrack=P,_e.debug("create an unmuted track ".concat(P.id," from the original track ").concat(l.id," to get the volume"));const x=this.context.createMediaStreamSource(new MediaStream([P]));GR(x),this.originVolumeLevelAnalyser=new PV,this.originVolumeLevelAnalyser.updateSource(x)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=_;const b=i_();s&&b.os===Mb.IOS&&Number((p=b.osVersion)===null||p===void 0?void 0:p.split(".")[0])<15&&(s_.on(_m.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(P=>{P||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(i){this.sourceNode.disconnect(),this.track=i,this.isCurrentTrackCloned=!1;const s=new MediaStream([i]);this.sourceNode=this.context.createMediaStreamSource(s),GR(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(IT.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var i;this.audioElement.srcObject=null,this.audioElement.remove(),s_.off("state-change",this.rebuildWebAudio),(i=this.originVolumeLevelAnalyser)===null||i===void 0||i.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(i){return this.context.createMediaStreamSource(new MediaStream([i]))}updateOriginTrack(i){const s=i.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),_e.debug("create an unmuted track ".concat(s.id," from the original track ").concat(i.id," to get the volume"));const l=this.context.createMediaStreamSource(new MediaStream([s]));GR(l),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(l)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function LV(r,i){const s=(p,_)=>p?typeof p!="number"?p.max||p.exact||p.ideal||p.min||_:p:_,l={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxHeight:s(i.height,1080),maxWidth:s(i.width,1920)}}};return i.frameRate&&typeof i.frameRate!="number"?(l.video.mandatory.maxFrameRate=i.frameRate.max,l.video.mandatory.minFrameRate=i.frameRate.min):typeof i.frameRate=="number"&&(l.video.mandatory.maxFrameRate=i.frameRate),await navigator.mediaDevices.getUserMedia(l)}async function aX(r){const i=await MV(r.mediaSource),s=await function(l){return new SE((p,_)=>{const b=document.createElement("div");b.innerText="share screen",b.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const P=document.createElement("div");P.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const x=document.createElement("div");x.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",x.setAttribute("style","height: 12%;");const H=document.createElement("div");H.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const B=document.createElement("div");B.setAttribute("style","text-align: right; padding: 16px 0;");const z=document.createElement("button");z.innerHTML="cancel",z.setAttribute("style","width: 85px;"),z.onclick=()=>{document.body.removeChild(Wt);const _r=new Error("NotAllowedError");_r.name="NotAllowedError",_(_r)},B.appendChild(z),P.appendChild(x),P.appendChild(H),P.appendChild(B);const Wt=document.createElement("div");Wt.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),Wt.appendChild(b),Wt.appendChild(P),document.body.appendChild(Wt),l.map(_r=>{if(_r.id){const Di=document.createElement("div");Di.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Fi=_r.thumbnail;const{width:Gi}=Fi.getSize();Gi>1920&&(Fi=Fi.resize({width:1920})),Di.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Fi.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(_r.name.replace(/[\u00A0-\u9999<>\&]/g,function(_p){return"&#"+_p.charCodeAt(0)+";"})+"</span>"),Di.onclick=()=>{document.body.removeChild(Wt),p(_r.id)},H.appendChild(Di)}})})}(i);return await LV(s,r)}async function MV(r){let i=["window","screen"];r!=="application"&&r!=="window"||(i=["window"]),r==="screen"&&(i=["screen"]);const s=UV();if(!s)throw new _a(_i.ELECTRON_IS_NULL);let l=null;try{var p;l=((p=s.desktopCapturer)===null||p===void 0?void 0:p.getSources({types:i}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:i})}catch{l=null}l&&l.then||(l=new SE((_,b)=>{s.desktopCapturer.getSources({types:i},(P,x)=>{P?b(P):_(x)})}));try{return await l}catch(_){throw new _a(_i.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,_.toString())}}let NO=null;function UV(){if(NO)return NO;try{return NO=window.require("electron"),NO}catch{return null}}function xV(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}const XP=new mT("safari");let jV=!1,VV=!1;async function lS(r,i){let s=0,l=null;for(;s<2;)try{l=await cX(r,i,s>0);break}catch(p){if(p instanceof _a)throw _e.error("[".concat(i,"] ").concat(p.toString())),p;const _=DO(p.name||p.code||p,p.message);if(_.code===_i.MEDIA_OPTION_INVALID){_e.debug("[".concat(i,"] detect media option invalid, retry")),s+=1,await sT(500);continue}throw _e.error("[".concat(i,"] ").concat(_.toString())),_}if(!l)throw new _a(_i.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return l}async function cX(r,i,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new _a(_i.NOT_SUPPORTED,"can not find getUserMedia");s&&(r.video&&(delete r.video.width,delete r.video.height),r.screen&&(delete r.screen.width,delete r.screen.height));const l=M_(),p=new MediaStream;if(r.audioSource&&p.addTrack(r.audioSource),r.videoSource&&p.addTrack(r.videoSource),!r.audio&&!r.video&&!r.screen)return _e.debug("Using Video Source/ Audio Source"),p;if(r.screen)if(UV())r.screen.sourceId?OI(p,await LV(r.screen.sourceId,r.screen)):OI(p,await aX(r.screen));else if($D()&&r.screen.extensionId&&r.screen.mandatory){if(!l.getStreamFromExtension)throw new _a(_i.NOT_SUPPORTED,"This browser does not support screen sharing");_e.debug("[".concat(i,'] Screen access on chrome stable, looking for extension"'));const Wt=await(b=r.screen.extensionId,P=i,new SE((_r,Di)=>{try{chrome.runtime.sendMessage(b,{getStream:!0},Fi=>{if(!Fi||!Fi.streamId)return _e.error("[".concat(P,"] No response from Chrome Plugin. Plugin not installed properly"),Fi),void Di(new _a(_i.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));_r(Fi.streamId)})}catch(Fi){_e.error("[".concat(P,"] AgoraRTC screensharing plugin is not accessible(").concat(b,")"),Fi.toString()),Di(new _a(_i.CHROME_PLUGIN_NOT_INSTALL))}}));r.screen.mandatory.chromeMediaSourceId=Wt,OI(p,await navigator.mediaDevices.getUserMedia({video:{mandatory:r.screen.mandatory}}))}else if(l.getDisplayMedia){var _;r.screen.mediaSource&&cV(r.screen.mediaSource);const Wt={width:r.screen.width,height:r.screen.height,frameRate:r.screen.frameRate,displaySurface:(_=r.screen.displaySurface)!==null&&_!==void 0?_:r.screen.mediaSource==="screen"?"monitor":r.screen.mediaSource},{selfBrowserSurface:_r,surfaceSwitching:Di,systemAudio:Fi}=r.screen,Gi={selfBrowserSurface:_r,surfaceSwitching:Di,systemAudio:Fi};!_r&&delete Gi.selfBrowserSurface,!Di&&delete Gi.surfaceSwitching,!Fi&&delete Gi.systemAudio,_e.debug("[".concat(i,"] getDisplayMedia:"),JSON.stringify({video:Wt,audio:!!r.screenAudio,controls:Gi})),OI(p,await navigator.mediaDevices.getDisplayMedia(function(_p){for(var _f=1;_f<arguments.length;_f++){var cE=arguments[_f]!=null?arguments[_f]:{};_f%2?xV(Object(cE),!0).forEach(function(RE){$(_p,RE,cE[RE])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_p,Object.getOwnPropertyDescriptors(cE)):xV(Object(cE)).forEach(function(RE){Object.defineProperty(_p,RE,Object.getOwnPropertyDescriptor(cE,RE))})}return _p}({video:Wt,audio:!!r.screenAudio},Gi)))}else{if(!A_())throw _e.error("[".concat(i,"] This browser does not support screenSharing")),new _a(_i.NOT_SUPPORTED,"This browser does not support screen sharing");{r.screen.mediaSource&&cV(r.screen.mediaSource);const Wt={video:{mediaSource:r.screen.mediaSource,width:r.screen.width,height:r.screen.height,frameRate:r.screen.frameRate}};_e.debug("[".concat(i,"] getUserMedia: ").concat(JSON.stringify(Wt))),OI(p,await navigator.mediaDevices.getUserMedia(Wt))}}var b,P;if(!r.video&&!r.audio)return p;let x={video:r.video,audio:r.audio},H=kc("MEDIA_DEVICE_CONSTRAINTS");if(H)try{typeof H=="string"&&(H=JSON.parse(H)),x=function Wt(_r,Di){if(!qF(_r)||!qF(Di)||Array.isArray(_r)&&!Array.isArray(Di)||!Array.isArray(_r)&&Array.isArray(Di))return Di;if(Array.isArray(Di)&&Array.isArray(_r)){const Fi=[..._r];for(let Gi=0;Gi<Di.length;Gi++)Fi[Gi]=Wt(_r[Gi],Di[Gi]);return Fi}{const Fi=WR({},_r);for(const Gi in Di)Object.prototype.hasOwnProperty.call(Di,Gi)&&(Object.prototype.hasOwnProperty.call(_r,Gi)?Fi[Gi]=Wt(_r[Gi],Di[Gi]):Fi[Gi]=Di[Gi]);return Fi}}(x,H)}catch{}_e.debug("[".concat(i,"] GetUserMedia"),JSON.stringify(x)),i_();let B,z=null;(pT()||fT()||hO())&&(z=await XP.lock());try{B=await navigator.mediaDevices.getUserMedia(x)}catch(Wt){throw z&&z(),Wt}return x.audio&&(jV=!0),x.video&&(VV=!0),OI(p,B),z&&z(),p}function DO(r,i){switch(r){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new _a(_i.MEDIA_OPTION_INVALID,"".concat(r,": ").concat(i));case"NotFoundError":case"DevicesNotFoundError":return new _a(_i.DEVICE_NOT_FOUND,"".concat(r,": ").concat(i));case"NotSupportedError":return new _a(_i.NOT_SUPPORTED,"".concat(r,": ").concat(i));case"NotReadableError":return new _a(_i.NOT_READABLE,"".concat(r,": ").concat(i));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new _a(_i.PERMISSION_DENIED,"".concat(r,": ").concat(i));case"ConstraintNotSatisfiedError":return new _a(_i.CONSTRAINT_NOT_SATISFIED,"".concat(r,": ").concat(i));default:return _e.error("getUserMedia unexpected error",r),new _a(_i.UNEXPECTED_ERROR,"".concat(r,": ").concat(i))}}function OI(r,i){const s=r.getVideoTracks()[0],l=r.getAudioTracks()[0],p=i.getVideoTracks()[0],_=i.getAudioTracks()[0];_&&(l&&r.removeTrack(l),r.addTrack(_)),p&&(s&&r.removeTrack(s),r.addTrack(p))}const KT=new class extends I_{get state(){return this._state}set state(r){r!==this._state&&(this.emit(YS.STATE_CHANGE,r),this._state=r)}constructor(){super(),$(this,"_state",FR.IDLE),$(this,"isAccessMicrophonePermission",!1),$(this,"isAccessCameraPermission",!1),$(this,"lastAccessMicrophonePermission",!1),$(this,"lastAccessCameraPermission",!1),$(this,"checkdeviceMatched",!1),$(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(kc("ENUMERATE_DEVICES_INTERVAL")||(pO()||ZU()===Mb.HARMONY_OS)&&LR())&&this.updateDevicesInfo()},kc("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(r=>_e.error(r.toString()))}async enumerateDevices(r,i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new _a(_i.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const l=await navigator.mediaDevices.enumerateDevices(),p=this.checkMediaDeviceInfoIsOk(l);let _=!this.isAccessMicrophonePermission&&r,b=!this.isAccessCameraPermission&&i;p.audio&&(_=!1),p.video&&(b=!1);let P=null,x=null,H=null;if(!s&&(_||b)){if(XP.isLocked&&(_e.debug("[device manager] wait GUM lock"),(await XP.lock())(),_e.debug("[device manager] GUM unlock")),jV&&(_=!1,this.isAccessMicrophonePermission=!0),VV&&(b=!1,this.isAccessCameraPermission=!0),_e.debug("[device manager] check media device permissions",r,i,_,b),_&&b){try{H=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(B){const z=DO(B.name||B.code||B,B.message);if(z.code===_i.PERMISSION_DENIED)throw z;_e.warning("getUserMedia failed in getDevices",z)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(_){try{P=await navigator.mediaDevices.getUserMedia({audio:r})}catch(B){const z=DO(B.name||B.code||B,B.message);if(z.code===_i.PERMISSION_DENIED)throw z;_e.warning("getUserMedia failed in getDevices",z)}this.isAccessMicrophonePermission=!0}else if(b){try{x=await navigator.mediaDevices.getUserMedia({video:i})}catch(B){const z=DO(B.name||B.code||B,B.message);if(z.code===_i.PERMISSION_DENIED)throw z;_e.warning("getUserMedia failed in getDevices",z)}this.isAccessCameraPermission=!0}_e.debug("[device manager] mic permission",r,"cam permission",i)}try{const B=await navigator.mediaDevices.enumerateDevices();return P&&P.getTracks().forEach(z=>z.stop()),x&&x.getTracks().forEach(z=>z.stop()),H&&H.getTracks().forEach(z=>z.stop()),P=null,x=null,H=null,B}catch(B){return P&&P.getTracks().forEach(z=>z.stop()),x&&x.getTracks().forEach(z=>z.stop()),H&&H.getTracks().forEach(z=>z.stop()),P=null,x=null,H=null,new _a(_i.ENUMERATE_DEVICES_FAILED,B.toString()).throw()}}async getRecordingDevices(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,r)).filter(i=>i.kind==="audioinput")}async getCamerasDevices(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,r)).filter(i=>i.kind==="videoinput")}async getSpeakers(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,r)).filter(i=>i.kind==="audiooutput")}searchDeviceIdByName(r){let i=null;return this.deviceInfoMap.forEach(s=>{s.device.label===r&&(i=s.device.deviceId)}),i}async getDeviceById(r){const i=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===r);if(!i)throw new _a(_i.DEVICE_NOT_FOUND,"deviceId: ".concat(r));return i}async init(){this.state=FR.INITING;try{await this.updateDevicesInfo(),this.state=FR.INITEND}catch(r){throw _e.warning("Device Detection functionality cannot start properly.",r.toString()),this.state=FR.IDLE,!function(){return typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1"}()&&new _a(_i.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),r}}async updateDevicesInfo(){const r=await this.enumerateDevices(!0,!0,!0),i=Date.now(),s=[];if(r[0]&&r[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const p=r.find(b=>b.kind==="audioinput"&&b.deviceId==="default"),_=r.find(b=>b.kind==="audiooutput"&&b.deviceId==="default");p&&_?_.groupId===p.groupId?_e.debug("[device-check] default input ".concat(p.label," and output ").concat(_.label," is the same group")):_e.warning("[device-check] default input ".concat(p.label," and output ").concat(_.label," is not the same group")):_e.debug("[device-check] default input or output not found")}const l=this.checkMediaDeviceInfoIsOk(r);if(r.forEach(p=>{if(!p.deviceId)return;const _=this.deviceInfoMap.get("".concat(p.kind,"_").concat(p.deviceId));if((_?_.state:"INACTIVE")!=="ACTIVE"){const b={initAt:i,updateAt:i,device:p,state:"ACTIVE"};this.deviceInfoMap.set("".concat(p.kind,"_").concat(p.deviceId),b),s.push(b)}_&&(_.updateAt=i)}),this.deviceInfoMap.forEach((p,_)=>{p.state==="ACTIVE"&&p.updateAt!==i&&(p.state="INACTIVE",s.push(p))}),this.state!==FR.INITEND)return l.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(l.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(p=>{switch(p.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(YS.RECORDING_DEVICE_CHANGED,p);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(YS.CAMERA_DEVICE_CHANGED,p);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(YS.PLAYOUT_DEVICE_CHANGED,p)}}),l.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),l.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(r){const i=r.filter(p=>p.kind==="audioinput"),s=r.filter(p=>p.kind==="videoinput"),l={audio:!1,video:!1};for(const p of i)if(p.label&&p.deviceId){l.audio=!0;break}for(const p of s)if(p.label&&p.deviceId){l.video=!0;break}return l}},uX=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],LT=new class{constructor(){$(this,"onAutoplayFailed",void 0),$(this,"elementMap",new Map),$(this,"elementStateMap",new Map),$(this,"elementsNeedToResume",[]),$(this,"sinkIdMap",new Map),$(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(r=>{let[i,s]=r;const l=this.elementStateMap.get(i),p=s.srcObject.getAudioTracks()[0];lI()?p&&p.readyState==="live"&&s_.curState==="running"&&(_e.debug("auto resume after interruption for iOS 15"),s.pause(),s.play()):l&&l==="paused"&&p&&p.readyState==="live"&&s_.curState==="running"&&(_e.debug("auto resume after interruption for iOS"),s.play())})}),$(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(r=>{let[i,s]=r;const l=s.srcObject.getAudioTracks()[0];l&&l.readyState==="live"&&(_e.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),s_.on(_m.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),s_.on(_m.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),s_.on(_m.STATE_CHANGE,()=>{fT()&&s_.prevState==="suspended"&&s_.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(r,i){const s=this.elementMap.get(r);if(this.sinkIdMap.set(r,i),s)try{await s.setSinkId(i)}catch(l){throw new _a(_i.PERMISSION_DENIED,"can not set sink id: "+l.toString())}}play(r,i,s,l){if(this.elementMap.has(i))return;const p=document.createElement("audio");p.autoplay=!0,p.srcObject=new MediaStream([r]),this.bindAudioElementEvents(i,p),this.elementMap.set(i,p),this.elementStateMap.set(i,eT.INIT),this.setVolume(i,s);const _=this.sinkIdMap.get(i);if(_)try{p.setSinkId(_).catch(P=>{_e.warning("[".concat(i,"] set sink id failed"),P.toString())})}catch(P){_e.warning("[".concat(i,"] set sink id failed"),P.toString())}const b=p.play();b&&b.then&&b.catch(P=>{l&&AE.autoplayFailed(l,"audio",P.message,i),_e.warning("audio element play warning",P.toString()),this.elementMap.has(i)&&P.name==="NotAllowedError"&&(_e.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(p),IS(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),RV()}))})}updateTrack(r,i){const s=this.elementMap.get(r);s&&(s.srcObject=new MediaStream([i]))}isPlaying(r){return this.elementMap.has(r)&&this.elementStateMap.get(r)==="playing"}setVolume(r,i){const s=this.elementMap.get(r);s&&(i=Math.max(0,Math.min(100,i)),s.volume=i/100)}stop(r){const i=this.elementMap.get(r);if(this.sinkIdMap.delete(r),!i)return;const s=this.elementsNeedToResume.indexOf(i);this.elementsNeedToResume.splice(s,1),i.srcObject=null,i.remove(),this.elementMap.delete(r),this.elementStateMap.delete(r)}bindAudioElementEvents(r,i){uX.forEach(s=>{i.addEventListener(s,l=>{const p=this.elementStateMap.get(r),_=l.type==="pause"?"paused":l.type;if(_e.debug("[".concat(r,"] audio-element-status change ").concat(p," => ").concat(_)),l.type==="error"){const b=i==null?void 0:i.error;b&&_e.error("[".concat(r,"] media error, code: ").concat(b.code,", message: ").concat(b.message))}this.elementStateMap.set(r,_)})})}getPlayerState(r){return this.elementStateMap.get(r)||"uninit"}autoResumeAudioElement(){const r=()=>{this.elementsNeedToResume.forEach(i=>{i.play().then(s=>{_e.debug("Auto resume audio element success")}).catch(s=>{_e.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new SE(i=>{document.body?i():window.addEventListener("load",()=>i())}).then(()=>{ZI()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0))})}};function w_(){return function(r,i,s){const l=s.value;return typeof l=="function"&&(s.value=function(){this._isClosed&&new _a(_i.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");for(var p=arguments.length,_=new Array(p),b=0;b<p;b++)_[b]=arguments[b];const P=l.apply(this,_);return P instanceof SE?new SE((x,H)=>{P.then(x).catch(H)}):P}),s}}var dX=rR("Array").values,lX=oR,hX=DT,pX=ue,fX=dX,QP=Array.prototype,EX={DOMTokenList:!0,NodeList:!0},LS=function(r){var i=r.values;return r===QP||pX(QP,r)&&i===QP.values||hX(EX,lX(r))?fX:i};function FV(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function PO(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?FV(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):FV(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}class BV extends I_{constructor(i){super(),$(this,"name","VideoProcessorDestination"),$(this,"ID","0"),$(this,"_source",void 0),$(this,"videoContext",void 0),$(this,"inputTrack",void 0),this.videoContext=i}get kind(){return"video"}get enabled(){return!0}pipe(){throw new _a(_i.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new _a(_i.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(i){if(i.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);i.track&&i.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=i.track,this.emit(iT.ON_TRACK,i.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(iT.ON_TRACK,void 0)}}class GV extends I_{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,s){super(),$(this,"constraintsMap",new Map),$(this,"statsRegistry",[]),$(this,"usageRegistry",[]),$(this,"trackId",void 0),$(this,"direction",void 0),$(this,"_chained",!1),this.trackId=i,this.direction=s}async getConstraints(){return await aT(this,OT.REQUEST_CONSTRAINTS)}async requestApplyConstraints(i,s){var l;return _e.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),i&&this.constraintsMap.set(s,i),N_(this,OT.REQUEST_UPDATE_CONSTRAINTS,Array.from(LS(l=this.constraintsMap).call(l)))}async requestRevertConstraints(i){var s;if(this.constraintsMap.has(i))return _e.info("processor ".concat(i.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(i),N_(this,OT.REQUEST_UPDATE_CONSTRAINTS,Array.from(LS(s=this.constraintsMap).call(s)))}registerStats(i,s,l){this.statsRegistry.find(p=>p.processorID===i.ID&&p.processorName===i.name&&p.type===s)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:s,cb:l})}unregisterStats(i,s){const l=this.statsRegistry.findIndex(p=>p.processorID===i.ID&&p.processorName===i.name&&p.type===s);l!==-1&&this.statsRegistry.splice(l,1)}gatherStats(){const i=[];for(const{processorID:s,processorName:l,type:p,cb:_}of this.statsRegistry)try{const b=_();i.push({processorID:s,processorName:l,type:p,stats:b})}catch(b){_e.error(new _a(_i.UNEXPECTED_ERROR,b.message))}return i}registerUsage(i,s){this.usageRegistry.find(l=>l.processorID===i.ID&&l.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:s})}unregisterUsage(i){const s=this.usageRegistry.findIndex(l=>l.processorID===i.ID&&l.processorName===i.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const i=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let l=s();l instanceof SE&&(l=await l),i.push(PO(PO({},l),{},{direction:this.direction}))}catch(l){_e.error("gather extension usage error",l)}return i}getDirection(){return this.direction}}class qV extends I_{constructor(i){super(),$(this,"name","AudioProcessorDestination"),$(this,"ID","0"),$(this,"inputTrack",void 0),$(this,"inputNode",void 0),$(this,"audioProcessorContext",void 0),$(this,"_source",void 0),this.audioProcessorContext=i}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new _a(_i.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new _a(_i.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(iT.ON_TRACK,void 0),this.emit(iT.ON_NODE,void 0)}updateInput(i){if(i.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);i.track&&this.inputTrack!==i.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=i.track,this.emit(iT.ON_TRACK,this.inputTrack)),i.node&&this.inputNode!==i.node&&(this.audioProcessorContext.chained=!0,this.inputNode=i.node,this.emit(iT.ON_NODE,this.inputNode))}}class WV extends I_{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,s,l){super(),$(this,"constraintsMap",new Map),$(this,"statsRegistry",[]),$(this,"audioContext",void 0),$(this,"trackId",void 0),$(this,"direction",void 0),$(this,"usageRegistry",[]),$(this,"_chained",!1),this.audioContext=i,this.trackId=s,this.direction=l}async getConstraints(){return aT(this,OT.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(i,s){var l;return _e.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),i&&this.constraintsMap.set(s,i),N_(this,OT.REQUEST_UPDATE_CONSTRAINTS,Array.from(LS(l=this.constraintsMap).call(l)))}async requestRevertConstraints(i){var s;if(this.constraintsMap.has(i))return this.constraintsMap.delete(i),N_(this,OT.REQUEST_UPDATE_CONSTRAINTS,Array.from(LS(s=this.constraintsMap).call(s)))}registerStats(i,s,l){this.statsRegistry.find(p=>p.processorID===i.ID&&p.processorName===i.name&&p.type===s)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:s,cb:l})}unregisterStats(i,s){const l=this.statsRegistry.findIndex(p=>p.processorID===i.ID&&p.processorName===i.name&&p.type===s);l!==-1&&this.statsRegistry.splice(l,1)}gatherStats(){const i=[];for(const{processorID:s,processorName:l,type:p,cb:_}of this.statsRegistry)try{const b=_();i.push({processorID:s,processorName:l,type:p,stats:b})}catch(b){_e.error(new _a(_i.UNEXPECTED_ERROR,b.message))}return i}registerUsage(i,s){this.usageRegistry.find(l=>l.processorID===i.ID&&l.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:s})}unregisterUsage(i){const s=this.usageRegistry.findIndex(l=>l.processorID===i.ID&&l.processorName===i.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const i=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let l=s();l instanceof SE&&(l=await l),i.push(PO(PO({},l),{},{direction:this.direction}))}catch(l){_e.error("gather extension usage error",l)}return i}getDirection(){return this.direction}}class $P extends I_{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),$(this,"context",void 0),$(this,"processSourceNode",void 0),$(this,"outputTrack",void 0),$(this,"processedNode",void 0),$(this,"clonedTrack",void 0),$(this,"outputNode",void 0),this.outputNode=new _X}setVolume(){}createOutputTrack(){throw new _a(_i.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class _X{disconnect(){}connect(){}}let kO,AI=null;class mX{constructor(){$(this,"state","open"),$(this,"trigger",void 0),$(this,"tasks",[]),_e.debug("[macro-task-queue] is created."),this.trigger=setTimeout(()=>{this.state="closed",_e.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(i=>i.key),"]")),this.trigger=void 0,this.tasks.forEach(i=>{let{func:s}=i;return s()}),this.tasks.length=0,_e.debug("[macro-task-queue] is closed.")})}enqueue(i,s){this.state!=="closed"&&(this.tasks.push({key:i,func:s}),_e.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat(typeof i=="string"?i:"")))}runTask(i){if(this.state==="closed")return;const s=this.tasks.findIndex(l=>l.key===i);if(s!==-1){const l=this.tasks.splice(s,1);_e.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat(typeof i=="string"?i:"")),l[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,_e.debug("[macro-task-queue] is closed."))}}function ZP(r){return function(i,s,l){var p;const _=(p=l.value)!==null&&p!==void 0?p:l.get,b=function(){AI&&AI.state==="open"&&AI.runTask(r);for(var P=arguments.length,x=new Array(P),H=0;H<P;H++)x[H]=arguments[H];return _==null?void 0:_.apply(this,...x)};return l.value?l.value=b:l.get=b,l}}var KV,HV,YV,zV,JV,XV,QV,$V,ZV,tF,eF,nF,rF,iF,oF,sF,aF,cF,uF,dF,lF,a_,hF,pF,fF,EF,_F,mF,MS,gF,vF,yF,bF,TF,SF,RF,IF,OF,AF,CF,wF,lT;function NF(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function _k(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?NF(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):NF(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}(function(r){r.UPDATE_TRACK_SOURCE="update-track-source"})(kO||(kO={}));let oT=(KV=ZP("INIT_WEBAUDIO"),HV=ZP("INIT_WEBAUDIO"),YV=ZP("INIT_WEBAUDIO"),zV=PE({argsMap:(r,i)=>[r.getTrackId(),i],throttleTime:300}),JV=PE({argsMap:(r,i)=>[r.getTrackId(),i]}),XV=w_(),QV=RI("LocalAudioTrack","_enabledMutex"),$V=PE({argsMap:(r,i)=>[r.getTrackId(),i]}),ZV=w_(),tF=RI("LocalAudioTrack","_enabledMutex"),eF=PE({argsMap:(r,i)=>[r.getTrackId(),i]}),nF=w_(),rF=w_(),iF=w_(),oF=PE({argsMap:r=>[r.getTrackId()]}),sF=w_(),aF=PE({argsMap:r=>[r.getTrackId()]}),cF=w_(),uF=PE({argsMap:r=>[r.getTrackId()]}),dF=PE({argsMap:(r,i)=>[r.getTrackId(),i.name]}),lF=PE({argsMap:r=>[r.getTrackId()]}),iE((a_=class extends YP{get _source(){return this._trackSource}set _source(r){this._trackSource=r}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get processorDestination(){return this._processorDestination}set processorDestination(r){this._processorDestination=r}get isPlaying(){return this._useAudioElement?LT.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(r,i,s,l,p){super(r,s),$(this,"trackMediaType","audio"),$(this,"_encoderConfig",void 0),$(this,"_trackSource",void 0),$(this,"_enabled",!0),$(this,"_volume",100),$(this,"_useAudioElement",!1),$(this,"_bypassWebAudio",!1),$(this,"processor",void 0),$(this,"_processorContext",void 0),$(this,"_processorDestination",void 0),$(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=i,this._getOriginVolumeLevel=!!l;const _=()=>{this.processorContext=new WV(this._source.context,this.getTrackId(),"local"),this.processorDestination=new qV(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(IT.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},b=p&&pT()&&!NV();kc("DISABLE_WEBAUDIO")?(this._source=new $P,this._useAudioElement=!0,this._bypassWebAudio=!0):b?this._source=new $P:(this._source=new JP(r,!1,this._getOriginVolumeLevel?r:void 0),kc("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),_(),!kc("DISABLE_WEBAUDIO")&&b&&(AI||(AI=new mX),AI).enqueue("INIT_WEBAUDIO",()=>{this._source=new JP(r,!1,this._getOriginVolumeLevel?r:void 0),kc("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),_(),this.emit(kO.UPDATE_TRACK_SOURCE)})}setVolume(r){__(r,"volume",0,1e3),this._volume=r,this._source.setVolume(r/100),this._useAudioElement&&LT.setVolume(this.getTrackId(),r);try{if(this._bypassWebAudio)return void _e.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const i=this._source.createOutputTrack();this._mediaStreamTrack!==i&&(this._mediaStreamTrack=i,N_(this,ME.NEED_REPLACE_TRACK,this).then(()=>{_e.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{_e.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(r){if(!this._useAudioElement)throw new _a(_i.NOT_SUPPORTED,"your browser does not support setting the audio output device");await LT.setSinkID(this.getTrackId(),r)}async setEnabled(r,i,s){return this._setEnabled(r,i,s)}async _setEnabled(r,i,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(_e.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await N_(this,ME.NEED_ENABLE_TRACK,this),_e.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(r," success"))}catch(l){throw s||(this._enabled=!1),_e.error("[".concat(this.getTrackId(),"] setEnabled to true error"),l.toString()),l}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await N_(this,ME.NEED_DISABLE_TRACK,this)}catch(l){throw s||(this._enabled=!0),_e.error("[".concat(this.getTrackId(),"] setEnabled to false error"),l.toString()),l}}}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,_e.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await N_(this,ME.NEED_MUTE_TRACK,this):await N_(this,ME.NEED_UNMUTE_TRACK,this))}getStats(){return c0(()=>{_e.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),hS(this,ME.GET_STATS)||_k({},kP)}setAudioFrameCallback(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!r)return this._source.removeAllListeners(IT.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(i),this._source.removeAllListeners(IT.ON_AUDIO_BUFFER),this._source.on(IT.ON_AUDIO_BUFFER,s=>r(s))}play(){_e.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(_e.debug("[".concat(this.getTrackId(),"] start audio playback in element")),LT.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){_e.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?LT.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let r=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];_e.debug("[".concat(this.getTrackId(),"] update player source track")),r&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&LT.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(r,i){this._originMediaStreamTrack!==r&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r.addEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:r,context:this.processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await N_(this,ME.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(r))}renewMediaStreamTrack(r){return SE.resolve(void 0)}pipe(r){if(this._bypassWebAudio)throw new _a(_i.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===r)return r;if(r._source)throw new _a(_i.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),r}unpipe(){var r;if(!this.processor)return;const i=this.processor;(r=this._source.processSourceNode)===null||r===void 0||r.disconnect(),this.processor._source=!1,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(iT.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await N_(this,ME.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await N_(this,ME.NEED_REPLACE_TRACK,this))}),this.processorDestination.on(iT.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(iT.ON_TRACK),this.processorDestination.removeAllListeners(iT.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(OT.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(OT.REQUEST_CONSTRAINTS)}}).prototype,"_source",[KV],Object.getOwnPropertyDescriptor(a_.prototype,"_source"),a_.prototype),iE(a_.prototype,"processorContext",[HV],Object.getOwnPropertyDescriptor(a_.prototype,"processorContext"),a_.prototype),iE(a_.prototype,"processorDestination",[YV],Object.getOwnPropertyDescriptor(a_.prototype,"processorDestination"),a_.prototype),iE(a_.prototype,"setVolume",[zV],Object.getOwnPropertyDescriptor(a_.prototype,"setVolume"),a_.prototype),iE(a_.prototype,"setPlaybackDevice",[JV,XV],Object.getOwnPropertyDescriptor(a_.prototype,"setPlaybackDevice"),a_.prototype),iE(a_.prototype,"setEnabled",[QV,$V,ZV],Object.getOwnPropertyDescriptor(a_.prototype,"setEnabled"),a_.prototype),iE(a_.prototype,"setMuted",[tF,eF,nF],Object.getOwnPropertyDescriptor(a_.prototype,"setMuted"),a_.prototype),iE(a_.prototype,"getStats",[rF],Object.getOwnPropertyDescriptor(a_.prototype,"getStats"),a_.prototype),iE(a_.prototype,"setAudioFrameCallback",[iF],Object.getOwnPropertyDescriptor(a_.prototype,"setAudioFrameCallback"),a_.prototype),iE(a_.prototype,"play",[oF,sF],Object.getOwnPropertyDescriptor(a_.prototype,"play"),a_.prototype),iE(a_.prototype,"stop",[aF,cF],Object.getOwnPropertyDescriptor(a_.prototype,"stop"),a_.prototype),iE(a_.prototype,"close",[uF],Object.getOwnPropertyDescriptor(a_.prototype,"close"),a_.prototype),iE(a_.prototype,"pipe",[dF],Object.getOwnPropertyDescriptor(a_.prototype,"pipe"),a_.prototype),iE(a_.prototype,"unpipe",[lF],Object.getOwnPropertyDescriptor(a_.prototype,"unpipe"),a_.prototype),a_),LO=(hF=PE({argsMap:(r,i)=>[r.getTrackId(),i]}),pF=w_(),fF=RI("MicrophoneAudioTrack","_enabledMutex"),EF=PE({argsMap:(r,i,s)=>[r.getTrackId(),i,s]}),_F=w_(),mF=PE({argsMap:r=>[r.getTrackId()]}),iE((MS=class extends oT{get __className__(){return"MicrophoneAudioTrack"}constructor(r,i,s,l){super(r,i.encoderConfig?IO(i.encoderConfig):{},l,kc("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),$(this,"_config",void 0),$(this,"_deviceName","default"),$(this,"_constraints",void 0),$(this,"_originalConstraints",void 0),$(this,"_enabled",!0),this._config=i,this._constraints=s,this._originalConstraints=s,this._deviceName=r.label,typeof i.bypassWebAudio=="boolean"&&(this._bypassWebAudio=i.bypassWebAudio),(lI()||tP())&&s_.bindInterruptDetectorTrack(this),this.on(kO.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),NV()&&this.bindProcessorContextEvents()}async setDevice(r){if(_e.info("[".concat(this.getTrackId(),"] start set device to ").concat(r)),this._enabled)try{const i=await KT.getDeviceById(r),s={};s.audio=_k({},this._constraints),s.audio.deviceId={exact:r},this._originMediaStreamTrack.stop();let l=null;try{l=await lS(s,this.getTrackId())}catch(p){throw _e.error("[".concat(this.getTrackId(),"] setDevice failed"),p.toString()),l=await lS({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!1),p}await this._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!1),this._deviceName=i.label,this._config.microphoneId=r,this._constraints.deviceId={exact:r}}catch(i){throw _e.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await KT.getDeviceById(r);this._deviceName=i.label,this._config.microphoneId=r,this._constraints.deviceId={exact:r}}catch(i){throw _e.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}_e.info("[".concat(this.getTrackId(),"] set device to ").concat(r," success"))}async setEnabled(r,i,s){if(i)return _e.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(r);if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(_e.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){var l;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(l=this._source.clonedTrack)===null||l===void 0||l.stop(),s||(this._enabled=!1);try{await N_(this,ME.NEED_DISABLE_TRACK,this)}catch(b){throw _e.error("[".concat(this.getTrackId(),"] setEnabled false failed"),b.toString()),b}return}const p=_k({},this._constraints),_=KT.searchDeviceIdByName(this._deviceName);_&&!p.deviceId&&(p.deviceId=_);try{s||(this._enabled=!0);const b=await lS({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(b.getAudioTracks()[0],!1),await N_(this,ME.NEED_ENABLE_TRACK,this)}catch(b){throw s||(this._enabled=!1),_e.error("[".concat(this.getTrackId(),"] setEnabled true failed"),b.toString()),b}_e.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(lI()||tP())&&s_.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((fT()||PS())&&this._enabled&&!this._isClosed&&s_.duringInterruption){const r=async()=>{s_.off(_m.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(_e.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};s_.on(_m.IOS_INTERRUPTION_END,r)}else _e.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(lR.TRACK_ENDED)}async renewMediaStreamTrack(r){const i=r||this._constraints,s=KT.searchDeviceIdByName(this._deviceName);if(s&&!i.deviceId&&(i.deviceId=s),this._constraints=i,this._enabled){this._originMediaStreamTrack.stop();const l=await lS({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!0)}}bindProcessorContextEvents(){this.processorContext.on(OT.REQUEST_UPDATE_CONSTRAINTS,async(r,i,s)=>{try{const l=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(l),i()}catch(l){s(l)}}),this.processorContext.on(OT.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[hF,pF],Object.getOwnPropertyDescriptor(MS.prototype,"setDevice"),MS.prototype),iE(MS.prototype,"setEnabled",[fF,EF,_F],Object.getOwnPropertyDescriptor(MS.prototype,"setEnabled"),MS.prototype),iE(MS.prototype,"close",[mF],Object.getOwnPropertyDescriptor(MS.prototype,"close"),MS.prototype),MS),gX=(gF=PE({argsMap:(r,i)=>[r.getTrackId(),i,r.duration]}),vF=w_(),yF=PE({argsMap:r=>[r.getTrackId()]}),bF=w_(),TF=PE({argsMap:r=>[r.getTrackId()]}),SF=w_(),RF=PE({argsMap:r=>[r.getTrackId()]}),IF=w_(),OF=PE({argsMap:r=>[r.getTrackId()]}),AF=w_(),CF=PE({argsMap:r=>[r.getTrackId()]}),wF=w_(),iE((lT=class extends oT{get __className__(){return"BufferSourceAudioTrack"}constructor(r,i,s,l){super(i.createOutputTrack(),s,l),$(this,"source",void 0),$(this,"_bufferSource",void 0),this.source=r,this._bufferSource=i,this._bufferSource.on(IT.AUDIO_SOURCE_STATE_CHANGE,p=>{this.safeEmit(lR.SOURCE_STATE_CHANGE,p)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(r){r&&this._bufferSource.updateOptions(r),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(r){this._bufferSource.seekAudioBuffer(r)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}setAudioBufferPlaybackSpeed(r){__(r,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(r)}}).prototype,"startProcessAudioBuffer",[gF,vF],Object.getOwnPropertyDescriptor(lT.prototype,"startProcessAudioBuffer"),lT.prototype),iE(lT.prototype,"pauseProcessAudioBuffer",[yF,bF],Object.getOwnPropertyDescriptor(lT.prototype,"pauseProcessAudioBuffer"),lT.prototype),iE(lT.prototype,"seekAudioBuffer",[TF,SF],Object.getOwnPropertyDescriptor(lT.prototype,"seekAudioBuffer"),lT.prototype),iE(lT.prototype,"resumeProcessAudioBuffer",[RF,IF],Object.getOwnPropertyDescriptor(lT.prototype,"resumeProcessAudioBuffer"),lT.prototype),iE(lT.prototype,"stopProcessAudioBuffer",[OF,AF],Object.getOwnPropertyDescriptor(lT.prototype,"stopProcessAudioBuffer"),lT.prototype),iE(lT.prototype,"setAudioBufferPlaybackSpeed",[CF,wF],Object.getOwnPropertyDescriptor(lT.prototype,"setAudioBufferPlaybackSpeed"),lT.prototype),lT);class AT extends oT{get __className__(){return"MixingAudioTrack"}get isActive(){for(const i of this.trackList)if(i._enabled&&!i._isClosed&&!i.muted)return!0;return!1}constructor(){const i=II().createMediaStreamDestination();super(i.stream.getAudioTracks()[0],void 0,b_(8,"track-mix-")),$(this,"trackList",void 0),$(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=i,this.trackList=[]}hasAudioTrack(i){return this.trackList.indexOf(i)!==-1}addAudioTrack(i){this.trackList.indexOf(i)===-1?(_e.debug("add ".concat(i.getTrackId()," to mixing track")),i._source.outputNode.connect(this.destNode),this.trackList.push(i),this.updateEncoderConfig()):_e.debug("track ".concat(i.getTrackId()," is already added"))}removeAudioTrack(i){if(this.trackList.indexOf(i)!==-1){_e.debug("remove ".concat(i.getTrackId()," from mixing track"));try{i._source.outputNode.disconnect(this.destNode)}catch{}nL(this.trackList,i),this.updateEncoderConfig()}}updateEncoderConfig(){const i={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(i.bitrate||0)&&(i.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(i.sampleRate||0)&&(i.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(i.sampleSize||0)&&(i.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(i.stereo=!0))}),this._encoderConfig=i}_updateRtpTransceiver(i){this._rtpTransceiver!==i&&(this._rtpTransceiver=i,this.trackList.forEach(s=>{s instanceof AT?s.emit(o0.TRANSCEIVER_UPDATED,i):s._updateRtpTransceiver(i)}))}}class vX extends I_{constructor(){super(...arguments),$(this,"resultStorage",new Map)}setLocalAudioStats(i,s,l){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",i,this.checkAudioInputLevel(l,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",i,this.checkSendAudioBitrate(l,s))}setLocalVideoStats(i,s,l){this.record("SEND_VIDEO_BITRATE_TOO_LOW",i,this.checkSendVideoBitrate(l,s)),this.record("FRAMERATE_INPUT_TOO_LOW",i,this.checkFramerateInput(l,s)),this.record("FRAMERATE_SENT_TOO_LOW",i,this.checkFramerateSent(l))}setRemoteAudioStats(i,s){const l=i.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",l,this.checkAudioOutputLevel(s))}setRemoteVideoStats(i,s){const l=i.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",l,this.checkVideoDecode(s))}record(i,s,l){if(kc("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(i)||this.resultStorage.set(i,{result:[],isPrevNormal:!0});const p=this.resultStorage.get(i);if(p&&(p.result.push(l),p.result.length>=5)){const _=p.result.includes(!0);p.isPrevNormal&&!_&&this.emit("exception",DF[i],i,s),!p.isPrevNormal&&_&&this.emit("exception",DF[i]+2e3,i+"_RECOVER",s),p.isPrevNormal=_,p.result=[]}}checkAudioOutputLevel(i){return!(i.receiveBitrate>0&&i.receiveLevel===0)}checkAudioInputLevel(i,s){return s instanceof AT&&!s.isActive||!!s.muted||i.sendVolumeLevel!==0}checkFramerateInput(i,s){let l=null;s._encoderConfig&&s._encoderConfig.frameRate&&(l=JS(s._encoderConfig.frameRate));const p=i.captureFrameRate;return!l||!p||!(l>10&&p<5||l<10&&l>=5&&p<=1)}checkFramerateSent(i){return!(i.captureFrameRate&&i.sendFrameRate&&i.captureFrameRate>5&&i.sendFrameRate<=1)}checkSendVideoBitrate(i,s){return!!s.muted||i.sendBitrate!==0}checkSendAudioBitrate(i,s){return s instanceof AT&&!s.isActive||!!s.muted||i.sendBitrate!==0}checkVideoDecode(i){return i.receiveBitrate===0||i.decodeFrameRate!==0}}const DF={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},ZT=new class{markSubscribeStart(r,i){performance.mark("agora-web-sdk/".concat(r,"/subscribe-").concat(i))}markPublishStart(r,i){performance.mark("agora-web-sdk/".concat(r,"/publish-").concat(i))}measureFromSubscribeStart(r,i){const s=performance.getEntriesByName("agora-web-sdk/".concat(r,"/subscribe-").concat(i));if(s.length>0){const l=s[s.length-1];return Math.round(performance.now()-l.startTime)}return 0}measureFromPublishStart(r,i){const s=performance.getEntriesByName("agora-web-sdk/".concat(r,"/publish-").concat(i));if(s.length>0){const l=s[s.length-1];return Math.round(performance.now()-l.startTime)}return 0}};function PF(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function qR(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?PF(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):PF(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}class CI{constructor(i){$(this,"store",void 0),$(this,"onStatsException",void 0),$(this,"onUploadPublishDuration",void 0),$(this,"onStatsChanged",void 0),$(this,"localStats",new Map),$(this,"remoteStats",new Map),$(this,"updateStatsInterval",void 0),$(this,"trafficStats",void 0),$(this,"trafficStatsPeerList",[]),$(this,"uplinkStats",void 0),$(this,"exceptionMonitor",void 0),$(this,"p2pChannel",void 0),$(this,"scalabilityMode",XD.L1T1),$(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=i,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new vX,this.exceptionMonitor.on("exception",(s,l,p)=>{this.onStatsException&&this.onStatsException(s,l,p)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(IE.LocalAudioTrack)||qR({},kP)}getLocalVideoTrackStats(){return this.localStats.get(IE.LocalVideoTrack)||qR({},LP)}getRemoteAudioTrackStats(i){const s=(_,b)=>{if(!this.trafficStats)return b;const P=this.trafficStats.peer_delay.find(x=>x.peer_uid===_);return P&&(b.publishDuration=P.B_ppad+(Date.now()-this.trafficStats.timestamp)),b},l={};if(i){var p;const _=(p=this.remoteStats.get(i))===null||p===void 0?void 0:p.audioStats;_&&(l[i]=s(i,_))}else Array.from(this.remoteStats.entries()).forEach(_=>{let[b,{audioStats:P}]=_;P&&(l[b]=s(b,P))});return l}getRemoteNetworkQualityStats(i){const s={};if(i){var l;const p=(l=this.remoteStats.get(i))===null||l===void 0?void 0:l.networkStats;p&&(s[i]=p)}else Array.from(this.remoteStats.entries()).forEach(p=>{let[_,{networkStats:b}]=p;b&&(s[_]=b)});return s}getRemoteVideoTrackStats(i){const s=(_,b)=>{if(!this.trafficStats)return b;const P=this.trafficStats.peer_delay.find(x=>x.peer_uid===_);return P&&(b.publishDuration=P.B_ppvd+(Date.now()-this.trafficStats.timestamp)),b},l={};if(i){var p;const _=(p=this.remoteStats.get(i))===null||p===void 0?void 0:p.videoStats;_&&(l[i]=s(i,_))}else Array.from(this.remoteStats.entries()).forEach(_=>{let[b,{videoStats:P}]=_;P&&(l[b]=s(b,P))});return l}getRTCStats(){let i=0,s=0,l=0,p=0;const _=this.localStats.get(IE.LocalAudioTrack);_&&(i+=_.sendBytes,s+=_.sendBitrate);const b=this.localStats.get(IE.LocalVideoTrack);b&&(i+=b.sendBytes,s+=b.sendBitrate);const P=this.localStats.get(IE.LocalVideoLowTrack);P&&(i+=P.sendBytes,s+=P.sendBitrate),this.remoteStats.forEach(H=>{let{audioStats:B,videoStats:z}=H;B&&(l+=B.receiveBytes,p+=B.receiveBitrate),z&&(l+=z.receiveBytes,p+=z.receiveBitrate)});let x=1;return this.trafficStats&&(x+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:x,SendBitrate:s,SendBytes:i,RecvBytes:l,RecvBitrate:p,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(i){this.localStats.set(i,void 0)}removeLocalStats(i){i?this.localStats.delete(i):this.localStats.clear()}addRemoteStats(i){this.remoteStats.set(i,{})}removeRemoteStats(i){i?this.remoteStats.delete(i):this.remoteStats.clear()}addP2PChannel(i){this.p2pChannel=i}updateTrafficStats(i){i.peer_delay=i.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),i.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var l;const p=(l=this.p2pChannel)===null||l===void 0?void 0:l.getRemoteMedia(s.peer_uid),_=p!=null&&p.videoSSRC?ZT.measureFromSubscribeStart(this.store.clientId,p.videoSSRC):0,b=p!=null&&p.audioSSRC?ZT.measureFromSubscribeStart(this.store.clientId,p.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,_>b?_:b),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=i}updateUplinkStats(i){this.uplinkStats&&this.uplinkStats.B_fir!==i.B_fir&&_e.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(i.B_fir)),this.uplinkStats=i}static isRemoteVideoFreeze(i,s,l){if(!i)return!1;const p=!!l&&s.framesDecodeFreezeTime>l.framesDecodeFreezeTime,_=!l||s.framesDecodeCount>l.framesDecodeCount;return p||!_}static isRemoteAudioFreeze(i){return!!i&&i._isFreeze()}isLocalVideoFreeze(i){return!(!i.inputFrame||!i.sentFrame)&&i.inputFrame.frameRate>5&&i.sentFrame.frameRate<3}updateLocalStats(i){Array.from(this.localStats.entries()).forEach(s=>{let[l,p]=s;switch(l){case IE.LocalVideoTrack:case IE.LocalVideoLowTrack:{const b=p,P=qR({},LP),x=i.getStats(),H=i.getLocalMedia(l);if(x){const B=x.videoSend.find(z=>z.ssrc===(H==null?void 0:H.ssrcs[0].ssrcId));if(B){const z=i.getLocalVideoSize(),Wt=i.getEncoderConfig(IE.LocalVideoTrack);B.codec!=="H264"&&B.codec!=="H265"&&B.codec!=="VP8"&&B.codec!=="VP9"&&B.codec!=="AV1X"&&B.codec!=="AV1"||(P.codecType=B.codec),P.sendBytes=B.bytes,P.sendBitrate=b?8*Math.max(0,P.sendBytes-b.sendBytes):0,B.inputFrame?(P.captureFrameRate=B.inputFrame.frameRate,P.captureResolutionHeight=B.inputFrame.height,P.captureResolutionWidth=B.inputFrame.width):z&&(P.captureResolutionWidth=z.width,P.captureResolutionHeight=z.height),B.sentFrame?(P.sendFrameRate=B.sentFrame.frameRate,P.sendResolutionHeight=B.sentFrame.height,P.sendResolutionWidth=B.sentFrame.width):z&&(P.sendResolutionWidth=z.width,P.sendResolutionHeight=z.height),B.avgEncodeMs&&(P.encodeDelay=B.avgEncodeMs),Wt&&Wt.bitrateMax&&(P.targetSendBitrate=1e3*Wt.bitrateMax),P.sendPackets=B.packets,P.sendPacketsLost=B.packetsLost,P.totalDuration=b?b.totalDuration+1:1,P.totalFreezeTime=b?b.totalFreezeTime:0,this.isLocalVideoFreeze(B)&&(P.totalFreezeTime+=1),B.scalabilityMode&&this.scalabilityMode!==B.scalabilityMode&&(_e.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(B.scalabilityMode)),this.scalabilityMode=B.scalabilityMode)}this.trafficStats&&(P.sendPacketsLost=this.trafficStats.B_pvlr4/100)}var _;this.localStats.set(l,P),((b==null?void 0:b.sendResolutionWidth)!==P.sendResolutionWidth||(b==null?void 0:b.sendResolutionHeight)!==P.sendResolutionHeight)&&((_=this.onStatsChanged)===null||_===void 0||_.call(this,"resolution",{width:P.sendResolutionWidth,height:P.sendResolutionHeight})),P&&H&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,H.track,P);break}case IE.LocalAudioTrack:{const b=p,P=qR({},kP),x=i.getStats(),H=i.getLocalMedia(l);if(x){const B=x.audioSend.find(z=>z.ssrc===(H==null?void 0:H.ssrcs[0].ssrcId));if(B){if(B.codec!=="opus"&&B.codec!=="aac"&&B.codec!=="PCMU"&&B.codec!=="PCMA"&&B.codec!=="G722"||(P.codecType=B.codec),B.inputLevel)P.sendVolumeLevel=Math.round(32767*B.inputLevel);else{const z=i.getLocalAudioVolume();z&&(P.sendVolumeLevel=Math.round(32767*z))}P.sendBytes=B.bytes,P.sendPackets=B.packets,P.sendPacketsLost=B.packetsLost,P.sendBitrate=b?8*Math.max(0,P.sendBytes-b.sendBytes):0}}this.trafficStats&&(P.sendPacketsLost=this.trafficStats.B_pvlr4/100),this.localStats.set(IE.LocalAudioTrack,P),P&&H&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,H.track,P);break}}})}updateRemoteStats(i){Array.from(this.remoteStats.entries()).forEach(s=>{let[l,{videoStats:p,audioStats:_,videoPcStats:b}]=s;const P=_,x=p,H=b,B=qR({},iV),z=qR({},oV),Wt=qR({},$7),{audioTrack:_r,videoTrack:Di,audioSSRC:Fi,videoSSRC:Gi}=i.getRemoteMedia(l),_p=i.getStats(),_f=_p==null?void 0:_p.audioRecv.find(dE=>dE.ssrc===Fi),cE=_p==null?void 0:_p.videoRecv.find(dE=>dE.ssrc===Gi),RE=this.trafficStats&&this.trafficStats.peer_delay.find(dE=>dE.peer_uid===l);if(_f&&(_f.codec!=="opus"&&_f.codec!=="aac"&&_f.codec!=="PCMU"&&_f.codec!=="PCMA"&&_f.codec!=="G722"||(B.codecType=_f.codec),_f.outputLevel?B.receiveLevel=Math.round(32767*_f.outputLevel):_r&&(B.receiveLevel=Math.round(32767*_r.getVolumeLevel())),B.receiveBytes=_f.bytes,B.receivePackets=_f.packets,B.receivePacketsLost=_f.packetsLost,B.packetLossRate=B.receivePacketsLost/(B.receivePackets+B.receivePacketsLost),B.receiveBitrate=P?8*Math.max(0,B.receiveBytes-P.receiveBytes):0,B.totalDuration=P?P.totalDuration+1:1,B.totalFreezeTime=P?P.totalFreezeTime:0,B.freezeRate=B.totalFreezeTime/B.totalDuration,B.receiveDelay=_f.jitterBufferMs,B.totalDuration>10&&CI.isRemoteAudioFreeze(_r)&&(B.totalFreezeTime+=1)),cE){cE.codec!=="H264"&&cE.codec!=="H265"&&cE.codec!=="VP8"&&cE.codec!=="VP9"&&cE.codec!=="AV1X"&&cE.codec!=="AV1"||(z.codecType=cE.codec),z.receiveBytes=cE.bytes,z.receiveBitrate=x?8*Math.max(0,z.receiveBytes-x.receiveBytes):0,z.decodeFrameRate=cE.decodeFrameRate<0?0:cE.decodeFrameRate,z.renderFrameRate=cE.decodeFrameRate<0?0:cE.decodeFrameRate,cE.outputFrame&&(z.renderFrameRate=cE.outputFrame.frameRate),cE.receivedFrame?(z.receiveFrameRate=cE.receivedFrame.frameRate,z.receiveResolutionHeight=cE.receivedFrame.height,z.receiveResolutionWidth=cE.receivedFrame.width):Di&&(z.receiveResolutionHeight=Di._videoHeight||0,z.receiveResolutionWidth=Di._videoWidth||0),cE.framesRateFirefox!==void 0&&(z.receiveFrameRate=Math.round(cE.framesRateFirefox)),z.receivePackets=cE.packets,z.receivePacketsLost=cE.packetsLost,z.packetLossRate=z.receivePacketsLost/(z.receivePackets+z.receivePacketsLost),z.totalDuration=x?x.totalDuration+1:1,z.totalFreezeTime=x?x.totalFreezeTime:0,z.receiveDelay=cE.jitterBufferMs||0;const dE=!!Gi&&i.getRemoteVideoIsReady(Gi);Di&&dE&&CI.isRemoteVideoFreeze(Di,cE,H)&&(z.totalFreezeTime+=1),z.freezeRate=z.totalFreezeTime/z.totalDuration}RE&&(B.end2EndDelay=RE.B_ad,z.end2EndDelay=RE.B_vd,B.transportDelay=RE.B_ed,z.transportDelay=RE.B_ed,B.currentPacketLossRate=RE.B_ealr4/100,z.currentPacketLossRate=RE.B_evlr4/100,Wt.uplinkNetworkQuality=RE.B_punq?RE.B_punq:0,Wt.downlinkNetworkQuality=RE.B_pdnq?RE.B_pdnq:0),this.remoteStats.set(l,{audioStats:B,videoStats:z,videoPcStats:cE,networkStats:Wt}),_r&&this.exceptionMonitor.setRemoteAudioStats(_r,B),Di&&this.exceptionMonitor.setRemoteVideoStats(Di,z)})}}const zS=new class extends I_{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),$(this,"_lastHiddenTime",0),$(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),_e.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function kF(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function MO(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?kF(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):kF(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}function UO(r){return r.match(/^[\.\:\d]+$/)?"".concat(r.replace(/[^\d]/g,"-"),".").concat(kc("TURN_DOMAIN")):(_e.info("Cannot recognized as IP address ".concat(r,". Used As Host instead")),r)}function LF(r,i){var s,l;const p=kc("GATEWAY_DOMAINS");let _=p[1]&&i.indexOf(p[1])!==-1?1:0;r.addresses=r.addresses||[];const b=r.addresses.map(x=>x.domain_prefix?{address:"".concat(x.domain_prefix,".").concat(p[_++%p.length],":").concat(x.port)}:x.ip.match(/^[\.\:\d]+$/)?{ip:x.ip,port:x.port,address:"".concat(x.ip.replace(/[^\d]/g,"-"),".").concat(p[_++%p.length],":").concat(x.port)}:(_e.info("Cannot recognized as IP address ".concat(x.ip,". Used As Host instead")),{ip:x.ip,port:x.port,address:"".concat(x.ip,":").concat(x.port)}));if((s=r.detail)!==null&&s!==void 0&&s[18]&&typeof((l=r.detail)===null||l===void 0?void 0:l[18])=="string"){const x=r.detail[18],H=x==null?void 0:x.split(";");for(let B=0;B<H.length;B++){var P;const z=qS(P=H[B]).call(P);b[B]&&z&&(b[B].ip6=z)}}return{gatewayAddrs:b,uid:r.uid,cid:r.cid,cert:r.cert,vid:r.detail&&r.detail[8],uni_lbs_ip:r.detail&&r.detail[1],res:r,csIp:r.detail&&r.detail[502]}}function JS(r){return typeof r=="number"?r:r.exact||r.ideal||r.max||r.min||0}function MF(r){const i=r._encoderConfig;if(!i)return{};const s={resolution:i.width&&i.height?"".concat(JS(i.width),"x").concat(JS(i.height)):void 0,maxVideoBW:i.bitrateMax,minVideoBW:i.bitrateMin};return typeof i.frameRate=="number"?(s.maxFrameRate=i.frameRate,s.minFrameRate=i.frameRate):i.frameRate&&(s.maxFrameRate=i.frameRate.max||i.frameRate.ideal||i.frameRate.exact||i.frameRate.min,s.minFrameRate=i.frameRate.min||i.frameRate.ideal||i.frameRate.exact||i.frameRate.max),s}function UF(r){return r>=0&&r<.17?1:r>=.17&&r<.36?2:r>=.36&&r<.59?3:r>=.59&&r<=1?4:r>1?5:0}function tL(r,i){let s,l,p;switch(i){case Z_.CHOOSE_SERVER:s=4096,l="choose server";break;case Z_.CLOUD_PROXY:s=1048576,l="proxy";break;case Z_.CLOUD_PROXY_5:s=4194304,l="proxy5";break;case Z_.CLOUD_PROXY_FALLBACK:s=4194310,l="proxy fallback";break;default:throw new _a(_i.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:r.detail&&r.detail[502],retry:!1})}if(r.response_body.forEach(_=>{_.buffer&&_.buffer.flag===s&&(p={code:_.buffer.code,addresses:(_.buffer.edges_services||[]).map(b=>MO(MO({},b),{},{ticket:_.buffer.cert})),server_ts:r.enter_ts,uid:_.buffer.uid,cid:_.buffer.cid,cname:_.buffer.cname,detail:MO(MO({},_.buffer.detail),r.detail),flag:_.buffer.flag,opid:r.opid,cert:_.buffer.cert})}),!p)throw new _a(_i.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(l," from multi unilbs response"),{csIp:r.detail&&r.detail[502]});return p}async function yX(r,i){return await SE.all(r.addresses.map(async s=>({address:UO(s.ip),tcpport:s.port,udpport:s.port,username:i&&kc("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?i.toString():VT.username,password:i&&kc("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await iX(i.toString()):VT.password})))}function bX(r,i){const s=i._videoWidth||i.getMediaStreamTrack(!0).getSettings().width;return s||_e.warning("cannot get original video track's width, default scale down 4 times for low stream"),s?s/JS(r.width):4}function xO(r){let{candidateType:i,relayProtocol:s,type:l,address:p,port:_,protocol:b}=r;return l==="local-candidate"?{candidateType:i,relayProtocol:s,protocol:b}:{candidateType:i,relayProtocol:s,address:p,port:_,protocol:b}}function xF(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function WR(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?xF(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):xF(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}function wI(r){return window.TextEncoder?new TextEncoder().encode(r).length:r.length}function sT(r){return new SE(i=>{window.setTimeout(i,r)})}function TX(r){const i=new _a(_i.TIMEOUT,"timeout");return new SE((s,l)=>{window.setTimeout(()=>l(i),r)})}function b_(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,i=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,r).toLowerCase();return s.length===r?"".concat(i).concat(s):"".concat(i).concat(s)+b_(r-s.length,"")}function eL(){return b_(32,"").toUpperCase()}const jO=()=>{};function jF(r){return new SE((i,s)=>{let l=!1;const p=document.createElement("video");p.setAttribute("autoplay",""),p.setAttribute("muted",""),p.muted=!0,p.autoplay=!0,p.setAttribute("playsinline",""),p.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(p);const _=fT()?"canplay":"playing";p.addEventListener(_,()=>{const b=p.videoWidth,P=p.videoHeight;!b&&A_()||(l=!0,p.srcObject=null,p.remove(),i([b,P]))}),p.srcObject=new MediaStream([r]),p.play().catch(jO),setTimeout(()=>{l||(p.srcObject=null,p.remove(),i([p.videoWidth,p.videoHeight]))},4e3)})}function NI(r){return SE.all(r.map(i=>i.then(s=>{throw s},s=>s))).then(i=>{throw i},i=>i)}function aT(r,i){for(var s=arguments.length,l=new Array(s>2?s-2:0),p=2;p<s;p++)l[p-2]=arguments[p];return r.getListeners(i).length===0?SE.reject(new _a(_i.UNEXPECTED_ERROR,"can not emit promise")):new SE((_,b)=>{r.emit(i,...l,_,b)})}function N_(r,i){if(r.getListeners(i).length===0)return SE.resolve();for(var s=arguments.length,l=new Array(s>2?s-2:0),p=2;p<s;p++)l[p-2]=arguments[p];return aT(r,i,...l)}function hS(r,i){if(r.getListeners(i).length===0)return null;for(var s=arguments.length,l=new Array(s>2?s-2:0),p=2;p<s;p++)l[p-2]=arguments[p];return KR(r,i,...l)}function KR(r,i){let s=null,l=null;for(var p=arguments.length,_=new Array(p>2?p-2:0),b=2;b<p;b++)_[b-2]=arguments[b];if(r.emit(i,..._,P=>{s=P},P=>{l=P}),l!==null)throw l;if(s===null)throw new _a(_i.UNEXPECTED_ERROR,"handler is not sync");return s}function nL(r,i){const s=r.indexOf(i);s!==-1&&r.splice(s,1)}function VF(r){const i=[];return r.forEach(s=>{i.indexOf(s)===-1&&i.push(s)}),i}function IS(r){SE.resolve().then(r)}function G_(r){return JSON.parse(JSON.stringify(r))}const FF={};function c0(r,i){FF[i]||(FF[i]=!0,r())}function rL(r){const i=window.atob(r),s=new Uint8Array(new ArrayBuffer(i.length));for(let l=0;l<i.length;l+=1)s[l]=i.charCodeAt(l);return s}function VO(r){let i="";for(let s=0;s<r.length;s+=1)i+=String.fromCharCode(r[s]);return window.btoa(i)}const BF=new class{constructor(){$(this,"fnMap",new Map)}throttleByKey(r,i,s,l){for(var p=arguments.length,_=new Array(p>4?p-4:0),b=4;b<p;b++)_[b-4]=arguments[b];if(this.fnMap.has(i)){const P=this.fnMap.get(i);if(P.threshold!==s){P.fn(...P.args),clearTimeout(P.timer);const x=window.setTimeout(()=>{const H=this.fnMap.get(i);H&&H.fn(...H.args),this.fnMap.delete(i)},s);this.fnMap.set(i,{fn:r,threshold:s,timer:x,args:_,skipFn:l})}else P.skipFn&&P.skipFn(...P.args),this.fnMap.set(i,WR(WR({},P),{},{fn:r,args:_,skipFn:l}))}else{const P=window.setTimeout(()=>{const x=this.fnMap.get(i);x&&x.fn(...x.args),this.fnMap.delete(i)},s);this.fnMap.set(i,{fn:r,threshold:s,timer:P,args:_,skipFn:l})}}},GF=BF.throttleByKey.bind(BF),u0=async r=>{let{fragementLength:i,referenceList:s,asyncMapHandler:l,allFailedhandler:p,promisesCollector:_}=r,b=0;const P=i;let x,H=0;const B=async()=>{const z=(()=>{const Wt=b*P,_r=Wt+P;return s.slice(Wt,_r).map(l)})();_&&_.push(...z);try{x=await NI(z)}catch(Wt){if(H+=P,b++,!(H>=s.length))return void await B();p(Wt)}z.forEach(Wt=>Wt.cancel())};return await B(),x};function qF(r){return typeof r=="object"&&r!==null&&!(r instanceof RegExp)}const SX={[yI.ACCESS_POINT]:{[nT.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[nT.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[nT.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[nT.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[nT.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[nT.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[nT.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[nT.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[nT.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[nT.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[nT.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[nT.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[nT.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[nT.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[nT.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[nT.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[nT.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[nT.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[yI.UNILBS]:{[FT.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[FT.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[FT.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[FT.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[FT.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[FT.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[FT.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[FT.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[FT.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[FT.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[FT.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[FT.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[yI.STRING_UID_ALLOCATOR]:{[r0.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[r0.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[r0.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function FO(r){const i=SX[Math.floor(r/1e4)];if(!i)return{desc:"unkonw error",retry:!1};const s=i[r%1e4];if(!s){if(Math.floor(r/1e4)===yI.ACCESS_POINT){const l=r%1e4;if(l.toString()[0]==="1")return{desc:r.toString(),retry:!1};if(l.toString()[0]==="2")return{desc:r.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return s}const RX={[kE.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[kE.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[kE.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[kE.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[kE.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[kE.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[kE.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[kE.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[kE.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[kE.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[kE.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[kE.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[kE.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[kE.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[kE.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[kE.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[kE.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[kE.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[kE.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[kE.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[kE.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[kE.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[kE.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[kE.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[kE.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[kE.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[kE.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[kE.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[kE.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[kE.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[kE.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[kE.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[kE.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[kE.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[kE.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[kE.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[kE.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[kE.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[kE.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[kE.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[kE.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[kE.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[kE.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[kE.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[kE.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[kE.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[kE.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[kE.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[kE.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[kE.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[kE.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[kE.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[kE.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[kE.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[kE.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[kE.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[kE.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[kE.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[kE.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[kE.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[kE.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[kE.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[kE.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[kE.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function d0(r){return RX[r]||{desc:"UNKNOW_ERROR_".concat(r),action:"failed"}}function WF(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}class HR extends I_{get url(){return this.websocket?this.websocket.url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(i){["tryNext","recover"].includes(i)&&this.resetReconnectCount(i),this._reconnectMode=i}get state(){return this._state}set state(i){i!==this._state&&(this._state=i,this._state==="reconnecting"?this.emit(xE.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(xE.CONNECTED):this._state==="closed"?this.emit(xE.CLOSED):this._state==="failed"&&this.emit(xE.FAILED))}resetReconnectCount(i){_e.debug("websocket reset reconnect count, reason: "+i),this.reconnectCount=0}constructor(i,s){let l=arguments.length>2&&arguments[2]!==void 0&&arguments[2],p=arguments.length>3&&arguments[3]!==void 0&&arguments[3],_=arguments.length>4?arguments[4]:void 0;super(),$(this,"connectionID",0),$(this,"currentURLIndex",0),$(this,"urls",void 0),$(this,"_reconnectMode","tryNext"),$(this,"reconnectReason",void 0),$(this,"_initMutex",new mT("websocket")),$(this,"name",void 0),$(this,"_state","closed"),$(this,"reconnectInterrupter",void 0),$(this,"websocket",void 0),$(this,"retryConfig",void 0),$(this,"reconnectCount",0),$(this,"forceCloseTimeout",5e3),$(this,"onlineReconnectListener",void 0),$(this,"useCompress",void 0),$(this,"tryDoubleDomain",!1),$(this,"wsInflateLength",0),$(this,"wsDeflateLength",0),$(this,"closeEstablishingWs",()=>{}),$(this,"store",void 0),$(this,"joinChannelServiceRecordIndex",void 0),this.store=_,this.name=i,this.retryConfig=function(B){for(var z=1;z<arguments.length;z++){var Wt=arguments[z]!=null?arguments[z]:{};z%2?WF(Object(Wt),!0).forEach(function(_r){$(B,_r,Wt[_r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(Wt)):WF(Object(Wt)).forEach(function(_r){Object.defineProperty(B,_r,Object.getOwnPropertyDescriptor(Wt,_r))})}return B}({},s),this.useCompress=l,this.tryDoubleDomain=p;const{timeout:b,timeoutFactor:P}=s,x=Math.max(300,Math.floor(3*b/5)),H=Math.max(1.2,Math.floor(8*P)/10);uT.ONLINE&&(this.retryConfig.timeout=x,this.retryConfig.timeoutFactor=H),B_.on(hR.NETWORK_STATE_CHANGE,(B,z)=>{B!==z&&(this.resetReconnectCount("network state change: ".concat(z," -> ").concat(B)),B===uT.ONLINE?(this.retryConfig.timeout=x,this.retryConfig.timeoutFactor=H):(this.retryConfig.timeout=b,this.retryConfig.timeoutFactor=P))})}getConnection(){return this.websocket||void 0}init(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this.forceCloseTimeout=s;const l=(p,_)=>{this.urls=i;const b=this.urls[this.currentURLIndex];this.state="connecting",this.createWebSocketConnection(b).then(p).catch(_),this.once(xE.CLOSED,()=>_(new _a(_i.WS_DISCONNECT))),this.once(xE.CONNECTED,()=>p())};return this._initMutex.lock().then(p=>new SE((_,b)=>{l(_,b)}).then(()=>{p()}).catch(()=>{p()}))}close(i,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const l=this.websocket;s?setTimeout(()=>l.close(),500):l.close(),this.websocket=void 0}this.state=i?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(i,s){if(!this.websocket)return void _e.warning("[".concat(this.name,"] can not reconnect, no websocket"));var l;i!==void 0&&(this.reconnectMode=i),_e.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinChannelServiceRecordIndex=="number"&&((l=this.store)===null||l===void 0||l.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinChannelServiceRecordIndex));const p=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),p&&p.bind(this.websocket)({code:9999,reason:s})}sendMessage(i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new _a(_i.WS_ABORT,"websocket is not ready");try{s||(i=JSON.stringify(i)),this.websocket.send(i)}catch(l){throw new _a(_i.WS_ERR,"send websocket message error"+l.toString())}}setWsInflateData(i){this.wsDeflateLength=this.wsDeflateLength+i.originLength,this.wsInflateLength=this.wsInflateLength+i.compressedLength}getWsInflateData(){const i=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:i,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(i,s){return this.connectionID+=1,this.connectionID,this.joinChannelServiceRecordIndex=void 0,new SE((l,p)=>{var _;const b=B=>{var z;(z=this.store)===null||z===void 0||z.signalChannelOpen(),_e.debug("[".concat(this.name,"] websocket opened:"),B),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),l()},P=async B=>{if(_e.debug("[".concat(this.name,"] websocket close ").concat(this.websocket&&this.websocket.url,", code: ").concat(B.code,", reason: ").concat(B.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=B.reason,this.state="reconnecting");const z=hS(this,xE.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,Wt=await this.reconnectWithAction(z);if(this.state==="closed")return void _e.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!Wt)return p(new _a(_i.WS_DISCONNECT,"websocket reconnect failed: ".concat(B.code))),void this.close(!0);l()}else p(new _a(_i.WS_DISCONNECT,"websocket close: ".concat(B.code))),this.close()},x=B=>{this.emit(xE.ON_MESSAGE,B)};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),kc("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(i=kc("GATEWAY_WSS_ADDRESS")),_e.debug("[".concat(this.name,"] start connect, url: ").concat(i));const H=(_=this.store)===null||_===void 0?void 0:_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});this.chooseBestWebsocketConnection(i,!!s,H).then(B=>{var z;this.websocket=B,b&&b(B.url),B.onclose=P,B.onmessage=x,(z=this.store)===null||z===void 0||z.recordJoinChannelService({endTs:Date.now(),status:"success"},H),this.joinChannelServiceRecordIndex=H}).catch(B=>{var z;if((z=this.store)===null||z===void 0||z.recordJoinChannelService({endTs:Date.now(),status:B instanceof _a&&B.code===_i.WS_ABORT?"aborted":"error",errors:[B]},H),this.state!=="closed"){if(B instanceof _a&&B.code===_i.WS_ERR){const Wt=new _a(_i.WS_ERR,"init websocket failed! Error: ".concat(B.toString()));return _e.error("[".concat(this.name,"]").concat(Wt)),void p(Wt)}P&&P(B)}else p(new _a(_i.WS_DISCONNECT,"websocket is closed: ".concat(B.toString())))})})}async reconnectWithAction(i){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||!this.urls||this.state==="closed")return!1;this.onlineReconnectListener||B_.networkState!==uT.OFFLINE||(this.onlineReconnectListener=B_.onlineWaiter&&B_.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let l=!0;if(this.reconnectInterrupter=()=>{l=!1},s){const b=_P(this.reconnectCount,this.retryConfig);_e.debug("[".concat(this.name,"] wait ").concat(b,"ms to reconnect websocket, mode: ").concat(i)),await SE.race([sT(b),this.onlineReconnectListener||new SE(()=>{})])}if(this.state==="closed"||!l)return!1;this.reconnectCount+=1;const p=async(b,P)=>{this.emit(xE.RECONNECT_CREATE_CONNECTION,P),await this.createWebSocketConnection(b)};try{if(i==="retry"){const b=this.urls[this.currentURLIndex];this.emit(xE.RECONNECT_WAITTING_FINISH,i),await p(b,i)}else if(i==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover",!1);_e.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex));const b=this.urls[this.currentURLIndex];this.emit(xE.RECONNECT_WAITTING_FINISH,i),await p(b,i)}else if(i==="recover"){_e.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(xE.RECONNECT_WAITTING_FINISH,i),this.urls=await aT(this,xE.REQUEST_NEW_URLS),this.currentURLIndex=0;const b=this.urls[this.currentURLIndex];await p(b,i)}return!0}catch(b){var _;return _e.error("[".concat(this.name,"] reconnect failed"),b.toString()),b!=null&&(_=b.data)!==null&&_!==void 0&&_.desc&&Array.isArray(b.data.desc)&&b.data.desc.length&&b.data.desc.includes("dynamic key expired")?(this.emit(xE.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(i,s)}}async chooseBestWebsocketConnection(i,s,l){return new SE((p,_)=>{let b=!1;const P=[];this.closeEstablishingWs=()=>{_e.debug("[choose-best-ws] close establishing websockets"),P.forEach(Fi=>{Fi.onclose=null,Fi.onopen=null,Fi.onmessage=null,Fi.close()}),_(new _a(_i.WS_ABORT,"choose best websocket aborted"))};const x=kc("GATEWAY_DOMAINS");let H;const B=i.indexOf("?h="),z=x.find(Fi=>B!==-1?i.includes(Fi,B):i.includes(Fi));_e.debug("[choose-best-ws] currentDomain: ",z,", domains: ",x);let Wt=!this.tryDoubleDomain||s||!z;if(!Wt&&z){var _r;const Fi=Date.now();try{x.forEach(Gi=>{const _p=B===-1?i.replace(z,Gi):i.substr(0,B)+i.substr(B).replace(z,Gi),_f=new WebSocket(_p);_f.binaryType="arraybuffer",P.push(_f),_e.debug("[choose-best-ws] ws is connecting:",_f.url)})}catch{for(_e.debug("[choose-best-ws] ws create failed, fallback to single url"),P.forEach(_p=>_p.close());P.length;)P.pop();Wt=!0}(_r=this.store)===null||_r===void 0||_r.recordJoinChannelService({urls:P.map(Gi=>Gi.url),service:"gateway"},l),P.forEach(Gi=>{Gi.onopen=()=>{if(b)return;const _p=Date.now()-Fi;_e.debug("[choose-best-ws] ws open cost ".concat(_p,"ms")),P.filter(_f=>_f!==Gi).forEach(_f=>{_e.debug("[choose-best-ws]close backup websocket: ".concat(_f.url)),_f.close()}),b=!0,p(Gi)},Gi.onclose=_p=>{H=_p,!b&&(P.find(_f=>!(_f.readyState===WebSocket.CLOSED||_f.readyState===WebSocket.CLOSING))||(_e.debug("[choose-best-ws] all websocket is closed"),b=!0,_(H)))},Gi.onmessage=_p=>{_e.debug("[choose-best-ws]".concat(Gi.url," onmessage: ").concat(_p.data))}}),sT(this.forceCloseTimeout).then(()=>{P.forEach(Gi=>{Gi.readyState!==WebSocket.OPEN&&Gi.close()})})}if(Wt){var Di;let Fi;_e.debug("[choose-best-ws] use single url: ",i),(Di=this.store)===null||Di===void 0||Di.recordJoinChannelService({urls:[i],service:"gateway"},l);try{Fi=new WebSocket(i),P.push(Fi),Fi.binaryType="arraybuffer"}catch(Gi){const _p=new _a(_i.WS_ERR,"init websocket failed! Error: ".concat(Gi.toString()));return _e.error("[".concat(this.name,"]").concat(_p)),void _(_p)}Fi.onopen=()=>{p(Fi)},Fi.onclose=Gi=>{_(Gi)},Fi.onmessage=Gi=>{_e.debug("[choose-best-ws]".concat(Fi.url," onmessage: ").concat(Gi.data))},sT(this.forceCloseTimeout).then(()=>{Fi&&Fi.readyState!==WebSocket.OPEN&&Fi.close()})}}).then(p=>(this.closeEstablishingWs=void 0,p)).catch(p=>{throw this.closeEstablishingWs=void 0,p})}}class KF{constructor(i){$(this,"input",[]),$(this,"size",void 0),this.size=i}add(i){this.input.push(i),this.input.length>this.size&&this.input.splice(0,1)}mean(){var i;return this.input.length===0?0:iR(i=this.input).call(i,(s,l)=>s+l)/this.input.length}}class HF extends I_{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===d_.CONNECTED?this.emit(wE.WS_CONNECTED):i===d_.RECONNECTING?this.emit(wE.WS_RECONNECTING,this._websocketReconnectReason):i===d_.CLOSED&&this.emit(wE.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(i,s){super(),$(this,"_disconnectedReason",void 0),$(this,"_websocketReconnectReason",void 0),$(this,"_connectionState",d_.CLOSED),$(this,"reconnectToken",void 0),$(this,"websocket",void 0),$(this,"openConnectionTime",void 0),$(this,"clientId",void 0),$(this,"lastMsgTime",Date.now()),$(this,"uploadCache",[]),$(this,"uploadCacheInterval",void 0),$(this,"rttRolling",new KF(5)),$(this,"pingpongTimer",void 0),$(this,"wsInflateDataTimer",void 0),$(this,"pingpongTimeoutCount",0),$(this,"joinResponse",void 0),$(this,"multiIpOption",void 0),$(this,"initError",void 0),$(this,"spec",void 0),$(this,"store",void 0),$(this,"onWebsocketMessage",l=>{if(l.data instanceof ArrayBuffer)return void this.emit(wE.ON_BINARY_DATA,l.data);const p=JSON.parse(l.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(p,"_id")){const _="res-@".concat(p._id);this.emit(_,p._result,p._message)}else if(Object.prototype.hasOwnProperty.call(p,"_type")){if(this.emit(p._type,p._message),p._type===GE.ON_NOTIFICATION&&this.handleNotification(p._message),p._type===GE.ON_USER_BANNED)switch(p._message.error_code){case 14:this.close(o_.UID_BANNED);break;case 15:this.close(o_.IP_BANNED);break;case 16:this.close(o_.CHANNEL_BANNED)}if(p._type===GE.ON_USER_LICENSE_BANNED)switch(p._message.error_code){case kE.ERR_LICENSE_MISSING:this.close(o_.LICENSE_MISSING);break;case kE.ERR_LICENSE_EXPIRED:this.close(o_.LICENSE_EXPIRED);break;case kE.ERR_LICENSE_MINUTES_EXCEEDED:this.close(o_.LICENSE_MINUTES_EXCEEDED);break;case kE.ERR_LICENSE_PERIOD_INVALID:this.close(o_.LICENSE_PERIOD_INVALID);break;case kE.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(o_.LICENSE_MULTIPLE_SDK_SERVICE);break;case kE.ERR_LICENSE_ILLEGAL:this.close(o_.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=i.clientId,this.spec=i,this.store=s,this.websocket=new HR("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===d_.CONNECTED&&this.reconnect("retry",bT.OFFLINE)})}async request(i,s,l,p){const _=b_(6,""),b={_id:_,_type:i,_message:s},P=this.websocket.connectionID,x=()=>new SE((Di,Fi)=>{if(this.connectionState===d_.CONNECTED)return Di();const Gi=()=>{this.off(wE.WS_CLOSED,_p),Di()},_p=()=>{this.off(wE.WS_CONNECTED,Gi),Fi(new _a(_i.WS_ABORT))};this.once(wE.WS_CONNECTED,Gi),this.once(wE.WS_CLOSED,_p),i!==LE.PUBLISH&&i!==LE.SUBSCRIBE&&i!==LE.UNSUBSCRIBE&&i!==LE.UNPUBLISH&&i!==LE.CONTROL&&i!==LE.RESTART_ICE||this.once(wE.DISCONNECT_P2P,()=>{Fi(new _a(_i.DISCONNECT_P2P))}),i!==LE.PUBLISH&&i!==LE.RESTART_ICE||this.once(wE.ABORT_P2P_EXECUTION,()=>{Fi(new _a(_i.DISCONNECT_P2P))})});if(this.connectionState!==d_.CONNECTING&&this.connectionState!==d_.RECONNECTING||i===LE.JOIN||i===LE.REJOIN||await x(),this.websocket.sendMessage(b,!0),p)return;const H=new SE((Di,Fi)=>{let Gi=!1;const _p=(cE,RE)=>{Gi=!0,Di({isSuccess:cE==="success",message:RE||{}}),this.off(wE.WS_CLOSED,_f),this.off(wE.WS_RECONNECTING,_f),this.emit(wE.REQUEST_SUCCESS,i,s)};this.once("res-@".concat(_),_p);const _f=()=>{Fi(new _a(_i.WS_ABORT,"type: ".concat(i))),this.off(wE.WS_CLOSED,_f),this.off(wE.WS_RECONNECTING,_f),this.off("res-@".concat(_),_p)};this.once(wE.WS_CLOSED,_f),this.once(wE.WS_RECONNECTING,_f),sT(kc("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==P||Gi||(_e.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(i)),this.emit(wE.REQUEST_TIMEOUT,i,s))})});let B=null;try{B=await H}catch(Di){if(this.connectionState===d_.CLOSED||i===LE.LEAVE)throw new _a(_i.WS_ABORT);return!this.spec.forceWaitGatewayResponse||l?Di.throw():i===LE.JOIN||i===LE.REJOIN?null:(await x(),await this.request(i,s))}if(B.isSuccess)return B.message;const z=Number(B.message.error_code||B.message.code),Wt=d0(z),_r=new _a(_i.UNEXPECTED_RESPONSE,"".concat(Wt.desc,": ").concat(B.message.error_str),{code:z,data:B.message});return Wt.action==="success"?B.message:(_e.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(z,", message: ").concat(Wt.desc,", action: ").concat(Wt.action)),z===kE.ERR_TOO_MANY_BROADCASTERS?((i===LE.JOIN||i===LE.REJOIN)&&(this.initError=_r,this.close()),_r.throw()):Wt.action==="failed"?_r.throw():Wt.action==="quit"?(this.initError=_r,this.close(),_r.throw()):(z===kE.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=B.message.option,_e.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",bT.MULTI_IP)):this.reconnect(Wt.action,bT.SERVER_ERROR),i===LE.JOIN||i===LE.REJOIN?null:await this.request(i,s)))}waitMessage(i,s){return new SE(l=>{const p=_=>{(!s||s(_))&&(this.off(i,p),l(_))};this.on(i,p)})}upload(i,s){const l={_type:i,_message:s};try{this.websocket.sendMessage(l)}catch{const _=kc("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(l),this.uploadCache.length>_&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==d_.CONNECTED)return;const b=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(b._type,b._message)},kc("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,s){const l={_type:i,_message:s};this.websocket.sendMessage(l)}init(i,s){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new SE((l,p)=>{this.once(wE.WS_CONNECTED,()=>l(this.joinResponse)),this.once(wE.WS_CLOSED,()=>p(this.initError||new _a(_i.WS_ABORT))),this.connectionState=d_.CONNECTING,this.websocket.init(i).catch(p),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4),setTimeout(()=>{s&&this.openConnectionTime===void 0&&(_e.debug("[".concat(this.clientId,"] init websocket timeout while join with fallback to proxy")),p(new _a(_i.INIT_WEBSOCKET_TIMEOUT)))},kc("JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION"))})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||o_.LEAVE,this.connectionState=d_.CLOSED,_e.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),i===o_.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new HR("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(wE.ABORT_P2P_EXECUTION);const i=await aT(this,wE.REQUEST_JOIN_INFO),s=await this.request(LE.JOIN,i);if(!s)return this.emit(wE.REPORT_JOIN_GATEWAY,_i.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(wE.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=d_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new _a(_i.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=KR(this,wE.REQUEST_REJOIN_INFO);i.token=this.reconnectToken;const s=await this.request(LE.REJOIN,i);return!!s&&(this.connectionState=d_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(l=>{this.emit(GE.ON_USER_ONLINE,{uid:l.uid}),l.audio&&this.emit(GE.ON_ADD_AUDIO_STREAM,{uid:l.uid,uint_id:l.uint_id,audio:!0,ssrcId:l.audio_ssrc}),l.video&&this.emit(GE.ON_ADD_VIDEO_STREAM,{uid:l.uid,uint_id:l.uint_id,video:!0,ssrcId:l.video_ssrc}),l.audio_mute?this.emit(GE.MUTE_AUDIO,{uid:l.uid}):this.emit(GE.UNMUTE_AUDIO,{uid:l.uid}),l.video_mute?this.emit(GE.MUTE_VIDEO,{uid:l.uid}):this.emit(GE.UNMUTE_VIDEO,{uid:l.uid}),l.audio_enable_local?this.emit(GE.ENABLE_LOCAL_AUDIO,{uid:l.uid}):this.emit(GE.DISABLE_LOCAL_AUDIO,{uid:l.uid}),l.video_enable_local?this.emit(GE.ENABLE_LOCAL_VIDEO,{uid:l.uid}):this.emit(GE.DISABLE_LOCAL_VIDEO,{uid:l.uid}),l.audio||l.video||this.emit(GE.ON_REMOVE_STREAM,{uid:l.uid,uint_id:l.uint_id})}),!0)}reconnect(i,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,s)}handleNotification(i){_e.debug("[".concat(this.clientId,"] receive notification: "),i);const s=d0(i.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(o_.UID_BANNED),void this.close()):void this.reconnect(s.action,bT.SERVER_ERROR);_e.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=kc("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=i&&(_e.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>kc("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",bT.TIMEOUT):this.request(LE.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const l=Date.now()-s;this.rttRolling.add(l),kc("REPORT_STATS")&&this.send(LE.PING_BACK,{pingpongElapse:l})}).catch(l=>{})}handleWsInflateData(){const{wsInflateLength:i,wsDeflateLength:s}=this.websocket.getWsInflateData();i!==0&&s!==0&&this.upload(PT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:i})}handleWebsocketEvents(){this.websocket.on(xE.RECONNECT_WAITTING_FINISH,i=>{this.emit(wE.WS_RECONNECT_WAITTING_FINISH,i)}),this.websocket.on(xE.RECONNECT_CREATE_CONNECTION,i=>{this.emit(wE.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(xE.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(xE.CLOSED,()=>{this.connectionState=d_.CLOSED}),this.websocket.on(xE.FAILED,()=>{this._disconnectedReason=o_.NETWORK_ERROR,this.connectionState=d_.CLOSED}),this.websocket.on(xE.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState===d_.CONNECTED?this.connectionState=d_.RECONNECTING:this.connectionState=d_.CONNECTING}),this.websocket.on(xE.WILL_RECONNECT,(i,s)=>{if(KR(this,wE.IS_P2P_DISCONNECTED)&&i==="retry")return _e.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(wE.NEED_RENEW_SESSION),this.emit(wE.DISCONNECT_P2P),s("tryNext");i!=="retry"&&(_e.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(i)),this.reconnectToken=void 0,this.emit(wE.NEED_RENEW_SESSION),this.emit(wE.DISCONNECT_P2P)),s(i)}),this.websocket.on(xE.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{_e.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",bT.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(wE.REPORT_JOIN_GATEWAY,i.message||i.code,this.url||""),i instanceof _a&&i.code===_i.UNEXPECTED_RESPONSE&&i.data.code===kE.ERR_NO_AUTHORIZED)return _e.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",bT.SERVER_ERROR);_e.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",bT.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(xE.REQUEST_NEW_URLS,(i,s)=>{aT(this,wE.REQUEST_RECOVER,this.multiIpOption).then(i).catch(s)}),this.websocket.on(xE.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(GE.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function YF(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}class IX extends I_{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(i){["tryNext","recover"].includes(i)&&this.resetReconnectCount(i),this._reconnectMode=i}get state(){return this._state}set state(i){i!==this._state&&(this._state=i,this._state==="reconnecting"?this.emit(C_.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(C_.CONNECTED):this._state==="closed"?this.emit(C_.CLOSED):this._state==="failed"&&this.emit(C_.FAILED))}constructor(i,s,l,p){super(),$(this,"connectionID",0),$(this,"currentURLIndex",0),$(this,"reconnectReason",void 0),$(this,"_reconnectMode","tryNext"),$(this,"_initMutex",void 0),$(this,"_name",void 0),$(this,"_state","closed"),$(this,"_reconnectInterrupter",void 0),$(this,"_url",void 0),$(this,"_retryConfig",void 0),$(this,"_reconnectCount",0),$(this,"_forceCloseTimeout",5e3),$(this,"_onlineReconnectListener",void 0),$(this,"_closeEstablishingTransmitter",()=>{}),$(this,"_store",void 0),$(this,"_joinChannelServiceRecordIndex",void 0),$(this,"_transmitter",void 0),$(this,"_useCompress",void 0),$(this,"_inflateLength",0),$(this,"_deflateLength",0),this._store=p,this._name=i,this._retryConfig=function(_){for(var b=1;b<arguments.length;b++){var P=arguments[b]!=null?arguments[b]:{};b%2?YF(Object(P),!0).forEach(function(x){$(_,x,P[x])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(P)):YF(Object(P)).forEach(function(x){Object.defineProperty(_,x,Object.getOwnPropertyDescriptor(P,x))})}return _}({},s),this._useCompress=l}resetReconnectCount(i){_e.debug("".concat(this._name," reset reconnect count, reason: ").concat(i)),this._reconnectCount=0}close(i,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const l=this._transmitter;s?setTimeout(()=>l.close(),500):l.close(),this._transmitter=void 0}this.state=i?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(i,s){if(!this._transmitter)return void _e.warning("[".concat(this._name,"] can not reconnect, no websocket"));var l;i!==void 0&&(this.reconnectMode=i),_e.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((l=this._store)===null||l===void 0||l.recordJoinChannelService({status:"error",errors:[new Error(s)]},this._joinChannelServiceRecordIndex));const p=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),p&&p.bind(this._transmitter)({code:9999,reason:s})}getInflateData(){const i=this._inflateLength,s=this._deflateLength;return this.clearInflateData(),{inflateLength:i,deflateLength:s}}setInflateData(i){this._deflateLength=this._deflateLength+i.originLength,this._inflateLength=this._inflateLength+i.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}function zF(r,i,s){if("getBigUint64"in DataView.prototype)return r.getBigUint64(i,s);const l=r.getUint32(i,s),p=r.getUint32(i+4,s),_=+!!s,b=+!s;return BigInt(l*b+p*_)<<BigInt(32)|BigInt(l*_+p*b)}function JF(r,i,s,l){if("setBigUint64"in DataView.prototype)return r.setBigUint64(i,s,l);const p=Number(s>>BigInt(32)),_=Number(s&BigInt(4294967295));l?(r.setUint32(i+4,p,l),r.setUint32(i,_,l)):(r.setUint32(i,p,l),r.setUint32(i+4,_,l))}let tS;(function(r){r[r.Default=0]="Default",r[r.Ack=1]="Ack"})(tS||(tS={}));class OX{constructor(i,s,l){$(this,"version",1),$(this,"initialRTO",void 0),$(this,"maxBatchAckCount",void 0),$(this,"maxRTO",void 0),$(this,"initialRTT",void 0),$(this,"ID",void 0),$(this,"rtt",void 0),$(this,"packetNumber",1),$(this,"rtoRatioMap",new Map),$(this,"timeoutMap",new Map),$(this,"unorderedPacketQueue",[]),$(this,"batchAckPacketQueue",[]),$(this,"lastOrderedPacketNumber",0),$(this,"batchAckTimer",void 0),$(this,"sendImpl",void 0),$(this,"receiveImpl",void 0),this.sendImpl=i,this.receiveImpl=s,this.ID=b_(7,"transmitter-"),this.initialRTO=(l==null?void 0:l.initialRTO)!==void 0?l.initialRTO:kc("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(l==null?void 0:l.initialRTT)!==void 0?l.initialRTT:kc("TRANSMITTER_INITIAL_RTT"),this.rtt=(l==null?void 0:l.initialRTT)!==void 0?l.initialRTT:kc("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(l==null?void 0:l.maxBatchAckCount)!==void 0?l.maxBatchAckCount:kc("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(l==null?void 0:l.maxRTO)!==void 0?l.maxRTO:kc("TRANSMITTER_MAX_RTO")}packetize(i,s){return{type:tS.Default,version:this.version,packetNumber:s,payload:i}}serialize(i){switch(i.type){case tS.Default:{let s;typeof i.payload=="string"?s=new TextEncoder().encode(i.payload):s=i.payload;const l=new ArrayBuffer(s.length+15),p=new DataView(l);return p.setUint16(0,i.version),p.setUint8(2,i.type),p.setUint32(3,i.packetNumber),JF(p,7,BigInt(i.sendTs)),new Uint8Array(p.buffer).set(s,15),l}case tS.Ack:{const s=new ArrayBuffer(16),l=new DataView(s);return l.setUint16(0,i.version),l.setUint8(2,i.type),l.setUint32(3,i.maxAckPacketNumber),l.setUint8(7,i.shift),JF(l,8,BigInt(i.ackSendTs)),s}}}deserialize(i){const s=new DataView(i),l=s.getUint16(0),p=s.getUint8(2);switch(p){case tS.Default:{const _=s.getUint32(3),b=zF(s,7),P=i.slice(15),x=new TextDecoder().decode(P);return{version:l,type:p,packetNumber:_,sendTs:Number(b),payload:x}}case tS.Ack:{const _=s.getUint32(3),b=s.getUint8(7),P=zF(s,8);return{version:l,type:p,maxAckPacketNumber:_,shift:b,ackSendTs:Number(P)}}default:throw _e.error("[".concat(this.ID,"] Unrecognized packet type ").concat(p)),new Error("Unrecognized packet type ".concat(p))}}sendMessage(i){const s=this.packetize(i,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const l=this.calculateRTO(s),p=window.setTimeout(()=>{this.resendMessage(s)},l);this.timeoutMap.set(s.packetNumber,p),this.sendPacket(s)}onData(i){const s=this.deserialize(i);s.type===tS.Default?this.ack(s):s.type===tS.Ack&&(this.updateRTT(s,Math.round(performance.now())),this.clearRTO(s))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(i=>{let[s,l]=i;window.clearTimeout(l)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(i){const s=this.calculateRTO(i),l=window.setTimeout(()=>{this.resendMessage(i)},s);this.timeoutMap.set(i.packetNumber,l),this.sendPacket(i)}calculateRTO(i){const s=this.rtoRatioMap.get(i.packetNumber);if(s===void 0)return this.rtoRatioMap.set(i.packetNumber,1),this.initialRTO;{const l=9*this.rtt/8*s;return this.rtoRatioMap.set(i.packetNumber,s+1),l>this.maxRTO?this.maxRTO:l}}updateRTT(i,s){const l=i.ackSendTs;this.rtt=this.rtt*(7/8)+(s-l-this.rtt)/8}ack(i){if(i.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(i):(this.batchAckPacketQueue.push(i),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(i.payload);;){const s=this.unorderedPacketQueue[0];if(!s){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(s.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(i.packetNumber<=this.lastOrderedPacketNumber){const s={ackSendTs:i.sendTs,maxAckPacketNumber:i.packetNumber,shift:0,type:tS.Ack,version:this.version};this.sendPacket(s)}else if(i.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[i.packetNumber-this.lastOrderedPacketNumber-2]=i;const s={ackSendTs:i.sendTs,maxAckPacketNumber:i.packetNumber,shift:0,type:tS.Ack,version:this.version};this.sendPacket(s)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const i={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:tS.Ack,version:this.version};this.sendPacket(i),this.batchAckPacketQueue=[]}sendPacket(i){i.type===tS.Default&&(i.sendTs=Math.round(performance.now()));const s=this.serialize(i);this.sendImpl(s)}clearRTO(i){for(let s=i.maxAckPacketNumber-i.shift;s<=i.maxAckPacketNumber;s++){const l=this.timeoutMap.get(s);l!==void 0&&window.clearTimeout(l),this.timeoutMap.delete(s),this.rtoRatioMap.delete(s)}}}class XF extends IX{constructor(i,s){super(i,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),$(this,"_initMutex",void 0),$(this,"_reconnectInterrupter",void 0),$(this,"_url",void 0),$(this,"_transmitter",void 0),$(this,"_addresses",void 0),$(this,"_reliableTransmission",void 0),this._initMutex=new mT("datachannel");const{timeout:l,timeoutFactor:p}=s,_=Math.max(300,Math.floor(3*l/5)),b=Math.max(1.2,Math.floor(8*p)/10);uT.ONLINE&&(this._retryConfig.timeout=_,this._retryConfig.timeoutFactor=b),B_.on(hR.NETWORK_STATE_CHANGE,(P,x)=>{P!==x&&(this.resetReconnectCount("network state change: ".concat(x," -> ").concat(P)),P===uT.ONLINE?(this._retryConfig.timeout=_,this._retryConfig.timeoutFactor=b):(this._retryConfig.timeout=l,this._retryConfig.timeoutFactor=p))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=s;const l=(p,_)=>{this._addresses=i,this.currentURLIndex=this._addresses.findIndex(P=>P.fingerprint||kc("FINGERPRINT"));const b=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(b).then(p).catch(_),this.once(C_.CLOSED,()=>_(new _a(_i.WS_DISCONNECT))),this.once(C_.CONNECTED,()=>p())};return this._initMutex.lock().then(p=>new SE((_,b)=>{l(_,b)}).then(()=>{p()}).catch(()=>{p()}))}sendMessage(i){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new _a(_i.WS_ABORT,"datachannel is not ready");try{s||(i=JSON.stringify(i)),this._reliableTransmission.sendMessage(i)}catch(l){throw new _a(_i.WS_ERR,"send datachannel signal message error"+l.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(i){const s=JSON.stringify(i);return{compressed:s,compressedLength:s.length,origin:i}}sendMessageWithUint8Array(i){return{compressed:i,compressedLength:i.byteLength,origin:i}}createTransmitterConnection(i){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(i.ip,":").concat(i.port),new SE((s,l)=>{var p;const _=()=>{_e.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),s()},b=async B=>{var z;if((z=this._closeEstablishingTransmitter)===null||z===void 0||z.call(this),_e.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(B.code,", reason: ").concat(B.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=B.reason,this.state="reconnecting");const Wt=hS(this,C_.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,_r=await this.reconnectWithAction(Wt);if(this.state==="closed")return void _e.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!_r)return l(new _a(_i.WS_DISCONNECT,"datachannel reconnect failed: ".concat(B.code))),void this.close(!0);s()}else l(new _a(_i.WS_DISCONNECT,"datachannel close: ".concat(B.code))),this.close()},P=B=>{var z;(z=this._reliableTransmission)===null||z===void 0||z.onData(B.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),_e.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(i)));const x=(p=this._store)===null||p===void 0?void 0:p.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),H=Date.now();aT(this,C_.TO_CONNECT_DATACHANNEL,i).then(B=>{var z,Wt;if(!B)throw new Error("transmissonInfo not exist yet");const{transmitter:_r,close:Di}=B;this._transmitter=_r,(z=this._store)===null||z===void 0||z.signalChannelOpen();const Fi=Date.now()-H;_e.debug("[choose dc] dc open cost ".concat(Fi,"ms")),this._reliableTransmission=new OX(Gi=>{var _p;this._transmitter&&this._transmitter.readyState==="open"&&((_p=this._transmitter)===null||_p===void 0||_p.send(Gi))},Gi=>{typeof Gi=="string"&&this.emit(C_.ON_MESSAGE,Gi)}),this._closeEstablishingTransmitter=()=>{var Gi;(Gi=this._reliableTransmission)===null||Gi===void 0||Gi.close(),this._reliableTransmission=void 0,Di()},_&&_(),_r.onclose=b,_r.onmessage=P,(Wt=this._store)===null||Wt===void 0||Wt.recordJoinChannelService({endTs:Date.now(),status:"success"},x),this._joinChannelServiceRecordIndex=x}).catch(B=>{var z;if((z=this._store)===null||z===void 0||z.recordJoinChannelService({endTs:Date.now(),status:B instanceof _a&&B.code===_i.WS_ABORT?"aborted":"error",errors:[B]},x),this.state!=="closed"){if(B instanceof _a&&B.code===_i.WS_ERR){const Wt=new _a(_i.WS_ERR,"init datachannel failed! Error: ".concat(B.toString()));return _e.error("[".concat(this._name,"]").concat(Wt)),void l(Wt)}b&&b(B)}else l(new _a(_i.WS_DISCONNECT,"datachannel is closed: ".concat(B.toString())))})})}async reconnectWithAction(i){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||B_.networkState!==uT.OFFLINE||(this._onlineReconnectListener=B_.onlineWaiter&&B_.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let l=!0;if(this._reconnectInterrupter=()=>{l=!1},s){const b=_P(this._reconnectCount,this._retryConfig);_e.debug("[".concat(this._name,"] wait ").concat(b,"ms to reconnect datachannel, mode: ").concat(i)),await SE.race([sT(b),this._onlineReconnectListener||new SE(()=>{})])}if(this.state==="closed"||!l)return!1;this._reconnectCount+=1;const p=async(b,P)=>{this.emit(C_.RECONNECT_CREATE_CONNECTION,P),await this.createTransmitterConnection(b)};try{if(i==="retry"){const b=this._addresses[this.currentURLIndex];this.emit(C_.RECONNECT_WAITTING_FINISH,i),await p(b,i)}else if(i==="tryNext"){this.currentURLIndex+=1;for(let P=this.currentURLIndex;P<this._addresses.length;P++){if(this._addresses[P].fingerprint||kc("FINGERPRINT")){this.currentURLIndex=P;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return _e.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);_e.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const b=this._addresses[this.currentURLIndex];this.emit(C_.RECONNECT_WAITTING_FINISH,i),await p(b,i)}else i==="recover"&&(_e.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(C_.RECONNECT_WAITTING_FINISH,i),this.emit(C_.FAILBACK));return!0}catch(b){var _;return _e.error("[".concat(this._name,"] reconnect failed"),b.toString()),b!=null&&(_=b.data)!==null&&_!==void 0&&_.desc&&Array.isArray(b.data.desc)&&b.data.desc.length&&b.data.desc.includes("dynamic key expired")?(this.emit(C_.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(i,s)}}}class XS extends I_{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===d_.CONNECTED?this.emit(wE.WS_CONNECTED):i===d_.RECONNECTING?this.emit(wE.WS_RECONNECTING,this._websocketReconnectReason):i===d_.CLOSED&&this.emit(wE.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(i,s){super(),$(this,"_disconnectedReason",void 0),$(this,"_websocketReconnectReason",void 0),$(this,"_connectionState",d_.CLOSED),$(this,"reconnectToken",void 0),$(this,"websocket",void 0),$(this,"openConnectionTime",void 0),$(this,"clientId",void 0),$(this,"lastMsgTime",Date.now()),$(this,"uploadCache",[]),$(this,"uploadCacheInterval",void 0),$(this,"rttRolling",new KF(5)),$(this,"pingpongTimer",void 0),$(this,"inflateDataTimer",void 0),$(this,"pingpongTimeoutCount",0),$(this,"joinResponse",void 0),$(this,"multiIpOption",void 0),$(this,"initError",void 0),$(this,"spec",void 0),$(this,"store",void 0),$(this,"onWebsocketMessage",l=>{if(l instanceof ArrayBuffer)return void this.emit(wE.ON_BINARY_DATA,l);const p=JSON.parse(l);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(p,"_id")){const _="res-@".concat(p._id);this.emit(_,p._result,p._message)}else if(Object.prototype.hasOwnProperty.call(p,"_type")&&(this.emit(p._type,p._message),p._type===GE.ON_NOTIFICATION&&this.handleNotification(p._message),p._type===GE.ON_USER_BANNED))switch(p._message.error_code){case 14:this.close(o_.UID_BANNED);break;case 15:this.close(o_.IP_BANNED);break;case 16:this.close(o_.CHANNEL_BANNED)}}),this.clientId=i.clientId,this.spec=i,this.store=s,this.websocket=new XF("gateway-".concat(this.clientId),this.spec.retryConfig,!0,s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===d_.CONNECTED&&this.reconnect("retry",kS.OFFLINE)})}async request(i,s,l,p){const _=b_(6,""),b={_id:_,_type:i,_message:s},P=this.websocket.connectionID,x=()=>new SE((Di,Fi)=>{if(this.connectionState===d_.CONNECTED)return Di();const Gi=()=>{this.off(wE.WS_CLOSED,_p),Di()},_p=()=>{this.off(wE.WS_CONNECTED,Gi),Fi(new _a(_i.WS_ABORT))};this.once(wE.WS_CONNECTED,Gi),this.once(wE.WS_CLOSED,_p),i!==LE.PUBLISH&&i!==LE.SUBSCRIBE&&i!==LE.UNSUBSCRIBE&&i!==LE.UNPUBLISH&&i!==LE.CONTROL&&i!==LE.RESTART_ICE||this.once(wE.DISCONNECT_P2P,()=>{Fi(new _a(_i.DISCONNECT_P2P))}),i!==LE.PUBLISH&&i!==LE.RESTART_ICE||this.once(wE.ABORT_P2P_EXECUTION,()=>{Fi(new _a(_i.DISCONNECT_P2P))})});if(this.connectionState!==d_.CONNECTING&&this.connectionState!==d_.RECONNECTING||i===LE.JOIN||i===LE.REJOIN||await x(),i===LE.LEAVE&&(this.websocket.unbindDcCloseEventListener(),p=!0),this.websocket.sendMessage(b,!0,!1),p)return;const H=new SE((Di,Fi)=>{let Gi=!1;const _p=(cE,RE)=>{Gi=!0,Di({isSuccess:cE==="success",message:RE||{}}),this.off(wE.WS_CLOSED,_f),this.off(wE.WS_RECONNECTING,_f),this.emit(wE.REQUEST_SUCCESS,i,s)};this.once("res-@".concat(_),_p);const _f=()=>{Fi(new _a(_i.WS_ABORT,"type: ".concat(i))),this.off(wE.WS_CLOSED,_f),this.off(wE.WS_RECONNECTING,_f),this.off("res-@".concat(_),_p)};this.once(wE.WS_CLOSED,_f),this.once(wE.WS_RECONNECTING,_f),sT(kc("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==P||Gi||(_e.warning("dc request timeout, type: ".concat(i)),this.emit(wE.REQUEST_TIMEOUT,i,s))})});let B=null;try{B=await H}catch(Di){if(this.connectionState===d_.CLOSED||i===LE.LEAVE)throw new _a(_i.WS_ABORT);return!this.spec.forceWaitGatewayResponse||l?Di.throw():i===LE.JOIN||i===LE.REJOIN?null:(await x(),await this.request(i,s))}if(B.isSuccess)return B.message;const z=Number(B.message.error_code||B.message.code),Wt=d0(z),_r=new _a(_i.UNEXPECTED_RESPONSE,"".concat(Wt.desc,": ").concat(B.message.error_str),{code:z,data:B.message});return Wt.action==="success"?B.message:(_e.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(z,", message: ").concat(Wt.desc,", action: ").concat(Wt.action)),z===kE.ERR_TOO_MANY_BROADCASTERS?((i===LE.JOIN||i===LE.REJOIN)&&(this.initError=_r,this.close()),_r.throw()):Wt.action==="failed"?_r.throw():Wt.action==="quit"?(this.initError=_r,this.close(),_r.throw()):(z===kE.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=B.message.option,_e.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",kS.MULTI_IP)):this.reconnect(Wt.action,kS.SERVER_ERROR),i===LE.JOIN||i===LE.REJOIN?null:await this.request(i,s)))}waitMessage(i,s){return new SE(l=>{const p=_=>{(!s||s(_))&&(this.off(i,p),l(_))};this.on(i,p)})}upload(i,s){const l={_type:i,_message:s};try{this.websocket.sendMessage(l)}catch{const _=kc("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(l),this.uploadCache.length>_&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==d_.CONNECTED)return;const b=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(b._type,b._message)},kc("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,s){const l={_type:i,_message:s};this.websocket.sendMessage(l)}init(i,s){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new SE((l,p)=>{this.once(wE.WS_CONNECTED,()=>l(this.joinResponse)),this.once(wE.WS_CLOSED,()=>p(this.initError||new _a(_i.WS_ABORT))),this.connectionState=d_.CONNECTING,this.websocket.init(i).catch(p),this.websocket.once(C_.FAILBACK,()=>{this.openConnectionTime===void 0&&p(new _a(_i.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{s&&this.openConnectionTime===void 0&&(_e.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),p(new _a(_i.INIT_DATACHANNEL_TIMEOUT)))},kc("DC_JOIN_WITH_FAILBACK"))})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||o_.LEAVE,this.connectionState=d_.CLOSED,_e.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),i===o_.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new XF("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(wE.ABORT_P2P_EXECUTION);const i=await aT(this,wE.DATACHANNEL_CONNECTING),s=await this.request(LE.JOIN,i);if(!s)return this.emit(wE.REPORT_JOIN_GATEWAY,_i.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(wE.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=d_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new _a(_i.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=KR(this,wE.REQUEST_REJOIN_INFO);i.token=this.reconnectToken;const s=await this.request(LE.REJOIN,i);return!!s&&(this.connectionState=d_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(l=>{this.emit(GE.ON_USER_ONLINE,{uid:l.uid}),l.audio&&this.emit(GE.ON_ADD_AUDIO_STREAM,{uid:l.uid,uint_id:l.uint_id,audio:!0,ssrcId:l.audio_ssrc}),l.video&&this.emit(GE.ON_ADD_VIDEO_STREAM,{uid:l.uid,uint_id:l.uint_id,video:!0,ssrcId:l.video_ssrc}),l.audio_mute?this.emit(GE.MUTE_AUDIO,{uid:l.uid}):this.emit(GE.UNMUTE_AUDIO,{uid:l.uid}),l.video_mute?this.emit(GE.MUTE_VIDEO,{uid:l.uid}):this.emit(GE.UNMUTE_VIDEO,{uid:l.uid}),l.audio_enable_local?this.emit(GE.ENABLE_LOCAL_AUDIO,{uid:l.uid}):this.emit(GE.DISABLE_LOCAL_AUDIO,{uid:l.uid}),l.video_enable_local?this.emit(GE.ENABLE_LOCAL_VIDEO,{uid:l.uid}):this.emit(GE.DISABLE_LOCAL_VIDEO,{uid:l.uid}),l.audio||l.video||this.emit(GE.ON_REMOVE_STREAM,{uid:l.uid,uint_id:l.uint_id})}),!0)}reconnect(i,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,s)}handleNotification(i){_e.debug("[".concat(this.clientId,"] receive notification: "),i);const s=d0(i.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(o_.UID_BANNED),void this.close()):void this.reconnect(s.action,kS.SERVER_ERROR);_e.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=kc("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=i&&(_e.warning("PINGPONG Timeout. Last Socket Message: ".concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>kc("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",kS.TIMEOUT):this.request(LE.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const l=Date.now()-s;this.rttRolling.add(l),kc("REPORT_STATS")&&this.send(LE.PING_BACK,{pingpongElapse:l})}).catch(l=>{})}handleInflateData(){const{inflateLength:i,deflateLength:s}=this.websocket.getInflateData();i!==0&&s!==0&&this.upload(PT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:i})}handleWebsocketEvents(){this.websocket.on(C_.RECONNECT_WAITTING_FINISH,i=>{this.emit(wE.WS_RECONNECT_WAITTING_FINISH,i)}),this.websocket.on(C_.RECONNECT_CREATE_CONNECTION,i=>{this.emit(wE.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(C_.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(C_.CLOSED,()=>{this.connectionState=d_.CLOSED}),this.websocket.on(C_.FAILED,()=>{this._disconnectedReason=o_.NETWORK_ERROR,this.connectionState=d_.CLOSED}),this.websocket.on(C_.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState===d_.CONNECTED?this.connectionState=d_.RECONNECTING:this.connectionState=d_.CONNECTING}),this.websocket.on(C_.WILL_RECONNECT,(i,s)=>{if(KR(this,wE.IS_P2P_DISCONNECTED)&&i==="retry")return _e.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(wE.NEED_RENEW_SESSION),this.emit(wE.DISCONNECT_P2P),s("tryNext");i!=="retry"&&(_e.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(i)),this.reconnectToken=void 0,this.emit(wE.NEED_RENEW_SESSION),this.emit(wE.DISCONNECT_P2P)),s(i)}),this.websocket.on(C_.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{_e.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",kS.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(wE.REPORT_JOIN_GATEWAY,i.message||i.code,this.url||""),i instanceof _a&&i.code===_i.UNEXPECTED_RESPONSE&&i.data.code===kE.ERR_NO_AUTHORIZED)return _e.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",kS.SERVER_ERROR);_e.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",kS.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(C_.REQUEST_NEW_URLS,(i,s)=>{aT(this,wE.REQUEST_RECOVER,this.multiIpOption).then(i).catch(s)}),this.websocket.on(C_.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(GE.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(C_.TO_CONNECT_DATACHANNEL,async(i,s,l)=>aT(this,wE.DATACHANNEL_PRECONNECT,i).then(s).catch(l)),this.websocket.on(C_.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(wE.DATACHANNEL_FAILBACK)})}}function QF(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function US(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?QF(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):QF(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}const iL=new Map;class AX extends I_{get state(){return this._state}set state(i){if(i===this._state)return;const s=this._state;this._state=i,i==="DISCONNECTED"&&this._disconnectedReason?this.emit(R_.CONNECTION_STATE_CHANGE,i,s,this._disconnectedReason):this.emit(R_.CONNECTION_STATE_CHANGE,i,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(i){_e.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(i)),this._joinGatewayStartTime=i}constructor(i,s){super(),$(this,"store",void 0),$(this,"joinInfo",void 0),$(this,"key",void 0),$(this,"signal",void 0),$(this,"role",void 0),$(this,"inChannelInfo",{joinAt:null,duration:0}),$(this,"spec",void 0),$(this,"_state","DISCONNECTED"),$(this,"_statsCollector",void 0),$(this,"_disconnectedReason",void 0),$(this,"isSignalRecover",!1),$(this,"hasChangeBGPAddress",!1),$(this,"trafficStatsInterval",void 0),$(this,"networkQualityInterval",void 0),$(this,"_joinGatewayStartTime",0),$(this,"_signalTimeout",!1),$(this,"_clientRoleOptions",void 0),$(this,"_isProactiveJoin",!1),this.store=i,this.spec=s,this.signal=this.store.useDataChannel?new XS(US(US({},s),{},{retryConfig:s.websocketRetryConfig}),i):new HF(US(US({},s),{},{retryConfig:s.websocketRetryConfig}),i),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(i,s,l){if(this.signal instanceof XS){let x=!1;i.cloudProxyServer!=="disabled"?(_e.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(i.cloudProxyServer,")")),x=!0):"".concat(i.apResponse.cid,"_").concat(i.apResponse.cert).length>255||"".concat(i.apResponse.cid,"_").concat(i.apResponse.cert).length<22?(_e.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),x=!0):i.apResponse.addresses.some(H=>H.fingerprint)||kc("FINGERPRINT")||(_e.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),x=!0),x&&this.resetSignal()}this.store.joinGatewayStart(),i.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const p=Date.now();let _=iL.get(i.cname);if(_||(_=new Map,iL.set(i.cname,_)),this._isProactiveJoin=!0,_.has(i.uid)){const x=new _a(_i.UID_CONFLICT);throw AE.joinGateway(i.sid,{lts:p,succ:!1,ec:x.message,addr:null,uid:i.uid,cid:i.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!i.proxyServer,signalChannel:this.signal instanceof XS?"1":"0"}),this._isProactiveJoin=!1,x}_.set(i.uid,!0),this.joinInfo=i,this.key=s;let b=0;this.joinGatewayStartTime=p;const P=i.proxyServer;try{let x;if(_e.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof XS?"datachannel":"websocket"," join uid ").concat(b)),this.signal instanceof XS)x=await this.signal.init(i.apResponse.addresses,l);else{const H=i.proxyServer,B=H?i.gatewayAddrs.map(z=>{const Wt=z.address.split(":");return"wss://".concat(H,"/ws/?h=").concat(Wt[0],"&p=").concat(Wt[1])}):i.gatewayAddrs.map(z=>"wss://".concat(z.address));x=await this.signal.init(B,l)}b=x.uid,_e.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof XS?"datachannel":"websocket"," join uid ").concat(b," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(x){throw x&&x.code===_i.INIT_WEBSOCKET_TIMEOUT?(_e.warning("[".concat(this.store.clientId,"] User join failed"),x.toString()),x):x&&x.code===_i.INIT_DATACHANNEL_TIMEOUT?(_e.warning("[".concat(this.store.clientId,"] User join datachannel failed"),x.toString()),this.resetSignal(),x):(_e.error("[".concat(this.store.clientId,"] User join failed"),x.toString()),AE.joinGateway(i.sid,{lts:p,succ:!1,ec:x.message,addr:this.signal.url,uid:i.uid,cid:i.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!P,signalChannel:this.signal instanceof XS?"1":"0"}),this._isProactiveJoin=!1,_.delete(i.uid),this.signal.close(),x)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),_e.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(x=>{_e.warning("[".concat(this.store.clientId,"] get traffic stats error"),x.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(R_.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(R_.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(R_.NETWORK_QUALITY,{uplinkNetworkQuality:UF(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:UF(this._statsCollector.trafficStats.B_dnq)}):this.emit(R_.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),b}async leave(){let i=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==o_.FALLBACK&&(this.state="DISCONNECTING");try{i||this.signal.connectionState!==d_.CONNECTED||await function(l,p){return p===1/0?l:SE.race([l,TX(p)])}(this.signal.request(LE.LEAVE,void 0,!0),3e3)}catch(l){_e.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),l)}this.signal.close(s),s!==o_.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(i,s,l){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _a(_i.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const p={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:kc("PUB_EXTEND"),twcc:!!kc("PUBLISH_TWCC"),rtx:!!kc("USE_PUB_RTX")};try{return(await this.signal.request(LE.PUBLISH,p,!0))._message}catch(_){if(l&&_.data&&_.data.code===kE.ERR_PUBLISH_REQUEST_INVALID)return _e.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),_.toString()),await this.tryUnpubBeforeRepub(i,s),this.publish(i,s,!1);throw _}}async unpublish(i,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _a(_i.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(LE.UNPUBLISH,{stream_id:s,ortc:i},!0)}catch(l){_e.warning("[".concat(this.store.clientId,"] unpublish warning: "),l)}}async subscribe(i,s,l){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _a(_i.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const p={stream_id:i,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!kc("SUBSCRIBE_TWCC"),rtx:!!kc("USE_SUB_RTX"),extend:kc("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(kc("SVC"))&&kc("SVC").length!==0?kc("SVC"):void 0};try{return(await this.signal.request(LE.SUBSCRIBE,p,!0))._message}catch(_){if(l&&_.data&&_.data.code===kE.ERR_SUBSCRIBE_REQUEST_INVALID)return _e.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),_.toString()),await this.tryUnsubBeforeResub(i,s),await this.subscribe(i,s,!1);throw _}}async subscribeAll(i,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _a(_i.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const l={p2p_id:this.store.p2pId,users:i,dtx:!1,rtx:!!kc("USE_SUB_RTX")};try{return await this.signal.request(LE.SUBSCRIBE_STREAMS,l,!0)}catch(p){if(s&&p.data&&p.data.code===kE.ERR_SUBSCRIBE_REQUEST_INVALID)return _e.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),p.toString()),await this.tryMassUnsubBeforeResub(i),await this.subscribeAll(i,!1);throw p}}async setVideoProfile(i){const s=function(l){if(!(l.bitrateMax&&l.bitrateMin&&l.frameRate&&l.height&&l.width))return;let p=l.frameRate,_=l.width,b=l.height,P=!0;return typeof p!="number"&&(p=p.exact||p.ideal||p.max||p.min||0,p||(P=!1)),typeof _!="number"&&(_=_.exact||_.ideal||_.max||_.min||0,_||(P=!1)),typeof b!="number"&&(b=b.exact||b.ideal||b.max||b.min||0,p||(P=!1)),P?{stream_type:0,width:_,height:b,fps:p,start_bps:1e3*l.bitrateMax,min_bps:1e3*l.bitrateMin,target_bps:1e3*l.bitrateMax}:void 0}(i);if(s)return this.signal.request(LE.SET_VIDEO_PROFILE,s);_e.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(i,s){try{await this.signal.request(LE.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:i,stream_id:s},!0)}catch(l){_e.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),l)}}async massUnsubscribe(i){try{await this.signal.request(LE.UNSUBSCRIBE_STREAMS,i,!0)}catch(s){_e.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(i){const{iceParameters:s,dtlsParameters:l,rtpCapabilities:p}=i;return{gatewayEstablishParams:await this.signal.request(LE.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:l,rtpCapabilities:p}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(LE.GATEWAY_INFO)}async renewToken(i){await this.signal.request(LE.RENEW_TOKEN,i),this.key=i.token}async setClientRole(i,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),this.state!=="CONNECTED")return void(this.role=i);let l;l=i==="audience"?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0,await this.signal.request(LE.SET_CLIENT_ROLE,{role:i,level:l,client_ts:Date.now()}),this.role=i}async setRemoteVideoStreamType(i,s){await this.signal.request(LE.SWITCH_VIDEO_STREAM,{stream_id:i,stream_type:s})}async setDefaultRemoteVideoStreamType(i){await this.signal.request(LE.DEFAULT_VIDEO_STREAM,{stream_type:i})}async setStreamFallbackOption(i,s){await this.signal.request(LE.SET_FALLBACK_OPTION,{stream_id:i,fallback_type:s})}async pickSVCLayer(i,s){await this.signal.request(LE.PICK_SVC_LAYER,{stream_id:i,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),US({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(LE.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const i=iL.get(this.joinInfo.cname);i&&i.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const i=function(s){let l;return l=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),l?{username:VT.username,password:VT.password,turnServerURL:l[2],tcpport:parseInt(l[3])+30,udpport:parseInt(l[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],i&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(US(US({},VT),{},{turnServerURL:i.turnServerURL,tcpport:i.tcpport,udpport:i.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const i=await this.signal.request(LE.TRAFFIC_STATS,void 0,!0);i.timestamp=Date.now(),i.peer_delay.forEach(s=>{const l=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(p=>p.peer_uid===s.peer_uid);l&&l.B_st!==s.B_st&&IS(()=>{this.emit(R_.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(i)}getJoinMessage(i){if(!this.joinInfo||!this.key)throw new _a(_i.UNEXPECTED_ERROR,"can not generate join message, no join info");const s=Object.assign({},this.joinInfo.apResponse);let l=kc("REPORT_APP_SCENARIO");if(typeof l!="string")try{l=JSON.stringify(l)}catch{l=void 0}l&&l.length>128&&(l=void 0);const p=US({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:QT,browser:navigator.userAgent,process_id:kc("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:s,extend:kc("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:l,attributes:{userAttributes:{enablePublishedUserList:kc("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:kc("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof kc("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?kc("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof kc("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?kc("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof kc("ENABLE_USER_LICENSE_CHECK")=="boolean"?kc("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:kc("USE_PUB_RTX")===!0||kc("USE_SUB_RTX")===!0||void 0}},join_ts:this.joinGatewayStartTime},i);return this.joinInfo.stringUid&&(p.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(p.aes_mode=this.joinInfo.aesmode,kc("ENCRYPT_AES")?(p.aes_secret=this.joinInfo.aespassword,p.aes_encrypt=!0):p.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(p.aes_salt=this.joinInfo.aessalt)),s.addresses[this.signal.websocket.currentURLIndex]&&(p.ap_response.ticket=s.addresses[this.signal.websocket.currentURLIndex].ticket,delete s.addresses),this.joinInfo.defaultVideoStream!==void 0&&(p.default_video_stream=this.joinInfo.defaultVideoStream),p}getRejoinMessage(){if(!this.joinInfo)throw new _a(_i.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(wE.WS_RECONNECT_WAITTING_FINISH,i=>{["tryNext","recover"].includes(i)&&this.joinInfo&&AE.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(wE.WS_RECONNECT_CREATE_CONNECTION,i=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(wE.WS_RECONNECTING,i=>{this.joinInfo&&AE.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i||bT.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",AE.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(wE.WS_CLOSED,i=>{let s;switch(i){case o_.LEAVE:s=bT.LEAVE;break;case o_.UID_BANNED:case o_.IP_BANNED:case o_.CHANNEL_BANNED:case o_.SERVER_ERROR:s=bT.SERVER_ERROR;break;case o_.FALLBACK:s=bT.FALLBACK;break;case o_.LICENSE_MISSING:case o_.LICENSE_EXPIRED:case o_.LICENSE_MINUTES_EXCEEDED:case o_.LICENSE_PERIOD_INVALID:case o_.LICENSE_MULTIPLE_SDK_SERVICE:case o_.LICENSE_ILLEGAL:s=i;break;default:s=bT.NETWORK_ERROR}_e.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+bT.NETWORK_ERROR)),this.joinInfo&&AE.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:i===o_.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=i,i!==o_.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(wE.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&this._clientRoleOptions.level&&(_e.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),AE.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof XS?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const i=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!i)return void _e.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(i));f_("EVENT_REPORT_DOMAIN",i[1]),f_("EVENT_REPORT_BACKUP_DOMAIN",i[1]),f_("LOG_UPLOAD_SERVER","".concat(i[1],":6444"))}}),this.signal.on(GE.ON_UPLINK_STATS,i=>{this._statsCollector.updateUplinkStats(i)}),this.signal.on(wE.REQUEST_RECOVER,(i,s,l)=>{if(!this.joinInfo)return l(new _a(_i.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));i&&(this.joinInfo.multiIP=i,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,aT(this,R_.REQUEST_NEW_GATEWAY_LIST).then(s).catch(l)}),this.signal.on(wE.REQUEST_JOIN_INFO,async i=>{var s;this.updateTurnConfigFromSignal();const{iceParameters:l,dtlsParameters:p,rtpCapabilities:_}=await aT(this,R_.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(s=this.joinInfo)===null||s===void 0?void 0:s.turnServer});i(this.getJoinMessage({ortc:{iceParameters:l,dtlsParameters:p,rtpCapabilities:_,version:"2"}}))}),this.signal.on(wE.REQUEST_REJOIN_INFO,i=>{i(this.getRejoinMessage())}),this.signal.on(wE.REPORT_JOIN_GATEWAY,(i,s)=>{this.joinInfo&&(AE.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof XS?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(wE.IS_P2P_DISCONNECTED,i=>{i(KR(this,R_.IS_P2P_DISCONNECTED))}),this.signal.on(wE.DISCONNECT_P2P,()=>{this.emit(R_.DISCONNECT_P2P)}),this.signal.on(wE.NEED_RENEW_SESSION,()=>{this.emit(R_.NEED_RENEW_SESSION)}),this.signal.on(wE.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(wE.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(wE.JOIN_RESPONSE,i=>{const s=this.getCurrentGatewayAddress();this.emit(R_.JOIN_RESPONSE,i,s)}),this.signal.on(wE.DATACHANNEL_PRECONNECT,async(i,s,l)=>{this.updateTurnConfigFromSignal();const p=this.getCurrentGatewayAddress();return aT(this,R_.DATACHANNEL_PRECONNECT,i,p).then(s).catch(l)}),this.signal.on(wE.DATACHANNEL_CONNECTING,async i=>{const{iceParameters:s,dtlsParameters:l,rtpCapabilities:p}=await aT(this,R_.REQUEST_DC_CONNECTION_PARAMS);i(this.getJoinMessage({ortc:{iceParameters:s,dtlsParameters:l,rtpCapabilities:p,version:"2"}}))}),this.signal.on(wE.DATACHANNEL_FAILBACK,()=>{_e.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(R_.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(i,s){try{await this.signal.request(LE.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:i,ortc:[s]},!0)}catch(l){throw _e.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),l),l}}async tryUnpubBeforeRepub(i,s){try{await this.signal.request(LE.UNPUBLISH,{stream_id:i,ortc:s},!0)}catch(l){throw _e.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),l),l}}async tryMassUnsubBeforeResub(i){const s={users:i.map(l=>({stream_id:l.stream_id,stream_type:l.stream_type}))};try{await this.signal.request(LE.UNSUBSCRIBE_STREAMS,s,!0)}catch(l){throw _e.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),l),l}}async muteLocal(i,s){const l={action:i.find(p=>p.stream_type===z_.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:i,stream_id:s};try{await this.signal.request(LE.CONTROL,l,!0,!0)}catch(p){throw _e.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),p),p}}async unmuteLocal(i,s){const l={action:i.find(p=>p.stream_type===z_.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:i,stream_id:s};try{await this.signal.request(LE.CONTROL,l,!0,!0)}catch(p){throw _e.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),p),p}}uploadStats(i,s){this.signal.upload(i,s)}getSignalRTT(){return this.signal.rtt}async restartICE(i){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:i};try{return await this.signal.request(LE.RESTART_ICE,s,!0)}catch(l){throw _e.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),l),l}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,bT.P2P_FAILED)}getCurrentGatewayAddress(){var i;if(!kc("GATEWAY_WSS_ADDRESS"))return(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(i){await this.signal.request(LE.SET_PARAMETER,{enablePublishAudioFilter:i})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(o_.FALLBACK)),this.store.useDataChannel=!1,this.signal=new HF(US(US({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(R_.RESET_SIGNAL,OO.websocket)}}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var r;function i(eE){var uE=0;return function(){return uE<eE.length?{done:!1,value:eE[uE++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(eE,uE,gE){return eE==Array.prototype||eE==Object.prototype||(eE[uE]=gE.value),eE},l,p=function(eE){eE=[typeof globalThis=="object"&&globalThis,eE,typeof window=="object"&&window,typeof self=="object"&&self,typeof h=="object"&&h];for(var uE=0;uE<eE.length;++uE){var gE=eE[uE];if(gE&&gE.Math==Math)return gE}throw Error("Cannot find global object")}(this);function _(eE,uE){if(uE)t:{var gE=p;eE=eE.split(".");for(var UE=0;UE<eE.length-1;UE++){var $E=eE[UE];if(!($E in gE))break t;gE=gE[$E]}(uE=uE(UE=gE[eE=eE[eE.length-1]]))!=UE&&uE!=null&&s(gE,eE,{configurable:!0,writable:!0,value:uE})}}function b(eE){return(eE={next:eE})[Symbol.iterator]=function(){return this},eE}function P(eE){var uE=typeof Symbol<"u"&&Symbol.iterator&&eE[Symbol.iterator];return uE?uE.call(eE):{next:i(eE)}}if(_("Symbol",function(eE){function uE($E,pE){this.A=$E,s(this,"description",{configurable:!0,writable:!0,value:pE})}if(eE)return eE;uE.prototype.toString=function(){return this.A};var gE="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",UE=0;return function $E(pE){if(this instanceof $E)throw new TypeError("Symbol is not a constructor");return new uE(gE+(pE||"")+"_"+UE++,pE)}}),_("Symbol.iterator",function(eE){if(eE)return eE;eE=Symbol("Symbol.iterator");for(var uE="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),gE=0;gE<uE.length;gE++){var UE=p[uE[gE]];typeof UE=="function"&&typeof UE.prototype[eE]!="function"&&s(UE.prototype,eE,{configurable:!0,writable:!0,value:function(){return b(i(this))}})}return eE}),typeof Object.setPrototypeOf=="function")l=Object.setPrototypeOf;else{var x;t:{var H={};try{H.__proto__={a:!0},x=H.a;break t}catch{}x=!1}l=x?function(eE,uE){if(eE.__proto__=uE,eE.__proto__!==uE)throw new TypeError(eE+" is not extensible");return eE}:null}var B=l;function z(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function Wt(eE){if(eE.m)throw new TypeError("Generator is already running");eE.m=!0}function _r(eE,uE){return eE.h=3,{value:uE}}function Di(eE){this.g=new z,this.G=eE}function Fi(eE,uE,gE,UE){try{var $E=uE.call(eE.g.j,gE);if(!($E instanceof Object))throw new TypeError("Iterator result "+$E+" is not an object");if(!$E.done)return eE.g.m=!1,$E;var pE=$E.value}catch(Vt){return eE.g.j=null,eE.g.s(Vt),Gi(eE)}return eE.g.j=null,UE.call(eE.g,pE),Gi(eE)}function Gi(eE){for(;eE.g.h;)try{var uE=eE.G(eE.g);if(uE)return eE.g.m=!1,{value:uE.value,done:!1}}catch(gE){eE.g.v=void 0,eE.g.s(gE)}if(eE.g.m=!1,eE.g.l){if(uE=eE.g.l,eE.g.l=null,uE.F)throw uE.D;return{value:uE.return,done:!0}}return{value:void 0,done:!0}}function _p(eE){this.next=function(uE){return eE.o(uE)},this.throw=function(uE){return eE.s(uE)},this.return=function(uE){return function(gE,UE){Wt(gE.g);var $E=gE.g.j;return $E?Fi(gE,"return"in $E?$E.return:function(pE){return{value:pE,done:!0}},UE,gE.g.return):(gE.g.return(UE),Gi(gE))}(eE,uE)},this[Symbol.iterator]=function(){return this}}function _f(eE,uE){return uE=new _p(new Di(uE)),B&&eE.prototype&&B(uE,eE.prototype),uE}if(z.prototype.o=function(eE){this.v=eE},z.prototype.s=function(eE){this.l={D:eE,F:!0},this.h=this.C||this.u},z.prototype.return=function(eE){this.l={return:eE},this.h=this.u},Di.prototype.o=function(eE){return Wt(this.g),this.g.j?Fi(this,this.g.j.next,eE,this.g.o):(this.g.o(eE),Gi(this))},Di.prototype.s=function(eE){return Wt(this.g),this.g.j?Fi(this,this.g.j.throw,eE,this.g.o):(this.g.s(eE),Gi(this))},_("Array.prototype.entries",function(eE){return eE||function(){return function(uE,gE){uE instanceof String&&(uE+="");var UE=0,$E=!1,pE={next:function(){if(!$E&&UE<uE.length){var Vt=UE++;return{value:gE(Vt,uE[Vt]),done:!1}}return $E=!0,{done:!0,value:void 0}}};return pE[Symbol.iterator]=function(){return pE},pE}(this,function(uE,gE){return[uE,gE]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var cE=function(eE,uE){for(var gE=0;gE<eE.length;gE++)uE(eE[gE])},RE=function(eE){return eE.replace(/\r?\n|\r/g,`\r
`)},dE=function(eE,uE,gE){return uE instanceof Blob?(gE=gE!==void 0?gE+"":typeof uE.name=="string"?uE.name:"blob",uE.name===gE&&Object.prototype.toString.call(uE)!=="[object Blob]"||(uE=new File([uE],gE)),[String(eE),uE]):[String(eE),String(uE)]},lE=function(eE,uE){if(eE.length<uE)throw new TypeError(uE+" argument required, but only "+eE.length+" present.")},oE=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,EE=oE.FormData,r_=oE.XMLHttpRequest&&oE.XMLHttpRequest.prototype.send,DE=oE.Request&&oE.fetch,g_=oE.navigator&&oE.navigator.sendBeacon,l_=oE.Element&&oE.Element.prototype,x_=oE.Symbol&&Symbol.toStringTag;x_&&(Blob.prototype[x_]||(Blob.prototype[x_]="Blob"),"File"in oE&&!File.prototype[x_]&&(File.prototype[x_]="File"));try{new File([],"")}catch{oE.File=function(uE,gE,UE){return uE=new Blob(uE,UE||{}),Object.defineProperties(uE,{name:{value:gE},lastModified:{value:+(UE&&UE.lastModified!==void 0?new Date(UE.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),x_&&Object.defineProperty(uE,x_,{value:"File"}),uE}}var _y=function(eE){return eE.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},L_=function(eE){this.i=[];var uE=this;eE&&cE(eE.elements,function(gE){if(gE.name&&!gE.disabled&&gE.type!=="submit"&&gE.type!=="button"&&!gE.matches("form fieldset[disabled] *"))if(gE.type==="file"){var UE=gE.files&&gE.files.length?gE.files:[new File([],"",{type:"application/octet-stream"})];cE(UE,function($E){uE.append(gE.name,$E)})}else gE.type==="select-multiple"||gE.type==="select-one"?cE(gE.options,function($E){!$E.disabled&&$E.selected&&uE.append(gE.name,$E.value)}):gE.type==="checkbox"||gE.type==="radio"?gE.checked&&uE.append(gE.name,gE.value):(UE=gE.type==="textarea"?RE(gE.value):gE.value,uE.append(gE.name,UE))})};if((r=L_.prototype).append=function(eE,uE,gE){lE(arguments,2),this.i.push(dE(eE,uE,gE))},r.delete=function(eE){lE(arguments,1);var uE=[];eE=String(eE),cE(this.i,function(gE){gE[0]!==eE&&uE.push(gE)}),this.i=uE},r.entries=function eE(){var uE,gE=this;return _f(eE,function(UE){if(UE.h==1&&(uE=0),UE.h!=3)return uE<gE.i.length?UE=_r(UE,gE.i[uE]):(UE.h=0,UE=void 0),UE;uE++,UE.h=2})},r.forEach=function(eE,uE){lE(arguments,1);for(var gE=P(this),UE=gE.next();!UE.done;UE=gE.next()){var $E=P(UE.value);UE=$E.next().value,$E=$E.next().value,eE.call(uE,$E,UE,this)}},r.get=function(eE){lE(arguments,1);var uE=this.i;eE=String(eE);for(var gE=0;gE<uE.length;gE++)if(uE[gE][0]===eE)return uE[gE][1];return null},r.getAll=function(eE){lE(arguments,1);var uE=[];return eE=String(eE),cE(this.i,function(gE){gE[0]===eE&&uE.push(gE[1])}),uE},r.has=function(eE){lE(arguments,1),eE=String(eE);for(var uE=0;uE<this.i.length;uE++)if(this.i[uE][0]===eE)return!0;return!1},r.keys=function eE(){var uE,gE,UE,$E,pE=this;return _f(eE,function(Vt){if(Vt.h==1&&(uE=P(pE),gE=uE.next()),Vt.h!=3)return gE.done?void(Vt.h=0):(UE=gE.value,$E=P(UE),_r(Vt,$E.next().value));gE=uE.next(),Vt.h=2})},r.set=function(eE,uE,gE){lE(arguments,2),eE=String(eE);var UE=[],$E=dE(eE,uE,gE),pE=!0;cE(this.i,function(Vt){Vt[0]===eE?pE&&(pE=!UE.push($E)):UE.push(Vt)}),pE&&UE.push($E),this.i=UE},r.values=function eE(){var uE,gE,UE,$E,pE=this;return _f(eE,function(Vt){if(Vt.h==1&&(uE=P(pE),gE=uE.next()),Vt.h!=3)return gE.done?void(Vt.h=0):(UE=gE.value,($E=P(UE)).next(),_r(Vt,$E.next().value));gE=uE.next(),Vt.h=2})},L_.prototype._asNative=function(){for(var eE=new EE,uE=P(this),gE=uE.next();!gE.done;gE=uE.next()){var UE=P(gE.value);gE=UE.next().value,UE=UE.next().value,eE.append(gE,UE)}return eE},L_.prototype._blob=function(){var eE="----formdata-polyfill-"+Math.random(),uE=[],gE="--"+eE+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(UE,$E){return typeof UE=="string"?uE.push(gE+_y(RE($E))+`"\r
\r
`+RE(UE)+`\r
`):uE.push(gE+_y(RE($E))+'"; filename="'+_y(UE.name)+`"\r
Content-Type: `+(UE.type||"application/octet-stream")+`\r
\r
`,UE,`\r
`)}),uE.push("--"+eE+"--"),new Blob(uE,{type:"multipart/form-data; boundary="+eE})},L_.prototype[Symbol.iterator]=function(){return this.entries()},L_.prototype.toString=function(){return"[object FormData]"},l_&&!l_.matches&&(l_.matches=l_.matchesSelector||l_.mozMatchesSelector||l_.msMatchesSelector||l_.oMatchesSelector||l_.webkitMatchesSelector||function(eE){for(var uE=(eE=(this.document||this.ownerDocument).querySelectorAll(eE)).length;0<=--uE&&eE.item(uE)!==this;);return-1<uE}),x_&&(L_.prototype[x_]="FormData"),r_){var wT=oE.XMLHttpRequest.prototype.setRequestHeader;oE.XMLHttpRequest.prototype.setRequestHeader=function(eE,uE){wT.call(this,eE,uE),eE.toLowerCase()==="content-type"&&(this.B=!0)},oE.XMLHttpRequest.prototype.send=function(eE){eE instanceof L_?(eE=eE._blob(),this.B||this.setRequestHeader("Content-Type",eE.type),r_.call(this,eE)):r_.call(this,eE)}}DE&&(oE.fetch=function(eE,uE){return uE&&uE.body&&uE.body instanceof L_&&(uE.body=uE.body._blob()),DE.call(this,eE,uE)}),g_&&(oE.navigator.sendBeacon=function(eE,uE){return uE instanceof L_&&(uE=uE._asNative()),g_.call(this,eE,uE)}),oE.FormData=L_}})();const BO=()=>{const r=kc("AREAS");return r.length===0&&r.push(JE.GLOBAL),iR(r).call(r,(i,s,l)=>{const p=$F(s);return p?l===0?p:"".concat(i,",").concat(p):i},"")},$F=r=>r===JE.OVERSEA?"".concat(Eg.ASIA,",").concat(Eg.EUROPE,",").concat(Eg.AFRICA,",").concat(Eg.NORTH_AMERICA,",").concat(Eg.SOUTH_AMERICA,",").concat(Eg.OCEANIA):Eg[r],CX=r=>{const i={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return r.map(s=>{const l=AO[s],p=Object.keys(l);p&&p.map(_=>{_!=="CODE"&&(i[_]=i[_].concat(l[_]))})}),i},GO={GLOBAL:{ASIA:[JE.CHINA,JE.JAPAN,JE.INDIA,JE.KOREA,JE.HKMC],EUROPE:[],NORTH_AMERICA:[JE.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},oL=Object.keys(GO[JE.GLOBAL]),ZF=[JE.CHINA,JE.NORTH_AMERICA,JE.EUROPE,JE.ASIA,JE.JAPAN,JE.INDIA,JE.OCEANIA,JE.SOUTH_AMERICA,JE.AFRICA,JE.KOREA,JE.HKMC,JE.US],wX=function(r,i){let s=[];if(r.includes(JE.GLOBAL)){const _=[JE.GLOBAL,JE.OVERSEA],b=Object.keys(AO);if(i===JE.GLOBAL)throw new _a(_i.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(i===JE.CHINA)s=[JE.OVERSEA];else if(p=i,oL.includes(p)){const P=(l=i,GO[JE.GLOBAL][l]||[]),x=[..._,i,...P];s=b.filter(H=>!x.includes(H))}else if(function(P){let x=!1;return oL.forEach(H=>{GO[JE.GLOBAL][H].includes(P)&&(x=!0)}),x}(i)){const P=function(H){let B;return oL.forEach(z=>{GO[JE.GLOBAL][z].includes(H)&&(B=z)}),B}(i),x=[..._,P,i];s=b.filter(H=>!x.includes(H))}else s=r;s=function(P){const x=[];return ZF.forEach(H=>{P.includes(H)&&x.push(H)}),x.concat(P.filter(H=>!ZF.includes(H)))}(s)}else s=r;var l,p;return s};function t3(r){if(!r&&kc("AREAS").includes(JE.EXTENSIONS))return _e.debug("update area from ap : reset"),void sL(V2,!0);if(!kc("AREAS").includes(JE.GLOBAL)||!r)return;let i=AO.EXTENSIONS;i&&(i={CODE:$F(JE.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(r,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(r,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(r,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(r,".agora.io"),"cds-ap-web-2-".concat(r,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(r,".agora.io"),"sua-ap-web-2-".concat(r,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(r,".agora.io"),"uap-ap-web-2-".concat(r,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(r,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(r,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(r,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(r,".agora.io")]},_e.debug("update area from ap success: ".concat(r,",config is "),i),f_("AREAS",[JE.EXTENSIONS],!0),Object.keys(i).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?f_(s,i[s][0]):f_(s,i[s])}))}function sL(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=AE.reportApiInvoke(null,{name:V_.SET_AREA,options:r,tag:S_.TRACER});try{let l=[];if(typeof r=="string"&&(l=[r]),Array.isArray(r)&&(r.forEach(_=>{if(!n9.includes(_))throw new _a(_i.INVALID_PARAMS,"invalid area code")}),l=r),Object.prototype.toString.call(r)==="[object Object]"){const{areaCode:_,excludedArea:b}=r;if(!_)throw new _a(_i.INVALID_PARAMS,"area code is needed");let P=_;typeof _=="string"&&(P=[_]),l=b?wX(P,b):P}if(!i){if(xR.AREAS){const _=new _a(_i.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(_),void _e.warning("setArea is prohibited because of config-distribute")}if(l.includes(JE.GLOBAL)&&kc("AREAS")===JE.EXTENSIONS){const _=new _a(_i.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(_),void _e.warning("setArea is prohibited because of ap extensions")}}f_("AREAS",l,i);const p=CX(l);Object.keys(p).map(_=>{_==="LOG_UPLOAD_SERVER"||_==="EVENT_REPORT_DOMAIN"||_==="EVENT_REPORT_BACKUP_DOMAIN"||_==="PROXY_SERVER_TYPE3"?f_(_,p[_][0]):f_(_,p[_])}),_e.debug("set area success:",l.join(","))}catch(l){throw s.onError(l),l}s.onSuccess()}function e3(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function n3(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?e3(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):e3(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}let aL=1;function NX(r,i,s,l,p){aL+=1;const _={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:aL,requestId:aL,version:QT,cname:s.cname},b={service_name:i,json_body:JSON.stringify(_)};let P,x,H=r[0];return bS(async()=>{P=Date.now();const B=await dS(H,{data:b,cancelToken:l,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(x=Date.now()-P,B.code!==0){const _r=new _a(_i.UNEXPECTED_RESPONSE,"live streaming ap error, code"+B.code,{retry:!0,responseTime:x});throw _e.error(_r.toString()),_r}const z=JSON.parse(B.json_body);if(z.code!==200){const _r=new _a(_i.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(z.code,", reason: ").concat(z.reason),{code:z.code,responseTime:x});throw _e.error(_r.toString()),_r}if(!z.servers||z.servers.length===0){const _r=new _a(_i.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:z.code,responseTime:x});throw _e.error(_r.toString()),_r}const Wt=function(_r,Di){return{addressList:_r.servers.map(Fi=>"wss://".concat(Fi.address.replace(/\./g,"-"),".").concat(kc("WORKER_DOMAIN"),":").concat(Fi.wss,"?serviceName=").concat(encodeURIComponent(Di))),workerToken:_r.workerToken,vid:_r.vid}}(z,i);return kc("LIVE_STREAMING_ADDRESS")&&(Wt.addressList=kc("LIVE_STREAMING_ADDRESS")instanceof Array?kc("LIVE_STREAMING_ADDRESS"):[kc("LIVE_STREAMING_ADDRESS")]),n3(n3({},Wt),{},{responseTime:x})},(B,z)=>(AE.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:i,responseDetail:JSON.stringify(B.addressList),firstSuccess:z===0,responseTime:x,serverIp:r[z%r.length]}),!1),(B,z)=>(AE.apworkerEvent(s.sid,{success:!1,sc:B.data&&B.data.code||200,serviceName:i,responseTime:x,serverIp:r[z%r.length]}),!!(B.code!==_i.OPERATION_ABORTED&&B.code!==_i.UNEXPECTED_RESPONSE||B.data&&B.data.retry)&&(H=r[(z+1)%r.length],!0)),p)}let cL=1;function r3(r,i,s,l){let{url:p,areaCode:_}=r;const b=Date.now();let P;const[x,H]=a3(i,_,[Z_.CHOOSE_SERVER]);let B=B_.networkState;return bS(async()=>{B&&B_.networkState===uT.OFFLINE&&B_.onlineWaiter&&await SE.race([B_.onlineWaiter,sT(l&&l.maxRetryTimeout||j_.maxRetryTimeout)]),B=B_.networkState;const{data:z,headers:Wt}=await dS(p,{data:x,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);P=Wt.http3==="1"?1:-1,AE.reportResourceTiming(p,i.sid),o3(z,p,i,b,[Z_.CHOOSE_SERVER],P);const _r=tL(z,Z_.CHOOSE_SERVER);return s3(_r),LF(_r,p)},z=>(z&&AE.joinChooseServer(i.sid,{lts:b,succ:!0,csAddr:p,opid:H,serverList:z.gatewayAddrs.map(Wt=>Wt.address),ec:null,cid:z.cid.toString(),uid:z.uid.toString(),csIp:z.csIp,unilbsServerIds:[Z_.CHOOSE_SERVER].toString(),isHttp3:P}),!1),z=>z.code!==_i.OPERATION_ABORTED&&(z.code===_i.CAN_NOT_GET_GATEWAY_SERVER?z.data.retry:(AE.joinChooseServer(i.sid,{lts:b,succ:!1,csAddr:p,serverList:null,opid:H,ec:z.code,csIp:z.data&&z.data.csIp,unilbsServerIds:[Z_.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:B}),isHttp3:P}),_e.warning("[".concat(i.clientId,"] Choose server network error, retry"),z),!0)),l)}function i3(r,i,s,l){let p,{url:_,areaCode:b,serviceIds:P}=r;const x=Date.now(),[H,B]=a3(i,b,P);let z;return bS(async()=>{z&&B_.networkState===uT.OFFLINE&&B_.onlineWaiter&&await SE.race([B_.onlineWaiter,sT(l&&l.maxRetryTimeout||j_.maxRetryTimeout)]),z=B_.networkState;const{data:Wt,headers:_r}=await dS(_,{data:H,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p=_r.http3==="1"?1:-1,AE.reportResourceTiming(_,i.sid),o3(Wt,_,i,x,P,p);const Di=tL(Wt,Z_.CHOOSE_SERVER),Fi=tL(Wt,i.cloudProxyServer==="proxy5"?Z_.CLOUD_PROXY_5:i.cloudProxyServer==="proxy3"||i.cloudProxyServer==="proxy4"?Z_.CLOUD_PROXY:Z_.CLOUD_PROXY_FALLBACK);return s3(Di),{gatewayInfo:LF(Di,_),proxyInfo:Fi,url:_}},Wt=>(Wt.gatewayInfo&&AE.joinChooseServer(i.sid,{lts:x,succ:!0,csAddr:_,serverList:Wt.gatewayInfo.gatewayAddrs.map(_r=>_r.address),ec:null,opid:B,cid:Wt.gatewayInfo.cid.toString(),uid:Wt.gatewayInfo.uid.toString(),csIp:Wt.gatewayInfo.csIp,unilbsServerIds:P.toString(),isHttp3:p}),Wt.proxyInfo&&AE.joinWebProxyAP(i.sid,{lts:x,sucess:1,apServerAddr:_,turnServerAddrList:Wt.proxyInfo.addresses.map(_r=>_r.ip).join(","),errorCode:null,eventType:i.cloudProxyServer,unilbsServerIds:P.toString()}),!1),Wt=>Wt.code!==_i.OPERATION_ABORTED&&(Wt.code===_i.CAN_NOT_GET_GATEWAY_SERVER?Wt.data.retry:(AE.joinWebProxyAP(i.sid,{lts:x,sucess:0,apServerAddr:_,turnServerAddrList:null,errorCode:Wt.code,eventType:i.cloudProxyServer,unilbsServerIds:P.toString(),extend:JSON.stringify({networkState:z})}),_e.warning("[".concat(i.clientId,"] multi unilbs network error, retry"),Wt),!0)),l)}const o3=(r,i,s,l,p,_)=>{const b=[],P=x=>{x.flag===4096?AE.joinChooseServer(s.sid,{lts:l,succ:!1,csAddr:i,opid:r.opid,serverList:null,ec:x.error.message,csIp:x.error.data&&x.error.data.csIp,unilbsServerIds:p.toString(),isHttp3:_}):x.flag!==1048576&&x.flag!==4194304&&x.flag!==4194310||AE.joinWebProxyAP(s.sid,{lts:l,sucess:0,apServerAddr:i,turnServerAddrList:null,errorCode:x.error.code,eventType:s.cloudProxyServer,unilbsServerIds:p.toString()})};if(r.response_body.forEach(x=>{const H=x.buffer.code;if(x.uri===23&&H===0&&!x.buffer.edges_services)if(x.buffer.flag===4194310)_e.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),x.buffer.edges_services=[];else{const B={error:new _a(_i.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:r.detail[502]}),flag:x.buffer.flag};b.push(B),P(B)}if(H!==0){const B=FO(H),z={error:new _a(_i.CAN_NOT_GET_GATEWAY_SERVER,B.desc,{desc:B.desc,retry:B.retry,csIp:r.detail[502]}),flag:x.buffer.flag};x.buffer.flag===4194310?_e.warning(z.error.toString()):b.push(z),P(z)}}),b.length)throw _e.warning("[".concat(s.clientId,"] multi unilbs ").concat(i," failed, ").concat(b.map(x=>"flag: ".concat(x.flag,", message: ").concat(x.error.message,", retry: ").concat(x.error.data.retry)).join(" | "))),new _a(_i.CAN_NOT_GET_GATEWAY_SERVER,b.map(x=>"flag: ".concat(x.flag,", message: ").concat(x.error.message)).join(" | "),{retry:!!b.find(x=>x.error.data.retry),csIp:r.detail[502],desc:[...new Set(b.map(x=>{var H,B;return x==null||(H=x.error)===null||H===void 0||(B=H.data)===null||B===void 0?void 0:B.desc}).filter(x=>!!x))]})},s3=r=>{var i,s,l,p;if(r.addresses&&r.addresses.length===0&&r.code===0)throw new _a(_i.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:r.detail&&r.detail[502]});if(kc("AP_AREA")&&((l=r.detail)!==null&&l!==void 0&&l[23]&&typeof((p=r.detail)===null||p===void 0?void 0:p[23])=="string"?t3(r.detail[23].toLowerCase()):t3()),(i=r.detail)!==null&&i!==void 0&&i[19]&&typeof((s=r.detail)===null||s===void 0?void 0:s[19])=="string"){const b=r.detail[19],P=b==null?void 0:b.split(";");for(let x=0;x<P.length;x++){var _;const H=qS(_=P[x]).call(_);r.addresses[x]&&P&&(r.addresses[x].fingerprint=H)}}if(kc("GATEWAY_ADDRESS")&&kc("GATEWAY_ADDRESS").length>0){_e.debug("assign gateway address to",kc("GATEWAY_ADDRESS"));const b=kc("GATEWAY_ADDRESS").map(P=>{var x,H;const B=(x=(H=r.addresses.find(z=>z.ip===P.ip&&z.port===P.port))===null||H===void 0?void 0:H.fingerprint)!==null&&x!==void 0?x:"";return{ip:P.ip,port:P.port,ticket:r.addresses[0]&&r.addresses[0].ticket,fingerprint:B}});r.addresses=b}},DX=(r,i)=>{if(r.response_body&&r.response_body.length){const s=r.response_body[0];if(s.buffer.code!==0){const l=FO(s.buffer.code);throw new _a(_i.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(l.desc),{retry:l.retry})}return s.buffer.ticket}throw _e.debug("update ticket request received ap response without response body:",i),new _a(_i.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},a3=(r,i,s)=>{const l=Math.floor(Math.random()*1e12),p={appid:r.appId,client_ts:Date.now(),opid:l,sid:r.sid,request_bodies:[{uri:22,buffer:{cname:r.cname,detail:{6:r.stringUid,11:i,12:kc("USE_NEW_TOKEN")?"1":void 0,22:i},key:r.token,service_ids:s,uid:r.uid||0}}]};p.request_bodies.forEach(b=>{r.multiIP&&r.multiIP.gateway_ip&&(b.buffer.detail[5]=JSON.stringify({vocs_ip:[r.multiIP.uni_lbs_ip],vos_ip:[r.multiIP.gateway_ip]}))});const _=new FormData;return _.append("request",JSON.stringify(p)),[_,l]},PX=(r,i)=>{const s=Math.floor(Math.random()*1e12),l={appid:r.appId,client_ts:Date.now(),opid:s,sid:r.sid,request_bodies:[{uri:28,buffer:{cname:r.cname,detail:{1:"",6:r.stringUid,12:"1"},token:r.token,service_ids:i,uid:r.uid||0,edges_services:r.apResponse.addresses.map(_=>({ip:_.ip,port:_.port}))}}]},p=new FormData;return p.append("request",JSON.stringify(l)),[p,s]};let DI=0;async function uL(r,i,s,l){return{gatewayInfo:await async function(_,b,P,x){let H=null;const B=[],z=async()=>{const _r=kc("WEBCS_DOMAIN").slice(0,kc("AJAX_REQUEST_CONCURRENT")).map(Gi=>({url:_.proxyServer?"https://".concat(_.proxyServer,"/ap/?url=").concat(Gi+"/api/v2/transpond/webrtc?v=2"):"https://".concat(Gi,"/api/v2/transpond/webrtc?v=2"),areaCode:BO()})),Di=x.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:_r.map(Gi=>Gi.url)}),Fi=await u0({fragementLength:kc("FRAGEMENT_LENGTH"),referenceList:_r,asyncMapHandler:Gi=>(_e.debug("[".concat(_.clientId,"] Connect to choose_server:"),Gi.url),r3(Gi,_,b,P)),allFailedhandler:Gi=>{throw x.recordJoinChannelService({endTs:Date.now(),status:"error",errors:Gi},Di),Gi[0]},promisesCollector:B});return x.recordJoinChannelService({endTs:Date.now(),status:"success"},Di),Fi},Wt=async()=>{if(await sT(1e3),H!==null)return H;const _r=kc("WEBCS_DOMAIN_BACKUP_LIST").map(Gi=>({url:_.proxyServer?"https://".concat(_.proxyServer,"/ap/?url=").concat(Gi+"/api/v2/transpond/webrtc?v=2"):"https://".concat(Gi,"/api/v2/transpond/webrtc?v=2"),areaCode:BO()})),Di=x.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:_r.map(Gi=>Gi.url)}),Fi=await u0({fragementLength:kc("FRAGEMENT_LENGTH"),referenceList:_r,asyncMapHandler:Gi=>(_e.debug("[".concat(_.clientId,"] Connect to backup choose_server:"),Gi.url),r3(Gi,_,b,P)),allFailedhandler:Gi=>{throw x.recordJoinChannelService({endTs:Date.now(),status:"error",errors:Gi},Di),Gi[0]},promisesCollector:B});return x.recordJoinChannelService({endTs:Date.now(),status:"success"},Di),Fi};try{return H=await NI([z(),Wt()]),B.length&&B.forEach(_r=>_r.cancel&&typeof _r.cancel=="function"&&_r.cancel()),H}catch(_r){throw _r[0]}}(r,i,s,l)}}async function c3(r,i,s,l,p){const _=r.cloudProxyServer;if(_==="disabled"){if(!l)return;if(r.useLocalAccessPoint)return await uL(r,i,s,p);if(kc("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:H,proxyInfo:B}=await d3(r,i,s,p);return r.turnServer&&r.turnServer.mode!=="auto"||(r.turnServer={mode:"manual",servers:B.map(z=>({turnServerURL:z.address,tcpport:z.tcpport||VT.tcpport,udpport:z.udpport||VT.udpport,username:z.username||VT.username,password:z.password||VT.password,forceturn:!1,security:!0}))}),{gatewayInfo:H}}return await uL(r,i,s,p)}const{proxyInfo:b,gatewayInfo:P}=await d3(r,i,s,p),x={gatewayInfo:P};return r.turnServer={mode:"manual",servers:b.map(H=>({turnServerURL:H.address,tcpport:_==="proxy3"?void 0:H.tcpport?H.tcpport:VT.tcpport,udpport:_==="proxy4"?void 0:H.udpport?H.udpport:VT.udpport,username:H.username||VT.username,password:H.password||VT.password,forceturn:_!=="proxy4",security:_==="proxy5"}))},_e.debug("[".concat(r.clientId,"] set proxy server: ").concat(r.proxyServer,", mode: ").concat(_)),x}async function u3(r,i,s,l,p){const _=kc("ACCOUNT_REGISTER").slice(0,kc("AJAX_REQUEST_CONCURRENT"));let b=[];b=i.proxyServer?_.map(x=>"https://".concat(i.proxyServer,"/ap/?url=").concat(x+"/api/v1")):_.map(x=>"https://".concat(x,"/api/v1"));const P=p==null?void 0:p.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:b});try{const x=await async function(H,B,z,Wt,_r){const Di=Date.now(),Fi={sid:z.sid,opid:10,appid:z.appId,string_uid:B};let Gi=H[0];const _p=await bS(()=>dS(Gi+"".concat(Gi.indexOf("?")===-1?"?":"&","action=stringuid"),{data:Fi,cancelToken:Wt,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(_f,cE)=>{if(_f.code===0){if(_f.uid<=0||_f.uid>=Math.pow(2,32))throw _e.error("Invalid Uint Uid ".concat(B," => ").concat(_f.uid),_f),AE.reqUserAccount(Fi.sid,{lts:Di,success:!1,serverAddr:Gi,stringUid:Fi.string_uid,uid:_f.uid,errorCode:_i.INVALID_UINT_UID_FROM_STRING_UID,extend:Fi}),new _a(_i.INVALID_UINT_UID_FROM_STRING_UID);return AE.reqUserAccount(Fi.sid,{lts:Di,success:!0,serverAddr:Gi,stringUid:Fi.string_uid,uid:_f.uid,errorCode:null,extend:Fi}),!1}const RE=FO(_f.code);return RE.retry&&(Gi=H[(cE+1)%H.length]),AE.reqUserAccount(Fi.sid,{lts:Di,success:!1,serverAddr:Gi,stringUid:Fi.string_uid,uid:_f.uid,errorCode:RE.desc,extend:Fi}),RE.retry},(_f,cE)=>_f.code!==_i.OPERATION_ABORTED&&(AE.reqUserAccount(Fi.sid,{lts:Di,success:!1,serverAddr:Gi,stringUid:Fi.string_uid,uid:null,errorCode:_f.code,extend:Fi}),Gi=H[(cE+1)%H.length],!0),_r);if(_p.code!==0){const _f=FO(_p.code);throw new _a(_i.UNEXPECTED_RESPONSE,_f.desc)}return _p}(b,r,i,s,l);return p==null||p.recordJoinChannelService({status:"success",endTs:Date.now()},P),x.uid}catch(x){throw p==null||p.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[x]},P),x}}async function kX(r,i,s){const l=kc("CDS_AP").slice(0,kc("AJAX_REQUEST_CONCURRENT")).map(P=>r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(P+"/api/v1"):"https://".concat(P,"/api/v1?action=config")).map(P=>function(x,H,B,z){const Wt=i_(),_r={flag:64,cipher_method:0,features:{device:Wt.name,system:Wt.os,system_general:navigator.userAgent,vendor:H.appId,version:QT,cname:H.cname,sid:H.sid,session_id:H.sid,detail:"",proxyServer:H.proxyServer}};return bS(()=>dS(x,{data:_r,timeout:1e3,cancelToken:B,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,Di=>Di.code!==_i.OPERATION_ABORTED,z)}(P,r,i,s));let p=null,_=null,b={};try{p=await NI(l)}catch(P){if(P.code===_i.OPERATION_ABORTED)throw P;_=P}if(l.forEach(P=>P.cancel()),AE.reportApiInvoke(r.sid,{name:V_.REQUEST_CONFIG_DISTRIBUTE,options:{error:_,res:p}}).onSuccess(),p&&p.test_tags)try{b=function(P){if(!P.test_tags)return{};const x=P.test_tags,H=Object.keys(x),B={};return H.forEach(z=>{var Wt;const _r=qS(Wt=z.slice(4)).call(Wt),Di=JSON.parse(x[z])[1];B[_r]=Di}),B}(p)}catch{}return b}async function d3(r,i,s,l){const p=kc("PROXY_SERVER_TYPE3"),_=(_r,Di,Fi)=>{let Gi=Fi||p;return Array.isArray(Gi)&&(Gi=Di%2==0?p[1]:p[0]),"https://".concat(Gi,"/ap/?url=").concat(_r)};let b=null;const P=[],x=async()=>{const _r=kc("WEBCS_DOMAIN").slice(0,kc("AJAX_REQUEST_CONCURRENT")).map((Gi,_p)=>{let _f;return _f=r.cloudProxyServer==="disabled"&&r.proxyServer?_("".concat(Gi,"/api/v2/transpond/webrtc?v=2"),_p,r.proxyServer):r.cloudProxyServer==="disabled"||r.cloudProxyServer==="fallback"?"https://".concat(Gi,"/api/v2/transpond/webrtc?v=2"):_("".concat(Gi,"/api/v2/transpond/webrtc?v=2"),_p),{url:_f,areaCode:BO(),serviceIds:[Z_.CHOOSE_SERVER,r.cloudProxyServer==="proxy5"?Z_.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?Z_.CLOUD_PROXY:Z_.CLOUD_PROXY_FALLBACK]}}),Di=l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:_r.map(Gi=>Gi.url)}),Fi=await u0({fragementLength:kc("FRAGEMENT_LENGTH"),referenceList:_r,asyncMapHandler:Gi=>(_e.debug("[".concat(r.clientId,"] Connect to choose_server:"),Gi.url),i3(Gi,r,i,s)),allFailedhandler:Gi=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:Gi},Di),Gi[0]},promisesCollector:P});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},Di),Fi},H=async()=>{if(await sT(1e3),b!==null)return b;const _r=kc("WEBCS_DOMAIN_BACKUP_LIST").map((Gi,_p)=>{let _f;return _f=r.cloudProxyServer==="disabled"&&r.proxyServer?_("".concat(Gi,"/api/v2/transpond/webrtc?v=2"),_p,r.proxyServer):r.cloudProxyServer==="disabled"||r.cloudProxyServer==="fallback"?"https://".concat(Gi,"/api/v2/transpond/webrtc?v=2"):_("".concat(Gi,"/api/v2/transpond/webrtc?v=2"),_p),{url:_f,areaCode:BO(),serviceIds:[Z_.CHOOSE_SERVER,r.cloudProxyServer==="proxy5"?Z_.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?Z_.CLOUD_PROXY:Z_.CLOUD_PROXY_FALLBACK]}}),Di=l.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:_r.map(Gi=>Gi.url)}),Fi=await u0({fragementLength:kc("FRAGEMENT_LENGTH"),referenceList:_r,asyncMapHandler:Gi=>(_e.debug("[".concat(r.clientId,"] Connect to backup choose_server:"),Gi.url),i3(Gi,r,i,s)),allFailedhandler:Gi=>{throw l.recordJoinChannelService({endTs:Date.now(),status:"error",errors:Gi},Di),Gi[0]},promisesCollector:P});return l.recordJoinChannelService({endTs:Date.now(),status:"success"},Di),Fi};let B,z,Wt;try{({gatewayInfo:B,proxyInfo:z,url:Wt}=await NI([x(),H()]))}catch(_r){throw _r[0]}if(P.length&&P.forEach(_r=>_r.cancel&&typeof _r.cancel=="function"&&_r.cancel()),!B||!z)throw new _a(_i.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(r.apUrl=Wt,r.cloudProxyServer!=="disabled"&&Array.isArray(p)&&Wt){const _r=/^https?:\/\/(.+?)(\/.*)?$/.exec(Wt)[1];p.includes(_r)&&(r.proxyServer=_r,_e.setProxyServer(_r),AE.setProxyServer(_r))}return b={gatewayInfo:B,proxyInfo:await yX(z,B.uid)},b}async function l3(r,i,s,l){const p=kc("UAP_AP").slice(0,kc("AJAX_REQUEST_CONCURRENT")).map(_=>i.proxyServer?"https://".concat(i.proxyServer,"/ap/?url=").concat(_+"/api/v1?action=uap"):"https://".concat(_,"/api/v1?action=uap"));return await NX(p,r,i,s,l)}async function LX(r,i,s){const l=kc("UAP_AP").slice(0,kc("AJAX_REQUEST_CONCURRENT")).map(p=>r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(p+"/api/v1?action=uap"):"https://".concat(p,"/api/v1?action=uap")).map(p=>function(_,b,P,x){const H={command:"convergeAllocateEdge",sid:b.sid,appId:b.appId,token:b.token,ts:Date.now(),version:QT,cname:b.cname,uid:b.uid.toString(),requestId:cL,seq:cL};cL+=1;const B={service_name:"tele_channel",json_body:JSON.stringify(H)};return bS(async()=>{const z=await dS(_,{data:B,cancelToken:P,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(z.code!==0){const _r=new _a(_i.UNEXPECTED_RESPONSE,"cross channel ap error, code"+z.code,{retry:!0});throw _e.error(_r.toString()),_r}const Wt=JSON.parse(z.json_body);if(Wt.code!==200){const _r=new _a(_i.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(Wt.code,", reason: ").concat(Wt.reason));throw _e.error(_r.toString()),_r}if(!Wt.servers||Wt.servers.length===0){const _r=new _a(_i.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw _e.error(_r.toString()),_r}return{vid:Wt.vid,workerToken:Wt.workerToken,addressList:(kc("CHANNEL_MEDIA_RELAY_SERVERS")||Wt.servers).map(_r=>"wss://".concat(_r.address.replace(/\./g,"-"),".").concat(kc("WORKER_DOMAIN"),":").concat(_r.wss))}},void 0,z=>!!(z.code!==_i.OPERATION_ABORTED&&z.code!==_i.UNEXPECTED_RESPONSE||z.data&&z.data.retry),x)}(p,r,i,s));try{const p=await NI(l);return l.forEach(_=>_.cancel()),p}catch(p){throw p[0]}}async function MX(r,i,s){let l=null;const p=[],_=async b=>{const P=kc(b?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(x=>r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(x+"/api/v2/transpond/webrtc?v=2"):"https://".concat(x,"/api/v2/transpond/webrtc?v=2"));return b&&(await sT(1e3),l!==null)?l:await u0({fragementLength:kc("FRAGEMENT_LENGTH"),referenceList:P,asyncMapHandler:x=>(_e.debug("[".concat(r.clientId,"] update ticket, Connect to ").concat(b?"backup":""," choose_server:"),x),function(H,B,z,Wt){const[_r]=PX(B,[Z_.CHOOSE_SERVER]);let Di=B_.networkState;return bS(async()=>{Di&&B_.networkState===uT.OFFLINE&&B_.onlineWaiter&&await SE.race([B_.onlineWaiter,sT(Wt&&Wt.maxRetryTimeout||j_.maxRetryTimeout)]),Di=B_.networkState;const Fi=await dS(H,{data:_r,cancelToken:z,headers:{"Content-Type":"multipart/form-data;"}},!0);return DX(Fi,H)},()=>!1,Fi=>Fi.code!==_i.OPERATION_ABORTED&&(Fi.code===_i.UPDATE_TICKET_FAILED?Fi.data.retry:(_e.warning("[".concat(B.clientId,"] update ticket network error, retry"),Fi),!0)),Wt)}(x,r,i,s)),allFailedhandler:x=>{throw x[0]},promisesCollector:p})};try{return l=await NI([_(!1),_(!0)]),p.length&&p.forEach(b=>b.cancel&&typeof b.cancel=="function"&&b.cancel()),l}catch(b){throw b[0]}}function h3(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function p3(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?h3(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):h3(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}class UX extends I_{constructor(){super(),$(this,"configs",void 0),$(this,"joinInfo",void 0),$(this,"cancelToken",void 0),$(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),$(this,"interval",void 0),$(this,"mutex",new mT("config-distribute")),$(this,"mutableParamsRead",!1)}startGetConfigDistribute(i,s){this.joinInfo=i,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),kc("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},kc("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,AE.reportApiInvoke(null,{options:void 0,name:V_.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:S_.TRACER}).onSuccess(JSON.stringify(xR))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void _e.debug("[config-distribute] get config distribute interrupted have no joininfo");let i;const s=await this.mutex.lock();try{i=await kX(this.joinInfo,this.cancelToken,this.retryConfig),_e.debug("[config-distribute] get config distribute",JSON.stringify(i)),i.limit_bitrate&&this.handleBitrateLimit(i.limit_bitrate),this.cacheGlobalParameterConfig(i),this.configs=i}catch(l){const p=new _a(_i.NETWORK_RESPONSE_ERROR,l);_e.warning("[config-distribute] ".concat(p.toString()))}finally{s()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(i){var s;(s=i)&&s.uplink&&s.id&&s.uplink.max_bitrate!==void 0&&s.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==i.id&&this.emit(s0.UPDATE_BITRATE_LIMIT,i):this.emit(s0.UPDATE_BITRATE_LIMIT,i))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&p3({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(i){var s;const l=OP(s=Object.keys(i).filter(_=>/^webrtc_ng_global_parameter/.test(_))).call(s);for(let _=0;_<l.length;_++)for(let b=l.length-1;b>_;b--){const P=l[b];if(typeof i[P].__priority=="number"){const x=i[P].__priority,H=l[b-1];if(typeof i[H].__priority=="number"){if(!(x>i[H].__priority))continue;{const B=P;l[b]=l[b-1],l[b-1]=B}}else{const B=P;l[b]=l[b-1],l[b-1]=B}}}const p={};l.forEach(_=>{const b=i[_],P=b.__expires;Object.keys(b).forEach(x=>{x==="__priority"||x==="__expires"||Object.prototype.hasOwnProperty.call(p,x)||(p[x]=p3({value:b[x]},P&&{expires:P}))})});try{const _=JSON.stringify(p),b=window.btoa(_);window.localStorage.setItem("websdk_ng_global_parameter",b),_e.debug("Caching global parameters ".concat(_))}catch(_){_e.error("Error caching global parameters:",_.message)}}}function f3(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function l0(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?f3(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):f3(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}class xX extends I_{constructor(i,s,l,p){super(),$(this,"spec",void 0),$(this,"token",void 0),$(this,"websocket",void 0),$(this,"pingpongTimer",void 0),$(this,"reconnectMode","retry"),$(this,"serviceMode",void 0),$(this,"reqId",0),$(this,"commandReqId",0),$(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),$(this,"handleWebSocketMessage",_=>{if(!_.data)return;const b=JSON.parse(_.data);b.requestId?this.emit("@".concat(b.requestId,"-").concat(b.sid),b):this.serviceMode===Y_.INJECT?this.emit(uS.INJECT_STREAM_STATUS,b):(AE.workerEvent(this.spec.sid,{actionType:"status",serverCode:b.code,workerType:this.serviceMode===Y_.TRANSCODE?1:2}),this.emit(uS.PUBLISH_STREAM_STATUS,b))}),this.spec=s,this.token=i,this.serviceMode=p,this.websocket=new HR("live-streaming",l),this.websocket.on(xE.CONNECTED,this.handleWebSocketOpen),this.websocket.on(xE.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(xE.REQUEST_NEW_URLS,(_,b)=>{aT(this,uS.REQUEST_NEW_ADDRESS).then(_).catch(b)}),this.websocket.on(xE.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(i){return this.websocket.init(i)}async request(i,s,l,p){this.reqId+=1,i==="request"&&(this.commandReqId+=1);const _=this.commandReqId,b=this.reqId;if(!b||!this.websocket)throw new _a(_i.UNEXPECTED_ERROR);const P=l0({command:i,sdkVersion:QT==="4.18.2"?"0.0.1":QT,seq:b,requestId:b,allocate:l,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new _a(_i.WS_DISCONNECT);const x=()=>new SE((Wt,_r)=>{this.websocket.once(xE.CLOSED,()=>_r(new _a(_i.WS_ABORT))),this.websocket.once(xE.CONNECTED,Wt)});this.websocket.state!=="connected"&&await x(),P.clientRequest&&(P.clientRequest.workerToken=this.token);const H=new SE((Wt,_r)=>{const Di=()=>{_r(new _a(_i.WS_ABORT))};this.websocket.once(xE.RECONNECTING,Di),this.websocket.once(xE.CLOSED,Di),this.once("@".concat(b,"-").concat(this.spec.sid),Fi=>{Wt(Fi)})});p&&AE.workerEvent(this.spec.sid,l0(l0({},p),{},{requestId:_,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const B=Date.now();this.websocket.sendMessage(P);let z=null;try{z=await H}catch(Wt){if(this.websocket.state==="closed")throw Wt;return await x(),await this.request(i,s,l)}return p&&AE.workerEvent(this.spec.sid,l0(l0({},p),{},{requestId:_,actionType:"response",payload:JSON.stringify(z.serverResponse),serverCode:z.code,success:z.code===200,responseTime:Date.now()-B})),z.code!==200&&this.handleResponseError(z),z}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const i=QT==="4.18.2"?"0.0.1":QT;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:i,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(i){switch(i.code){case k_.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void _e.warning("live stream response already exists stream");case k_.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case k_.LIVE_STREAM_RESPONSE_BAD_STREAM:case k_.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new _a(_i.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:i.code}).throw();case k_.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(i.serverResponse.command==="UnpublishStream"||i.serverResponse.command==="UninjectStream")return;throw new _a(_i.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case k_.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new _a(_i.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:i.code}).throw();case k_.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new _a(_i.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(uS.WARNING,s,i.serverResponse.url)}case k_.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new _a(_i.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(uS.WARNING,s,i.serverResponse.url)}case k_.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new _a(_i.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case k_.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new _a(_i.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:i.code}).throw();case k_.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new _a(_i.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(uS.WARNING,s,i.serverResponse.url)}case k_.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new _a(_i.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code}).throw();case k_.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new _a(_i.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case k_.LIVE_STREAM_RESPONSE_WORKER_LOST:case k_.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(i.serverResponse.command==="UnpublishStream"||i.serverResponse.command==="UninjectStream")return;throw new _a(_i.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case k_.ERROR_FAIL_SEND_MESSAGE:if(i.serverResponse.command==="UnpublishStream"||i.serverResponse.command==="UninjectStream")return;if(i.serverResponse.command==="UpdateTranscoding"||i.serverResponse.command==="ControlStream")return new _a(_i.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:i.code}).throw();throw new _a(_i.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case k_.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case k_.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case k_.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case k_.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new _a(_i.LIVE_STREAMING_CDN_ERROR,"",{code:i.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(jO)},6e3)}}function E3(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function TT(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?E3(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):E3(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}class jX extends I_{constructor(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:j_,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:j_;super(),$(this,"onLiveStreamWarning",void 0),$(this,"onLiveStreamError",void 0),$(this,"onInjectStatusChange",void 0),$(this,"spec",void 0),$(this,"retryTimeout",1e4),$(this,"connection",void 0),$(this,"httpRetryConfig",void 0),$(this,"wsRetryConfig",void 0),$(this,"streamingTasks",new Map),$(this,"isStartingStreamingTask",!1),$(this,"taskMutex",new mT("live-streaming")),$(this,"cancelToken",jT.CancelToken.source()),$(this,"transcodingConfig",void 0),$(this,"injectConfig",TT({},e9)),$(this,"injectLoopTimes",0),$(this,"uapResponse",void 0),$(this,"lastTaskId",1),$(this,"statusError",new Map),this.spec=i,this.httpRetryConfig=l,this.wsRetryConfig=s}async setTranscodingConfig(i){const s=TT(TT({},t9),i);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(_e.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(b=>TT(TT(TT({},Z7),b),{},{zOrder:b.zOrder?b.zOrder+1:1}))),function(b){T_(b.width)||__(b.width,"config.width",0,1e4),T_(b.height)||__(b.height,"config.height",0,1e4),T_(b.videoBitrate)||__(b.videoBitrate,"config.videoBitrate",1,1e6),T_(b.videoFrameRate)||__(b.videoFrameRate,"config.videoFrameRate"),T_(b.lowLatency)||vI(b.lowLatency,"config.lowLatency"),T_(b.audioSampleRate)||Qm(b.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),T_(b.audioBitrate)||__(b.audioBitrate,"config.audioBitrate",1,128),T_(b.audioChannels)||Qm(b.audioChannels,"config.audioChannels",[1,2,3,4,5]),T_(b.videoGop)||__(b.videoGop,"config.videoGop"),T_(b.videoCodecProfile)||Qm(b.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),T_(b.userCount)||__(b.userCount,"config.userCount",0,17),T_(b.backgroundColor)||__(b.backgroundColor,"config.backgroundColor",0,16777215),T_(b.userConfigExtraInfo)||tT(b.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),b.transcodingUsers&&!T_(b.transcodingUsers)&&(HS(b.transcodingUsers,"config.transcodingUsers"),b.transcodingUsers.forEach((P,x)=>{wP(P.uid),T_(P.x)||__(P.x,"transcodingUser[".concat(x,"].x"),0,1e4),T_(P.y)||__(P.y,"transcodingUser[".concat(x,"].y"),0,1e4),T_(P.width)||__(P.width,"transcodingUser[".concat(x,"].width"),0,1e4),T_(P.height)||__(P.height,"transcodingUser[".concat(x,"].height"),0,1e4),T_(P.zOrder)||__(P.zOrder-1,"transcodingUser[".concat(x,"].zOrder"),0,100),T_(P.alpha)||__(P.alpha,"transcodingUser[".concat(x,"].alpha"),0,1,!1)})),T_(b.watermark)||UP(b.watermark,"watermark"),T_(b.backgroundImage)||UP(b.backgroundImage,"backgroundImage"),b.images&&!T_(b.images)&&(HS(b.images,"config.images"),b.images.forEach((P,x)=>{UP(P,"images[".concat(x,"]"))}))}(s);const l=[];s.images&&l.push(...s.images.map(b=>TT(TT(TT({},MP),b),{},{zOrder:255}))),s.backgroundImage&&(l.push(TT(TT(TT({},MP),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(l.push(TT(TT(TT({},MP),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=l,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(b=>TT({},b)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const p=(s.userConfigs||[]).map(b=>typeof b.uid=="number"?SE.resolve(b.uid):u3(b.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await SE.all(p)).forEach((b,P)=>{s.userConfigs&&s.userConfigs[P]&&(s.userConfigs[P].uid=b)}),this.transcodingConfig=s,this.connection)try{var _;const b=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(LS(_=this.streamingTasks).call(_)).map(P=>P.taskId).join("#")});_e.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(b.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(b){if(!b.data||!b.data.retry)throw b;b.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(P=>{_e.warning("[".concat(this.spec.clientId,"] live streaming receive error"),b.toString(),"try to republish",P.url),this.startLiveStreamingTask(P.url,P.mode,b).then(()=>{_e.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(P.url," success"))}).catch(x=>{_e.error("[".concat(this.spec.clientId,"] live streaming republish failed"),P.url,x.toString()),this.onLiveStreamError&&this.onLiveStreamError(P.url,x)})})}}setInjectStreamConfig(i,s){this.injectConfig=Object.assign({},this.injectConfig,i),this.injectLoopTimes=s}async startLiveStreamingTask(i,s,l){var p;if(Array.from(LS(p=this.streamingTasks).call(p)).find(x=>x.mode===Y_.INJECT)&&s===Y_.INJECT)return new _a(_i.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&s===Y_.TRANSCODE)throw new _a(_i.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let _={command:"PublishStream",ts:Date.now(),url:i,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};_e.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(i,", mode: ").concat(s));const b=await this.taskMutex.lock();if(!this.connection&&l)return void b();if(this.streamingTasks.get(i)&&!l)return b(),new _a(_i.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(x){throw b(),x}switch(s){case Y_.TRANSCODE:_.transcodingConfig=TT({},this.transcodingConfig);break;case Y_.RAW:break;case Y_.INJECT:_={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:i,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(_.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const P=this.lastTaskId++;try{const x=new SE((B,z)=>{sT(this.retryTimeout).then(()=>{if(l)return z(l);const Wt=this.statusError.get(i);return Wt?(this.statusError.delete(i),z(Wt)):void 0})}),H=await SE.race([this.connection.request("request",{clientRequest:_},!0,{url:i,command:"PublishStream",workerType:s===Y_.TRANSCODE?1:2,requestByUser:!l,tid:P.toString()}),x]);this.isStartingStreamingTask=!1,_e.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(H.code)),this.streamingTasks.set(i,{clientRequest:_,mode:s,url:i,taskId:P}),b()}catch(x){if(b(),this.isStartingStreamingTask=!1,!x.data||!x.data.retry||l)throw x;return x.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(i,s,x)):await this.startLiveStreamingTask(i,s,x)}}stopLiveStreamingTask(i){return new SE((s,l)=>{const p=this.streamingTasks.get(i);if(!p||!this.connection)return new _a(_i.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const _=p.mode;p.abortTask=()=>{_e.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(i),s()},this.connection.request("request",{clientRequest:{command:_===Y_.INJECT?"UninjectStream":"UnpublishStream",url:p.url}},!1,{url:i,command:"UnPublishStream",workerType:_===Y_.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(b=>{_e.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(b.code)),this.streamingTasks.delete(i),this.streamingTasks.size===0&&_!==Y_.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),s(),_===Y_.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(uR.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,i)}).catch(l)})}async controlInjectStream(i,s,l,p){const _=this.streamingTasks.get(i);if(!_||!this.connection||_.mode!==Y_.INJECT)throw new _a(_i.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:i,control:s,audioVolume:l,position:p}})).serverResponse}resetAllTask(){var i;const s=Array.from(LS(i=this.streamingTasks).call(i));this.terminate();for(const l of s)this.startLiveStreamingTask(l.url,l.mode).catch(p=>{this.onLiveStreamError&&this.onLiveStreamError(l.url,p)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=jT.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(i){if(this.connection)throw new _a(_i.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await aT(this,bI.REQUEST_WORKER_MANAGER_LIST,i);return this.uapResponse=s,this.connection=new xX(s.workerToken,this.spec,this.wsRetryConfig,i),this.connection.on(uS.WARNING,(l,p)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(p,l)),this.connection.on(uS.PUBLISH_STREAM_STATUS,l=>this.handlePublishStreamServer(l)),this.connection.on(uS.INJECT_STREAM_STATUS,l=>this.handleInjectStreamServerStatus(l)),this.connection.on(uS.REQUEST_NEW_ADDRESS,(l,p)=>{if(!this.connection)return p(new _a(_i.UNEXPECTED_ERROR,"can not get new live streaming address list"));aT(this,bI.REQUEST_WORKER_MANAGER_LIST,i).then(_=>{this.uapResponse=_,l(_.addressList)}).catch(p)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(i){const s=i.serverStatus&&i.serverStatus.url||"empty_url",l=this.streamingTasks.get(s),p=i.reason;switch(i.code){case k_.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case k_.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case k_.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case k_.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const b=new _a(_i.LIVE_STREAMING_CDN_ERROR,"",{code:i.code});if(l)return _e.error(b.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,b);if(!this.isStartingStreamingTask)return;this.statusError.set(s,b)}case k_.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const b=new _a(_i.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,p);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,b)}case k_.LIVE_STREAM_RESPONSE_WORKER_LOST:case k_.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var _;if(!this.connection)return;this.connection.tryNextAddress();const b=Array.from(LS(_=this.streamingTasks).call(_));for(const P of b)P.abortTask?P.abortTask():(_e.warning("[".concat(this.spec.clientId,"] publish stream status code"),i.code,"try to republish",P.url),this.startLiveStreamingTask(P.url,P.mode,new _a(_i.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code})).then(()=>{_e.debug("[".concat(this.spec.clientId,"] republish live stream success"),P.url)}).catch(x=>{_e.error(x.toString()),this.onLiveStreamError&&this.onLiveStreamError(P.url,x)}));return}}}handleInjectStreamServerStatus(i){const s=Number(i.uid),l=i.serverStatus&&i.serverStatus.url;switch(i.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(uR.INJECT_STREAM_STATUS_START_SUCCESS,s,l));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(uR.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,s,l),void this.streamingTasks.delete(l);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(uR.INJECT_STREAM_STATUS_START_UNAUTHORIZED,s,l),void this.streamingTasks.delete(l);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(uR.INJECT_STREAM_STATUS_BROKEN,s,l),void this.streamingTasks.delete(l);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(uR.INJECT_STREAM_STATUS_START_TIMEOUT,s,l),void this.streamingTasks.delete(l);default:return void _e.debug("inject stream server status",i)}}hasUrl(i){return this.streamingTasks.has(i)}}class _3{constructor(){$(this,"destChannelMediaInfos",new Map),$(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(i){aV(i),this.srcChannelMediaInfo=i}addDestChannelInfo(i){aV(i),this.destChannelMediaInfos.set(i.channelName,i)}removeDestChannelInfo(i){CP(i),this.destChannelMediaInfos.delete(i)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function m3(r){if(!(r instanceof _3))return new _a(_i.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const i=r.getSrcChannelMediaInfo(),s=r.getDestChannelMediaInfo();if(!i)return new _a(_i.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new _a(_i.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class VX extends I_{constructor(i,s,l){super(),$(this,"ws",void 0),$(this,"requestId",1),$(this,"heartBeatTimer",void 0),$(this,"joinInfo",void 0),$(this,"clientId",void 0),$(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),$(this,"onClose",p=>{this.emit("close"),this.dispose()}),$(this,"onMessage",p=>{const _=JSON.parse(p.data);if(!_||_.command!=="serverResponse"||!_.requestId)return _&&_.command==="serverStatus"&&_.serverStatus&&_.serverStatus.command?(this.emit("status",_.serverStatus),void this.emit(_.serverStatus.command,_.serverStatus)):void 0;this.emit("req_".concat(_.requestId),_)}),this.joinInfo=i,this.clientId=s,this.ws=new HR("cross-channel-".concat(this.clientId),l),this.ws.on(xE.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(xE.CONNECTED,this.onOpen),this.ws.on(xE.ON_MESSAGE,this.onMessage),this.ws.on(xE.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(i){const s=this.requestId++;return i.requestId=s,i.seq=s,this.ws.sendMessage(i),s}waitStatus(i){return new SE((s,l)=>{const p=window.setTimeout(()=>{l(new _a(_i.TIMEOUT,"wait status timeout, status: ".concat(i)))},5e3);this.once(i,_=>{window.clearTimeout(p),_.state&&_.state!==0?l(new _a(_i.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(i))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(p),l(new _a(_i.WS_ABORT))})})}async request(i){if(this.ws.state==="closed")throw new _a(_i.WS_DISCONNECT);const s=()=>new SE((b,P)=>{this.ws.once(xE.CLOSED,()=>P(new _a(_i.WS_ABORT))),this.ws.once(xE.CONNECTED,b)});this.ws.state!=="connected"&&await s();const l=this.sendMessage(i),p=new SE((b,P)=>{const x=()=>{P(new _a(_i.WS_ABORT))};this.ws.once(xE.RECONNECTING,x),this.ws.once(xE.CLOSED,x),this.once("req_".concat(l),b),sT(3e3).then(()=>{this.removeAllListeners("req_".concat(l)),this.ws.off(xE.RECONNECTING,x),this.ws.off(xE.CLOSED,x),P(new _a(_i.TIMEOUT,"cross channel ws request timeout"))})}),_=await p;if(!_||_.code!==200)throw new _a(_i.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(_)));return _}async connect(i){this.ws.removeAllListeners(xE.REQUEST_NEW_URLS),this.ws.on(xE.REQUEST_NEW_URLS,s=>{s(i)}),await this.ws.init(i)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(i){const s=this.requestId++;return i.requestId=s,this.ws.sendMessage(i),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class FX extends I_{set state(i){i!==this._state&&(i!==_T.RELAY_STATE_FAILURE&&(this.errorCode=dR.RELAY_OK),this.emit("state",i,this.errorCode),this._state=i)}get state(){return this._state}constructor(i,s,l,p,_){super(),$(this,"joinInfo",void 0),$(this,"sid",void 0),$(this,"clientId",void 0),$(this,"cancelToken",jT.CancelToken.source()),$(this,"workerToken",void 0),$(this,"requestId",0),$(this,"signal",void 0),$(this,"prevChannelMediaConfig",void 0),$(this,"httpRetryConfig",void 0),$(this,"_resolution",void 0),$(this,"_state",_T.RELAY_STATE_IDLE),$(this,"errorCode",dR.RELAY_OK),$(this,"onStatus",b=>{_e.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(b))),b&&b.command&&(b.command==="onAudioPacketReceived"&&this.emit("event",TS.PACKET_RECEIVED_AUDIO_FROM_SRC),b.command==="onVideoPacketReceived"&&this.emit("event",TS.PACKET_RECEIVED_VIDEO_FROM_SRC),b.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=dR.SRC_TOKEN_EXPIRED,this.state=_T.RELAY_STATE_FAILURE),b.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=dR.DEST_TOKEN_EXPIRED,this.state=_T.RELAY_STATE_FAILURE))}),$(this,"onReconnect",async()=>{_e.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",TS.NETWORK_DISCONNECTED),this.state=_T.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(b=>{this.state!==_T.RELAY_STATE_IDLE&&(_e.error("auto restart channel media relay failed",b.toString()),this.errorCode=dR.SERVER_CONNECTION_LOST,this.state=_T.RELAY_STATE_FAILURE)})}),this.joinInfo=i,this.clientId=s,this.sid=eL(),this.signal=new VX(this.joinInfo,this.clientId,l),this.httpRetryConfig=p,this._resolution=_}async startChannelMediaRelay(i){if(this.state!==_T.RELAY_STATE_IDLE)throw new _a(_i.INVALID_OPERATION);this.state=_T.RELAY_STATE_CONNECTING,await this.connect(),_e.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(i)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new _a(_i.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new _a(_i.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new _a(_i.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=i}async updateChannelMediaRelay(i){if(this.state!==_T.RELAY_STATE_RUNNING)throw new _a(_i.INVALID_OPERATION);await this.sendUpdateMessage(i),this.prevChannelMediaConfig=i}async setVideoProfile(i){if(this._resolution=i,this.state!==_T.RELAY_STATE_RUNNING)throw new _a(_i.INVALID_OPERATION);const s=this.genMessage(rT.SetVideoProfile);await this.signal.request(s),_e.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),_e.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=_T.RELAY_STATE_IDLE,this.dispose()}dispose(){_e.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=jT.CancelToken.source(),this.state=_T.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const i=await LX(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=i.workerToken,await this.signal.connect(i.addressList),this.emit("event",TS.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(i){const s=this.genMessage(rT.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),_e.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const l=this.genMessage(rT.SetSdkProfile,i);await this.signal.request(l),_e.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const p=this.genMessage(rT.SetSourceChannel,i);await this.signal.request(p),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",TS.PACKET_JOINED_SRC_CHANNEL),_e.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const _=this.genMessage(rT.SetSourceUserId,i);await this.signal.request(_),_e.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const b=this.genMessage(rT.SetDestChannel,i);await this.signal.request(b),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",TS.PACKET_JOINED_DEST_CHANNEL),_e.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const P=this.genMessage(rT.StartPacketTransfer,i);await this.signal.request(P),this.emit("event",TS.PACKET_SENT_TO_DEST_CHANNEL),this.state=_T.RELAY_STATE_RUNNING,_e.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(i){const s=this.genMessage(rT.UpdateDestChannel,i);await this.signal.request(s),this.emit("event",TS.PACKET_UPDATE_DEST_CHANNEL),_e.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const i=this.genMessage(rT.StopPacketTransfer);await this.signal.request(i),_e.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(i,s){const l=[],p=[],_=[];this.requestId+=1;const b={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:QT,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};b.sdkVersion==="4.18.2"&&(b.sdkVersion="0.0.1");let P=null,x=null;switch(i){case rT.SetSdkProfile:return b.clientRequest={command:"SetSdkProfile",type:"multi_channel"},b;case rT.SetSourceChannel:if(x=s&&s.getSrcChannelMediaInfo(),!x)throw new _a(_i.UNEXPECTED_ERROR,"can not find source config");return b.clientRequest={command:"SetSourceChannel",uid:"0",channelName:x.channelName,token:x.token||this.joinInfo.appId},b;case rT.SetSourceUserId:if(x=s&&s.getSrcChannelMediaInfo(),!x)throw new _a(_i.UNEXPECTED_ERROR,"can not find source config");return b.clientRequest={command:"SetSourceUserId",uid:x.uid+""},b;case rT.SetDestChannel:if(P=s&&s.getDestChannelMediaInfo(),!P)throw new _a(_i.UNEXPECTED_ERROR,"can not find dest config");return P.forEach(H=>{l.push(H.channelName),p.push(H.uid+""),_.push(H.token||this.joinInfo.appId)}),b.clientRequest={command:"SetDestChannel",channelName:l,uid:p,token:_},b;case rT.StartPacketTransfer:return b.clientRequest={command:"StartPacketTransfer"},b;case rT.Reconnect:return b.clientRequest={command:"Reconnect"},b;case rT.StopPacketTransfer:return b.clientRequest={command:"StopPacketTransfer"},b;case rT.UpdateDestChannel:if(P=s&&s.getDestChannelMediaInfo(),!P)throw new _a(_i.UNEXPECTED_ERROR,"can not find dest config");return P.forEach(H=>{l.push(H.channelName),p.push(H.uid+""),_.push(H.token||this.joinInfo.appId)}),b.clientRequest={command:"UpdateDestChannel",channelName:l,uid:p,token:_},b;case rT.SetVideoProfile:b.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return b}}const dL=r=>{const i=document.createElement("canvas");return i.width=2,i.height=2,new SE((s,l)=>{i.toBlob(async p=>{if(i.remove(),p){const _=await g3(p);s({buffer:_,width:i.width,height:i.height})}else l(new _a(_i.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,1)})},g3=async r=>{const i=await r.arrayBuffer();return new Uint8Array(i)};function v3(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function y3(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?v3(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):v3(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}class lL{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(i){i!==this._videoElementStatus&&(_e.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(i)),this._videoElementStatus=i)}constructor(i){$(this,"trackId",void 0),$(this,"config",void 0),$(this,"onFirstVideoFrameDecoded",void 0),$(this,"freezeTimeCounterList",[]),$(this,"renderFreezeAccTime",0),$(this,"isKeepLastFrame",!1),$(this,"timeUpdatedCount",0),$(this,"freezeTime",0),$(this,"playbackTime",0),$(this,"lastTimeUpdatedTime",0),$(this,"autoplayFailed",!1),$(this,"videoTrack",void 0),$(this,"videoElement",void 0),$(this,"cacheVideoElement",void 0),$(this,"videoElementCheckInterval",void 0),$(this,"_videoElementStatus",eT.NONE),$(this,"isGettingVideoDimensions",!1),$(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return _e.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),$(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&s_.curState==="running"&&(_e.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(_x())),i2()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),$(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=eT.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=eT.CANPLAY;break;case"stalled":this.videoElementStatus=eT.STALLED;break;case"suspend":this.videoElementStatus=eT.SUSPEND;break;case"pause":this.videoElementStatus=eT.PAUSED,fT()||PS()||pT()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(_e.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=eT.WAITING;break;case"abort":this.videoElementStatus=eT.ABORT;break;case"ended":this.videoElementStatus=eT.ENDED;break;case"emptied":this.videoElementStatus=eT.EMPTIED;break;case"error":{this.videoElementStatus=eT.ERROR;const l=this.videoElement.error;l&&_e.error("[".concat(this.trackId,"] media error, code: ").concat(l.code,", message: ").concat(l.message));break}case"timeupdate":{const l=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=l);const p=l-this.lastTimeUpdatedTime,_=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=l,zS.lastVisibleTime<zS.lastHiddenTime||_<zS.lastHiddenTime||_<zS.lastVisibleTime)return;for(p>kc("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=p),this.playbackTime+=p;this.playbackTime>=6e3;){this.playbackTime-=6e3;const b=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(b),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),$(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(_e.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(_x())),i2()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=i.trackId,this.config=i,i.element instanceof HTMLVideoElement?this.videoElement=i.element:this.videoElement=document.createElement("video"),s_.on(_m.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),s_.on(_m.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var i;return(i=this.videoElement.parentElement)!==null&&i!==void 0?i:void 0}updateConfig(i){this.config=i,this.trackId=i.trackId,i.element!==this.videoElement&&(this.destroy(),this.videoElement=i.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.initVideoElement())}play(i){const s=this.videoElement.play();s&&s.catch&&s.catch(p=>{i&&AE.autoplayFailed(i,"video",p.message,this.trackId),p.name==="NotAllowedError"?(_e.warning("detected video element autoplay failed",p),this.autoplayFailed=!0,this.handleAutoPlayFailed()):_e.warning("[".concat(this.trackId,"] play warning: "),p)});const l=i_();if((l.name==="Safari"&&Number(l.version)===15||lI())&&s&&s.then&&s.catch){const p=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(p).catch(p)}}getCurrentFrame(){const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const s=i.getContext("2d");if(!s)return _e.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,i.width,i.height);const l=s.getImageData(0,0,i.width,i.height);return i.remove(),l}async getCurrentFrameToUint8Array(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const l=document.createElement("canvas");l.width=this.videoElement.videoWidth,l.height=this.videoElement.videoHeight;const p=l.getContext("2d");return p?(p.drawImage(this.videoElement,0,0,l.width,l.height),new SE((_,b)=>{l.toBlob(async P=>{if(l.remove(),P){const x=await g3(P);_({buffer:x,width:l.width,height:l.height})}else b(new _a(_i.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},i,s<0?.1:s>1?1:s)})):await dL(i)}destroy(){s_.off(_m.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),s_.off(_m.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=eT.INIT,!this.videoElementCheckInterval&&(b3.forEach(_=>{this.videoElement.addEventListener(_,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(_){return _!==document.body&&document.body.contains(_)})(this.videoElement)||(this.videoElementStatus=eT.DESTROYED)},1e3),kc("ENABLE_VIDEO_FRAME_CALLBACK"))){var i,s;let _;const b=(P,x)=>{if(this.videoElementStatus===eT.PLAYING){if(_){const z=x.presentationTime-_.presentationTime;z>kc("VIDEO_FREEZE_DURATION")&&zS.lastVisibleTime>=zS.lastHiddenTime&&_.timestamp>zS.lastVisibleTime&&_.timestamp>zS.lastHiddenTime&&(this.renderFreezeAccTime+=z)}_=y3(y3({},x),{},{timestamp:P})}var H,B;kc("ENABLE_VIDEO_FRAME_CALLBACK")&&((H=(B=this.videoElement).requestVideoFrameCallback)===null||H===void 0||H.call(B,b))};(i=(s=this.videoElement).requestVideoFrameCallback)===null||i===void 0||i.call(s,b)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),pO()&&(this.videoElement.poster="noposter");const l=i_();l.name==="Safari"&&Number(l.version)===15||lI()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,A_()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,A_()&&this.videoElement.load());const p=this.videoElement.play();p!==void 0&&p.catch(_=>{_e.debug("[".concat(this.trackId,"] playback interrupted"),_.toString())})}resetVideoElement(){b3.forEach(i=>{this.videoElement&&this.videoElement.removeEventListener(i,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=eT.NONE}handleAutoPlayFailed(){const i=s=>{s.preventDefault(),this.videoElement.play().then(()=>{_e.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(l=>{_e.error(l)}),this.autoplayFailed=!1,ZI()?document.body.removeEventListener("click",i,!0):(document.body.removeEventListener("touchstart",i,!0),document.body.removeEventListener("mousedown",i,!0))};ZI()?document.body.addEventListener("click",i,!0):(document.body.addEventListener("touchstart",i,!0),document.body.addEventListener("mousedown",i,!0)),RV()}}const b3=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class T3 extends lL{constructor(i){super(i),$(this,"container",void 0),$(this,"slot",void 0),this.slot=i.element,this.updateConfig(i)}updateConfig(i){this.config=i,this.trackId=i.trackId;const s=i.element;s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.createElements())}play(i){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(i)}getCurrentFrame(){var i;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(i){var s;let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(i,l):await dL(i)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",kc("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var i;!this.container||(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var i;if((i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function qO(r){const i={};r.facingMode&&(i.facingMode=r.facingMode),r.cameraId&&(i.deviceId={exact:r.cameraId});const s=UR(r.encoderConfig);return i.width=s.width,i.height=s.height,!s2()&&s.frameRate&&(i.frameRate=s.frameRate),i_().name===u_.EDGE&&typeof i.frameRate=="object"&&(i.frameRate.max=60),A_()&&(i.frameRate={ideal:30,max:30}),i}function BX(r){const i={};r.screenSourceType&&(i.mediaSource=r.screenSourceType),r.extensionId&&$D()&&(i.extensionId=r.extensionId);const{displaySurface:s,selfBrowserSurface:l,surfaceSwitching:p,systemAudio:_}=r;(ZD(107)||t2(107)||e2(93))&&(s&&(Qm(s,"displaySurface",["browser","window","monitor"]),i.displaySurface=s),l?(Qm(l,"selfBrowserSurface",["exclude","include"]),i.selfBrowserSurface=l):i.selfBrowserSurface="include",p&&(Qm(p,"surfaceSwitching",["exclude","include"]),i.surfaceSwitching=p)),(ZD(105)||t2(105)||e2(91))&&_&&(Qm(_,"systemAudio",["exclude","include"]),i.systemAudio=_),r.electronScreenSourceId&&(i.sourceId=r.electronScreenSourceId);const b=r.encoderConfig?yP(r.encoderConfig):null;return i.mandatory={chromeMediaSource:"desktop",maxWidth:b?b.width:void 0,maxHeight:b?b.height:void 0},b&&(b.frameRate&&(typeof b.frameRate=="number"?(i.mandatory.maxFrameRate=b.frameRate,i.mandatory.minFrameRate=b.frameRate):(i.mandatory.maxFrameRate=b.frameRate.max||b.frameRate.ideal||b.frameRate.exact||void 0,i.mandatory.minFrameRate=b.frameRate.min||b.frameRate.ideal||b.frameRate.exact||void 0),i.frameRate=b.frameRate),b.width&&(i.width=b.width),b.height&&(i.height=b.height)),i}function S3(r){const i={};if(s2()||(r.AGC!==void 0&&(i.autoGainControl=r.AGC),r.AEC!==void 0&&(i.echoCancellation=r.AEC),r.ANS!==void 0&&(i.noiseSuppression=r.ANS,$D()&&r.ANS&&(i.googHighpassFilter=r.ANS))),r.encoderConfig){const s=IO(r.encoderConfig);i.channelCount=s.stereo?2:1,i.sampleRate=s.sampleRate,i.sampleSize=s.sampleSize}return r.microphoneId&&(i.deviceId={exact:r.microphoneId}),pO()&&(i.sampleRate=void 0),i}var PI,WO;(function(r){r.COVERED="COVERED",r.POSITION="POSITION",r.SIZE="SIZE",r.STYLE="STYLE"})(PI||(PI={})),function(r){r.UNMOUNTED="UNMOUNTED",r.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(WO||(WO={}));var R3,I3,O3,A3,C3,w3,N3,D3,P3,k3,L3,M3,U3,x3,j3,V3,F3,B3,G3,q3,W3,K3,H3,Y3,KE,z3,J3,X3,Q3,$3,Z3,_B,tG,eS,eG=new class{constructor(){$(this,"_clientSize",null),$(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),$(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),$(this,"getStyle",r=>window.getComputedStyle(r,null)),$(this,"checkCssVisibleProperty",r=>{let i=!0;const s=this.getStyle(r),{display:l,visibility:p,opacity:_,filter:b}=s;return(l==="none"||["hidden","collapse"].includes(p)||Number(_)<.1)&&(i=!1),i?(b&&b.split(" ").filter(P=>{const x=P.split("(")[0];return["brightness","blur","opacity"].includes(x)}).map(P=>{const[x,H]=P.split(/\(|\)/);return[x,Number(H.match(/^[0-9\.]+/))]}).forEach(P=>{const[x,H]=P;switch(x){case"brightness":(H<.1||H>3)&&(i=!1);break;case"blur":H>3&&(i=!1);break;case"opacity":H<.1&&(i=!1)}}),i):!1}),$(this,"checkPropertyUpToAllParentNodes",(r,i)=>{let s=!0,l=!0;const p=b=>i(b);let _=r;for(;_&&l;)p(_)||(s=!1,l=!1),_=_.parentElement,_||(l=!1);return s}),$(this,"checkActualCssVisibleIncludeInherit",r=>this.checkPropertyUpToAllParentNodes(r,this.checkCssVisibleProperty)),$(this,"getSizeAboutClient",r=>{const{width:i,height:s,left:l,right:p,top:_,bottom:b}=r.getBoundingClientRect(),P=this.getClientWidth(),x=this.getClientHeight();return{width:i,height:s,left:l,right:p,top:_,bottom:b,clientWidth:P,clientHeight:x,clientMin:Math.min(P,x)}}),$(this,"checkActualSize",()=>{const{width:r,height:i,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(r,i,s)}),$(this,"elementFromPoint",(r,i)=>document.elementFromPoint?document.elementFromPoint(r,i):null),$(this,"checkCoverForAPoint",(r,i,s)=>{const l=this.elementFromPoint(r,i);return l!==null&&l!==s}),$(this,"getPointPositionList",()=>{const{width:r,height:i,left:s,top:l}=this._clientSize,p=r/6,_=i/6,b=[],P=10**6;for(let x=0;x<5;x++)for(let H=0;H<5;H++){const B=(s*P+(x===0?.1:x===4?(p*x*P-1e5)/P:p*x)*P)/P,z=(l*P+(H===0?.1:H===4?(_*H*P-1e5)/P:_*H)*P)/P;b.push({x:B,y:z})}return[...b]}),$(this,"checkElementCover",r=>this.getPointPositionList().map(i=>this.checkCoverForAPoint(i.x,i.y,r)).filter(i=>!!i).length>6),$(this,"checkSizeIsVisible",(r,i,s)=>(r>50||s/r<=10)&&(i>50||s/i<=10)),$(this,"checkSizeOfPartInClient",()=>{const{left:r,right:i,top:s,bottom:l,clientHeight:p,clientWidth:_,clientMin:b}=this._clientSize;let P,x,H,B;if(r<0)P=0;else{if(!(r<_))return!1;P=r}if(i<0)return!1;if(x=i<_?i:_,s<0)H=0;else{if(!(s<p))return!1;H=s}if(l<0)return!1;B=l<p?l:p;const z=x-P,Wt=B-H;return this.checkSizeIsVisible(z,Wt,b)}),$(this,"returnHiddenResult",r=>(this._clientSize=null,{visible:!1,reason:r})),$(this,"checkOneElementVisible",r=>{if(r instanceof HTMLElement){if(this.checkElementIsMountedOnDom(r)){if(this.checkActualCssVisibleIncludeInherit(r)){if(this._clientSize=this.getSizeAboutClient(r),this.checkElementCover(r))return this.returnHiddenResult(PI.COVERED);{const i=this.checkActualSize(),s=this.checkSizeOfPartInClient();return i&&!s?this.returnHiddenResult(PI.POSITION):i?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(PI.SIZE)}}return this.returnHiddenResult(PI.STYLE)}return this.returnHiddenResult(WO.UNMOUNTED)}return this.returnHiddenResult(WO.INVALID_HTML_ELEMENT)}),$(this,"checkElementIsMountedOnDom",r=>this.checkPropertyUpToAllParentNodes(r,i=>i.nodeName.toUpperCase()!=="HTML"?i.parentElement!==null:!!document.documentElement))}};function nG(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function h0(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?nG(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):nG(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}let q_=(R3=PE({argsMap:(r,i,s)=>[r.getTrackId(),typeof i=="string"?i:i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),I3=w_(),O3=PE({argsMap:r=>[r.getTrackId()]}),A3=RI("LocalVideoTrack","_enabledMutex"),C3=PE({argsMap:(r,i)=>[r.getTrackId(),i]}),w3=w_(),N3=RI("LocalVideoTrack","_enabledMutex"),D3=PE({argsMap:(r,i)=>[r.getTrackId(),i]}),P3=w_(),k3=PE({argsMap:(r,i)=>[r.getTrackId(),i]}),L3=w_(),M3=w_(),U3=PE({argsMap:(r,i,s)=>[r.getTrackId(),i,s]}),x3=w_(),j3=w_(),V3=w_(),F3=w_(),B3=w_(),G3=w_(),q3=w_(),W3=PE({argsMap:(r,i)=>[r.getTrackId(),i.name]}),K3=PE({argsMap:r=>[r.getTrackId()]}),H3=PE({argsMap:r=>[r.getTrackId()]}),Y3=PE({argsMap:(r,i,s)=>[r.getTrackId(),i.label,s]}),iE((KE=class W6 extends YP{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==eT.PLAYING)}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}get __className__(){return"LocalVideoTrack"}constructor(i,s,l,p,_,b){if(super(i,_),$(this,"trackMediaType","video"),$(this,"_player",void 0),$(this,"_videoVisibleTimer",null),$(this,"_previousVideoVisibleStatus",void 0),$(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),$(this,"_encoderConfig",void 0),$(this,"_scalabiltyMode",{numSpatialLayers:1,numTemporalLayers:1}),$(this,"_optimizationMode",void 0),$(this,"_videoHeight",void 0),$(this,"_videoWidth",void 0),$(this,"_forceBitrateLimit",void 0),$(this,"_enabled",!0),$(this,"processorDestination",void 0),$(this,"_processorContext",void 0),pT()){const{width:P,height:x}=i.getSettings();this._videoWidth=P,this._videoHeight=x}else this.updateMediaStreamTrackResolution();this._encoderConfig=s,this._scalabiltyMode=l,this._optimizationMode=p,this._hints=b||[],this._hints.indexOf(X_.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile(),s&&this._hints.indexOf(X_.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this.processorContext=new GV(this.getTrackId(),"local"),this.processorDestination=new BV(this.processorContext),this.bindProcessorDestinationEvents()}play(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof i=="string"){const p=document.getElementById(i);p?i=p:(_e.warning("[".concat(this.getTrackId(),'] can not find "#').concat(i,'" element, use document.body')),i=document.body)}_e.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const l=h0(h0(h0({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:i});this._player?this._player.updateConfig(l):(i instanceof HTMLVideoElement?this._player=new lL(l):this._player=new T3(l),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const p=this.getVideoElementVisibleStatus();this.safeEmit(lR.VIDEO_ELEMENT_VISIBLE_STATUS,p)}catch{}},kc("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,_e.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(i,s){if(!s){if(i===this._enabled)return;this.stateCheck("enabled",i)}if(_e.info("[".concat(this.getTrackId(),"] start setEnabled"),i),!i){this._originMediaStreamTrack.enabled=!1;try{await N_(this,ME.NEED_DISABLE_TRACK,this)}catch(l){throw _e.error("[".concat(this.getTrackId(),"] setEnabled to false error"),l.toString()),l}return s||(this._enabled=!1),void _e.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await N_(this,ME.NEED_ENABLE_TRACK,this)}catch(l){throw _e.error("[".concat(this.getTrackId(),"] setEnabled to true error"),l.toString()),l}_e.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(i){i!==this._muted&&(this.stateCheck("muted",i),this._muted=i,this._originMediaStreamTrack.enabled=!i,_e.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(i)),i?await N_(this,ME.NEED_MUTE_TRACK,this):await N_(this,ME.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(i,s){if(!this._enabled)throw new _a(_i.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(i=UR(i),this._forceBitrateLimit&&(i.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:i.bitrateMin),i.width||i.height||i.frameRate){const l=qO({encoderConfig:i});(pT()||fT()||PS())&&(l.deviceId=void 0),_e.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(i),JSON.stringify(l));try{await this._originMediaStreamTrack.applyConstraints(l),this.updateMediaStreamTrackResolution()}catch(p){const _=new _a(_i.UNEXPECTED_ERROR,p.toString());throw _e.error("[".concat(this.getTrackId(),"] applyConstraints error"),_.toString()),_}}this._encoderConfig=i,this._hints.indexOf(X_.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await N_(this,ME.NEED_UPDATE_VIDEO_ENCODER,this)}catch(l){return l.throw()}}getStats(){return c0(()=>{_e.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),hS(this,ME.GET_STATS)||h0({},LP)}async setBeautyEffect(i){_e.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(i,s):await dL(i)}clone(i,s,l,p){const _=this._mediaStreamTrack.clone();return new W6(_,i,s,l,p)}async setBitrateLimit(i){if(_e.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(i))),i){this._forceBitrateLimit=i,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<i.max_bitrate?this._encoderConfig.bitrateMax:i.max_bitrate:this._encoderConfig.bitrateMax=i.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=i.min_bitrate);try{await N_(this,ME.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw()}}}async setOptimizationMode(i){if(i!=="motion"&&i!=="detail"&&i!=="balanced")return void _e.error(_i.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=i,await N_(this,ME.SET_OPTIMIZATION_MODE,this)}catch(l){throw this._optimizationMode=s,_e.error("[".concat(this.getTrackId(),"] set optimization mode failed"),l.toString()),l}_e.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(i,")"))}setScalabiltyMode(i){if(i.numSpatialLayers===1&&i.numTemporalLayers!==1)return _e.error(_i.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=i,_e.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(i,")"))}updateMediaStreamTrackResolution(){jF(this._originMediaStreamTrack).then(i=>{let[s,l]=i;this._videoHeight=l,this._videoWidth=s}).catch(jO)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:i,height:s,frameRate:l}=this.getMediaStreamTrackSettings();if(!i||!s||!l)return;const[p,_]=function(b,P,x){const H=kc("BITRATE_ADAPTER_TYPE");let B;const z=200*Math.pow(x/15,.6)*Math.pow(b*P/640/360,.75),Wt=z;if(H==="STANDARD_BITRATE")B=4*z;else{if(H!=="COMPATIABLE_BITRATE")return;B=2*z}return[Math.floor(B),Math.floor(Wt)]}(i,s,l)||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=_,this._encoderConfig.bitrateMax=p,_e.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(i,", h: ").concat(s,", fps: ").concat(l,"] => [brMax: ").concat(p,", brMin: ").concat(_,"]")))}getVideoElementVisibleStatus(){try{var i,s;const l=this==null||(i=this._player)===null||i===void 0?void 0:i.getContainerElement(),p={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:l==null?void 0:l.parentElement},{element:_,slot:b}=p;if(this.isPlaying&&_ instanceof HTMLVideoElement&&b instanceof HTMLElement){const P=eG.checkOneElementVisible(_),x=Object.assign({},P);if(x.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=x.visible;const H=AE.reportApiInvoke(null,{tag:S_.TRACER,name:V_.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});x.visible?H.onSuccess("Video is visible"):H.onSuccess("Invisible because of ".concat(x.reason))}return x}return}catch(l){throw new _a(_i.GET_VIDEO_ELEMENT_VISIBLE_ERROR,l.message)}}async renewMediaStreamTrack(i){}pipe(i){if(this.processor===i)return i;if(i._source)throw new _a(_i.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),i}unpipe(){if(!this.processor)return;const i=this.processor;this.processor._source=void 0,this.processor=void 0,i.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}async replaceTrack(i,s){if(!(i instanceof MediaStreamTrack))throw new _a(_i.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(i.kind!=="video")throw new _a(_i.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(i,s,!0),this.updateMediaStreamTrackResolution()}bindProcessorDestinationEvents(){this.processorDestination.on(iT.ON_TRACK,async i=>{i?i!==this._mediaStreamTrack&&(this._mediaStreamTrack=i,this._updatePlayerSource(),await N_(this,ME.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await N_(this,ME.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(iT.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(OT.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(OT.REQUEST_CONSTRAINTS)}}).prototype,"play",[R3,I3],Object.getOwnPropertyDescriptor(KE.prototype,"play"),KE.prototype),iE(KE.prototype,"stop",[O3],Object.getOwnPropertyDescriptor(KE.prototype,"stop"),KE.prototype),iE(KE.prototype,"setEnabled",[A3,C3,w3],Object.getOwnPropertyDescriptor(KE.prototype,"setEnabled"),KE.prototype),iE(KE.prototype,"setMuted",[N3,D3,P3],Object.getOwnPropertyDescriptor(KE.prototype,"setMuted"),KE.prototype),iE(KE.prototype,"setEncoderConfiguration",[k3,L3],Object.getOwnPropertyDescriptor(KE.prototype,"setEncoderConfiguration"),KE.prototype),iE(KE.prototype,"getStats",[M3],Object.getOwnPropertyDescriptor(KE.prototype,"getStats"),KE.prototype),iE(KE.prototype,"setBeautyEffect",[U3,x3],Object.getOwnPropertyDescriptor(KE.prototype,"setBeautyEffect"),KE.prototype),iE(KE.prototype,"getCurrentFrameData",[j3],Object.getOwnPropertyDescriptor(KE.prototype,"getCurrentFrameData"),KE.prototype),iE(KE.prototype,"getCurrentFrameImage",[V3],Object.getOwnPropertyDescriptor(KE.prototype,"getCurrentFrameImage"),KE.prototype),iE(KE.prototype,"setBitrateLimit",[F3],Object.getOwnPropertyDescriptor(KE.prototype,"setBitrateLimit"),KE.prototype),iE(KE.prototype,"setOptimizationMode",[B3],Object.getOwnPropertyDescriptor(KE.prototype,"setOptimizationMode"),KE.prototype),iE(KE.prototype,"setScalabiltyMode",[G3],Object.getOwnPropertyDescriptor(KE.prototype,"setScalabiltyMode"),KE.prototype),iE(KE.prototype,"updateMediaStreamTrackResolution",[q3],Object.getOwnPropertyDescriptor(KE.prototype,"updateMediaStreamTrackResolution"),KE.prototype),iE(KE.prototype,"pipe",[W3],Object.getOwnPropertyDescriptor(KE.prototype,"pipe"),KE.prototype),iE(KE.prototype,"unpipe",[K3],Object.getOwnPropertyDescriptor(KE.prototype,"unpipe"),KE.prototype),iE(KE.prototype,"close",[H3],Object.getOwnPropertyDescriptor(KE.prototype,"close"),KE.prototype),iE(KE.prototype,"replaceTrack",[Y3],Object.getOwnPropertyDescriptor(KE.prototype,"replaceTrack"),KE.prototype),KE),rG=(z3=PE({argsMap:(r,i)=>[r.getTrackId(),i]}),J3=w_(),X3=RI("CameraVideoTrack","_enabledMutex"),Q3=PE({argsMap:(r,i)=>[r.getTrackId(),i]}),$3=w_(),Z3=PE({argsMap:(r,i)=>[r.getTrackId(),i]}),_B=w_(),tG=PE({argsMap:r=>[r.getTrackId()]}),iE((eS=class extends q_{get __className__(){return"CameraVideoTrack"}constructor(r,i,s,l,p,_){super(r,UR(i.encoderConfig),l,p,_),$(this,"_config",void 0),$(this,"_originalConstraints",void 0),$(this,"_constraints",void 0),$(this,"_enabled",!0),$(this,"_deviceName","default"),$(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(lI()||tP())&&!function(){const b=i_();if(b.os!==Mb.IOS||!b.osVersion)return!1;const P=b.osVersion.split(".");return Number(P[0])===15&&Number(P[1])>=2}()&&o2()&&this._enabled&&!this._isClosed&&(_e.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=s,this._constraints=s,this._deviceName=r.label,this._encoderConfig=UR(this._config.encoderConfig),s_.on(_m.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),s_.on(_m.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){if(_e.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const i=await KT.getDeviceById(r),s={};s.video=h0({},this._constraints),s.video.deviceId={exact:r},s.video.facingMode=void 0,this._originMediaStreamTrack.stop();let l=null;try{l=await lS(s,this.getTrackId())}catch(p){throw _e.error("[".concat(this.getTrackId(),"] setDevice failed"),p.toString()),l=await lS({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),p}await this._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw _e.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await KT.getDeviceById(r);this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw _e.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}_e.info("[".concat(this.getTrackId(),"] setDevice success"))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(_e.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const s=await lS({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1)}await N_(this,ME.NEED_ENABLE_TRACK,this)}catch(s){throw _e.error("[".concat(this.getTrackId(),"] setEnabled true error"),s.toString()),s}this.updateMediaStreamTrackResolution(),_e.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await N_(this,ME.NEED_DISABLE_TRACK,this)}catch(s){throw _e.error("[".concat(this.getTrackId(),"] setEnabled to false error"),s.toString()),s}_e.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,i){if(!this._enabled)throw new _a(_i.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=UR(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin);const s=G_(this._config);s.encoderConfig=r;const l=qO(s);(pT()||fT()||PS())&&(l.deviceId=void 0),_e.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(l));try{await this._originMediaStreamTrack.applyConstraints(l),this.updateMediaStreamTrackResolution()}catch(p){const _=new _a(_i.UNEXPECTED_ERROR,p.toString());throw _e.error("[".concat(this.getTrackId(),"] applyConstraints error"),_.toString()),_}this._config=s,this._constraints=l,this._originalConstraints=l,this._encoderConfig=r,this._hints.indexOf(X_.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await N_(this,ME.NEED_UPDATE_VIDEO_ENCODER,this)}catch(p){return p.throw()}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((fT()||PS())&&this._enabled&&!this._isClosed&&s_.duringInterruption){const r=async()=>{s_.off(_m.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(_e.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};s_.on(_m.IOS_INTERRUPTION_END,r)}else _e.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(lR.TRACK_ENDED)}async renewMediaStreamTrack(r){const i=r||this._constraints,s=KT.searchDeviceIdByName(this._deviceName);if(s&&!i.deviceId&&(i.deviceId={exact:s}),this._enabled){const l=await lS({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),s_.off(_m.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),s_.off(_m.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}bindProcessorContextEvents(){this.processorContext.on(OT.REQUEST_UPDATE_CONSTRAINTS,async(r,i,s)=>{try{const l=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(l),i()}catch(l){s(l)}}),this.processorContext.on(OT.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[z3,J3],Object.getOwnPropertyDescriptor(eS.prototype,"setDevice"),eS.prototype),iE(eS.prototype,"setEnabled",[X3,Q3,$3],Object.getOwnPropertyDescriptor(eS.prototype,"setEnabled"),eS.prototype),iE(eS.prototype,"setEncoderConfiguration",[Z3,_B],Object.getOwnPropertyDescriptor(eS.prototype,"setEncoderConfiguration"),eS.prototype),iE(eS.prototype,"close",[tG],Object.getOwnPropertyDescriptor(eS.prototype,"close"),eS.prototype),eS);class hL{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}constructor(i,s){$(this,"uid",void 0),$(this,"_uintid",void 0),$(this,"_trust_in_room_",!0),$(this,"_trust_audio_enabled_state_",!0),$(this,"_trust_video_enabled_state_",!0),$(this,"_trust_audio_mute_state_",!0),$(this,"_trust_video_mute_state_",!0),$(this,"_audio_muted_",!1),$(this,"_video_muted_",!1),$(this,"_audio_enabled_",!0),$(this,"_video_enabled_",!0),$(this,"_audio_added_",!1),$(this,"_video_added_",!1),$(this,"_trust_video_stream_added_state_",!0),$(this,"_trust_audio_stream_added_state_",!0),$(this,"_audioTrack",void 0),$(this,"_videoTrack",void 0),$(this,"_audioSSRC",void 0),$(this,"_videoSSRC",void 0),$(this,"_audioOrtc",void 0),$(this,"_videoOrtc",void 0),$(this,"_cname",void 0),$(this,"_rtxSsrcId",void 0),this.uid=i,this._uintid=s}}var GX=gU,qX=sI,WX=tO;vT({target:"Promise",stat:!0},{try:function(r){var i=qX.f(this),s=WX(r);return(s.error?i.reject:i.resolve)(s.value),i.promise}});var pL=GX,KX=vT,HX=_s,YX=f,zX=a0,JX=aS,XX=eR,QX=nR,iG=TP,$X=pV,ZX=vV,tQ=$R,oG=Lb("isConcatSpreadable"),sG=9007199254740991,aG="Maximum allowed index exceeded",cG=HX.TypeError,eQ=tQ>=51||!YX(function(){var r=[];return r[oG]=!1,r.concat()[0]!==r}),nQ=ZX("concat"),rQ=function(r){if(!JX(r))return!1;var i=r[oG];return i!==void 0?!!i:zX(r)};KX({target:"Array",proto:!0,forced:!eQ||!nQ},{concat:function(r){var i,s,l,p,_,b=XX(this),P=$X(b,0),x=0;for(i=-1,l=arguments.length;i<l;i++)if(rQ(_=i===-1?b:arguments[i])){if(x+(p=QX(_))>sG)throw cG(aG);for(s=0;s<p;s++,x++)s in _&&iG(P,x,_[s])}else{if(x>=sG)throw cG(aG);iG(P,x++,_)}return P.length=x,P}});var uG={},iQ=NE,oQ=ZS,dG=U0.f,sQ=B2,lG=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];uG.f=function(r){return lG&&iQ(r)=="Window"?function(i){try{return dG(i)}catch{return sQ(lG)}}(r):dG(oQ(r))};var p0={},aQ=Lb;p0.f=aQ;var hG=tR,cQ=DT,uQ=p0,dQ=gS.f,_v=function(r){var i=hG.Symbol||(hG.Symbol={});cQ(i,r)||dQ(i,r,{value:uQ.f(r)})},kI=vT,fL=_s,lQ=wS,hQ=nE,f0=t_,pQ=_n,LI=mE,YR=lN,EL=f,cT=DT,fQ=a0,EQ=sE,_Q=aS,mQ=ue,_L=hN,mL=vS,gQ=eR,KO=ZS,gL=N0,pG=nI,vL=aE,E0=F0,fG=kN,vQ=U0,EG=uG,yL=DN,_G=vE,mG=gS,yQ=PN,gG=vf,bQ=QN,bL=X0,_0=w0.exports,vG=x0,yG=gN,bG=Lb,TQ=p0,SQ=_v,RQ=YI,TG=J0,HO=EV.forEach,HT=M0("hidden"),YO="Symbol",SG=bG("toPrimitive"),IQ=TG.set,RG=TG.getterFor(YO),OS=Object.prototype,ER=fL.Symbol,zR=ER&&ER.prototype,IG=fL.TypeError,TL=fL.QObject,m0=lQ("JSON","stringify"),OG=_G.f,_R=mG.f,AG=EG.f,OQ=gG.f,CG=pQ([].push),QS=_0("symbols"),g0=_0("op-symbols"),SL=_0("string-to-symbol-registry"),RL=_0("symbol-to-string-registry"),AQ=_0("wks"),IL=!TL||!TL.prototype||!TL.prototype.findChild,OL=LI&&EL(function(){return E0(_R({},"a",{get:function(){return _R(this,"a",{value:7}).a}})).a!=7})?function(r,i,s){var l=OG(OS,i);l&&delete OS[i],_R(r,i,s),l&&r!==OS&&_R(OS,i,l)}:_R,AL=function(r,i){var s=QS[r]=E0(zR);return IQ(s,{type:YO,tag:r,description:i}),LI||(s.description=i),s},zO=function(r,i,s){r===OS&&zO(g0,i,s),mL(r);var l=gL(i);return mL(s),cT(QS,l)?(s.enumerable?(cT(r,HT)&&r[HT][l]&&(r[HT][l]=!1),s=E0(s,{enumerable:vL(0,!1)})):(cT(r,HT)||_R(r,HT,vL(1,{})),r[HT][l]=!0),OL(r,l,s)):_R(r,l,s)},CL=function(r,i){mL(r);var s=KO(i),l=fG(s).concat(wL(s));return HO(l,function(p){LI&&!f0(wG,s,p)||zO(r,p,s[p])}),r},wG=function(r){var i=gL(r),s=f0(OQ,this,i);return!(this===OS&&cT(QS,i)&&!cT(g0,i))&&(!(s||!cT(this,i)||!cT(QS,i)||cT(this,HT)&&this[HT][i])||s)},NG=function(r,i){var s=KO(r),l=gL(i);if(s!==OS||!cT(QS,l)||cT(g0,l)){var p=OG(s,l);return!p||!cT(QS,l)||cT(s,HT)&&s[HT][l]||(p.enumerable=!0),p}},DG=function(r){var i=AG(KO(r)),s=[];return HO(i,function(l){cT(QS,l)||cT(vG,l)||CG(s,l)}),s},wL=function(r){var i=r===OS,s=AG(i?g0:KO(r)),l=[];return HO(s,function(p){!cT(QS,p)||i&&!cT(OS,p)||CG(l,QS[p])}),l};if(YR||(bL(zR=(ER=function(){if(mQ(zR,this))throw IG("Symbol is not a constructor");var r=arguments.length&&arguments[0]!==void 0?pG(arguments[0]):void 0,i=yG(r),s=function(l){this===OS&&f0(s,g0,l),cT(this,HT)&&cT(this[HT],i)&&(this[HT][i]=!1),OL(this,i,vL(1,l))};return LI&&IL&&OL(OS,i,{configurable:!0,set:s}),AL(i,r)}).prototype,"toString",function(){return RG(this).tag}),bL(ER,"withoutSetter",function(r){return AL(yG(r),r)}),gG.f=wG,mG.f=zO,yQ.f=CL,_G.f=NG,vQ.f=EG.f=DG,yL.f=wL,TQ.f=function(r){return AL(bG(r),r)},LI&&_R(zR,"description",{configurable:!0,get:function(){return RG(this).description}})),kI({global:!0,wrap:!0,forced:!YR,sham:!YR},{Symbol:ER}),HO(fG(AQ),function(r){SQ(r)}),kI({target:YO,stat:!0,forced:!YR},{for:function(r){var i=pG(r);if(cT(SL,i))return SL[i];var s=ER(i);return SL[i]=s,RL[s]=i,s},keyFor:function(r){if(!_L(r))throw IG(r+" is not a symbol");if(cT(RL,r))return RL[r]},useSetter:function(){IL=!0},useSimple:function(){IL=!1}}),kI({target:"Object",stat:!0,forced:!YR,sham:!LI},{create:function(r,i){return i===void 0?E0(r):CL(E0(r),i)},defineProperty:zO,defineProperties:CL,getOwnPropertyDescriptor:NG}),kI({target:"Object",stat:!0,forced:!YR},{getOwnPropertyNames:DG,getOwnPropertySymbols:wL}),kI({target:"Object",stat:!0,forced:EL(function(){yL.f(1)})},{getOwnPropertySymbols:function(r){return yL.f(gQ(r))}}),m0&&kI({target:"JSON",stat:!0,forced:!YR||EL(function(){var r=ER();return m0([r])!="[null]"||m0({a:r})!="{}"||m0(Object(r))!="{}"})},{stringify:function(r,i,s){var l=bQ(arguments),p=i;if((_Q(i)||r!==void 0)&&!_L(r))return fQ(i)||(i=function(_,b){if(EQ(p)&&(b=f0(p,this,_,b)),!_L(b))return b}),l[1]=i,hQ(m0,null,l)}}),!zR[SG]){var CQ=zR.valueOf;bL(zR,SG,function(r){return f0(CQ,this)})}RQ(ER,YO),vG[HT]=!0,_v("asyncIterator"),_v("hasInstance"),_v("isConcatSpreadable"),_v("iterator"),_v("match"),_v("matchAll"),_v("replace"),_v("search"),_v("species"),_v("split"),_v("toPrimitive"),_v("toStringTag"),_v("unscopables"),YI(_s.JSON,"JSON",!0);var wQ=tR.Symbol;_v("asyncDispose"),_v("dispose"),_v("matcher"),_v("metadata"),_v("observable"),_v("patternMatch"),_v("replaceAll");var PG=wQ,kG=p0.f("asyncIterator"),NQ=kG;function LG(r){this.wrapped=r}function v0(r){var i,s;function l(_,b){try{var P=r[_](b),x=P.value,H=x instanceof LG;pL.resolve(H?x.wrapped:x).then(function(B){H?l(_==="return"?"return":"next",B):p(P.done?"return":"normal",B)},function(B){l("throw",B)})}catch(B){p("throw",B)}}function p(_,b){switch(_){case"return":i.resolve({value:b,done:!0});break;case"throw":i.reject(b);break;default:i.resolve({value:b,done:!1})}(i=i.next)?l(i.key,i.arg):s=null}this._invoke=function(_,b){return new pL(function(P,x){var H={key:_,arg:b,resolve:P,reject:x,next:null};s?s=s.next=H:(i=s=H,l(_,b))})},typeof r.return!="function"&&(this.return=void 0)}function pS(r){return function(){return new v0(r.apply(this,arguments))}}function HE(r){return new LG(r)}v0.prototype[typeof PG=="function"&&NQ||"@@asyncIterator"]=function(){return this},v0.prototype.next=function(r){return this._invoke("next",r)},v0.prototype.throw=function(r){return this._invoke("throw",r)},v0.prototype.return=function(r){return this._invoke("return",r)};var DQ=p0.f("iterator");function JO(r,i){var s={},l=!1;function p(_,b){return l=!0,b=new pL(function(P){P(r[_](b))}),{done:!1,value:i(b)}}return s[PG!==void 0&&DQ||"@@iterator"]=function(){return this},s.next=function(_){return l?(l=!1,_):p("next",_)},typeof r.throw=="function"&&(s.throw=function(_){if(l)throw l=!1,_;return p("throw",_)}),typeof r.return=="function"&&(s.return=function(_){return l?(l=!1,_):p("return",_)}),s}var MG=kG,W_={exports:{}};function UG(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function xG(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?UG(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):UG(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}function NL(r,i,s,l,p,_,b){let P=[],x=[],H=[],B=[],z=!1,Wt=!1;if(W_.exports.parse(r).mediaDescriptions.forEach(_r=>{b&&b!==_r.attributes.direction||(_r.media.mediaType!=="video"||z||(x=_r.attributes.payloads,B=_r.attributes.extmaps,z=!0),_r.media.mediaType!=="audio"||Wt||(P=_r.attributes.payloads,H=_r.attributes.extmaps,Wt=!0))}),!B||x.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!H||P.length===0)throw new Error("Cannot get audio capabilities from SDP.");return x.forEach(_r=>{var Di;(Di=_r.rtpMap)!==null&&Di!==void 0&&Di.clockRate&&(_r.rtpMap.clockRate=parseInt(_r.rtpMap.clockRate))}),P.forEach(_r=>{var Di;(Di=_r.rtpMap)!==null&&Di!==void 0&&Di.clockRate&&(_r.rtpMap.clockRate=parseInt(_r.rtpMap.clockRate))}),i&&(P=P.filter(_r=>{var Di;return((Di=_r.rtpMap)===null||Di===void 0?void 0:Di.encodingName.toLowerCase())!=="rtx"}),x=x.filter(_r=>{var Di;return((Di=_r.rtpMap)===null||Di===void 0?void 0:Di.encodingName.toLowerCase())!=="rtx"})),s&&(x=x.filter(_r=>{var Di;return!/(red)|(ulpfec)|(flexfec)/i.test(((Di=_r.rtpMap)===null||Di===void 0?void 0:Di.encodingName)||"")})),l&&(P=P.filter(_r=>{var Di;return!/(red)|(ulpfec)|(flexfec)/i.test(((Di=_r.rtpMap)===null||Di===void 0?void 0:Di.encodingName)||"")})),p&&(p==null?void 0:p.length)>0&&(P=P.filter(_r=>{var Di;return p.includes(((Di=_r.rtpMap)===null||Di===void 0?void 0:Di.encodingName.toLowerCase())||"")})),_&&(_==null?void 0:_.length)>0&&(x=x.filter(_r=>{var Di;return _.includes(((Di=_r.rtpMap)===null||Di===void 0?void 0:Di.encodingName.toLowerCase())||"")})),{audioCodecs:P,videoCodecs:x,audioExtensions:H,videoExtensions:B}}function JR(r){const i=W_.exports.parse(r);let s,l;for(const p of i.mediaDescriptions){if(!s){const _=p.attributes.iceUfrag,b=p.attributes.icePwd;if(!_||!b)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:_,icePwd:b}}if(!l){const _=p.attributes.fingerprints;_.length>0&&(l={fingerprints:_})}}if(!l&&i.attributes.fingerprints.length>0&&(l={fingerprints:i.attributes.fingerprints}),!l||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:l}}function jG(r,i){const s=[],l=r.attributes.ssrcGroups.filter(b=>b.semantic==="FID"),p=r.attributes.ssrcGroups.find(b=>b.semantic==="SIM"),_=r.attributes.ssrcs;if(p)p.ssrcIds.forEach(b=>{var P;const x=(P=l.find(H=>H.ssrcIds[0]===b))===null||P===void 0?void 0:P.ssrcIds[1];s.push({ssrcId:b,rtx:i?x:void 0})});else if(l.length>0){const b=l[0].ssrcIds[0],P=l[0].ssrcIds[1];s.push({ssrcId:b,rtx:i?P:void 0})}else{if(_.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:_[0].ssrcId})}return s}function VG(r,i){const{cname:s}=r;let l;i&&i.ip&&typeof i.port=="number"?(l=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:i.ip,port:i.port.toString(),type:"host",extension:{}}],_e.debug("Using remote candidate from AP ".concat(i.ip,":").concat(i.port)),i.ip6&&(l.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:i.ip6,port:i.port.toString(),type:"host",extension:{}}),_e.debug("Using IPV6 remote candidate from AP ".concat(i.ip6,":").concat(i.port)))):l=r.iceParameters.candidates.map(P=>({foundation:P.foundation,componentId:"1",transport:P.protocol,priority:P.priority.toString(),connectionAddress:P.ip,port:P.port.toString(),type:P.type,extension:{}}));const p={fingerprints:r.dtlsParameters.fingerprints.map(P=>({hashFunction:P.algorithm,fingerprint:P.fingerprint}))},_={iceUfrag:r.iceParameters.iceUfrag,icePwd:r.iceParameters.icePwd};let b;switch(r.dtlsParameters.role){case"server":b="passive";break;case"client":b="active";break;case"auto":b="actpass"}return{dtlsParameters:p,iceParameters:_,candidates:l,rtpCapabilities:kL(r.rtpCapabilities),setup:b,cname:s}}function nS(r,i,s){const l=[],p=[];return r.forEach(_=>{let{ssrcId:b,rtx:P}=_;const x=b_(8,"track-"),H={ssrcId:b,attributes:xG({label:x,mslabel:s=s||b_(10,""),msid:"".concat(s," ").concat(x)},i&&{cname:i})};if(l.push(H),P!==void 0){const B={ssrcId:P,attributes:xG({label:x,mslabel:s,msid:"".concat(s," ").concat(x)},i&&{cname:i})};l.push(B),p.push({semantic:"FID",ssrcIds:[b,P]})}}),r.length>1&&p.push({semantic:"SIM",ssrcIds:r.map(_=>{let{ssrcId:b}=_;return b})}),{ssrcs:l,ssrcGroups:p}}function MI(r,i){i instanceof oT&&r.attributes.payloads.forEach(s=>{var l;const p=(l=s.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase();if(!p||["opus","pcmu","pcma","g722"].indexOf(p)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const _=i._encoderConfig;_&&p!=="pcmu"&&p!=="pcma"&&p!=="g722"&&(_.bitrate&&!A_()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*_.bitrate))),_.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(_.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(_.sampleRate)),_.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1"))})}function DL(r){const i=r.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");i!==-1&&r.attributes.unrecognized.splice(i,1)}function PL(r,i){if(!(i instanceof q_&&i._encoderConfig&&i._hints.indexOf(X_.SCREEN_TRACK)===-1))return;const s=i._encoderConfig;M_().supportMinBitrate&&s.bitrateMin&&r.attributes.payloads.forEach(l=>{var p;["h264","h265","vp8","vp9","av1"].includes(((p=l.rtpMap)===null||p===void 0?void 0:p.encodingName.toLowerCase())||"")&&(l.fmtp||(l.fmtp={parameters:{}}),l.fmtp.parameters["x-google-min-bitrate"]="".concat(s.bitrateMin))}),M_().supportMinBitrate&&!i._hints.includes(X_.LOW_STREAM)&&s.bitrateMax&&r.attributes.payloads.forEach(l=>{var p;["h264","h265","vp8","vp9","av1"].includes(((p=l.rtpMap)===null||p===void 0?void 0:p.encodingName.toLowerCase())||"")&&(l.fmtp||(l.fmtp={parameters:{}}),l.fmtp.parameters["x-google-start-bitrate"]="".concat(kc("X_GOOGLE_START_BITRATE")||Math.floor(s.bitrateMax)))})}function FG(r){if(r.media.mediaType!=="video")return;const i=i_();if(i.name!==u_.SAFARI&&i.os!==Mb.IOS)return;const s=r.attributes.extmaps.findIndex(l=>/video-orientation/g.test(l.extensionName));s!==-1&&r.attributes.extmaps.splice(s,1)}function XO(r,i,s){if(!i)return;let l,p;if(r.media.mediaType==="video"?(l=s.videoExtensions,p=s.videoCodecs):(l=s.audioExtensions,p=s.audioCodecs),i.twcc===!0){const _=l.find(b=>b.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");_&&(r.attributes.extmaps.find(b=>b.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||r.attributes.extmaps.push({entry:_.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(b,P){return P.filter(x=>!!b.find(H=>H.payloadType===x.payloadType&&!!H.rtcpFeedbacks.find(B=>B.type==="transport-cc")))}(p,r.attributes.payloads).forEach(b=>{b.rtcpFeedbacks.find(P=>P.type==="transport-cc")||b.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(i.twcc===!1){const _=r.attributes.extmaps.findIndex(b=>b.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");_!==-1&&r.attributes.extmaps.splice(_,1),r.attributes.payloads.forEach(b=>{const P=b.rtcpFeedbacks.findIndex(x=>x.type==="transport-cc");P!==-1&&b.rtcpFeedbacks.splice(P,1)})}if(i.remb===!0){const _=l.find(b=>b.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");_&&(r.attributes.extmaps.find(b=>b.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||r.attributes.extmaps.push({entry:_.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(b,P){return P.filter(x=>!!b.find(H=>H.payloadType===x.payloadType&&!!H.rtcpFeedbacks.find(B=>B.type==="goog-remb")))}(p,r.attributes.payloads).forEach(b=>{b.rtcpFeedbacks.find(P=>P.type==="goog-remb")||b.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(i.remb===!1){const _=r.attributes.extmaps.findIndex(b=>b.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");_!==-1&&r.attributes.extmaps.splice(_,1),r.attributes.payloads.forEach(b=>{const P=b.rtcpFeedbacks.findIndex(x=>x.type==="goog-remb");P!==-1&&b.rtcpFeedbacks.splice(P,1)})}}function BG(r,i,s){if(A_()||r.media.mediaType!=="video"||!(i instanceof q_)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!kc("SIMULCAST")||i._scalabiltyMode===void 0||i._scalabiltyMode.numSpatialLayers<=1)return;const l=s==="vp8"?2:i._scalabiltyMode.numSpatialLayers,p=r.attributes.ssrcs[0],_=r.attributes.ssrcGroups.find(P=>P.semantic==="FID"&&P.ssrcIds[0]===p.ssrcId),b={semantic:"SIM",ssrcIds:[p.ssrcId]};for(let P=1;P<l;P++)r.attributes.ssrcs.push({ssrcId:p.ssrcId+P,attributes:G_(p.attributes)}),b.ssrcIds.push(p.ssrcId+P),_&&(r.attributes.ssrcs.push({ssrcId:_.ssrcIds[1]+P,attributes:G_(p.attributes)}),r.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[p.ssrcId+P,_.ssrcIds[1]+P]}));r.attributes.ssrcGroups.unshift(b)}async function GG(r,i,s,l,p){const _=new RTCPeerConnection;_.addTransceiver("video",{direction:"sendonly"}),_.addTransceiver("audio",{direction:"sendonly"}),_.addTransceiver("video",{direction:"recvonly"}),_.addTransceiver("audio",{direction:"recvonly"});const b=(await _.createOffer()).sdp,P=NL(b,r,i,s,l,p,"sendonly"),x=NL(b,r,i,s,l,p,"recvonly"),H={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},B={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},z={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(QO(P,x,"videoExtensions",H,B,z),QO(P,x,"videoCodecs",H,B,z),QO(P,x,"audioExtensions",H,B,z),QO(P,x,"audioCodecs",H,B,z),kc("RAISE_H264_BASELINE_PRIORITY")){const Wt=z.videoCodecs.findIndex(_r=>{var Di,Fi;return((Di=_r.rtpMap)===null||Di===void 0?void 0:Di.encodingName.toLocaleLowerCase())==="h264"&&((Fi=_r.fmtp)===null||Fi===void 0?void 0:Fi.parameters["profile-level-id"])==="42001f"});if(Wt!==-1){const _r=z.videoCodecs.findIndex(Di=>{var Fi;return((Fi=Di.rtpMap)===null||Fi===void 0?void 0:Fi.encodingName.toLocaleLowerCase())==="h264"});if(_r<Wt){_e.debug("raising H264 baseline profile priority");const Di=z.videoCodecs[Wt];z.videoCodecs.splice(Wt,1),z.videoCodecs.splice(_r,0,Di)}_r!==-1&&(B.videoCodecs=B.videoCodecs.filter(Di=>{var Fi,Gi;return!(((Fi=Di.rtpMap)===null||Fi===void 0?void 0:Fi.encodingName.toLocaleLowerCase())==="h264"&&((Gi=Di.fmtp)===null||Gi===void 0?void 0:Gi.parameters["profile-level-id"])!=="42001f")})),_r!==-1&&kc("FILTER_SEND_H264_BASELINE")&&(H.videoCodecs=H.videoCodecs.filter(Di=>{var Fi,Gi;return!(((Fi=Di.rtpMap)===null||Fi===void 0?void 0:Fi.encodingName.toLocaleLowerCase())==="h264"&&((Gi=Di.fmtp)===null||Gi===void 0?void 0:Gi.parameters["profile-level-id"])!=="42001f")}))}}try{_.close()}catch{}return{send:H,recv:B,sendrecv:z}}function QO(r,i,s,l,p,_){if(s==="videoExtensions"||s==="audioExtensions"){const b=[];return r[s].forEach(P=>{i[s].some((x,H)=>{if(P.entry===x.entry&&P.extensionName===x.extensionName)return b.push(H),!0})?_[s].push(P):l[s].push(P)}),void i[s].forEach((P,x)=>{b.indexOf(x)===-1&&p[s].push(P)})}if(s==="videoCodecs"||s==="audioCodecs"){const b=[];return r[s].forEach(P=>{i[s].some((x,H)=>{if(P.payloadType===x.payloadType&&JSON.stringify(P)===JSON.stringify(x))return b.push(H),!0})?_[s].push(P):l[s].push(P)}),void i[s].forEach((P,x)=>{b.indexOf(x)===-1&&p[s].push(P)})}}function kL(r){const{send:i,recv:s,sendrecv:l}=r;if(!l){if(!i||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:i,recv:s}}let p,_;return i?(p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p.audioCodecs=[...i.audioCodecs,...l.audioCodecs],p.videoCodecs=[...i.videoCodecs,...l.videoCodecs],p.audioExtensions=[...i.audioExtensions,...l.audioExtensions],p.videoExtensions=[...i.videoExtensions,...l.videoExtensions]):p=l,s?(_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_.audioCodecs=[...s.audioCodecs,...l.audioCodecs],_.videoCodecs=[...s.videoCodecs,...l.videoCodecs],_.audioExtensions=[...s.audioExtensions,...l.audioExtensions],_.videoExtensions=[...s.videoExtensions,...l.videoExtensions]):_=l,{send:p,recv:_}}function mR(r){r.media.mediaType==="audio"&&r.attributes.payloads.filter(i=>{var s;return((s=i.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(i=>{i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"})}function qG(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function WG(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?qG(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):qG(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}(function(r,i){r.exports=(()=>{var s={8:(_,b,P)=>{P.r(b),P.d(b,{Parser:()=>g_,Printer:()=>wT,parse:()=>UE,print:()=>$E});const x=`
`,H="".concat("\r").concat(x),B=" ";let z;function Wt(pE){return pE>="0"&&pE<="9"}function _r(pE){return pE>="!"&&pE<="~"}function Di(pE){return _r(pE)||pE>="Â"&&pE<="Ã¿"}function Fi(pE){return pE==="!"||pE>="#"&&pE<="'"||pE>="*"&&pE<="+"||pE>="-"&&pE<="."||pE>="0"&&pE<="9"||pE>="A"&&pE<="Z"||pE>="^"&&pE<="~"}function Gi(pE){return pE>="1"&&pE<="9"}function _p(pE){return pE>="A"&&pE<="Z"||pE>="a"&&pE<="z"}function _f(pE){return pE==="d"||pE==="h"||pE==="m"||pE==="s"}function cE(pE){return pE>""&&pE<"	"||pE>"\v"&&pE<"\f"||pE>""&&pE<"Ã¿"}function RE(pE){return _p(pE)||Wt(pE)||pE==="+"||pE==="/"}function dE(pE){return Wt(pE)||_p(pE)||pE==="+"||pE==="/"||pE==="-"||pE==="_"}function lE(pE){return _p(pE)||Wt(pE)||pE==="+"||pE==="/"}function oE(pE,Vt){var _o=Object.keys(pE);if(Object.getOwnPropertySymbols){var ga=Object.getOwnPropertySymbols(pE);Vt&&(ga=ga.filter(function(rE){return Object.getOwnPropertyDescriptor(pE,rE).enumerable})),_o.push.apply(_o,ga)}return _o}function EE(pE){for(var Vt=1;Vt<arguments.length;Vt++){var _o=arguments[Vt]!=null?arguments[Vt]:{};Vt%2?oE(Object(_o),!0).forEach(function(ga){r_(pE,ga,_o[ga])}):Object.getOwnPropertyDescriptors?Object.defineProperties(pE,Object.getOwnPropertyDescriptors(_o)):oE(Object(_o)).forEach(function(ga){Object.defineProperty(pE,ga,Object.getOwnPropertyDescriptor(_o,ga))})}return pE}function r_(pE,Vt,_o){return Vt in pE?Object.defineProperty(pE,Vt,{value:_o,enumerable:!0,configurable:!0,writable:!0}):pE[Vt]=_o,pE}(function(pE){pE.VERSION="v",pE.ORIGIN="o",pE.SESSION_NAME="s",pE.INFORMATION="i",pE.URI="u",pE.EMAIL="e",pE.PHONE="p",pE.CONNECTION="c",pE.BANDWIDTH="b",pE.TIME="t",pE.REPEAT="r",pE.ZONE_ADJUSTMENTS="z",pE.KEY="k",pE.ATTRIBUTE="a",pE.MEDIA="m"})(z||(z={}));class DE{consumeText(Vt,_o){let ga=_o;for(;ga<Vt.length;){const rE=Vt[ga];if(rE==="\0"||rE==="\r"||rE===x)break;ga+=1}if(ga-_o==0)throw new Error("Invalid text, at ".concat(Vt));return ga}consumeUnicastAddress(Vt,_o,ga){return this.consumeTill(Vt,_o,B)}consumeOneOrMore(Vt,_o,ga){let rE=_o;for(;ga(Vt[rE]);)rE++;if(rE-_o==0)throw new Error("Invalid rule at ".concat(_o,"."));return rE}consumeSpace(Vt,_o){if(Vt[_o]===B)return _o+1;throw new Error("Invalid space at ".concat(_o,"."))}consumeIP4Address(Vt,_o){let ga=_o;for(let rE=0;rE<4;rE++)if(ga=this.consumeDecimalUChar(Vt,ga),rE!==3){if(Vt[ga]!==".")throw new Error("Invalid IP4 address.");ga++}return ga}consumeDecimalUChar(Vt,_o){let ga=_o;for(let jE=0;jE<3&&Wt(Vt[ga]);jE++,ga++);if(ga-_o==0)throw new Error("Invalid decimal uchar.");const rE=parseInt(Vt.slice(_o,ga));if(rE>=0&&rE<=255)return ga;throw new Error("Invalid decimal uchar")}consumeIP6Address(Vt,_o){let ga=this.consumeHexpart(Vt,_o);return Vt[ga]===":"&&(ga+=1,ga=this.consumeIP4Address(Vt,ga)),ga}consumeHexpart(Vt,_o){let ga=_o;if(Vt[ga]===":"&&Vt[ga+1]===":"){ga+=2;try{ga=this.consumeHexseq(Vt,ga)}catch{}return ga}if(ga=this.consumeHexseq(Vt,ga),Vt[ga]===":"&&Vt[ga+1]===":"){ga+=2;try{ga=this.consumeHexseq(Vt,ga)}catch{}return ga}return ga}consumeHexseq(Vt,_o){let ga=_o;for(;ga=this.consumeHex4(Vt,ga),Vt[ga]===":"&&Vt[ga+1]!==":";)ga+=1;return ga}consumeHex4(Vt,_o){let ga=0;for(;ga<4;ga++)if(!((rE=Vt[_o+ga])>="0"&&rE<="9"||rE>="a"&&rE<="f"||rE>="A"&&rE<="F")){if(ga===0)throw new Error("Invalid hex 4");break}var rE;return _o+ga}consumeFQDN(Vt,_o){let ga=_o;for(;Wt(Vt[ga])||_p(Vt[ga])||Vt[ga]==="-"||Vt[ga]===".";)ga+=1;if(ga-_o<4)throw new Error("Invalid FQDN");return ga}consumeExtnAddr(Vt,_o){return this.consumeOneOrMore(Vt,_o,Di)}consumeMulticastAddress(Vt,_o,ga){switch(ga){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(Vt,_o);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(Vt,_o);default:try{return this.consumeFQDN(Vt,_o)}catch{return this.consumeExtnAddr(Vt,_o)}}}consumeIP6MulticastAddress(Vt,_o){const ga=this.consumeHexpart(Vt,_o);return Vt[ga]==="/"?this.consumeInteger(Vt,ga+1):ga}consumeIP4MulticastAddress(Vt,_o){let ga=_o+3;const rE=Vt.slice(_o,ga),jE=parseInt(rE);if(jE<224||jE>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let v_=0;v_<3;v_++){if(Vt[ga]!==".")throw new Error("Invalid IP4 multicast address.");ga+=1,ga=this.consumeDecimalUChar(Vt,ga)}return Vt[ga]==="/"&&(ga+=1),ga=this.consumeTTL(Vt,ga),Vt[ga]==="/"&&(ga=this.consumeInteger(Vt,ga)),ga}consumeInteger(Vt,_o){if(!Gi(Vt[_o]))throw new Error("Invalid integer.");for(_o+=1;Wt(Vt[_o]);)_o+=1;return _o}consumeTTL(Vt,_o){if(Vt[_o]==="0")return _o+1;if(!Gi(Vt[_o]))throw new Error("Invalid TTL.");_o+=1;for(let ga=0;ga<2&&Wt(Vt[_o]);ga++)_o+=1;return _o}consumeToken(Vt,_o){return this.consumeOneOrMore(Vt,_o,Fi)}consumeTime(Vt,_o){let ga=_o;if(Vt[ga]==="0")return ga+1;for(Gi(Vt[ga])&&(ga+=1);Wt(Vt[ga]);)ga++;if(ga-_o<10)throw new Error("Invalid time");return ga}consumeAddress(Vt,_o){return this.consumeTill(Vt,_o,B)}consumeTypedTime(Vt,_o){let ga=_o;return ga=this.consumeOneOrMore(Vt,ga,Wt),_f(Vt[ga])?ga+1:ga}consumeRepeatInterval(Vt,_o){if(!Gi(Vt[_o]))throw new Error("Invalid repeat interval");for(_o+=1;Wt(Vt[_o]);)_o+=1;return _f(Vt[_o])&&(_o+=1),_o}consumePort(Vt,_o){return this.consumeOneOrMore(Vt,_o,Wt)}consume(Vt,_o,ga){for(let rE=0;rE<ga.length;rE++){if(_o+rE>=Vt.length)throw new Error("consume exceeding value length");if(Vt[_o+rE]!==ga[rE])throw new Error("consume ".concat(ga," failed at ").concat(rE))}return _o+ga.length}consumeTill(Vt,_o,ga){let rE=_o;for(;rE<Vt.length&&(typeof ga!="string"||Vt[rE]!==ga)&&(typeof ga!="function"||!ga(Vt[rE]));)rE++;return rE}}class g_ extends DE{constructor(){super(),r_(this,"records",[]),r_(this,"currentLine",0)}parse(Vt){const _o=this.probeEOL(Vt);this.records=Vt.split(_o).filter(ST=>!!ST.trim()).map(this.parseLine),this.currentLine=0;const ga=this.parseVersion(),rE=this.parseOrigin(),jE=this.parseSessionName(),v_=this.parseInformation(),_b=this.parseUri(),mS=this.parseEmail(),SR=this.parsePhone(),sS=this.parseConnection(),RR=this.parseBandWidth(),BI=this.parseTimeFields(),D_=this.parseKey(),K_=this.parseSessionAttribute(),E_=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ga,origin:rE,sessionName:jE,information:v_,uri:_b,emails:mS,phones:SR,connection:sS,bandwidths:RR,timeFields:BI,key:D_,attributes:K_,mediaDescriptions:E_}}getCurrentRecord(){const Vt=this.records[this.currentLine];if(!Vt)throw new Error("Record doesn't exit.");return Vt}probeEOL(Vt){for(let _o=0;_o<Vt.length;_o++)if(Vt[_o]===x)return Vt[_o-1]==="\r"?H:x;throw new Error("Invalid newline character.")}parseLine(Vt,_o){if(Vt.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ga=Vt[0];if(Vt[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ga,value:Vt.slice(2),line:_o,cur:0}}parseSessionAttribute(){const Vt=new x_;for(;this.currentLine<this.records.length;){const _o=this.getCurrentRecord();if(_o.type!==z.ATTRIBUTE)break;const ga={attField:this.extractOneOrMore(_o,rE=>Fi(rE)&&rE!==":"),_cur:0};_o.value[_o.cur]===":"&&(_o.cur+=1,ga.attValue=this.extractOneOrMore(_o,cE)),Vt.parse(ga),this.currentLine++}return Vt.digest()}parseMediaAttributes(Vt){const _o=new _y(Vt);for(;this.currentLine<this.records.length;){const ga=this.getCurrentRecord();if(ga.type!==z.ATTRIBUTE)break;const rE={attField:this.extractOneOrMore(ga,jE=>Fi(jE)&&jE!==":"),_cur:0};ga.value[ga.cur]===":"&&(ga.cur+=1,rE.attValue=this.extractOneOrMore(ga,cE)),_o.parse(rE),this.currentLine++}return _o.digest()}parseKey(){const Vt=this.getCurrentRecord();if(Vt.type===z.KEY){if(Vt.value==="prompt"||Vt.value==="clear:"||Vt.value==="base64:"||Vt.value==="uri:")return Vt.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const Vt=this.getCurrentRecord();if(Vt.type===z.ZONE_ADJUSTMENTS){const _o=[];for(;;)try{const ga=this.extract(Vt,this.consumeTime);this.consumeSpaceForRecord(Vt);let rE=!1;Vt.value[Vt.cur]==="-"&&(rE=!0,Vt.cur+=1);const jE=this.extract(Vt,this.consumeTypedTime);_o.push({time:ga,typedTime:jE,back:rE})}catch{break}if(_o.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,_o}return[]}parseRepeat(){const Vt=[];for(;;){const _o=this.getCurrentRecord();if(_o.type!==z.REPEAT)break;{const ga=this.extract(_o,this.consumeRepeatInterval),rE=this.parseTypedTime(_o);Vt.push({repeatInterval:ga,typedTimes:rE}),this.currentLine++}}return Vt}parseTypedTime(Vt){const _o=[];for(;;)try{this.consumeSpaceForRecord(Vt),_o.push(this.extract(Vt,this.consumeTypedTime))}catch{break}if(_o.length===0)throw new Error("Invalid typed time.");return _o}parseTime(){const Vt=this.getCurrentRecord(),_o=this.extract(Vt,this.consumeTime);this.consumeSpaceForRecord(Vt);const ga=this.extract(Vt,this.consumeTime);return this.currentLine++,{startTime:_o,stopTime:ga}}parseBandWidth(){const Vt=[];for(;this.currentLine<this.records.length;){const _o=this.getCurrentRecord();if(_o.type!==z.BANDWIDTH)break;{const ga=this.extractOneOrMore(_o,Fi);if(_o.value[_o.cur]!==":")throw new Error("Invalid bandwidth field.");_o.cur++;const rE=this.extractOneOrMore(_o,Wt);Vt.push({bwtype:ga,bandwidth:rE}),this.currentLine++}}return Vt}parseVersion(){const Vt=this.getCurrentRecord();if(Vt.type!==z.VERSION)throw new Error("first sdp record must be version");const _o=Vt.value.slice(0,this.consumeOneOrMore(Vt.value,0,Wt));if(_o.length!==Vt.value.length)throw new Error('invalid proto version, "v='.concat(Vt.value,'"'));return this.currentLine++,_o}parseOrigin(){const Vt=this.getCurrentRecord();if(Vt.type!==z.ORIGIN)throw new Error("second line of sdp must be origin");const _o=this.extractOneOrMore(Vt,Di);this.consumeSpaceForRecord(Vt);const ga=this.extractOneOrMore(Vt,Wt);this.consumeSpaceForRecord(Vt);const rE=this.extractOneOrMore(Vt,Wt);this.consumeSpaceForRecord(Vt);const jE=this.extractOneOrMore(Vt,Fi);this.consumeSpaceForRecord(Vt);const v_=this.extractOneOrMore(Vt,Fi);this.consumeSpaceForRecord(Vt);const _b=this.extract(Vt,this.consumeUnicastAddress);return this.currentLine++,{username:_o,sessId:ga,sessVersion:rE,nettype:jE,addrtype:v_,unicastAddress:_b}}parseSessionName(){const Vt=this.getCurrentRecord();if(Vt.type===z.SESSION_NAME){const _o=this.extract(Vt,this.consumeText);return this.currentLine++,_o}}parseInformation(){const Vt=this.getCurrentRecord();if(Vt.type!==z.INFORMATION)return;const _o=this.extract(Vt,this.consumeText);return this.currentLine++,_o}parseUri(){const Vt=this.getCurrentRecord();if(Vt.type===z.URI)return this.currentLine++,Vt.value}parseEmail(){const Vt=[];for(;;){const _o=this.getCurrentRecord();if(_o.type!==z.EMAIL)break;Vt.push(_o.value),this.currentLine++}return Vt}parsePhone(){const Vt=[];for(;;){const _o=this.getCurrentRecord();if(_o.type!==z.PHONE)break;Vt.push(_o.value),this.currentLine++}return Vt}parseConnection(){const Vt=this.getCurrentRecord();if(Vt.type===z.CONNECTION){const _o=this.extractOneOrMore(Vt,Fi);this.consumeSpaceForRecord(Vt);const ga=this.extractOneOrMore(Vt,Fi);this.consumeSpaceForRecord(Vt);const rE=this.extract(Vt,this.consumeAddress);return this.currentLine++,{nettype:_o,addrtype:ga,address:rE}}}parseMedia(){const Vt=this.getCurrentRecord(),_o=this.extract(Vt,this.consumeToken);this.consumeSpaceForRecord(Vt);let ga=this.extract(Vt,this.consumePort);Vt.value[Vt.cur]==="/"&&(Vt.cur+=1,ga+=this.extract(Vt,this.consumeInteger)),this.consumeSpaceForRecord(Vt);const rE=[];for(rE.push(this.extract(Vt,this.consumeToken));Vt.value[Vt.cur]==="/";)Vt.cur+=1,rE.push(this.extract(Vt,this.consumeToken));if(rE.length===0)throw new Error("Invalid proto");const jE=this.parseFmt(Vt);return this.currentLine++,{mediaType:_o,port:ga,protos:rE,fmts:jE}}parseTimeFields(){const Vt=[];for(;this.getCurrentRecord().type===z.TIME;){const _o=this.parseTime(),ga=this.parseRepeat(),rE=this.parseZone();Vt.push({time:_o,repeats:ga,zones:rE})}return Vt}parseMediaDescription(){const Vt=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===z.MEDIA;){const _o=this.parseMedia(),ga=this.parseInformation(),rE=this.parseConnections(),jE=this.parseBandWidth(),v_=this.parseKey(),_b=this.parseMediaAttributes(_o);Vt.push({media:_o,information:ga,connections:rE,bandwidths:jE,key:v_,attributes:_b})}return Vt}parseConnections(){const Vt=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===z.CONNECTION;)Vt.push(this.parseConnection());return Vt}parseFmt(Vt){const _o=[];for(;;)try{this.consumeSpaceForRecord(Vt),_o.push(this.extract(Vt,this.consumeToken))}catch{break}if(_o.length===0)throw new Error("Invalid fmts");return _o}extract(Vt,_o,...ga){const rE=_o.call(this,Vt.value,Vt.cur,...ga),jE=Vt.value.slice(Vt.cur,rE);return Vt.cur=rE,jE}extractOneOrMore(Vt,_o){const ga=this.consumeOneOrMore(Vt.value,Vt.cur,_o),rE=Vt.value.slice(Vt.cur,ga);return Vt.cur=ga,rE}consumeSpaceForRecord(Vt){if(Vt.value[Vt.cur]!==B)throw new Error("Invalid space at ".concat(Vt.cur,"."));Vt.cur+=1}}class l_ extends DE{constructor(...Vt){super(...Vt),r_(this,"attributes",void 0),r_(this,"digested",!1)}extractOneOrMore(Vt,_o,ga){const rE=this.consumeOneOrMore(Vt.attValue,Vt._cur,_o),jE=Vt.attValue.slice(Vt._cur,rE),[v_,_b]=ga||[];if(typeof v_=="number"&&jE.length<v_)throw new Error("error in length, should be more or equal than ".concat(v_," characters."));if(typeof _b=="number"&&jE.length>_b)throw new Error("error in length, should be less or equal than ".concat(_b," characters."));return Vt._cur=rE,jE}consumeAttributeSpace(Vt){if(Vt.attValue[Vt._cur]!==B)throw new Error("Invalid space at ".concat(Vt._cur,"."));Vt._cur+=1}extract(Vt,_o,...ga){if(!Vt.attValue)throw new Error("Nothing to extract from attValue.");const rE=_o.call(this,Vt.attValue,Vt._cur,...ga),jE=Vt.attValue.slice(Vt._cur,rE);return Vt._cur=rE,jE}atEnd(Vt){if(!Vt.attValue)throw new Error;return Vt._cur>=Vt.attValue.length}peekChar(Vt){if(!Vt.attValue)throw new Error;return Vt.attValue[Vt._cur]}peek(Vt,_o){if(!Vt.attValue)throw new Error;for(let ga=0;ga<_o.length;ga++)if(_o[ga]!==Vt.attValue[Vt._cur+ga])return!1;return!0}parseIceUfrag(Vt){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(Vt,RE,[4,256])}parseIcePwd(Vt){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(Vt,RE,[22,256])}parseIceOptions(Vt){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const _o=[];for(;!this.atEnd(Vt);){_o.push(this.extractOneOrMore(Vt,RE));try{this.consumeAttributeSpace(Vt)}catch(ga){if(this.atEnd(Vt))break;throw ga}}this.attributes.iceOptions=_o}parseFingerprint(Vt){const _o=this.extract(Vt,this.consumeToken);this.consumeAttributeSpace(Vt);const ga=this.extract(Vt,this.consumeTill);this.attributes.fingerprints.push({hashFunction:_o,fingerprint:ga})}parseExtmap(Vt){const _o=this.extractOneOrMore(Vt,Wt);let ga;this.peekChar(Vt)==="/"&&(this.extract(Vt,this.consume,"/"),ga=this.extract(Vt,this.consumeToken)),this.consumeAttributeSpace(Vt);const rE=this.extract(Vt,this.consumeTill,B),jE=EE(EE({entry:parseInt(_o,10)},ga&&{direction:ga}),{},{extensionName:rE});this.peekChar(Vt)===B&&(this.consumeAttributeSpace(Vt),jE.extensionAttributes=this.extract(Vt,this.consumeTill)),this.attributes.extmaps.push(jE)}parseSetup(Vt){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const _o=this.extract(Vt,this.consumeTill);if(_o!=="active"&&_o!=="passive"&&_o!=="actpass"&&_o!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=_o}}class x_ extends l_{constructor(...Vt){super(...Vt),r_(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(Vt){if(this.digested)throw new Error("already digested");try{switch(Vt.attField){case"group":this.parseGroup(Vt);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(Vt);break;case"ice-pwd":this.parseIcePwd(Vt);break;case"ice-options":this.parseIceOptions(Vt);break;case"fingerprint":this.parseFingerprint(Vt);break;case"setup":this.parseSetup(Vt);break;case"tls-id":this.parseTlsId(Vt);break;case"identity":this.parseIdentity(Vt);break;case"extmap":this.parseExtmap(Vt);break;case"msid-semantic":this.parseMsidSemantic(Vt);break;default:Vt.ignored=!0,this.attributes.unrecognized.push(Vt)}}catch(_o){throw console.error("parsing session attribute ".concat(Vt.attField,' error, "a=').concat(Vt.attField,":").concat(Vt.attValue,'"')),_o}if(!Vt.ignored&&Vt.attValue&&!this.atEnd(Vt))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(Vt){const _o=this.extract(Vt,this.consumeToken),ga=[];for(;!this.atEnd(Vt)&&this.peekChar(Vt)===B;)this.consumeAttributeSpace(Vt),ga.push(this.extract(Vt,this.consumeToken));this.attributes.groups.push({semantic:_o,identificationTag:ga})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(Vt){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(Vt,dE)}parseIdentity(Vt){const _o=this.extractOneOrMore(Vt,lE),ga=[];for(;!this.atEnd(Vt)&&this.peekChar(Vt)===B;){this.consumeAttributeSpace(Vt);const rE=this.extract(Vt,this.consumeToken);this.extract(Vt,this.consume,"=");const jE=this.extractOneOrMore(Vt,v_=>v_!==B&&cE(v_));ga.push({name:rE,value:jE})}this.attributes.identities.push({assertionValue:_o,extensions:ga})}parseMsidSemantic(Vt){this.peekChar(Vt)===B&&this.consumeAttributeSpace(Vt);const _o={semantic:this.extract(Vt,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(Vt)}catch{break}if(this.peekChar(Vt)==="*"){this.extract(Vt,this.consume,"*"),_o.applyForAll=!0;break}{const ga=this.extract(Vt,this.consumeTill,B);_o.identifierList.push(ga)}}this.attributes.msidSemantic=_o}}class _y extends l_{constructor(Vt){super(),r_(this,"attributes",void 0),Vt.protos.indexOf("RTP")!==-1||Vt.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(Vt){if(this.digested)throw new Error("already digested");try{switch(Vt.attField){case"extmap":this.parseExtmap(Vt);break;case"setup":this.parseSetup(Vt);break;case"ice-ufrag":this.parseIceUfrag(Vt);break;case"ice-pwd":this.parseIcePwd(Vt);break;case"ice-options":this.parseIceOptions(Vt);break;case"candidate":this.parseCandidate(Vt);break;case"remote-candidate":this.parseRemoteCandidate(Vt);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(Vt);break;case"rtpmap":this.parseRtpmap(Vt);break;case"ptime":this.parsePtime(Vt);break;case"maxptime":this.parseMaxPtime(Vt);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(Vt);break;case"ssrc":this.parseSSRC(Vt);break;case"fmtp":this.parseFmtp(Vt);break;case"rtcp-fb":this.parseRtcpFb(Vt);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(Vt);break;case"mid":this.parseMid(Vt);break;case"msid":this.parseMsid(Vt);break;case"imageattr":this.parseImageAttr(Vt);break;case"rid":this.parseRid(Vt);break;case"simulcast":this.parseSimulcast(Vt);break;case"sctp-port":this.parseSctpPort(Vt);break;case"max-message-size":this.parseMaxMessageSize(Vt);break;case"ssrc-group":this.parseSSRCGroup(Vt);break;default:Vt.ignored=!0,this.attributes.unrecognized.push(Vt)}}catch(_o){throw console.error("parsing media attribute ".concat(Vt.attField,' error, "a=').concat(Vt.attField,":").concat(Vt.attValue,'"')),_o}if(!Vt.ignored&&Vt.attValue&&!this.atEnd(Vt))throw new Error("attribute parsing error")}parseCandidate(Vt){const _o=this.extractOneOrMore(Vt,RE,[1,32]);this.consumeAttributeSpace(Vt);const ga=this.extractOneOrMore(Vt,Wt,[1,5]);this.consumeAttributeSpace(Vt);const rE=this.extract(Vt,this.consumeToken);this.consumeAttributeSpace(Vt);const jE=this.extractOneOrMore(Vt,Wt,[1,10]);this.consumeAttributeSpace(Vt);const v_=this.extract(Vt,this.consumeAddress);this.consumeAttributeSpace(Vt);const _b=this.extract(Vt,this.consumePort);this.consumeAttributeSpace(Vt),this.extract(Vt,this.consume,"typ"),this.consumeAttributeSpace(Vt);const mS={foundation:_o,componentId:ga,transport:rE,priority:jE,connectionAddress:v_,port:_b,type:this.extract(Vt,this.consumeToken),extension:{}};for(this.peek(Vt," raddr")&&(this.extract(Vt,this.consume," raddr"),this.consumeAttributeSpace(Vt),mS.relAddr=this.extract(Vt,this.consumeAddress)),this.peek(Vt," rport")&&(this.extract(Vt,this.consume," rport"),this.consumeAttributeSpace(Vt),mS.relPort=this.extract(Vt,this.consumePort));this.peekChar(Vt)===B;){this.consumeAttributeSpace(Vt);const SR=this.extract(Vt,this.consumeToken);this.consumeAttributeSpace(Vt),mS.extension[SR]=this.extractOneOrMore(Vt,_r)}this.attributes.candidates.push(mS)}parseRemoteCandidate(Vt){const _o=[];for(;;){const ga=this.extractOneOrMore(Vt,Wt,[1,5]);this.consumeAttributeSpace(Vt);const rE=this.extract(Vt,this.consumeAddress);this.consumeAttributeSpace(Vt);const jE=this.extract(Vt,this.consumePort);_o.push({componentId:ga,connectionAddress:rE,port:jE});try{this.consumeAttributeSpace(Vt)}catch{break}}this.attributes.remoteCandidatesList.push(_o)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(Vt){const _o=this.extract(Vt,this.consumeToken);this.consumeAttributeSpace(Vt);const ga=this.extract(Vt,this.consumeTill,"/");this.extract(Vt,this.consume,"/");const rE={encodingName:ga,clockRate:this.extractOneOrMore(Vt,Wt)};this.atEnd(Vt)||this.peekChar(Vt)!=="/"||(this.extract(Vt,this.consume,"/"),rE.encodingParameters=parseInt(this.extract(Vt,this.consumeTill),10));const jE=this.attributes.payloads.find(v_=>v_.payloadType===parseInt(_o,10));jE?jE.rtpMap=rE:this.attributes.payloads.push({payloadType:parseInt(_o,10),rtpMap:rE,rtcpFeedbacks:[]})}parsePtime(Vt){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(Vt,this.consumeTill)}parseMaxPtime(Vt){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(Vt,this.consumeTill)}parseDirection(Vt){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=Vt.attField}parseSSRC(Vt){const _o=this.extractOneOrMore(Vt,Wt);this.consumeAttributeSpace(Vt);const ga=this.extract(Vt,this.consumeTill,":");let rE;this.peekChar(Vt)===":"&&(this.extract(Vt,this.consume,":"),rE=this.extract(Vt,this.consumeTill));const jE=this.attributes.ssrcs.find(v_=>v_.ssrcId===parseInt(_o,10));jE?jE.attributes[ga]=rE:this.attributes.ssrcs.push({ssrcId:parseInt(_o,10),attributes:{[ga]:rE}})}parseFmtp(Vt){const _o=this.extract(Vt,this.consumeTill,B);this.consumeAttributeSpace(Vt);const ga=this.extract(Vt,this.consumeTill),rE={};ga.split(";").forEach(v_=>{let[_b,mS]=v_.split("=");_b=_b.trim();const SR=typeof mS=="string"?mS.trim():null;typeof _b=="string"&&_b.length>0&&(rE[_b]=SR)});const jE=this.attributes.payloads.find(v_=>v_.payloadType===parseInt(_o,10));jE?jE.fmtp={parameters:rE}:this.attributes.payloads.push({payloadType:parseInt(_o,10),rtcpFeedbacks:[],fmtp:{parameters:rE}})}parseFmtParameters(Vt){const _o={},ga=this.extract(Vt,this.consumeTill,"=");Vt._cur++;const rE=this.extract(Vt,this.consumeTill,";");for(_o[ga]=rE;Vt.attValue[Vt._cur]===";";){const jE=this.extract(Vt,this.consumeTill,"=");Vt._cur++;const v_=this.extract(Vt,this.consumeTill,";");_o[jE]=v_}return _o}parseRtcpFb(Vt){let _o="";_o=this.peekChar(Vt)==="*"?this.extract(Vt,this.consume,"*"):this.extract(Vt,this.consumeTill,B),this.consumeAttributeSpace(Vt);const ga=this.extract(Vt,this.consumeTill,B);let rE;switch(ga){case"trr-int":rE={type:ga,interval:this.extract(Vt,this.consumeTill)};break;case"ack":case"nack":default:{const jE={type:ga};this.peekChar(Vt)===B&&(this.consumeAttributeSpace(Vt),jE.parameter=this.extract(Vt,this.consumeToken),this.peekChar(Vt)===B&&(jE.additional=this.extract(Vt,this.consumeTill))),rE=jE}}if(_o==="*")this.attributes.rtcpFeedbackWildcards.push(rE);else{const jE=this.attributes.payloads.find(v_=>v_.payloadType===parseInt(_o,10));jE?jE.rtcpFeedbacks.push(rE):this.attributes.payloads.push({payloadType:parseInt(_o,10),rtcpFeedbacks:[rE]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(Vt){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const _o={port:this.extract(Vt,this.consumePort)};this.peekChar(Vt)===B&&(this.consumeAttributeSpace(Vt),_o.netType=this.extractOneOrMore(Vt,Fi),this.consumeAttributeSpace(Vt),_o.addressType=this.extractOneOrMore(Vt,Fi),this.consumeAttributeSpace(Vt),_o.address=this.extract(Vt,this.consumeAddress)),this.attributes.rtcp=_o}parseMsid(Vt){const _o={id:this.extractOneOrMore(Vt,Fi,[1,64])};this.peekChar(Vt)===B&&(this.consumeAttributeSpace(Vt),_o.appdata=this.extractOneOrMore(Vt,Fi,[1,64])),this.attributes.msids.push(_o)}parseImageAttr(Vt){this.attributes.imageattr.push(Vt.attValue)}parseRid(Vt){const _o=this.extractOneOrMore(Vt,rE=>_p(rE)||Wt(rE)||rE==="_"||rE==="-");this.consumeAttributeSpace(Vt);const ga={id:_o,direction:this.extract(Vt,this.consumeToken),params:[]};if(this.peekChar(Vt)===B){if(this.consumeAttributeSpace(Vt),this.peek(Vt,"pt=")){this.extract(Vt,this.consume,"pt=");const rE=[];for(;;){const jE=this.extract(Vt,this.consumeToken);rE.push(jE);try{this.extract(Vt,this.consume,",")}catch{break}}ga.payloads=rE,this.peekChar(Vt)===B&&this.extract(Vt,this.consume,B)}for(;;){const rE=this.extract(Vt,this.consumeToken);switch(rE){case"depend":{const jE={type:rE,rids:this.extract(Vt,this.consume,"=").split(",")};ga.params.push(jE);break}case"max-width":case"height-width":case"max-fps":case"max-fs":case"max-br":case"max-pps":case"max-bpp":default:{const jE={type:rE};this.peekChar(Vt)==="="&&(this.extract(Vt,this.consume,"="),jE.val=this.extract(Vt,this.consumeTill,";")),ga.params.push(jE)}}try{this.extract(Vt,this.consume,";")}catch{break}}}this.attributes.rids.push(ga)}parseSimulcast(Vt){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=Vt.attValue,this.extract(Vt,this.consumeTill)}parseSctpPort(Vt){this.attributes.sctpPort=this.extractOneOrMore(Vt,Wt,[1,5])}parseMaxMessageSize(Vt){this.attributes.maxMessageSize=this.extractOneOrMore(Vt,Wt,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(Vt){this.attributes.mid=this.extract(Vt,this.consumeToken)}parseSSRCGroup(Vt){const _o=this.extract(Vt,this.consumeToken),ga=[];for(;;)try{this.consumeAttributeSpace(Vt);const rE=this.extract(Vt,this.consumeInteger);ga.push(parseInt(rE,10))}catch{break}this.attributes.ssrcGroups.push({semantic:_o,ssrcIds:ga})}}function L_(pE,Vt,_o){return Vt in pE?Object.defineProperty(pE,Vt,{value:_o,enumerable:!0,configurable:!0,writable:!0}):pE[Vt]=_o,pE}class wT{constructor(){L_(this,"eol",H)}print(Vt,_o){let ga="";return _o&&(this.eol=_o),ga+=this.printVersion(Vt.version),ga+=this.printOrigin(Vt.origin),ga+=this.printSessionName(Vt.sessionName),ga+=this.printInformation(Vt.information),ga+=this.printUri(Vt.uri),ga+=this.printEmail(Vt.emails),ga+=this.printPhone(Vt.phones),ga+=this.printConnection(Vt.connection),ga+=this.printBandwidth(Vt.bandwidths),ga+=this.printTimeFields(Vt.timeFields),ga+=this.printKey(Vt.key),ga+=this.printSessionAttributes(Vt.attributes),ga+=this.printMediaDescription(Vt.mediaDescriptions),ga}printVersion(Vt){return"v=".concat(Vt).concat(this.eol)}printOrigin(Vt){return"o=".concat(Vt.username," ").concat(Vt.sessId," ").concat(Vt.sessVersion," ").concat(Vt.nettype," ").concat(Vt.addrtype," ").concat(Vt.unicastAddress).concat(this.eol)}printSessionName(Vt){return Vt?"s=".concat(Vt).concat(this.eol):""}printInformation(Vt){return Vt?"i=".concat(Vt).concat(this.eol):""}printUri(Vt){return Vt?"u=".concat(Vt).concat(this.eol):""}printEmail(Vt){let _o="";for(const ga of Vt)_o+="e=".concat(ga).concat(this.eol);return _o}printPhone(Vt){let _o="";for(const ga of Vt)_o+="e=".concat(ga).concat(this.eol);return _o}printConnection(Vt){return Vt?"c=".concat(Vt.nettype," ").concat(Vt.addrtype," ").concat(Vt.address).concat(this.eol):""}printBandwidth(Vt){let _o="";for(const ga of Vt)_o+="b=".concat(ga.bwtype,":").concat(ga.bandwidth).concat(this.eol);return _o}printTimeFields(Vt){let _o="";for(const ga of Vt){_o+="t=".concat(ga.time.startTime," ").concat(ga.time.startTime).concat(this.eol);for(const rE of ga.repeats)_o+="r=".concat(rE.repeatInterval," ").concat(rE.typedTimes.join(" ")).concat(this.eol);ga.zoneAdjustments&&(_o+="z=",_o+="z=".concat(ga.zoneAdjustments.map(rE=>"".concat(rE.time," ").concat(rE.back?"-":""," ").concat(rE.typedTime)).join(" ")).concat(this.eol),_o+=this.eol)}return _o}printKey(Vt){return Vt?"k=".concat(Vt).concat(this.eol):""}printAttributes(Vt){let _o="";for(const ga of Vt)_o+="a=".concat(ga.attField).concat(ga.attValue?":".concat(ga.attValue):"").concat(this.eol);return _o}printMediaDescription(Vt){let _o="";for(const ga of Vt)_o+=this.printMedia(ga.media),_o+=this.printInformation(ga.information),_o+=this.printConnections(ga.connections),_o+=this.printBandwidth(ga.bandwidths),_o+=this.printKey(ga.key),_o+=this.printMediaAttributes(ga);return _o}printConnections(Vt){let _o="";for(const ga of Vt)_o+=this.printConnection(ga);return _o}printMedia(Vt){return"m=".concat(Vt.mediaType," ").concat(Vt.port," ").concat(Vt.protos.join("/")," ").concat(Vt.fmts.join(" ")).concat(this.eol)}printSessionAttributes(Vt){return new uE(this.eol).print(Vt)}printMediaAttributes(Vt){return new gE(this.eol).print(Vt)}}class eE{constructor(Vt){L_(this,"eol",void 0),this.eol=Vt}printIceUfrag(Vt){return Vt===void 0?"":"a=ice-ufrag:".concat(Vt).concat(this.eol)}printIcePwd(Vt){return Vt===void 0?"":"a=ice-pwd:".concat(Vt).concat(this.eol)}printIceOptions(Vt){return Vt===void 0?"":"a=ice-options:".concat(Vt.join(B)).concat(this.eol)}printFingerprints(Vt){return Vt.length>0?Vt.map(_o=>"a=fingerprint:".concat(_o.hashFunction).concat(B).concat(_o.fingerprint)).join(this.eol)+this.eol:""}printExtmap(Vt){return Vt.map(_o=>"a=extmap:".concat(_o.entry).concat(_o.direction?"/".concat(_o.direction):"").concat(B).concat(_o.extensionName).concat(_o.extensionAttributes?"".concat(B).concat(_o.extensionAttributes):"").concat(this.eol)).join("")}printSetup(Vt){return Vt===void 0?"":"a=setup:".concat(Vt).concat(this.eol)}printUnrecognized(Vt){return Vt.map(_o=>"a=".concat(_o.attField).concat(_o.attValue?":".concat(_o.attValue):"").concat(this.eol)).join("")}}class uE extends eE{print(Vt){let _o="";return _o+=this.printGroups(Vt.groups),_o+=this.printMsidSemantic(Vt.msidSemantic),_o+=this.printIceLite(Vt.iceLite),_o+=this.printIceUfrag(Vt.iceUfrag),_o+=this.printIcePwd(Vt.icePwd),_o+=this.printIceOptions(Vt.iceOptions),_o+=this.printFingerprints(Vt.fingerprints),_o+=this.printSetup(Vt.setup),_o+=this.printTlsId(Vt.tlsId),_o+=this.printIdentity(Vt.identities),_o+=this.printExtmap(Vt.extmaps),_o+=this.printUnrecognized(Vt.unrecognized),_o}printGroups(Vt){let _o="";return Vt.length>0&&(_o+=Vt.map(ga=>"a=group:".concat(ga.semantic).concat(ga.identificationTag.map(rE=>"".concat(B).concat(rE)).join("")).concat(this.eol)).join("")),_o}printIceLite(Vt){return Vt===void 0?"":"a=ice-lite"+this.eol}printTlsId(Vt){return Vt?"a=tls-id:".concat(Vt).concat(this.eol):""}printIdentity(Vt){return Vt.length===0?"":Vt.map(_o=>"a=identity:".concat(_o.assertionValue).concat(_o.extensions.map(ga=>"".concat(B).concat(ga.name).concat(ga.value?"=".concat(ga.value):"")))).join(this.eol)+this.eol}printMsidSemantic(Vt){if(!Vt)return"";let _o="a=msid-semantic:".concat(Vt.semantic);return Vt.applyForAll?_o+="".concat(B,"*"):Vt.identifierList.length>0&&(_o+=Vt.identifierList.map(ga=>"".concat(B).concat(ga))),_o+this.eol}}class gE extends eE{print(Vt){const _o=Vt.attributes;let ga="";return ga+=this.printRTCP(_o.rtcp),ga+=this.printIceUfrag(_o.iceUfrag),ga+=this.printIcePwd(_o.icePwd),ga+=this.printIceOptions(_o.iceOptions),ga+=this.printCandidates(_o.candidates),ga+=this.printRemoteCandidatesList(_o.remoteCandidatesList),ga+=this.printEndOfCandidates(_o.endOfCandidates),ga+=this.printFingerprints(_o.fingerprints),ga+=this.printSetup(_o.setup),ga+=this.printMid(_o.mid),ga+=this.printExtmap(_o.extmaps),ga+=this.printRTPRelated(_o),ga+=this.printPtime(_o.ptime),ga+=this.printMaxPtime(_o.maxPtime),ga+=this.printDirection(_o.direction),ga+=this.printSSRCGroups(_o.ssrcGroups),ga+=this.printSSRC(_o.ssrcs),ga+=this.printRTCPMux(_o.rtcpMux),ga+=this.printRTCPMuxOnly(_o.rtcpMuxOnly),ga+=this.printRTCPRsize(_o.rtcpRsize),ga+=this.printMSId(_o.msids),ga+=this.printImageattr(_o.imageattr),ga+=this.printRid(_o.rids),ga+=this.printSimulcast(_o.simulcast),ga+=this.printSCTPPort(_o.sctpPort),ga+=this.printMaxMessageSize(_o.maxMessageSize),ga+=this.printUnrecognized(_o.unrecognized),ga}printCandidates(Vt){return Vt.map(_o=>"a=candidate:".concat(_o.foundation).concat(B).concat(_o.componentId).concat(B).concat(_o.transport).concat(B).concat(_o.priority).concat(B).concat(_o.connectionAddress).concat(B).concat(_o.port).concat(B,"typ").concat(B).concat(_o.type).concat(_o.relAddr?"".concat(B,"raddr").concat(B).concat(_o.relAddr):"").concat(_o.relPort?"".concat(B,"rport").concat(B).concat(_o.relPort):"").concat(Object.keys(_o.extension).map(ga=>"".concat(B).concat(ga).concat(B).concat(_o.extension[ga])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(Vt){return Vt.map(_o=>"a=remote-candidates:".concat(_o.join(B)).concat(this.eol)).join("")}printEndOfCandidates(Vt){return Vt===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(Vt){if(!Vt.payloads)return"";const _o=Vt.payloads;let ga="";ga+=Vt.rtcpFeedbackWildcards.map(rE=>this.printRTCPFeedback("*",rE)).join("");for(const rE of _o)ga+=this.printRtpMap(rE.payloadType,rE.rtpMap),ga+=this.printFmtp(rE.payloadType,rE.fmtp),ga+=rE.rtcpFeedbacks.map(jE=>this.printRTCPFeedback(rE.payloadType,jE)).join("");return ga}printFmtp(Vt,_o){if(!_o)return"";const ga=Object.keys(_o.parameters);return ga.length===1&&_o.parameters[ga[0]]===null?"a=fmtp:".concat(Vt).concat(B).concat(ga[0]).concat(this.eol):"a=fmtp:".concat(Vt).concat(B).concat(Object.keys(_o.parameters).map(rE=>"".concat(rE,"=").concat(_o.parameters[rE])).join(";")).concat(this.eol)}printRtpMap(Vt,_o){return _o?"a=rtpmap:".concat(Vt).concat(B).concat(_o.encodingName,"/").concat(_o.clockRate).concat(_o.encodingParameters?"/".concat(_o.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(Vt,_o){let ga="a=rtcp-fb:".concat(Vt).concat(B),rE=_o;switch(rE.type){case"trr-int":ga+="ttr-int".concat(B).concat(rE.interval);break;case"ack":case"nack":default:rE=rE,ga+="".concat(rE.type),rE.parameter&&(ga+="".concat(B).concat(rE.parameter),rE.additional&&(ga+="".concat(B).concat(rE.additional)))}return ga+this.eol}printPtime(Vt){return Vt===void 0?"":"a=ptime:".concat(Vt).concat(this.eol)}printMaxPtime(Vt){return Vt===void 0?"":"a=maxptime:".concat(Vt).concat(this.eol)}printDirection(Vt){return Vt===void 0?"":"a=".concat(Vt).concat(this.eol)}printSSRC(Vt){return Vt.map(_o=>Object.keys(_o.attributes).map(ga=>"a=ssrc:".concat(_o.ssrcId.toString(10)).concat(B).concat(ga).concat(_o.attributes[ga]?":".concat(_o.attributes[ga]):"").concat(this.eol)).join("")).join("")}printRTCPMux(Vt){return Vt===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(Vt){return Vt===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(Vt){return Vt===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(Vt){if(Vt===void 0)return"";let _o="a=rtcp:".concat(Vt.port);return Vt.netType&&(_o+="".concat(B).concat(Vt.netType)),Vt.addressType&&(_o+="".concat(B).concat(Vt.addressType)),Vt.address&&(_o+="".concat(B).concat(Vt.address)),_o+this.eol}printMSId(Vt){return Vt.map(_o=>"a=msid:".concat(_o.id).concat(_o.appdata?"".concat(B).concat(_o.appdata):"").concat(this.eol)).join("")}printImageattr(Vt){return Vt.map(_o=>"a=imageattr:".concat(_o).concat(this.eol)).join("")}printRid(Vt){return Vt.map(_o=>{let ga="a=rid:".concat(_o.id).concat(B).concat(_o.direction);return _o.payloads&&(ga+="".concat(B,"pt=").concat(_o.payloads.join(","))),_o.params.length>0&&(ga+="".concat(B).concat(_o.params.map(rE=>rE.type==="depend"?"depend=".concat(rE.rids.join(",")):"".concat(rE.type,"=").concat(rE.val)).join(";"))),ga+this.eol}).join("")}printSimulcast(Vt){return Vt===void 0?"":"a=simulcast:".concat(Vt).concat(this.eol)}printSCTPPort(Vt){return Vt===void 0?"":"a=sctp-port:".concat(Vt).concat(this.eol)}printMaxMessageSize(Vt){return Vt===void 0?"":"a=max-message-size:".concat(Vt).concat(this.eol)}printMid(Vt){return Vt===void 0?"":"a=mid:".concat(Vt).concat(this.eol)}printSSRCGroups(Vt){return Vt.map(_o=>"a=ssrc-group:".concat(_o.semantic).concat(_o.ssrcIds.map(ga=>"".concat(B).concat(ga.toString(10))).join("")).concat(this.eol)).join("")}}function UE(pE){return new g_().parse(pE)}function $E(pE,Vt){return new wT().print(pE,Vt)}}},l={};function p(_){if(l[_])return l[_].exports;var b=l[_]={exports:{}};return s[_](b,b.exports,p),b.exports}return p.d=(_,b)=>{for(var P in b)p.o(b,P)&&!p.o(_,P)&&Object.defineProperty(_,P,{enumerable:!0,get:b[P]})},p.o=(_,b)=>Object.prototype.hasOwnProperty.call(_,b),p.r=_=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(_,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(_,"__esModule",{value:!0})},p(8)})()})(W_);class PQ{constructor(i){$(this,"sessionDesc",void 0),$(this,"localCapabilities",void 0),$(this,"rtpCapabilities",void 0),$(this,"candidates",void 0),$(this,"iceParameters",void 0),$(this,"dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname",void 0),i=G_(i);const{remoteIceParameters:s,remoteDtlsParameters:l,candidates:p,remoteRTPCapabilities:_,remoteSetup:b,localCapabilities:P,sdkCodec:x,cname:H}=i,B=W_.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=_,this.candidates=p,this.iceParameters=s,this.dtlsParameters=l,this.setup=b,this.localCapabilities=P,this.cname=H;for(let z=0;z<B.mediaDescriptions.length;z++){const Wt=B.mediaDescriptions[z];Wt.attributes.iceUfrag=s.iceUfrag,Wt.attributes.icePwd=s.icePwd,Wt.attributes.fingerprints=l.fingerprints,Wt.attributes.candidates=p,Wt.attributes.setup=b,Wt.media.mediaType==="video"&&(Wt.media.fmts=_.videoCodecs.map(_r=>_r.payloadType.toString(10)),Wt.attributes.payloads=_.videoCodecs,Wt.attributes.extmaps=_.videoExtensions),Wt.media.mediaType==="audio"&&(Wt.media.fmts=_.audioCodecs.map(_r=>_r.payloadType.toString(10)),Wt.attributes.payloads=_.audioCodecs,Wt.attributes.extmaps=_.audioExtensions),B.mediaDescriptions[z]=this.mungMediaDesc(Wt)}this.sessionDesc=B,this.currentMidIndex=B.mediaDescriptions.length-1}toString(){return W_.exports.print(this.sessionDesc)}send(i,s,l){const{ssrcs:p,ssrcGroups:_}=nS(s,this.cname),b=this.sessionDesc.mediaDescriptions.find(H=>i===VE.VIDEO?H.media.mediaType==="video":H.media.mediaType==="audio"),P=p[0].attributes.label,x=p[0].attributes.mslabel;return b.attributes.ssrcs=b.attributes.ssrcs.concat(p),b.attributes.ssrcGroups=b.attributes.ssrcGroups.concat(_),{id:P,mslabel:x}}batchSend(i){return i.map(s=>{let{kind:l,ssrcMsg:p}=s;return this.send(l,p,void 0)})}stopSending(i){this.sessionDesc.mediaDescriptions.forEach(s=>{const l=[],p=[],_=[];s.attributes.ssrcs.forEach(b=>{i.includes(b.attributes.label||"")?_.push(b):l.push(b)}),s.attributes.ssrcGroups.forEach(b=>{_.map(P=>P.ssrcId).includes(b.ssrcIds[0])||p.push(b)}),s.attributes.ssrcs=l,s.attributes.ssrcGroups=p})}mute(i){const s=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===i);if(!s)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(i){const s=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===i);if(!s)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(i,s,l){i.forEach((p,_)=>{const b=p._mediaStreamTrack,P=this.sessionDesc.mediaDescriptions.findIndex(H=>H.attributes.mid===b.kind),x=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[P],p);this.sessionDesc.mediaDescriptions[P]=x})}stopReceiving(i){}updateCandidates(i){i===Fg.TCP?this.candidates.forEach(s=>{this.candidates.findIndex(l=>l.transport==="tcp"&&l.connectionAddress===s.connectionAddress&&l.port===s.port)===-1&&this.candidates.push(WG(WG({},s),{},{foundation:"tcpcandidate",priority:Number(s.priority)-1+"",transport:"tcp",port:Number(s.port)+90+""}))}):this.candidates=this.candidates.filter(s=>s.transport!=="tcp");for(const s of this.sessionDesc.mediaDescriptions)s.attributes.candidates=this.candidates}restartICE(i){i=G_(i),this.iceParameters=i,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=i.iceUfrag,s.attributes.icePwd=i.icePwd})}predictReceivingMids(i){const s=[];for(let l=0;l<i;l++)s.push((this.currentMidIndex+l+1).toString(10));return s}mungRecvMediaDsec(i,s){const l=G_(i);return MI(l,s),PL(l,s),l}updateRecvMedia(i,s){const l=this.sessionDesc.mediaDescriptions.findIndex(p=>p.attributes.mid===i);if(l!==-1){const p=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],s);this.sessionDesc.mediaDescriptions[l]=p}}bumpMid(i){this.currentMidIndex+=i}updateTrackLabel(i,s,l){const p=this.sessionDesc.mediaDescriptions.find(b=>i===VE.VIDEO?b.attributes.mid==="video":b.attributes.mid==="audio");if(p){const b=p.attributes.ssrcs.find(P=>P.attributes.label===s);var _;b&&(b.attributes.label=l,(_=b.attributes.msid)===null||_===void 0||_.replace(s,l))}}mungMediaDesc(i){const s=G_(i);return DL(s),function(l){const p=l.attributes.extmaps.find(_=>_.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");p&&l.attributes.extmaps.splice(l.attributes.extmaps.indexOf(p),1),l.attributes.payloads.forEach(_=>{const b=_.rtcpFeedbacks.findIndex(P=>P.type==="transport-cc");b!==-1&&_.rtcpFeedbacks.splice(b,1)})}(s),s}getSSRC(i){for(const s of this.sessionDesc.mediaDescriptions)for(const l of s.attributes.ssrcs)if(l.attributes.label===i)return[l]}}function fS(r){if(Array.isArray(r))return r.map(s=>s);if(!KG(r))return r;const i={};for(const s in r)KG(r[s])||Array.isArray(r[s])?i[s]=fS(r[s]):i[s]=r[s];return i}function KG(r){return!(typeof r!="object"||Array.isArray(r)||!r)}function kQ(){const r=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return r&&r[0]?Number(r[0].split("/")[1]):null}function LQ(r){return window.RTCStatsReport?r.getStats()instanceof SE:!1}class LL{constructor(i){$(this,"input",[]),$(this,"size",void 0),this.size=i}add(i){this.input.push(i),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const gR={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},y0={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:gR,remoteCandidate:gR}},HG={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},YG={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,qpSumPerFrame:0},zG={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},JG={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function XG(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function QG(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?XG(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):XG(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}class ML{constructor(i,s){$(this,"onFirstVideoReceived",void 0),$(this,"onFirstVideoDecoded",void 0),$(this,"onFirstAudioReceived",void 0),$(this,"onFirstVideoDecodedTimeout",void 0),$(this,"onFirstAudioDecoded",void 0),$(this,"onSelectedLocalCandidateChanged",void 0),$(this,"onSelectedRemoteCandidateChanged",void 0),$(this,"videoIsReady",!1),$(this,"videoIsReady2",{}),$(this,"pc",void 0),$(this,"options",void 0),$(this,"intervalTimer",void 0),$(this,"stats",fS(y0)),$(this,"isFirstVideoReceived",{}),$(this,"isFirstVideoDecoded",{}),$(this,"isFirstAudioReceived",{}),$(this,"isFirstAudioDecoded",{}),$(this,"isFirstVideoDecodedTimeout",{}),$(this,"lossRateWindowStats",[]),this.pc=i,this.options=s,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new SE(i=>{i({local:QG({},gR),remote:QG({},gR)})})}setVideoIsReady(i){this.videoIsReady=i}setVideoIsReady2(i,s){this.videoIsReady2[i]=s}getVideoIsReady(i){return this.videoIsReady2[i]||!1}setIsFirstAudioDecoded(i){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(i){this.lossRateWindowStats.push(i),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const s=this.lossRateWindowStats.length,l=["videoSend","audioSend","videoRecv","audioRecv"];let p=0,_=0,b=0,P=0;for(const x of l)i[x].forEach((H,B)=>{if(!this.lossRateWindowStats[s-1][x][B]||!this.lossRateWindowStats[0][x][B])return;const z=this.lossRateWindowStats[s-1][x][B].packets-this.lossRateWindowStats[0][x][B].packets,Wt=this.lossRateWindowStats[s-1][x][B].packetsLost-this.lossRateWindowStats[0][x][B].packetsLost;x==="videoSend"||x==="audioSend"?(p+=z,b+=Wt):(_+=z,P+=Wt),Number.isNaN(z)||Number.isNaN(z)?H.packetLostRate=0:H.packetLostRate=z<=0||Wt<=0?0:Wt/(z+Wt)});i.sendPacketLossRate=p<=0||b<=0?0:b/(p+b),i.recvPacketLossRate=_<=0||P<=0?0:P/(_+P)}}function $G(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function MQ(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?$G(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):$G(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}class UQ extends ML{constructor(){super(...arguments),$(this,"_stats",y0),$(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const i=await this._getStats(),s=this.statsResponsesToObjects(i);this._stats=fS(y0);const l=s.filter(_=>_.type==="ssrc");this.processSSRCStats(l);const p=s.find(_=>_.type==="VideoBwe");p&&this.processBandwidthStats(p),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(i){this._stats.bitrate={actualEncoded:Number(i.googActualEncBitrate),targetEncoded:Number(i.googTargetEncBitrate),retransmit:Number(i.googRetransmitBitrate),transmit:Number(i.googTransmitBitrate)},this._stats.sendBandwidth=Number(i.googAvailableSendBandwidth)}processSSRCStats(i){i.forEach(s=>{const l=s.id.includes("send");switch("".concat(s.mediaType,"_").concat(l?"send":"recv")){case"video_send":{const p=fS(YG);p.codec=s.googCodecName,p.adaptionChangeReason="none",s.googCpuLimitedResolution&&(p.adaptionChangeReason="cpu"),s.googBandwidthLimitedResolution&&(p.adaptionChangeReason="bandwidth"),p.avgEncodeMs=Number(s.googAvgEncodeMs),p.inputFrame={width:Number(s.googFrameWidthInput)||Number(s.googFrameWidthSent),height:Number(s.googFrameHeightInput)||Number(s.googFrameHeightSent),frameRate:Number(s.googFrameRateInput)},p.sentFrame={width:Number(s.googFrameWidthSent),height:Number(s.googFrameHeightSent),frameRate:Number(s.googFrameRateInput)},p.firsCount=Number(s.googFirReceived),p.nacksCount=Number(s.googNacksReceived),p.plisCount=Number(s.googPlisReceived),p.frameCount=Number(s.framesEncoded),p.bytes=Number(s.bytesSent),p.packets=Number(s.packetsSent),p.packetsLost=Number(s.packetsLost),p.ssrc=Number(s.ssrc),p.rttMs=Number(s.googRtt||0),this._stats.videoSend.push(p),this._stats.rtt=p.rttMs;break}case"video_recv":{const p=fS(HG),_=this.lastDecodeVideoReceiverStats.get(Number(s.ssrc));if(p.codec=s.googCodecName,p.targetDelayMs=Number(s.googTargetDelayMs),p.renderDelayMs=Number(s.googRenderDelayMs),p.currentDelayMs=Number(s.googCurrentDelayMs),p.minPlayoutDelayMs=Number(s.googMinPlayoutDelayMs),p.decodeMs=Number(s.googDecodeMs),p.maxDecodeMs=Number(s.googMaxDecodeMs),p.receivedFrame={width:Number(s.googFrameWidthReceived),height:Number(s.googFrameHeightReceived),frameRate:Number(s.googFrameRateReceived)},p.decodedFrame={width:Number(s.googFrameWidthReceived),height:Number(s.googFrameHeightReceived),frameRate:Number(s.googFrameRateDecoded)},p.decodeFrameRate=Number(s.googFrameRateDecoded),p.outputFrame={width:Number(s.googFrameWidthReceived),height:Number(s.googFrameHeightReceived),frameRate:Number(s.googFrameRateOutput)},p.jitterBufferMs=Number(s.googJitterBufferMs),p.firsCount=Number(s.googFirsSent),p.nacksCount=Number(s.googNacksSent),p.plisCount=Number(s.googPlisSent),p.framesDecodeCount=Number(s.framesDecoded),p.bytes=Number(s.bytesReceived),p.packets=Number(s.packetsReceived),p.packetsLost=Number(s.packetsLost),p.ssrc=Number(s.ssrc),p.packets>0&&!this.isFirstVideoReceived[p.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(p.ssrc),this.isFirstVideoReceived[p.ssrc]=!0),p.framesDecodeCount>0&&!this.isFirstVideoDecoded[p.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(p.ssrc,p.decodedFrame.width,p.decodedFrame.height),this.isFirstVideoDecoded[p.ssrc]=!0),_){const b=_.stats,P=Date.now()-_.lts;p.framesDecodeFreezeTime=b.framesDecodeFreezeTime,p.framesDecodeInterval=b.framesDecodeInterval,p.framesDecodeCount>b.framesDecodeCount&&this.isFirstVideoDecoded[p.ssrc]?(_.lts=Date.now(),p.framesDecodeInterval=P,p.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(s.ssrc,10))?p.framesDecodeFreezeTime+=p.framesDecodeInterval:this.setVideoIsReady2(parseInt(s.ssrc,10),!0))):p.framesDecodeCount<_.stats.framesDecodeCount&&(p.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(p.ssrc,{stats:MQ({},p),lts:Date.now()}),this._stats.videoRecv.push(p);break}case"audio_recv":{const p=fS(JG);p.codec=s.googCodecName,p.outputLevel=Math.abs(Number(s.audioOutputLevel))/32767,p.decodingCNG=Number(s.googDecodingCNG),p.decodingCTN=Number(s.googDecodingCTN),p.decodingCTSG=Number(s.googDecodingCTSG),p.decodingNormal=Number(s.googDecodingNormal),p.decodingPLC=Number(s.googDecodingPLC),p.decodingPLCCNG=Number(s.googDecodingPLCCNG),p.expandRate=Number(s.googExpandRate),p.accelerateRate=Number(s.googAccelerateRate),p.preemptiveExpandRate=Number(s.googPreemptiveExpandRate),p.secondaryDecodedRate=Number(s.googSecondaryDecodedRate),p.speechExpandRate=Number(s.googSpeechExpandRate),p.preferredJitterBufferMs=Number(s.googPreferredJitterBufferMs),p.jitterBufferMs=Number(s.googJitterBufferMs),p.jitterMs=Number(s.googJitterReceived),p.bytes=Number(s.bytesReceived),p.packets=Number(s.packetsReceived),p.packetsLost=Number(s.packetsLost),p.ssrc=Number(s.ssrc),p.receivedFrames=Number(s.googDecodingCTN)||Number(s.packetsReceived),p.droppedFrames=Number(s.googDecodingPLC)+Number(s.googDecodingPLCCNG)||Number(s.packetsLost),p.receivedFrames>0&&!this.isFirstAudioReceived[p.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(p.ssrc),this.isFirstAudioReceived[p.ssrc]=!0),p.decodingNormal>0&&!this.isFirstAudioDecoded[p.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(p.ssrc),this.isFirstAudioDecoded[p.ssrc]=!0),this._stats.audioRecv.push(p);break}case"audio_send":{const p=fS(zG);p.codec=s.googCodecName,p.inputLevel=Math.abs(Number(s.audioInputLevel))/32767,p.aecReturnLoss=Number(s.googEchoCancellationReturnLoss||0),p.aecReturnLossEnhancement=Number(s.googEchoCancellationReturnLossEnhancement||0),p.residualEchoLikelihood=Number(s.googResidualEchoLikelihood||0),p.residualEchoLikelihoodRecentMax=Number(s.googResidualEchoLikelihoodRecentMax||0),p.bytes=Number(s.bytesSent),p.packets=Number(s.packetsSent),p.packetsLost=Number(s.packetsLost),p.ssrc=Number(s.ssrc),p.rttMs=Number(s.googRtt||0),this._stats.rtt=p.rttMs,this._stats.audioSend.push(p);break}}})}_getStats(){return new SE((i,s)=>{this.pc.getStats(i,s)})}statsResponsesToObjects(i){const s=[];return i.result().forEach(l=>{const p={id:l.id,timestamp:l.timestamp.valueOf().toString(),type:l.type};l.names().forEach(_=>{p[_]=l.stat(_)}),s.push(p)}),s}}function ZG(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function XR(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?ZG(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):ZG(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}class t4 extends ML{constructor(){super(...arguments),$(this,"_stats",y0),$(this,"report",void 0),$(this,"lastDecodeVideoReceiverStats",new Map),$(this,"lastVideoFramesRecv",new Map),$(this,"lastVideoFramesSent",new Map),$(this,"lastVideoFramesDecode",new Map),$(this,"lastVideoJBDelay",new Map),$(this,"lastAudioJBDelay",new Map),$(this,"mediaBytesSent",new Map),$(this,"mediaBytesRetransmit",new Map),$(this,"mediaBytesTargetEncode",new Map),$(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=fS(y0),this.report.forEach(i=>{switch(i.type){case UT.OUTBOUND:i.mediaType==="audio"?this.processAudioOutboundStats(i):i.mediaType==="video"&&this.processVideoOutboundStats(i);break;case UT.INBOUND:i.mediaType==="audio"?this.processAudioInboundStats(i):i.mediaType==="video"&&this.processVideoInboundStats(i);break;case UT.TRANSPORT:{const s=this.report.get(i.selectedCandidatePairId);s&&this.processCandidatePairStats(s);break}case UT.CANDIDATE_PAIR:i.selected&&this.processCandidatePairStats(i)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const i=await this.pc.getStats(),s={local:XR({},gR),remote:XR({},gR)};return i.forEach(l=>{let p;if(l.type===UT.TRANSPORT&&(p=i.get(l.selectedCandidatePairId)),l.type===UT.CANDIDATE_PAIR&&l.selected&&(p=l),p){const _=(b,P)=>{b.type=P.type,b.id=P.id,P.address&&(b.address=P.address),P.candidateType&&(b.candidateType=P.candidateType),P.port&&(b.port=P.port),P.priority&&(b.priority=P.priority),P.protocol&&(b.protocol=P.protocol),P.relayProtocol&&(b.relayProtocol=P.relayProtocol)};if(p.localCandidateId){const b=i.get(p.localCandidateId);b&&_(s.local,b)}if(p.remoteCandidateId){const b=i.get(p.remoteCandidateId);b&&_(s.remote,b)}}}),s}processCandidatePairStats(i){if(this._stats.sendBandwidth=i.availableOutgoingBitrate||0,i.currentRoundTripTime&&(this._stats.rtt=1e3*i.currentRoundTripTime),this._stats.videoSend.forEach(s=>{i.currentRoundTripTime&&(s.rttMs=1e3*i.currentRoundTripTime)}),this._stats.audioSend.forEach(s=>{i.currentRoundTripTime&&(s.rttMs=1e3*i.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=i.id,i.localCandidateId){const s=this.report.get(i.localCandidateId);s&&this.processCandidateStats(s)}if(i.remoteCandidateId){const s=this.report.get(i.remoteCandidateId);s&&this.processCandidateStats(s)}}processCandidateStats(i){let s;i.type===UT.LOCAL_CANDIDATE&&(s=this._stats.selectedCandidatePair.localCandidate),i.type===UT.REMOTE_CANDIDATE&&(s=this._stats.selectedCandidatePair.remoteCandidate),s&&(s.type=i.type,s.id=i.id,i.address&&(s.address=i.address),i.candidateType&&(s.candidateType=i.candidateType),i.port&&(s.port=i.port),i.priority&&(s.priority=i.priority),i.protocol&&(s.protocol=i.protocol),i.relayProtocol&&(s.relayProtocol=i.relayProtocol),i.type===UT.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==s.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(XR({},s),XR({},this.stats.selectedCandidatePair.localCandidate)),i.type===UT.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==s.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(XR({},s),XR({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(i){let s=this._stats.audioRecv.find(l=>l.ssrc===i.ssrc);s||(s=fS(JG),this._stats.audioRecv.push(s)),s.ssrc=i.ssrc,s.packets=i.packetsReceived,s.packetsLost=i.packetsLost,s.bytes=i.bytesReceived,s.jitterMs=1e3*i.jitter,this.processAudioTrackReceiverStats(i,i.trackId,s),i.codecId&&(s.codec=this.getCodecFromCodecStats(i.codecId)),s.receivedFrames||(s.receivedFrames=i.packetsReceived),s.droppedFrames||(s.droppedFrames=i.packetsLost),s.receivedFrames>0&&!this.isFirstAudioReceived[s.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(s.ssrc),this.isFirstAudioReceived[s.ssrc]=!0),s.outputLevel&&s.outputLevel>0&&!this.isFirstAudioDecoded[s.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(s.ssrc),this.isFirstAudioDecoded[s.ssrc]=!0),typeof i.concealedSamples=="number"&&(s.concealedSamples=i.concealedSamples)}processVideoInboundStats(i){let s=this._stats.videoRecv.find(b=>b.ssrc===i.ssrc);s||(s=fS(HG),this._stats.videoRecv.push(s)),s.ssrc=i.ssrc,s.packets=i.packetsReceived,s.packetsLost=i.packetsLost,s.bytes=i.bytesReceived,s.firsCount=i.firCount,s.nacksCount=i.nackCount,s.plisCount=i.pliCount,s.framesDecodeCount=i.framesDecoded,s.totalInterFrameDelay=i.totalInterFrameDelay,s.totalSquaredInterFrameDelay=i.totalSquaredInterFrameDelay;const l=this.lastDecodeVideoReceiverStats.get(s.ssrc),p=this.lastVideoFramesDecode.get(s.ssrc),_=Date.now();if(s.framesDecodeCount>0&&!this.isFirstVideoDecoded[s.ssrc]){const b=s.decodedFrame?s.decodedFrame.width:0,P=s.decodedFrame?s.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(s.ssrc,b,P),this.isFirstVideoDecoded[s.ssrc]=!0}if(l){const b=l.stats,P=_-l.lts;s.framesDecodeFreezeTime=b.framesDecodeFreezeTime,s.framesDecodeInterval=b.framesDecodeInterval,!this.isFirstVideoDecoded[s.ssrc]&&P>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[s.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(s.ssrc),this.isFirstVideoDecodedTimeout[s.ssrc]=!0),s.framesDecodeCount>b.framesDecodeCount&&this.isFirstVideoDecoded[s.ssrc]?(l.lts=Date.now(),s.framesDecodeInterval=P,s.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(i.ssrc))?s.framesDecodeFreezeTime+=s.framesDecodeInterval:this.setVideoIsReady2(parseInt(i.ssrc,10),!0))):s.framesDecodeCount<b.framesDecodeCount&&(s.framesDecodeInterval=0),i.framesDecoded&&i.qpSum&&(l.stats.framesDecodeCount>i.framesDecoded?s.qpSumPerFrame=i.qpSum/i.framesDecoded:s.qpSumPerFrame=(i.qpSum-l.qpSum)/(i.framesDecoded-l.stats.framesDecodeCount))}p&&_-p.lts>=800?(s.decodeFrameRate=Math.round((s.framesDecodeCount-p.count)/((_-p.lts)/1e3)),this.lastVideoFramesDecode.set(s.ssrc,{count:s.framesDecodeCount,lts:_,rate:s.decodeFrameRate})):p?s.decodeFrameRate=p.rate:this.lastVideoFramesDecode.set(s.ssrc,{count:s.framesDecodeCount,lts:_,rate:0}),i.totalDecodeTime&&(s.decodeMs=1e3*i.totalDecodeTime),this.processVideoTrackReceiverStats(i,i.trackId,s),i.codecId&&(s.codec=this.getCodecFromCodecStats(i.codecId)),i.framerateMean&&(s.framesRateFirefox=i.framerateMean),s.packets>0&&!this.isFirstVideoReceived[s.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(s.ssrc),this.isFirstVideoReceived[s.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(s.ssrc,{stats:XR({},s),lts:l?l.lts:Date.now(),qpSum:i.qpSum})}processVideoOutboundStats(i){let s=this._stats.videoSend.find(p=>p.ssrc===i.ssrc);s||(s=fS(YG),this._stats.videoSend.push(s));const l=this.mediaBytesSent.get(i.ssrc);if(l)l.add(i.bytesSent);else{const p=new LL(10);p.add(i.bytesSent),this.mediaBytesSent.set(i.ssrc,p)}if(i.retransmittedBytesSent!==void 0){const p=this.mediaBytesRetransmit.get(i.ssrc);if(p)p.add(i.retransmittedBytesSent);else{const _=new LL(10);_.add(i.retransmittedBytesSent),this.mediaBytesRetransmit.set(i.ssrc,_)}}if(i.totalEncodedBytesTarget){const p=this.mediaBytesTargetEncode.get(i.ssrc);if(p)p.add(i.totalEncodedBytesTarget);else{const _=new LL(10);_.add(i.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(i.ssrc,_)}}if(s.ssrc=i.ssrc,s.bytes=i.bytesSent,s.packets=i.packetsSent,s.firsCount=i.firCount,s.nacksCount=i.nackCount,s.plisCount=i.pliCount,s.frameCount=i.framesEncoded,s.adaptionChangeReason=i.qualityLimitationReason,s.scalabilityMode=i.scalabilityMode,i.totalEncodeTime&&i.framesEncoded){const p=this.lastEncoderMs.get(i.ssrc);if(!p||p.lastFrameCount>i.framesEncoded)s.avgEncodeMs=1e3*i.totalEncodeTime/i.framesEncoded;else{const _=i.framesEncoded-p.lastFrameCount,b=i.totalEncodeTime-p.lastEncoderTime;s.avgEncodeMs=1e3*b/_}}if(i.framesEncoded&&i.qpSum){const p=this.lastEncoderMs.get(i.ssrc);!p||p.lastFrameCount>i.framesEncoded?s.qpSumPerFrame=i.qpSum/i.framesEncoded:s.qpSumPerFrame=(i.qpSum-p.lastQpSum)/(i.framesEncoded-p.lastFrameCount)}if(this.lastEncoderMs.set(i.ssrc,{lastFrameCount:i.framesEncoded,lastEncoderTime:i.totalEncodeTime,lastQpSum:i.qpSum,lts:Date.now()}),i.codecId&&(s.codec=this.getCodecFromCodecStats(i.codecId)),i.mediaSourceId&&this.processVideoMediaSource(i.mediaSourceId,s),this.processVideoTrackSenderStats(i,i.trackId,s),i.remoteId)this.processRemoteInboundStats(i.remoteId,s);else{const p=this.findRemoteStatsId(i.ssrc,UT.REMOTE_INBOUND);p&&this.processRemoteInboundStats(p,s)}}processAudioOutboundStats(i){let s=this._stats.audioSend.find(l=>l.ssrc===i.ssrc);if(s||(s=fS(zG),this._stats.audioSend.push(s)),s.ssrc=i.ssrc,s.packets=i.packetsSent,s.bytes=i.bytesSent,i.mediaSourceId&&this.processAudioMediaSource(i.mediaSourceId,s),i.codecId&&(s.codec=this.getCodecFromCodecStats(i.codecId)),this.processAudioTrackSenderStats(i,i.trackId,s),i.remoteId)this.processRemoteInboundStats(i.remoteId,s);else{const l=this.findRemoteStatsId(i.ssrc,UT.REMOTE_INBOUND);l&&this.processRemoteInboundStats(l,s)}}findRemoteStatsId(i,s){var l;const p=Array.from(LS(l=this.report).call(l)).find(_=>_.type===s&&_.ssrc===i);return p?p.id:null}processVideoMediaSource(i,s){const l=this.report.get(i);l&&l.width&&l.height&&l.framesPerSecond&&(s.inputFrame={width:l.width,height:l.height,frameRate:l.framesPerSecond})}processAudioMediaSource(i,s){const l=this.report.get(i);l&&(s.inputLevel=l.audioLevel)}processVideoTrackSenderStats(i,s,l){var p,_,b;const P=s?this.report.get(s):void 0,x=(p=P==null?void 0:P.framesSent)!==null&&p!==void 0?p:i.framesSent;let H=(_=P==null?void 0:P.frameWidth)!==null&&_!==void 0?_:i.frameWidth,B=(b=P==null?void 0:P.frameHeight)!==null&&b!==void 0?b:i.frameHeight;if(typeof x!="number")return;typeof H=="number"&&typeof B=="number"||(H=0,B=0);let z=0;const Wt=Date.now(),_r=this.lastVideoFramesSent.get(l.ssrc);_r&&Wt-_r.lts>=800?(z=Math.round((x-_r.count)/((Wt-_r.lts)/1e3)),this.lastVideoFramesSent.set(l.ssrc,{count:x,lts:Wt,rate:z})):_r?z=_r.rate:this.lastVideoFramesSent.set(l.ssrc,{count:x,lts:Wt,rate:0}),l.sentFrame={width:H,height:B,frameRate:Math.max(0,z)}}processVideoTrackReceiverStats(i,s,l){var p,_,b,P,x;const H=s?this.report.get(s):void 0,B=(p=H==null?void 0:H.framesReceived)!==null&&p!==void 0?p:i.framesReceived,z=(_=H==null?void 0:H.frameWidth)!==null&&_!==void 0?_:i.frameWidth,Wt=(b=H==null?void 0:H.frameHeight)!==null&&b!==void 0?b:i.frameHeight,_r=(P=H==null?void 0:H.jitterBufferDelay)!==null&&P!==void 0?P:i.jitterBufferDelay,Di=(x=H==null?void 0:H.jitterBufferEmittedCount)!==null&&x!==void 0?x:i.jitterBufferEmittedCount;if(typeof B=="number"){const Fi=this.lastVideoFramesRecv.get(l.ssrc),Gi=Date.now();l.framesReceivedCount=B;let _p=0;Fi&&Gi-Fi.lts>=800?(_p=Math.round((B-Fi.count)/((Gi-Fi.lts)/1e3)),this.lastVideoFramesRecv.set(l.ssrc,{count:B,lts:Gi,rate:_p})):Fi?_p=Fi.rate:this.lastVideoFramesRecv.set(l.ssrc,{count:B,lts:Gi,rate:0}),l.receivedFrame={width:z||0,height:Wt||0,frameRate:_p||0},l.decodedFrame={width:z||0,height:Wt||0,frameRate:l.decodeFrameRate||0},l.outputFrame={width:z||0,height:Wt||0,frameRate:l.decodeFrameRate||0}}if(_r&&Di){let Fi=this.lastVideoJBDelay.get(l.ssrc);this.lastVideoJBDelay.set(l.ssrc,{jitterBufferDelay:_r,jitterBufferEmittedCount:Di}),Fi||(Fi={jitterBufferDelay:0,jitterBufferEmittedCount:0});const Gi=1e3*(_r-Fi.jitterBufferDelay)/(Di-Fi.jitterBufferEmittedCount);l.jitterBufferMs=Gi,l.currentDelayMs=Math.round(Gi)}}processAudioTrackSenderStats(i,s,l){var p,_,b,P;const x=s?this.report.get(s):void 0,H=(p=(_=x==null?void 0:x.echoReturnLoss)!==null&&_!==void 0?_:i.echoReturnLoss)!==null&&p!==void 0?p:0,B=(b=(P=x==null?void 0:x.echoReturnLossEnhancement)!==null&&P!==void 0?P:i.echoReturnLossEnhancement)!==null&&b!==void 0?b:0;l.aecReturnLoss=H,l.aecReturnLossEnhancement=B}processAudioTrackReceiverStats(i,s,l){var p,_,b,P,x,H,B;const z=s?this.report.get(s):void 0,Wt=(p=z==null?void 0:z.removedSamplesForAcceleration)!==null&&p!==void 0?p:i.removedSamplesForAcceleration,_r=(_=z==null?void 0:z.totalSamplesReceived)!==null&&_!==void 0?_:i.totalSamplesReceived,Di=(b=z==null?void 0:z.jitterBufferDelay)!==null&&b!==void 0?b:i.jitterBufferDelay,Fi=(P=z==null?void 0:z.jitterBufferEmittedCount)!==null&&P!==void 0?P:i.jitterBufferEmittedCount,Gi=(x=z==null?void 0:z.audioLevel)!==null&&x!==void 0?x:i==null?void 0:i.audioLevel,_p=(H=z==null?void 0:z.totalSamplesDuration)!==null&&H!==void 0?H:i==null?void 0:i.totalSamplesDuration,_f=(B=z==null?void 0:z.concealedSamples)!==null&&B!==void 0?B:i.concealedSamples;if(Wt&&_r&&(l.accelerateRate=Wt/_r),Di&&Fi){let RE=this.lastAudioJBDelay.get(l.ssrc);this.lastAudioJBDelay.set(l.ssrc,{jitterBufferDelay:Di,jitterBufferEmittedCount:Fi}),RE||(RE={jitterBufferDelay:0,jitterBufferEmittedCount:0});const dE=1e3*(Di-RE.jitterBufferDelay)/(Fi-RE.jitterBufferEmittedCount);l.jitterBufferMs=Math.round(dE)}l.outputLevel=Gi;let cE=1920;_p&&_r&&(cE=_r/_p/50,l.receivedFrames=Math.round(_r/cE)),_f&&(l.droppedFrames=Math.round(_f/cE))}processRemoteInboundStats(i,s){const l=this.report.get(i);l&&(s.packetsLost=l.packetsLost,l.roundTripTime&&(s.rttMs=1e3*l.roundTripTime))}getCodecFromCodecStats(i){const s=this.report.get(i);if(!s)return"";const l=s.mimeType.match(/\/(.*)$/);return l&&l[1]?l[1]:""}updateSendBitrate(){let i=0,s=null,l=null;this.mediaBytesSent.forEach(_=>{i+=_.diffMean()}),this.mediaBytesRetransmit.forEach(_=>{s=s===null?_.diffMean():s+_.diffMean()}),this.mediaBytesTargetEncode.forEach(_=>{l=l===null?_.diffMean():l+_.diffMean()});const p=s!==null?i-s:i;this._stats.bitrate={actualEncoded:8*p/(this.options.updateInterval/1e3),transmit:8*i/(this.options.updateInterval/1e3)},s!==null&&(this._stats.bitrate.retransmit=8*s/(this.options.updateInterval/1e3)),l!==null&&(this._stats.bitrate.targetEncoded=8*l/(this.options.updateInterval/1e3))}}class xQ extends ML{updateStats(){return SE.resolve()}}function UL(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const _=kQ();return _?_<76?new UQ(r,{updateInterval:i,lossRateInterval:s,freezeRateLimit:l,firstVideoDecodedTimeout:p}):new t4(r,{updateInterval:i,lossRateInterval:s,freezeRateLimit:l,firstVideoDecodedTimeout:p}):LQ(r)?new t4(r,{updateInterval:i,lossRateInterval:s,freezeRateLimit:l,firstVideoDecodedTimeout:p}):new xQ(r,{updateInterval:i,lossRateInterval:s,freezeRateLimit:l,firstVideoDecodedTimeout:p})}var h_;function e4(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function n4(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?e4(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):e4(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}let b0=(iE((h_=class I0 extends CO{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(i,s){super(i,s),$(this,"store",void 0),$(this,"peerConnection",void 0),$(this,"remoteSDP",void 0),$(this,"initialOffer",void 0),$(this,"statsFilter",void 0),$(this,"useRTX",!1),$(this,"localCapabilities",void 0),$(this,"localCandidateCount",0),$(this,"allCandidatesReceived",!1),$(this,"establishPromise",void 0),$(this,"mutex",new mT("P2PConnection-mutex")),this.store=s,this.peerConnection=new RTCPeerConnection(I0.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.statsFilter=UL(this.peerConnection,kc("STATS_UPDATE_INTERVAL"),void 0,A_()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const i=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=JR(i.sdp),l=NL(i.sdp,!this.useRTX,kc("FILTER_VIDEO_FEC"),kc("FILTER_AUDIO_FEC"),["opus"]);return this.localCapabilities=l,this.initialOffer=i,n4(n4({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:l},offerSDP:i.sdp})}catch(i){throw new _a(_i.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(i,s,l,p,_,b){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new PQ({remoteIceParameters:i,remoteDtlsParameters:s,candidates:l,remoteRTPCapabilities:p.send,remoteSetup:_,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:b});const P=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:P})}catch(P){throw new _a(_i.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(P.toString()))}}send(i,s){var l=this;return pS(function*(){const p=yield HE(l.mutex.lock());try{if(!l.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const _=i.map(Wt=>l.peerConnection.addTrack(Wt._mediaStreamTrack)),b=yield HE(l.peerConnection.createOffer()),P=W_.exports.parse(b.sdp),x=i.map(Wt=>{const _r=Wt._mediaStreamTrack,Di=P.mediaDescriptions.find(Fi=>Fi.attributes.mid===_r.kind);if(!Di)throw new Error("Cannot extract ssrc from mediaDescription.");return function(Fi,Gi,_p){const _f=Fi.attributes.ssrcs.filter(RE=>RE.attributes.label===Gi),cE=Fi.attributes.ssrcGroups;if(_f.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(cE&&_f.length>1){const RE=cE.find(dE=>dE.ssrcIds.indexOf(_f[0].ssrcId)!==-1);return RE?[{ssrcId:RE.ssrcIds[0],rtx:_p?RE.ssrcIds[1]:void 0}]:[{ssrcId:_f[0].ssrcId}]}return[{ssrcId:_f[0].ssrcId}]}(Di,_r.id,l.useRTX)});let H;try{H=yield x}catch(Wt){throw _.forEach(_r=>{pT()&&_r.replaceTrack(null),l.peerConnection.removeTrack(_r)}),Wt}const B=l.mungSendOfferSDP(b.sdp,i);l.remoteSDP.receive(i,s,H);const z=l.remoteSDP.toString();return yield HE(l.peerConnection.setLocalDescription({type:"offer",sdp:B})),yield HE(l.applySendEncodings(_,i)),yield HE(l.peerConnection.setRemoteDescription({type:"answer",sdp:z})),i.map((Wt,_r)=>{const Di=Wt._mediaStreamTrack.id;return{localSSRC:x[_r],id:Di}})}catch(_){throw new _a(_i.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(_.toString()))}finally{p()}})()}async stopSending(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(_=>{var b;return i.indexOf(((b=_.track)===null||b===void 0?void 0:b.id)||"")!==-1});if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(_=>{pT()&&_.replaceTrack(null),this.peerConnection.removeTrack(_)});const l=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(i);const p=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(s){throw new _a(_i.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(i,s,l,p){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{id:_,mslabel:b}=this.remoteSDP.send(i,s,p),P=new SE((B,z)=>{const Wt=setTimeout(()=>{z(new Error("Cannot receive track, id: ".concat(_)))},1e4),_r=Di=>{const Fi=i_();if((Fi.name==="Safari"&&Number(Fi.version)===11||fT())&&Di.track.id!==_&&Di.streams[0].id===b){var Gi;const _p=Di.streams[0].getTracks()[0];return(Gi=this.remoteSDP)===null||Gi===void 0||Gi.updateTrackLabel(i,_,Di.track.id),this.peerConnection.removeEventListener("track",_r),clearTimeout(Wt),void B(_p)}if(Di.track.id===_)return this.peerConnection.removeEventListener("track",_r),clearTimeout(Wt),void B(Di.track)};this.peerConnection.addEventListener("track",_r)}),x=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:x});const H=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(H),{track:await P,id:_}}catch(_){throw new _a(_i.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(_.toString()))}}async stopReceiving(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(i);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const l=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(l)}catch(s){throw new _a(_i.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(i){}async unmuteRemote(i){}async muteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(l=>{var p;return i.indexOf(((p=l.track)===null||p===void 0?void 0:p.id)||"")!==-1});if(s.length!==i.length)throw new Error("sender' length doesn't match mids' length.");s.map(l=>{if(pT()&&l.track)l.track.enabled=!1;else{const p=l.getParameters();p.encodings.forEach(_=>_.active=!1),l.setParameters(p)}})}catch(s){throw new _a(_i.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(_=>{var b;return i.indexOf(((b=_.track)===null||b===void 0?void 0:b.id)||"")!==-1});if(s.length!==i.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async _=>{if(pT()&&_.track)_.track.enabled=!0;else{const b=_.getParameters();b.encodings.forEach(P=>P.active=!0),await _.setParameters(b)}});const l=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(l);const p=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:p})}catch(s){throw new _a(_i.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(i){var s=this;return pS(function*(){const l=yield HE(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(M_().supportPCSetConfiguration){const x=s.peerConnection.getConfiguration(),H=i===Fg.RELAY?"relay":"all";x.iceTransportPolicy!==H&&(_e.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(x.iceTransportPolicy,"] to [").concat(H,"]")),x.iceTransportPolicy=H,s.peerConnection.setConfiguration(x))}else if(i===Fg.RELAY)return;i!==Fg.RELAY&&s.remoteSDP.updateCandidates(i);const p=yield HE(s.peerConnection.createOffer({iceRestart:!0}));if(!p.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const _=JR(p.sdp),{remoteIceParameters:b}=yield _.iceParameters;s.remoteSDP.restartICE(b);const P=s.remoteSDP.toString();yield HE(s.peerConnection.setLocalDescription(p)),yield HE(s.peerConnection.setRemoteDescription({type:"answer",sdp:P}))}catch(p){_e.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),p)}finally{l()}})()}close(){var i;this.peerConnection.close(),(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}async updateEncoderConfig(i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const l=await this.peerConnection.createOffer(),p=this.mungSendOfferSDP(l.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const _=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:p}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:_})}catch(l){throw new _a(_i.EXCHANGE_SDP_FAILED,l.toString())}}async updateSendParameters(i,s){const l=this.peerConnection.getSenders().filter(p=>{var _;return((_=p.track)===null||_===void 0?void 0:_.id)===i});l.length===1&&await this.applySendEncodings(l,[s])}setStatsRemoteVideoIsReady(i,s){this.statsFilter.setVideoIsReady2(i,s)}async replaceTrack(i,s){const l=this.peerConnection.getSenders().find(p=>{var _;return((_=p.track)===null||_===void 0?void 0:_.id)===s});l&&await l.replaceTrack(i._mediaStreamTrack)}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,_e.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,_e.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},kc("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const s={iceServers:[],sdpSemantics:"plan-b"};return i.iceServers?s.iceServers=i.iceServers:i.turnServer&&i.turnServer.mode!=="off"&&(i0(i.turnServer.servers)?s.iceServers=i.turnServer.servers:(s.iceServers&&s.iceServers.push(...I0.turnServerConfigToIceServers(i.turnServer.servers)),kc("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&i.turnServer.serversFromGateway&&s.iceServers.push(...I0.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(l=>{l.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(i){const s=[];return i.forEach(l=>{l.security?l.tcpport&&s.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=tcp")}):(l.udpport&&s.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.udpport,"?transport=udp")}),l.tcpport&&s.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=tcp")}))}),s}async applySendEncodings(i,s){try{if(!M_().supportSetRtpSenderParameters||i.length!==s.length)return;for(let p=0;p<i.length;p++){var l;const _=i[p],b=s[p];if(!b)continue;const P={},x={};if(b instanceof q_)switch(b._optimizationMode){case"motion":P.degradationPreference="maintain-framerate";break;case"detail":P.degradationPreference="maintain-resolution";break;default:P.degradationPreference="balanced"}if(kc("DSCP_TYPE")&&LR()){const z=kc("DSCP_TYPE");["very-low","low","medium","high"].includes(z)&&(x.networkPriority=z)}const H=_.getParameters(),B=(l=H.encodings)===null||l===void 0?void 0:l[0];B&&Object.assign(B,x),Object.assign(H,P),await _.setParameters(H)}}catch{_e.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(i,s){const l=W_.exports.parse(i);return s.forEach((p,_)=>{const b=p._mediaStreamTrack,P=l.mediaDescriptions.find(x=>x.attributes.mid===b.kind);P&&MI(P,p)}),W_.exports.print(l)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,s,l)=>{var p;(p=this.onFirstVideoDecoded)===null||p===void 0||p.call(this,i,s,l)},this.statsFilter.onSelectedLocalCandidateChanged=(i,s)=>{var l;(l=this.onSelectedLocalCandidateChanged)===null||l===void 0||l.call(this,i,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,s)=>{var l;(l=this.onSelectedRemoteCandidateChanged)===null||l===void 0||l.call(this,i,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(i).map((_,b)=>{let{id:P,mslabel:x}=_;const{kind:H}=i[b];return new SE((B,z)=>{const Wt=setTimeout(()=>{z(new Error("Cannot receive track, id: ".concat(P)))},1e4),_r=Di=>{const Fi=i_();if(Fi.name==="Safari"&&Number(Fi.version)===11&&Di.track.id!==P&&Di.streams[0].id===x){var Gi;const _p=Di.streams[0].getTracks()[0];return(Gi=this.remoteSDP)===null||Gi===void 0||Gi.updateTrackLabel(H,P,Di.track.id),this.peerConnection.removeEventListener("track",_r),clearTimeout(Wt),void B({track:_p,id:P})}if(Di.track.id===P)return this.peerConnection.removeEventListener("track",_r),clearTimeout(Wt),void B({track:Di.track,id:P})};this.peerConnection.addEventListener("track",_r)})}),l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const p=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(p),await SE.all(s)}catch(s){throw new _a(_i.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(i){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(i);return s==null?void 0:s[0].ssrcId}setConfiguration(i){if(M_().supportPCSetConfiguration){const s=I0.resolvePCConfiguration(i);this.peerConnection.setConfiguration(s)}}}).prototype,"connect",[rS],Object.getOwnPropertyDescriptor(h_.prototype,"connect"),h_.prototype),iE(h_.prototype,"stopSending",[rS],Object.getOwnPropertyDescriptor(h_.prototype,"stopSending"),h_.prototype),iE(h_.prototype,"receive",[rS],Object.getOwnPropertyDescriptor(h_.prototype,"receive"),h_.prototype),iE(h_.prototype,"stopReceiving",[rS],Object.getOwnPropertyDescriptor(h_.prototype,"stopReceiving"),h_.prototype),iE(h_.prototype,"muteRemote",[rS],Object.getOwnPropertyDescriptor(h_.prototype,"muteRemote"),h_.prototype),iE(h_.prototype,"unmuteRemote",[rS],Object.getOwnPropertyDescriptor(h_.prototype,"unmuteRemote"),h_.prototype),iE(h_.prototype,"muteLocal",[rS],Object.getOwnPropertyDescriptor(h_.prototype,"muteLocal"),h_.prototype),iE(h_.prototype,"unmuteLocal",[rS],Object.getOwnPropertyDescriptor(h_.prototype,"unmuteLocal"),h_.prototype),iE(h_.prototype,"close",[rS],Object.getOwnPropertyDescriptor(h_.prototype,"close"),h_.prototype),iE(h_.prototype,"updateEncoderConfig",[rS],Object.getOwnPropertyDescriptor(h_.prototype,"updateEncoderConfig"),h_.prototype),iE(h_.prototype,"updateSendParameters",[rS],Object.getOwnPropertyDescriptor(h_.prototype,"updateSendParameters"),h_.prototype),iE(h_.prototype,"replaceTrack",[rS],Object.getOwnPropertyDescriptor(h_.prototype,"replaceTrack"),h_.prototype),iE(h_.prototype,"getRemoteSSRC",[rS],Object.getOwnPropertyDescriptor(h_.prototype,"getRemoteSSRC"),h_.prototype),h_);function rS(r,i,s){const l=r[i];if(typeof l!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const p=this.mutex,_=await p.lock("Locking from P2PConnection.".concat(i));try{for(var b=arguments.length,P=new Array(b),x=0;x<b;x++)P[x]=arguments[x];return await l.apply(this,P)}finally{_()}},s}function r4(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function i4(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?r4(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):r4(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}const $O="9",o4=4e4;class jQ{get localCapabilities(){return G_(this._localCapabilities)}get rtpCapabilities(){return G_(this._rtpCapabilities)}get candidates(){return G_(this._candidates)}get iceParameters(){return G_(this._iceParameters)}get dtlsParameters(){return G_(this._dtlsParameters)}constructor(i){$(this,"sessionDesc",void 0),$(this,"_localCapabilities",void 0),$(this,"_rtpCapabilities",void 0),$(this,"_candidates",void 0),$(this,"_iceParameters",void 0),$(this,"_dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname",void 0),$(this,"firefoxSsrcMidMap",new Map),i=G_(i);const{remoteIceParameters:s,remoteDtlsParameters:l,candidates:p,remoteRTPCapabilities:_,remoteSetup:b,localCapabilities:P,cname:x}=i,H=W_.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=_,this._candidates=p,this._iceParameters=s,this._dtlsParameters=l,this._localCapabilities=P,this.setup=b,this.cname=x;const B=this.rtpCapabilities.send;for(const z of H.mediaDescriptions){if(z.attributes.iceUfrag=s.iceUfrag,z.attributes.icePwd=s.icePwd,z.attributes.fingerprints=l.fingerprints,z.attributes.candidates=p,z.attributes.setup=b,z.media.mediaType==="video"&&(z.media.fmts=B.videoCodecs.map(Wt=>Wt.payloadType.toString(10)),z.attributes.payloads=B.videoCodecs,z.attributes.extmaps=B.videoExtensions,kc("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:Wt,ssrcGroups:_r}=nS([{ssrcId:o4,rtx:kc("USE_SUB_RTX")?40001:void 0}],this.cname);z.attributes.ssrcs=Wt,z.attributes.ssrcGroups=_r}if(z.media.mediaType==="audio"&&(z.media.fmts=B.audioCodecs.map(Wt=>Wt.payloadType.toString(10)),z.attributes.payloads=B.audioCodecs,z.attributes.extmaps=B.audioExtensions,mR(z),kc("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:Wt,ssrcGroups:_r}=nS([{ssrcId:2e4}],this.cname);z.attributes.ssrcs=Wt,z.attributes.ssrcGroups=_r}}this.sessionDesc=H,this.currentMidIndex=H.mediaDescriptions.length-1}preloadRemoteMedia(){const i=kc("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const s=this.candidates,l=this.dtlsParameters,p=this.iceParameters,_=this.rtpCapabilities.send;for(let b=1;b<i;b++){const P=2*b+2e4,x=2*b+o4,{ssrcs:H,ssrcGroups:B}=nS([{ssrcId:P}],this.cname),{ssrcs:z,ssrcGroups:Wt}=nS([{ssrcId:x,rtx:kc("USE_SUB_RTX")?x+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:$O,protos:["UDP","TLS","RTP","SAVPF"],fmts:_.videoCodecs.map(_r=>_r.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:p.iceUfrag,icePwd:p.icePwd,unrecognized:[],candidates:s,extmaps:_.videoExtensions,fingerprints:l.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:z,ssrcGroups:Wt,rtcpFeedbackWildcards:[],payloads:_.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*b)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:$O,protos:["UDP","TLS","RTP","SAVPF"],fmts:_.audioCodecs.map(_r=>_r.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:p.iceUfrag,icePwd:p.icePwd,unrecognized:[],candidates:s,extmaps:_.audioExtensions,fingerprints:l.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:H,ssrcGroups:B,rtcpFeedbackWildcards:[],payloads:_.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*b+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return W_.exports.print(this.sessionDesc)}send(i,s,l,p){const{ssrcs:_,ssrcGroups:b}=nS(s,this.cname,kc("SYNC_GROUP")?l:void 0),P=this.findPreloadMediaDesc(_);if(P){if(A_()&&this.firefoxSsrcMidMap.set(_[0].ssrcId,P.attributes.mid),p&&(p.twcc||p.remb)){const x=this.sessionDesc.mediaDescriptions.indexOf(P);return this.sessionDesc.mediaDescriptions[x]=this.mungSendMediaDesc(P,p),{mid:P.attributes.mid,needExchangeSDP:!0}}return{mid:P.attributes.mid,needExchangeSDP:!1}}{const x=this.findAvailableMediaIndex(i,_);let H;return x===-1||x===1&&(pT()||n2())||x===0&&kc("USE_SUB_RTX")||r2()?(H=this.createOrRecycleSendMedia(i,_,b,"sendonly",p),this.updateBundleMids()):(H=G_(this.sessionDesc.mediaDescriptions[x]),H.attributes.direction="sendonly",H.attributes.ssrcs=_,H.attributes.ssrcGroups=b,this.sessionDesc.mediaDescriptions[x]=this.mungSendMediaDesc(H,p)),A_()&&this.firefoxSsrcMidMap.set(_[0].ssrcId,H.attributes.mid),{mid:H.attributes.mid,needExchangeSDP:!0}}}batchSend(i){const s=i.map(_=>{let{kind:b,ssrcMsg:P,mslabel:x}=_;return this.send(b,P,x)}),l=[];let p=!1;return s.forEach(_=>{let{mid:b,needExchangeSDP:P}=_;P&&(p=!0),l.push(b)}),{mids:l,needExchangeSDP:p}}stopSending(i){const s=this.sessionDesc.mediaDescriptions.filter(l=>l.attributes.mid&&i.indexOf(l.attributes.mid)!==-1);if(s.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");s.forEach(l=>{l.attributes.mid==="0"||A_()||r2()?l.attributes.ssrcs=[]:(l.attributes.ssrcs=[],l.attributes.direction="inactive",l.media.port="0")}),this.updateBundleMids()}mute(i){const s=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===i);if(!s)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(i){const s=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===i);if(!s)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}muteRemote(i){const s=this.sessionDesc.mediaDescriptions.filter(l=>i.includes(l.attributes.mid||""));if(s.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");s.forEach(l=>{l.attributes.direction="inactive"})}unmuteRemote(i){const s=this.sessionDesc.mediaDescriptions.filter(l=>i.includes(l.attributes.mid||""));if(s.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");s.forEach(l=>{l.attributes.direction="recvonly"})}receive(i,s,l,p){i.forEach((_,b)=>{this.createOrRecycleRecvMedia(_,[],"recvonly",s,l,p[b])}),this.updateBundleMids()}stopReceiving(i){const s=this.sessionDesc.mediaDescriptions.filter(l=>i.indexOf(l.attributes.mid)!==-1);if(s.length!==i.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");s.forEach(l=>{l.media.port="0",l.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(i){i===Fg.TCP?this._candidates.forEach(s=>{this._candidates.findIndex(l=>l.transport==="tcp"&&l.connectionAddress===s.connectionAddress&&l.port===s.port)===-1&&this._candidates.push(i4(i4({},s),{},{foundation:"tcpcandidate",priority:Number(s.priority)-1+"",transport:"tcp",port:Number(s.port)+90+""}))}):this._candidates=this._candidates.filter(s=>s.transport!=="tcp");for(const s of this.sessionDesc.mediaDescriptions)s.attributes.candidates=this.candidates}restartICE(i){i=G_(i),this._iceParameters=i,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=i.iceUfrag,s.attributes.icePwd=i.icePwd})}predictReceivingMids(i){const s=[];for(let l=0;l<i;l++)s.push((this.currentMidIndex+l+1).toString(10));return s}findAvailableMediaIndex(i,s){return this.sessionDesc.mediaDescriptions.findIndex(l=>{const p=l.media.mediaType===i&&l.media.port!=="0"&&(l.attributes.direction==="sendonly"||l.attributes.direction==="sendrecv")&&l.attributes.ssrcs.length===0;if(A_()){if(p){const _=this.firefoxSsrcMidMap.get(s[0].ssrcId);return!(_||l.attributes.mid!=="0"&&l.attributes.mid!=="1")||!(!_||_!==l.attributes.mid)}return!1}return p})}createOrRecycleRecvMedia(i,s,l,p,_,b){const P=i._mediaStreamTrack.kind,x=this.rtpCapabilities.recv,H=this.localCapabilities.send;let B=[];if(P===VE.VIDEO){var z,Wt;if(kc("H264_PROFILE_LEVEL_ID")&&p==="h264"&&(B=x.videoCodecs.filter(_p=>{var _f,cE;return(((_f=_p.rtpMap)===null||_f===void 0?void 0:_f.encodingName.toLowerCase())||"").includes(p)&&(_p==null||(cE=_p.fmtp)===null||cE===void 0?void 0:cE.parameters["profile-level-id"])===kc("H264_PROFILE_LEVEL_ID")})),!B||((z=B)===null||z===void 0?void 0:z.length)===0){const _p=H.videoCodecs.filter(_f=>{var cE;return(((cE=_f.rtpMap)===null||cE===void 0?void 0:cE.encodingName.toLowerCase())||"").includes(p)});_p.length!==0&&(B=x.videoCodecs.filter(_f=>_p.some(cE=>cE.payloadType===_f.payloadType)))}if(kc("USE_PUB_RTX")){const _p=B.map(cE=>cE.payloadType.toString()),_f=x.videoCodecs.filter(cE=>{var RE,dE;return((RE=cE.rtpMap)===null||RE===void 0?void 0:RE.encodingName)==="rtx"&&_p.includes(((dE=cE.fmtp)===null||dE===void 0?void 0:dE.parameters.apt)||"")});B=[...B,..._f]}B.length===0&&(_e.warning("codec ".concat(p," not included in rtpCapabilities, fallback to default payloads: ").concat((Wt=x.videoCodecs[0].rtpMap)===null||Wt===void 0?void 0:Wt.encodingName)),B=x.videoCodecs)}else B=x.audioCodecs.filter(_p=>{var _f;return(((_f=_p.rtpMap)===null||_f===void 0?void 0:_f.encodingName.toLowerCase())||"").includes(_)}),B.length===0&&(_e.warning("codec ".concat(_," not included in rtpCapabilities, fallback to opus")),B=x.audioCodecs.filter(_p=>{var _f;return(((_f=_p.rtpMap)===null||_f===void 0?void 0:_f.encodingName.toLowerCase())||"").includes("opus")}));const _r=P===VE.VIDEO?x.videoExtensions:x.audioExtensions;this.currentMidIndex+=1;const Di="".concat(this.currentMidIndex);let Fi={media:{mediaType:P,port:$O,protos:["UDP","TLS","RTP","SAVPF"],fmts:B.map(_p=>_p.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:_r,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:s,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:B,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:l,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Di)}};Fi=this.mungRecvMediaDsec(Fi,i,b);const Gi=this.findFirstClosedMedia(P);if(Gi){const _p=this.sessionDesc.mediaDescriptions.indexOf(Gi);this.sessionDesc.mediaDescriptions[_p]=Fi}else this.sessionDesc.mediaDescriptions.push(Fi);return Fi}createOrRecycleSendMedia(i,s,l,p,_){const b=this.rtpCapabilities.send,P=i===VE.VIDEO?b.videoCodecs:b.audioCodecs,x=i===VE.VIDEO?b.videoExtensions:b.audioExtensions;this.currentMidIndex+=1;const H="".concat(this.currentMidIndex);let B={media:{mediaType:i,port:$O,protos:["UDP","TLS","RTP","SAVPF"],fmts:P.map(Wt=>Wt.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:x,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:s,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:P,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:p,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(H)}};B=this.mungSendMediaDesc(B,_);const z=this.findFirstClosedMedia(i);if(z){const Wt=this.sessionDesc.mediaDescriptions.indexOf(z);this.sessionDesc.mediaDescriptions[Wt]=B}else this.sessionDesc.mediaDescriptions.push(B);return B}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(i=>i.media.port!=="0").map(i=>i.attributes.mid)}mungRecvMediaDsec(i,s,l){const p=G_(i);return DL(p),MI(p,s),PL(p,s),FG(p),XO(p,l,this.localCapabilities.send),p}mungSendMediaDesc(i,s){const l=G_(i);return XO(l,s,this.localCapabilities.recv),mR(l),l}updateRecvMedia(i,s){const l=this.sessionDesc.mediaDescriptions.findIndex(p=>p.attributes.mid===i);if(l!==-1){const p=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],s);this.sessionDesc.mediaDescriptions[l]=p}}bumpMid(i){this.currentMidIndex+=i}findFirstClosedMedia(i){return this.sessionDesc.mediaDescriptions.find(s=>A_()?s.media.port==="0"&&s.media.mediaType===i:s.media.port==="0")}findPreloadMediaDesc(i){return this.sessionDesc.mediaDescriptions.find(s=>{var l,p;return((l=s.attributes)===null||l===void 0||(p=l.ssrcs[0])===null||p===void 0?void 0:p.ssrcId)===i[0].ssrcId})}getSSRC(i){var s;return(s=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===i))===null||s===void 0?void 0:s.attributes.ssrcs}}var p_;function s4(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function UI(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?s4(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):s4(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}let $S=(iE((p_=class O0 extends CO{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var i,s,l;return(i=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(l=s.transport)===null||l===void 0?void 0:l.state)!==null&&i!==void 0?i:null}constructor(i,s){super(i,s),$(this,"store",void 0),$(this,"peerConnection",void 0),$(this,"remoteSDP",void 0),$(this,"initialOffer",void 0),$(this,"transportEventReceiver",void 0),$(this,"statsFilter",void 0),$(this,"localCapabilities",void 0),$(this,"localCandidateCount",0),$(this,"allCandidatesReceived",!1),$(this,"selectedCandidatePairTimer",void 0),$(this,"establishPromise",void 0),$(this,"mutex",new mT("P2PConnection-mutex")),this.store=s,this.peerConnection=new RTCPeerConnection(O0.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.statsFilter=UL(this.peerConnection,kc("STATS_UPDATE_INTERVAL"),void 0,A_()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=JR(i.sdp),l=await GG(!kc("USE_PUB_RTX")&&!kc("USE_SUB_RTX"),kc("FILTER_VIDEO_FEC"),kc("FILTER_AUDIO_FEC"));return this.localCapabilities=kL(l),this.initialOffer=i,UI(UI({},s),{},{rtpCapabilities:l,offerSDP:i.sdp})}catch(i){throw new _a(_i.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(i,s,l,p,_,b){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new jQ({remoteIceParameters:i,remoteDtlsParameters:s,candidates:l,remoteRTPCapabilities:p,remoteSetup:_,localCapabilities:this.localCapabilities,cname:b});const P=this.remoteSDP.toString(),x=W_.exports.parse(this.initialOffer.sdp),H=x.mediaDescriptions.find(_r=>_r.media.mediaType==="audio");H&&mR(H);const B=W_.exports.print(x),z=this.logSDPExchange(B||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:B}),z==null||z(P),await this.peerConnection.setRemoteDescription({type:"answer",sdp:P});const Wt=this.peerConnection.getTransceivers()[0];if(Wt!=null&&Wt.receiver&&this.tryBindTransportEvents(Wt.receiver),kc("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const _r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_r});const Di=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(Di)}}catch(P){throw new _a(_i.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(P.toString()))}}send(i,s,l){var p=this;return pS(function*(){const _=yield HE(p.mutex.lock("From P2PConnection.send"));try{if(!p.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const b=[];i.forEach(Fi=>{const Gi=p.peerConnection.addTransceiver(Fi._mediaStreamTrack,{direction:"sendonly"});b.push(Gi),Fi._updateRtpTransceiver(Gi)}),A_()&&kc("SIMULCAST")===!0&&(yield HE(p.applySimulcastForFirefox(b,i)));const P=yield HE(p.peerConnection.createOffer()),x=p.remoteSDP.predictReceivingMids(i.length),H=p.mungSendOfferSDP(P.sdp,i,x),B=W_.exports.parse(H),z=x.map(Fi=>{const Gi=B.mediaDescriptions.find(_p=>_p.attributes.mid===Fi);if(!Gi)throw new Error("Cannot extract ssrc from mediaDescription.");return jG(Gi,kc("USE_PUB_RTX"))});let Wt;try{Wt=yield z}catch(Fi){Wt=[],p.remoteSDP.receive(i,s,l,Wt);const Gi=p.remoteSDP.toString();throw yield HE(p.peerConnection.setLocalDescription({type:"offer",sdp:H})),yield HE(p.peerConnection.setRemoteDescription({type:"answer",sdp:Gi})),yield HE(p.stopSending(x,!0)),Fi}p.remoteSDP.receive(i,s,l,Wt);const _r=p.remoteSDP.toString(),Di=p.logSDPExchange(H,"offer","local","send");return yield HE(p.peerConnection.setLocalDescription({type:"offer",sdp:H})),yield HE(p.applySimulcastEncodings(b,i)),yield HE(p.applySendEncodings(b,i)),Di==null||Di(_r),yield HE(p.peerConnection.setRemoteDescription({type:"answer",sdp:_r})),b.map((Fi,Gi)=>{const _p=x[Gi];return{localSSRC:z[Gi],id:_p,transceiver:Fi}})}catch(b){throw b instanceof _a?b:new _a(_i.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(b.toString()))}finally{_()}})()}async stopSending(i,s){const l=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const p=this.peerConnection.getTransceivers().filter(x=>i.indexOf(x.mid)!==-1);if(p.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");p.map(x=>{var H;x.direction="inactive",(H=x.stop)===null||H===void 0||H.call(x)});const _=await this.peerConnection.createOffer(),b=this.logSDPExchange(_.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(_),this.remoteSDP.stopReceiving(i);const P=this.remoteSDP.toString();b==null||b(P),await this.peerConnection.setRemoteDescription({type:"answer",sdp:P})}catch(p){throw new _a(_i.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(p.toString()))}finally{l&&l()}}async receive(i,s,l,p){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:_,needExchangeSDP:b}=this.remoteSDP.send(i,s,l,p);if(b){const x=this.remoteSDP.toString(),H=this.logSDPExchange(x,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:x});const B=await this.peerConnection.createAnswer(),z=this.mungReceiveAnswerSDP(B.sdp,_,i);H==null||H(z||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:z}),_e.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."))}else _e.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(i," no need to exchange SDP."));const P=this.peerConnection.getTransceivers().find(x=>x.mid===_);if(!P)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:P.receiver.track,id:_,transceiver:P}}catch(_){throw new _a(_i.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(_.toString()))}}async batchReceive(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:l}=this.remoteSDP.batchSend(i);if(l){const p=this.remoteSDP.toString(),_=this.logSDPExchange(p,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:p});const b=await this.peerConnection.createAnswer();_==null||_(b.sdp||""),await this.peerConnection.setLocalDescription(b),_e.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else _e.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return s.map(p=>{const _=this.peerConnection.getTransceivers().find(b=>b.mid===p);if(!_)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:_.receiver.track,id:p,transceiver:_}})}catch(s){throw new _a(_i.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(i);const s=this.remoteSDP.toString(),l=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const p=await this.peerConnection.createAnswer();l==null||l(p.sdp||""),await this.peerConnection.setLocalDescription(p)}catch(s){throw new _a(_i.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(i," before remote SDP created."));this.remoteSDP.mute(i);const s=this.remoteSDP.toString(),l=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const p=await this.peerConnection.createAnswer();l==null||l(p.sdp||""),await this.peerConnection.setLocalDescription(p)}catch(s){throw new _a(_i.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(i," before remote SDP created."));this.remoteSDP.unmute(i);const s=this.remoteSDP.toString(),l=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const p=await this.peerConnection.createAnswer();l==null||l(p.sdp||""),await this.peerConnection.setLocalDescription(p)}catch(s){throw new _a(_i.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(b=>b.mid&&i.indexOf(b.mid)!==-1);if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(b=>{b.direction="inactive"});const l=await this.peerConnection.createOffer(),p=this.logSDPExchange(l.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(l),this.remoteSDP.muteRemote(i);const _=this.remoteSDP.toString();p==null||p(_),await this.peerConnection.setRemoteDescription({type:"answer",sdp:_})}catch(s){throw new _a(_i.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(b=>b.mid&&i.indexOf(b.mid)!==-1);if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(b,P)=>{b.direction="sendonly"});const l=await this.peerConnection.createOffer(),p=this.logSDPExchange(l.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(l),this.remoteSDP.unmuteRemote(i);const _=this.remoteSDP.toString();p==null||p(_),await this.peerConnection.setRemoteDescription({type:"answer",sdp:_})}catch(s){throw new _a(_i.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(i){var s=this;return pS(function*(){const l=yield HE(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(M_().supportPCSetConfiguration){const H=s.peerConnection.getConfiguration(),B=i===Fg.RELAY?"relay":"all";H.iceTransportPolicy!==B&&(_e.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(H.iceTransportPolicy,"] to [").concat(B,"]")),H.iceTransportPolicy=B,s.peerConnection.setConfiguration(H))}else if(i===Fg.RELAY)return;i!==Fg.RELAY&&s.remoteSDP.updateCandidates(i);const p=yield HE(s.peerConnection.createOffer({iceRestart:!0}));if(!p.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const _=JR(p.sdp),{remoteIceParameters:b}=yield _.iceParameters;s.remoteSDP.restartICE(b);const P=s.remoteSDP.toString(),x=s.logSDPExchange(p.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield HE(s.peerConnection.setLocalDescription(p)),x==null||x(P),yield HE(s.peerConnection.setRemoteDescription({type:"answer",sdp:P}))}catch(p){_e.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),p)}finally{l()}})()}close(){var i;this.peerConnection.close(),(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}async updateEncoderConfig(i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const l=await this.peerConnection.createOffer(),p=this.mungSendOfferSDP(l.sdp,[s],[i]);this.remoteSDP.updateRecvMedia(i,s);const _=this.remoteSDP.toString(),b=this.logSDPExchange(p,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:p}),b==null||b(_),await this.peerConnection.setRemoteDescription({type:"answer",sdp:_})}catch(l){throw new _a(_i.EXCHANGE_SDP_FAILED,l.toString())}}async updateSendParameters(i,s){const l=this.peerConnection.getTransceivers().filter(p=>p.mid===i);l.length===1&&(this.isVP8Simulcast(s)?A_()||await this.applySimulcastEncodings(l,[s]):await this.applySendEncodings(l,[s]))}setStatsRemoteVideoIsReady(i,s){this.statsFilter.setVideoIsReady2(i,s)}async replaceTrack(i,s){const l=this.peerConnection.getTransceivers().find(p=>p.mid===s);l&&await l.sender.replaceTrack(i._mediaStreamTrack)}async getSelectedCandidatePair(){const i=this.peerConnection.getReceivers();if(i.length>0&&i[0].transport&&i[0].transport.iceTransport&&i[0].transport.iceTransport.getSelectedCandidatePair&&i[0].transport.iceTransport.getSelectedCandidatePair()){const s=i[0].transport.iceTransport,{local:l,remote:p}=s.getSelectedCandidatePair();return{local:UI(UI({},gR),{},{candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port}),remote:UI(UI({},gR),{},{candidateType:p.type,protocol:p.protocol,address:p.address,port:p.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,_e.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,_e.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},kc("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const s={iceServers:[]};return i.iceServers?s.iceServers=i.iceServers:i.turnServer&&i.turnServer.mode!=="off"&&(i0(i.turnServer.servers)?s.iceServers=i.turnServer.servers:(s.iceServers&&s.iceServers.push(...O0.turnServerConfigToIceServers(i.turnServer.servers)),kc("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&i.turnServer.serversFromGateway&&s.iceServers.push(...O0.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),kc("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(l=>{l.forceturn&&(s.iceTransportPolicy="relay")}))),kc("ENABLE_ENCODED_TRANSFORM")&&M_().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(i){const s=[];return i.forEach(l=>{l.security?l.tcpport&&s.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(UO(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}):(l.udpport&&!kc("FORCE_TURN_TCP")&&s.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.udpport,"?transport=udp")}),l.tcpport&&s.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=tcp")}))}),s}tryBindTransportEvents(i){const s=i.transport;if(s){this.transportEventReceiver=i,s.onstatechange=()=>{var p;s!=null&&s.state&&((p=this.onDTLSTransportStateChange)===null||p===void 0||p.call(this,s.state))},s.onerror=p=>{var _;(_=this.onDTLSTransportError)===null||_===void 0||_.call(this,"error"in p?p.error:p)};const l=s.iceTransport;l&&(l.onstatechange=()=>{const p=s==null?void 0:s.iceTransport.state;var _;p&&((_=this.onICETransportStateChange)===null||_===void 0||_.call(this,p))},l.getSelectedCandidatePair&&(l.onselectedcandidatepairchange=()=>{if(l.getSelectedCandidatePair()){const{local:p,remote:_}=l.getSelectedCandidatePair();_e.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:p.type,protocol:p.protocol}),", remote ").concat(JSON.stringify({candidateType:_.type,protocol:_.protocol,address:_.address,port:_.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async applySendEncodings(i,s){try{if(!M_().supportSetRtpSenderParameters||i.length!==s.length)return;for(let H=0;H<i.length;H++){const B=i[H],z=s[H];if(z&&z instanceof q_){var l,p;if(this.isVP8Simulcast(z))continue;const Wt={},_r={};switch(z._optimizationMode){case"motion":Wt.degradationPreference="maintain-framerate";break;case"detail":Wt.degradationPreference="maintain-resolution";break;default:Wt.degradationPreference="balanced"}var _,b,P,x;if((l=z._encoderConfig)!==null&&l!==void 0&&l.bitrateMax&&(_r.maxBitrate=1e3*((_=z._encoderConfig)===null||_===void 0?void 0:_.bitrateMax)),z._hints.includes(X_.LOW_STREAM)&&((b=z._encoderConfig)!==null&&b!==void 0&&b.frameRate&&(_r.maxFramerate=JS(z._encoderConfig.frameRate)),(P=z._encoderConfig)!==null&&P!==void 0&&P.scaleResolutionDownBy&&((x=z._encoderConfig)===null||x===void 0?void 0:x.scaleResolutionDownBy)>1&&(_r.scaleResolutionDownBy=z._encoderConfig.scaleResolutionDownBy)),kc("DSCP_TYPE")&&LR()){const Gi=kc("DSCP_TYPE");["very-low","low","medium","high"].includes(Gi)&&(_r.networkPriority=Gi)}const Di=B.sender.getParameters(),Fi=(p=Di.encodings)===null||p===void 0?void 0:p[0];A_()&&!Fi&&(Wt.encodings=[_r]),Fi&&Object.assign(Fi,_r),Object.assign(Di,Wt),await B.sender.setParameters(Di)}}}catch{_e.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(i,s,l){const p=W_.exports.parse(i);return s.forEach((_,b)=>{const P=l[b],x=p.mediaDescriptions.find(H=>H.attributes.mid===P);x&&(MI(x,_),BG(x,_,this.store.codec))}),W_.exports.print(p)}mungReceiveAnswerSDP(i,s,l){const p=W_.exports.parse(i),_=p.mediaDescriptions.find(b=>b.attributes.mid===s);return _&&l===VE.AUDIO&&_.media.mediaType==="audio"&&mR(_),W_.exports.print(p)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,s,l)=>{var p;(p=this.onFirstVideoDecoded)===null||p===void 0||p.call(this,i,s,l)},this.statsFilter.onSelectedLocalCandidateChanged=(i,s)=>{var l;(l=this.onSelectedLocalCandidateChanged)===null||l===void 0||l.call(this,i,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,s)=>{var l;(l=this.onSelectedRemoteCandidateChanged)===null||l===void 0||l.call(this,i,s)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(i,s){if(i.length===s.length)for(let P=0;P<i.length;P++){var l,p,_,b;const x=i[P],H=s[P];if(H instanceof q_&&!H._hints.includes(X_.LOW_STREAM)&&(l=H._encoderConfig)!==null&&l!==void 0&&l.bitrateMax&&((p=H._encoderConfig)===null||p===void 0?void 0:p.bitrateMax)>200&&(_=H._scalabiltyMode)!==null&&_!==void 0&&_.numSpatialLayers&&((b=H._scalabiltyMode)===null||b===void 0?void 0:b.numSpatialLayers)>1&&this.store.codec==="vp8"){const B={},z={high:1e3*(H._encoderConfig.bitrateMax-50),medium:5e4};B.encodings=[{rid:"m",active:!0,maxBitrate:z.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:z.high}];const Wt=x.sender.getParameters();await x.sender.setParameters(Object.assign(Wt,B))}}}async applySimulcastEncodings(i,s){if(!A_()&&i.length===s.length)for(let l=0;l<i.length;l++){const p=s[l];if(p instanceof q_&&this.isVP8Simulcast(p)){const _=i[l],b={},P={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:P.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:P.medium,scaleResolutionDownBy:4}];const x=_.sender.getParameters();await _.sender.setParameters(Object.assign(x,b))}}}isVP8Simulcast(i){var s,l,p,_;return!!(i instanceof q_&&kc("SIMULCAST")&&this.store.codec==="vp8"&&!i._hints.includes(X_.LOW_STREAM)&&(s=i._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((l=i._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(p=i._scalabiltyMode)!==null&&p!==void 0&&p.numSpatialLayers&&((_=i._scalabiltyMode)===null||_===void 0?void 0:_.numSpatialLayers)>1)}logSDPExchange(i,s,l,p){if(kc("SDP_LOGGING"))return _e.upload("[".concat(this.store.clientId,"] exchanging ").concat(l," ").concat(s," SDP during P2PConnection.").concat(p,`
`),i),s==="offer"?_=>{this.logSDPExchange(_,"answer",l==="local"?"remote":"local",p)}:void 0}async getRemoteSSRC(i){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(i);return s==null?void 0:s[0].ssrcId}setConfiguration(i){if(M_().supportPCSetConfiguration){const s=O0.resolvePCConfiguration(i);this.peerConnection.setConfiguration(s)}}}).prototype,"connect",[iS],Object.getOwnPropertyDescriptor(p_.prototype,"connect"),p_.prototype),iE(p_.prototype,"receive",[iS],Object.getOwnPropertyDescriptor(p_.prototype,"receive"),p_.prototype),iE(p_.prototype,"batchReceive",[iS],Object.getOwnPropertyDescriptor(p_.prototype,"batchReceive"),p_.prototype),iE(p_.prototype,"stopReceiving",[iS],Object.getOwnPropertyDescriptor(p_.prototype,"stopReceiving"),p_.prototype),iE(p_.prototype,"muteRemote",[iS],Object.getOwnPropertyDescriptor(p_.prototype,"muteRemote"),p_.prototype),iE(p_.prototype,"unmuteRemote",[iS],Object.getOwnPropertyDescriptor(p_.prototype,"unmuteRemote"),p_.prototype),iE(p_.prototype,"muteLocal",[iS],Object.getOwnPropertyDescriptor(p_.prototype,"muteLocal"),p_.prototype),iE(p_.prototype,"unmuteLocal",[iS],Object.getOwnPropertyDescriptor(p_.prototype,"unmuteLocal"),p_.prototype),iE(p_.prototype,"close",[iS],Object.getOwnPropertyDescriptor(p_.prototype,"close"),p_.prototype),iE(p_.prototype,"updateEncoderConfig",[iS],Object.getOwnPropertyDescriptor(p_.prototype,"updateEncoderConfig"),p_.prototype),iE(p_.prototype,"updateSendParameters",[iS],Object.getOwnPropertyDescriptor(p_.prototype,"updateSendParameters"),p_.prototype),iE(p_.prototype,"replaceTrack",[iS],Object.getOwnPropertyDescriptor(p_.prototype,"replaceTrack"),p_.prototype),iE(p_.prototype,"getRemoteSSRC",[iS],Object.getOwnPropertyDescriptor(p_.prototype,"getRemoteSSRC"),p_.prototype),p_);function iS(r,i,s){const l=r[i];if(typeof l!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const p=this.mutex,_=await p.lock("From P2PConnection.".concat(i));try{for(var b=arguments.length,P=new Array(b),x=0;x<b;x++)P[x]=arguments[x];return await l.apply(this,P)}finally{_()}},s}function a4(r,i){let s=document.createElement("video"),l=document.createElement("canvas");s.setAttribute("style","display:none"),l.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),l.width=JS(i.width),l.height=JS(i.height);const p=JS(i.framerate||15);document.body.append(s),document.body.append(l);let _=r._mediaStreamTrack;s.srcObject=new MediaStream([_]),s.play();const b=l.getContext("2d");if(!b)throw new _a(_i.UNEXPECTED_ERROR,"can not get canvas context");const P=M_(),x=l.captureStream(P.supportRequestFrame?0:p).getVideoTracks()[0],H=DV(()=>(()=>{if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const z=s.videoWidth,Wt=s.videoHeight/z,_r=l.width*Wt;Math.abs(_r-l.height)>=2&&(_e.debug("adjust low stream resolution","".concat(l.width,"x").concat(l.height," -> ").concat(l.width,"x").concat(_r)),l.height=_r)}b.drawImage(s,0,0,l.width,l.height),x.requestFrame&&x.requestFrame(),_!==r._mediaStreamTrack&&(_=r._mediaStreamTrack,s.srcObject=new MediaStream([_]))})(),p),B=x.stop;return x.stop=()=>{B.call(x),H(),s&&(s.remove(),s=null),l&&(l.width=0,l.remove(),l=null),_e.debug("clean low stream renderer")},x}var c4,u4,d4,l4,oS,h4,p4,f4,E4,_4,m4,hT;function g4(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function ZO(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?g4(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):g4(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}class v4 extends AV{getUserId(){return this._userId}constructor(i,s,l,p){super(i,"track-".concat(i.kind,"-").concat(s,"-").concat(p.clientId,"_").concat(b_(5,""))),$(this,"_userId",void 0),$(this,"_uintId",void 0),$(this,"_isDestroyed",!1),$(this,"store",void 0),$(this,"processor",void 0),$(this,"processorContext",void 0),this._userId=s,this._uintId=l,this.store=p}_updateOriginMediaStreamTrack(i){this._originMediaStreamTrack=i,this._mediaStreamTrack=i,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,_e.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let _A=(c4=PE({argsMap:(r,i,s)=>[r.getTrackId(),typeof i=="string"?i:i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),u4=PE({argsMap:r=>[r.getTrackId()]}),d4=PE({argsMap:(r,i)=>[r.getTrackId(),i.name]}),l4=PE({argsMap:r=>[r.getTrackId()]}),iE((oS=class extends v4{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==eT.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(r,i,s,l){super(r,i,s,l),$(this,"_videoVisibleTimer",null),$(this,"_previousVideoVisibleStatus",void 0),$(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),$(this,"trackMediaType","video"),$(this,"_videoWidth",void 0),$(this,"_videoHeight",void 0),$(this,"_player",void 0),$(this,"processorDestination",void 0),$(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new GV(this.getTrackId(),"remote"),this.processorDestination=new BV(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return c0(()=>{_e.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),hS(this,ME.GET_STATS)||ZO({},oV)}play(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const l=document.getElementById(r);l?r=l:(_e.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}_e.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const s=ZO(ZO({fit:"cover"},i),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(s):(r instanceof HTMLVideoElement?this._player=new lL(s):this._player=new T3(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(SI.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const l=this.getVideoElementVisibleStatus();this.safeEmit(SI.VIDEO_ELEMENT_VISIBLE_STATUS,l)}catch{}},kc("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,_e.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){jF(this._originMediaStreamTrack).then(r=>{let[i,s]=r;this._videoHeight=s,this._videoWidth=i}).catch(jO)}_updatePlayerSource(){_e.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var r,i;const s=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),l={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:p,slot:_}=l;if(this.isPlaying&&p instanceof HTMLVideoElement&&_ instanceof HTMLElement){const b=eG.checkOneElementVisible(p),P=Object.assign({},b);if(P.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=P.visible;const x=AE.reportApiInvoke(null,{tag:S_.TRACER,name:V_.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});P.visible?x.onSuccess("Video is visible"):x.onSuccess("Invisible because of ".concat(P.reason))}return P}return}catch(s){throw new _a(_i.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(r){if(this.processor===r)return r;if(r._source)throw new _a(_i.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(iT.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(iT.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}).prototype,"play",[c4],Object.getOwnPropertyDescriptor(oS.prototype,"play"),oS.prototype),iE(oS.prototype,"stop",[u4],Object.getOwnPropertyDescriptor(oS.prototype,"stop"),oS.prototype),iE(oS.prototype,"pipe",[d4],Object.getOwnPropertyDescriptor(oS.prototype,"pipe"),oS.prototype),iE(oS.prototype,"unpipe",[l4],Object.getOwnPropertyDescriptor(oS.prototype,"unpipe"),oS.prototype),oS),_C=(h4=PE({argsMap:(r,i)=>[r.getTrackId(),i],throttleTime:300}),p4=PE({argsMap:(r,i)=>[r.getTrackId(),i]}),f4=PE({argsMap:r=>[r.getTrackId()]}),E4=PE({argsMap:r=>[r.getTrackId()]}),_4=PE({argsMap:(r,i)=>[r.getTrackId(),i.name]}),m4=PE({argsMap:r=>[r.getTrackId()]}),iE((hT=class extends v4{get isPlaying(){return this._useAudioElement?LT.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(r,i,s,l){super(r,i,s,l),$(this,"trackMediaType","audio"),$(this,"_source",void 0),$(this,"_useAudioElement",!0),$(this,"_volume",100),$(this,"processorContext",void 0),$(this,"processorDestination",void 0),$(this,"_played",!1),$(this,"_bypassWebAudio",!1),kc("DISABLE_WEBAUDIO")?(this._source=new $P,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new JP(r,!0),kc("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(IT.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(SI.FIRST_FRAME_DECODED)}),this.processorContext=new WV(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new qV(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(IT.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!r)return this._source.removeAllListeners(IT.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(i),this._source.removeAllListeners(IT.ON_AUDIO_BUFFER),this._source.on(IT.ON_AUDIO_BUFFER,s=>r(s))}setVolume(r){this._volume=r,this._useAudioElement?LT.setVolume(this.getTrackId(),r):this._source.setVolume(r/100)}async setPlaybackDevice(r){if(!this._useAudioElement)throw new _a(_i.NOT_SUPPORTED,"your browser does not support setting the audio output device");await LT.setSinkID(this.getTrackId(),r)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return c0(()=>{_e.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),hS(this,ME.GET_STATS)||ZO({},iV)}play(){_e.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(_e.debug("[".concat(this.getTrackId(),"] use audio element to play")),LT.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){_e.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?LT.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let r=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];_e.debug("[".concat(this.getTrackId(),"] update player source track")),r&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&LT.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(r){if(this._bypassWebAudio)throw new _a(_i.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===r)return r;if(r._source)throw new _a(_i.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),r}unpipe(){var r;if(this._bypassWebAudio)throw new _a(_i.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const i=this.processor;(r=this._source.processSourceNode)===null||r===void 0||r.disconnect(),this.processor._source=!1,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(iT.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(iT.ON_NODE,r=>{this._source.processedNode=r;const i=!r;this._useAudioElement!==i&&(this._played?(this.stop(),this._useAudioElement=i,this.play()):this._useAudioElement=i)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(iT.ON_TRACK),this.processorDestination.removeAllListeners(iT.ON_NODE)}}).prototype,"setVolume",[h4],Object.getOwnPropertyDescriptor(hT.prototype,"setVolume"),hT.prototype),iE(hT.prototype,"setPlaybackDevice",[p4],Object.getOwnPropertyDescriptor(hT.prototype,"setPlaybackDevice"),hT.prototype),iE(hT.prototype,"play",[f4],Object.getOwnPropertyDescriptor(hT.prototype,"play"),hT.prototype),iE(hT.prototype,"stop",[E4],Object.getOwnPropertyDescriptor(hT.prototype,"stop"),hT.prototype),iE(hT.prototype,"pipe",[_4],Object.getOwnPropertyDescriptor(hT.prototype,"pipe"),hT.prototype),iE(hT.prototype,"unpipe",[m4],Object.getOwnPropertyDescriptor(hT.prototype,"unpipe"),hT.prototype),hT);function y4(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function b4(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?y4(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):y4(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}class VQ extends I_{constructor(){super(),$(this,"uplinkStatsUploadInterval",void 0),$(this,"uplinkRelatedStatsUploadInterval",void 0),$(this,"uplinkDenoiserStatsUploadInterval",void 0),$(this,"transportStatsUploadInterval",void 0),$(this,"uplinkExtensionStatsUploadInterval",void 0),$(this,"downlinkExtensionStatsUploadInterval",void 0),$(this,"extensionUsageStatsUploadInterval",void 0),$(this,"downlinkStatsUploadInterval",void 0),$(this,"downlinkRelatedStatsUploadInterval",void 0),$(this,"lastStats",void 0),$(this,"uploadUnplinkStarted",!1),$(this,"uploadDownlinkStarted",!1),$(this,"uploadTransportStarted",!1),$(this,"uploadExtensionUsageStarted",!1),$(this,"requestStats",void 0),$(this,"requestLocalMedia",void 0),$(this,"requestRemoteMedia",void 0),$(this,"requestAllTracks",void 0),$(this,"requestVideoIsReady",void 0),$(this,"requestUpload",void 0)}startUploadTransportStats(){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestStats)===null||i===void 0?void 0:i.call(this);s&&this.uploadTransportStats(s)},1e3))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const i=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(async()=>{var s,l,p;const _=Date.now(),b={connectionInterval:kc("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:_};let P=[];const x=((s=this.requestAllTracks)===null||s===void 0?void 0:s.call(this))||[];for(const Wt of x)!Wt.muted&&Wt.enabled&&(P=P.concat(await Wt.getProcessorUsage()));const H=((l=this.requestRemoteMedia)===null||l===void 0?void 0:l.call(this))||[];for(const[Wt,_r]of H)_r.has(VE.VIDEO)&&Wt.videoTrack&&(P=P.concat(await Wt.videoTrack.getProcessorUsage())),_r.has(VE.AUDIO)&&Wt.audioTrack&&(P=P.concat(await Wt.audioTrack.getProcessorUsage()));if(P.length===0)return;b.details=function(Wt,_r){const Di={};for(const{id:_f,value:cE,level:RE,direction:dE}of Wt){var Fi;const lE=(Fi=_r.get(_f))!==null&&Fi!==void 0?Fi:0,oE=cE===2?lE+kc("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:lE;var Gi,_p;_r.set(_f,oE),Di[_f]?(cE===2&&(Di[_f].value=cE),RE>Di[_f].level&&(Di[_f].level=RE),dE==="remote"&&(Di[_f].remoteUidCount+=1),Di[_f].totalTs=(Gi=_r.get(_f))!==null&&Gi!==void 0?Gi:0):Di[_f]={value:cE,level:RE,remoteUidCount:dE==="local"?0:1,totalTs:(_p=_r.get(_f))!==null&&_p!==void 0?_p:0}}return Object.keys(Di).map(_f=>{const{level:cE,value:RE,totalTs:dE}=Di[_f];return{id:_f,level:cE,value:RE,totalTs:dE}})}(P,i);const B=Date.now(),z=B>_?B:_+1;(p=this.requestUpload)===null||p===void 0||p.call(this,PT.EXTENSION_USAGE_STATS,{usageStats:b,sendTs:z})},kc("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestStats)===null||i===void 0?void 0:i.call(this);s&&(this.uploadUplinkStats(s),this.lastStats=s)},3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestStats)===null||i===void 0?void 0:i.call(this);s&&this.uploadRelatedUplinkStats(s,this.lastStats),this.lastStats=s},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestAllTracks)===null||i===void 0?void 0:i.call(this);s&&this.uploadDenoiserStats(s)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var i;const s=(i=this.requestAllTracks)===null||i===void 0?void 0:i.call(this);s&&this.uploadExtensionStats(s)},2e3))}uploadTransportStats(i){IS(()=>{var s;(s=this.requestUpload)===null||s===void 0||s.call(this,PT.TRANSPORT_STATS,function(l){const p={connectionType:100,googRtt:l.rtt};if(l.selectedCandidatePair.localCandidate.candidateType==="relay"){const _=l.selectedCandidatePair.localCandidate.relayProtocol;_==="udp"&&(p.connectionType=101),_==="tcp"&&(p.connectionType=103),_==="tls"&&(p.connectionType=104)}return p}(i))})}uploadUplinkStats(i){var s;(((s=this.requestLocalMedia)===null||s===void 0?void 0:s.call(this))||[]).forEach(l=>{let[p,{track:_,ssrcs:b}]=l;switch(p){case IE.LocalVideoLowTrack:case IE.LocalVideoTrack:{const P=function(B,z,Wt){var _r;const Di=z.videoSend.find(Gi=>Gi.ssrc===B);if(!Di)return null;const Fi={id:b_(10,""),timestamp:new Date(z.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:Di.ssrc.toString()};switch(Fi.A_vstd=Wt._originMediaStreamTrack&&!Wt._originMediaStreamTrack.enabled||Wt._mediaStreamTrack&&!Wt._mediaStreamTrack.enabled?"1":"0",Di.sentFrame&&(Fi.A_fhs=Di.sentFrame.height.toString(),Fi.A_frs=Di.sentFrame.frameRate.toString(),Fi.A_fws=Di.sentFrame.width.toString()),Di.adaptionChangeReason){case"none":Fi.A_ac="0";break;case"cpu":Fi.A_ac="1";break;case"bandwidth":Fi.A_ac="2";break;case"other":Fi.A_ac="3"}return Fi.A_lvps=NP[Wt._player?Wt._player.videoElementStatus:"uninit"].toString(),Fi.A_nr=(_r=Di.nacksCount)===null||_r===void 0?void 0:_r.toString(),Di.avgEncodeMs&&(Fi.A_aem=Di.avgEncodeMs.toFixed(0).toString()),Fi}(b[0].ssrcId,i,_),x=p===IE.LocalVideoTrack?function(B,z,Wt){var _r,Di,Fi,Gi,_p,_f,cE,RE;const dE=z.videoSend.find(DE=>DE.ssrc===B);if(!dE)return null;const lE={id:b_(10,""),timestamp:new Date(z.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:dE.ssrc.toString()},oE=(_r=(Di=(Fi=dE.inputFrame)===null||Fi===void 0?void 0:Fi.height)!==null&&Di!==void 0?Di:Wt==null?void 0:Wt._videoHeight)!==null&&_r!==void 0?_r:0,EE=(Gi=(_p=(_f=dE.inputFrame)===null||_f===void 0?void 0:_f.width)!==null&&_p!==void 0?_p:Wt==null?void 0:Wt._videoWidth)!==null&&Gi!==void 0?Gi:0,r_=(cE=(RE=dE.inputFrame)===null||RE===void 0?void 0:RE.frameRate)!==null&&cE!==void 0?cE:0;return oE&&(lE.A_fhi=oE+""),EE&&(lE.A_fwi=EE+""),r_&&(lE.A_fri=r_+""),lE}(b[0].ssrcId,i,_):null;P&&IS(()=>{var B;return(B=this.requestUpload)===null||B===void 0?void 0:B.call(this,PT.PUBLISH_STATS,{stream_type:p===IE.LocalVideoLowTrack?"low":"high",stats:b4(b4({},P),x)})});const H=function(B){const z={id:"bweforvideo",timestamp:new Date(B.timestamp).toISOString(),type:"VideoBwe"};return B.bitrate.retransmit&&(z.A_rb=B.bitrate.retransmit.toString()),B.bitrate.targetEncoded&&(z.A_teb=B.bitrate.targetEncoded.toString()),z.A_aeb=B.bitrate.actualEncoded.toString(),z.A_tb=B.bitrate.transmit.toString(),B.sendBandwidth!==void 0&&(z.A_asb=B.sendBandwidth.toString()),z}(i);H&&setTimeout(()=>{var B;return(B=this.requestUpload)===null||B===void 0?void 0:B.call(this,PT.PUBLISH_STATS,{stream_type:p===IE.LocalVideoLowTrack?"low":"high",stats:H})},1e3);break}case IE.LocalAudioTrack:{const P=function(x,H,B){const z=H.audioSend.find(_r=>_r.ssrc===x);if(!z)return null;const Wt={id:b_(10,""),timestamp:new Date(H.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:z.ssrc.toString()};return Wt.A_astd=B._originMediaStreamTrack&&!B._originMediaStreamTrack.enabled||B._mediaStreamTrack&&!B._mediaStreamTrack.enabled?"1":"0",z.inputLevel?Wt.A_ail=Math.round(100*z.inputLevel).toString():Wt.A_ail=Math.round(100*B._source.getAccurateVolumeLevel()).toString(),Wt.A_apil=Math.round(100*B._source.getAccurateVolumeLevel()).toString(),z.aecReturnLoss&&(Wt.A_ecrl=Math.round(z.aecReturnLoss).toString()),z.aecReturnLossEnhancement&&(Wt.A_ecrle=Math.round(z.aecReturnLossEnhancement).toString()),Wt}(b[0].ssrcId,i,_);P&&IS(()=>{var x;return(x=this.requestUpload)===null||x===void 0?void 0:x.call(this,PT.PUBLISH_STATS,{stream_type:"high",stats:P})});break}}})}uploadRelatedUplinkStats(i,s){var l;(((l=this.requestLocalMedia)===null||l===void 0?void 0:l.call(this))||[]).filter(p=>{let[_]=p;return _===IE.LocalVideoLowTrack||_===IE.LocalVideoTrack}).forEach(p=>{let[_,{ssrcs:b}]=p;const P=function(x,H){const B=H.videoSend.find(z=>z.ssrc===x);return B?{mediaType:"video",isVideoMute:!1,frameRateInput:B.inputFrame&&B.inputFrame.frameRate.toString(),frameRateSent:B.sentFrame&&B.sentFrame.frameRate.toString(),googRtt:B.rttMs.toString(),qpSumPerFrame:Math.floor(B.qpSumPerFrame).toString()}:null}(b[0].ssrcId,i);P&&IS(()=>{var x;(x=this.requestUpload)===null||x===void 0||x.call(this,PT.PUBLISH_RELATED_STATS,{stream_type:_===IE.LocalVideoLowTrack?"low":"high",stats:P})})})}uploadDenoiserStats(i){for(let _=0;_<i.length;_++){const b=i[_];if(b instanceof LO){var s,l,p;const P=(s=(l=b._external).getDenoiserStats)===null||s===void 0?void 0:s.call(l);return void(P&&((p=this.requestUpload)===null||p===void 0||p.call(this,PT.DENOISER_STATS,P)))}}}uploadExtensionStats(i){for(let s=0;s<i.length;s++)i[s].getProcessorStats().forEach(l=>{var p;(p=this.requestUpload)===null||p===void 0||p.call(this,l.type,l.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let i;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let s=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var l;const p=(l=this.requestStats)===null||l===void 0?void 0:l.call(this);p&&(this.uploadDownlinkStats(p,s,i),i=p),s=!s},3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var l;const p=(l=this.requestStats)===null||l===void 0?void 0:l.call(this);p&&(this.uploadRelatedDownlinkStats(p,this.lastStats),this.lastStats=p)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var l;const p=(l=this.requestRemoteMedia)===null||l===void 0?void 0:l.call(this);p&&this.uploadDownlinkExtensionStats(p)},2e3)}uploadDownlinkStats(i,s,l){var p;(((p=this.requestRemoteMedia)===null||p===void 0?void 0:p.call(this))||[]).forEach(_=>{let[b,P]=_;if(P.has(VE.VIDEO)&&b.videoTrack){const x=b.videoTrack?function(H,B,z,Wt,_r){const Di=B.videoRecv.find(_f=>_f.ssrc===H);if(!Di)return null;const Fi={id:b_(10,""),timestamp:new Date(B.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:Di.ssrc.toString()};var Gi,_p;if(Fi.bytesReceived=Di.bytes.toString(),Fi.packetsLost=Di.packetsLost.toString(),Fi.packetsReceived=Di.packets.toString(),Di.framesRateFirefox&&(Fi.A_frr=Di.framesRateFirefox.toString()),Di.receivedFrame?(Fi.A_frr=Di.receivedFrame.frameRate.toString(),Fi.A_fhr=Di.receivedFrame.height.toString(),Fi.A_fwr=Di.receivedFrame.width.toString()):(Fi.A_fhr=(Gi=Wt._videoHeight)===null||Gi===void 0?void 0:Gi.toString(),Fi.A_fwr=(_p=Wt._videoWidth)===null||_p===void 0?void 0:_p.toString()),Fi.A_frd=Di.decodeFrameRate.toString(),Di.outputFrame&&(Fi.A_fro=Di.outputFrame.frameRate.toString()),Di.jitterBufferMs!==void 0&&(Fi.A_jbm=Math.floor(Di.jitterBufferMs).toString()),Di.currentDelayMs!==void 0&&(Fi.A_cdm=Math.floor(Di.currentDelayMs).toString()),Fi.A_fs=Di.firsCount.toString(),Fi.A_ns=Di.nacksCount.toString(),Fi.A_ps=Di.plisCount.toString(),Wt&&(Fi.A_vrtd=Wt._originMediaStreamTrack.enabled&&Wt._mediaStreamTrack.enabled?"0":"1"),Wt._player&&Wt._player.freezeTimeCounterList.length>0&&(Fi.A_vrft=Math.round(Wt._player.freezeTimeCounterList.splice(0,1)[0]).toString()),_r&&Wt._player&&zS.visibility==="visible"){const _f=Math.min(6e3,Wt._player.renderFreezeAccTime);Fi.A_vrrft=Math.round(_f).toString(),Wt._player.renderFreezeAccTime=Math.max(0,Wt._player.renderFreezeAccTime-_f)}if(Fi.A_rvps=NP[Wt._player?Wt._player.videoElementStatus:"uninit"].toString(),z){const _f=z.videoRecv.find(cE=>cE.ssrc===H);if(_f&&Di.totalInterFrameDelay!==void 0&&Di.totalSquaredInterFrameDelay!==void 0&&_f.totalInterFrameDelay!==void 0&&_f.totalSquaredInterFrameDelay!==void 0){const cE=Di.totalInterFrameDelay-_f.totalInterFrameDelay,RE=Di.totalSquaredInterFrameDelay-_f.totalSquaredInterFrameDelay,dE=Di.framesDecodeCount-_f.framesDecodeCount,lE=cE/dE*1e3,oE=Math.round(1e3*Math.sqrt((RE-Math.pow(cE,2)/dE)/dE));!isNaN(oE)&&lE+oE>Math.max(3*lE,lE+150)&&(Fi.A_ifdsd=oE.toString())}}return Fi}(b._videoSSRC,i,l,b.videoTrack,s):void 0;x&&IS(()=>{var H;return(H=this.requestUpload)===null||H===void 0?void 0:H.call(this,PT.SUBSCRIBE_STATS,{stream_id:b.uid,stats:x})})}if(P.has(VE.AUDIO)&&b.audioTrack){const x=b.audioTrack?function(H,B,z,Wt){const _r=B.audioRecv.find(Fi=>Fi.ssrc===H);if(!_r)return null;const Di={id:b_(10,""),timestamp:new Date(B.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:_r.ssrc.toString()};if(Di.bytesReceived=_r.bytes.toString(),Di.packetsLost=_r.packetsLost.toString(),Di.packetsReceived=_r.packets.toString(),_r.outputLevel?Di.A_aol=Math.round(100*_r.outputLevel).toString():Di.A_aol=Math.round(100*Wt._source.getAccurateVolumeLevel()).toString(),Di.A_apol=Math.round(100*Wt._source.getAccurateVolumeLevel()).toString(),Wt&&(Di.A_artd=Wt._originMediaStreamTrack.enabled&&Wt._mediaStreamTrack.enabled?"0":"1"),Di.A_jr=_r.jitterMs.toString(),Di.A_jbm=Math.floor(_r.jitterBufferMs).toString(),Di.A_cdm=Math.floor(_r.jitterBufferMs).toString(),Di.A_raps=NP[LT.getPlayerState(Wt.getTrackId())].toString(),z){const Fi=z.audioRecv.find(Gi=>Gi.ssrc===H);if(Fi){const Gi=_r.concealedSamples-Fi.concealedSamples;Gi>0&&(Di.A_cs=Math.round(Gi).toString())}}return Di}(b._audioSSRC,i,l,b.audioTrack):void 0;x&&IS(()=>{var H;return(H=this.requestUpload)===null||H===void 0?void 0:H.call(this,PT.SUBSCRIBE_STATS,{stream_id:b.uid,stats:x})})}})}uploadRelatedDownlinkStats(i,s){var l;(((l=this.requestRemoteMedia)===null||l===void 0?void 0:l.call(this))||[]).forEach(p=>{let[_,b]=p;if(b.has(VE.VIDEO)&&_.videoTrack){var P;const x=(_._videoSSRC&&((P=this.requestVideoIsReady)===null||P===void 0?void 0:P.call(this,_._videoSSRC))||!1)===!0,H=function(B,z,Wt,_r,Di,Fi){const Gi=Wt.videoRecv.find(RE=>RE.ssrc===B),_p=Di?Di.videoRecv.find(RE=>RE.ssrc===B):void 0;if(!Gi)return null;const _f=CI.isRemoteVideoFreeze(Fi,Gi,_p)&&z,cE={mediaType:"video",isVideoMute:!1,peerId:_r,frameRateReceived:Gi.receivedFrame&&Gi.receivedFrame.frameRate.toString(),frameRateDecoded:Gi.decodedFrame&&Gi.decodedFrame.frameRate.toString(),isFreeze:_f,bytesReceived:Gi.bytes.toString(),packetsReceived:Gi.packets.toString(),packetsLost:Gi.packetsLost.toString(),qpSumPerFrame:Math.floor(Gi.qpSumPerFrame).toString()};return Gi.framesRateFirefox&&(cE.frameRateDecoded=Gi.framesRateFirefox.toString(),cE.frameRateReceived=Gi.framesRateFirefox.toString()),cE}(_._videoSSRC,x,i,_.uid,s,_.videoTrack);H&&IS(()=>{var B;(B=this.requestUpload)===null||B===void 0||B.call(this,PT.SUBSCRIBE_RELATED_STATS,{stream_id:_.uid,stats:H})})}if(b.has(VE.AUDIO)&&_.audioTrack){const x=function(H,B,z,Wt){const _r=B.audioRecv.find(Fi=>Fi.ssrc===H);if(!_r)return null;const Di=CI.isRemoteAudioFreeze(Wt);return{mediaType:"audio",isAudioMute:!1,peerId:z,googJitterReceived:_r.jitterMs.toString(),isFreeze:Di,bytesReceived:_r.bytes.toString(),packetsReceived:_r.packets.toString(),packetsLost:_r.packetsLost.toString(),frameReceived:_r.receivedFrames.toString(),frameDropped:_r.droppedFrames.toString()}}(_._audioSSRC,i,_.uid,_.audioTrack);x&&IS(()=>{var H;(H=this.requestUpload)===null||H===void 0||H.call(this,PT.SUBSCRIBE_RELATED_STATS,{stream_id:_.uid,stats:x})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(i){i.forEach(s=>{let[l,p]=s;p.has(VE.VIDEO)&&l.videoTrack&&l.videoTrack.getProcessorStats().forEach(_=>{var b;(b=this.requestUpload)===null||b===void 0||b.call(this,_.type,_.stats)}),p.has(VE.AUDIO)&&l.audioTrack&&l.audioTrack.getProcessorStats().forEach(_=>{var b;(b=this.requestUpload)===null||b===void 0||b.call(this,_.type,_.stats)})})}}function T4(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function S4(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?T4(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):T4(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}const R4=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,_w="9",xL=2e4,jL=4e4;class FQ{get localCapabilities(){return G_(this._localCapabilities)}get rtpCapabilities(){return G_(this._rtpCapabilities)}get candidates(){return G_(this._candidates)}get iceParameters(){return G_(this._iceParameters)}get dtlsParameters(){return G_(this._dtlsParameters)}constructor(i){$(this,"sessionDesc",void 0),$(this,"_localCapabilities",void 0),$(this,"_rtpCapabilities",void 0),$(this,"_candidates",void 0),$(this,"_iceParameters",void 0),$(this,"_dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname",void 0),$(this,"firefoxSsrcMidMap",new Map),i=G_(i);const{remoteIceParameters:s,remoteDtlsParameters:l,candidates:p,remoteRTPCapabilities:_,remoteSetup:b,localCapabilities:P,cname:x}=i,H=W_.exports.parse(R4);this._rtpCapabilities=_,this._candidates=p,this._iceParameters=s,this._dtlsParameters=l,this._localCapabilities=P,this.setup=b,this.cname=x;const B=this.rtpCapabilities.send;for(const z of H.mediaDescriptions){if(z.attributes.iceUfrag=s.iceUfrag,z.attributes.icePwd=s.icePwd,z.attributes.fingerprints=l.fingerprints,z.attributes.candidates=p,z.attributes.setup=b,z.media.mediaType==="application"&&(z.attributes.sctpPort="5000"),z.media.mediaType==="video"&&(z.media.fmts=B.videoCodecs.map(Wt=>Wt.payloadType.toString(10)),z.attributes.payloads=B.videoCodecs,z.attributes.extmaps=B.videoExtensions,kc("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:Wt,ssrcGroups:_r}=nS([{ssrcId:jL,rtx:kc("USE_SUB_RTX")?40001:void 0}],this.cname);z.attributes.ssrcs=Wt,z.attributes.ssrcGroups=_r}if(z.media.mediaType==="audio"&&(z.media.fmts=B.audioCodecs.map(Wt=>Wt.payloadType.toString(10)),z.attributes.payloads=B.audioCodecs,z.attributes.extmaps=B.audioExtensions,mR(z),kc("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:Wt,ssrcGroups:_r}=nS([{ssrcId:xL}],this.cname);z.attributes.ssrcs=Wt,z.attributes.ssrcGroups=_r}}this.sessionDesc=H,this.currentMidIndex=H.mediaDescriptions.length-1}updateRemoteRTPCapabilities(i){const s=W_.exports.parse(R4);this._rtpCapabilities=i;const l=this.rtpCapabilities.send;for(const p of s.mediaDescriptions){if(p.attributes.iceUfrag=this._iceParameters.iceUfrag,p.attributes.icePwd=this._iceParameters.icePwd,p.attributes.fingerprints=this._dtlsParameters.fingerprints,p.attributes.candidates=this._candidates,p.attributes.setup=this.setup,p.media.mediaType==="application"&&(p.attributes.sctpPort="5000"),p.media.mediaType==="video"&&(p.media.fmts=l.videoCodecs.map(_=>_.payloadType.toString(10)),p.attributes.payloads=l.videoCodecs,p.attributes.extmaps=l.videoExtensions,kc("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:_,ssrcGroups:b}=nS([{ssrcId:jL,rtx:kc("USE_SUB_RTX")?40001:void 0}],this.cname);p.attributes.ssrcs=_,p.attributes.ssrcGroups=b}if(p.media.mediaType==="audio"&&(p.media.fmts=l.audioCodecs.map(_=>_.payloadType.toString(10)),p.attributes.payloads=l.audioCodecs,p.attributes.extmaps=l.audioExtensions,kc("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:_,ssrcGroups:b}=nS([{ssrcId:xL}],this.cname);p.attributes.ssrcs=_,p.attributes.ssrcGroups=b}}this.sessionDesc=s,this.currentMidIndex=s.mediaDescriptions.length-1}preloadRemoteMedia(i){this.rtpCapabilities;const s=this.candidates,l=this.dtlsParameters,p=this.iceParameters,_=this.rtpCapabilities.send;for(let b=1;b<i;b++){const P=2*b+xL,x=2*b+jL,{ssrcs:H,ssrcGroups:B}=nS([{ssrcId:P}],this.cname),{ssrcs:z,ssrcGroups:Wt}=nS([{ssrcId:x,rtx:kc("USE_SUB_RTX")?x+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:_w,protos:["UDP","TLS","RTP","SAVPF"],fmts:_.videoCodecs.map(_r=>_r.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:p.iceUfrag,icePwd:p.icePwd,unrecognized:[],candidates:s,extmaps:_.videoExtensions,fingerprints:l.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:z,ssrcGroups:Wt,rtcpFeedbackWildcards:[],payloads:_.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*b-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:_w,protos:["UDP","TLS","RTP","SAVPF"],fmts:_.audioCodecs.map(_r=>_r.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:p.iceUfrag,icePwd:p.icePwd,unrecognized:[],candidates:s,extmaps:_.audioExtensions,fingerprints:l.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:H,ssrcGroups:B,rtcpFeedbackWildcards:[],payloads:_.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*b)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return W_.exports.print(this.sessionDesc)}send(i,s,l,p){const{ssrcs:_,ssrcGroups:b}=nS(s,this.cname,kc("SYNC_GROUP")?l:void 0),P=this.findPreloadMediaDesc(_);if(P){if(A_()&&this.firefoxSsrcMidMap.set(_[0].ssrcId,P.attributes.mid),p&&(p.twcc||p.remb)){const x=this.sessionDesc.mediaDescriptions.indexOf(P);return this.sessionDesc.mediaDescriptions[x]=this.mungSendMediaDesc(P,p),{mid:P.attributes.mid,needExchangeSDP:!0}}return{mid:P.attributes.mid,needExchangeSDP:!1}}{const x=this.findAvailableMediaIndex(i,_);let H;return x===-1||pT()||fT()||n2()||x===0&&kc("USE_SUB_RTX")?(H=this.createOrRecycleSendMedia(i,_,b,"sendonly",p),this.updateBundleMids()):(H=G_(this.sessionDesc.mediaDescriptions[x]),H.attributes.direction="sendonly",H.attributes.ssrcs=_,H.attributes.ssrcGroups=b,this.sessionDesc.mediaDescriptions[x]=this.mungSendMediaDesc(H,p)),A_()&&this.firefoxSsrcMidMap.set(_[0].ssrcId,H.attributes.mid),{mid:H.attributes.mid,needExchangeSDP:!0}}}batchSend(i){const s=i.map(_=>{let{kind:b,ssrcMsg:P,mslabel:x}=_;return this.send(b,P,x)}),l=[];let p=!1;return s.forEach(_=>{let{mid:b,needExchangeSDP:P}=_;P&&(p=!0),l.push(b)}),{mids:l,needExchangeSDP:p}}stopSending(i){const s=this.sessionDesc.mediaDescriptions.filter(l=>l.attributes.mid&&i.indexOf(l.attributes.mid)!==-1);if(s.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");s.forEach(l=>{l.attributes.mid==="0"||A_()||pT()||fT()?l.attributes.ssrcs=[]:(l.attributes.ssrcs=[],l.attributes.direction="inactive",l.media.port="0")}),this.updateBundleMids()}mute(i){const s=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===i);if(!s)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(i){const s=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===i);if(!s)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}muteRemote(i){const s=this.sessionDesc.mediaDescriptions.filter(l=>i.includes(l.attributes.mid||""));if(s.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");s.forEach(l=>{l.attributes.direction="inactive"})}unmuteRemote(i){const s=this.sessionDesc.mediaDescriptions.filter(l=>i.includes(l.attributes.mid||""));if(s.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");s.forEach(l=>{l.attributes.direction="recvonly"})}receive(i,s,l,p){i.forEach((_,b)=>{this.createOrRecycleRecvMedia(_,[],"recvonly",s,l,p[b])}),this.updateBundleMids()}stopReceiving(i){const s=this.sessionDesc.mediaDescriptions.filter(l=>i.indexOf(l.attributes.mid)!==-1);if(s.length!==i.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");s.forEach(l=>{l.media.port="0",l.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(i){i===Fg.TCP?this._candidates.forEach(s=>{this._candidates.findIndex(l=>l.transport==="tcp"&&l.connectionAddress===s.connectionAddress&&l.port===s.port)===-1&&this._candidates.push(S4(S4({},s),{},{foundation:"tcpcandidate",priority:Number(s.priority)-1+"",transport:"tcp",port:Number(s.port)+90+""}))}):this._candidates=this._candidates.filter(s=>s.transport!=="tcp");for(const s of this.sessionDesc.mediaDescriptions)s.attributes.candidates=this.candidates}restartICE(i){i=G_(i),this._iceParameters=i,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=i.iceUfrag,s.attributes.icePwd=i.icePwd})}predictReceivingMids(i){const s=[];for(let l=0;l<i;l++)s.push((this.currentMidIndex+l+1).toString(10));return s}findAvailableMediaIndex(i,s){return this.sessionDesc.mediaDescriptions.findIndex(l=>{const p=l.media.mediaType===i&&l.media.port!=="0"&&(l.attributes.direction==="sendonly"||l.attributes.direction==="sendrecv")&&l.attributes.ssrcs.length===0;if(A_()){if(p){const _=this.firefoxSsrcMidMap.get(s[0].ssrcId);return!(_||l.attributes.mid!=="0"&&l.attributes.mid!=="1")||!(!_||_!==l.attributes.mid)}return!1}return p})}createOrRecycleRecvMedia(i,s,l,p,_,b){const P=i._mediaStreamTrack.kind,x=this.rtpCapabilities.recv,H=this.localCapabilities.send;let B=[];if(P===VE.VIDEO){var z,Wt;if(kc("H264_PROFILE_LEVEL_ID")&&p==="h264"&&(B=x.videoCodecs.filter(_p=>{var _f,cE;return(((_f=_p.rtpMap)===null||_f===void 0?void 0:_f.encodingName.toLowerCase())||"").includes(p)&&(_p==null||(cE=_p.fmtp)===null||cE===void 0?void 0:cE.parameters["profile-level-id"])===kc("H264_PROFILE_LEVEL_ID")})),!B||((z=B)===null||z===void 0?void 0:z.length)===0){const _p=H.videoCodecs.filter(_f=>{var cE;return(((cE=_f.rtpMap)===null||cE===void 0?void 0:cE.encodingName.toLowerCase())||"").includes(p)});_p.length!==0&&(B=x.videoCodecs.filter(_f=>_p.some(cE=>cE.payloadType===_f.payloadType)))}if(kc("USE_PUB_RTX")){const _p=B.map(cE=>cE.payloadType.toString()),_f=x.videoCodecs.filter(cE=>{var RE,dE;return((RE=cE.rtpMap)===null||RE===void 0?void 0:RE.encodingName)==="rtx"&&_p.includes(((dE=cE.fmtp)===null||dE===void 0?void 0:dE.parameters.apt)||"")});B=[...B,..._f]}B.length===0&&(_e.warning("codec ".concat(p," not included in rtpCapabilities, fallback to default payloads: ").concat((Wt=x.videoCodecs[0].rtpMap)===null||Wt===void 0?void 0:Wt.encodingName)),B=x.videoCodecs)}else B=x.audioCodecs.filter(_p=>{var _f;return(((_f=_p.rtpMap)===null||_f===void 0?void 0:_f.encodingName.toLowerCase())||"").includes(_)}),B.length===0&&(_e.warning("codec ".concat(_," not included in rtpCapabilities, fallback to opus")),B=x.audioCodecs.filter(_p=>{var _f;return(((_f=_p.rtpMap)===null||_f===void 0?void 0:_f.encodingName.toLowerCase())||"").includes("opus")}));const _r=P===VE.VIDEO?x.videoExtensions:x.audioExtensions;this.currentMidIndex+=1;const Di="".concat(this.currentMidIndex);let Fi={media:{mediaType:P,port:_w,protos:["UDP","TLS","RTP","SAVPF"],fmts:B.map(_p=>_p.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:_r,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:s,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:B,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:l,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Di)}};Fi=this.mungRecvMediaDsec(Fi,i,b);const Gi=this.findFirstClosedMedia(P);if(Gi){const _p=this.sessionDesc.mediaDescriptions.indexOf(Gi);this.sessionDesc.mediaDescriptions[_p]=Fi}else this.sessionDesc.mediaDescriptions.push(Fi);return Fi}createOrRecycleSendMedia(i,s,l,p,_){const b=this.rtpCapabilities.send,P=i===VE.VIDEO?b.videoCodecs:b.audioCodecs,x=i===VE.VIDEO?b.videoExtensions:b.audioExtensions;this.currentMidIndex+=1;const H="".concat(this.currentMidIndex);let B={media:{mediaType:i,port:_w,protos:["UDP","TLS","RTP","SAVPF"],fmts:P.map(Wt=>Wt.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:x,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:s,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:P,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:p,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(H)}};B=this.mungSendMediaDesc(B,_);const z=this.findFirstClosedMedia(i);if(z){const Wt=this.sessionDesc.mediaDescriptions.indexOf(z);this.sessionDesc.mediaDescriptions[Wt]=B}else this.sessionDesc.mediaDescriptions.push(B);return B}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(i=>i.media.port!=="0").map(i=>i.attributes.mid)}mungRecvMediaDsec(i,s,l){const p=G_(i);return DL(p),MI(p,s),PL(p,s),FG(p),XO(p,l,this.localCapabilities.send),p}mungSendMediaDesc(i,s){const l=G_(i);return XO(l,s,this.localCapabilities.recv),mR(l),l}updateRecvMedia(i,s){const l=this.sessionDesc.mediaDescriptions.findIndex(p=>p.attributes.mid===i);if(l!==-1){const p=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],s);this.sessionDesc.mediaDescriptions[l]=p}}bumpMid(i){this.currentMidIndex+=i}findFirstClosedMedia(i){return this.sessionDesc.mediaDescriptions.find(s=>A_()?s.media.port==="0"&&s.media.mediaType===i:s.media.port==="0")}findPreloadMediaDesc(i){return this.sessionDesc.mediaDescriptions.find(s=>{var l,p;return((l=s.attributes)===null||l===void 0||(p=l.ssrcs[0])===null||p===void 0?void 0:p.ssrcId)===i[0].ssrcId})}getSSRC(i){var s;return(s=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===i))===null||s===void 0?void 0:s.attributes.ssrcs}}var c_;function I4(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function tN(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?I4(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):I4(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}let BQ=(iE((c_=class sN extends CO{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(i,s,l){super(i,s),$(this,"store",void 0),$(this,"peerConnection",void 0),$(this,"remoteSDP",void 0),$(this,"initialOffer",void 0),$(this,"transportEventReceiver",void 0),$(this,"statsFilter",void 0),$(this,"localCapabilities",void 0),$(this,"localCandidateCount",0),$(this,"allCandidatesReceived",!1),$(this,"establishPromise",void 0),$(this,"mutex",new mT("NVExtentionsConnection-mutex")),$(this,"rtcMedia",void 0),this.store=s,this.peerConnection=l,this.statsFilter=UL(this.peerConnection,kc("STATS_UPDATE_INTERVAL"),void 0,A_()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(i){try{const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const l=JR(s.sdp),p=await GG(!kc("USE_PUB_RTX")&&!kc("USE_SUB_RTX"),kc("FILTER_VIDEO_FEC"),kc("FILTER_AUDIO_FEC"));return this.localCapabilities=p,this.initialOffer=s,tN(tN({},l),{},{rtpCapabilities:p,offerSDP:s.sdp})}catch(s){throw new _a(_i.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(i,s,l,p,_,b){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new FQ({remoteIceParameters:i,remoteDtlsParameters:s,candidates:l,remoteRTPCapabilities:p,remoteSetup:_,localCapabilities:kL(this.localCapabilities),cname:b});const P=this.remoteSDP.toString(),x=W_.exports.parse(this.initialOffer.sdp),H=x.mediaDescriptions.find(Wt=>Wt.media.mediaType==="audio");H&&mR(H);const B=W_.exports.print(x),z=this.logSDPExchange(B||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:B}),z==null||z(P),await this.peerConnection.setRemoteDescription({type:"answer",sdp:P})}catch(P){throw new _a(_i.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(P.toString()))}}async updateRemoteConnect(i){var s,l,p;(s=this.remoteSDP)===null||s===void 0||s.updateRemoteRTPCapabilities(i),(l=this.remoteSDP)===null||l===void 0||l.preloadRemoteMedia(2);const _=(p=this.remoteSDP)===null||p===void 0?void 0:p.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const b=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(b),_e.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(i,s,l){var p=this;return pS(function*(){const _=yield HE(p.mutex.lock("From NVExtentionsConnection.send"));try{if(!p.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const b=[];i.forEach(Fi=>{const Gi=p.peerConnection.addTransceiver(Fi._mediaStreamTrack,{direction:"sendonly"});b.push(Gi)}),A_()&&kc("SIMULCAST")===!0&&(yield HE(p.applySimulcastForFirefox(b,i)));const P=yield HE(p.peerConnection.createOffer()),x=p.remoteSDP.predictReceivingMids(i.length),H=p.mungSendOfferSDP(P.sdp,i,x),B=W_.exports.parse(H),z=x.map(Fi=>{const Gi=B.mediaDescriptions.find(_p=>_p.attributes.mid===Fi);if(!Gi)throw new Error("Cannot extract ssrc from mediaDescription.");return jG(Gi,kc("USE_PUB_RTX"))});let Wt;try{Wt=yield z}catch(Fi){Wt=[],p.remoteSDP.receive(i,s,l,Wt);const Gi=p.remoteSDP.toString();throw yield HE(p.peerConnection.setLocalDescription({type:"offer",sdp:H})),yield HE(p.peerConnection.setRemoteDescription({type:"answer",sdp:Gi})),yield HE(p.stopSending(x,!0)),Fi}p.remoteSDP.receive(i,s,l,Wt);const _r=p.remoteSDP.toString(),Di=p.logSDPExchange(H,"offer","local","send");return yield HE(p.peerConnection.setLocalDescription({type:"offer",sdp:H})),yield HE(p.applySimulcastEncodings(b,i)),yield HE(p.applySendEncodings(b,i)),Di==null||Di(_r),yield HE(p.peerConnection.setRemoteDescription({type:"answer",sdp:_r})),b.map((Fi,Gi)=>{const _p=x[Gi];return{localSSRC:z[Gi],id:_p,transceiver:Fi}})}catch(b){throw b instanceof _a?b:new _a(_i.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(b.toString()))}finally{_()}})()}async stopSending(i,s){const l=s?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const p=this.peerConnection.getTransceivers().filter(x=>i.indexOf(x.mid)!==-1);if(p.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");p.map(x=>{var H;x.direction="inactive",(H=x.stop)===null||H===void 0||H.call(x)});const _=await this.peerConnection.createOffer(),b=this.logSDPExchange(_.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(_),this.remoteSDP.stopReceiving(i);const P=this.remoteSDP.toString();b==null||b(P),await this.peerConnection.setRemoteDescription({type:"answer",sdp:P})}catch(p){throw new _a(_i.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(p.toString()))}finally{l&&l()}}async receive(i,s,l,p){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(i," before remoteSDP created."));const{mid:_,needExchangeSDP:b}=this.remoteSDP.send(i,s,l,p);if(b){const x=this.remoteSDP.toString(),H=this.logSDPExchange(x,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:x});const B=await this.peerConnection.createAnswer(),z=this.mungReceiveAnswerSDP(B.sdp,_,i);H==null||H(z||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:z}),_e.debug("[NVExtentionsConnection] receive ".concat(i," by exchanging SDP."))}else _e.debug("[NVExtentionsConnection] receive ".concat(i," no need to exchange SDP."));const P=this.peerConnection.getTransceivers().find(x=>x.mid===_);if(!P)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:P.receiver.track,id:_}}catch(_){throw new _a(_i.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(_.toString()))}}async batchReceive(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:l}=this.remoteSDP.batchSend(i);if(l){const p=this.remoteSDP.toString(),_=this.logSDPExchange(p,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:p});const b=await this.peerConnection.createAnswer();_==null||_(b.sdp||""),await this.peerConnection.setLocalDescription(b),_e.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else _e.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return s.map(p=>{const _=this.peerConnection.getTransceivers().find(b=>b.mid===p);if(!_)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:_.receiver.track,id:p}})}catch(s){throw new _a(_i.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(i);const s=this.remoteSDP.toString(),l=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const p=await this.peerConnection.createAnswer();l==null||l(p.sdp||""),await this.peerConnection.setLocalDescription(p)}catch(s){throw new _a(_i.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(i," before remote SDP created."));this.remoteSDP.mute(i);const s=this.remoteSDP.toString(),l=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const p=await this.peerConnection.createAnswer();l==null||l(p.sdp||""),await this.peerConnection.setLocalDescription(p)}catch(s){throw new _a(_i.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(i," before remote SDP created."));this.remoteSDP.unmute(i);const s=this.remoteSDP.toString(),l=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const p=await this.peerConnection.createAnswer();l==null||l(p.sdp||""),await this.peerConnection.setLocalDescription(p)}catch(s){throw new _a(_i.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(b=>b.mid&&i.indexOf(b.mid)!==-1);if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(b=>{b.direction="inactive"});const l=await this.peerConnection.createOffer(),p=this.logSDPExchange(l.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(l),this.remoteSDP.muteRemote(i);const _=this.remoteSDP.toString();p==null||p(_),await this.peerConnection.setRemoteDescription({type:"answer",sdp:_})}catch(s){throw new _a(_i.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(b=>b.mid&&i.indexOf(b.mid)!==-1);if(s.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(b,P)=>{b.direction="sendonly"});const l=await this.peerConnection.createOffer(),p=this.logSDPExchange(l.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(l),this.remoteSDP.unmuteRemote(i);const _=this.remoteSDP.toString();p==null||p(_),await this.peerConnection.setRemoteDescription({type:"answer",sdp:_})}catch(s){throw new _a(_i.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(i){var s=this;return pS(function*(){const l=yield HE(s.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(M_().supportPCSetConfiguration){const H=s.peerConnection.getConfiguration(),B=i===Fg.RELAY?"relay":"all";H.iceTransportPolicy!==B&&(_e.debug("restartICE change iceTransportPolicy from [".concat(H.iceTransportPolicy,"] to [").concat(B,"]")),H.iceTransportPolicy=B,s.peerConnection.setConfiguration(H))}else if(i===Fg.RELAY)return;i!==Fg.RELAY&&s.remoteSDP.updateCandidates(i);const p=yield HE(s.peerConnection.createOffer({iceRestart:!0}));if(!p.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const _=JR(p.sdp),{remoteIceParameters:b}=yield _.iceParameters;s.remoteSDP.restartICE(b);const P=s.remoteSDP.toString(),x=s.logSDPExchange(p.sdp||"","offer","local","restartICE");yield HE(s.peerConnection.setLocalDescription(p)),x==null||x(P),yield HE(s.peerConnection.setRemoteDescription({type:"answer",sdp:P}))}catch(p){_e.warning("restart ICE failed, abort operation",p)}finally{l()}})()}close(){var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}async updateEncoderConfig(i,s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const l=await this.peerConnection.createOffer(),p=this.mungSendOfferSDP(l.sdp,[s],[i]);this.remoteSDP.updateRecvMedia(i,s);const _=this.remoteSDP.toString(),b=this.logSDPExchange(p,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:p}),b==null||b(_),await this.peerConnection.setRemoteDescription({type:"answer",sdp:_})}catch(l){throw new _a(_i.EXCHANGE_SDP_FAILED,l.toString())}}async updateSendParameters(i,s){const l=this.peerConnection.getTransceivers().filter(p=>p.mid===i);l.length===1&&(this.isVP8Simulcast(s)?A_()||await this.applySimulcastEncodings(l,[s]):await this.applySendEncodings(l,[s]))}setStatsRemoteVideoIsReady(i,s){this.statsFilter.setVideoIsReady2(i,s)}async replaceTrack(i,s){const l=this.peerConnection.getTransceivers().find(p=>p.mid===s);l&&await l.sender.replaceTrack(i._mediaStreamTrack)}getP2PConnectionParams(){var i;if((i=this.peerConnection.currentLocalDescription)===null||i===void 0||!i.sdp||!this.localCapabilities)throw new Error;return tN(tN({},JR(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,_e.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,_e.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},kc("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const s={iceServers:[]};return i.iceServers?s.iceServers=i.iceServers:i.turnServer&&i.turnServer.mode!=="off"&&(i0(i.turnServer.servers)?s.iceServers=i.turnServer.servers:(s.iceServers&&s.iceServers.push(...sN.turnServerConfigToIceServers(i.turnServer.servers)),kc("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&i.turnServer.serversFromGateway&&s.iceServers.push(...sN.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),kc("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(l=>{l.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(i){const s=[];return i.forEach(l=>{l.security?l.tcpport&&s.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(UO(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}):(l.udpport&&!kc("FORCE_TURN_TCP")&&s.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.udpport,"?transport=udp")}),l.tcpport&&s.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=tcp")}))}),s}async applySendEncodings(i,s){try{if(!M_().supportSetRtpSenderParameters||i.length!==s.length)return;for(let H=0;H<i.length;H++){const B=i[H],z=s[H];if(z&&z instanceof q_){var l,p;if(this.isVP8Simulcast(z))continue;const Wt={},_r={};switch(z._optimizationMode){case"motion":Wt.degradationPreference="maintain-framerate";break;case"detail":Wt.degradationPreference="maintain-resolution";break;default:Wt.degradationPreference="balanced"}var _,b,P,x;if((l=z._encoderConfig)!==null&&l!==void 0&&l.bitrateMax&&(_r.maxBitrate=1e3*((_=z._encoderConfig)===null||_===void 0?void 0:_.bitrateMax)),z._hints.includes(X_.LOW_STREAM)&&((b=z._encoderConfig)!==null&&b!==void 0&&b.frameRate&&(_r.maxFramerate=JS(z._encoderConfig.frameRate)),(P=z._encoderConfig)!==null&&P!==void 0&&P.scaleResolutionDownBy&&((x=z._encoderConfig)===null||x===void 0?void 0:x.scaleResolutionDownBy)>1&&(_r.scaleResolutionDownBy=z._encoderConfig.scaleResolutionDownBy)),kc("DSCP_TYPE")&&LR()){const Gi=kc("DSCP_TYPE");["very-low","low","medium","high"].includes(Gi)&&(_r.networkPriority=Gi)}const Di=B.sender.getParameters(),Fi=(p=Di.encodings)===null||p===void 0?void 0:p[0];A_()&&!Fi&&(Wt.encodings=[_r]),Fi&&Object.assign(Fi,_r),Object.assign(Di,Wt),await B.sender.setParameters(Di)}}}catch{_e.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(i,s,l){const p=W_.exports.parse(i);return s.forEach((_,b)=>{const P=l[b],x=p.mediaDescriptions.find(H=>H.attributes.mid===P);x&&(MI(x,_),BG(x,_,this.store.codec))}),W_.exports.print(p)}mungReceiveAnswerSDP(i,s,l){const p=W_.exports.parse(i),_=p.mediaDescriptions.find(b=>b.attributes.mid===s);return _&&l===VE.AUDIO&&_.media.mediaType==="audio"&&mR(_),W_.exports.print(p)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,s,l)=>{var p;(p=this.onFirstVideoDecoded)===null||p===void 0||p.call(this,i,s,l)},this.statsFilter.onSelectedLocalCandidateChanged=(i,s)=>{var l;(l=this.onSelectedLocalCandidateChanged)===null||l===void 0||l.call(this,i,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,s)=>{var l;(l=this.onSelectedRemoteCandidateChanged)===null||l===void 0||l.call(this,i,s)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(i,s){if(i.length===s.length)for(let P=0;P<i.length;P++){var l,p,_,b;const x=i[P],H=s[P];if(H instanceof q_&&!H._hints.includes(X_.LOW_STREAM)&&(l=H._encoderConfig)!==null&&l!==void 0&&l.bitrateMax&&((p=H._encoderConfig)===null||p===void 0?void 0:p.bitrateMax)>200&&(_=H._scalabiltyMode)!==null&&_!==void 0&&_.numSpatialLayers&&((b=H._scalabiltyMode)===null||b===void 0?void 0:b.numSpatialLayers)>1&&this.store.codec==="vp8"){const B={},z={high:1e3*(H._encoderConfig.bitrateMax-50),medium:5e4};B.encodings=[{rid:"m",active:!0,maxBitrate:z.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:z.high}];const Wt=x.sender.getParameters();await x.sender.setParameters(Object.assign(Wt,B))}}}async applySimulcastEncodings(i,s){if(!A_()&&i.length===s.length)for(let l=0;l<i.length;l++){const p=s[l];if(p instanceof q_&&this.isVP8Simulcast(p)){const _=i[l],b={},P={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};b.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:P.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:P.medium,scaleResolutionDownBy:4}];const x=_.sender.getParameters();await _.sender.setParameters(Object.assign(x,b))}}}isVP8Simulcast(i){var s,l,p,_;return!!(i instanceof q_&&kc("SIMULCAST")&&this.store.codec==="vp8"&&!i._hints.includes(X_.LOW_STREAM)&&(s=i._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((l=i._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(p=i._scalabiltyMode)!==null&&p!==void 0&&p.numSpatialLayers&&((_=i._scalabiltyMode)===null||_===void 0?void 0:_.numSpatialLayers)>1)}logSDPExchange(i,s,l,p){if(kc("SDP_LOGGING"))return _e.upload("exchanging ".concat(l," ").concat(s," SDP during NVExtentionsConnection.").concat(p,`
`),i),s==="offer"?_=>{this.logSDPExchange(_,"answer",l==="local"?"remote":"local",p)}:void 0}async getRemoteSSRC(i){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(i);return s==null?void 0:s[0].ssrcId}setConfiguration(i){if(M_().supportPCSetConfiguration){const s=sN.resolvePCConfiguration(i);this.peerConnection.setConfiguration(s)}}}).prototype,"connect",[YT],Object.getOwnPropertyDescriptor(c_.prototype,"connect"),c_.prototype),iE(c_.prototype,"updateRemoteConnect",[YT],Object.getOwnPropertyDescriptor(c_.prototype,"updateRemoteConnect"),c_.prototype),iE(c_.prototype,"receive",[YT],Object.getOwnPropertyDescriptor(c_.prototype,"receive"),c_.prototype),iE(c_.prototype,"batchReceive",[YT],Object.getOwnPropertyDescriptor(c_.prototype,"batchReceive"),c_.prototype),iE(c_.prototype,"stopReceiving",[YT],Object.getOwnPropertyDescriptor(c_.prototype,"stopReceiving"),c_.prototype),iE(c_.prototype,"muteRemote",[YT],Object.getOwnPropertyDescriptor(c_.prototype,"muteRemote"),c_.prototype),iE(c_.prototype,"unmuteRemote",[YT],Object.getOwnPropertyDescriptor(c_.prototype,"unmuteRemote"),c_.prototype),iE(c_.prototype,"muteLocal",[YT],Object.getOwnPropertyDescriptor(c_.prototype,"muteLocal"),c_.prototype),iE(c_.prototype,"unmuteLocal",[YT],Object.getOwnPropertyDescriptor(c_.prototype,"unmuteLocal"),c_.prototype),iE(c_.prototype,"close",[YT],Object.getOwnPropertyDescriptor(c_.prototype,"close"),c_.prototype),iE(c_.prototype,"updateEncoderConfig",[YT],Object.getOwnPropertyDescriptor(c_.prototype,"updateEncoderConfig"),c_.prototype),iE(c_.prototype,"updateSendParameters",[YT],Object.getOwnPropertyDescriptor(c_.prototype,"updateSendParameters"),c_.prototype),iE(c_.prototype,"replaceTrack",[YT],Object.getOwnPropertyDescriptor(c_.prototype,"replaceTrack"),c_.prototype),iE(c_.prototype,"getRemoteSSRC",[YT],Object.getOwnPropertyDescriptor(c_.prototype,"getRemoteSSRC"),c_.prototype),c_);function YT(r,i,s){const l=r[i];if(typeof l!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const p=this.mutex,_=await p.lock("From NVExtentionsConnection.".concat(i));try{for(var b=arguments.length,P=new Array(b),x=0;x<b;x++)P[x]=arguments[x];return await l.apply(this,P)}finally{_()}},s}var m_;function O4(r){var i,s,l,p=2;for(typeof Symbol<"u"&&(s=MG,l=Symbol.iterator);p--;){if(s&&(i=r[s])!=null)return i.call(r);if(l&&(i=r[l])!=null)return new VL(i.call(r));s="@@asyncIterator",l="@@iterator"}throw new TypeError("Object is not async iterable")}function VL(r){function i(s){if(Object(s)!==s)return SE.reject(new TypeError(s+" is not an object."));var l=s.done;return SE.resolve(s.value).then(function(p){return{value:p,done:l}})}return(VL=function(s){this.s=s,this.n=s.next}).prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(s){var l=this.s.return;return l===void 0?SE.resolve({value:s,done:!0}):i(l.apply(this.s,arguments))},throw:function(s){var l=this.s.return;return l===void 0?SE.reject(s):i(l.apply(this.s,arguments))}},new VL(r)}let vR=(iE((m_=class aN extends CO{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(i,s){super(i,s),$(this,"store",void 0),$(this,"peerConnection",void 0),$(this,"cname",void 0),$(this,"mutex",new mT("DataChannelConnection-mutex")),$(this,"dataChannel",void 0),$(this,"_p2pConnection",void 0),$(this,"establishPromise",void 0),$(this,"_nvMedia",void 0),this.store=s,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(aN.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new BQ(i,s,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var i;const s=(i=this._nvMedia)===null||i===void 0?void 0:i.getLocalRtpCapabilities();return await this._p2pConnection.establish(s)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(i,s,l,p,_,b){return this.cname=b,await this._p2pConnection.connect(i,s,l,p,_,b),await new SE((P,x)=>{const H=setTimeout(()=>{this.closeSignal(),x(new _a(_i.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(l))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(H),void P()},this.dataChannel.onerror=B=>{this.closeSignal(),x(B)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}send(i,s,l){var p=this;return pS(function*(){const _=yield HE(p.mutex.lock("From DataChannelConnection.send"));try{return yield*JO(O4(p._p2pConnection.send(i,s,l)),HE)}finally{_()}})()}async stopSending(i,s){return this._p2pConnection.stopSending(i,s)}async receive(i,s,l,p){return this._nvMedia?(_e.debug("[DataChannelConnection] receive ".concat(i," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(i,s,this.cname)):(_e.debug("[DataChannelConnection] receive ".concat(i," by WebRTC.")),await this._p2pConnection.receive(i,s,l,p))}async batchReceive(i){return[...await this._p2pConnection.batchReceive(i)]}async stopReceiving(i){return await this._p2pConnection.stopReceiving(i)}async muteRemote(i){return await this._p2pConnection.muteRemote(i)}async unmuteRemote(i){return await this._p2pConnection.unmuteRemote(i)}async muteLocal(i){return await this._p2pConnection.muteLocal(i)}async unmuteLocal(i){return await this._p2pConnection.unmuteLocal(i)}restartICE(i){var s=this;return pS(function*(){return yield*JO(O4(s._p2pConnection.restartICE(i)),HE)})()}close(){var i;(i=this._nvMedia)===null||i===void 0||i.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(i){return this._p2pConnection.getRemoteVideoIsReady(i)}updateRemoteConnect(i){var s;(s=this._nvMedia)===null||s===void 0||s.setRemoteRtpCapabilities(i),this._p2pConnection.updateRemoteConnect(i)}async updateEncoderConfig(i,s){return await this._p2pConnection.updateEncoderConfig(i,s)}async updateSendParameters(i,s){return await this._p2pConnection.updateSendParameters(i,s)}setStatsRemoteVideoIsReady(i,s){this._p2pConnection.setStatsRemoteVideoIsReady(i,s)}async replaceTrack(i,s){return await this._p2pConnection.replaceTrack(i,s)}async getRemoteSSRC(i){return this._p2pConnection.getRemoteSSRC(i)}logSDPExchange(i,s,l,p){if(kc("SDP_LOGGING"))return _e.upload("exchanging ".concat(l," ").concat(s," SDP during DataChannelConnection.").concat(p,`
`),i),s==="offer"?_=>{this.logSDPExchange(_,"answer",l==="local"?"remote":"local",p)}:void 0}static resolvePCConfiguration(i){const s={iceServers:[]};return i.iceServers?s.iceServers=i.iceServers:i.turnServer&&i.turnServer.mode!=="off"&&(i0(i.turnServer.servers)?s.iceServers=i.turnServer.servers:(s.iceServers&&s.iceServers.push(...aN.turnServerConfigToIceServers(i.turnServer.servers)),kc("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&i.turnServer.serversFromGateway&&s.iceServers.push(...aN.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),kc("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(l=>{l.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(i){const s=[];return i.forEach(l=>{l.security?l.tcpport&&s.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(UO(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}):(l.udpport&&!kc("FORCE_TURN_TCP")&&s.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.udpport,"?transport=udp")}),l.tcpport&&s.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=tcp")}))}),s}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=i=>{var s;return(s=this.onICEConnectionStateChange)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onConnectionStateChange=i=>{var s;return(s=this.onConnectionStateChange)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onDTLSTransportStateChange=i=>{var s;return(s=this.onDTLSTransportStateChange)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onDTLSTransportError=i=>{var s;return(s=this.onDTLSTransportError)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onICETransportStateChange=i=>{var s;return(s=this.onICETransportStateChange)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onFirstAudioReceived=i=>{var s;return(s=this.onFirstAudioReceived)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onFirstVideoReceived=i=>{var s;return(s=this.onFirstVideoReceived)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onFirstAudioDecoded=i=>{var s;return(s=this.onFirstAudioDecoded)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onFirstVideoDecoded=(i,s,l)=>{var p;return(p=this.onFirstVideoDecoded)===null||p===void 0?void 0:p.call(this,i,s,l)},this._p2pConnection.onFirstVideoDecodedTimeout=i=>{var s;return(s=this.onFirstVideoDecodedTimeout)===null||s===void 0?void 0:s.call(this,i)},this._p2pConnection.onSelectedLocalCandidateChanged=(i,s)=>{var l;return(l=this.onSelectedLocalCandidateChanged)===null||l===void 0?void 0:l.call(this,i,s)},this._p2pConnection.onSelectedRemoteCandidateChanged=(i,s)=>{var l;return(l=this.onSelectedRemoteCandidateChanged)===null||l===void 0?void 0:l.call(this,i,s)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0}setConfiguration(i){this._p2pConnection.setConfiguration(i)}}).prototype,"connect",[ES],Object.getOwnPropertyDescriptor(m_.prototype,"connect"),m_.prototype),iE(m_.prototype,"receive",[ES],Object.getOwnPropertyDescriptor(m_.prototype,"receive"),m_.prototype),iE(m_.prototype,"stopReceiving",[ES],Object.getOwnPropertyDescriptor(m_.prototype,"stopReceiving"),m_.prototype),iE(m_.prototype,"muteRemote",[ES],Object.getOwnPropertyDescriptor(m_.prototype,"muteRemote"),m_.prototype),iE(m_.prototype,"unmuteRemote",[ES],Object.getOwnPropertyDescriptor(m_.prototype,"unmuteRemote"),m_.prototype),iE(m_.prototype,"muteLocal",[ES],Object.getOwnPropertyDescriptor(m_.prototype,"muteLocal"),m_.prototype),iE(m_.prototype,"unmuteLocal",[ES],Object.getOwnPropertyDescriptor(m_.prototype,"unmuteLocal"),m_.prototype),iE(m_.prototype,"close",[ES],Object.getOwnPropertyDescriptor(m_.prototype,"close"),m_.prototype),iE(m_.prototype,"updateEncoderConfig",[ES],Object.getOwnPropertyDescriptor(m_.prototype,"updateEncoderConfig"),m_.prototype),iE(m_.prototype,"updateSendParameters",[ES],Object.getOwnPropertyDescriptor(m_.prototype,"updateSendParameters"),m_.prototype),iE(m_.prototype,"replaceTrack",[ES],Object.getOwnPropertyDescriptor(m_.prototype,"replaceTrack"),m_.prototype),iE(m_.prototype,"getRemoteSSRC",[ES],Object.getOwnPropertyDescriptor(m_.prototype,"getRemoteSSRC"),m_.prototype),m_);function ES(r,i,s){const l=r[i];if(typeof l!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const p=this.mutex,_=await p.lock("From DataChannelConnection.".concat(i));try{for(var b=arguments.length,P=new Array(b),x=0;x<b;x++)P[x]=arguments[x];return await l.apply(this,P)}finally{_()}},s}var ZE;function A4(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function yR(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?A4(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):A4(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}function C4(r){var i,s,l,p=2;for(typeof Symbol<"u"&&(s=MG,l=Symbol.iterator);p--;){if(s&&(i=r[s])!=null)return i.call(r);if(l&&(i=r[l])!=null)return new FL(i.call(r));s="@@asyncIterator",l="@@iterator"}throw new TypeError("Object is not async iterable")}function FL(r){function i(s){if(Object(s)!==s)return SE.reject(new TypeError(s+" is not an object."));var l=s.done;return SE.resolve(s.value).then(function(p){return{value:p,done:l}})}return(FL=function(s){this.s=s,this.n=s.next}).prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(s){var l=this.s.return;return l===void 0?SE.resolve({value:s,done:!0}):i(l.apply(this.s,arguments))},throw:function(s){var l=this.s.return;return l===void 0?SE.reject(s):i(l.apply(this.s,arguments))}},new FL(r)}let GQ=(iE((ZE=class extends I_{get state(){return this._state}set state(r){const i=this._state;this._state=r,this.emit(XE.StateChange,i,this._state)}constructor(r,i){super(),$(this,"store",void 0),$(this,"statsUploader",void 0),$(this,"connection",void 0),$(this,"localTrackMap",new Map),$(this,"remoteUserMap",new Map),$(this,"pendingLocalTracks",[]),$(this,"pendingRemoteTracks",[]),$(this,"statsCollector",void 0),$(this,"isPlanB",!1),$(this,"shouldForwardP2PCreation",void 0),$(this,"iceFailedCount",0),$(this,"dtlsFailedCount",0),$(this,"mutex",new mT("P2PChannel-mutex")),$(this,"_state",Q_.Disconnected),$(this,"_pcStatsUploadType",kc("NEW_ICE_RESTART")?SS.FIRST_CONNECTION:SS.OLD_FIRST_CONNECTION),$(this,"_isInRestartIce",!1),$(this,"_isStartRestartIce",!1),$(this,"_restartStates",["disconnected","failed"]),$(this,"_restartTimer",void 0),$(this,"_isFirstConnected",!0),$(this,"handleMuteLocalTrack",async(s,l,p)=>{const _=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Q_.Connected)return void p(new _a(_i.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const b=this.filterTobeMutedTracks(s);if(b.length===0)return void l();const P=b.find(H=>H[0]==="videoLowTrack");P&&P[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(b.map(H=>{let[,{id:B}]=H;return B}));const x=this.createMuteMessage(b);await N_(this,XE.RequestMuteLocal,x),l()}catch(b){p(b)}finally{_()}}),$(this,"handleUnmuteLocalTrack",async(s,l,p)=>{const _=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Q_.Connected)return void p(new _a(_i.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const b=this.filterTobeUnmutedTracks(s);if(b.length===0)return void l();const P=b.find(H=>H[0]==="videoLowTrack");if(P){const H=P[1];if(H.track._originMediaStreamTrack.stop(),M_().supportDualStreamEncoding){const B=s._mediaStreamTrack.clone();H.track._mediaStreamTrack=B,H.track._originMediaStreamTrack=B}else{const B=a4(s,KR(this,XE.RequestLowStreamParameter));H.track._mediaStreamTrack=B,H.track._originMediaStreamTrack=B}await new SE((B,z)=>{this.handleReplaceTrack(H.track,B,z,!0)})}await this.connection.unmuteLocal(b.map(H=>{let[,{id:B}]=H;return B}));const x=this.createUnmuteMessage(b);await N_(this,XE.RequestUnmuteLocal,x),l()}catch(b){p(b)}finally{_()}}),$(this,"handleUpdateVideoEncoder",async(s,l,p)=>{const _=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const b=this.localTrackMap.get(IE.LocalVideoTrack);if(!this.connection||!b||b.track!==s||this.state!==Q_.Connected)return void l();const{id:P,track:x}=b;await this.connection.updateSendParameters(P,x),await this.connection.updateEncoderConfig(P,x),this.emit(XE.UpdateVideoEncoder,x),l()}catch(b){p(b)}finally{_()}}),$(this,"handleSetOptimizationMode",async(s,l,p)=>{const _=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const b=this.localTrackMap.get(IE.LocalVideoTrack);if(!this.connection||!b||b.track!==s||this.state!==Q_.Connected)return;const{id:P,track:x}=b;await this.connection.updateSendParameters(P,x),l()}catch(b){p(b)}finally{_()}}),$(this,"handleReplaceTrack",async(s,l,p,_)=>{let b;_e.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof _=="boolean"&&_||(b=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var P;const H=Array.from(this.localTrackMap.entries()).find(B=>{let[,{track:z}]=B;return s===z});if(!this.connection||!H||this.state!==Q_.Connected)return void l();if(await((P=this.connection)===null||P===void 0?void 0:P.replaceTrack(s,H[1].id)),this.isPlanB){const B=H[1];B.id=s._mediaStreamTrack.id,this.localTrackMap.set(H[0],B)}if(H[0]===IE.LocalVideoTrack&&M_().supportDualStreamEncoding){const B=this.localTrackMap.get(IE.LocalVideoLowTrack);if(B){const z=s._mediaStreamTrack.clone();B.track._originMediaStreamTrack.stop(),B.track._mediaStreamTrack=z,B.track._originMediaStreamTrack=z,await new SE((Wt,_r)=>{this.handleReplaceTrack(B.track,Wt,_r,!0)})}}l()}catch(H){p(H)}finally{var x;(x=b)===null||x===void 0||x()}}),$(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),$(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),$(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),$(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=r,this.statsCollector=i,this.statsCollector.addP2PChannel(this),this.statsUploader=new VQ,this.bindStatsUploaderEvents(),this.isPlanB=!M_().supportUnifiedPlan||kc("CHROME_FORCE_PLAN_B")&&LR(),this.shouldForwardP2PCreation=kc("FORWARD_P2P_CREATION")&&M_().supportPCSetConfiguration,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new vR({},this.store):this.isPlanB?new b0({},this.store):new $S({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(r,i){var s;this.state=Q_.New;const l=this.shouldForwardP2PCreation&&((s=this.connection)===null||s===void 0?void 0:s.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!l||(l&&this.connection&&(_e.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new vR(r,this.store):this.isPlanB?new b0(r,this.store):new $S(r,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new _a(_i.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=kc("NEW_ICE_RESTART")?SS.FIRST_CONNECTION:SS.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(r),this.connection.establishPromise}async connect(r,i,s,l,p,_){if(!this.connection)throw new _a(_i.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof vR?this.connection.updateRemoteConnect(l):(this.store.peerConnectionStart(),await this.connection.connect(r,i,s,l,p,_),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Q_.Connected)}async preConnect(r,i,s,l,p,_){if(!this.connection)throw new _a(_i.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const b=await this.connection.connect(r,i,s,l,p,_);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Q_.Connected,b}getEstablishParams(){if(this.connection instanceof vR)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publish(r,i,s){var l=this;return pS(function*(){const p=yield HE(l.mutex.lock("From P2PChannel.publish"));try{if(!l.connection||l.state!==Q_.Connected){if(l.state===Q_.Disconnected)throw new _a(_i.UNEXPECTED_ERROR,"PeerConnection already disconnected.");l.throwIfTrackTypeNotMatch(r);const b=r.filter(P=>l.pendingLocalTracks.indexOf(P)===-1);return void(l.pendingLocalTracks=l.pendingLocalTracks.concat(b))}l.store.pubId=l.store.pubId+1,ZT.markPublishStart(l.store.clientId,l.store.pubId);const _=l.filterTobePublishedTracks(r,i,s);if(_.length===0)return void(yield HE(l.tryToUnmuteAudio(r)));yield*JO(C4(l.doPublish(l.connection,_)),HE)}finally{p()}})()}doPublish(r,i){var s=this;return pS(function*(){i.forEach(H=>{let{track:B,type:z}=H;const Wt=Date.now();s.store.publish(B.getTrackId(),z===IE.LocalAudioTrack?"audio":"video",Wt)}),s.bindLocalTrackEvents(i);const l=yield HE(r.send(i.map(H=>{let{track:B}=H;return B}),s.store.codec,s.store.audioCodec)),p=(yield HE(l.next())).value,_=s.createGatewayPublishMessage(i,p);let b;try{b=yield _}catch(H){throw l.throw(H),(H==null?void 0:H.code)===_i.WS_ABORT&&i.forEach(B=>{let{track:z}=B;s.pendingLocalTracks.indexOf(z)===-1&&s.pendingLocalTracks.push(z)}),s.unbindLocalTrackEvents(i),H}const P=s.mapPubResToRemoteConfig(_,b),x=(yield HE(l.next(P))).value;i.forEach(H=>{let{type:B}=H;s.statsCollector.addLocalStats(B)}),s.assignLocalTracks(i,x),s.statsUploader.startUploadUplinkStats(),i.forEach(H=>{let{track:B,type:z}=H;const Wt=Date.now();s.store.publish(B.getTrackId(),z===IE.LocalAudioTrack?"audio":"video",void 0,Wt)})})()}publishLowStream(r){var i=this;return pS(function*(){if(!i.connection||i.state!==Q_.Connected)return;const s=yield HE(i.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const p=i.localTrackMap.get(IE.LocalVideoTrack);if(!p)throw new _a(_i.UNEXPECTED_ERROR,"Could not find high stream");if(i.localTrackMap.has(IE.LocalVideoLowTrack))throw new _a(_i.UNEXPECTED_ERROR,"[".concat(i.store.clientId,"] Can't publish low stream when stream already publish"));const _=[{track:i.getLowVideoTrack(p.track,r),type:IE.LocalVideoLowTrack}];if(yield*JO(C4(i.doPublish(i.connection,_)),HE),p.track.muted||!p.track.enabled){var l;const b=(l=i.localTrackMap.get(IE.LocalVideoLowTrack))===null||l===void 0?void 0:l.id;b!==void 0&&(yield HE(i.connection.muteLocal([b])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(_e.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await aT(this,XE.RequestRePublish,this.pendingLocalTracks),this.emit(XE.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async reSubscribe(r){for(let i=this.pendingRemoteTracks.length-1;i>=0;i--){const{user:s,kind:l}=this.pendingRemoteTracks[i];(l!==VE.AUDIO||s._audio_added_&&s._audioSSRC)&&(l!==VE.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(i,1)}if(r)await aT(this,XE.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:i,kind:s}of this.pendingRemoteTracks)await this.subscribe(i,s,s===VE.VIDEO?i._videoSSRC:i._audioSSRC);this.pendingRemoteTracks.forEach(i=>{let{user:s}=i;this.emit(XE.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(r){if(!this.connection||this.state!==Q_.Connected)return void r.forEach(l=>{const p=this.pendingLocalTracks.indexOf(l);p!==-1&&this.pendingLocalTracks.splice(p,1)});const i=this.filterTobeUnpublishedTracks(r);if(i.length===0)return;const s=i.find(l=>l[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,i)}async unpublishLowStream(){if(!this.connection||this.state!==Q_.Connected)return;const r=this.localTrackMap.get(IE.LocalVideoLowTrack);if(!r)return;r.track.close();const i=[[IE.LocalVideoLowTrack,r]];return this.doUnpublish(this.connection,i)}async doUnpublish(r,i){const s=this.createGatewayUnpublishMessage(i);return await r.stopSending(i.map(l=>{let[,{id:p}]=l;return p})),this.withdrawLocalTracks(i),this.unbindLocalTrackEvents(i.map(l=>{let[p,{track:_}]=l;return{type:p,track:_}})),i.forEach(l=>{let[p]=l;this.statsCollector.removeLocalStats(p)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats(),s}async subscribe(r,i,s,l,p){var _;if(!this.connection||this.state!==Q_.Connected)throw new _a(_i.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((_=this.remoteUserMap.get(r))!==null&&_!==void 0&&_.has(i))return;let b,P,x;if(p){const z=p.find(_r=>{let{stream_type:Di}=_r;return Di===i});if(!z)throw new _a(_i.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(i," for user: ").concat(r.uid," because subscribe answer from gateway does not contain stream_type: ").concat(i,"."));const Wt=await this.connection.receive(i,z.ssrcs,String(r._uintid),z.attributes);this.connection instanceof $S&&(x=Wt.transceiver),b=Wt.track,P=Wt.id}else{const z=await this.connection.receive(i,[{ssrcId:s,rtx:l}],String(r._uintid),void 0);this.connection instanceof $S&&(x=z.transceiver),b=z.track,P=z.id}i===VE.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(b):(r._audioTrack=new _C(b,r.uid,r._uintid,this.store),_e.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),x&&r._audioTrack._updateRtpTransceiver(x),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(b):(r._videoTrack=new _A(b,r.uid,r._uintid,this.store),_e.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),x&&r._videoTrack._updateRtpTransceiver(x),this.bindRemoteTrackEvents(r,r._videoTrack));const H=this.remoteUserMap.get(r);H?H.set(i,P):this.remoteUserMap.set(r,new Map([[i,P]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadDownlinkStats();const B=this.pendingRemoteTracks.findIndex(z=>{let{user:Wt,kind:_r}=z;return Wt.uid===r.uid&&i===_r});B!==-1&&(this.pendingRemoteTracks.splice(B,1),this.emit(XE.MediaReconnectEnd,r.uid))}async massSubscribe(r){return this.massSubscribeNoLock(r)}async massSubscribeNoLock(r){if(!this.connection||this.state!==Q_.Connected)throw new _a(_i.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");r=r.filter(s=>{var l;let{user:p,mediaType:_}=s;return!((l=this.remoteUserMap.get(p))!==null&&l!==void 0&&l.has(_))});const i=await this.connection.batchReceive(r.map(s=>{let{user:l,mediaType:p,ssrcId:_,rtxSsrcId:b}=s;return{kind:p,ssrcMsg:[{ssrcId:_,rtx:b}],mslabel:String(l._uintid)}}));r.forEach((s,l)=>{let{user:p,mediaType:_}=s;const{track:b,id:P,transceiver:x}=i[l];_===VE.AUDIO?(p._audioTrack?p._audioTrack._updateOriginMediaStreamTrack(b):(p._audioTrack=new _C(b,p.uid,p._uintid,this.store),_e.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(p._audioTrack.getTrackId()))),x&&p._audioTrack._updateRtpTransceiver(x),this.bindRemoteTrackEvents(p,p._audioTrack)):(p._videoTrack?p._videoTrack._updateOriginMediaStreamTrack(b):(p._videoTrack=new _A(b,p.uid,p._uintid,this.store),_e.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(p._videoTrack.getTrackId()))),x&&p._videoTrack._updateRtpTransceiver(x),this.bindRemoteTrackEvents(p,p._videoTrack));const H=this.remoteUserMap.get(p);H?H.set(_,P):this.remoteUserMap.set(p,new Map([[_,P]])),this.statsCollector.addRemoteStats(p.uid),this.statsUploader.startUploadDownlinkStats();const B=this.pendingRemoteTracks.findIndex(z=>{let{user:Wt,kind:_r}=z;return Wt.uid===p.uid&&_===_r});B!==-1&&(this.pendingRemoteTracks.splice(B,1),this.emit(XE.MediaReconnectEnd,p.uid))})}async unsubscribe(r,i,s){const l=this.pendingRemoteTracks.filter(b=>{let{user:P,kind:x}=b;return i!==void 0?P.uid===r.uid&&i===x:P.uid===r.uid});if(l.forEach(b=>{const P=this.pendingRemoteTracks.indexOf(b);this.pendingRemoteTracks.splice(P,1)}),this.connection&&this.state===Q_.Connected||s||l.forEach(b=>{let{kind:P}=b;var x;if(P===VE.AUDIO)(x=r._audioTrack)===null||x===void 0||x._destroy(),r._audioTrack=void 0;else if(P===VE.VIDEO){var H;(H=r._videoTrack)===null||H===void 0||H._destroy(),r._videoTrack=void 0}}),!this.connection||this.state!==Q_.Connected)return;const p=this.filterTobeUnSubscribedTracks(r,i);if(p.length===0)return;await this.connection.stopReceiving(p.map(b=>{let[,{id:P}]=b;return P}));const _=this.createUnsubscribeMessage(p);return this.withdrawRemoteTracks(p),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),p.forEach(b=>{let[P,{kind:x}]=b;var H,B;if(x===VE.VIDEO&&P._videoSSRC&&((H=this.connection)===null||H===void 0||H.setStatsRemoteVideoIsReady(P._videoSSRC,!1)),x===VE.VIDEO)this.unbindRemoteTrackEvents(P._videoTrack),s||((B=P._videoTrack)===null||B===void 0||B._destroy(),P._videoTrack=void 0);else if(x===VE.AUDIO){var z;this.unbindRemoteTrackEvents(P._audioTrack),!s&&((z=P._audioTrack)===null||z===void 0||z._destroy(),P._audioTrack=void 0)}}),_}async massUnsubscribe(r){return this.massUnsubscribeNoLock(r)}async massUnsubscribeNoLock(r){let i=[];for(const{user:p,mediaType:_}of r){const b=this.pendingRemoteTracks.filter(P=>{let{user:x,kind:H}=P;return _!==void 0?x.uid===p.uid&&_===H:x.uid===p.uid});b.forEach(P=>{const x=this.pendingRemoteTracks.indexOf(P);this.pendingRemoteTracks.splice(x,1)}),i=i.concat(b)}if(!this.connection||this.state!==Q_.Connected)return void i.forEach(p=>{let{user:_,kind:b}=p;var P;if(b===VE.AUDIO)(P=_._audioTrack)===null||P===void 0||P._destroy(),_._audioTrack=void 0;else if(b===VE.VIDEO){var x;(x=_._videoTrack)===null||x===void 0||x._destroy(),_._videoTrack=void 0}});const s=iR(r).call(r,(p,_)=>{let{user:b,mediaType:P}=_;const x=this.filterTobeUnSubscribedTracks(b,P);return p.concat(x)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(p=>{let[,{id:_}]=p;return _}));const l=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),s.forEach(p=>{let[_,{kind:b}]=p;var P,x;if(b===VE.VIDEO&&_._videoSSRC&&((P=this.connection)===null||P===void 0||P.setStatsRemoteVideoIsReady(_._videoSSRC,!1)),b===VE.VIDEO)this.unbindRemoteTrackEvents(_._videoTrack),(x=_._videoTrack)===null||x===void 0||x._destroy(),_._videoTrack=void 0;else if(b===VE.AUDIO){var H;this.unbindRemoteTrackEvents(_._audioTrack),(H=_._audioTrack)===null||H===void 0||H._destroy(),_._audioTrack=void 0}}),l}async muteRemote(r,i){if(!this.connection)return;const s=this.remoteUserMap.get(r);if(!s)return void _e.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(r.uid,"."));if(!s.get(i))return void _e.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(r.uid," media type ").concat(i,"."));const l=i===VE.VIDEO?r._videoSSRC:r._audioSSRC;l!==void 0&&this.connection.setStatsRemoteVideoIsReady(l,!1)}async unmuteRemote(r,i){return this.unmuteRemoteNoLock(r,i)}async unmuteRemoteNoLock(r,i){if(!this.connection)return;const s=this.remoteUserMap.get(r);if(!s)return void _e.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(r.uid,"."));s.get(i)||_e.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(r.uid," media type ").concat(i,"."))}getAllTracks(r){const i=this.localTrackMap.get(IE.LocalAudioTrack);if((i==null?void 0:i.track)instanceof AT){const s=i.track;return Array.from(this.localTrackMap.entries()).filter(l=>{let[p]=l;return p!==IE.LocalAudioTrack}).filter(l=>{let[p]=l;return!(r&&p===IE.LocalVideoLowTrack)}).map(l=>{let[,{track:p}]=l;return p}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[l]=s;return!(r&&l===IE.LocalVideoLowTrack)}).map(s=>{let[,{track:l}]=s;return l})}reportPublishEvent(r,i,s,l,p){if(r){const b=this.localTrackMap.get(IE.LocalAudioTrack),P=l?this.localTrackMap.get(IE.LocalVideoLowTrack):this.localTrackMap.get(IE.LocalVideoTrack);AE.publish(this.store.sessionId,{eventElapse:ZT.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:r,ec:i,audioName:b==null?void 0:b.track.getTrackLabel(),videoName:P==null?void 0:P.track.getTrackLabel(),screenshare:(P==null?void 0:P.track._hints.indexOf(X_.SCREEN_TRACK))!==-1,audio:!!b,video:!!P,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:p})}else{var _;s||(s=[]);const b=s.find(x=>x instanceof oT),P=l?(_=this.localTrackMap.get(IE.LocalVideoTrack))===null||_===void 0?void 0:_.track:s.find(x=>x instanceof q_);AE.publish(this.store.sessionId,{eventElapse:ZT.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:r,ec:i,audioName:b==null?void 0:b.getTrackLabel(),videoName:P==null?void 0:P.getTrackLabel(),screenshare:(P==null?void 0:P._hints.indexOf(X_.SCREEN_TRACK))!==-1,audio:!!b,video:!!P,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:p})}}reportSubscribeEvent(r,i,s,l){const p=l===VE.VIDEO?s._videoSSRC:s._audioSSRC;p&&AE.subscribe(this.store.sessionId,{succ:r,ec:i,video:l===VE.VIDEO,audio:l===VE.AUDIO,peerid:s.uid,subscribeRequestid:l===VE.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:ZT.measureFromSubscribeStart(this.store.clientId,p)})}reset(){_e.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new mT("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new vR({},this.store):this.isPlanB?new b0({},this.store):new $S({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const r=this.localTrackMap.get(IE.LocalAudioTrack);if((r==null?void 0:r.track)instanceof AT){if(r.track.trackList.length>0){const i=r.track;r.track.trackList.forEach(s=>{i.removeAudioTrack(s)})}r.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=Q_.Disconnected}getStats(){var r;return(r=this.connection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(r){var i;return((i=this.connection)===null||i===void 0?void 0:i.getRemoteVideoIsReady(r))||!1}getLocalAudioVolume(){const r=this.localTrackMap.get(IE.LocalAudioTrack);if(r)return r.track.getVolumeLevel()}getLocalVideoSize(){const r=this.localTrackMap.get(IE.LocalVideoTrack);if(r)return{width:r.track._videoWidth||0,height:r.track._videoHeight||0}}getEncoderConfig(r){const i=this.localTrackMap.get(r);return i&&i.track instanceof q_||i&&i.track instanceof oT?i.track._encoderConfig:void 0}getLocalMedia(r){return this.localTrackMap.get(r)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(r,i){if(!r)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(r);return!!s&&(!i||s.has(i))}async hasRemoteMediaWithLock(r,i){if(!r)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(r);return!!s&&(!i||s.has(i))}getRemoteMedia(r){var i;const s=Array.from(BR(i=this.remoteUserMap).call(i)).find(l=>l.uid===r);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let r=Array.from(this.remoteUserMap.entries()).map(s=>{let[l]=s;return{uid:l.uid,level:l.audioTrack?100*l.audioTrack._source.getAccurateVolumeLevel():0}});const i=this.localTrackMap.get(IE.LocalAudioTrack);return i&&r.push({level:100*i.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),r=OP(r).call(r,(s,l)=>s.level-l.level),r}async disconnectForReconnect(){this.connection&&(_e.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Q_.Reconnecting,kc("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(r=>{let[i]=r;var s;i._videoTrack&&i._videoTrack._player&&((s=i._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),i._videoTrack._player.isKeepLastFrame=!0,i._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new vR({},this.store):this.isPlanB?new b0({},this.store):new $S({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:s}]=r;switch(i){case IE.LocalVideoTrack:s._hints.includes(X_.LOW_STREAM)?s.close():this.pendingLocalTracks.push(s);break;case IE.LocalAudioTrack:s instanceof AT?this.pendingLocalTracks=this.pendingLocalTracks.concat(s.trackList):this.pendingLocalTracks.push(s);break;case IE.LocalVideoLowTrack:}}),this.emit(XE.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(r=>{let[i,s]=r;Array.from(BR(s).call(s)).forEach(l=>{this.setPendingRemoteMedia(i,l)}),this.emit(XE.MediaReconnectStart,i.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),_e.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(r,i){for(const s of this.pendingRemoteTracks){const{user:l,kind:p}=s;if((r instanceof hL?r.uid:r)===l.uid&&i===p)return!0}return!1}setPendingRemoteMedia(r,i){this.hasPendingRemoteMedia(r,i)||this.pendingRemoteTracks.push({user:r,kind:i})}restartICE(r){var i=this;return pS(function*(){if(!i.connection||i.state!==Q_.Connected||i.connection instanceof vR)return;const s=yield HE(i.mutex.lock("From P2PChannel.restartICE"));let l;try{l=yield HE(i.connection.restartICE(r));const _=yield HE(l.next());if(_.done)return;const b=_.value,P=yield b;switch(i.reportPCDisconnectedOrFailed(r),r){case Fg.TCP:i._pcStatsUploadType=SS.TCP_RESTART;break;case Fg.RELAY:i._pcStatsUploadType=SS.RELAY_RESTART;break;default:i._pcStatsUploadType=SS.OLD_RESTART}i._isInRestartIce=!0,l.next(P)}catch(_){var p;(p=l)===null||p===void 0||p.throw(_)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const r=this.connection.getStats(),i=this.localTrackMap.get(IE.LocalVideoTrack),s=this.localTrackMap.get(IE.LocalAudioTrack),l=r.videoSend.find(_r=>_r.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId)),p=r.audioSend.find(_r=>_r.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!l||!p)return 1;const _=hS(this,XE.NeedSignalRTT),b=l?l.rttMs:void 0,P=p?p.rttMs:void 0,x=b&&P?(b+P)/2:b||P,H=(x&&_?(x+_)/2:x||_)||0,B=100*r.sendPacketLossRate*.7/50+.3*H/1500,z=B<.17?1:B<.36?2:B<.59?3:B<.1?4:5,Wt=i==null?void 0:i.track;if(Wt&&Wt._encoderConfig&&Wt._hints.indexOf(X_.SCREEN_TRACK)===-1){const _r=Wt._encoderConfig.bitrateMax,Di=r.bitrate.actualEncoded;if(_r&&Di){const Fi=(1e3*_r-Di)/(1e3*_r);return g7[Fi<.15?0:Fi<.3?1:Fi<.45?2:Fi<.6?3:4][z]}}return z}getDownlinkNetworkQuality(){if(!this.connection)return 0;const r=this.connection.getStats();let i=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[l]=s;const p=l._audioSSRC,_=l._videoSSRC,b=r.audioRecv.find(Di=>Di.ssrc===p),P=r.videoRecv.find(Di=>Di.ssrc===_);if(!b&&!P)return void(i+=1);const x=hS(this,XE.NeedSignalRTT),H=r.rtt,B=(H&&x?(H+x)/2:H||x)||0,z=b?b.jitterMs:void 0,Wt=r.recvPacketLossRate;let _r=.7*Wt*100/50+.3*B/1500;z&&(_r=.6*Wt*100/50+.2*B/1500+.2*z/400),i+=_r<.1?1:_r<.17?2:_r<.36?3:_r<.59?4:5}),this.remoteUserMap.size>0?Math.round(i/this.remoteUserMap.size):i}async muteLocalTrack(r){return new SE((i,s)=>{this.handleMuteLocalTrack(r,i,s)})}filterTobePublishedTracks(r,i,s){const l=[],p=M_(),_=this.getAllTracks();r=VF(r=r.filter(x=>_.indexOf(x)===-1));let b=!1,P=!1;for(const x of r){if(x instanceof q_&&(this.localTrackMap.has(IE.LocalVideoTrack)||b?new _a(_i.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(l.push({track:x,type:IE.LocalVideoTrack}),b=!0),i)){const H=this.getLowVideoTrack(x,s);l.push({track:H,type:IE.LocalVideoLowTrack})}if(x instanceof oT){const H=this.localTrackMap.get(IE.LocalAudioTrack);if(H){if(!(H.track instanceof AT))throw new _a(_i.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(x._bypassWebAudio)throw new _a(_i.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");H.track.addAudioTrack(x),this.bindLocalAudioTrackEvents(x,!0)}else if(P){const B=l.find(z=>{let{type:Wt}=z;return Wt===IE.LocalAudioTrack});if(!(B.track instanceof AT))throw new _a(_i.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(x._bypassWebAudio)throw new _a(_i.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");B.track.addAudioTrack(x)}else{if(!p.webAudioMediaStreamDest||x instanceof AT||x._bypassWebAudio)l.push({track:x,type:IE.LocalAudioTrack});else{const B=new AT;B.addAudioTrack(x),l.push({track:B,type:IE.LocalAudioTrack})}P=!0}}}return l}filterTobeUnpublishedTracks(r){const i=[],s=this.getAllTracks();r=VF(r=r.filter(l=>s.indexOf(l)!==-1));for(const l of r){if(l instanceof oT){const p=this.localTrackMap.get(IE.LocalAudioTrack);if(!p)continue;p.track instanceof AT?(p.track.removeAudioTrack(l),this.unbindLocalAudioTrackEvents(l),p.track.trackList.length===0&&(i.push([IE.LocalAudioTrack,p]),p.track.close())):i.push([IE.LocalAudioTrack,p])}if(l instanceof q_){const p=this.localTrackMap.get(IE.LocalVideoTrack);if(!p)continue;i.push([IE.LocalVideoTrack,p]);const _=this.localTrackMap.get(IE.LocalVideoLowTrack);_&&i.push([IE.LocalVideoLowTrack,_])}}return i}bindLocalTrackEvents(r){r.forEach(i=>{let{track:s,type:l}=i;switch(l){case IE.LocalVideoTrack:s.addListener(ME.GET_STATS,this.handleGetLocalVideoStats),s.addListener(ME.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(ME.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(ME.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(ME.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),s.addListener(ME.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(ME.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(ME.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case IE.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);break;case IE.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(r,i){r instanceof AT?r.trackList.forEach(s=>{s.addListener(ME.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(ME.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(ME.GET_STATS,this.handleGetLocalAudioStats),s.addListener(ME.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(ME.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(r.addListener(ME.GET_STATS,this.handleGetLocalAudioStats),r.addListener(ME.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(ME.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(ME.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(ME.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),i||r.addListener(ME.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(r){r||(r=Array.from(this.localTrackMap.entries()).map(i=>{let[s,{track:l}]=i;return{track:l,type:s}})),r.forEach(i=>{let{track:s,type:l}=i;switch(l){case IE.LocalVideoTrack:s.off(ME.GET_STATS,this.handleGetLocalVideoStats),s.off(ME.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(ME.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(ME.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(ME.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),s.off(ME.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(ME.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(ME.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case IE.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);break;case IE.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(r){r instanceof AT?r.trackList.forEach(i=>{i.off(ME.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(ME.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(ME.GET_STATS,this.handleGetLocalAudioStats),i.off(ME.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(ME.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(r.off(ME.GET_STATS,this.handleGetLocalAudioStats),r.off(ME.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(ME.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(ME.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(ME.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(ME.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(r,i){i instanceof _A&&i.addListener(ME.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(r))}),i instanceof _C&&i.addListener(ME.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(r))})}unbindRemoteTrackEvents(r){r&&r.removeAllListeners(ME.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(r=>{let[i,s]=r;s.has(VE.AUDIO)&&this.unbindRemoteTrackEvents(i._audioTrack),s.has(VE.VIDEO)&&this.unbindRemoteTrackEvents(i._videoTrack)})}createGatewayPublishMessage(r,i){return r.map((s,l)=>{let p,_,{track:b,type:P}=s;switch(P){case IE.LocalAudioTrack:p=z_.Audio,_={dtx:b instanceof LO&&b._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case IE.LocalVideoTrack:p=b._hints.includes(X_.SCREEN_TRACK)?z_.Screen:z_.High,_=yR(yR({},MF(b)),{},{codec:this.store.codec});break;case IE.LocalVideoLowTrack:p=z_.Low,_=yR(yR({},MF(b)),{},{codec:this.store.codec})}return{stream_type:p,attributes:_,ssrcs:i[l]}})}createGatewayUnpublishMessage(r){return r.map(i=>{let s,[l,{track:p,ssrcs:_,id:b}]=i;switch(l){case IE.LocalVideoTrack:s=p._hints.includes(X_.SCREEN_TRACK)?z_.Screen:z_.High;break;case IE.LocalAudioTrack:s=z_.Audio;break;case IE.LocalVideoLowTrack:s=z_.Low}return{stream_type:s,ssrcs:_,mid:b}})}assignLocalTracks(r,i){r.forEach((s,l)=>{let{track:p,type:_}=s;this.localTrackMap.set(_,{track:p,id:i[l].id,ssrcs:i[l].localSSRC})})}withdrawLocalTracks(r){r.forEach(i=>{let[s]=i;this.localTrackMap.delete(s)})}bindConnectionEvents(r){r.onConnectionStateChange=async i=>{if(_e.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(i,")")),this.emit(XE.PeerConnectionStateChange,i),i!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),i==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),kc("NEW_ICE_RESTART")){if(this._restartStates.includes(i)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=_=>{(r.iceConnectionState==="disconnected"||r.iceConnectionState==="checking"||r.iceConnectionState==="failed")&&(_e.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(_)),hS(this,XE.QueryClientConnectionState)==="CONNECTED"&&this.emit(XE.RequestRestartICE,_))},l=()=>{r.iceConnectionState!=="disconnected"&&r.iceConnectionState!=="checking"&&r.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),_e.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(XE.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},p=kc("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(kc("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&M_().supportPCSetConfiguration)s(Fg.RELAY),this._restartTimer=window.setTimeout(l,p);else if(A_())s(Fg.UDP),this._restartTimer=window.setTimeout(l,4e3);else{if(s(Fg.TCP),M_().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{s(Fg.RELAY),this._restartTimer=window.setTimeout(l,p)},p));this._restartTimer=window.setTimeout(l,p)}},800))}}else{if(i==="disconnected"&&r.iceConnectionState==="disconnected")return setTimeout(()=>{r.iceConnectionState==="disconnected"&&kc("ICE_RESTART")&&hS(this,XE.QueryClientConnectionState)==="CONNECTED"&&this.emit(XE.RequestRestartICE)},800),void setTimeout(()=>{r.peerConnectionState==="disconnected"&&(_e.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(XE.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);i==="failed"&&(_e.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(XE.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},r.onICEConnectionStateChange=i=>{i!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),_e.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(i,")")),AE.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:i,tag:S_.TRACER}).onSuccess(),this.emit(XE.IceConnectionStateChange,i)},r.onICETransportStateChange=i=>{_e.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(i,")"))},r.onDTLSTransportStateChange=i=>{_e.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(i,")"))},r.onDTLSTransportError=i=>{_e.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(i,")"))},r.onFirstAudioDecoded=i=>{var s;const l=Array.from(BR(s=this.remoteUserMap).call(s)).find(_=>_._audioSSRC===i);var p;l&&(this.store.subscribe(l.uid,"audio",void 0,void 0,void 0,Date.now()),(p=l.audioTrack)===null||p===void 0||p.emit(SI.FIRST_FRAME_DECODED),AE.firstRemoteFrame(this.store.sessionId,_g.FIRST_AUDIO_DECODE,O_.FIRST_AUDIO_DECODE,{peer:l._uintid,subscribeElapse:ZT.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId}))},r.onFirstAudioReceived=i=>{var s;const l=Array.from(BR(s=this.remoteUserMap).call(s)).find(p=>p._audioSSRC===i);l&&AE.firstRemoteFrame(this.store.sessionId,_g.FIRST_AUDIO_RECEIVED,O_.FIRST_AUDIO_RECEIVED,{peer:l._uintid,subscribeElapse:ZT.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId})},r.onFirstVideoDecoded=(i,s,l)=>{this.reportVideoFirstFrameDecoded(i,s,l)},r.onFirstVideoReceived=i=>{var s;const l=Array.from(BR(s=this.remoteUserMap).call(s)).find(p=>p._videoSSRC===i);l&&AE.firstRemoteFrame(this.store.sessionId,_g.FIRST_VIDEO_RECEIVED,O_.FIRST_VIDEO_RECEIVED,{peer:l._uintid,subscribeElapse:ZT.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId})},r.onSelectedLocalCandidateChanged=(i,s)=>{const l=i.candidateType==="relay",p=s.candidateType==="relay";s.candidateType!=="unknown"&&l===p||this.emit(XE.ConnectionTypeChange,l),_e.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(xO(s))," -> ").concat(JSON.stringify(xO(i)),")"))},r.onSelectedRemoteCandidateChanged=(i,s)=>{_e.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(xO(s))," -> ").concat(JSON.stringify(xO(i)),")"))},r.onFirstVideoDecodedTimeout=i=>{this.reportVideoFirstFrameDecoded(i,void 0,void 0,!0)}}unbindConnectionEvents(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(r){const i=[];if(this.getAllTracks().indexOf(r)===-1)return i;const s=this.localTrackMap.get(IE.LocalAudioTrack);if(r instanceof oT&&(s==null?void 0:s.track)instanceof AT)return s.track.isActive||i.push([IE.LocalAudioTrack,s]),i;const l=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:_}]=p;return r===_});if(l&&(i.push(l),l[0]===IE.LocalVideoTrack)){const p=this.localTrackMap.get(IE.LocalVideoLowTrack);p&&i.push([IE.LocalVideoLowTrack,p])}return i}filterTobeUnmutedTracks(r){const i=[],s=this.localTrackMap.get(IE.LocalAudioTrack);if(r instanceof oT&&(s==null?void 0:s.track)instanceof AT)return s.track.isActive&&i.push([IE.LocalAudioTrack,s]),i;const l=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:_}]=p;return r===_});if(l)if(l[0]===IE.LocalVideoTrack){i.push(l);const p=this.localTrackMap.get(IE.LocalVideoLowTrack);p&&i.push([IE.LocalVideoLowTrack,p])}else i.push(l);return i}createMuteMessage(r){return r.map(i=>{let s,[l,{track:p,ssrcs:_,id:b}]=i;switch(l){case IE.LocalAudioTrack:s=z_.Audio;break;case IE.LocalVideoTrack:s=p._hints.includes(X_.SCREEN_TRACK)?z_.Screen:z_.High;break;case IE.LocalVideoLowTrack:s=z_.Low}return{stream_type:s,ssrcs:_,mid:b}})}createUnmuteMessage(r){return r.map(i=>{let s,[l,{track:p,ssrcs:_,id:b}]=i;switch(l){case IE.LocalAudioTrack:s=z_.Audio;break;case IE.LocalVideoTrack:s=p._hints.includes(X_.SCREEN_TRACK)?z_.Screen:z_.High;break;case IE.LocalVideoLowTrack:s=z_.Low}return{stream_type:s,ssrcs:_,mid:b}})}filterTobeUnSubscribedTracks(r,i){const s=[],l=this.remoteUserMap.get(r);if(!l)return s;if(i){const p=l.get(i);if(!p)return s;s.push([r,{kind:i,id:p}])}else Array.from(l.entries()).forEach(p=>{let[_,b]=p;s.push([r,{kind:_,id:b}])});return s}createUnsubscribeMessage(r){const i=[];return r.forEach(s=>{let[l,{kind:p,id:_}]=s;switch(p){case VE.VIDEO:return void(l._videoSSRC&&i.push({stream_type:VE.VIDEO,ssrcId:l._videoSSRC}));case VE.AUDIO:return void(l._audioSSRC&&i.push({stream_type:VE.AUDIO,ssrcId:l._audioSSRC}))}}),i}createUnsubscribeAllMessage(r){const i=new Map;return r.forEach(s=>{let[l,{kind:p}]=s;if(i.has(l)){let _=i.get(l);p===VE.VIDEO?_|=F_.Video:_|=F_.Audio,i.set(l,_)}else p===VE.VIDEO?i.set(l,F_.Video):i.set(l,F_.Audio)}),{users:Array.from(i.entries()).map(s=>{let[l,p]=s;return{stream_id:l.uid,stream_type:p}})}}withdrawRemoteTracks(r){r.forEach(i=>{let[s,{kind:l}]=i;const p=this.remoteUserMap.get(s);p&&(p.delete(l),Array.from(p.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(r){const i=this.localTrackMap.get(IE.LocalVideoTrack),s=this.localTrackMap.get(IE.LocalVideoLowTrack);i&&await i.track.setBitrateLimit(r.uplink),s&&r.low_stream_uplink&&await s.track.setBitrateLimit({max_bitrate:r.low_stream_uplink.bitrate,min_bitrate:r.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(r,i){return r.map((s,l)=>{var p;let{stream_type:_}=s;return(p=i.find(b=>{let{stream_type:P}=b;return _===P}))===null||p===void 0?void 0:p.attributes})}async tryToUnmuteAudio(r){for(let s=0;s<r.length;s++)if(r[s]instanceof oT){var i;const l=this.filterTobeUnmutedTracks(r[s]);if(l.length===0)continue;await((i=this.connection)===null||i===void 0?void 0:i.unmuteLocal(l.map(_=>{let[,{id:b}]=_;return b})));const p=this.createUnmuteMessage(l);return void await N_(this,XE.RequestUnmuteLocal,p)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=r=>{var i;return!((i=this.connection)===null||i===void 0||!i.getRemoteVideoIsReady(r))},this.statsUploader.requestUpload=(r,i)=>this.emit(XE.RequestUploadStats,r,i),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await sT(_P(this.dtlsFailedCount,j_)),this.emit(XE.RequestReconnect)}async reconnectP2P(){const r=Array.from(this.localTrackMap.entries()),i=this.createGatewayUnpublishMessage(r);Array.from(this.remoteUserMap.entries()),i.length>0&&await aT(this,XE.RequestUnpublishForReconnectPC,i),this.disconnectForReconnect(),this.emit(XE.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(IE.LocalVideoTrack)||this.pendingLocalTracks.some(r=>r instanceof q_)}throwIfTrackTypeNotMatch(r){if(r.filter(i=>i instanceof q_).length>1)throw new _a(_i.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r.filter(i=>i instanceof oT).length>1&&(r.some(i=>i instanceof oT&&i._bypassWebAudio)||!M_().webAudioMediaStreamDest))throw new _a(_i.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const i of r){if(i instanceof q_&&this.pendingLocalTracks.some(s=>s instanceof q_))throw new _a(_i.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i instanceof oT&&this.pendingLocalTracks.some(s=>s instanceof oT)&&(!M_().webAudioMediaStreamDest||i._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof oT&&s._bypassWebAudio)))throw new _a(_i.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(r,i){const s=M_().supportDualStreamEncoding,l=yR(yR({},{width:160,height:120,framerate:15,bitrate:50}),i);let p;p=s?r._mediaStreamTrack.clone():a4(r,l);const _=b_(8,"track-low-"),b=new q_(p,yR(yR({},s&&{scaleResolutionDownBy:bX(l,r)}),{},{frameRate:l.framerate,bitrateMax:l.bitrate,bitrateMin:l.bitrate}),void 0,void 0,_);return b.on(o0.TRANSCEIVER_UPDATED,P=>{r._updateRtpTransceiver(P,TI.LOW_STREAM)}),b._hints.push(X_.LOW_STREAM),r.addListener(ME.NEED_CLOSE,()=>{b.close()}),b}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(r,i,s){let l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof $S){var p,_,b,P;const x=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:H,dtlsTransportState:B,peerConnectionState:z}=this.connection,{local:Wt,remote:_r}=await this.connection.getSelectedCandidatePair();AE.pcStats(this.store.sessionId,{startTime:x,eventElapse:r-x||0,iceconnectionsate:H,dtlsstate:B,connectionstate:z,intSucc:i?1:2,error:l,selectedLocalCandidateProtocol:(p=Wt==null?void 0:Wt.protocol)!==null&&p!==void 0?p:"",selectedLocalCandidateType:(_=Wt.candidateType)!==null&&_!==void 0?_:"",selectedLocalCandidateAddress:"".concat(Wt.address,":").concat(Wt.port),selectedRemoteCandidateProtocol:(b=_r.protocol)!==null&&b!==void 0?b:"",selectedRemoteCandidateType:(P=_r.candidateType)!==null&&P!==void 0?P:"",selectedRemoteCandidateAddress:"".concat(_r.address,":").concat(_r.port),restartCnt:s})}}reportVideoFirstFrameDecoded(r,i,s,l){var p;const _=Array.from(BR(p=this.remoteUserMap).call(p)).find(b=>b._videoSSRC===r);if(_){l||this.store.subscribe(_.uid,"video",void 0,void 0,void 0,void 0,Date.now());const b=this.store.keyMetrics,P=b.subscribe.find(x=>x.userId===_.uid&&x.type==="video");AE.firstRemoteVideoDecode(this.store.sessionId,_g.FIRST_VIDEO_DECODE,O_.FIRST_VIDEO_DECODE,{peer:_._uintid,videowidth:i,videoheight:s,subscribeElapse:ZT.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId,apEnd:b.requestAPEnd||0,apStart:b.requestAPStart||0,joinGwEnd:b.joinGatewayEnd||0,joinGwStart:b.joinGatewayStart||0,pcEnd:b.peerConnectionEnd||0,pcStart:b.peerConnectionStart||0,subscriberEnd:(P==null?void 0:P.subscribeEnd)||0,subscriberStart:(P==null?void 0:P.subscribeStart)||0,videoAddNotify:(P==null?void 0:P.streamAdded)||0,state:l?1:0})}}async remoteMediaSsrcChanged(r,i,s){if(!this.connection)return!1;const l=this.remoteUserMap.get(r);if(!l)return!1;const p=l.get(i);if(!p)return!1;const _=await this.connection.getRemoteSSRC(p);return _!==void 0&&_!==s}resetConnection(r){_e.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(r)),this.state===Q_.Connected?(_e.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=r===OO.datachannel?new vR({},this.store):this.isPlanB?new b0({},this.store):new $S({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:s}]=r;i===IE.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,TI.LOW_STREAM):s._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(r){this.connection&&this.connection instanceof $S&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===SS.TCP_RESTART&&r===Fg.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,SS.DISCONNECTED_OR_FAILED)))}}).prototype,"startP2PConnection",[MT],Object.getOwnPropertyDescriptor(ZE.prototype,"startP2PConnection"),ZE.prototype),iE(ZE.prototype,"connect",[MT],Object.getOwnPropertyDescriptor(ZE.prototype,"connect"),ZE.prototype),iE(ZE.prototype,"preConnect",[MT],Object.getOwnPropertyDescriptor(ZE.prototype,"preConnect"),ZE.prototype),iE(ZE.prototype,"unpublish",[MT],Object.getOwnPropertyDescriptor(ZE.prototype,"unpublish"),ZE.prototype),iE(ZE.prototype,"unpublishLowStream",[MT],Object.getOwnPropertyDescriptor(ZE.prototype,"unpublishLowStream"),ZE.prototype),iE(ZE.prototype,"subscribe",[MT],Object.getOwnPropertyDescriptor(ZE.prototype,"subscribe"),ZE.prototype),iE(ZE.prototype,"massSubscribe",[MT],Object.getOwnPropertyDescriptor(ZE.prototype,"massSubscribe"),ZE.prototype),iE(ZE.prototype,"unsubscribe",[MT],Object.getOwnPropertyDescriptor(ZE.prototype,"unsubscribe"),ZE.prototype),iE(ZE.prototype,"massUnsubscribe",[MT],Object.getOwnPropertyDescriptor(ZE.prototype,"massUnsubscribe"),ZE.prototype),iE(ZE.prototype,"muteRemote",[MT],Object.getOwnPropertyDescriptor(ZE.prototype,"muteRemote"),ZE.prototype),iE(ZE.prototype,"unmuteRemote",[MT],Object.getOwnPropertyDescriptor(ZE.prototype,"unmuteRemote"),ZE.prototype),iE(ZE.prototype,"hasRemoteMediaWithLock",[MT],Object.getOwnPropertyDescriptor(ZE.prototype,"hasRemoteMediaWithLock"),ZE.prototype),iE(ZE.prototype,"disconnectForReconnect",[MT],Object.getOwnPropertyDescriptor(ZE.prototype,"disconnectForReconnect"),ZE.prototype),iE(ZE.prototype,"updateBitrateLimit",[MT],Object.getOwnPropertyDescriptor(ZE.prototype,"updateBitrateLimit"),ZE.prototype),iE(ZE.prototype,"remoteMediaSsrcChanged",[MT],Object.getOwnPropertyDescriptor(ZE.prototype,"remoteMediaSsrcChanged"),ZE.prototype),ZE);function MT(r,i,s){const l=r[i];if(typeof l!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const p=this.mutex,_=await p.lock("From P2PChannel.".concat(i));try{for(var b=arguments.length,P=new Array(b),x=0;x<b;x++)P[x]=arguments[x];return await l.apply(this,P)}finally{_()}},s}function w4(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function CE(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?w4(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):w4(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}var qE;(function(r){r.SET_SESSION_ID="SET_SESSION_ID",r.SET_P2P_ID="SET_P2P_id",r.SET_DC_ID="SET_DC_id",r.SET_UID="SET_UID",r.SET_PUB_ID="SET_PUB_ID",r.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",r.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",r.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",r.AVOID_JOIN_START="AVOID_JOIN_START",r.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",r.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",r.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",r.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",r.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",r.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",r.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",r.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",r.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",r.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",r.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",r.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",r.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",r.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",r.RESET_KEY_METRICS="RESET_KEY_METRICS",r.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL"})(qE||(qE={}));class qQ{constructor(i,s,l,p){$(this,"state",void 0),this.state={codec:i,audioCodec:s,mode:l,clientId:p,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1}}dispatch(i){this.state=function(s,l){switch(l.type){case qE.SET_SESSION_ID:return CE(CE({},s),{},{sessionId:l.sessionId});case qE.SET_P2P_ID:return CE(CE({},s),{},{p2pId:l.p2pId});case qE.SET_UID:return CE(CE({},s),{},{uid:l.uid});case qE.SET_PUB_ID:return CE(CE({},s),{},{pubId:l.pubId});case qE.KEY_METRIC_CLIENT_CREATED:return CE(CE({},s),{},{keyMetrics:CE(CE({},s.keyMetrics),{},{clientCreated:l.metric})});case qE.KEY_METRIC_JOIN_START:return CE(CE({},s),{},{keyMetrics:CE(CE({},s.keyMetrics),{},{joinStart:l.metric})});case qE.AVOID_JOIN_START:return CE(CE({},s),{},{avoidJoinStart:l.avoidJoinStart});case qE.KEY_METRIC_JOIN_END:return CE(CE({},s),{},{keyMetrics:CE(CE({},s.keyMetrics),{},{joinEnd:l.metric})});case qE.KEY_METRIC_REQUEST_AP_START:return CE(CE({},s),{},{keyMetrics:CE(CE({},s.keyMetrics),{},{requestAPStart:l.metric})});case qE.KEY_METRIC_REQUEST_AP_END:return CE(CE({},s),{},{keyMetrics:CE(CE({},s.keyMetrics),{},{requestAPEnd:l.metric})});case qE.KEY_METRIC_JOIN_GATEWAY_START:return CE(CE({},s),{},{keyMetrics:CE(CE({},s.keyMetrics),{},{joinGatewayStart:l.metric})});case qE.KEY_METRIC_JOIN_GATEWAY_END:return CE(CE({},s),{},{keyMetrics:CE(CE({},s.keyMetrics),{},{joinGatewayEnd:l.metric})});case qE.KEY_METRIC_PEER_CONNECTION_START:return CE(CE({},s),{},{keyMetrics:CE(CE({},s.keyMetrics),{},{peerConnectionStart:l.metric})});case qE.KEY_METRIC_PEER_CONNECTION_END:return CE(CE({},s),{},{keyMetrics:CE(CE({},s.keyMetrics),{},{peerConnectionEnd:l.metric})});case qE.KEY_METRIC_DESCRIPTION_START:return CE(CE({},s),{},{keyMetrics:CE(CE({},s.keyMetrics),{},{descriptionStart:l.metric})});case qE.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return CE(CE({},s),{},{keyMetrics:CE(CE({},s.keyMetrics),{},{signalChannelOpen:l.metric})});case qE.KEY_METRIC_ICE_CONNECTION_END:return CE(CE({},s),{},{keyMetrics:CE(CE({},s.keyMetrics),{},{iceConnectionEnd:l.metric})});case qE.KEY_METRIC_PUBLISH:{const p=s.keyMetrics.publish,_=p.findIndex(b=>b.trackId===l.metric.trackId);return _!==-1?(p[_]=CE(CE({},p[_]),l.metric),CE(CE({},s),{},{keyMetrics:CE(CE({},s.keyMetrics),{},{publish:[...p]})})):CE(CE({},s),{},{keyMetrics:CE(CE({},s.keyMetrics),{},{publish:[...s.keyMetrics.publish,l.metric]})})}case qE.KEY_METRIC_SUBSCRIBE:{const p=s.keyMetrics.subscribe,_=p.findIndex(b=>b.userId===l.metric.userId&&b.type===l.metric.type);return _!==-1?(p[_]=CE(CE({},p[_]),l.metric),CE(CE({},s),{},{keyMetrics:CE(CE({},s.keyMetrics),{},{subscribe:[...p]})})):CE(CE({},s),{},{keyMetrics:CE(CE({},s.keyMetrics),{},{subscribe:[...s.keyMetrics.subscribe,l.metric]})})}case qE.SET_CLOUD_PROXY_SERVER_MODE:return s.cloudProxyServerMode=l.mode,s;case qE.RECORD_JOIN_CHANNEL_SERVICE:return typeof l.index!="number"?s.joinChannelServiceRecords=[...s.joinChannelServiceRecords,l.record]:(s.joinChannelServiceRecords[l.index]=CE(CE({},s.joinChannelServiceRecords[l.index]),l.record),s.joinChannelServiceRecords=[...s.joinChannelServiceRecords]),s;case qE.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return s.joinChannelServiceRecords=[],s;case qE.RESET_KEY_METRICS:return s.keyMetrics={publish:[],subscribe:[]},s;case qE.SET_USE_DATACHANNEL:return CE(CE({},s),{},{useDataChannel:l.val});default:return s}}(this.state,i)}set sessionId(i){this.dispatch({type:qE.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:qE.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:qE.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:qE.SET_UID,uid:i})}get uid(){return this.state.uid}set pubId(i){this.dispatch({type:qE.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:qE.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(i){this.dispatch({type:qE.SET_USE_DATACHANNEL,val:i})}get useDataChannel(){return this.state.useDataChannel}clientCreated(){this.dispatch({type:qE.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:qE.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:qE.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:qE.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:qE.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:qE.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:qE.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:qE.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:qE.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:qE.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:qE.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:qE.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,s,l,p){this.dispatch({type:qE.KEY_METRIC_PUBLISH,metric:CE(CE({trackId:i,type:s},l&&{publishStart:l}),p&&{publishEnd:p})})}subscribe(i,s,l,p,_,b,P){this.dispatch({type:qE.KEY_METRIC_SUBSCRIBE,metric:CE(CE(CE(CE(CE({userId:i,type:s},l&&{subscribeStart:l}),p&&{subscribeEnd:p}),_&&{firstFrame:_}),b&&{streamAdded:b}),P&&{firstDecoded:P})})}massSubscribe(i,s,l,p){i.forEach(_=>{this.dispatch({type:qE.KEY_METRIC_SUBSCRIBE,metric:CE(CE(CE({userId:_.userId,type:_.type},s&&{subscribeStart:s}),l&&{subscribeEnd:l}),p&&{firstFrame:p})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,s){i.service==="gateway"&&Array.isArray(i.urls)&&(i.urls=i.urls.map(l=>l.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof s!="number"?(this.dispatch({type:qE.RECORD_JOIN_CHANNEL_SERVICE,record:CE(CE({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(s<0||s>=this.state.joinChannelServiceRecords.length||this.dispatch({type:qE.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:s}),s)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:qE.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:qE.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(i){this.dispatch({type:qE.AVOID_JOIN_START,avoidJoinStart:i})}}let eN;const WQ=()=>(eN||eN||(eN=(window.location.protocol.split(":")[0]||"").toUpperCase(),eN))==="HTTPS",N4=()=>window.isSecureContext!==void 0;function KQ(r){let i=k4();return function(s,l){let p=s.appId;p!==void 0&&(n_(l,10),xS(l,p));let _=s.cid;_!==void 0&&(n_(l,16),n_(l,_));let b=s.cname;b!==void 0&&(n_(l,26),xS(l,b));let P=s.deviceId;P!==void 0&&(n_(l,34),xS(l,P));let x=s.elapse;x!==void 0&&(n_(l,40),bR(l,x));let H=s.fileSize;H!==void 0&&(n_(l,48),bR(l,xI(H)));let B=s.height;B!==void 0&&(n_(l,56),bR(l,xI(B)));let z=s.jpg;z!==void 0&&(n_(l,66),n_(l,z.length),function(wT,eE){let uE=jI(wT,eE.length);wT.bytes.set(eE,uE)}(l,z));let Wt=s.networkType;Wt!==void 0&&(n_(l,72),bR(l,xI(Wt)));let _r=s.osType;_r!==void 0&&(n_(l,80),bR(l,xI(_r)));let Di=s.requestId;Di!==void 0&&(n_(l,90),xS(l,Di));let Fi=s.sdkVersion;Fi!==void 0&&(n_(l,98),xS(l,Fi));let Gi=s.sequence;Gi!==void 0&&(n_(l,104),bR(l,xI(Gi)));let _p=s.sid;_p!==void 0&&(n_(l,114),xS(l,_p));let _f=s.timestamp;_f!==void 0&&(n_(l,120),bR(l,_f));let cE=s.uid;cE!==void 0&&(n_(l,128),n_(l,cE));let RE=s.vid;RE!==void 0&&(n_(l,136),n_(l,RE));let dE=s.width;dE!==void 0&&(n_(l,144),bR(l,xI(dE)));let lE=s.service;lE!==void 0&&(n_(l,152),n_(l,lE));let oE=s.callbackData;oE!==void 0&&(n_(l,162),xS(l,oE));let EE=s.jpgEncryption;EE!==void 0&&(n_(l,168),n_(l,EE));let r_=s.requestType;r_!==void 0&&(n_(l,176),n_(l,r_));let DE=s.scorePorn;DE!==void 0&&(n_(l,185),KL(l,DE));let g_=s.scoreSexy;g_!==void 0&&(n_(l,193),KL(l,g_));let l_=s.scoreNeutral;l_!==void 0&&(n_(l,201),KL(l,l_));let x_=s.scene;x_!==void 0&&(n_(l,208),n_(l,x_));let _y=s.ossFilePrefix;_y!==void 0&&(n_(l,218),xS(l,_y));let L_=s.serviceVendor;if(L_!==void 0)for(let wT of L_){n_(l,226);let eE=k4();zQ(wT,eE),n_(l,eE.limit),$Q(l,eE),QQ(eE)}}(r,i),function(s){let l=s.bytes,p=s.limit;return l.length===p?l:l.subarray(0,p)}(i)}function HQ(r){return function(s){let l={};t:for(;!L4(s);){let p=jS(s);switch(p>>>3){case 0:break t;case 1:l.code=jS(s);break;case 2:l.msg=M4(s,jS(s));break;case 3:{let _=JQ(s);l.data=YQ(s),s.limit=_;break}default:D4(s,7&p)}}return l}({bytes:i=r,offset:0,limit:i.length});var i}function YQ(r){let i={};t:for(;!L4(r);){let s=jS(r);switch(s>>>3){case 0:break t;case 1:i.requestId=M4(r,jS(r));break;case 2:i.requestType=jS(r)>>>0;break;case 3:i.scorePorn=WL(r);break;case 4:i.scoreSexy=WL(r);break;case 5:i.scoreNeutral=WL(r);break;case 6:i.requestScene=jS(r)>>>0;break;case 7:i.scene=jS(r)>>>0;break;default:D4(r,7&s)}}return i}function zQ(r,i){let s=r.service;s!==void 0&&(n_(i,8),n_(i,s));let l=r.vendor;l!==void 0&&(n_(i,16),n_(i,l));let p=r.token;p!==void 0&&(n_(i,26),xS(i,p));let _=r.callbackUrl;_!==void 0&&(n_(i,34),xS(i,_))}function JQ(r){let i=jS(r),s=r.limit;return r.limit=r.offset+i,s}function D4(r,i){switch(i){case 0:for(;128&U4(r););break;case 2:GL(r,jS(r));break;case 5:GL(r,4);break;case 1:GL(r,8);break;default:throw new Error("Unimplemented type: "+i)}}let XQ=new Float32Array(1);new Uint8Array(XQ.buffer);let BL=new Float64Array(1),CT=new Uint8Array(BL.buffer);function xI(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}let P4=[];function k4(){const r=P4.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}function QQ(r){P4.push(r)}function GL(r,i){if(r.offset+i>r.limit)throw new Error("Skip past limit");r.offset+=i}function L4(r){return r.offset>=r.limit}function jI(r,i){let s=r.bytes,l=r.offset,p=r.limit,_=l+i;if(_>s.length){let b=new Uint8Array(2*_);b.set(s),r.bytes=b}return r.offset=_,_>p&&(r.limit=_),l}function qL(r,i){let s=r.offset;if(s+i>r.limit)throw new Error("Read past limit");return r.offset+=i,s}function M4(r,i){let s=qL(r,i),l=String.fromCharCode,p=r.bytes,_="ï¿½",b="";for(let P=0;P<i;P++){let x,H,B,z,Wt=p[P+s];128&Wt?(224&Wt)==192?P+1>=i?b+=_:(x=p[P+s+1],(192&x)!=128?b+=_:(z=(31&Wt)<<6|63&x,z<128?b+=_:(b+=l(z),P++))):(240&Wt)==224?P+2>=i?b+=_:(x=p[P+s+1],H=p[P+s+2],(49344&(x|H<<8))!=32896?b+=_:(z=(15&Wt)<<12|(63&x)<<6|63&H,z<2048||z>=55296&&z<=57343?b+=_:(b+=l(z),P+=2))):(248&Wt)==240?P+3>=i?b+=_:(x=p[P+s+1],H=p[P+s+2],B=p[P+s+3],(12632256&(x|H<<8|B<<16))!=8421504?b+=_:(z=(7&Wt)<<18|(63&x)<<12|(63&H)<<6|63&B,z<65536||z>1114111?b+=_:(z-=65536,b+=l(55296+(z>>10),56320+(1023&z)),P+=3))):b+=_:b+=l(Wt)}return b}function xS(r,i){let s=i.length,l=0;for(let b=0;b<s;b++){let P=i.charCodeAt(b);P>=55296&&P<=56319&&b+1<s&&(P=(P<<10)+i.charCodeAt(++b)-56613888),l+=P<128?1:P<2048?2:P<65536?3:4}n_(r,l);let p=jI(r,l),_=r.bytes;for(let b=0;b<s;b++){let P=i.charCodeAt(b);P>=55296&&P<=56319&&b+1<s&&(P=(P<<10)+i.charCodeAt(++b)-56613888),P<128?_[p++]=P:(P<2048?_[p++]=P>>6&31|192:(P<65536?_[p++]=P>>12&15|224:(_[p++]=P>>18&7|240,_[p++]=P>>12&63|128),_[p++]=P>>6&63|128),_[p++]=63&P|128)}}function $Q(r,i){let s=jI(r,i.limit),l=r.bytes,p=i.bytes;for(let _=0,b=i.limit;_<b;_++)l[_+s]=p[_]}function U4(r){return r.bytes[qL(r,1)]}function x4(r,i){let s=jI(r,1);r.bytes[s]=i}function WL(r){let i=qL(r,8),s=r.bytes;return CT[0]=s[i++],CT[1]=s[i++],CT[2]=s[i++],CT[3]=s[i++],CT[4]=s[i++],CT[5]=s[i++],CT[6]=s[i++],CT[7]=s[i++],BL[0]}function KL(r,i){let s=jI(r,8),l=r.bytes;BL[0]=i,l[s++]=CT[0],l[s++]=CT[1],l[s++]=CT[2],l[s++]=CT[3],l[s++]=CT[4],l[s++]=CT[5],l[s++]=CT[6],l[s++]=CT[7]}function jS(r){let i,s=0,l=0;do i=U4(r),s<32&&(l|=(127&i)<<s),s+=7;while(128&i);return l}function n_(r,i){for(i>>>=0;i>=128;)x4(r,127&i|128),i>>>=7;x4(r,i)}function bR(r,i){let s=i.low>>>0,l=(i.low>>>28|i.high<<4)>>>0,p=i.high>>>24,_=p===0?l===0?s<16384?s<128?1:2:s<1<<21?3:4:l<16384?l<128?5:6:l<1<<21?7:8:p<128?9:10,b=jI(r,_),P=r.bytes;switch(_){case 10:P[b+9]=p>>>7&1;case 9:P[b+8]=_!==9?128|p:127&p;case 8:P[b+7]=_!==8?l>>>21|128:l>>>21&127;case 7:P[b+6]=_!==7?l>>>14|128:l>>>14&127;case 6:P[b+5]=_!==6?l>>>7|128:l>>>7&127;case 5:P[b+4]=_!==5?128|l:127&l;case 4:P[b+3]=_!==4?s>>>21|128:s>>>21&127;case 3:P[b+2]=_!==3?s>>>14|128:s>>>14&127;case 2:P[b+1]=_!==2?s>>>7|128:s>>>7&127;case 1:P[b]=_!==1?128|s:127&s}}const ZQ=async(r,i,s)=>{const l=function(b){const P=[];for(let x=0;x<b.length;x+=2)P.push(parseInt(b.slice(x,x+2),16));return Uint8Array.from(P)}(function(b){const P="0123456789abcdef";function x(r_){let DE,g_="";for(DE=0;DE<=3;DE++)g_+=P.charAt(r_>>8*DE+4&15)+P.charAt(r_>>8*DE&15);return g_}function H(r_,DE){const g_=(65535&r_)+(65535&DE);return(r_>>16)+(DE>>16)+(g_>>16)<<16|65535&g_}function B(r_,DE,g_,l_,x_,_y){return H(function(L_,wT){return L_<<wT|L_>>>32-wT}(H(H(DE,r_),H(l_,_y)),x_),g_)}function z(r_,DE,g_,l_,x_,_y,L_){return B(DE&g_|~DE&l_,r_,DE,x_,_y,L_)}function Wt(r_,DE,g_,l_,x_,_y,L_){return B(DE&l_|g_&~l_,r_,DE,x_,_y,L_)}function _r(r_,DE,g_,l_,x_,_y,L_){return B(DE^g_^l_,r_,DE,x_,_y,L_)}function Di(r_,DE,g_,l_,x_,_y,L_){return B(g_^(DE|~l_),r_,DE,x_,_y,L_)}const Fi=function(r_){let DE;const g_=1+(r_.length+8>>6),l_=new Array(16*g_);for(DE=0;DE<16*g_;DE++)l_[DE]=0;for(DE=0;DE<r_.length;DE++)l_[DE>>2]|=r_.charCodeAt(DE)<<DE%4*8;return l_[DE>>2]|=128<<DE%4*8,l_[16*g_-2]=8*r_.length,l_}(b);let Gi,_p,_f,cE,RE,dE=1732584193,lE=-271733879,oE=-1732584194,EE=271733878;for(Gi=0;Gi<Fi.length;Gi+=16)_p=dE,_f=lE,cE=oE,RE=EE,dE=z(dE,lE,oE,EE,Fi[Gi+0],7,-680876936),EE=z(EE,dE,lE,oE,Fi[Gi+1],12,-389564586),oE=z(oE,EE,dE,lE,Fi[Gi+2],17,606105819),lE=z(lE,oE,EE,dE,Fi[Gi+3],22,-1044525330),dE=z(dE,lE,oE,EE,Fi[Gi+4],7,-176418897),EE=z(EE,dE,lE,oE,Fi[Gi+5],12,1200080426),oE=z(oE,EE,dE,lE,Fi[Gi+6],17,-1473231341),lE=z(lE,oE,EE,dE,Fi[Gi+7],22,-45705983),dE=z(dE,lE,oE,EE,Fi[Gi+8],7,1770035416),EE=z(EE,dE,lE,oE,Fi[Gi+9],12,-1958414417),oE=z(oE,EE,dE,lE,Fi[Gi+10],17,-42063),lE=z(lE,oE,EE,dE,Fi[Gi+11],22,-1990404162),dE=z(dE,lE,oE,EE,Fi[Gi+12],7,1804603682),EE=z(EE,dE,lE,oE,Fi[Gi+13],12,-40341101),oE=z(oE,EE,dE,lE,Fi[Gi+14],17,-1502002290),lE=z(lE,oE,EE,dE,Fi[Gi+15],22,1236535329),dE=Wt(dE,lE,oE,EE,Fi[Gi+1],5,-165796510),EE=Wt(EE,dE,lE,oE,Fi[Gi+6],9,-1069501632),oE=Wt(oE,EE,dE,lE,Fi[Gi+11],14,643717713),lE=Wt(lE,oE,EE,dE,Fi[Gi+0],20,-373897302),dE=Wt(dE,lE,oE,EE,Fi[Gi+5],5,-701558691),EE=Wt(EE,dE,lE,oE,Fi[Gi+10],9,38016083),oE=Wt(oE,EE,dE,lE,Fi[Gi+15],14,-660478335),lE=Wt(lE,oE,EE,dE,Fi[Gi+4],20,-405537848),dE=Wt(dE,lE,oE,EE,Fi[Gi+9],5,568446438),EE=Wt(EE,dE,lE,oE,Fi[Gi+14],9,-1019803690),oE=Wt(oE,EE,dE,lE,Fi[Gi+3],14,-187363961),lE=Wt(lE,oE,EE,dE,Fi[Gi+8],20,1163531501),dE=Wt(dE,lE,oE,EE,Fi[Gi+13],5,-1444681467),EE=Wt(EE,dE,lE,oE,Fi[Gi+2],9,-51403784),oE=Wt(oE,EE,dE,lE,Fi[Gi+7],14,1735328473),lE=Wt(lE,oE,EE,dE,Fi[Gi+12],20,-1926607734),dE=_r(dE,lE,oE,EE,Fi[Gi+5],4,-378558),EE=_r(EE,dE,lE,oE,Fi[Gi+8],11,-2022574463),oE=_r(oE,EE,dE,lE,Fi[Gi+11],16,1839030562),lE=_r(lE,oE,EE,dE,Fi[Gi+14],23,-35309556),dE=_r(dE,lE,oE,EE,Fi[Gi+1],4,-1530992060),EE=_r(EE,dE,lE,oE,Fi[Gi+4],11,1272893353),oE=_r(oE,EE,dE,lE,Fi[Gi+7],16,-155497632),lE=_r(lE,oE,EE,dE,Fi[Gi+10],23,-1094730640),dE=_r(dE,lE,oE,EE,Fi[Gi+13],4,681279174),EE=_r(EE,dE,lE,oE,Fi[Gi+0],11,-358537222),oE=_r(oE,EE,dE,lE,Fi[Gi+3],16,-722521979),lE=_r(lE,oE,EE,dE,Fi[Gi+6],23,76029189),dE=_r(dE,lE,oE,EE,Fi[Gi+9],4,-640364487),EE=_r(EE,dE,lE,oE,Fi[Gi+12],11,-421815835),oE=_r(oE,EE,dE,lE,Fi[Gi+15],16,530742520),lE=_r(lE,oE,EE,dE,Fi[Gi+2],23,-995338651),dE=Di(dE,lE,oE,EE,Fi[Gi+0],6,-198630844),EE=Di(EE,dE,lE,oE,Fi[Gi+7],10,1126891415),oE=Di(oE,EE,dE,lE,Fi[Gi+14],15,-1416354905),lE=Di(lE,oE,EE,dE,Fi[Gi+5],21,-57434055),dE=Di(dE,lE,oE,EE,Fi[Gi+12],6,1700485571),EE=Di(EE,dE,lE,oE,Fi[Gi+3],10,-1894986606),oE=Di(oE,EE,dE,lE,Fi[Gi+10],15,-1051523),lE=Di(lE,oE,EE,dE,Fi[Gi+1],21,-2054922799),dE=Di(dE,lE,oE,EE,Fi[Gi+8],6,1873313359),EE=Di(EE,dE,lE,oE,Fi[Gi+15],10,-30611744),oE=Di(oE,EE,dE,lE,Fi[Gi+6],15,-1560198380),lE=Di(lE,oE,EE,dE,Fi[Gi+13],21,1309151649),dE=Di(dE,lE,oE,EE,Fi[Gi+4],6,-145523070),EE=Di(EE,dE,lE,oE,Fi[Gi+11],10,-1120210379),oE=Di(oE,EE,dE,lE,Fi[Gi+2],15,718787259),lE=Di(lE,oE,EE,dE,Fi[Gi+9],21,-343485551),dE=H(dE,_p),lE=H(lE,_f),oE=H(oE,cE),EE=H(EE,RE);return x(dE)+x(lE)+x(oE)+x(EE)}(""+i+s)).slice(0,16),p=l.slice(0,12),_=await window.crypto.subtle.importKey("raw",l,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:p},_,r))},j4=async(r,i,s)=>await ZQ(r.buffer,i,s);function V4(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}const t$=new Map([["moderation",1],["supervise",2]]);class nN extends I_{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const s=this._connectionState;this._connectionState=i,this.emit(J_.CONNECTION_STATE_CHANGE,s,i)}get inspectType(){return this._inspectType}set inspectType(i){var s;this._inspectMode=iR(s=i.map(l=>t$.get(l)||0)).call(s,(l,p)=>l+p),this._inspectType=i}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(i){super(),$(this,"name","AgoraRTCVideoContentInspect"),$(this,"_connectionState",BT.CONNECTING),$(this,"_innerConnectionState",void 0),$(this,"sequence",0),$(this,"inspectStartTime",void 0),$(this,"workerManagerConnection",void 0),$(this,"workerConnection",void 0),$(this,"workerMessageLengthLimit",void 0),$(this,"inspectIntervalMinimum",void 0),$(this,"qualityRatio",void 0),$(this,"_connectInfo",void 0),$(this,"_cancelTokenSource",jT.CancelToken.source()),$(this,"_retryConfig",void 0),$(this,"wmSequence",0),$(this,"inspectInterval",void 0),$(this,"inspectTimer",null),$(this,"ossFilePrefix",void 0),$(this,"extraInfo",void 0),$(this,"_inspectType",void 0),$(this,"_inspectMode",void 0),$(this,"_quality",1),$(this,"qualityTimer",null),$(this,"_inspectId",void 0),$(this,"_needWorkUrlOnly",!1),$(this,"inspectImage",()=>{if(this.connectionState!==BT.CONNECTED)throw new _a(_i.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===BT.CONNECTED?this.requestToInspectImage():_e.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=b_(5,"inspect-"),this.workerMessageLengthLimit=kc("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=kc("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=kc("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=i.interval,this.ossFilePrefix=i.ossFilePrefix,this.extraInfo=i.extraInfo,this.inspectType=i.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new HR("worker-manager-"+this._inspectId,j_),this.on(J_.STATE_CHANGE,(s,l)=>{this._innerConnectionState=s,_e.debug("[".concat(this._inspectId,"] Inspect operation :").concat(GT[s]," ").concat(l||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new HR("worker-"+this._inspectId,j_),this.handleWorkerEvents()}async init(i,s){this.emit(J_.STATE_CHANGE,GT.CONNECT_AP),this._connectInfo=i;const l=this._cancelTokenSource.token;return this._retryConfig=s,new SE((p,_)=>{this.on(J_.CONNECTION_STATE_CHANGE,(b,P)=>{P===BT.CONNECTED&&p()}),this.requestAP(i,l,s).then(b=>{this.connectWorkerManager(b)}).catch(b=>{_(b)})})}async requestAP(i,s,l){const p=kc("WEBCS_DOMAIN").map(P=>"https://".concat(P,"/api/v1")),_=await function(P,x,H,B){let{appId:z,areaCode:Wt,cname:_r,sid:Di,token:Fi,uid:Gi}=x;DI++;const _p="image_moderation_api",_f={service_name:_p,json_body:JSON.stringify({appId:z,areaCode:Wt,cname:_r,command:"allocateEdge",requestId:DI,seq:DI,sid:Di,token:Fi,ts:Date.now(),uid:Gi+""})};let cE,RE,dE=P[0];return bS(async()=>{cE=Date.now();const lE=await dS(dE,{data:_f,cancelToken:H,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(RE=Date.now()-cE,lE.code!==0){const DE=new _a(_i.UNEXPECTED_RESPONSE,"image inspect ap error, code"+lE.code,{retry:!0,responseTime:RE});throw _e.error(DE.toString()),DE}const oE=JSON.parse(lE.json_body);if(oE.code!==200){const DE=new _a(_i.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(oE.code,", reason: ").concat(oE.reason),{code:oE.code,responseTime:RE});throw _e.error(DE.toString()),DE}if(!oE.servers||!Array.isArray(oE.servers)||oE.servers.length===0){const DE=new _a(_i.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:oE.code,responseTime:RE});throw _e.error(DE.toString()),DE}const EE=kc("VIDEO_INSPECT_WORKER_MANAGER_HOST"),r_=kc("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:oE.servers.map(DE=>{let{address:g_,wss:l_}=DE;if(g_&&l_)return"wss://".concat(g_.replace(/\./g,"-"),".").concat(EE,":").concat(r_||l_)}).filter(DE=>!!DE),workerToken:oE.workerToken,vid:oE.vid,responseTime:RE}},(lE,oE)=>(AE.apworkerEvent(Di,{success:!0,sc:200,serviceName:_p,responseDetail:JSON.stringify(lE.addressList),firstSuccess:oE===0,responseTime:RE,serverIp:P[oE%P.length]}),!1),(lE,oE)=>(AE.apworkerEvent(Di,{success:!1,sc:lE.data&&lE.data.code||200,serviceName:_p,responseTime:RE,serverIp:P[oE%P.length]}),!!(lE.code!==_i.OPERATION_ABORTED&&lE.code!==_i.UNEXPECTED_RESPONSE||lE.data&&lE.data.retry)&&(dE=P[(oE+1)%P.length],!0)),B)}(p,i,s,l);this.emit(J_.STATE_CHANGE,GT.AP_CONNECTED);const{addressList:b}=_;return this.wmSequence++,b}async connectWorkerManager(i){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(J_.STATE_CHANGE,GT.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(i,1e4)}async connectWorker(i){await this.workerConnection.init([i])}handleWorkerManagerEvents(){this.workerManagerConnection.on(xE.CONNECTED,async()=>{this.emit(J_.STATE_CHANGE,GT.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.18.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(xE.CLOSED,()=>{this._innerConnectionState<GT.GET_WORKER_MANAGER_RESPONSE&&_e.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(xE.FAILED,()=>{this._innerConnectionState<GT.GET_WORKER_MANAGER_RESPONSE&&_e.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(xE.RECONNECTING,()=>{this._innerConnectionState<GT.GET_WORKER_MANAGER_RESPONSE&&_e.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(xE.ON_MESSAGE,async i=>{this.emit(J_.STATE_CHANGE,GT.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const l=JSON.parse(i.data);if(l.code!==200)throw _e.error("[".concat(this._inspectId,"] Unexpected code ").concat(l.code," from worker manager")),new _a(_i.UNEXPECTED_RESPONSE,"response code of worker is unexpected",l);if(!(l.serverResponse&&l.serverResponse.portWss&&s))throw _e.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(l))),new _a(_i.UNEXPECTED_RESPONSE,"response content of worker is unexpected",l);{const p=kc("VIDEO_INSPECT_WORKER_PORT")||l.serverResponse.portWss,_=s.replace(/:\d+\/?$/,":".concat(p));this.emit(J_.STATE_CHANGE,GT.CONNECT_WORKER,_),this._needWorkUrlOnly?this.emit(J_.REQUEST_NEW_WORKER_URL,_):await this.connectWorker(_)}}),this.workerManagerConnection.on(xE.WILL_RECONNECT,(i,s)=>{s(i)}),this.workerManagerConnection.on(xE.REQUEST_NEW_URLS,(i,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i).catch(s)})}handleWorkerEvents(){this.workerConnection.on(xE.CONNECTED,async()=>{this.emit(J_.STATE_CHANGE,GT.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=BT.CONNECTED}),this.workerConnection.on(xE.ON_MESSAGE,async i=>{if(i.data instanceof ArrayBuffer){const l=HQ(new Uint8Array(i.data));if(kc("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&_e.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(l)),l.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(J_.INSPECT_RESULT,void 0,void 0);if(l.data&&l.data.scorePorn&&l.data.scoreSexy&&l.data.scoreNeutral){var s;const p={porn:l.data.scorePorn,sexy:l.data.scoreSexy,neutral:l.data.scoreNeutral},_=iR(s=Object.keys(p)).call(s,(P,x)=>p[P]>p[x]?P:x,"porn"),b=Object.keys(p).find(P=>P===_);this.emit(J_.INSPECT_RESULT,b)}else this.emit(J_.INSPECT_RESULT,void 0,new _a(_i.UNEXPECTED_RESPONSE,l.code+"","There is an unexpected data on message"))}else this.emit(J_.INSPECT_RESULT,void 0,new _a(_i.UNEXPECTED_RESPONSE,l.code+"",l.msg))}else _e.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(J_.INSPECT_RESULT,void 0,new _a(_i.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(xE.CLOSED,()=>{this.connectionState=BT.CLOSED}),this.workerConnection.on(xE.FAILED,()=>{this.connectionState=BT.CLOSED}),this.workerConnection.on(xE.RECONNECTING,()=>{this.connectionState=this.connectionState===BT.CONNECTED?BT.RECONNECTING:BT.CONNECTING}),this.workerConnection.on(xE.WILL_RECONNECT,(i,s)=>{i==="recover"&&s(i),s("tryNext")}),this.workerConnection.on(xE.REQUEST_NEW_URLS,(i,s)=>{this.workerManagerConnection.close(),this.once(J_.REQUEST_NEW_WORKER_URL,l=>{i([l])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(l=>{this.connectWorkerManager(l,!0)}).catch(l=>{s(l)})})}static intToLong(i){return{low:i|=0,high:i>>31,unsigned:i>=0}}async requestToInspectImage(){this.sequence++;const i=hS(this,J_.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(i){if(!i.isPlaying)return void this.emit(J_.INSPECT_RESULT,void 0,new _a(_i.INVALID_OPERATION,"Only the track being played can be inspected"));const l=await this.generateRequestData(i,s);this.workerConnection.sendMessage(l,!0,!0)}else this.emit(J_.INSPECT_RESULT,void 0,new _a(_i.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(i,s){let{appId:l,cname:p,cid:_,vid:b,sid:P,uid:x}=s;const H=Date.now(),B=await i.getCurrentFrameImage("image/jpeg",this.quality),z=await j4(B,l,p),Wt=this.sequence+"-"+_+"-"+x+"-"+H+"-"+b_(12,""),_r={appId:l,cid:_,cname:p,deviceId:"",elapse:nN.intToLong(Number(H-this.inspectStartTime)),fileSize:z.byteLength,jpgEncryption:2,height:B.height,width:B.width,jpg:z,networkType:6,osType:7,requestId:Wt,sdkVersion:"4.18.2",sequence:this.sequence,sid:P,timestamp:nN.intToLong(H),uid:x,vid:b,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete _r.callbackData,this.ossFilePrefix===void 0&&delete _r.ossFilePrefix;const Di=KQ(_r);if(Di.byteLength<this.workerMessageLengthLimit){if(kc("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const Fi=function(Gi){for(var _p=1;_p<arguments.length;_p++){var _f=arguments[_p]!=null?arguments[_p]:{};_p%2?V4(Object(_f),!0).forEach(function(cE){$(Gi,cE,_f[cE])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Gi,Object.getOwnPropertyDescriptors(_f)):V4(Object(_f)).forEach(function(cE){Object.defineProperty(Gi,cE,Object.getOwnPropertyDescriptor(_f,cE))})}return Gi}({},_r);delete Fi.jpg,_e.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(Fi))}return Di}{const Fi=this.quality*this.qualityRatio;return this.quality=Fi,await this.generateRequestData(i,{appId:l,cname:p,cid:_,vid:b,sid:P,uid:x})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=jT.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=BT.CLOSED,this.emit(J_.STATE_CHANGE,GT.CLOSED)}}function e$(r){let i=function(){const s=i$.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,l){let p=s.appId;p!==void 0&&(U_(l,10),QR(l,p));let _=s.cid;_!==void 0&&(U_(l,16),U_(l,_));let b=s.cname;b!==void 0&&(U_(l,26),QR(l,b));let P=s.deviceId;P!==void 0&&(U_(l,34),QR(l,P));let x=s.elapse;x!==void 0&&(U_(l,40),TR(l,x));let H=s.fileSize;H!==void 0&&(U_(l,48),TR(l,VI(H)));let B=s.height;B!==void 0&&(U_(l,56),TR(l,VI(B)));let z=s.jpg;z!==void 0&&(U_(l,66),U_(l,z.length),B4(l,z));let Wt=s.networkType;Wt!==void 0&&(U_(l,72),TR(l,VI(Wt)));let _r=s.osType;_r!==void 0&&(U_(l,80),TR(l,VI(_r)));let Di=s.requestId;Di!==void 0&&(U_(l,90),QR(l,Di));let Fi=s.sdkVersion;Fi!==void 0&&(U_(l,98),QR(l,Fi));let Gi=s.sequence;Gi!==void 0&&(U_(l,104),TR(l,VI(Gi)));let _p=s.sid;_p!==void 0&&(U_(l,114),QR(l,_p));let _f=s.timestamp;_f!==void 0&&(U_(l,120),TR(l,_f));let cE=s.uid;cE!==void 0&&(U_(l,128),U_(l,cE));let RE=s.vid;RE!==void 0&&(U_(l,136),U_(l,RE));let dE=s.width;dE!==void 0&&(U_(l,144),TR(l,VI(dE)));let lE=s.service;lE!==void 0&&(U_(l,152),U_(l,lE));let oE=s.callbackData;oE!==void 0&&(U_(l,162),U_(l,oE.length),B4(l,oE));let EE=s.ticket;EE!==void 0&&(U_(l,170),QR(l,EE))}(r,i),function(s){let l=s.bytes,p=s.limit;return l.length===p?l:l.subarray(0,p)}(i)}function n$(r){return function(s){let l={};t:for(;!o$(s);){let p=T0(s);switch(p>>>3){case 0:break t;case 1:l.code=T0(s);break;case 2:l.msg=G4(s,T0(s));break;case 3:l.requestId=G4(s,T0(s));break;case 4:l.timestamp=s$(s,!1);break;default:r$(s,7&p)}}return l}({bytes:i=r,offset:0,limit:i.length});var i}function r$(r,i){switch(i){case 0:for(;128&_S(r););break;case 2:HL(r,T0(r));break;case 5:HL(r,4);break;case 1:HL(r,8);break;default:throw new Error("Unimplemented type: "+i)}}function VI(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}let i$=[];function HL(r,i){if(r.offset+i>r.limit)throw new Error("Skip past limit");r.offset+=i}function o$(r){return r.offset>=r.limit}function rN(r,i){let s=r.bytes,l=r.offset,p=r.limit,_=l+i;if(_>s.length){let b=new Uint8Array(2*_);b.set(s),r.bytes=b}return r.offset=_,_>p&&(r.limit=_),l}function F4(r,i){let s=r.offset;if(s+i>r.limit)throw new Error("Read past limit");return r.offset+=i,s}function B4(r,i){let s=rN(r,i.length);r.bytes.set(i,s)}function G4(r,i){let s=F4(r,i),l=String.fromCharCode,p=r.bytes,_="ï¿½",b="";for(let P=0;P<i;P++){let x,H,B,z,Wt=p[P+s];128&Wt?(224&Wt)==192?P+1>=i?b+=_:(x=p[P+s+1],(192&x)!=128?b+=_:(z=(31&Wt)<<6|63&x,z<128?b+=_:(b+=l(z),P++))):(240&Wt)==224?P+2>=i?b+=_:(x=p[P+s+1],H=p[P+s+2],(49344&(x|H<<8))!=32896?b+=_:(z=(15&Wt)<<12|(63&x)<<6|63&H,z<2048||z>=55296&&z<=57343?b+=_:(b+=l(z),P+=2))):(248&Wt)==240?P+3>=i?b+=_:(x=p[P+s+1],H=p[P+s+2],B=p[P+s+3],(12632256&(x|H<<8|B<<16))!=8421504?b+=_:(z=(7&Wt)<<18|(63&x)<<12|(63&H)<<6|63&B,z<65536||z>1114111?b+=_:(z-=65536,b+=l(55296+(z>>10),56320+(1023&z)),P+=3))):b+=_:b+=l(Wt)}return b}function QR(r,i){let s=i.length,l=0;for(let b=0;b<s;b++){let P=i.charCodeAt(b);P>=55296&&P<=56319&&b+1<s&&(P=(P<<10)+i.charCodeAt(++b)-56613888),l+=P<128?1:P<2048?2:P<65536?3:4}U_(r,l);let p=rN(r,l),_=r.bytes;for(let b=0;b<s;b++){let P=i.charCodeAt(b);P>=55296&&P<=56319&&b+1<s&&(P=(P<<10)+i.charCodeAt(++b)-56613888),P<128?_[p++]=P:(P<2048?_[p++]=P>>6&31|192:(P<65536?_[p++]=P>>12&15|224:(_[p++]=P>>18&7|240,_[p++]=P>>12&63|128),_[p++]=P>>6&63|128),_[p++]=63&P|128)}}function _S(r){return r.bytes[F4(r,1)]}function q4(r,i){let s=rN(r,1);r.bytes[s]=i}function T0(r){let i,s=0,l=0;do i=_S(r),s<32&&(l|=(127&i)<<s),s+=7;while(128&i);return l}function U_(r,i){for(i>>>=0;i>=128;)q4(r,127&i|128),i>>>=7;q4(r,i)}function s$(r,i){let s,l=0,p=0,_=0;return s=_S(r),l=127&s,128&s&&(s=_S(r),l|=(127&s)<<7,128&s&&(s=_S(r),l|=(127&s)<<14,128&s&&(s=_S(r),l|=(127&s)<<21,128&s&&(s=_S(r),p=127&s,128&s&&(s=_S(r),p|=(127&s)<<7,128&s&&(s=_S(r),p|=(127&s)<<14,128&s&&(s=_S(r),p|=(127&s)<<21,128&s&&(s=_S(r),_=127&s,128&s&&(s=_S(r),_|=(127&s)<<7))))))))),{low:l|p<<28,high:p>>>4|_<<24,unsigned:i}}function TR(r,i){let s=i.low>>>0,l=(i.low>>>28|i.high<<4)>>>0,p=i.high>>>24,_=p===0?l===0?s<16384?s<128?1:2:s<1<<21?3:4:l<16384?l<128?5:6:l<1<<21?7:8:p<128?9:10,b=rN(r,_),P=r.bytes;switch(_){case 10:P[b+9]=p>>>7&1;case 9:P[b+8]=_!==9?128|p:127&p;case 8:P[b+7]=_!==8?l>>>21|128:l>>>21&127;case 7:P[b+6]=_!==7?l>>>14|128:l>>>14&127;case 6:P[b+5]=_!==6?l>>>7|128:l>>>7&127;case 5:P[b+4]=_!==5?128|l:127&l;case 4:P[b+3]=_!==4?s>>>21|128:s>>>21&127;case 3:P[b+2]=_!==3?s>>>14|128:s>>>14&127;case 2:P[b+1]=_!==2?s>>>7|128:s>>>7&127;case 1:P[b]=_!==1?128|s:127&s}}const W4={},K4={},H4=4294967296,Y4=18446744073709552e3,z4=Y4/2,YL=X4(0,!0),J4=X4(0),a$=FI(0,-2147483648,!1),c$=FI(-1,2147483647,!1),u$=FI(-1,-1,!0);function X4(r,i){let s,l,p;return i?(p=0<=(r>>>=0)&&r<256)&&(l=K4[r],l)?l:(s=FI(r,0,!0),p&&(K4[r]=s),s):(p=-128<=(r|=0)&&r<128)&&(l=W4[r],l)?l:(s=FI(r,r<0?-1:0,!1),p&&(W4[r]=s),s)}function FI(r,i,s){return{low:0|r,high:0|i,unsigned:!!s}}function d$(r,i){if(isNaN(r))return i?YL:J4;if(i){if(r<0)return YL;if(r>=Y4)return u$}else{if(r<=-z4)return a$;if(r+1>=z4)return c$}return r<0?i?YL:J4:FI(r%H4|0,r/H4|0,i)}function Q4(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}class zL extends I_{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const s=this._connectionState;this._connectionState=i,this.emit($T.CONNECTION_STATE_CHANGE,i,s)}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(i){var s;super(),$(this,"name","AgoraRTCImageModeration"),$(this,"_connectionState",kT.CONNECTING),$(this,"_sequence",0),$(this,"_moderationStartTime",void 0),$(this,"_workerConnection",void 0),$(this,"_workerMessageLengthLimit",void 0),$(this,"_qualityRatio",void 0),$(this,"_connectInfo",void 0),$(this,"_cancelTokenSource",jT.CancelToken.source()),$(this,"_retryConfig",void 0),$(this,"_moderationInterval",void 0),$(this,"_moderationTimer",null),$(this,"_moderationMode",1),$(this,"_quality",1),$(this,"_qualityTimer",null),$(this,"_ticket",void 0),$(this,"_moderationIntervalMinimum",void 0),$(this,"_uploadFailedNum",0),$(this,"_uploadNum",0),$(this,"_uploadTimer",null),$(this,"_moderationId",void 0),$(this,"inspectImage",()=>{if(this.connectionState!==kT.CONNECTED)throw new _a(_i.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===kT.CONNECTED?this.requestToInspectImage():_e.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=b_(5,"image-moderation-"),this._workerMessageLengthLimit=kc("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=kc("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=i.interval)!==null&&s!==void 0?s:1e3,this._qualityRatio=kc("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new HR("worker-"+this._moderationId,j_),this.on($T.STATE_CHANGE,(l,p)=>{_e.debug("[".concat(this._moderationId,"] Moderation operation :").concat(pR[l]," ").concat(p||""))}),this.handleWorkerEvents()}async init(i,s){this.emit($T.STATE_CHANGE,pR.CONNECT_AP),this._connectInfo=i;const l=this._cancelTokenSource.token;return this._retryConfig=s,new SE((p,_)=>{this.on($T.CONNECTION_STATE_CHANGE,(b,P)=>{b===kT.CONNECTED&&p()}),this.requestAP(i,l,s).then(b=>{this.connectWorker(b)}).catch(b=>{_(b)})})}updateConfig(i){var s;this._moderationInterval=(s=i.interval)!==null&&s!==void 0?s:1e3,_e.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(i))),this.connectionState===kT.CONNECTED&&this.inspectImage()}async requestAP(i,s,l){const p=kc("WEBCS_DOMAIN").map(x=>"https://".concat(x,"/api/v1")),_=await function(x,H,B,z){let{appId:Wt,areaCode:_r,cname:Di,sid:Fi,token:Gi,uid:_p}=H;DI++;const _f="moderation_plugin",cE={service_name:_f,json_body:JSON.stringify({appId:Wt,areaCode:_r,cname:Di,command:"allocateEdge",requestId:DI,seq:DI,sid:Fi,appToken:Gi,ts:Date.now(),uid:_p+""})};let RE,dE,lE=x[0];return bS(async()=>{RE=Date.now();const oE=await dS(lE,{data:cE,cancelToken:B,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(dE=Date.now()-RE,oE.code!==0){const DE=new _a(_i.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+oE.code,{retry:!0,responseTime:dE});throw _e.error(DE.toString()),DE}const EE=JSON.parse(oE.json_body);if(EE.code!==200){const DE=new _a(_i.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(EE.code,", reason: ").concat(EE.reason),{code:EE.code,responseTime:dE});throw _e.error(DE.toString()),DE}if(!EE.servers||!Array.isArray(EE.servers)||EE.servers.length===0){const DE=new _a(_i.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:EE.code,responseTime:dE});throw _e.error(DE.toString()),DE}if(!EE.servers.some(DE=>!!DE.wss)){const DE=new _a(_i.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:EE.code,responseTime:dE});throw _e.error(DE.toString()),DE}const r_=kc("IMAGE_MODERATION_WORKER_HOST");return{addressList:EE.servers.map(DE=>{let{address:g_,wss:l_}=DE;if(g_&&l_)return"wss://".concat(g_.replace(/\./g,"-"),".").concat(r_,":").concat(l_,"/moderation")}).filter(DE=>!!DE),workerToken:EE.workerToken,vid:EE.vid,ticket:EE.appTicket,responseTime:dE}},(oE,EE)=>(AE.apworkerEvent(Fi,{success:!0,sc:200,serviceName:_f,responseDetail:JSON.stringify(oE.addressList),firstSuccess:EE===0,responseTime:dE,serverIp:x[EE%x.length]}),!1),(oE,EE)=>(AE.apworkerEvent(Fi,{success:!1,sc:oE.data&&oE.data.code||200,serviceName:_f,responseTime:dE,serverIp:x[EE%x.length]}),!!(oE.code!==_i.OPERATION_ABORTED&&oE.code!==_i.UNEXPECTED_RESPONSE||oE.data&&oE.data.retry)&&(lE=x[(EE+1)%x.length],!0)),z)}(p,i,s,l);this.emit($T.STATE_CHANGE,pR.AP_CONNECTED);const{addressList:b,ticket:P}=_;return this._ticket=P,b}async connectWorker(i){this.emit($T.STATE_CHANGE,pR.CONNECT_WORKER),await this._workerConnection.init(i,1e4)}handleWorkerEvents(){this._workerConnection.on(xE.CONNECTED,async()=>{this.emit($T.STATE_CHANGE,pR.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=kT.CONNECTED}),this._workerConnection.on(xE.CLOSED,()=>{this.connectionState=kT.CLOSED}),this._workerConnection.on(xE.FAILED,()=>{this.connectionState=kT.CLOSED}),this._workerConnection.on(xE.RECONNECTING,()=>{this.connectionState=this.connectionState===kT.CONNECTED?kT.RECONNECTING:kT.CONNECTING}),this._workerConnection.on(xE.ON_MESSAGE,async i=>{if(i.data instanceof ArrayBuffer){const s=n$(new Uint8Array(i.data));kc("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&_e.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,_e.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{AE.reportApiInvoke(this._connectInfo.sid||null,{name:V_.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:S_.TRACER}).onError(new _a(_i.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},kc("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else _e.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(xE.WILL_RECONNECT,(i,s)=>{i==="recover"&&s(i),s("tryNext")}),this._workerConnection.on(xE.REQUEST_NEW_URLS,(i,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i).catch(s)})}static intToLong(i){return{low:i|=0,high:i>>31,unsigned:i>=0}}async requestToInspectImage(){const i=hS(this,$T.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(i){if(!i.isPlaying)return void(kc("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&_e.debug("Only the track being played can be inspected"));this._sequence++;const l=await this.generateRequestData(i,s);this._workerConnection.sendMessage(l,!0,!0)}else kc("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&_e.debug("Only the track being published can be inspected")}async generateRequestData(i,s){let{appId:l,cname:p,cid:_,vid:b,sid:P,uid:x}=s;const H=Date.now(),B=await i.getCurrentFrameImage("image/jpeg",this.quality),z=await j4(B,l,p),Wt=this._sequence+"-"+_+"-"+x+"-"+H+"-"+b_(12,""),_r={appId:l,cid:_,cname:p,deviceId:"",elapse:zL.intToLong(Number(H-this._moderationStartTime)),fileSize:B.buffer.byteLength,height:B.height,width:B.width,jpg:z,networkType:6,osType:7,requestId:Wt,sdkVersion:"4.18.2",sequence:this._sequence,sid:P,timestamp:d$(H),uid:x,vid:b,service:this._moderationMode,ticket:this._ticket},Di=e$(_r);if(Di.byteLength<this._workerMessageLengthLimit){if(kc("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const Fi=function(Gi){for(var _p=1;_p<arguments.length;_p++){var _f=arguments[_p]!=null?arguments[_p]:{};_p%2?Q4(Object(_f),!0).forEach(function(cE){$(Gi,cE,_f[cE])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Gi,Object.getOwnPropertyDescriptors(_f)):Q4(Object(_f)).forEach(function(cE){Object.defineProperty(Gi,cE,Object.getOwnPropertyDescriptor(_f,cE))})}return Gi}({},_r);delete Fi.jpg,_e.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(Fi))}return Di}{const Fi=this.quality*this._qualityRatio;return this.quality=Fi,await this.generateRequestData(i,{appId:l,cname:p,cid:_,vid:b,sid:P,uid:x})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=jT.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=kT.CLOSED,this.emit($T.STATE_CHANGE,pR.CLOSED)}}var $4,Z4,_q,t6,e6,n6,r6,i6,o6,s6,a6,c6,u6,d6,l6,h6,p6,f6,E6,_6,m6,g6,v6,y6,b6,T6,S6,R6,I6,O6,A6,C6,w6,N6,D6,P6,k6,L6,M6,_E;function U6(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function S0(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?U6(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):U6(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}let l$=($4=PE(),Z4=PE({argsMap:(r,i)=>(Array.isArray(i)||(i=[i]),i.map(s=>s?Object(s).toString():"null"))}),_q=PE({argsMap:(r,i)=>(i||(i=[]),Array.isArray(i)||(i=[i]),i.map(s=>s.getTrackId()))}),t6=PE({argsMap:(r,i,s)=>[i.uid,s]}),e6=PE({argsMap:(r,i)=>i.map(s=>{let{user:l,mediaType:p}=s;return[l==null?void 0:l.uid,p]})}),n6=PE({argsMap:(r,i,s)=>[i.uid,s]}),r6=PE({argsMap:(r,i)=>i.map(s=>{let{user:l,mediaType:p}=s;return{uid:l==null?void 0:l.uid,mediaType:p}})}),i6=PE(),o6=PE(),s6=PE(),a6=PE(),c6=PE(),u6=PE(),d6=PE(),l6=PE(),h6=PE(),p6=PE(),f6=PE(),E6=PE(),_6=PE(),m6=PE(),g6=PE({argsMap:(r,i)=>[i]}),v6=PE(),y6=PE(),b6=PE(),T6=PE(),S6=PE(),R6=PE(),I6=PE(),O6=PE(),A6=PE(),C6=PE(),w6=PE({argsMap:(r,i)=>(Array.isArray(i)||(i=[i]),[JSON.stringify(i)])}),N6=PE(),D6=PE(),P6=PE(),k6=PE(),L6=PE({reportResult:!0}),M6=PE(),iE((_E=class extends I_{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get mode(){return this._config.mode}get role(){var r;return((r=this._config)===null||r===void 0?void 0:r.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(r){let i;if(super(),$(this,"store",void 0),$(this,"_uid",void 0),$(this,"_channelName",void 0),$(this,"_uintUid",void 0),$(this,"_users",[]),$(this,"_config",void 0),$(this,"_clientId",void 0),$(this,"_appId",void 0),$(this,"_sessionId",null),$(this,"_key",void 0),$(this,"_joinInfo",void 0),$(this,"_gateway",void 0),$(this,"_statsCollector",void 0),$(this,"_configDistribute",void 0),$(this,"_leaveMutex",new mT("client-leave")),$(this,"_publishMutex",new mT("client-publish")),$(this,"_renewTokenMutex",new mT("client-renewtoken")),$(this,"_subscribeMutex",new mT("client-subscribe")),$(this,"_encryptionMode","none"),$(this,"_encryptionSecret",null),$(this,"_encryptionSalt",null),$(this,"_proxyServer",void 0),$(this,"_turnServer",{servers:[],mode:"auto"}),$(this,"_cloudProxyServerMode","disabled"),$(this,"_isDualStreamEnabled",!1),$(this,"_defaultStreamFallbackType",void 0),$(this,"_lowStreamParameter",void 0),$(this,"_streamFallbackTypeCacheMap",new Map),$(this,"_remoteStreamTypeCacheMap",new Map),$(this,"_axiosCancelSource",jT.CancelToken.source()),$(this,"_audioVolumeIndicationInterval",void 0),$(this,"_networkQualityInterval",void 0),$(this,"_userOfflineTimeout",void 0),$(this,"_streamRemovedTimeout",void 0),$(this,"_injectStreamingClient",void 0),$(this,"_liveTranscodeStreamingClient",void 0),$(this,"_liveRawStreamingClient",void 0),$(this,"_channelMediaRelayClient",void 0),$(this,"_networkQualitySensitivity","normal"),$(this,"_p2pChannel",void 0),$(this,"_useLocalAccessPoint",!1),$(this,"_setLocalAPVersion",void 0),$(this,"_joinAndNotLeaveYet",!1),$(this,"_numberOfJoinCount",0),$(this,"_remoteDefaultVideoStreamType",void 0),$(this,"_inspect",void 0),$(this,"_moderation",void 0),$(this,"_license",void 0),$(this,"_handleLocalTrackEnable",(s,l,p)=>{this.publish(s,!1).then(l).catch(p)}),$(this,"_handleLocalTrackDisable",(s,l,p)=>{this.unpublish(s).then(l).catch(p)}),$(this,"_handleUserOnline",s=>{if(kc("BLOCK_LOCAL_CLIENT")&&VR(s.uid,this.channelName))return void _e.debug("[".concat(s.uid,"] will be ignored in local"));this.isStringUID&&typeof s.uid!="string"&&_e.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const l=this._users.find(p=>p.uid===s.uid);if(l)l._trust_in_room_=!0;else{const p=new hL(s.uid,s.uint_id||s.uid);this._users.push(p),_e.debug("[".concat(this._clientId,"] user online"),s.uid),this.safeEmit(WE.USER_JOINED,p)}}),$(this,"_handleUserOffline",s=>{if(kc("BLOCK_LOCAL_CLIENT")&&VR(s.uid,this.channelName))return;const l=this._users.find(p=>p.uid===s.uid);l&&(this._handleRemoveStream(s),nL(this._users,l),this._remoteStreamTypeCacheMap.delete(l.uid),this._streamFallbackTypeCacheMap.delete(l.uid),_e.debug("[".concat(this._clientId,"] user offline"),s.uid,"reason:",s.reason),this.safeEmit(WE.USER_LEAVED,l,s.reason))}),$(this,"_handleAddAudioOrVideoStream",(s,l,p,_,b,P,x)=>{if(kc("BLOCK_LOCAL_CLIENT")&&VR(l,this.channelName))return;const H=this._users.find(z=>z.uid===l);if(!H)return void _e.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));_e.debug("[".concat(this._clientId,"] stream added with uid ").concat(l,", type ").concat(s)),this.store.subscribe(H.uid,s,void 0,void 0,void 0,Date.now());const B=s==="audio"?H.hasAudio:H.hasVideo;H._uintid||(H._uintid=b||l),s==="audio"?H._trust_audio_stream_added_state_=!0:H._trust_video_stream_added_state_=!0,s==="audio"?(H._audio_added_=!0,p!==void 0&&(H._audioSSRC=p),_!==void 0&&(H._cname=_),P&&(H._audioOrtc=P)):(H._video_added_=!0,p!==void 0&&(H._videoSSRC=p),_!==void 0&&(H._cname=_),x!==void 0&&(H._rtxSsrcId=x),P&&(H._videoOrtc=P)),(s==="audio"?H.hasAudio:H.hasVideo)&&!B&&(_e.info("[".concat(this._clientId,"] remote user ").concat(H.uid," published ").concat(s)),this.safeEmit(WE.USER_PUBLISHED,H,s)),s==="video"?AE.onGatewayStream(this._sessionId,_g.ON_ADD_VIDEO_STREAM,O_.ON_ADD_VIDEO_STREAM,{peer:b||l}):AE.onGatewayStream(this._sessionId,_g.ON_ADD_AUDIO_STREAM,O_.ON_ADD_AUDIO_STREAM,{peer:b||l}),this._p2pChannel.remoteMediaSsrcChanged(H,s,p).then(z=>{if(z)return _e.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(H.uid," after rejoin because SSRC id changed.")),this._p2pChannel.unsubscribe(H,s,!0).then(()=>this._subscribe(H,s,!0).catch(Wt=>{_e.error("[".concat(this._clientId,"] resubscribe error"),Wt.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(H,s)&&(_e.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(H.uid," after reconnect.")),this._subscribe(H,s,!0).catch(z=>{_e.error("[".concat(this._clientId,"] resubscribe error"),z.toString())}))}),$(this,"_handleRemoveStream",s=>{if(kc("BLOCK_LOCAL_CLIENT")&&VR(s.uid,this.channelName))return;const l=this._users.find(_=>_.uid===s.uid);if(!l)return void _e.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));_e.debug("[".concat(this._clientId,"] stream removed with uid ").concat(s.uid));let p=()=>{};l.hasAudio&&l.hasVideo?p=()=>{_e.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(WE.USER_UNPUBLISHED,l,"audio"),_e.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(WE.USER_UNPUBLISHED,l,"video")}:l.hasVideo?p=()=>{_e.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished video track")),this.safeEmit(WE.USER_UNPUBLISHED,l,"video")}:l.hasAudio&&(p=()=>{_e.info("[".concat(this._clientId,"] remote user ").concat(l.uid," unpublished audio track")),this.safeEmit(WE.USER_UNPUBLISHED,l,"audio")}),l._trust_audio_stream_added_state_=!0,l._trust_video_stream_added_state_=!0,l._audio_added_=!1,l._video_added_=!1,this._p2pChannel.unsubscribe(l).then(_=>{if(_)return this._gateway.unsubscribe(_,l.uid)}),l._audioSSRC=void 0,l._videoSSRC=void 0,l._audioOrtc=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0,AE.onGatewayStream(this._sessionId,_g.ON_REMOVE_STREAM,O_.ON_REMOVE_STREAM,{peer:s.uint_id||s.uid}),p()}),$(this,"_handleSetStreamLocalEnable",(s,l,p)=>{if(kc("BLOCK_LOCAL_CLIENT")&&VR(l,this.channelName))return;const _=this._users.find(x=>x.uid===l);if(!_)return void _e.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));_e.debug("[".concat(this._clientId,"] local ").concat(s," ").concat(p?"enabled":"disabled"," with uid ").concat(l));const b=s==="audio"?_.hasAudio:_.hasVideo;if(s==="audio"){_._trust_audio_enabled_state_=!0;const x=_._audio_enabled_;if(_._audio_enabled_=p,_._audio_enabled_===x)return;{const H=_._audio_enabled_?"enable-local-audio":"disable-local-audio";_e.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(l,", msg: ").concat(H)),this.safeEmit(WE.USER_INFO_UPDATED,l,H)}}else{_._trust_video_enabled_state_=!0;const x=_._video_enabled_;if(_._video_enabled_=p,_._video_enabled_===x)return;{const H=_._video_enabled_?"enable-local-video":"disable-local-video";_e.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(H)),this.safeEmit(WE.USER_INFO_UPDATED,l,H)}}const P=s==="audio"?_.hasAudio:_.hasVideo;return b!==P?!b&&P?(_e.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(s)),void this.safeEmit(WE.USER_PUBLISHED,_,s)):(s==="video"&&_._videoTrack&&_._videoTrack._destroy(),s==="audio"&&_._audioTrack,this._p2pChannel.muteRemote(_,s),_e.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(s)),void this.safeEmit(WE.USER_UNPUBLISHED,_,s)):void 0}),$(this,"_handleMuteStream",(s,l,p)=>{if(kc("BLOCK_LOCAL_CLIENT")&&VR(s,this.channelName))return;_e.debug("[".concat(this._clientId,"] receive mute message"),s,l,p);const _=this._users.find(x=>x.uid===s);if(!_)return void _e.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(s));const b=l==="audio"?_.hasAudio:_.hasVideo;if(l==="audio"){_._trust_audio_mute_state_=!0;const x=_._audio_muted_;if(_._audio_muted_=p,_._audio_muted_===x)return;{const H=_._audio_muted_?"mute-audio":"unmute-audio";_e.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(H)),this.safeEmit(WE.USER_INFO_UPDATED,s,H)}}else{_._trust_video_mute_state_=!0;const x=_._video_muted_;if(_._video_muted_=p,_._video_muted_===x)return;{const H=_._video_muted_?"mute-video":"unmute-video";_e.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(H)),this.safeEmit(WE.USER_INFO_UPDATED,s,H)}}const P=l==="audio"?_.hasAudio:_.hasVideo;if(b!==P){if(!b&&P)return(l==="audio"?_._audioSSRC:_._videoSSRC)?(_e.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(l)),void this.safeEmit(WE.USER_PUBLISHED,_,l)):void _e.warning("[".concat(this._clientId,"] remote user ").concat(s," receive ").concat(l," unmute message  before add stream message, ").concat(l," SSRC doesn't exist yet."));l==="video"&&_._videoTrack&&_._videoTrack._destroy(),l==="audio"&&_._audioTrack,this._p2pChannel.muteRemote(_,l),_e.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(l)),this.safeEmit(WE.USER_UNPUBLISHED,_,l)}}),$(this,"_handleP2PLost",async s=>{_e.debug("[".concat(this._clientId,"] receive p2p lost"),s),parseInt(s.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():_e.warning("[".concat(this._clientId,"] P2PLost stream not found"),s)}),$(this,"_handleTokenWillExpire",()=>{_e.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(WE.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),$(this,"_handleBeforeUnload",s=>{s.type==="beforeunload"&&s.returnValue!==void 0&&s.returnValue!==""||(this.leave(),_e.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),$(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(WE.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const s={downlinkNetworkQuality:0,uplinkNetworkQuality:0};s.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),s.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(WE.NETWORK_QUALITY,s)}),this._config=r,this._clientId=b_(5,"client-"),this.store=new qQ(r.codec,r.audioCodec,r.mode,this._clientId),this.store.clientCreated(),r.proxyServer&&this.setProxyServer(r.proxyServer,!0),r.turnServer&&this.setTurnServer(r.turnServer,!0),_e.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(QT," build: ").concat(gP,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),r.clientRoleOptions)try{rV(r.clientRoleOptions),i=Object.assign({},r.clientRoleOptions)}catch(s){_e.warning("[".concat(this._clientId,"] ").concat(s.toString()))}this._statsCollector=new CI(this.store),this._statsCollector.onStatsException=(s,l,p)=>{_e.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(s,", msg: ").concat(l,", uid: ").concat(p)),this.safeEmit(WE.EXCEPTION,{code:s,msg:l,uid:p})},this._statsCollector.onUploadPublishDuration=(s,l,p,_)=>{const b=this._users.find(P=>P.uid===s);b&&AE.peerPublishStatus(this._sessionId,{subscribeElapse:_,audioPublishDuration:l,videoPublishDuration:p,peer:b._uintid})},this.store.useDataChannel=M_().supportDataChannel&&kc("SIGNAL_CHANNEL"),this._gateway=new AX(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:r.websocketRetryConfig||j_,httpRetryConfig:r.httpRetryConfig||j_,forceWaitGatewayResponse:r.forceWaitGatewayResponse===void 0||r.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:r.role,clientRoleOptions:i}),this._configDistribute=new UX,this._p2pChannel=new GQ(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async join(r,i,s,l,p){const _=++this._numberOfJoinCount;this.store.joinStart(),l&&(this.store.uid=l);const b=WQ(),P=N4()?window.isSecureContext:"Browser Not Support";if(!N4()&&!b||!window.isSecureContext){const _r="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";_e.warning(_r)}const x=eL();this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),_e.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const H=AE.reportApiInvoke(x,{name:V_.JOIN,options:[r,i,s,l],states:{isHttps:b,isSecureContext:P},tag:S_.TRACER});AE.setAppId(r);try{if(!s&&s!==null)throw new _a(_i.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&tT(s,"token",1,2047),tT(r,"appid",1,2047),CP(i),l&&wP(l),p&&tT(p,"optionalInfo",1,2047)}catch(_r){throw H.onError(_r),_r}if(_e.info("[".concat(this._clientId,"] start join channel ").concat(i,", join number: ").concat(_)),this._leaveMutex.isLocked&&(_e.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),_e.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const _r=new _a(_i.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw H.onError(_r),_r}this._sessionId||(this._sessionId=x,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const B=S0({clientId:this._clientId,appId:r,sid:this._sessionId,cname:i,uid:typeof l!="string"?l:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||r,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:p,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(B.setLocalAPVersion=this._setLocalAPVersion),typeof l=="string"&&(B.stringUid=l,this._uintUid?(B.uid=this._uintUid,this._uintUid=void 0):B.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(B.aesmode=this._encryptionMode,B.aespassword=await(async _r=>{const Di=rL(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),Fi=await window.crypto.subtle.importKey("spki",Di,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),Gi=HP(_r),_p=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Fi,Gi);return VO(new Uint8Array(_p))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new _a(_i.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(B.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:i,appId:r});const z=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&z===this._sessionId&&AE.joinChannelTimeout(this._sessionId,5)},5e3);try{let _r;const Di=B.cloudProxyServer;if(["proxy3","proxy4","proxy5"].includes(Di)){const _f=kc("PROXY_SERVER_TYPE3");Array.isArray(_f)?B.proxyServer=_f[0]:B.proxyServer=_f}if(AE.setProxyServer(B.proxyServer),_e.setProxyServer(B.proxyServer),this.store.requestAPStart(),B.stringUid&&!B.uid){const _f=await u3(B.stringUid,B,this._axiosCancelSource.token,this._config.httpRetryConfig||j_,this.store);_e.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(B.stringUid," => ").concat(_f)),B.uid=_f,_r=await c3(B,this._axiosCancelSource.token,this._config.httpRetryConfig||j_,!0,this.store)}else _r=await c3(B,this._axiosCancelSource.token,this._config.httpRetryConfig||j_,!0,this.store);if(!this._joinAndNotLeaveYet)throw new _a(_i.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(B,this._axiosCancelSource.token),this._configDistribute.on(s0.UPDATE_BITRATE_LIMIT,_f=>{this._p2pChannel.updateBitrateLimit(_f)})},0),this._key=s||r;const Fi=_r.gatewayInfo;this._joinInfo=S0(S0({},B),{},{cid:Fi.cid,uid:B.uid?B.uid:Fi.uid,vid:Fi.vid,apResponse:Fi.res,uni_lbs_ip:Fi.uni_lbs_ip,gatewayAddrs:Fi.gatewayAddrs});const Gi=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new _a(_i.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));H.onSuccess(Gi),this._appId=r,this._channelName=B.cname,this._uid=Gi,this.store.uid=Gi,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(pT()?"beforeunload":"pagehide",this._handleBeforeUnload)},0);const _p=B.stringUid?"string uid: ".concat(B.stringUid,",uid: ").concat(B.uid):"uid: ".concat(this._uid);return _e.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(i,",").concat(_p)),setTimeout(()=>{_e.startUpload()},5e3),this.store.joinEnd(),Wt=this,jR.includes(Wt)||jR.push(Wt),Gi}catch(_r){const Di=Array.isArray(_r)?_r[0]:_r;throw Di&&Di.code===_i.OPERATION_ABORTED?_e.warning("[".concat(this._clientId,"] join number: ").concat(_,", Joining channel failed, rollback"),Di):_e.error("[".concat(this._clientId,"] join number: ").concat(_,", Joining channel failed, rollback"),Di),Di.code!==_i.OPERATION_ABORTED&&this._numberOfJoinCount===_&&(this._gateway.state="DISCONNECTED",this._reset()),H.onError(Di),Di}var Wt}_joinGateway(){if(!this._joinInfo||!this._key)throw new _a(_i.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!kc("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(r=>r).catch(r=>{if(r.code===_i.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,o_.FALLBACK),r;if(r.code===_i.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,o_.FALLBACK),r;throw r}).then(r=>{if(r instanceof _a){if(r.code===_i.INIT_WEBSOCKET_TIMEOUT){if(_e.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new _a(_i.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const i=kc("PROXY_SERVER_TYPE3");if(Array.isArray(i))if(this._joinInfo.apUrl){const l=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),p=l.slice(l.length-2).join(".");i.forEach(_=>{this._joinInfo&&_.includes(p)&&(this._joinInfo.proxyServer=_)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=i[0])}else this._joinInfo.proxyServer=i[0];else this._joinInfo.proxyServer=i;const s=kc("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return s&&s[1]&&s[1]!=="443"&&_e.setProxyServer(this._joinInfo.proxyServer),kc("STATS_COLLECTOR_PORT").toString()!=="443"&&AE.setProxyServer(this._joinInfo.proxyServer),AE.reportApiInvoke(this._sessionId,{name:V_.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:S_.TRACER}).onSuccess(),this.safeEmit(WE.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),kc("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(l=>{"forceturn"in l&&(l.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(_e.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new _a(_i.INVALID_OPERATION);return AE.reportApiInvoke(this._sessionId,{name:V_.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:S_.TRACER}).onSuccess(),this._joinGateway()}return r}).then(r=>r)}async leave(){_e.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(pT()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(i){const s=jR.indexOf(i);s!==-1&&jR.splice(s,1)}(this);const r=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return _e.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void r();await this._gateway.leave(this.connectionState!=="CONNECTED"),_e.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),r()}async publish(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(Array.isArray(r)||(r=[r]),r.length===0)throw new _a(_i.INVALID_PARAMS,"track list is empty");if(this._gateway.role==="audience")throw new _a(_i.INVALID_OPERATION,"audience can not publish stream");for(const l of r){if(!(l instanceof YP))throw new _a(_i.INVALID_PARAMS,"parameter is not local track");if(!l._enabled&&i)throw new _a(_i.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(l.getTrackId()))}_e.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(l=>"".concat(l.getTrackId()," "))));const s=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),i&&r.forEach(l=>{const p=this._configDistribute.getBitrateLimit();l instanceof q_&&p&&l.setBitrateLimit(p.uplink)});try{await this._publishHighStream(r),_e.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(l=>"".concat(l.getTrackId()," "))))}catch(l){throw _e.error("[".concat(this._clientId,"] publish error"),l.toString()),l}finally{s()}}async unpublish(r){if(!this._joinInfo||this._uid===void 0)throw new _a(_i.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");r?Array.isArray(r)||(r=[r]):r=this._p2pChannel.getAllTracks(!0),_e.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(s=>"".concat(s.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublish(r);s&&await this._gateway.unpublish(s,this._uid),_e.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(l=>"".concat(l.getTrackId()))))}catch(s){throw _e.error("[".concat(this._clientId,"] unpublish error"),s.toString()),s}finally{i&&i()}}async subscribe(r,i){return this._subscribe(r,i)}async _subscribe(r,i,s){if(Qm(i,"mediaType",["audio","video"]),!this._joinInfo)throw new _a(_i.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _a(_i.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(x=>x===r)){const x=new _a(_i.INVALID_REMOTE_USER,"user is not in the channel");throw _e.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid,", this user is not in the channel")),x}if(!r.hasAudio&&!r.hasVideo){const x=new _a(_i.INVALID_REMOTE_USER,"user is not published");throw _e.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid,", user is not published")),x}if(!(s||(i!=="audio"||r.hasAudio&&r._audioSSRC!==void 0)&&(i!=="video"||r.hasVideo&&r._videoSSRC!==void 0))){const x=new _a(_i.REMOTE_USER_IS_NOT_PUBLISHED);throw _e.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid," with mediaType ").concat(i,", remote track is not published")),x}const l=i==="audio"?r._audioSSRC:r._videoSSRC,p=i==="audio"?r._audioOrtc:r._videoOrtc,_=i==="video"?r._rtxSsrcId:void 0,b={stream_type:i==="audio"?VE.AUDIO:VE.VIDEO,ssrcId:l},P=await this._subscribeMutex.lock();_e.info("[".concat(this._clientId,"] subscribe user ").concat(r.uid,", mediaType: ").concat(i));try{if(await this._p2pChannel.hasRemoteMediaWithLock(r,i))await this._p2pChannel.unmuteRemote(r,i);else try{ZT.markSubscribeStart(this.store.clientId,l),this.store.subscribe(r.uid,i,Date.now()),await this._p2pChannel.subscribe(r,i,l,_,p);try{await this._gateway.subscribe(r.uid,b,!0)}catch(H){if((H==null?void 0:H.code)!==_i.WS_ABORT)throw await this._p2pChannel.unsubscribe(r,i),H;await this._p2pChannel.unsubscribe(r,i,!0),this._p2pChannel.setPendingRemoteMedia(r,i)}this.store.subscribe(r.uid,i,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,r,i)}catch(H){throw this._p2pChannel.reportSubscribeEvent(!1,H==null?void 0:H.code,r,i),H}_e.info("[".concat(this._clientId,"] subscribe success user ").concat(r.uid,", mediaType: ").concat(i)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(r.uid,this._defaultStreamFallbackType).catch(H=>{_e.warning("[".concat(this._clientId,"] auto set fallback failed"),H)});const x=i==="audio"?r._audioTrack:r._videoTrack;if(!x)throw new _a(_i.UNEXPECTED_ERROR,"can not find remote track in user object");return x}catch(x){throw _e.error("[".concat(this._clientId,"] subscribe user ").concat(r.uid," error"),x),x}finally{P()}}async massSubscribe(r){if(HS(r,"subscribeList"),!this._joinInfo)throw new _a(_i.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _a(_i.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const i=Date.now(),s=new Map,l=await this._subscribeMutex.lock();_e.info("[".concat(this._clientId,"]start massSubscribe user ").concat(r.map(P=>{let{user:x,mediaType:H}=P;return"user: ".concat(x==null?void 0:x.uid,", mediaType: ").concat(H)}).join("; ")));const p=(r=[...r]).map(P=>{let{user:x,mediaType:H}=P;return{user:x,mediaType:H}}),_=await this._p2pChannel.globalLock();try{var b;for(let x=r.length-1;x>=0;x--){const H=r[x],{user:B,mediaType:z}=H;if(Qm(z,"mediaType",["audio","video"]),!B){const Di=new _a(_i.INVALID_PARAMS,"user property does not exist in subscribeList item");throw _e.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),Di}if(!this._users.find(Di=>Di===B)){const Di=new _a(_i.INVALID_REMOTE_USER,"user is not in the channel");_e.error("[".concat(this._clientId,"] can not massSubscribe ").concat(B.uid,", this user is not in the channel")),p[x].error=Di,r.splice(x,1);continue}if(z==="audio"&&(!B.hasAudio||B._audioSSRC===void 0)||z==="video"&&(!B.hasVideo||B._videoSSRC===void 0)){const Di=new _a(_i.REMOTE_USER_IS_NOT_PUBLISHED);_e.error("[".concat(this._clientId,"] can not subscribe ").concat(B.uid," with mediaType ").concat(z,", remote user is not published")),p[x].error=Di,r.splice(x,1);continue}const Wt=F_.Video|F_.LwoVideo,_r=s.get(B);if(_r){if(z==="video"?_r&Wt:_r&F_.Audio){r.splice(x,1),_e.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(B.uid,", mediaType:").concat(z," twice"));continue}s.set(B,_r|(z==="video"?Wt:F_.Audio))}else s.set(B,z==="video"?Wt:F_.Audio)}for(let x=r.length-1;x>=0;x--){const H=r[x],{user:B,mediaType:z}=H,Wt=F_.Video|F_.LwoVideo;if(this._p2pChannel.hasRemoteMedia(B,z)){await this._p2pChannel.unmuteRemoteNoLock(B,z);const _r=s.get(B);s.set(B,z==="video"?_r^Wt:_r^F_.Audio),r.splice(x,1)}}this.store.massSubscribe(r.map(x=>({userId:x.user.uid,type:x.mediaType})),i);const P=iR(b=Array.from(s.entries())).call(b,(x,H)=>{let[B,z]=H;if(z===0)return x;const Wt={stream_id:B.uid,stream_type:z};return z&F_.Audio&&(Wt.audio_ssrc=B._audioSSRC),z&F_.Video&&(Wt.video_ssrc=B._videoSSRC),x.push(Wt),x},[]);try{r.length>0&&await this._p2pChannel.massSubscribeNoLock(r.map(H=>{let{user:B,mediaType:z}=H;return{user:B,mediaType:z,ssrcId:z===VE.VIDEO?B._videoSSRC:B._audioSSRC,rtxSsrcId:z===VE.VIDEO?B._rtxSsrcId:void 0}}));const x=new Map;if(P.length>0){const H=await this._gateway.subscribeAll(P,!0);((H==null?void 0:H.users)||[]).forEach(B=>{let{stream_id:z,video_error_code:Wt,audio_error_code:_r,error_code:Di}=B;(Wt||_r||Di)&&x.set(z,{video_error_code:Wt,audio_error_code:_r,error_code:Di})})}if(Array.from(x.entries()).length>0){const H=Array.from(x.entries()).map(B=>{let z,[Wt,_r]=B;return _r.error_code||_r.video_error_code&&_r.audio_error_code?z=void 0:_r.video_error_code?z=VE.VIDEO:_r.audio_error_code&&(z=VE.AUDIO),{user:this.remoteUsers.find(Di=>Di.uid===Wt),mediaType:z}});await this._p2pChannel.massUnsubscribeNoLock(H)}for(const H of p){const B=x.get(H.user.uid);if(B){const z=B.error_code||H.mediaType==="audio"&&B.audio_error_code||H.mediaType==="video"&&B.video_error_code;if(z){const Wt=d0(z);_e.error("user:".concat(H.user.uid," mediaType:").concat(H.mediaType," has massSubscribe error ").concat(Wt.desc)),H.error=new _a(_i.SUBSCRIBE_FAILED,"code ".concat(z,": ").concat(Wt.desc))}}H.error||(H.mediaType==="video"?H.track=H.user.videoTrack:H.track=H.user.audioTrack)}return this.store.massSubscribe(p.filter(H=>!H.error).map(H=>({userId:H.user.uid,type:H.mediaType})),void 0,Date.now()),p.forEach(H=>{var B;AE.subscribe(this.store.sessionId,{succ:!!H.error,ec:((B=H.error)===null||B===void 0?void 0:B.code)||null,video:H.mediaType===VE.VIDEO,audio:H.mediaType===VE.AUDIO,peerid:H.user.uid,subscribeRequestid:H.mediaType===VE.VIDEO?H.user._videoSSRC:H.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-i)},!0)}),_e.info("[".concat(this._clientId,"] massSubscribe success ").concat(r.map(H=>{let{user:B,mediaType:z}=H;return"user: ".concat(B==null?void 0:B.uid,", mediaType: ").concat(z)}).join("; "))),p}catch(x){throw await this._p2pChannel.massUnsubscribeNoLock(r),x}}finally{_(),l()}}async unsubscribe(r,i){if(i&&Qm(i,"mediaType",["audio","video"]),!this._joinInfo)throw new _a(_i.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(l=>l===r)){const l=new _a(_i.INVALID_REMOTE_USER,"user is not in the channel");throw _e.error("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),l}_e.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(r.uid,", mediaType: ").concat(i));const s=await this._subscribeMutex.lock();try{const l=await this._p2pChannel.unsubscribe(r,i);l&&await this._gateway.unsubscribe(l,r.uid),_e.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(r.uid,", mediaType: ").concat(i))}catch(l){if(l.code===_i.DISCONNECT_P2P)return void _e.warning("disconnecting p2p, abort unsubscribe request.");throw _e.error("[".concat(this._clientId,"] unsubscribe user ").concat(r.uid," error"),l.toString()),l}finally{s()}}async massUnsubscribe(r){if(HS(r,"unsubscribeList"),!this._joinInfo)throw new _a(_i.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");_e.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(r.map(s=>{let{user:l,mediaType:p}=s;return"user: ".concat(l==null?void 0:l.uid,", mediaType: ").concat(p,";")}).join())),r=[...r];const i=new Map;for(let s=r.length-1;s>=0;s--){const{user:l,mediaType:p}=r[s];if(!l){const b=new _a(_i.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw _e.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),b}if(Qm(p,"mediaType",["video","audio",void 0]),!this._users.find(b=>b===l)){_e.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(l.uid,", user is not in the channel")),r.splice(s,1);continue}const _=F_.Video|F_.LwoVideo;if(i.has(l)){const b=i.get(l);let P;switch(p){case"video":P=b&_;break;case"audio":P=b&F_.Audio;break;default:P=b&(F_.Audio|_)}if(P){_e.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(l.uid,",mediaType:").concat(p," twice.")),r.splice(s,1);continue}p?p==="audio"?i.set(l,b|F_.Audio):p==="video"&&i.set(l,b|_):i.set(l,b|F_.Audio|_)}else p?p==="audio"?i.set(l,F_.Audio):p==="video"&&i.set(l,_):i.set(l,F_.Audio|_)}try{const s=await this._p2pChannel.massUnsubscribe(r);s&&await this._gateway.massUnsubscribe(s),_e.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(r.map(l=>{let{user:p,mediaType:_}=l;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(_,";")}).join()))}catch(s){if(s.code===_i.DISCONNECT_P2P)return void _e.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw _e.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}setLowStreamParameter(r){(function(s){if(!s)throw new _a(_i.INVALID_PARAMS);T_(s.width)||AP(s.width,"streamParameter.width"),T_(s.height)||AP(s.height,"streamParameter.height"),T_(s.framerate)||AP(s.framerate,"streamParameter.framerate"),T_(s.bitrate)||__(s.bitrate,"streamParameter.bitrate")})(r),(!r.width&&r.height||r.width&&!r.height)&&_e.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),_e.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(r));const i=this._configDistribute.getLowStreamConfigDistribute();i&&i.bitrate&&r.bitrate&&i.bitrate<r.bitrate&&(r.bitrate=i.bitrate),this._lowStreamParameter=r}async enableDualStream(){if(!M_().supportDualStream)throw AE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new _a(_i.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new _a(_i.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(r){throw AE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),r}this._isDualStreamEnabled=!0,AE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),_e.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new _a(_i.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(IE.LocalVideoLowTrack))try{const r=await this._p2pChannel.unpublishLowStream();r&&await this._gateway.unpublish(r,this._joinInfo.stringUid||this._joinInfo.uid)}catch(r){throw AE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),r}this._isDualStreamEnabled=!1,AE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),_e.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(r,i){if(function(s){Qm(s,"role",["audience","host"])}(r),i&&rV(i),this.mode==="rtc")throw _e.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new _a(_i.INVALID_OPERATION,"rtc mode can not use setClientRole");if(i&&i.level&&r==="host")throw new _a(_i.INVALID_OPERATION,"host mode can not set audience latency level");if(r==="audience"&&this._p2pChannel.hasLocalMedia())throw new _a(_i.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(r,i),this._config.role=r,_e.info("[".concat(this._clientId,"] set client role to ").concat(r,", level: ").concat(i&&i.level))}setProxyServer(r,i){if(tT(r,"proxyServer"),!i){if(this.connectionState!=="DISCONNECTED")throw new _a(_i.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new _a(_i.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=r,AE.setProxyServer(this._proxyServer),_e.setProxyServer(this._proxyServer),_e.info("[".concat(this._clientId,"] Set proxy server ").concat(i?"by initialize call":""," success."))}setTurnServer(r,i){if(Array.isArray(r)||(r=[r]),!i){if(this.connectionState!=="DISCONNECTED")throw new _a(_i.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new _a(_i.INVALID_OPERATION,"You have already set the proxy")}if(i0(r))return this._turnServer={servers:r,mode:"original-manual"},void _e.info("[".concat(this._clientId,"] Set original turnserver ").concat(i?"by initialize call":""," success: ").concat(r.map(s=>s.urls).join(","),"."));r.forEach(s=>nV(s)),this._turnServer={servers:r,mode:"manual"},_e.info("[".concat(this._clientId,"] Set turnserver ").concat(i?"by initialize call":""," success."))}setLicense(r){if(this.connectionState!=="DISCONNECTED")throw new _a(_i.INVALID_OPERATION,"you should set license before join channel");if(tT(r,"license",32,32),!/^[A-Za-z\d]+$/.test(r))throw new _a(_i.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=r,_e.info("[".concat(this._clientId,"] set license success"),r)}startProxyServer(r){if(this.connectionState!=="DISCONNECTED")throw new _a(_i.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new _a(_i.INVALID_OPERATION,"You have already set the proxy");const i=[3,4,5];let s;switch(r===void 0&&(r=3),r){case 1:case 2:throw new _a(_i.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new _a(_i.INVALID_PARAMS,"proxy server mode must be ".concat(i.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,_e.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new _a(_i.INVALID_OPERATION,"Stop proxy server after leave channel");AE.setProxyServer(),_e.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",_e.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(r){if(!r.accessPoints)throw new _a(_i.INVALID_PARAMS,"accessPoints is required.");HS(r.accessPoints.serverList,"accessPoints.serverList"),tT(r.accessPoints.domain,"accessPoints.domain");const i=(Wt,_r)=>{__(Wt,_r,0,65535,!0)};let s=443;if(r.accessPoints.port&&(i(r.accessPoints.port,"accessPoints.port"),s=r.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new _a(_i.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");kc("CLOSE_AFB_FOR_LOCAL_AP")&&(f_("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),f_("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const l=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,p=r.accessPoints.domain,_=r.accessPoints.serverList.map(Wt=>l.test(Wt)?"".concat(Wt.replace(/\./g,"-"),".").concat(p):Wt),b=_.map(Wt=>"".concat(Wt,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,f_("WEBCS_DOMAIN",b),f_("WEBCS_DOMAIN_BACKUP_LIST",b),f_("GATEWAY_DOMAINS",[p]),r.report&&r.report.hostname&&Array.isArray(r.report.hostname)&&r.report.hostname.length?(HS(r.report.hostname,"report.hostname"),f_("EVENT_REPORT_DOMAIN",r.report.hostname[0]),f_("EVENT_REPORT_BACKUP_DOMAIN",r.report.hostname[1]||r.report.hostname[0])):(f_("EVENT_REPORT_DOMAIN",_[0]),f_("EVENT_REPORT_BACKUP_DOMAIN",_[1]||_[0]));let P=6443;r.report&&r.report.port&&(i(r.report.port,"report.port"),P=r.report.port),f_("STATS_COLLECTOR_PORT",P),r.report?f_("ENABLE_EVENT_REPORT",!0):f_("ENABLE_EVENT_REPORT",!1);let x="";r.log&&r.log.hostname&&Array.isArray(r.log.hostname)&&r.log.hostname.length?(HS(r.log.hostname,"log.hostname"),x=r.log.hostname[0]):x=_[0];let H=6444;r.log&&r.log.port&&(i(r.log.port,"log.port"),H=r.log.port),f_("LOG_UPLOAD_SERVER","".concat(x,":").concat(H));let B=[];r.cds&&r.cds.hostname&&Array.isArray(r.cds.hostname)&&r.cds.hostname.length?(HS(r.cds.hostname,"cds.hostname"),B=r.cds.hostname):B=_;let z=443;r.cds&&r.cds.port&&(i(r.cds.port,"cds.port"),z=r.cds.port),f_("CDS_AP",B.map(Wt=>"".concat(Wt,":").concat(z))),r.cds?f_("ENABLE_CONFIG_DISTRIBUTE",!0):f_("ENABLE_CONFIG_DISTRIBUTE",!1),_e.info("set local access point v2 success")}setLocalAccessPoints(r,i){if(HS(r,"serverList"),tT(i,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new _a(_i.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;r=r.map(l=>s.test(l)?"".concat(l.replace(/\./g,"-"),".").concat(i):l),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,f_("WEBCS_DOMAIN",r),f_("WEBCS_DOMAIN_BACKUP_LIST",r),f_("GATEWAY_DOMAINS",[i]),f_("EVENT_REPORT_DOMAIN",r[0]),f_("EVENT_REPORT_BACKUP_DOMAIN",r[1]||r[0]),f_("LOG_UPLOAD_SERVER","".concat(r[0],":6444")),_e.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(r){if(Qm(r,"streamType",[0,1]),this._remoteDefaultVideoStreamType=r,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(r),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(i){throw _e.error("[".concat(this._clientId,"] set default remote video stream type error"),i.toString()),i}else _e.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(r))}async setRemoteVideoStreamType(r,i){Qm(i,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(r,i),setTimeout(()=>{const s=this._users.find(l=>l.uid===r);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw _e.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}_e.info("[".concat(this._clientId,"] set remote ").concat(r," video stream type to ").concat(i)),this._remoteStreamTypeCacheMap.set(r,i)}async setStreamFallbackOption(r,i){Qm(i,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(r,i)}catch(s){throw _e.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}_e.info("[".concat(this._clientId,"] set remote ").concat(r," stream fallback type to ").concat(i)),this._streamFallbackTypeCacheMap.set(r,i)}setEncryptionConfig(r,i,s){if(function(l){Qm(l,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(r),tT(i,"secret"),["aes-128-gcm2","aes-256-gcm2"].includes(r)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new _a(_i.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new _a(_i.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(i)||_e.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=r,this._encryptionSecret=i,s&&(this._encryptionSalt=VO(s))}async renewToken(r){if(tT(r,"token",1,2047),!this._key||!this._joinInfo)throw new _a(_i.INVALID_OPERATION,"renewToken should not be called before user join");const i=this._key;this._key=r,this._joinInfo&&(this._joinInfo.token=r);const s=await this._renewTokenMutex.lock();try{if(kc("USE_NEW_TOKEN")){_e.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const l=await MX(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||j_);_e.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:r,ticket:l})}else _e.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:r});_e.debug("[".concat(this._clientId,"] renewToken success"))}catch(l){throw this._key=i,this._joinInfo.token=i,_e.error("[".concat(this._clientId,"] renewToken failed"),l.toString()),l}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?_e.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const r=this._p2pChannel.getAudioLevels();this.safeEmit(WE.VOLUME_INDICATOR,r)},kc("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const r=this._statsCollector.getRTCStats(),i=this._gateway.getInChannelInfo();return r.Duration=Math.round(i.duration/1e3),r}async startLiveStreaming(r,i){if(!i){if(this.codec!=="h264")throw new _a(_i.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new _a(_i.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(r)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(r))throw new _a(_i.LIVE_STREAMING_TASK_CONFLICT);const s=i?Y_.TRANSCODE:Y_.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(r,s)}setLiveTranscoding(r){return this._createLiveStreamingClient(Y_.TRANSCODE).setTranscodingConfig(r)}async stopLiveStreaming(r){const i=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(r));if(!i.length)throw new _a(_i.INVALID_PARAMS,"can not find live streaming url to stop");await SE.all(i.map(s=>s&&s.stopLiveStreamingTask(r)))}async addInjectStreamUrl(r,i){if(!this._joinInfo)throw new _a(_i.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const s=this._createLiveStreamingClient(Y_.INJECT);s.setInjectStreamConfig(i,0),await s.startLiveStreamingTask(r,Y_.INJECT)}async removeInjectStreamUrl(){var r;const i=this._createLiveStreamingClient(Y_.INJECT),s=Array.from(LS(r=i.streamingTasks).call(r)).find(l=>l.mode===Y_.INJECT);if(!this._joinInfo||!s)throw new _a(_i.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await i.stopLiveStreamingTask(s.url)}async startChannelMediaRelay(r){m3(r),await this._createChannelMediaRelayClient().startChannelMediaRelay(r)}async updateChannelMediaRelay(r){m3(r),await this._createChannelMediaRelayClient().updateChannelMediaRelay(r)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendStreamMessage(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new _a(_i.INVALID_OPERATION,"can not send data stream, not joined");if(typeof r=="string"&&(r=new TextEncoder().encode(r)),new Blob([r]).size>1024)throw new _a(_i.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(LE.DATA_STREAM,{payload:VO(r)},!i)}sendMetadata(r){if(!this._joinInfo)throw new _a(_i.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([r]).size>1024)throw new _a(_i.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(LE.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:VO(r)})}async sendCustomReportMessage(r){if(Array.isArray(r)||(r=[r]),r.forEach(J7),!this._joinInfo)throw new _a(_i.INVALID_OPERATION,"can not send custom report, not joined");await AE.sendCustomReportMessage(this._joinInfo.sid,r)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(r,i){Qm(i.spatialLayer,"spatialLayer",[0,1,2,3]),Qm(i.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(r,i)}catch(s){throw _e.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}_reset(){if(_e.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=jT.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._users.forEach(r=>{r._audioTrack&&r._audioTrack._destroy(),r._videoTrack&&r._videoTrack._destroy()}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new mT("client-publish"),this._subscribeMutex=new mT("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(r,i){const s=r||eL();r?_e.debug("[".concat(this._clientId,"] new Session ").concat(s)):_e.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(s)),this._sessionId=s,this.store.sessionId=s,i?AE.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:i.channel,appid:i.appId,mode:this.mode}):this._joinInfo?AE.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&AE.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=s),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=s)}async _publishHighStream(r){if(!this._joinInfo||this._uid===void 0)throw new _a(_i.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _a(_i.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&kc("FORCE_TURN")&&!kc("TURN_ENABLE_TCP")&&!kc("TURN_ENABLE_UDP"))throw new _a(_i.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");_e.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(r,this._isDualStreamEnabled,this._lowStreamParameter),l=(await s.next()).value;if(l){var i;let p;try{p=await this._gateway.publish(this._uid,l,!0)}catch(_){if(_.code!==_i.DISCONNECT_P2P)throw s.throw(_),_}await s.next(((i=p)===null||i===void 0?void 0:i.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const p of r)p instanceof q_&&p._encoderConfig&&this._gateway.setVideoProfile(p._encoderConfig),!p.muted&&p.enabled||await this._p2pChannel.muteLocalTrack(p)}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,r),(s==null?void 0:s.code)===_i.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new _a(_i.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _a(_i.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));_e.debug("[".concat(this._clientId,"] publish low stream"));const r=this._configDistribute.getLowStreamConfigDistribute();r&&r.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&r.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=r.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),l=(await s.next()).value;if(l){var i;let p;try{p=await this._gateway.publish(this._uid,l,!0)}catch(_){if(_.code!==_i.DISCONNECT_P2P)throw s.throw(_),_}s.next(((i=p)===null||i===void 0?void 0:i.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===_i.WS_ABORT)return;throw s}}_createLiveStreamingClient(r){if(!this._joinInfo||!this._appId)return new _a(_i.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=()=>new jX(this._joinInfo,this._config.websocketRetryConfig||j_,this._config.httpRetryConfig||j_),s=l=>{l.onLiveStreamError=(p,_)=>{AE.reportApiInvoke(this._sessionId,{name:V_.ON_LIVE_STREAM_ERROR,options:[p,_],tag:S_.TRACER}).onSuccess(),this.safeEmit(WE.LIVE_STREAMING_ERROR,p,_)},l.onLiveStreamWarning=(p,_)=>{AE.reportApiInvoke(this._sessionId,{name:V_.ON_LIVE_STREAM_WARNING,options:[p,_],tag:S_.TRACER}).onSuccess(),this.safeEmit(WE.LIVE_STREAMING_WARNING,p,_)},l.on(bI.REQUEST_WORKER_MANAGER_LIST,(p,_,b)=>{if(!this._joinInfo)return b(new _a(_i.INVALID_OPERATION,"can not find join info to get worker manager"));l3(p,this._joinInfo,this._axiosCancelSource.token,j_).then(_).catch(b)})};switch(r){case Y_.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=i(),s(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Y_.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=i(),s(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Y_.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=i(),this._injectStreamingClient.on(bI.REQUEST_WORKER_MANAGER_LIST,(l,p,_)=>{if(!this._joinInfo)return _(new _a(_i.INVALID_OPERATION,"can not find join info to get worker manager"));l3(l,this._joinInfo,this._axiosCancelSource.token,j_).then(p).catch(_)}),this._injectStreamingClient.onInjectStatusChange=(l,p,_)=>{this.emit(WE.INJECT_STREAM_STATUS,l,p,_)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new _a(_i.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:i}=this.getLocalVideoStats(),s={width:r,height:i};this._channelMediaRelayClient=new FX(this._joinInfo,this._clientId,this._config.websocketRetryConfig||j_,this._config.httpRetryConfig||j_,s),this._channelMediaRelayClient.on("state",l=>{l===_T.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(WE.CHANNEL_MEDIA_RELAY_STATE,l)}),this._channelMediaRelayClient.on("event",l=>{this.safeEmit(WE.CHANNEL_MEDIA_RELAY_EVENT,l)}),this._statsCollector.onStatsChanged=(l,p)=>{var _;l==="resolution"&&((_=this._channelMediaRelayClient)===null||_===void 0||_.setVideoProfile(p))}}return this._channelMediaRelayClient}_handleGatewayEvents(){this._gateway.on(R_.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(R_.CONNECTION_STATE_CHANGE,(r,i,s)=>{var l;if(s===o_.FALLBACK)return;const p=()=>{this.safeEmit(WE.CONNECTION_STATE_CHANGE,r,i,s)};if(AE.reportApiInvoke(this._sessionId||((l=this._gateway.joinInfo)===null||l===void 0?void 0:l.sid)||null,{name:V_.CONNECTION_STATE_CHANGE,options:[r,i,s],tag:S_.TRACER}).onSuccess(JSON.stringify({cur:r,prev:i,reason:s})),_e.info("[".concat(this._clientId,"] connection state change: ").concat(i," -> ").concat(r)),r==="DISCONNECTED")return this._reset(),void p();if(r==="RECONNECTING")this._users.forEach(b=>{b._trust_in_room_=!1,b._trust_audio_enabled_state_=!1,b._trust_video_enabled_state_=!1,b._trust_audio_mute_state_=!1,b._trust_video_mute_state_=!1,b._trust_audio_stream_added_state_=!1,b._trust_video_stream_added_state_=!1,b._audioSSRC=void 0,b._videoSSRC=void 0,b._videoOrtc=void 0,b._audioOrtc=void 0,b._cname=void 0,b._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(r==="CONNECTED"){var _;this._streamFallbackTypeCacheMap.forEach((b,P)=>{this._gateway.setStreamFallbackOption(P,b).catch(x=>{_e.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),x)})}),this._remoteStreamTypeCacheMap.forEach((b,P)=>{this._gateway.setRemoteVideoStreamType(P,b).catch(x=>{_e.warning("[".concat(this._clientId,"] auto set remote stream type failed"),x)})}),this._remoteDefaultVideoStreamType!==void 0&&((_=this._joinInfo)===null||_===void 0?void 0:_.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{_e.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(b=>{_e.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(b))}),this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(b=>!b._trust_in_room_).forEach(b=>{_e.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(b.uid)),this._handleUserOffline({uid:b.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(b=>{b._trust_audio_mute_state_||(_e.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(b.uid)),this._handleMuteStream(b.uid,"audio",!1)),b._trust_video_mute_state_||(_e.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(b.uid)),this._handleMuteStream(b.uid,"video",!1)),b._trust_audio_enabled_state_||(_e.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(b.uid)),this._handleSetStreamLocalEnable("audio",b.uid,!0)),b._trust_video_enabled_state_||(_e.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(b.uid)),this._handleSetStreamLocalEnable("video",b.uid,!0)),b._trust_video_stream_added_state_||(_e.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(b.uid)),this._handleResetAddStream(b,"video")),b._trust_audio_stream_added_state_||(_e.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(b.uid)),this._handleResetAddStream(b,"audio")),b._video_added_||b._audio_added_||(_e.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(b.uid)),this._handleRemoveStream({uid:b.uid,uint_id:b._uintid}))}))},1e3)}p()}),this._gateway.on(R_.REQUEST_NEW_GATEWAY_LIST,(r,i)=>{if(!this._joinInfo)return i(new _a(_i.UNEXPECTED_ERROR,"can not recover, no join info"));uL(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||j_,this.store).then(s=>{this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip),r(s.gatewayInfo.gatewayAddrs.map(l=>{if(this._joinInfo&&this._joinInfo.proxyServer){const p=l.address.split(":");return"wss://".concat(this._joinInfo.proxyServer,"/ws/?h=").concat(p[0],"&p=").concat(p[1])}return"wss://".concat(l.address)}))}).catch(i)}),this._gateway.on(R_.NETWORK_QUALITY,r=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(WE.NETWORK_QUALITY,r)}),this._gateway.on(R_.STREAM_TYPE_CHANGE,(r,i)=>{this.safeEmit(WE.STREAM_TYPE_CHANGED,r,i),AE.reportApiInvoke(this._sessionId,{name:V_.STREAM_TYPE_CHANGE,options:[r,i],tag:S_.TRACER}).onSuccess(JSON.stringify({uid:r,streamType:i}))}),this._gateway.on(R_.IS_P2P_DISCONNECTED,r=>{this._p2pChannel.isP2PDisconnected()?r(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?r(!1):r(!0)}),this._gateway.on(R_.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(R_.REQUEST_P2P_CONNECTION_PARAMS,async(r,i,s)=>{try{i(await this._p2pChannel.startP2PConnection(r))}catch(l){s(l)}}),this._gateway.on(R_.JOIN_RESPONSE,(r,i)=>{const{dtlsParameters:s,iceParameters:l,candidates:p,rtpCapabilities:_,setup:b,cname:P}=VG(r.ortc,i);this._p2pChannel.connect(l,s,p,_,b,P)}),this._gateway.on(R_.REQUEST_DC_CONNECTION_PARAMS,r=>{r(this._p2pChannel.getEstablishParams())}),this._gateway.on(R_.RESET_SIGNAL,r=>{this._p2pChannel.resetConnection(r),this._handleGatewaySignalEvents()}),this._gateway.on(R_.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(R_.DATACHANNEL_PRECONNECT,async(r,i,s,l)=>{var p,_,b,P,x,H;await this._p2pChannel.startP2PConnection({turnServer:(p=this._joinInfo)===null||p===void 0?void 0:p.turnServer},!0);const B=function(z,Wt){let _r;return Wt&&Wt.ip&&typeof Wt.port=="number"?(_r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:Wt.ip,port:Wt.port.toString(),type:"host",extension:{}}],_e.debug("Using remote candidate from AP ".concat(Wt.ip,":").concat(Wt.port)),Wt.ip6&&(_r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:Wt.ip6,port:Wt.port.toString(),type:"host",extension:{}}),_e.debug("Using IPV6 remote candidate from AP ".concat(Wt.ip6,":").concat(Wt.port)))):_r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:z.ip,port:z.port.toString(),type:"host",extension:{}}],_r}(r,i);return this._p2pChannel.preConnect({iceUfrag:"".concat((_=this._joinInfo)===null||_===void 0?void 0:_.apResponse.cid,"_").concat((b=this._joinInfo)===null||b===void 0?void 0:b.apResponse.cert),icePwd:"".concat((P=this._joinInfo)===null||P===void 0?void 0:P.apResponse.cid,"_").concat((x=this._joinInfo)===null||x===void 0?void 0:x.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(H=kc("FINGERPRINT"))!==null&&H!==void 0?H:r.fingerprint}]},B,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(s).catch(l)})}_handleGatewaySignalEvents(){this._gateway.signal.on(GE.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(GE.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(GE.ON_ADD_AUDIO_STREAM,r=>this._handleAddAudioOrVideoStream("audio",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc)),this._gateway.signal.on(GE.ON_ADD_VIDEO_STREAM,r=>this._handleAddAudioOrVideoStream("video",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc,r.rtxSsrcId)),this._gateway.signal.on(GE.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(GE.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(GE.MUTE_AUDIO,r=>this._handleMuteStream(r.uid,"audio",!0)),this._gateway.signal.on(GE.UNMUTE_AUDIO,r=>this._handleMuteStream(r.uid,"audio",!1)),this._gateway.signal.on(GE.MUTE_VIDEO,r=>this._handleMuteStream(r.uid,"video",!0)),this._gateway.signal.on(GE.UNMUTE_VIDEO,r=>this._handleMuteStream(r.uid,"video",!1)),this._gateway.signal.on(GE.RECEIVE_METADATA,r=>{const i=rL(r.metadata);this.safeEmit(WE.RECEIVE_METADATA,r.uid,i)}),this._gateway.signal.on(GE.ON_DATA_STREAM,r=>{r.seq&&delete r.seq,r.payload=rL(r.payload),this.safeEmit(WE.STREAM_MESSAGE,r.uid,r.payload),this.onStreamMessage&&this.onStreamMessage(r)}),this._gateway.signal.on(GE.ON_CRYPT_ERROR,()=>{c0(()=>{_e.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(WE.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(GE.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(GE.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{_e.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0),this.safeEmit(WE.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(GE.ON_STREAM_FALLBACK_UPDATE,r=>{_e.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(r.stream_id,", attr: ").concat(r.stream_type)),this.safeEmit(WE.STREAM_FALLBACK,r.stream_id,r.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(GE.ON_PUBLISH_STREAM,r=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:r.proxy})),_e.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(r))))}),this._gateway.signal.on(GE.ENABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!0)}),this._gateway.signal.on(GE.DISABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!1)}),this._gateway.signal.on(wE.REQUEST_TIMEOUT,(r,i)=>{if(this._joinInfo)switch(r){case LE.PUBLISH:{if(!i)return;const b=(i=i).ortc;if(b){var s,l,p,_;const P=b.some(B=>{let{stream_type:z}=B;return z===z_.Audio}),x=b.some(B=>{let{stream_type:z}=B;return z!==z_.Audio}),H=b.some(B=>{let{stream_type:z}=B;return z===z_.Screen||z===z_.ScreenLow});i.state==="offer"&&AE.publish(this._joinInfo.sid,{eventElapse:ZT.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:_i.TIMEOUT,audio:P,video:x,p2pid:i.p2p_id,publishRequestid:this.store.pubId,screenshare:H,audioName:P?(s=b.find(B=>{let{stream_type:z}=B;return z===z_.Audio}))===null||s===void 0||(l=s.ssrcs[0])===null||l===void 0?void 0:l.ssrcId.toString():void 0,videoName:x?(p=b.find(B=>{let{stream_type:z}=B;return z!==z_.Audio}))===null||p===void 0||(_=p.ssrcs[0])===null||_===void 0?void 0:_.ssrcId.toString():void 0})}break}case LE.SUBSCRIBE:(i=i)&&AE.subscribe(this._joinInfo.sid,{succ:!1,ec:_i.TIMEOUT,audio:i.stream_type===VE.AUDIO,video:i.stream_type===VE.VIDEO,peerid:i.stream_id,subscribeRequestid:i.ssrcId,p2pid:this.store.p2pId,eventElapse:ZT.measureFromSubscribeStart(this.store.clientId,i.ssrcId)})}}),this._gateway.signal.on(GE.ON_P2P_OK,r=>{this.uid,this._uid}),this._gateway.signal.on(GE.ON_PUBLISHED_USER_LIST,r=>{if(r==null||!r.users)return;kc("BLOCK_LOCAL_CLIENT")&&(r.users=r.users.filter(l=>!VR(l.audio_ssrc,this.channelName)));const i=[],s=[];for(const l of r.users){let p=this._users.find(H=>H.uid===l.stream_id);p?p._trust_in_room_=!0:(p=new hL(l.stream_id,l.stream_id),this._users.push(p),this.getListeners(WE.PUBLISHED_USER_LIST).length===0&&(_e.debug("[".concat(this._clientId,"] user online"),l.stream_id),this.safeEmit(WE.USER_JOINED,p)));const _=F_.Audio&l.stream_type,b=(F_.Video|F_.LwoVideo)&l.stream_type,P=_&&p.hasAudio,x=b&&p.hasVideo;b&&(p._trust_video_stream_added_state_=!0,p._video_added_=!0,p._videoSSRC=l.video_ssrc,p._rtxSsrcId=l.video_rtx),_&&(p._trust_audio_stream_added_state_=!0,p._audio_added_=!0,p._audioSSRC=l.audio_ssrc),_&&!P&&this.getListeners(WE.PUBLISHED_USER_LIST).length===0&&(_e.info("[".concat(this._clientId,"] remote user ").concat(p.uid," published audio")),this.safeEmit(WE.USER_PUBLISHED,p,"audio")),b&&!x&&this.getListeners(WE.PUBLISHED_USER_LIST).length===0&&(_e.info("[".concat(this._clientId,"] remote user ").concat(p.uid," published video")),this.safeEmit(WE.USER_PUBLISHED,p,"video")),(_&&!P||b&&!x)&&i.push(p),b&&this._p2pChannel.hasPendingRemoteMedia(p,"video")&&s.push({user:p,mediaType:"video"}),_&&this._p2pChannel.hasPendingRemoteMedia(p,"audio")&&s.push({user:p,mediaType:"audio"})}s.length>0&&(_e.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(l=>"user: ".concat(l.user.uid,", mediaType: ").concat(l.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(l=>{_e.error("[".concat(this._clientId,"] mass resubscribe error"),l.toString())})),this.getListeners(WE.PUBLISHED_USER_LIST).length>0?(_e.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(i.map(l=>l.uid).join(", "))),this.safeEmit(WE.PUBLISHED_USER_LIST,i)):_e.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(i.map(l=>l.uid).join(", ")))})}_handleP2PChannelEvents(){this._p2pChannel.on(XE.RequestMuteLocal,async(r,i,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(r,this._joinInfo.stringUid||this._joinInfo.uid),i()}catch(l){l.code===_i.DISCONNECT_P2P?i():s(l)}else i()}),this._p2pChannel.on(XE.RequestUnmuteLocal,async(r,i,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(r,this._joinInfo.stringUid||this._joinInfo.uid),i()}catch(l){l.code===_i.DISCONNECT_P2P?i():s(l)}else i()}),this._p2pChannel.on(XE.RequestRePublish,(r,i,s)=>{this.publish(r,!1).then(i).catch(s)}),this._p2pChannel.on(XE.RequestReSubscribe,async(r,i,s)=>{try{for(const{user:l,kind:p}of r)p===VE.VIDEO?await this.subscribe(l,"video"):await this.subscribe(l,"audio");i()}catch(l){s(l)}}),this._p2pChannel.on(XE.RequestUploadStats,(r,i)=>{this._gateway.uploadStats(r,i)}),this._p2pChannel.on(XE.MediaReconnectStart,r=>{this.safeEmit(WE.MEDIA_RECONNECT_START,r)}),this._p2pChannel.on(XE.MediaReconnectEnd,r=>{this.safeEmit(WE.MEDIA_RECONNECT_END,r)}),this._p2pChannel.on(XE.NeedSignalRTT,r=>{r(this._gateway.getSignalRTT())}),this._p2pChannel.on(XE.RequestRestartICE,async r=>{const i=await this._p2pChannel.restartICE(r),s=await i.next();if(s.done)return;const l=s.value;let p;try{p=await this._gateway.restartICE({iceParameters:l})}catch(b){return void i.throw(b)}const{iceParameters:_}=function(b){const P=b.iceParameters;return{iceParameters:{iceUfrag:P.iceUfrag,icePwd:P.icePwd}}}(p);await i.next({remoteIceParameters:_})}),this._p2pChannel.on(XE.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(XE.RequestReconnectPC,async()=>{var r;const{iceParameters:i,dtlsParameters:s,rtpCapabilities:l}=await this._p2pChannel.startP2PConnection({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer}),{gatewayEstablishParams:p,gatewayAddress:_}=await this._gateway.reconnectPC({iceParameters:i,dtlsParameters:s,rtpCapabilities:l}),{dtlsParameters:b,iceParameters:P,candidates:x,rtpCapabilities:H,setup:B,cname:z}=VG(p,_);await this._p2pChannel.connect(P,b,x,H,B,z),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(XE.RequestUnpublishForReconnectPC,async(r,i,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(r,this._uid),i()):s()}),this._p2pChannel.on(XE.P2PLost,()=>{this.safeEmit(WE.P2P_LOST,this.store.uid)}),this._p2pChannel.on(XE.UpdateVideoEncoder,r=>{r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig)}),this._p2pChannel.on(XE.ConnectionTypeChange,r=>{this.safeEmit(WE.IS_USING_CLOUD_PROXY,r)}),this._p2pChannel.on(XE.RequestLowStreamParameter,r=>{r(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(XE.QueryClientConnectionState,r=>{r(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(r){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new _a(_i.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new _a(_i.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!r)throw new _a(_i.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!r.inspectType||!Array.isArray(r.inspectType))throw new _a(_i.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const i=[...new Set(r.inspectType)];i.forEach(s=>{if(!["supervise","moderation"].includes(s))throw new _a(_i.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(s," is not a valid inspect type."))}),r.inspectType=i}if(r&&r.extraInfo&&r.extraInfo.length>1024)throw new _a(_i.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const i=new nN(r);this._inspect=i,this.handleVideoInspectEvents(this._inspect),await i.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},j_)}catch(i){throw Array.isArray(i)?i[0]:i}}async disableContentInspect(){if(!this._inspect)throw new _a(_i.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}async setImageModeration(r,i){if(vI(r,"enabled"),r){if(!i)throw new _a(_i.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(__(i.interval,"interval",1e3,1/0),this.connectionState!=="CONNECTED"||!this._joinInfo)throw new _a(_i.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(i);const s=new zL(i);this._moderation=s,this.handleImageModerationEvents(this._moderation),await s.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},j_)}catch(s){throw Array.isArray(s)?s[0]:s}}else{if(!this._moderation)throw new _a(_i.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(s){throw Array.isArray(s)?s[0]:s}}}handleImageModerationEvents(r){r.on($T.CONNECTION_STATE_CHANGE,(i,s)=>{switch(this.emit(WE.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,i,s),i){case kT.CONNECTED:if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new _a(_i.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");r.inspectImage()}}),r.on($T.CLIENT_LOCAL_VIDEO_TRACK,i=>{i(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}handleVideoInspectEvents(r){r.on(J_.CONNECTION_STATE_CHANGE,(i,s)=>{switch(this.emit(WE.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,i,s),s){case BT.CONNECTED:if(this.connectionState!=="CONNECTED")return void this.emit(WE.CONTENT_INSPECT_ERROR,new _a(_i.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));r.inspectImage()}}),r.on(J_.INSPECT_RESULT,(i,s)=>{var l;if((s==null?void 0:s.code)===_i.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return _e.debug("Stop inspect content because that has left channel"),this==null||(l=this._inspect)===null||l===void 0||l.close(),void(this._inspect=void 0);this.emit(WE.CONTENT_INSPECT_RESULT,i,s)}),r.on(J_.CLIENT_LOCAL_VIDEO_TRACK,i=>{i(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return _e.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(r){vI(r,"enabled"),f_("ENABLE_PUBLISH_AUDIO_FILTER",r),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(r)}_handleResetAddStream(r,i){switch(i){case"audio":r._audio_added_=!1,r._trust_audio_stream_added_state_=!0;break;case"video":r._video_added_=!1,r._trust_video_stream_added_state_=!0}}}).prototype,"leave",[$4],Object.getOwnPropertyDescriptor(_E.prototype,"leave"),_E.prototype),iE(_E.prototype,"publish",[Z4],Object.getOwnPropertyDescriptor(_E.prototype,"publish"),_E.prototype),iE(_E.prototype,"unpublish",[_q],Object.getOwnPropertyDescriptor(_E.prototype,"unpublish"),_E.prototype),iE(_E.prototype,"subscribe",[t6],Object.getOwnPropertyDescriptor(_E.prototype,"subscribe"),_E.prototype),iE(_E.prototype,"massSubscribe",[e6],Object.getOwnPropertyDescriptor(_E.prototype,"massSubscribe"),_E.prototype),iE(_E.prototype,"unsubscribe",[n6],Object.getOwnPropertyDescriptor(_E.prototype,"unsubscribe"),_E.prototype),iE(_E.prototype,"massUnsubscribe",[r6],Object.getOwnPropertyDescriptor(_E.prototype,"massUnsubscribe"),_E.prototype),iE(_E.prototype,"setLowStreamParameter",[i6],Object.getOwnPropertyDescriptor(_E.prototype,"setLowStreamParameter"),_E.prototype),iE(_E.prototype,"enableDualStream",[o6],Object.getOwnPropertyDescriptor(_E.prototype,"enableDualStream"),_E.prototype),iE(_E.prototype,"disableDualStream",[s6],Object.getOwnPropertyDescriptor(_E.prototype,"disableDualStream"),_E.prototype),iE(_E.prototype,"setClientRole",[a6],Object.getOwnPropertyDescriptor(_E.prototype,"setClientRole"),_E.prototype),iE(_E.prototype,"setProxyServer",[c6],Object.getOwnPropertyDescriptor(_E.prototype,"setProxyServer"),_E.prototype),iE(_E.prototype,"setTurnServer",[u6],Object.getOwnPropertyDescriptor(_E.prototype,"setTurnServer"),_E.prototype),iE(_E.prototype,"setLicense",[d6],Object.getOwnPropertyDescriptor(_E.prototype,"setLicense"),_E.prototype),iE(_E.prototype,"startProxyServer",[l6],Object.getOwnPropertyDescriptor(_E.prototype,"startProxyServer"),_E.prototype),iE(_E.prototype,"stopProxyServer",[h6],Object.getOwnPropertyDescriptor(_E.prototype,"stopProxyServer"),_E.prototype),iE(_E.prototype,"setLocalAccessPointsV2",[p6],Object.getOwnPropertyDescriptor(_E.prototype,"setLocalAccessPointsV2"),_E.prototype),iE(_E.prototype,"setLocalAccessPoints",[f6],Object.getOwnPropertyDescriptor(_E.prototype,"setLocalAccessPoints"),_E.prototype),iE(_E.prototype,"setRemoteDefaultVideoStreamType",[E6],Object.getOwnPropertyDescriptor(_E.prototype,"setRemoteDefaultVideoStreamType"),_E.prototype),iE(_E.prototype,"setRemoteVideoStreamType",[_6],Object.getOwnPropertyDescriptor(_E.prototype,"setRemoteVideoStreamType"),_E.prototype),iE(_E.prototype,"setStreamFallbackOption",[m6],Object.getOwnPropertyDescriptor(_E.prototype,"setStreamFallbackOption"),_E.prototype),iE(_E.prototype,"setEncryptionConfig",[g6],Object.getOwnPropertyDescriptor(_E.prototype,"setEncryptionConfig"),_E.prototype),iE(_E.prototype,"renewToken",[v6],Object.getOwnPropertyDescriptor(_E.prototype,"renewToken"),_E.prototype),iE(_E.prototype,"enableAudioVolumeIndicator",[y6],Object.getOwnPropertyDescriptor(_E.prototype,"enableAudioVolumeIndicator"),_E.prototype),iE(_E.prototype,"startLiveStreaming",[b6],Object.getOwnPropertyDescriptor(_E.prototype,"startLiveStreaming"),_E.prototype),iE(_E.prototype,"setLiveTranscoding",[T6],Object.getOwnPropertyDescriptor(_E.prototype,"setLiveTranscoding"),_E.prototype),iE(_E.prototype,"stopLiveStreaming",[S6],Object.getOwnPropertyDescriptor(_E.prototype,"stopLiveStreaming"),_E.prototype),iE(_E.prototype,"addInjectStreamUrl",[R6],Object.getOwnPropertyDescriptor(_E.prototype,"addInjectStreamUrl"),_E.prototype),iE(_E.prototype,"removeInjectStreamUrl",[I6],Object.getOwnPropertyDescriptor(_E.prototype,"removeInjectStreamUrl"),_E.prototype),iE(_E.prototype,"startChannelMediaRelay",[O6],Object.getOwnPropertyDescriptor(_E.prototype,"startChannelMediaRelay"),_E.prototype),iE(_E.prototype,"updateChannelMediaRelay",[A6],Object.getOwnPropertyDescriptor(_E.prototype,"updateChannelMediaRelay"),_E.prototype),iE(_E.prototype,"stopChannelMediaRelay",[C6],Object.getOwnPropertyDescriptor(_E.prototype,"stopChannelMediaRelay"),_E.prototype),iE(_E.prototype,"sendCustomReportMessage",[w6],Object.getOwnPropertyDescriptor(_E.prototype,"sendCustomReportMessage"),_E.prototype),iE(_E.prototype,"pickSVCLayer",[N6],Object.getOwnPropertyDescriptor(_E.prototype,"pickSVCLayer"),_E.prototype),iE(_E.prototype,"enableContentInspect",[D6],Object.getOwnPropertyDescriptor(_E.prototype,"enableContentInspect"),_E.prototype),iE(_E.prototype,"disableContentInspect",[P6],Object.getOwnPropertyDescriptor(_E.prototype,"disableContentInspect"),_E.prototype),iE(_E.prototype,"setImageModeration",[k6],Object.getOwnPropertyDescriptor(_E.prototype,"setImageModeration"),_E.prototype),iE(_E.prototype,"getJoinChannelServiceRecords",[L6],Object.getOwnPropertyDescriptor(_E.prototype,"getJoinChannelServiceRecords"),_E.prototype),iE(_E.prototype,"setPublishAudioFilterEnabled",[M6],Object.getOwnPropertyDescriptor(_E.prototype,"setPublishAudioFilterEnabled"),_E.prototype),_E);class h$ extends kV{set currentState(i){i!==this._currentState&&(this._currentState=i,this.safeEmit(IT.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(i){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),$(this,"audioBuffer",void 0),$(this,"sourceNode",void 0),$(this,"startPlayTime",0),$(this,"startPlayOffset",0),$(this,"pausePlayTime",0),$(this,"options",void 0),$(this,"currentLoopCount",0),$(this,"currentPlaybackSpeed",100),$(this,"_currentState","stopped"),this.audioBuffer=i,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(i){this.currentState==="stopped"?(this.options=i,this.startPlayOffset=this.options.startPlayTime||0):_e.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(i){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=i,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=i))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}setAudioBufferPlaybackSpeed(i){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=i/100),this.currentPlaybackSpeed=i}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const i=this.context.createBufferSource();return i.buffer=this.audioBuffer,i.loop=!!this.options.loop,i.connect(this.outputNode),i.playbackRate.value=this.currentPlaybackSpeed/100,i}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const x6=new Map;async function p$(r,i){let s=null;if(typeof r=="string"){const p=x6.get(r);if(p)return _e.debug("use cached audio resource: ",r),p;try{s=(await bS(()=>jT.get(r,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(_){throw new _a(_i.FETCH_AUDIO_FILE_FAILED,_.toString())}}else s=await new SE((_,b)=>{const P=new FileReader;P.onload=x=>{x.target?_(x.target.result):b(new _a(_i.READ_LOCAL_AUDIO_FILE_ERROR))},P.onerror=()=>{b(new _a(_i.READ_LOCAL_AUDIO_FILE_ERROR))},P.readAsArrayBuffer(r)});const l=await function(p){const _=II();return new SE((b,P)=>{_.decodeAudioData(p,x=>{b(x)},x=>{P(new _a(_i.DECODE_AUDIO_FILE_FAILED,x.toString()))})})}(s);return typeof r=="string"&&i&&x6.set(r,l),l}function j6(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function iN(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?j6(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):j6(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}function JL(r,i,s,l){s.optimizationMode&&(l&&l.width&&l.height?(s.encoderConfig=iN(iN({},l),{},{bitrateMin:l.bitrateMin,bitrateMax:l.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(i.contentHint=s.optimizationMode,i.contentHint===s.optimizationMode?_e.debug("[".concat(r,"] set content hint to"),s.optimizationMode):_e.debug("[".concat(r,"] set content hint failed")))):_e.warning("[".concat(r,"] can not apply optimization mode bitrate config, no encoderConfig")))}const f$=i_().name;function E$(r,i,s,l){let p,_=0,b=null;return new SE((P,x)=>{setTimeout(()=>{p&&(p(),P(_))},i),p=DV(()=>{(function(){_>l&&p&&(p(),P(_));const H=s.getContext("2d");if(!H){const Wt=new _a(_i.UNEXPECTED_ERROR,"can not get canvas 2d context.");return _e.error(Wt.toString()),void x(Wt)}H.drawImage(r,0,0,160,120);const B=H.getImageData(0,0,s.width,s.height),z=Math.floor(B.data.length/3);if(b){for(let Wt=0;Wt<z;Wt+=3)if(B.data[Wt]!==b[Wt])return _+=1,void(b=B.data);b=B.data}else b=B.data})()},30)})}class R0{constructor(i,s){$(this,"id",0),$(this,"element",void 0),$(this,"peerPair",void 0),$(this,"context",void 0),$(this,"audioPlayerElement",void 0),$(this,"audioTrack",void 0),R0.count+=1,this.id=R0.count,this.element=i,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=i=>{const s=document.createElement("audio");s.srcObject=new MediaStream([i.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const i=async(l,p)=>{const _=p==="offer"?await l.createOffer():await l.createAnswer();return await l.setLocalDescription(_),l.iceGatheringState==="complete"?l.localDescription:new SE(b=>{l.onicegatheringstatechange=()=>{l.iceGatheringState==="complete"&&b(l.localDescription)}})},s=async(l,p)=>await l.setRemoteDescription(p);try{const l=await i(this.peerPair[0],"offer");await s(this.peerPair[1],l);const p=await i(this.peerPair[1],"answer");await s(this.peerPair[0],p)}catch(l){throw new _a(_i.LOCAL_AEC_ERROR,l.toString()).print()}}async getTracksFromMediaElement(i){if(this.audioTrack)return this.audioTrack;let s;try{i instanceof HTMLVideoElement&&(i.captureStream?i.captureStream():i.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(i).connect(s)}catch(p){throw new _a(_i.LOCAL_AEC_ERROR,p.toString()).print()}if(!s)throw new _a(_i.LOCAL_AEC_ERROR,"no dest node when local aec").print();const l=s.stream.getAudioTracks()[0];return this.audioTrack=l,l}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const i=this.element,s=await this.getTracksFromMediaElement(i);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){_e.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(i=>{i.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var V6,oN;$(R0,"count",0);const _$=window.AudioContext||window.webkitAudioContext,m$=new(V6=PE({report:AE}),iE((oN=class{constructor(){$(this,"units",[]),$(this,"context",void 0)}processExternalMediaAEC(r){if(!this._doesEnvironmentNeedAEC())return _e.debug("the system does not need to process local aec"),-1;this.context||(this.context=new _$);let i=this.units.find(s=>s&&s.getElement()===r);return i||(i=new R0(r,this.context),this.units.push(i)),i.startEchoCancellation(),_e.debug("start processing local audio echo cancellation, id is",i.id),i.id}_doesEnvironmentNeedAEC(){return i_().name!==u_.SAFARI}}).prototype,"processExternalMediaAEC",[V6],Object.getOwnPropertyDescriptor(oN.prototype,"processExternalMediaAEC"),oN.prototype),oN);function F6(r,i){var s=Object.keys(r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);i&&(l=l.filter(function(p){return Object.getOwnPropertyDescriptor(r,p).enumerable})),s.push.apply(s,l)}return s}function B6(r){for(var i=1;i<arguments.length;i++){var s=arguments[i]!=null?arguments[i]:{};i%2?F6(Object(s),!0).forEach(function(l){$(r,l,s[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):F6(Object(s)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(s,l))})}return r}const XL=window||document;function G6(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!XL)return;const s=$_._cspEventHandlerPointer;if(s&&i)return void console.error(s,i);const l=p=>{if(!(p&&p.blockedURI&&($_.onSecurityPolicyViolation||$_.getListeners(RS.SECURITY_POLICY_VIOLATION).length>0)))return;const _=p.blockedURI;kc("CSP_DETECTED_HOSTNAME_LIST").some(b=>_.includes(b))&&($_.onSecurityPolicyViolation&&typeof $_.onSecurityPolicyViolation=="function"&&$_.onSecurityPolicyViolation(p),$_.getListeners(RS.SECURITY_POLICY_VIOLATION).length>0&&$_.safeEmit(RS.SECURITY_POLICY_VIOLATION,p))};s&&XL.removeEventListener("securitypolicyviolation",s),(i||r&&typeof r=="function"||$_.getListeners(RS.SECURITY_POLICY_VIOLATION).length>0)&&XL.addEventListener("securitypolicyviolation",l),$_._cspEventHandlerPointer=l}f_("PROCESS_ID","process-".concat(b_(8,""),"-").concat(b_(4,""),"-").concat(b_(4,""),"-").concat(b_(4,""),"-").concat(b_(12,""))),function(){const r=i_();dT.getDisplayMedia=function(i){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),dT.getStreamFromExtension=r.name===u_.CHROME&&Number(r.version)>34,dT.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const i=new RTCPeerConnection;let s=!1;try{i.addTransceiver("audio"),s=!0}catch{}return i.close(),s}(),dT.supportMinBitrate=r.name===u_.CHROME||r.name===u_.EDGE,dT.supportSetRtpSenderParameters=function(){const i=i_();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!LR()||!(!pT()&&!hO())||i.name===u_.FIREFOX&&Number(i.version)>=64}(),r.name===u_.SAFARI&&(Number(r.version)>=14?dT.supportDualStream=!0:dT.supportDualStream=!1),dT.webAudioMediaStreamDest=function(){const i=i_();return!(i.name===u_.SAFARI&&Number(i.version)<12)}(),dT.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),dT.supportWebGL=typeof WebGLRenderingContext<"u",dT.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,LR()||(dT.webAudioWithAEC=!0),dT.supportShareAudio=function(){const i=i_();return(i.os===Mb.WIN_10||i.os===Mb.WIN_81||i.os===Mb.WIN_7||i.os===Mb.LINUX||i.os===Mb.MAC_OS)&&i.name===u_.CHROME&&Number(i.version)>=74}(),dT.supportDualStreamEncoding=function(){const i=i_();return kc("DISABLE_WEBAUDIO")?!0:i.name==="Safari"&&Number(i.version)>=14||!!(i.name==="Chrome"&&/Windows/i.test(i.os||"")&&Number(i.version)>=100&&kc("CHROME_DUAL_STREAM_USE_ENCODING"))}(),dT.supportDataChannel=function(){return!!(ZD(76)||function(i){const s=i_();return!(s.name!==u_.FIREFOX||!s.osVersion)&&Number(s.version)>=i}(68)||function(i){const s=i_();return!(s.name!==u_.SAFARI||!s.osVersion)&&Number(s.version)>=i}(14))}(),dT.supportPCSetConfiguration=function(){const i=window.RTCPeerConnection;return!A_()&&!!i&&i.prototype.setConfiguration instanceof Function}(),dT.supportWebRTCEncodedTransform=function(){const i=i_();return i.name==="Chrome"&&Number(i.version)>=86}(),_e.info("browser compatibility",JSON.stringify(dT),JSON.stringify(r))}(),function(){let r;try{r=window.localStorage.getItem("websdk_ng_global_parameter")}catch(i){return void _e.error("Error loading sdk config",i.message)}if(r)try{const i=JSON.parse(window.atob(r)),s=Date.now();_e.debug("Loading global parameters from cache",i),Object.keys(i).forEach(l=>{if(Object.prototype.hasOwnProperty.call(RT,l)){const{value:p,expires:_}=i[l];if(_&&_<=s)return;xR[l]=p,RT[l]=p}})}catch(i){_e.error("Error loading mutableParamsCache: ".concat(r),i.message)}}(),Array.isArray(xR.AREAS)&&xR.AREAS.length>0&&sL(xR.AREAS,!0);const $_=function(r){const i=new I_,s=r,l={getListeners:i.getListeners.bind(i),on:(p,_)=>(function(b,P){b===RS.SECURITY_POLICY_VIOLATION&&G6(P,!0)}(p,_),i.on.bind(i)(p,_)),addListener:i.addListener.bind(i),once:i.once.bind(i),off:i.off.bind(i),removeAllListeners:i.removeAllListeners.bind(i),emit:i.emit.bind(i),safeEmit:i.safeEmit.bind(i)};return B6(B6({},s),l)}({__CLIENT_LIST__:jR,__TRACK_LIST__:n0,VERSION:QT,BUILD:gP,setParameter:(r,i,s)=>{_e.debug("setParameter key:".concat(r,", value:").concat(JSON.stringify(i))),f_(r,i,s)},getParameter:kc,getSupportedCodec:async function(){let r={audio:[],video:[]};try{let i=new RTCPeerConnection;i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const s=(await i.createOffer()).sdp;if(!s)return r;i.close(),i=null,r=function(l){const p={video:[],audio:[]};return l.match(/ VP8/i)&&p.video.push("VP8"),l.match(/ VP9/i)&&p.video.push("VP9"),l.match(/ AV1/i)&&p.video.push("AV1"),l.match(/ H264/i)&&p.video.push("H264"),l.match(/ H265/i)&&p.video.push("H265"),l.match(/ opus/i)&&p.audio.push("OPUS"),l.match(/ PCMU/i)&&p.audio.push("PCMU"),l.match(/ PCMA/i)&&p.audio.push("PCMA"),l.match(/ G722/i)&&p.audio.push("G722"),p}(s)}catch(i){throw new _a(_i.CREATE_OFFER_FAILED,i.toString&&i.toString()).print()}return r},checkSystemRequirements:function(){const r=AE.reportApiInvoke(null,{name:V_.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:S_.TRACER});let i=!1;try{const _=window.RTCPeerConnection,b=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,P=window.WebSocket;i=!!(_&&b&&P)}catch(_){return _e.error("check system requirement failed: ",_),!1}let s=!1;const l=i_();l.name===u_.CHROME&&Number(l.version)>=58&&(!TJ()||bJ())&&(s=!0),l.name===u_.FIREFOX&&Number(l.version)>=56&&(s=!0),l.name===u_.OPERA&&Number(l.version)>=45&&(s=!0),l.name===u_.SAFARI&&Number(l.version)>=11&&(s=!0),(o2()||i_().name===u_.QQ)&&(s=!0),_e.debug("checkSystemRequirements, api:",i,"browser",s);const p=i&&s;return r.onSuccess(p),p},getDevices:function(r){return KT.enumerateDevices(!0,!0,r)},getMicrophones:function(r){return KT.getRecordingDevices(r)},getCameras:function(r){return KT.getCamerasDevices(r)},getElectronScreenSources:MV,getPlaybackDevices:function(r){return KT.getSpeakers(r)},createClient:function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=AE.reportApiInvoke(null,{name:V_.CREATE_CLIENT,options:[r],tag:S_.TRACER});try{Q7(r)}catch(s){throw i.onError(s),s}return r.audioCodec===void 0&&(r.audioCodec="opus"),i.onSuccess(),new l$(S0(S0({forceWaitGatewayResponse:!0},r),{},{role:r.mode==="rtc"?"host":r.role||"audience"}))},createCameraVideoTrack:async function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=AE.reportApiInvoke(null,{tag:S_.TRACER,name:V_.CREATE_CAM_VIDEO_TRACK,options:[iN({},r)]}),s=qO(r),l=b_(8,"track-cam-");let p=null;_e.info("start create camera video track with config",JSON.stringify(r),"trackId",l);try{p=(await lS({video:s},l)).getVideoTracks()[0]||null}catch(b){throw i.onError(b),b}if(!p){const b=new _a(_i.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(b),b.throw()}r.optimizationMode&&JL(l,p,r,UR(r.encoderConfig));const _=new rG(p,r,s,r.scalabiltyMode?RO(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,l);return i.onSuccess(_.getTrackId()),_e.info("create camera video success, trackId:",l),_},createCustomVideoTrack:function(r){const i=AE.reportApiInvoke(null,{tag:S_.TRACER,name:V_.CREATE_CUSTOM_VIDEO_TRACK,options:[r]}),s=new q_(r.mediaStreamTrack,{width:r.width,height:r.height,frameRate:r.frameRate,bitrateMax:r.bitrateMax,bitrateMin:r.bitrateMin},r.scalabiltyMode?RO(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,b_(8,"track-cus-"),[X_.CUSTOM_TRACK]);return i.onSuccess(s.getTrackId()),_e.info("create custom video track success with config",r,"trackId",s.getTrackId()),s},createScreenVideoTrack:async function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=AE.reportApiInvoke(null,{tag:S_.TRACER,name:V_.CREATE_SCREEN_VIDEO_TRACK,options:[iN({},r),i]});r.encoderConfig?typeof r.encoderConfig=="string"||r.encoderConfig.width&&r.encoderConfig.height||(r.encoderConfig.width={max:1920},r.encoderConfig.height={max:1080}):r.encoderConfig="1080p_2";const l=BX(r),p=b_(8,"track-scr-v-");let _=null,b=null;const P=M_();if(!P.supportShareAudio&&i==="enable"){const B=new _a(_i.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return s.onError(B),B.throw()}_e.info("start create screen video track with config",r,"withAudio",i,"trackId",p);try{const B=await lS({screen:l,screenAudio:i==="auto"?P.supportShareAudio:i==="enable"},p);_=B.getVideoTracks()[0]||null,b=B.getAudioTracks()[0]||null}catch(B){throw s.onError(B),B}if(!_){const B=new _a(_i.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(B),B.throw()}if(!b&&i==="enable"){_&&_.stop();const B=new _a(_i.SHARE_AUDIO_NOT_ALLOWED);return s.onError(B),B.throw()}r.optimizationMode||(r.optimizationMode="detail"),r.optimizationMode&&(JL(p,_,r,r.encoderConfig&&yP(r.encoderConfig)),r.encoderConfig&&typeof r.encoderConfig!="string"&&(r.encoderConfig.bitrateMin=r.encoderConfig.bitrateMax));const x=new q_(_,r.encoderConfig?yP(r.encoderConfig):{},r.scalabiltyMode?RO(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,p,[X_.SCREEN_TRACK]);if(!b)return s.onSuccess(x.getTrackId()),_e.info("create screen video track success","video:",x.getTrackId()),x;const H=new oT(b,void 0,b_(8,"track-scr-a-"),!1,!0);return s.onSuccess([x.getTrackId(),H.getTrackId()]),_e.info("create screen video track success","video:",x.getTrackId(),"audio:",H.getTrackId()),[x,H]},createMicrophoneAndCameraTracks:async function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=AE.reportApiInvoke(null,{tag:S_.TRACER,name:V_.CREATE_MIC_AND_CAM_TRACKS,options:[r,i]}),l=qO(i),p=S3(r),_=b_(8,"track-mic-"),b=b_(8,"track-cam-");let P=null,x=null;_e.info("start create camera video track(".concat(b,") and microphone audio track(").concat(_,") with config, audio: ").concat(JSON.stringify(r),", video: ").concat(JSON.stringify(i)));try{const z=await lS({audio:p,video:l},"".concat(_,"-").concat(b));P=z.getAudioTracks()[0],x=z.getVideoTracks()[0]}catch(z){throw s.onError(z),z}if(!P||!x){const z=new _a(_i.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(z),z.throw()}i.optimizationMode&&JL(b,x,i,UR(i.encoderConfig));const H=new LO(P,r,p,_),B=new rG(x,i,l,i.scalabiltyMode?RO(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,b);return s.onSuccess([H.getTrackId(),B.getTrackId()]),_e.info("create camera video track(".concat(b,") and microphone audio track(").concat(_,") success")),[H,B]},createMicrophoneAudioTrack:async function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=AE.reportApiInvoke(null,{tag:S_.TRACER,name:V_.CREATE_MIC_AUDIO_TRACK,options:[r]}),s=S3(r),l=b_(8,"track-mic-");let p=null;_e.info("start create microphone audio track with config",JSON.stringify(r),"trackId",l);try{p=(await lS({audio:s},l)).getAudioTracks()[0]||null}catch(b){throw i.onError(b),b}if(!p){const b=new _a(_i.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(b),b.throw()}const _=new LO(p,r,s,l);return i.onSuccess(_.getTrackId()),_e.info("create microphone audio track success, trackId:",l),_},createCustomAudioTrack:function(r){const i=AE.reportApiInvoke(null,{tag:S_.TRACER,name:V_.CREATE_CUSTOM_AUDIO_TRACK,options:[r]}),s=new oT(r.mediaStreamTrack,r.encoderConfig?IO(r.encoderConfig):{},b_(8,"track-cus-"),!1,!0);return _e.info("create custom audio track success with config",r,"trackId",s.getTrackId()),i.onSuccess(s.getTrackId()),s},createBufferSourceAudioTrack:async function(r){const i=AE.reportApiInvoke(null,{tag:S_.TRACER,name:V_.CREATE_BUFFER_AUDIO_TRACK,options:[r]});if(kc("DISABLE_WEBAUDIO"))throw new _a(_i.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const s=b_(8,"track-buf-");_e.info("start create buffer source audio track with config",JSON.stringify(r),"trackId",s);const l=r.source;if(!(r.source instanceof AudioBuffer))try{r.source=await p$(r.source,r.cacheOnlineFile)}catch(b){return i.onError(b),b.throw()}const p=new h$(r.source),_=new gX(l,p,r.encoderConfig?IO(r.encoderConfig):{},s);return _e.info("create buffer source audio track success, trackId:",s),i.onSuccess(_.getTrackId()),_},setAppType:function(r){if(_e.debug("setAppType: ".concat(r)),!(Number.isInteger(r)&&r>=0))throw _e.debug("Invalid appType"),new _a(_i.INVALID_PARAMS,"invalid app type",r);f_("APP_TYPE",Math.floor(r))},setLogLevel:function(r){_e.setLogLevel(r)},enableLogUpload:function(){kc("USE_NEW_LOG")?f_("UPLOAD_LOG",!0):_e.enableLogUpload()},disableLogUpload:function(){kc("USE_NEW_LOG")?f_("UPLOAD_LOG",!1):_e.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new _3},checkAudioTrackIsActive:async function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=AE.reportApiInvoke(null,{tag:S_.TRACER,name:V_.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[i]});if(!(r instanceof oT||r instanceof _C)){const x=new _a(_i.INVALID_TRACK,"the parameter is not a audio track");return s.onError(x),x.throw()}i&&i<1e3&&(i=1e3);const l=r instanceof oT?r.getTrackLabel():"remote_track",p=r.getVolumeLevel();let _=p,b=p;const P=Date.now();return new SE(x=>{const H=setInterval(()=>{const B=r.getVolumeLevel();_=B>_?B:_,b=B<b?B:b;const z=_-b>1e-4,Wt=Date.now()-P;if(z||Wt>i){clearInterval(H);const _r=z,Di={duration:Wt,deviceLabel:l,maxVolumeLevel:_,result:_r};_e.info("[track-".concat(r.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(Di))),s.onSuccess(Di),x(_r)}},200)})},checkVideoTrackIsActive:async function(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=AE.reportApiInvoke(null,{tag:S_.TRACER,name:V_.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[i]});if(!(r instanceof q_||r instanceof _A)){const Wt=new _a(_i.INVALID_TRACK,"the parameter is not a video track");return s.onError(Wt),Wt.throw()}const l=4;i&&i<1e3&&(i=1e3);const p=r instanceof q_?r.getTrackLabel():"remote_track",_=r.getMediaStreamTrack(!0),b=document.createElement("video");b.style.width="1px",b.style.height="1px",b.setAttribute("muted",""),b.muted=!0,b.setAttribute("playsinline",""),b.controls=!1,(pT()||hO())&&(b.style.opacity="0.01",b.style.position="fixed",b.style.left="0",b.style.top="0",document.body.appendChild(b)),b.srcObject=new MediaStream([_]),b.play();const P=document.createElement("canvas");P.width=160,P.height=120;let x=0,H=0;try{const Wt=Date.now();x=await E$(b,i,P,l),H=Date.now()-Wt}catch(Wt){throw s.onError(Wt),Wt}f$===u_.SAFARI&&(b.pause(),b.remove()),b.srcObject=null;const B=x>l,z={duration:H,changedPicNum:x,deviceLabel:p,result:B};return _e.info("[track-".concat(r.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(z))),s.onSuccess(z),B},setArea:sL,audioElementPlayCenter:LT,processExternalMediaAEC:function(r){m$.processExternalMediaAEC(r)},registerExtensions:function(r){r.forEach(i=>{const s=i;s.__registered__=!0,s.logger.hookLog=_e.extLog,s.reporter.hookApiInvoke=AE.extApiInvoke,s.parameters&&Object.keys(s.parameters).forEach(l=>{s.parameters[l]=kc(l)})})},ChannelMediaRelayError:dR,ChannelMediaRelayEvent:TS,ChannelMediaRelayState:_T,RemoteStreamFallbackType:jP,RemoteStreamType:xP,ConnectionDisconnectedReason:o_,AudienceLatencyLevelType:PP,AREAS:JE});return Object.defineProperties($_,{onAudioAutoplayFailed:{get:()=>qT.onAudioAutoplayFailed,set:r=>{qT.onAudioAutoplayFailed=r}},onAutoplayFailed:{get:()=>qT.onAutoplayFailed,set:r=>{qT.onAutoplayFailed=r}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>$_._onSecurityPolicyViolation,set(r){$_._onSecurityPolicyViolation=r,G6(r)}}}),KT.on(YS.CAMERA_DEVICE_CHANGED,r=>{_e.info("camera device changed",JSON.stringify(r)),$_.onCameraChanged&&$_.onCameraChanged(r),$_.safeEmit(RS.CAMERA_CHANGED,r)}),KT.on(YS.RECORDING_DEVICE_CHANGED,r=>{_e.info("microphone device changed",JSON.stringify(r)),$_.onMicrophoneChanged&&$_.onMicrophoneChanged(r),$_.safeEmit(RS.MICROPHONE_CHANGED,r)}),KT.on(YS.PLAYOUT_DEVICE_CHANGED,r=>{_e.debug("playout device changed",JSON.stringify(r)),$_.onPlaybackDeviceChanged&&$_.onPlaybackDeviceChanged(r),$_.safeEmit(RS.PLAYBACK_DEVICE_CHANGED,r)}),LT.onAutoplayFailed=()=>{_e.info("detect audio element autoplay failed"),qT.onAudioAutoplayFailed&&qT.onAudioAutoplayFailed()},s_.on("autoplay-failed",()=>{_e.info("detect webaudio autoplay failed"),qT.onAudioAutoplayFailed&&qT.onAudioAutoplayFailed(),$_.safeEmit(RS.AUTOPLAY_FAILED)}),window&&(window.__ARTC__=$_),$_})})(AgoraRTC_NProduction);var AgoraRTC_NProductionExports=AgoraRTC_NProduction.exports;const AgoraRTC__default=getDefaultExportFromCjs(AgoraRTC_NProductionExports);function _objectWithoutPropertiesLoose(o,e){if(o==null)return{};var d={},h=Object.keys(o),f,g;for(g=0;g<h.length;g++)f=h[g],!(e.indexOf(f)>=0)&&(d[f]=o[f]);return d}var AgoraRTCErrorCode;(function(o){o.UNEXPECTED_ERROR="UNEXPECTED_ERROR",o.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",o.TIMEOUT="TIMEOUT",o.INVALID_PARAMS="INVALID_PARAMS",o.NOT_SUPPORTED="NOT_SUPPORTED",o.INVALID_OPERATION="INVALID_OPERATION",o.OPERATION_ABORTED="OPERATION_ABORTED",o.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",o.NETWORK_ERROR="NETWORK_ERROR",o.NETWORK_TIMEOUT="NETWORK_TIMEOUT",o.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",o.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",o.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",o.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",o.ELECTRON_IS_NULL="ELECTRON_IS_NULL",o.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",o.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",o.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",o.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",o.PERMISSION_DENIED="PERMISSION_DENIED",o.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",o.TRACK_IS_DISABLED="TRACK_IS_DISABLED",o.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",o.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",o.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",o.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",o.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",o.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",o.UID_CONFLICT="UID_CONFLICT",o.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",o.INVALID_TRACK="INVALID_TRACK",o.SENDER_NOT_FOUND="SENDER_NOT_FOUND",o.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",o.SET_ANSWER_FAILED="SET_ANSWER_FAILED",o.ICE_FAILED="ICE_FAILED",o.PC_CLOSED="PC_CLOSED",o.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",o.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",o.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",o.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",o.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",o.INVALID_REMOTE_USER="INVALID_REMOTE_USER",o.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",o.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",o.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",o.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",o.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",o.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",o.WS_ABORT="WS_ABORT",o.WS_DISCONNECT="WS_DISCONNECT",o.WS_ERR="WS_ERR",o.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",o.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",o.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",o.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",o.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",o.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",o.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",o.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",o.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",o.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",o.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",o.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",o.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",o.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",o.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",o.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",o.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",o.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"})(AgoraRTCErrorCode||(AgoraRTCErrorCode={}));var createClient$1=function(e){var d;function h(){return d||(d=AgoraRTC__default.createClient(e)),d}return function(){return h()}};function createMicrophoneAndCameraTracks(o,e){var d=function(){try{return Promise.resolve(AgoraRTC__default.createMicrophoneAndCameraTracks(o,e)).then(function(g){return h=g,h})}catch(g){return Promise.reject(g)}},h=null;return function(){var g=reactExports.useState(!1),A=g[0],C=g[1],k=reactExports.useState(null),j=k[0],_t=k[1],_n=reactExports.useRef(h);return reactExports.useEffect(function(){return _n.current===null?d().then(function(ue){_n.current=ue,C(!0)},function(ue){_t(ue)}):C(!0),function(){h=null}},[]),{ready:A,tracks:_n.current,error:j}}}var AgoraVideoPlayer=function(e){var d=reactExports.useRef(null),h=e.videoTrack,f=e.config,g=_objectWithoutPropertiesLoose(e,["videoTrack","config"]);return reactExports.useLayoutEffect(function(){return d.current!==null&&h.play(d.current,f),function(){h.stop()}},[h]),React.createElement("div",Object.assign({},g,{ref:d}))},agoraRtmSdk={exports:{}};/*
 @preserve
 AgoraRTM Web SDK 1.4.3-203 - commit: v1.4.3-17-g1e27aa38
 Copyright (C) 2018-2021 Agora Lab.
 This file is licensed under the AGORA, INC. SDK LICENSE AGREEMENT
 A copy of this license may be found at https://www.agora.io/en/sdk-license-agreement/
*/agoraRtmSdk.exports;(function(module,exports){(function(o,e){module.exports=e()})(commonjsGlobal,function(){function be(o,e){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(o);e&&(h=h.filter(function(f){return Object.getOwnPropertyDescriptor(o,f).enumerable})),d.push.apply(d,h)}return d}function ua(o){for(var e=1;e<arguments.length;e++){var d=arguments[e]!=null?arguments[e]:{};e%2?be(Object(d),!0).forEach(function(h){m(o,h,d[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):be(Object(d)).forEach(function(h){Object.defineProperty(o,h,Object.getOwnPropertyDescriptor(d,h))})}return o}function X(o){return(X=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(o)}function sl(o,e,d,h,f,g,A){try{var C=o[g](A),k=C.value}catch(j){return void d(j)}C.done?e(k):Promise.resolve(k).then(h,f)}function J(o){return function(){var e=this,d=arguments;return new Promise(function(h,f){function g(k){sl(C,h,f,g,A,"next",k)}function A(k){sl(C,h,f,g,A,"throw",k)}var C=o.apply(e,d);g(void 0)})}}function W(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}function tl(o,e){for(var d=0;d<e.length;d++){var h=e[d];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(o,h.key,h)}}function Ha(o,e,d){return e&&tl(o.prototype,e),d&&tl(o,d),o}function m(o,e,d){return e in o?Object.defineProperty(o,e,{value:d,enumerable:!0,configurable:!0,writable:!0}):o[e]=d,o}function la(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");o.prototype=Object.create(e&&e.prototype,{constructor:{value:o,writable:!0,configurable:!0}}),e&&df(o,e)}function wd(o){return(wd=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(o)}function df(o,e){return(df=Object.setPrototypeOf||function(d,h){return d.__proto__=h,d})(o,e)}function ul(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Sh(o,e,d){return(Sh=ul()?Reflect.construct:function(h,f,g){var A=[null];return A.push.apply(A,f),h=new(Function.bind.apply(h,A)),g&&df(h,g.prototype),h}).apply(null,arguments)}function ef(o){var e=typeof Map=="function"?new Map:void 0;return(ef=function(d){function h(){return Sh(d,arguments,wd(this).constructor)}if(d===null||Function.toString.call(d).indexOf("[native code]")===-1)return d;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(d))return e.get(d);e.set(d,h)}return h.prototype=Object.create(d.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),df(h,d)})(o)}function ff(o,e){if(o==null)return{};if(o==null)var d={};else{d={};var h,f=Object.keys(o);for(h=0;h<f.length;h++){var g=f[h];0<=e.indexOf(g)||(d[g]=o[g])}}if(Object.getOwnPropertySymbols)for(h=Object.getOwnPropertySymbols(o),g=0;g<h.length;g++)f=h[g],0<=e.indexOf(f)||Object.prototype.propertyIsEnumerable.call(o,f)&&(d[f]=o[f]);return d}function n(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function ma(o){var e=ul();return function(){var d=wd(o);if(e){var h=wd(this).constructor;d=Reflect.construct(d,arguments,h)}else d=d.apply(this,arguments);return d=!d||typeof d!="object"&&typeof d!="function"?n(this):d}}function Th(o,e,d){return(Th=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(h,f,g){for(;!Object.prototype.hasOwnProperty.call(h,f)&&(h=wd(h))!==null;);if(h)return(f=Object.getOwnPropertyDescriptor(h,f)).get?f.get.call(g):f.value})(o,e,d||o)}function ra(o,e){var d=Array.isArray(o)?o:void 0;if(!d)if((d=o&&(typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"]))==null)d=void 0;else{var h,f=[],g=!0,A=!1;try{for(d=d.call(o);!(g=(h=d.next()).done)&&(f.push(h.value),!e||f.length!==e);g=!0);}catch(k){A=!0;var C=k}finally{try{g||d.return==null||d.return()}finally{if(A)throw C}}d=f}if(!(o=d||vl(o,e)))throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return o}function G(o){var e=Array.isArray(o)?Uh(o):void 0;if(e||(e=typeof Symbol<"u"&&o[Symbol.iterator]!=null||o["@@iterator"]!=null?Array.from(o):void 0),!(o=e||vl(o)))throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return o}function vl(o,e){if(o){if(typeof o=="string")return Uh(o,e);var d=Object.prototype.toString.call(o).slice(8,-1);if(d==="Object"&&o.constructor&&(d=o.constructor.name),d==="Map"||d==="Set")return Array.from(o);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return Uh(o,e)}}function Uh(o,e){(e==null||e>o.length)&&(e=o.length);for(var d=0,h=Array(e);d<e;d++)h[d]=o[d];return h}function fa(o,e,d,h,f){var g={};return Object.keys(h).forEach(function(A){g[A]=h[A]}),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=d.slice().reverse().reduce(function(A,C){return C(o,e,A)||A},g),f&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(f):void 0,g.initializer=void 0),g.initializer===void 0&&(Object.defineProperty(o,e,g),g=null),g}function $a(o){var e={exports:{}};return o(e,e.exports),e.exports}function wl(o,e){var d,h=3>arguments.length?o:arguments[2];return va(o)===h?o[e]:(d=Fb.f(o,e))?Q(d,"value")?d.value:d.get===void 0?void 0:d.get.call(h):ha(d=Vb(o))?wl(d,e,h):void 0}function rs(o){var e=o.charCodeAt(0)<<24,d=0|ss(~e),h=0,f=0|o.length,g="";if(5>d&&f>=d){for(e=e<<d>>>24+d,h=1;h<d;h=h+1|0)e=e<<6|63&o.charCodeAt(h);65535>=e?g+=xd(e):1114111>=e?g+=xd(55296+((e=e-65536|0)>>10)|0,56320+(1023&e)|0):h=0}for(;h<f;h=h+1|0)g+="ï¿½";return g}function xl(){}function ts(o){var e=0|o.charCodeAt(0);if(55296<=e&&56319>=e){var d=0|o.charCodeAt(1);if(!(d==d&&56320<=d&&57343>=d))return xd(239,191,189);if(65535<(e=(e-55296<<10)+d-56320+65536|0))return xd(240|e>>>18,128|e>>>12&63,128|e>>>6&63,128|63&e)}return 127>=e?o:2047>=e?xd(192|e>>>6,128|63&e):xd(224|e>>>12,128|e>>>6&63,128|63&e)}function yl(){}function ea(){ea.init.call(this)}function ng(o){if(typeof o!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+X(o))}function zl(o,e,d,h){ng(d);var f=o._events;if(f===void 0)f=o._events=Object.create(null),o._eventsCount=0;else{f.newListener!==void 0&&(o.emit("newListener",e,d.listener?d.listener:d),f=o._events);var g=f[e]}return g===void 0?(f[e]=d,++o._eventsCount):(typeof g=="function"?g=f[e]=h?[d,g]:[g,d]:h?g.unshift(d):g.push(d),0<(d=o._maxListeners===void 0?ea.defaultMaxListeners:o._maxListeners)&&g.length>d&&!g.warned&&(g.warned=!0,(d=Error("Possible EventEmitter memory leak detected. "+g.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",d.emitter=o,d.type=e,d.count=g.length,console&&console.warn&&console.warn(d))),o}function us(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Al(o,e,d){return o={fired:!1,wrapFn:void 0,target:o,type:e,listener:d},(e=us.bind(o)).listener=d,o.wrapFn=e}function Bl(o,e,d){if((o=o._events)===void 0)return[];if((e=o[e])===void 0)return[];if(typeof e=="function")return d?[e.listener||e]:[e];if(d)for(d=Array(e.length),o=0;o<d.length;++o)d[o]=e[o].listener||e[o];else d=Cl(e,e.length);return d}function Dl(o){var e=this._events;if(e!==void 0){if(typeof(o=e[o])=="function")return 1;if(o!==void 0)return o.length}return 0}function Cl(o,e){for(var d=Array(e),h=0;h<e;++h)d[h]=o[h];return d}function vs(o,e,d){typeof o.on=="function"&&El(o,"error",e,d)}function El(o,e,d,h){if(typeof o.on=="function")h.once?o.once(e,d):o.on(e,d);else{if(typeof o.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+X(o));o.addEventListener(e,function f(g){h.once&&o.removeEventListener(e,f),d(g)})}}function ws(o){return o?G(o):xs(function(){return[]},function(e,d){return e.push(d),e})}function Fl(o,e){var d,h,f,g;return w.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:d=Gl(o)([Hl,Hl,function(C,k){return k}])[2],h=0;case 2:if(!(h<e.length)){A.next=17;break}if(f=e[h],!((g=d(Vh,f))instanceof og)){A.next=11;break}if((g=Wh(g.deref()))===Vh){A.next=10;break}return A.next=10,g;case 10:return A.abrupt("return");case 11:if(g===Vh){A.next=14;break}return A.next=14,g;case 14:h++,A.next=2;break;case 17:case"end":return A.stop()}},ys)}function pg(o,e){return e!=null&&typeof e[Symbol.iterator]=="function"?Fl(pg(o),e):function(d){var h=d[2];return zs(d,function(f,g){return h(f,o(g))})}}function Ac(o){return Object.prototype.toString.call(o).slice(8,-1)}function yd(o){return Ac(o)==="Object"&&o.constructor===Object&&Object.getPrototypeOf(o)===Object.prototype}function Il(o){var e;return(e=Ac(o)==="Boolean"||Ac(o)==="Null"||Ac(o)==="Undefined")||(e=Ac(o)==="Number"&&!isNaN(o)),e||Ac(o)==="String"||Ac(o)==="Symbol"}function zd(o){var e=-1,d=o==null?0:o.length;for(this.clear();++e<d;){var h=o[e];this.set(h[0],h[1])}}function ce(o){var e=-1,d=o==null?0:o.length;for(this.clear();++e<d;){var h=o[e];this.set(h[0],h[1])}}function de(o){var e=-1,d=o==null?0:o.length;for(this.clear();++e<d;){var h=o[e];this.set(h[0],h[1])}}function gf(o){var e=-1,d=o==null?0:o.length;for(this.__data__=new qg;++e<d;)this.add(o[e])}function ee(o){this.size=(this.__data__=new rg(o)).size}function fe(o,e,d,h,f,g){var A,C=1&e,k=2&e,j=4&e;if(d&&(A=f?d(o,h,f,g):d(o)),A!==void 0)return A;if(!lb(o))return o;if(h=Va(o)){if(A=As(o),!C)return Xh(o,A)}else{var _t=hf(o),_n=_t=="[object Function]"||_t=="[object GeneratorFunction]";if(jf(o))return Jl(o,C);if(_t=="[object Object]"||_t=="[object Arguments]"||_n&&!f){if(A=k||_n?{}:Kl(o),!C)return k?Bs(o,Cs(A,o)):Ds(o,Es(A,o))}else{if(!wa[_t])return f?o:{};A=Fs(o,_t,C)}}if(g||(g=new ge),f=g.get(o))return f;g.set(o,A),Gs(o)?o.forEach(function(Ei){A.add(fe(Ei,e,d,Ei,o,g))}):Hs(o)&&o.forEach(function(Ei,_s){A.set(_s,fe(Ei,e,d,_s,o,g))}),k=j?k?Ll:Yh:k?kf:Ad;var ue=h?void 0:k(o);return Is(ue||o,function(Ei,_s){ue&&(Ei=o[_s=Ei]),Ml(A,_s,fe(Ei,e,d,_s,o,g))}),A}function Zh(o,e){if(typeof o!="function"||e!=null&&typeof e!="function")throw new TypeError("Expected a function");var d=function h(){var f=arguments,g=e?e.apply(this,f):f[0],A=h.cache;return A.has(g)?A.get(g):(f=o.apply(this,f),h.cache=A.set(g,f)||A,f)};return d.cache=new(Zh.Cache||qg),d}function Nl(o){if(typeof o=="string")return o;if(Va(o))return he(o,Nl)+"";if(ie(o))return Ol?Ol.call(o):"";var e=o+"";return e=="0"&&1/o==-Js?"-0":e}function $h(o,e,d,h,f){var g=-1,A=o.length;for(d||(d=Ks),f||(f=[]);++g<A;){var C=o[g];0<e&&d(C)?1<e?$h(C,e-1,d,h,f):ai(f,C):h||(f[f.length]=C)}return f}function je(o,e,d,h,f){if(o===e)e=!0;else if(o==null||e==null||!gc(o)&&!gc(e))e=o!=o&&e!=e;else t:{var g=Va(o),A=Va(e),C=g?"[object Array]":hf(o),k=A?"[object Array]":hf(e),j=(C=C=="[object Arguments]"?"[object Object]":C)=="[object Object]";if(A=(k=k=="[object Arguments]"?"[object Object]":k)=="[object Object]",(k=C==k)&&jf(o)){if(!jf(e)){e=!1;break t}g=!0,j=!1}if(k&&!j)f||(f=new ge),e=g||bi(o)?Pl(o,e,d,h,je,f):Ls(o,e,C,d,h,je,f);else{if(!(1&d)&&(g=j&&Ql.call(o,"__wrapped__"),C=A&&Ql.call(e,"__wrapped__"),g||C)){o=g?o.value():o,e=C?e.value():e,f||(f=new ge),e=je(o,e,d,h,f);break t}if(k)e:if(f||(f=new ge),g=1&d,C=Yh(o),A=C.length,k=Yh(e).length,A==k||g){for(k=A;k--;){var _t=C[k];if(!(g?_t in e:Ms.call(e,_t))){e=!1;break e}}if(j=f.get(o),_t=f.get(e),j&&_t)e=j==e&&_t==o;else{j=!0,f.set(o,e),f.set(e,o);for(var _n=g;++k<A;){var ue=o[_t=C[k]],Ei=e[_t];if(h)var _s=g?h(Ei,ue,_t,e,o,f):h(ue,Ei,_t,o,e,f);if(_s===void 0?ue!==Ei&&!je(ue,Ei,d,h,f):!_s){j=!1;break}_n||(_n=_t=="constructor")}j&&!_n&&(d=o.constructor)!=(h=e.constructor)&&"constructor"in o&&"constructor"in e&&!(typeof d=="function"&&d instanceof d&&typeof h=="function"&&h instanceof h)&&(j=!1),f.delete(o),f.delete(e),e=j}}else e=!1;else e=!1}}return e}function xa(o,e,d){this.low=0|o,this.high=0|e,this.unsigned=!!d}function mb(o){return(o&&o.__isLong__)===!0}function Bd(o,e){var d;if(e){if((e=0<=(o>>>=0)&&256>o)&&(d=Rl[o]))return d;d=ya(o,0>(0|o)?-1:0,!0),e&&(Rl[o]=d)}else{if((e=-128<=(o|=0)&&128>o)&&(d=Sl[o]))return d;d=ya(o,0>o?-1:0,!1),e&&(Sl[o]=d)}return d}function Gb(o,e){if(isNaN(o))return e?Cd:Hb;if(e){if(0>o)return Cd;if(o>=Tl)return Ul}else{if(o<=-Vl)return nb;if(o+1>=Vl)return Wl}return 0>o?Gb(-o,e).neg():ya(o%ke|0,o/ke|0,e)}function ya(o,e,d){return new xa(o,e,d)}function ci(o,e,d){if(o.length===0)throw Error("empty string");if(o==="NaN"||o==="Infinity"||o==="+Infinity"||o==="-Infinity")return Hb;if(typeof e=="number"?(d=e,e=!1):e=!!e,2>(d=d||10)||36<d)throw RangeError("radix");var h;if(0<(h=o.indexOf("-")))throw Error("interior hyphen");if(h===0)return ci(o.substring(1),e,d).neg();h=Gb(sg(d,8));for(var f=Hb,g=0;g<o.length;g+=8){var A=Math.min(8,o.length-g),C=parseInt(o.substring(g,g+A),d);8>A?(A=Gb(sg(d,A)),f=f.mul(A).add(Gb(C))):f=(f=f.mul(h)).add(Gb(C))}return f.unsigned=e,f}function Wb(o,e){return typeof o=="number"?Gb(o,e):typeof o=="string"?ci(o,e):ya(o.low,o.high,typeof e=="boolean"?e:o.unsigned)}function O(o,e){function d(){this.constructor=o}di(o,e),o.prototype=e===null?Object.create(e):(d.prototype=e.prototype,new d)}function le(o){return typeof o=="function"}function me(o){setTimeout(function(){throw o},0)}function ei(o){return o!==null&&X(o)==="object"}function Xl(o){return o.reduce(function(e,d){return e.concat(d instanceof lf?d.errors:d)},[])}function fi(o){for(;o;){var e=o.destination,d=o.isStopped;if(o.closed||d)return!1;o=e&&e instanceof ia?e:null}return!0}function Yc(o){return o}function gi(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];return Yl(o)}function Yl(o){return o.length===0?Yc:o.length===1?o[0]:function(e){return o.reduce(function(d,h){return h(d)},e)}}function Zl(o){if(o||(o=Ib.Promise||Promise),!o)throw Error("no Promise impl found");return o}function $l(){return function(o){return o.lift(new Ns(o))}}function mf(o){return o?Os(o):vb}function Os(o){return new Y(function(e){return o.schedule(function(){return e.complete()})})}function Zc(o){return o&&typeof o.schedule=="function"}function hi(o,e){return new Y(function(d){var h=new Oa,f=0;return h.add(e.schedule(function(){f===o.length?d.complete():(d.next(o[f++]),d.closed||h.add(this.schedule()))})),h})}function nf(o,e){return e?hi(o,e):new Y(am(o))}function bb(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];return Zc(e=o[o.length-1])?(o.pop(),hi(o,e)):nf(o)}function Z(o,e){return new Y(e?function(d){return e.schedule(Ps,0,{error:o,subscriber:d})}:function(d){return d.error(o)})}function Ps(o){o.subscriber.error(o.error)}function Qs(o,e){return e===void 0&&(e=0),function(d){return d.lift(new Rs(o,e))}}function bm(o){return o in ii&&(delete ii[o],!0)}function hc(){}function ba(o,e){return function(d){if(typeof o!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return d.lift(new Ss(o,e))}}function cm(o,e,d){if(e){if(!Zc(e))return function(){for(var h=[],f=0;f<arguments.length;f++)h[f]=arguments[f];return cm(o,d).apply(void 0,h).pipe(ba(function(g){return Jb(g)?e.apply(void 0,g):e(g)}))};d=e}return function(){for(var h=[],f=0;f<arguments.length;f++)h[f]=arguments[f];var g,A=this,C={context:A,subject:g,callbackFunc:o,scheduler:d};return new Y(function(k){if(d)return d.schedule(Ts,0,{args:h,subscriber:k,params:C});if(!g){g=new of;try{o.apply(A,h.concat([function(){for(var j=[],_t=0;_t<arguments.length;_t++)j[_t]=arguments[_t];g.next(1>=j.length?j[0]:j),g.complete()}]))}catch(j){fi(g)?g.error(j):console.warn(j)}}return g.subscribe(k)})}}function Ts(o){var e=this,d=o.args,h=o.subscriber,f=o.params;o=f.callbackFunc;var g=f.context,A=f.scheduler,C=f.subject;if(!C){C=f.subject=new of,f=function(){for(var k=[],j=0;j<arguments.length;j++)k[j]=arguments[j];e.add(A.schedule(Us,0,{value:1>=k.length?k[0]:k,subject:C}))};try{o.apply(g,d.concat([f]))}catch(k){C.error(k)}}this.add(C.subscribe(h))}function Us(o){var e=o.subject;e.next(o.value),e.complete()}function dm(o,e,d){if(e){if(!Zc(e))return function(){for(var h=[],f=0;f<arguments.length;f++)h[f]=arguments[f];return dm(o,d).apply(void 0,h).pipe(ba(function(g){return Jb(g)?e.apply(void 0,g):e(g)}))};d=e}return function(){for(var h=[],f=0;f<arguments.length;f++)h[f]=arguments[f];var g={subject:void 0,args:h,callbackFunc:o,scheduler:d,context:this};return new Y(function(A){var C=g.context,k=g.subject;if(d)return d.schedule(Vs,0,{params:g,subscriber:A,context:C});if(!k){k=g.subject=new of;try{o.apply(C,h.concat([function(){for(var j=[],_t=0;_t<arguments.length;_t++)j[_t]=arguments[_t];(_t=j.shift())?k.error(_t):(k.next(1>=j.length?j[0]:j),k.complete())}]))}catch(j){fi(k)?k.error(j):console.warn(j)}}return k.subscribe(A)})}}function Vs(o){var e=this,d=o.params,h=o.subscriber;o=o.context;var f=d.callbackFunc,g=d.args,A=d.scheduler,C=d.subject;if(!C){C=d.subject=new of,d=function(){for(var k=[],j=0;j<arguments.length;j++)k[j]=arguments[j];(j=k.shift())?e.add(A.schedule(em,0,{err:j,subject:C})):e.add(A.schedule(Ws,0,{value:1>=k.length?k[0]:k,subject:C}))};try{f.apply(o,g.concat([d]))}catch(k){this.add(A.schedule(em,0,{err:k,subject:C}))}}this.add(C.subscribe(h))}function Ws(o){var e=o.subject;e.next(o.value),e.complete()}function em(o){o.subject.error(o.err)}function fm(o){return!!o&&typeof o.subscribe!="function"&&typeof o.then=="function"}function ji(o,e,d,h,f){if(f===void 0&&(f=new Xs(o,d,h)),!f.closed)return e instanceof Y?e.subscribe(f):pf(e)(f)}function Ys(o,e){return new Y(function(d){var h=new Oa;return h.add(e.schedule(function(){var f=o[ne]();h.add(f.subscribe({next:function(g){h.add(e.schedule(function(){return d.next(g)}))},error:function(g){h.add(e.schedule(function(){return d.error(g)}))},complete:function(){h.add(e.schedule(function(){return d.complete()}))}}))})),h})}function Zs(o,e){return new Y(function(d){var h=new Oa;return h.add(e.schedule(function(){return o.then(function(f){h.add(e.schedule(function(){d.next(f),h.add(e.schedule(function(){return d.complete()}))}))},function(f){h.add(e.schedule(function(){return d.error(f)}))})})),h})}function $s(o,e){if(!o)throw Error("Iterable cannot be null");return new Y(function(d){var h,f=new Oa;return f.add(function(){h&&typeof h.return=="function"&&h.return()}),f.add(e.schedule(function(){h=o[$c](),f.add(e.schedule(function(){if(!d.closed){try{var g=h.next(),A=g.value,C=g.done}catch(k){return void d.error(k)}C?d.complete():(d.next(A),this.schedule())}}))})),f})}function gm(o,e){if(o!=null){if(o&&typeof o[ne]=="function")return Ys(o,e);if(fm(o))return Zs(o,e);if(hm(o))return hi(o,e);if(o&&typeof o[$c]=="function"||typeof o=="string")return $s(o,e)}throw new TypeError((o!==null&&X(o)||o)+" is not observable")}function Kb(o,e){return e?gm(o,e):o instanceof Y?o:new Y(pf(o))}function ic(o,e){if(!e.closed){if(o instanceof Y)return o.subscribe(e);try{var d=pf(o)(e)}catch(h){e.error(h)}return d}}function cb(o,e,d){return d===void 0&&(d=Number.POSITIVE_INFINITY),typeof e=="function"?function(h){return h.pipe(cb(function(f,g){return Kb(o(f,g)).pipe(ba(function(A,C){return e(f,A,g,C)}))},d))}:(typeof e=="number"&&(d=e),function(h){return h.lift(new at(o,d))})}function tg(o){return o===void 0&&(o=Number.POSITIVE_INFINITY),cb(Yc,o)}function im(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];return tg(1)(bb.apply(void 0,o))}function ad(o){return new Y(function(e){try{var d=o()}catch(h){return void e.error(h)}return(d?Kb(d):mf()).subscribe(e)})}function jm(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];if(o.length===1){var d=o[0];if(Jb(d))return ug(d,null);if(ei(d)&&Object.getPrototypeOf(d)===Object.prototype)return ug((o=Object.keys(d)).map(function(f){return d[f]}),o)}if(typeof o[o.length-1]=="function"){var h=o.pop();return ug(o=o.length===1&&Jb(o[0])?o[0]:o,null).pipe(ba(function(f){return h.apply(void 0,f)}))}return ug(o,null)}function ug(o,e){return new Y(function(d){var h=o.length;if(h===0)d.complete();else for(var f=Array(h),g=0,A=0,C=function(j){var _t=Kb(o[j]),_n=!1;d.add(_t.subscribe({next:function(ue){_n||(_n=!0,A++),f[j]=ue},error:function(ue){return d.error(ue)},complete:function(){++g!==h&&_n||(A===h&&d.next(e?e.reduce(function(ue,Ei,_s){return ue[Ei]=f[_s],ue},{}):f),d.complete())}}))},k=0;k<h;k++)C(k)})}function gb(o,e,d,h){return le(d)&&(h=d,d=void 0),h?gb(o,e,d).pipe(ba(function(f){return Jb(f)?h.apply(void 0,f):h(f)})):new Y(function(f){km(o,e,function(g){1<arguments.length?f.next(Array.prototype.slice.call(arguments)):f.next(g)},f,d)})}function km(o,e,d,h,f){if(o&&typeof o.addEventListener=="function"&&typeof o.removeEventListener=="function"){o.addEventListener(e,d,f);var g=function(){return o.removeEventListener(e,d,f)}}else if(o&&typeof o.on=="function"&&typeof o.off=="function")o.on(e,d),g=function(){return o.off(e,d)};else if(o&&typeof o.addListener=="function"&&typeof o.removeListener=="function")o.addListener(e,d),g=function(){return o.removeListener(e,d)};else{if(!o||!o.length)throw new TypeError("Invalid event target");for(var A=0,C=o.length;A<C;A++)km(o[A],e,d,h,f)}h.add(g)}function lm(o,e,d){return d?lm(o,e).pipe(ba(function(h){return Jb(h)?d.apply(void 0,h):d(h)})):new Y(function(h){var f=function(){for(var A=[],C=0;C<arguments.length;C++)A[C]=arguments[C];return h.next(A.length===1?A[0]:A)};try{var g=o(f)}catch(A){return void h.error(A)}if(le(e))return function(){return e(f,g)}})}function bt(o){var e=o.subscriber,d=o.condition;if(!e.closed){if(o.needIterate)try{o.state=o.iterate(o.state)}catch(g){return void e.error(g)}else o.needIterate=!0;if(d){var h=void 0;try{h=d(o.state)}catch(g){return void e.error(g)}if(!h)return void e.complete();if(e.closed)return}try{var f=o.resultSelector(o.state)}catch(g){return void e.error(g)}if(!e.closed&&(e.next(f),!e.closed))return this.schedule(o)}}function ki(o){return!Jb(o)&&0<=o-parseFloat(o)+1}function mm(o,e){return o===void 0&&(o=0),e===void 0&&(e=bd),(!ki(o)||0>o)&&(o=0),e&&typeof e.schedule=="function"||(e=bd),new Y(function(d){return d.add(e.schedule(ct,o,{subscriber:d,counter:0,period:o})),d})}function ct(o){var e=o.subscriber,d=o.counter;o=o.period,e.next(d),this.schedule({subscriber:e,counter:d+1,period:o},o)}function Xb(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];e=Number.POSITIVE_INFINITY;var d=null,h=o[o.length-1];return Zc(h)?(d=o.pop(),1<o.length&&typeof o[o.length-1]=="number"&&(e=o.pop())):typeof h=="number"&&(e=o.pop()),d===null&&o.length===1&&o[0]instanceof Y?o[0]:tg(e)(nf(o,d))}function li(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];if(o.length===0)return vb;var d=o[0],h=o.slice(1);return o.length===1&&Jb(d)?li.apply(void 0,d):new Y(function(f){var g=function(){return f.add(li.apply(void 0,h).subscribe(f))};return Kb(d).subscribe({next:function(A){f.next(A)},error:g,complete:g})})}function dt(o){var e=o.keys,d=o.index,h=o.subscriber,f=o.subscription;if(o=o.obj,!h.closed)if(d<e.length){var g=e[d];h.next([g,o[g]]),f.add(this.schedule({keys:e,index:d+1,subscriber:h,subscription:f,obj:o}))}else h.complete()}function et(o,e){function d(){return!d.pred.apply(d.thisArg,arguments)}return d.pred=o,d.thisArg=e,d}function wb(o,e){return function(d){return d.lift(new ft(o,e))}}function Ca(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];if(o.length===1){if(!Jb(o[0]))return o[0];o=o[0]}return nf(o,void 0).lift(new gt)}function ht(o){var e=o.start,d=o.index,h=o.subscriber;d>=o.count?h.complete():(h.next(e),h.closed||(o.index=d+1,o.start=e+1,this.schedule(o)))}function Bc(o,e,d){o===void 0&&(o=0);var h=-1;return ki(e)?h=1>Number(e)?1:Number(e):Zc(e)&&(d=e),Zc(d)||(d=bd),new Y(function(f){var g=ki(o)?o:+o-d.now();return d.schedule(it,g,{index:0,period:h,subscriber:f})})}function it(o){var e=o.index,d=o.period,h=o.subscriber;if(h.next(e),!h.closed){if(d===-1)return h.complete();o.index=e+1,this.schedule(o,d)}}function mi(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];return typeof(e=o[o.length-1])=="function"&&o.pop(),nf(o,void 0).lift(new jt(e))}function Ga(o){return function(e){var d=new kt(o);return e=e.lift(d),d.caught=e}}function ni(o,e){return cb(o,e,1)}function nm(o){return o===void 0&&(o=null),function(e){return e.lift(new lt(o))}}function cd(o,e){e===void 0&&(e=bd);var d=o instanceof Date&&!isNaN(+o)?+o-e.now():Math.abs(o);return function(h){return h.lift(new mt(d,e))}}function om(o,e){return function(d){return d.lift(new nt(o,e))}}function Dd(o){return o===void 0&&(o=ot),function(e){return e.lift(new pt(o))}}function ot(){return new vg}function Ka(o){return function(e){return o===0?mf():e.lift(new qt(o))}}function pm(o,e){return e?function(d){return d.pipe(pm(function(h,f){return Kb(o(h,f)).pipe(ba(function(g,A){return e(h,g,f,A)}))}))}:function(d){return d.lift(new rt(o))}}function wg(o){return function(e){return e.lift(new st(o))}}function aa(o,e){var d=2<=arguments.length;return function(h){return h.pipe(o?wb(function(f,g){return o(f,g,h)}):Yc,Ka(1),d?nm(e):Dd(function(){return new vg}))}}function tt(){return function(o){return o.lift(new ut)}}function qm(o){return function(e){return o===0?mf():e.lift(new vt(o))}}function qf(o){return function(e){return e.lift(new wt(o))}}function xg(o,e){var d=!1;return 2<=arguments.length&&(d=!0),function(h){return h.lift(new xt(o,e,d))}}function rm(o,e){return 2<=arguments.length?function(d){return gi(xg(o,e),qm(1),nm(e))(d)}:function(d){return gi(xg(function(h,f,g){return o(h,f,g+1)}),qm(1))(d)}}function yt(o,e){return function(d){var h=typeof o=="function"?o:function(){return o};if(typeof e=="function")return d.lift(new zt(h,e));var f=Object.create(d,At);return f.source=d,f.subjectFactory=h,f}}function oe(o){return function(e){return e.lift(new Bt(o,e))}}function Ct(){return new Pa}function pe(){return function(o){return $l()(yt(Ct)(o))}}function sm(o,e,d){var h=o&&X(o)==="object"?o:{bufferSize:o,windowTime:e,refCount:!1,scheduler:d};return function(f){return f.lift(Dt(h))}}function Dt(o){var e,d,h=o.bufferSize,f=h===void 0?Number.POSITIVE_INFINITY:h,g=(h=o.windowTime)===void 0?Number.POSITIVE_INFINITY:h,A=o.refCount,C=o.scheduler,k=0,j=!1,_t=!1;return function(_n){if(k++,!e||j){j=!1;var ue=(e=new qe(f,g,C)).subscribe(this);d=_n.subscribe({next:function(Ei){e.next(Ei)},error:function(Ei){j=!0,e.error(Ei)},complete:function(){_t=!0,d=void 0,e.complete()}}),_t&&(d=void 0)}else ue=e.subscribe(this);this.add(function(){k--,ue.unsubscribe(),ue=void 0,d&&!_t&&A&&k===0&&(d.unsubscribe(),e=d=void 0)})}}function Cc(o,e){return typeof e=="function"?function(d){return d.pipe(Cc(function(h,f){return Kb(o(h,f)).pipe(ba(function(g,A){return e(h,g,f,A)}))}))}:function(d){return d.lift(new Et(o))}}function ob(o){return function(e){return e.lift(new Ft(o))}}function Gt(o,e){return e===void 0&&(e=!1),function(d){return d.lift(new Ht(o,e))}}function ca(o,e,d){return function(h){return h.lift(new It(o,e,d))}}function Jt(o,e,d){return e===void 0&&(e=bd),d===void 0&&(d=Kt),function(h){return h.lift(new Lt(o,e,d.leading,d.trailing))}}function Mt(o){o.subscriber.clearThrottle()}function Nt(o,e,d){return d===void 0&&(d=bd),function(h){var f=o instanceof Date&&!isNaN(+o),g=f?+o-d.now():Math.abs(o);return h.lift(new Ot(g,f,e,d))}}function hb(o,e){return e===void 0&&(e=bd),Nt(o,Z(new pb),e)}function Pt(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];return function(d){var h;return typeof o[o.length-1]=="function"&&(h=o.pop()),d.lift(new Qt(o,h))}}function tm(o,e,d,h,f){o!==e&&um(e,function(g,A){if(f||(f=new ge),lb(g)){g=f;var C=oi(o,A),k=oi(e,A),j=g.get(k);if(j)pi(o,A,j);else{var _t=(j=h?h(C,k,A+"",o,e,g):void 0)===void 0;if(_t){var _n=Va(k),ue=!_n&&jf(k),Ei=!_n&&!ue&&bi(k);j=k,_n||ue||Ei?Va(C)?j=C:gc(C)&&Ed(C)?j=Xh(C):ue?(_t=!1,j=Jl(k,!0)):Ei?(_t=!1,j=vm(k,!0)):j=[]:wm(k)||rf(k)?(j=C,rf(C)?j=re(C,kf(C)):lb(C)&&!qi(C)||(j=Kl(k))):_t=!1}_t&&(g.set(k,j),tm(j,k,d,h,g),g.delete(k)),pi(o,A,j)}}else(C=h?h(oi(o,A),g,A+"",o,e,f):void 0)===void 0&&(C=g),pi(o,A,C)},kf)}function Rt(o){var e=1,d=ri;(1>=arguments.length?0:arguments.length-1)==1?typeof(1>=arguments.length?void 0:arguments[1])=="number"?e=1>=arguments.length?void 0:arguments[1]:d=1>=arguments.length?void 0:arguments[1]:(1>=arguments.length?0:arguments.length-1)==2&&(e=1>=arguments.length?void 0:arguments[1],d=2>=arguments.length?void 0:arguments[2]);var h=e||1;return function(f){return f.pipe(xg(function(g,A){var C=d.now(),k=C-o;if((g=g.filter(function(_n){return _n.until>k})).length>=h){var j=g[g.length-1],_t=g[0].until+o*Math.floor(g.length/h);g.push({delay:j.until<C?_t-C:_t-j.until,until:_t,value:A})}else g.push({delay:0,until:C,value:A});return g},[]),ba(function(g){return g[g.length-1]}),ni(function(g){var A=bb(g.value);return g.delay?A.pipe(cd(g.delay,d)):A}))}}function St(o,e){var d=(e=e===void 0?{protocols:xm,makeWebSocket:ym}:e).protocols,h=d===void 0?xm:d,f=(e=e.makeWebSocket)===void 0?ym:e;return new Y(function(g){var A,C=new Pa,k=f(o,h),j=!1,_t=!1,_n=function(ue){if(A)throw j=!0,ue=Error("Web socket message factory function called more than once"),g.error(ue),ue;return A=ue.subscribe(function(Ei){k.send(Ei)}),C};return k.onopen=function(){_t?(j=!0,k.close()):g.next(_n)},k.onmessage=function(ue){C.next(ue.data)},k.onerror=function(ue){j=!0,g.error(Error(ue.message))},k.onclose=function(ue){j||(j=!0,_t?(g.complete(),C.complete()):g.error(Error(ue.code===1e3?"Normal closure":ue.reason)))},function(){_t=!0,A&&A.unsubscribe(),j||(j=!0,k.close())}})}function yg(){this._listeners={}}function zm(o){return typeof Float32Array<"u"?function(){function e(k,j,_t){g[0]=k,j[_t]=A[0],j[_t+1]=A[1],j[_t+2]=A[2],j[_t+3]=A[3]}function d(k,j,_t){g[0]=k,j[_t]=A[3],j[_t+1]=A[2],j[_t+2]=A[1],j[_t+3]=A[0]}function h(k,j){return A[0]=k[j],A[1]=k[j+1],A[2]=k[j+2],A[3]=k[j+3],g[0]}function f(k,j){return A[3]=k[j],A[2]=k[j+1],A[1]=k[j+2],A[0]=k[j+3],g[0]}var g=new Float32Array([-0]),A=new Uint8Array(g.buffer),C=A[3]===128;o.writeFloatLE=C?e:d,o.writeFloatBE=C?d:e,o.readFloatLE=C?h:f,o.readFloatBE=C?f:h}():function(){function e(h,f,g,A){var C=0>f?1:0;if(C&&(f=-f),f===0)h(0<1/f?0:2147483648,g,A);else if(isNaN(f))h(2143289344,g,A);else if(34028234663852886e22<f)h((C<<31|2139095040)>>>0,g,A);else if(11754943508222875e-54>f)h((C<<31|Math.round(f/1401298464324817e-60))>>>0,g,A);else{var k=Math.floor(Math.log(f)/Math.LN2);h((C<<31|k+127<<23|8388607&Math.round(f*Math.pow(2,-k)*8388608))>>>0,g,A)}}function d(h,f,g){return g=h(f,g),h=2*(g>>31)+1,f=g>>>23&255,g&=8388607,f===255?g?NaN:1/0*h:f===0?1401298464324817e-60*h*g:h*Math.pow(2,f-150)*(g+8388608)}o.writeFloatLE=e.bind(null,Am),o.writeFloatBE=e.bind(null,Bm),o.readFloatLE=d.bind(null,Cm),o.readFloatBE=d.bind(null,Dm)}(),typeof Float64Array<"u"?function(){function e(k,j,_t){g[0]=k,j[_t]=A[0],j[_t+1]=A[1],j[_t+2]=A[2],j[_t+3]=A[3],j[_t+4]=A[4],j[_t+5]=A[5],j[_t+6]=A[6],j[_t+7]=A[7]}function d(k,j,_t){g[0]=k,j[_t]=A[7],j[_t+1]=A[6],j[_t+2]=A[5],j[_t+3]=A[4],j[_t+4]=A[3],j[_t+5]=A[2],j[_t+6]=A[1],j[_t+7]=A[0]}function h(k,j){return A[0]=k[j],A[1]=k[j+1],A[2]=k[j+2],A[3]=k[j+3],A[4]=k[j+4],A[5]=k[j+5],A[6]=k[j+6],A[7]=k[j+7],g[0]}function f(k,j){return A[7]=k[j],A[6]=k[j+1],A[5]=k[j+2],A[4]=k[j+3],A[3]=k[j+4],A[2]=k[j+5],A[1]=k[j+6],A[0]=k[j+7],g[0]}var g=new Float64Array([-0]),A=new Uint8Array(g.buffer),C=A[7]===128;o.writeDoubleLE=C?e:d,o.writeDoubleBE=C?d:e,o.readDoubleLE=C?h:f,o.readDoubleBE=C?f:h}():function(){function e(h,f,g,A,C,k){var j=0>A?1:0;if(j&&(A=-A),A===0)h(0,C,k+f),h(0<1/A?0:2147483648,C,k+g);else if(isNaN(A))h(0,C,k+f),h(2146959360,C,k+g);else if(17976931348623157e292<A)h(0,C,k+f),h((j<<31|2146435072)>>>0,C,k+g);else if(22250738585072014e-324>A)h((A/=5e-324)>>>0,C,k+f),h((j<<31|A/4294967296)>>>0,C,k+g);else{var _t=Math.floor(Math.log(A)/Math.LN2);_t===1024&&(_t=1023),h(4503599627370496*(A*=Math.pow(2,-_t))>>>0,C,k+f),h((j<<31|_t+1023<<20|1048576*A&1048575)>>>0,C,k+g)}}function d(h,f,g,A,C){return f=h(A,C+f),A=h(A,C+g),h=2*(A>>31)+1,f=4294967296*(1048575&A)+f,(g=A>>>20&2047)===2047?f?NaN:1/0*h:g===0?5e-324*h*f:h*Math.pow(2,g-1075)*(f+4503599627370496)}o.writeDoubleLE=e.bind(null,Am,0,4),o.writeDoubleBE=e.bind(null,Bm,4,0),o.readDoubleLE=d.bind(null,Cm,0,4),o.readDoubleBE=d.bind(null,Dm,4,0)}(),o}function Am(o,e,d){e[d]=255&o,e[d+1]=o>>>8&255,e[d+2]=o>>>16&255,e[d+3]=o>>>24}function Bm(o,e,d){e[d]=o>>>24,e[d+1]=o>>>16&255,e[d+2]=o>>>8&255,e[d+3]=255&o}function Cm(o,e){return(o[e]|o[e+1]<<8|o[e+2]<<16|o[e+3]<<24)>>>0}function Dm(o,e){return(o[e]<<24|o[e+1]<<16|o[e+2]<<8|o[e+3])>>>0}function Wa(o,e){this.lo=o>>>0,this.hi=e>>>0}function sf(o,e,d){this.fn=o,this.len=e,this.next=void 0,this.val=d}function si(){}function Tt(o){this.head=o.head,this.tail=o.tail,this.len=o.len,this.next=o.states}function ja(){this.len=0,this.tail=this.head=new sf(si,0,0),this.states=null}function ti(o,e,d){e[d]=255&o}function ui(o,e){this.len=o,this.next=void 0,this.val=e}function vi(o,e,d){for(;o.hi;)e[d++]=127&o.lo|128,o.lo=(o.lo>>>7|o.hi<<25)>>>0,o.hi>>>=7;for(;127<o.lo;)e[d++]=127&o.lo|128,o.lo>>>=7;e[d++]=o.lo}function wi(o,e,d){e[d]=255&o,e[d+1]=o>>>8&255,e[d+2]=o>>>16&255,e[d+3]=o>>>24}function jc(){xi.call(this)}function Ut(o,e,d){40>o.length?V.utf8.write(o,e,d):e.utf8Write?e.utf8Write(o,d):e.write(o,d)}function Yb(o,e){return RangeError("index out of range: "+o.pos+" + "+(e||1)+" > "+o.len)}function La(o){this.buf=o,this.pos=0,this.len=o.length}function yi(){var o=new Em(0,0),e=0;if(!(4<this.len-this.pos)){for(;3>e;++e){if(this.pos>=this.len)throw Yb(this);if(o.lo=(o.lo|(127&this.buf[this.pos])<<7*e)>>>0,128>this.buf[this.pos++])return o}return o.lo=(o.lo|(127&this.buf[this.pos++])<<7*e)>>>0,o}for(;4>e;++e)if(o.lo=(o.lo|(127&this.buf[this.pos])<<7*e)>>>0,128>this.buf[this.pos++])return o;if(o.lo=(o.lo|(127&this.buf[this.pos])<<28)>>>0,o.hi=(o.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return o;if(e=0,4<this.len-this.pos){for(;5>e;++e)if(o.hi=(o.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,128>this.buf[this.pos++])return o}else for(;5>e;++e){if(this.pos>=this.len)throw Yb(this);if(o.hi=(o.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,128>this.buf[this.pos++])return o}throw Error("invalid varint encoding")}function zg(o,e){return(o[e-4]|o[e-3]<<8|o[e-2]<<16|o[e-1]<<24)>>>0}function Fm(){if(this.pos+8>this.len)throw Yb(this,8);return new Em(zg(this.buf,this.pos+=4),zg(this.buf,this.pos+=4))}function Fd(o){zi.call(this,o)}function tf(o,e,d){if(typeof o!="function")throw TypeError("rpcImpl must be a function");V.EventEmitter.call(this),this.rpcImpl=o,this.requestDelimited=!!e,this.responseDelimited=!!d}function za(o){return typeof o=="string"&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(o)&&o!=="null"}function Gm(o){try{var e=o.split(".").map(function(h){return Number(h)})}catch{return!1}if(e.length!==4||e[0]===0)return!1;for(o=0;o<e.length;o++){var d=e[o];if(!Number.isInteger(d)||0>d||255<d)return!1}return!0}function Hm(o,e){if(!Array.isArray(e)||e.length===0||32<e.length||e.some(function(d){return d.length===0||32<d.length}))throw new I("arguments is not valid",Ja);if(!za(o))throw new I("ID is invalid",Ja)}function uf(o){var e=o.attributes,d=o.attrSizeMap,h=o.maxAttrsCount,f=o.maxAttrValueSize;if(o=o.maxTotalSize,!yd(e))throw new I("attributes must be an object",Ja);if(Object.keys(e).length>h)throw new ib("Exceed the limit of ".concat(h," attributes"),se);if(Object.keys(e).length===0)throw new I("The attributes is an empty object",Ja);var g=0,A=0;for(e=Object.entries(e);A<e.length;A++){var C=ra(e[A],2),k=C[1];C=new Blob([C[0]]).size;var j=new Blob([k]).size;if(C===0||32<C)throw new I("Invalid attribute key",Ja);if(j>f)throw new ib("Invalid attribute value, over the limit of ".concat(f," bytes"),se);if(typeof k!="string"||k.length===0)throw new I("Invalid attribute value",Ja);g+=C,g+=j}if(g>o)throw new ib("The attributes size overflow",se);if(d!==void 0){if(Object.keys(d).length>h)throw new ib("Exceed the limit of ".concat(h," attributes"),se);for(g=h=0,d=Object.entries(d);g<d.length;g++){if(A=(e=ra(d[g],2))[1],(e=new Blob([e[0]]).size)===0)throw new I("Invalid attribute key",Ja);if(A>f)throw new ib("Invalid attribute value, over the limit of ".concat(f," bytes"),se);h+=e,h+=A}if(h>o)throw new ib("The attributes size overflow",se)}}function Ag(o,e){return Math.floor(Math.random()*(Math.floor(e)-Math.ceil(o)+1))+o}function Bg(){var o=Ag(0,4294967295),e=Ag(1,4294967295);return new U(o,e,!0)}function Xa(o){return o.toString().padEnd(32,"0")}function Im(o,e){return new TypeError("Unexpected ".concat(o,": ").concat(e))}function Jm(o,e){return o=o.split(".").map(function(d){return Number(d)}),e=e.split(".").map(function(d){return Number(d)}),Math.sqrt(1e3*Math.pow(o[0]-e[0],2)+100*Math.pow(o[1]-e[1],2)+10*Math.pow(o[2]-e[2],2)+1*Math.pow(o[3]-e[3],2))}function Km(o){return o.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?o.toNumber():o.toString()}function Ai(o,e){e="".concat(o).concat(e||"");var d=Lm.get(e)||1;return Lm.set(e,d+1),"".concat(o).concat(d)}function Mm(o,e){var d=typeof e=="number"?e:e!==void 0&&typeof e!="string"?e.code:void 0;return e=typeof e!="number"&&typeof e!="string"&&e!==void 0&&e.serverCode!==void 0?e.serverCode:void 0,d="".concat(d!==void 0?" Error Code ".concat(d):"").concat(e!==void 0?", server Code ".concat(e):""),o=typeof o=="string"&&o?Cg(o):Array.isArray(o)&&typeof o[0]=="string"&&o[0]?Cg(Nm.apply(void 0,[o[0]].concat(G(o.slice(1))))):"","".concat(d===""?"":"".concat(d," - ")).concat(o)}function Om(o){return Bi.apply(this,arguments)}function Bi(){return(Bi=J(w.mark(function o(e){return w.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",new Promise(function(h){setTimeout(function(){h()},e)}));case 1:case"end":return d.stop()}},o)}))).apply(this,arguments)}function Pm(o){return o instanceof Blob||Object.prototype.toString.call(o)==="[object Blob]"}function Dg(o){var e=255&o,d=o>>8&255,h=o>>16&255;return"".concat(o>>24&255,".").concat(h,".").concat(d,".").concat(e)}function te(o,e,d){return Ci.apply(this,arguments)}function Ci(){return(Ci=J(w.mark(function o(e,d,h){var f,g,A,C,k,j,_t,_n,ue,Ei,_s,_c,_u,_d,_l,nE,sE,vE,mE,yE,BE,t_,vf,fE,hE,bE;return w.wrap(function(_h){for(;;)switch(_h.prev=_h.next){case 0:if(f=d.body,g=d.headers,A=g===void 0?{}:g,C=d.timeout,k=C===void 0?1e4:C,j=d.signal,_t=d.withCredentials,_n=_t!==void 0&&_t,ue=(h||{}).useBinaryResponse,Ei=ue!==void 0&&ue,(_s=new XMLHttpRequest).open("POST",e,!0),_s.responseType=Ei?"arraybuffer":"text",_s.withCredentials=_n,_s.timeout=k,_c=f instanceof FormData,_u=f instanceof Uint8Array,!(1<(_d=Object.keys(A).filter(function(tE){return tE.toLowerCase()==="content-type"})).length)){_h.next=14;break}throw new RangeError("multiple content-type");case 14:_d.length===0&&(_u?A["Content-Type"]="application/octet-stream":_c||(A["Content-Type"]="application/json"));case 15:if("setRequestHeader"in _s){_h.next=46;break}return _s.abort(),_h.next=19,fetch(e,{body:_c||_u?f:JSON.stringify(f),cache:"no-cache",credentials:_n?"include":"same-origin",headers:A,method:"POST",mode:"cors",referrer:"no-referrer",signal:j});case 19:if(_l=_h.sent,!(200<=(nE=_l.status)&&300>nE||nE===304)){_h.next=31;break}if(!Ei){_h.next=27;break}return _h.next=25,_l.arrayBuffer();case 25:return sE=_h.sent,_h.abrupt("return",{status:nE,responseData:sE});case 27:return _h.next=29,_l.text();case 29:return vE=_h.sent,_h.abrupt("return",{status:nE,responseText:vE});case 31:return mE=new da(["Post XHR failure, status %d",nE]),_h.prev=32,_h.next=35,_l.text();case 35:throw yE=_h.sent,mE.statusCode=nE,mE.message=yE||"Request failed, status ".concat(nE),mE;case 41:throw _h.prev=41,_h.t0=_h.catch(32),mE.statusCode=nE,mE.message="Request failed, status ".concat(nE),mE;case 46:if(Object.keys(A).length!==0)for(BE=0,t_=Object.entries(A);BE<t_.length;BE++)vf=ra(t_[BE],2),fE=vf[0],hE=vf[1],_s.setRequestHeader(fE,hE);return j!==void 0&&(bE=function tE(){_s.abort(),j.removeEventListener("abort",tE)},j.addEventListener("abort",bE)),_c||_u?_s.send(f):_s.send(JSON.stringify(f)),_h.abrupt("return",new Promise(function(tE,aE){_s.onload=function(){var TE=_s.status;if(200<=TE&&300>TE||TE===304)tE(Ei?{status:TE,responseData:_s.response}:{status:TE,responseText:_s.responseText});else{var OE=new da(["Post XHR failure, status %d",TE]);OE.statusCode=TE,OE.message=_s.response||"Request failed, status ".concat(_s.status),aE(OE)}},_s.ontimeout=function(TE){aE(new db(["XHR request timed out after %d ms",k],{originalError:TE}))},_s.onerror=function(){var TE=new da(["Post XHR failure, status %d",_s.status]);TE.statusCode=_s.status,TE.message=_s.response||"Request failed, status ".concat(_s.status),aE(TE)},_s.onabort=function(){try{aE(new DOMException("The request aborted.","AbortError"))}catch{var TE=Error("The request aborted.");TE.name="AbortError",aE(TE)}}}));case 50:case"end":return _h.stop()}},o,null,[[32,41]])}))).apply(this,arguments)}function Rm(o){return Hi.apply(this,arguments)}function Hi(){return(Hi=J(w.mark(function o(e){var d;return w.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return(d=new Image).src=e,h.abrupt("return",new Promise(function(f,g){d.onload=function(){f({width:d.width,height:d.height})},d.onerror=g}));case 3:case"end":return h.stop()}},o)}))).apply(this,arguments)}function Xt(o,e){return Ii.apply(this,arguments)}function Ii(){return(Ii=J(w.mark(function o(e,d){var h,f,g,A,C,k,j,_t,_n,ue;return w.wrap(function(Ei){for(;;)switch(Ei.prev=Ei.next){case 0:if(h=e.thumbnailHeight,f=h===void 0?0:h,g=e.thumbnailWidth,A=g===void 0?0:g,C=e.width,k=C===void 0?0:C,j=e.height,_t=j===void 0?0:j,_n=e.thumbnail,ue=[],typeof f=="number"&&typeof A=="number"&&typeof k=="number"&&typeof _t=="number"){Ei.next=5;break}throw new I("Invalid message params",wf);case 5:return 0>=k&&0>=_t&&ue.push(Rm(Sm(d)).then(function(_s){k=_s.width,_t=_s.height})),0>=A&&0>=f&&_n!==void 0&&ue.push(Ji(_n).then(function(){var _s=J(w.mark(function _c(_u){var _d;return w.wrap(function(_l){for(;;)switch(_l.prev=_l.next){case 0:return _l.next=2,Rm(Sm(_u));case 2:_d=_l.sent,A=_d.width,f=_d.height;case 5:case"end":return _l.stop()}},_c)}));return function(_c){return _s.apply(this,arguments)}}())),Ei.next=9,Promise.all(ue).catch(function(){});case 9:return Ei.abrupt("return",{width:k,height:_t,thumbnailWidth:A,thumbnailHeight:f});case 10:case"end":return Ei.stop()}},o)}))).apply(this,arguments)}function Tm(o,e){if(!yd(o))throw new I("message object is not a plain object",e);if(o.messageType===void 0)if(o.rawMessage instanceof Uint8Array){if(o.messageType="RAW",o.text!==void 0)throw new I("Raw messages cannot have text property. Use description instead",e)}else{if(typeof o.text!="string")throw new I("messageType is undefined",e);if(o.messageType="TEXT",o.rawMessage!==void 0)throw new I("Text messages cannot have rawMessage property",e)}}function Gg(o){return Ki.apply(this,arguments)}function Ki(){return(Ki=J(w.mark(function o(e){var d,h,f,g,A,C,k,j,_t,_n,ue,Ei,_s,_c,_u,_d,_l,nE,sE,vE,mE;return w.wrap(function(yE){for(;;)switch(yE.prev=yE.next){case 0:if(d=e.message,h=e.peerId,f=e.toPeer,g=e.session,A=e.errorCodes,C=e.diff,k=e.logger,j=e.options,g!==void 0){yE.next=3;break}throw new K("The client is not logged in. Cannot do the operation",A.NOT_LOGGED_IN);case 3:if(_t=!1,d.messageType!=="TEXT"||!d.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!f){yE.next=11;break}if(_n=d.text.split("_"),ue=ra(_n,3),Ei=ue[0],_s=ue[1],ue[2]!==void 0&&za(_s)&&Ei==="AgoraRTMLegacyEndcallCompatibleMessagePrefix"){yE.next=10;break}throw new I("Message is not valid",ve);case 10:_t=!0;case 11:if(_c=Date.now(),_u=g.messageSentTimes.length-1,!((_d=g.messageSentTimes[_u])&&_d+3e3<_c)){yE.next=18;break}g.messageSentTimes=[_c],yE.next=29;break;case 18:_l=_u;case 19:if(!(0<=_l)){yE.next=28;break}if(!(g.messageSentTimes[_l]+3e3<_c)){yE.next=23;break}return g.messageSentTimes=g.messageSentTimes.slice(_l+1,_u+1),yE.abrupt("break",28);case 23:if(!(180<=_u-_l+1)){yE.next=25;break}throw new ib("Message sent failed, exceeded the 180 message in 3 seconds",A.TOO_OFTEN);case 25:_l--,yE.next=19;break;case 28:g.messageSentTimes.push(_c);case 29:yE.t0=d.messageType,yE.next=yE.t0==="TEXT"?32:yE.t0==="RAW"?37:yE.t0==="FILE"||yE.t0==="IMAGE"?39:40;break;case 32:if(!_t){yE.next=36;break}return nE=d.text.split("_"),sE=ra(nE,3),vE=sE[1],mE=sE[2],k.info("[rtm-API] EndCall message send api is called"),yE.abrupt("return",g.sendInvitationMessage({peerId:h,type:"CallCancel",extra:mE,channelId:vE,callId:"0"}));case 36:return yE.abrupt("return",g.sendTextMessage(d.text,h,f,j,1e4-C));case 37:return d.description===void 0&&(d.description=""),yE.abrupt("return",g.sendRawMessage(d.rawMessage,d.description,h,f,j,1e4-C));case 39:return yE.abrupt("return",g.sendMediaMessage(d.messageType,d,h,f,j,1e4-C));case 40:throw new I("Invalid message type",ve);case 41:case"end":return yE.stop()}},o)}))).apply(this,arguments)}function Yt(o){var e=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],d=o.replace(/(https?:\/\/)?(www.)?/i,"");return e||(d=d.split(".").slice(o.length-2).join(".")),d.indexOf("/")!==-1?d.split("/")[0]:d}function oa(o){if(typeof o!="string")return"[Sensitive Info]";var e=Math.floor(.7*o.length),d=o.length;return Um(o,e,d,"*".repeat(d-e))}function Vm(o,e,d){function h(f){if(o===void 0)return o;if(Il(f))return f;if(Array.isArray(f))return f.map(h);var g={},A=0;for(f=Hg(f);A<f.length;A++){var C=ra(f[A],2),k=C[0];if(typeof(C=C[1])=="string"&&d.includes(k)){g[k]=typeof C=="string"?oa(C):"[Sensitive Info]";break}e.includes(k)?g[k]="[Hidden Info]":g[k]=C==null?C:d.includes(k)?"[Sensitive Info]":h(C)}return g}return Array.isArray(o)?o.map(h):h(o)}function Wm(o){return Object.getOwnPropertyNames(o).forEach(function(e){X(e=o[e])=="object"&&e!==null&&Wm(e)}),Object.freeze(o)}function pa(o){return new TextDecoder("utf-8").decode(o.buffer.slice(o.byteOffset,o.byteOffset+o.byteLength))}function Ig(o){return new TextEncoder().encode(o).length}function Xm(){for(var o=0,e=arguments.length,d=Array(e),h=0;h<e;h++)d[h]=arguments[h];for(e=0;e<d.length;e++)o+=d[e].length;for(o=new Uint8Array(o),h=e=0;h<d.length;h++){var f=d[h];o.set(f,e),e+=f.length}return o}function we(o,e,d){var h=o.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(o=h==null?void 0:h[1],h=h==null?void 0:h[2]){var f;for(h=h.substr(1).split("&"),f=0;f<h.length;f++)if(h[f].split("=")[0]==e){h[f]=e+"="+encodeURIComponent(d);break}return f==h.length&&h.push(e+"="+encodeURIComponent(d)),o+"?"+h.join("&")}return o+"?"+e+"="+encodeURIComponent(d)}function Ji(o){return new Promise(function(e,d){var h=new FileReader;h.onloadend=function(){var f=h.result||new ArrayBuffer(0);e(f)},h.onerror=d,h.readAsArrayBuffer(o)})}function Zt(o,e){o=o=[o],typeof(e=e||{})=="string"&&(e={type:e});try{var d=new Blob(o,e)}catch(f){if(f.name!=="TypeError")throw f;d=new(typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder);for(var h=0;h<o.length;h+=1)d.append(o[h]);d=d.getBlob(e.type)}return d}function Um(o,e,d,h){return typeof o!="string"?"[Sensitive Info]":o.substring(0,e)+h+o.substring(d)}function Ym(o){var e=[];return function d(h){if(h===null||X(h)!=="object")return h;if(e.indexOf(h)!==-1)return"[Circular]";if(e.push(h),typeof h.toJSON=="function")try{var f=d(h.toJSON());return e.pop(),f}catch(g){return"[Throws: "+(g?g.message:"?")+"]"}return Array.isArray(h)?(f=h.map(d),e.pop(),f):(f=Object.keys(h).reduce(function(g,A){t:{if($t.call(h,A))try{var C=h[A];break t}catch(k){C="[Throws: "+(k?k.message:"?")+"]";break t}C=h[A]}return g[A]=d(C),g},{}),e.pop(),f)}(o)}function au(o){if(!(100<(o=String(o)).length)&&(o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(o))){var e=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*e;case"weeks":case"week":case"w":return 6048e5*e;case"days":case"day":case"d":return 864e5*e;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*e;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*e;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e}}}function Jg(o,e,d,h){return Math.round(o/d)+" "+h+(e>=1.5*d?"s":"")}function bu(o){var e=o.areas,d=o.excludedArea;if(e.length===1&&e[0]===F.GLOBAL&&d===F.CHINA)return xe([F.OVERSEA]);if(e.includes(F.GLOBAL)){if(o=xf(Kg).filter(function(g){return g!==F.GLOBAL&&g!==F.OVERSEA}),d in yf){e=yf[d];var h=[].concat(G(e??[]),[d]);return xe(o.filter(function(g){return!h.includes(g)}))}if(Zm(d)){var f=cu(d);return xe(o.filter(function(g){return g!==d&&g!==f}))}}if(Zm(d)||d in yf)return xe(e);throw new I("Invalid excludedArea area config")}function Ma(o,e,d){d===void 0&&(d=Object.getOwnPropertyDescriptor(o,e));var h=d.value;return d.value=function(){for(var f=this,g=arguments.length,A=Array(g),C=0;C<g;C++)A[C]=arguments[C];this.invokeTracker.apply(this,["%s: ".concat(0<A.length?"%s with args: ".concat(A.map(function(){return"%o"})):"%s"),this.name,e].concat(G(A.map(ye))));try{var k=h.apply(this,A)}catch(_t){throw this.logError.apply(this,["".concat(_t.code!==void 0?"Error Code ".concat(_t.code,": "):"","%s failed").concat(0<A.length?" with args: ".concat(A.map(function(){return"%o"})):""),e].concat(G(A.map(ye)))),_t.originalError&&this.logError(_t.originalError),this.errorTracker(_t),_t}var j=Date.now();return J(w.mark(function _t(){var _n,ue;return w.wrap(function(Ei){for(;;)switch(Ei.prev=Ei.next){case 0:return Ei.prev=0,Ei.next=3,k;case 3:_n=Ei.sent,Ei.next=12;break;case 6:return Ei.prev=6,Ei.t0=Ei.catch(0),f.logError.apply(f,["".concat(Ei.t0.code!==void 0?"Error Code ".concat(Ei.t0.code,": "):"","%s failed").concat(0<A.length?" with args: ".concat(A.map(function(){return"%o"})):""),e].concat(G(A.map(ye)))),Ei.t0.originalError&&f.logError(Ei.t0.originalError),f.errorTracker(Ei.t0),Ei.abrupt("return");case 12:_n!==k?_n===void 0?f.resultTracker("%s promise resolves after %dms",e,Date.now()-j):f.resultTracker("%s promise resolves after %dms, result is %o",e,Date.now()-j,ye(_n)):Ac(_n)!=="Object"||yd(_n)?f.resultTracker("%s result is %o",e,ye(_n)):f.resultTracker("%s result is %s",e,_n.name||((ue=_n.constructor)===null||ue===void 0?void 0:ue.name));case 13:case"end":return Ei.stop()}},_t,null,[[0,6]])}))(),k},d}function Nb(o,e,d){d===void 0&&(d=Object.getOwnPropertyDescriptor(o,e));var h=d.value;return d.value=function(){for(var f=this,g=arguments.length,A=Array(g),C=0;C<g;C++)A[C]=arguments[C];this.invokeTracker.apply(this,["%s: ".concat(0<A.length?"%s with args: ".concat(A.map(function(){return"%o"})):"%s"),this.name,e].concat(A));try{var k=h.apply(this,A)}catch(_t){throw this.logError.apply(this,["".concat(_t.code!==void 0?"Error Code ".concat(_t.code,": "):"","%s failed").concat(0<A.length?" with args: ".concat(A.map(function(){return"%o"})):""),e].concat(A)),_t.originalError&&this.logError(_t.originalError),this.errorTracker(_t),_t}var j=Date.now();return J(w.mark(function _t(){var _n,ue;return w.wrap(function(Ei){for(;;)switch(Ei.prev=Ei.next){case 0:return Ei.prev=0,Ei.next=3,k;case 3:_n=Ei.sent,Ei.next=12;break;case 6:return Ei.prev=6,Ei.t0=Ei.catch(0),f.logError.apply(f,["".concat(Ei.t0.code!==void 0?"Error Code ".concat(Ei.t0.code,": "):"","%s failed").concat(0<A.length?" with args: ".concat(A.map(function(){return"%o"})):""),e].concat(A)),Ei.t0.originalError&&f.logError(Ei.t0.originalError),f.errorTracker(Ei.t0),Ei.abrupt("return");case 12:_n!==k?_n===void 0?f.resultTracker("%s promise resolves after %dms",e,Date.now()-j):f.resultTracker("%s promise resolves after %dms, result is %o",e,Date.now()-j,_n):Ac(_n)!=="Object"||yd(_n)?f.resultTracker("%s result is %o",e,_n):f.resultTracker("%s result is %s",e,_n.name||((ue=_n.constructor)===null||ue===void 0?void 0:ue.name));case 13:case"end":return Ei.stop()}},_t,null,[[0,6]])}))(),k},d}function du(o,e){var d="".concat(o,"Uri");if(typeof(d=Li[d])!="number"||d===0)throw new TypeError("Got Unknown URI Name");return e=new(o=$m[o])(e),e=o.encode(e).finish(),new eu({uri:d,data:e})}function an(o,e){return"".concat(o.split(".").join("-"),".edge.").concat(e?"sd-rtn.com":"agora.io")}function eb(o,e,d){return Mi.apply(this,arguments)}function Mi(){return(Mi=J(w.mark(function o(e,d,h){var f,g;return w.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:A.next=2;break;case 2:return f=fu[e].encode(d).finish(),g=function(){var C=J(w.mark(function k(j){var _t,_n,ue,Ei=arguments;return w.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:if(!(3<(_n=1<Ei.length&&Ei[1]!==void 0?Ei[1]:0))){_s.next=3;break}return _s.abrupt("return");case 3:return ue=we(ue=h?"https://".concat((_t=M==null?void 0:M.PROXY_NGINX[0])!==null&&_t!==void 0?_t:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(j,"&p=6443&d=events/proto-raw"):"https://".concat(j,":6443/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),ue=we(ue,"id",gu[e].toString()),_s.next=8,te(ue,{body:f,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch(function(_c){return g(j,_n+1)});case 8:case"end":return _s.stop()}},k)}));return function(k){return C.apply(this,arguments)}}(),A.prev=4,A.next=7,g((M==null?void 0:M.EVENT_REPORT_DOMAIN[0])||"webcollector-rtm.agora.io");case 7:A.next=13;break;case 9:return A.prev=9,A.t0=A.catch(4),A.next=13,g(M&&bn(1<(M==null?void 0:M.EVENT_REPORT_DOMAIN.length)?M==null?void 0:M.EVENT_REPORT_DOMAIN.slice(1):M==null?void 0:M.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 13:case"end":return A.stop()}},o,null,[[4,9]])}))).apply(this,arguments)}function fb(o){return o===void 0?U.fromNumber(0):U.fromNumber(Date.now()-o)}function hu(o){return btoa(String.fromCharCode.apply({},o.replace(/\r|\n/g,"").replace(/([\dA-Fa-f]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ").map(function(e){return parseInt(e,16)}))).replace(/={1,2}$/,"")}function Lg(o,e){return U.fromValue(o).eq(e)}function Mg(o,e){var d=e===void 0?o.val:e,h=o.isBoolean;e=o.isNumber;var f=o.oneof,g=o.len;if([h,e,f].filter(function(A){return!A}).length!==2)throw new TypeError("invalid field type");if(d!==void 0&&(o=!1,f!==void 0&&(f=Ni(f),iu(f,Lg).length===f.length&&ju(f,function(A){return Lg(d,A)})!==void 0&&(o=!0)),h=h!==void 0&&(d===0||d===1)&&g===1,e=e!==void 0&&d.toString(2).length<=g,!(o||h||e)))throw Error("invalid field value")}function cn(o){return function(){var e=o();if(!e)throw new K("Client is not logged in. Cannot do the operation");return e}}var Ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{},Ng=function(o){return o&&o.Math==Math&&o},y=Ng(typeof globalThis=="object"&&globalThis)||Ng(typeof window=="object"&&window)||Ng(typeof self=="object"&&self)||Ng(typeof Ya=="object"&&Ya)||function(){return this}()||Function("return this")(),R=function(o){try{return!!o()}catch{return!0}},ka=!R(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),dn={}.propertyIsEnumerable,en=Object.getOwnPropertyDescriptor,zf=en&&!dn.call({1:2},1)?function(o){return!!(o=en(this,o))&&o.enumerable}:dn,dd=function(o,e){return{enumerable:!(1&o),configurable:!(2&o),writable:!(4&o),value:e}},ku={}.toString,Zb=function(o){return ku.call(o).slice(8,-1)},lu="".split,Af=R(function(){return!Object("z").propertyIsEnumerable(0)})?function(o){return Zb(o)=="String"?lu.call(o,""):Object(o)}:Object,jb=function(o){if(o==null)throw TypeError("Can't call method on "+o);return o},qb=function(o){return Af(jb(o))},ha=function(o){return typeof o=="object"?o!==null:typeof o=="function"},lc=function(o,e){if(!ha(o))return o;var d,h;if(e&&typeof(d=o.toString)=="function"&&!ha(h=d.call(o))||typeof(d=o.valueOf)=="function"&&!ha(h=d.call(o))||!e&&typeof(d=o.toString)=="function"&&!ha(h=d.call(o)))return h;throw TypeError("Can't convert object to primitive value")},Qa=function(o){return Object(jb(o))},mu={}.hasOwnProperty,Q=function(o,e){return mu.call(Qa(o),e)},ze=y.document,Og=ha(ze)&&ha(ze.createElement),fn=!ka&&!R(function(){return Object.defineProperty(Og?ze.createElement("div"):{},"a",{get:function(){return 7}}).a!=7}),gn=Object.getOwnPropertyDescriptor,Fb={f:ka?gn:function(o,e){if(o=qb(o),e=lc(e,!0),fn)try{return gn(o,e)}catch{}if(Q(o,e))return dd(!zf.call(o,e),o[e])}},va=function(o){if(!ha(o))throw TypeError(String(o)+" is not an object");return o},hn=Object.defineProperty,Ra={f:ka?hn:function(o,e,d){if(va(o),e=lc(e,!0),va(d),fn)try{return hn(o,e,d)}catch{}if("get"in d||"set"in d)throw TypeError("Accessors not supported");return"value"in d&&(o[e]=d.value),o}},Na=ka?function(o,e,d){return Ra.f(o,e,dd(1,d))}:function(o,e,d){return o[e]=d,o},Oi=function(o,e){try{Na(y,o,e)}catch{y[o]=e}return e},ed=y["__core-js_shared__"]||Oi("__core-js_shared__",{}),nu=Function.toString;typeof ed.inspectSource!="function"&&(ed.inspectSource=function(o){return nu.call(o)});var Pi=ed.inspectSource,jn=y.WeakMap,ou=typeof jn=="function"&&/native code/.test(Pi(jn)),fd=$a(function(o){(o.exports=function(e,d){return ed[e]||(ed[e]=d!==void 0?d:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"})}),pu=0,qu=Math.random(),Ae=function(o){return"Symbol("+String(o===void 0?"":o)+")_"+(++pu+qu).toString(36)},kn=fd("keys"),Pg=function(o){return kn[o]||(kn[o]=Ae(o))},Be={},ru=y.WeakMap;if(ou||ed.state)var Gd=ed.state||(ed.state=new ru),su=Gd.get,ln=Gd.has,tu=Gd.set,Qi=function(o,e){if(ln.call(Gd,o))throw new TypeError("Object already initialized");return e.facade=o,tu.call(Gd,o,e),e},Qg=function(o){return su.call(Gd,o)||{}},Ri=function(o){return ln.call(Gd,o)};else{var Ce=Pg("state");Be[Ce]=!0,Qi=function(o,e){if(Q(o,Ce))throw new TypeError("Object already initialized");return e.facade=o,Na(o,Ce,e),e},Qg=function(o){return Q(o,Ce)?o[Ce]:{}},Ri=function(o){return Q(o,Ce)}}var Za={set:Qi,get:Qg,has:Ri,enforce:function(o){return Ri(o)?Qg(o):Qi(o,{})},getterFor:function(o){return function(e){var d;if(!ha(e)||(d=Qg(e)).type!==o)throw TypeError("Incompatible receiver, "+o+" required");return d}}},Ta=$a(function(o){var e=Za.get,d=Za.enforce,h=String(String).split("String");(o.exports=function(f,g,A,C){var k=!!C&&!!C.unsafe,j=!!C&&!!C.enumerable;if(C=!!C&&!!C.noTargetGet,typeof A=="function"){typeof g!="string"||Q(A,"name")||Na(A,"name",g);var _t=d(A);_t.source||(_t.source=h.join(typeof g=="string"?g:""))}f===y?j?f[g]=A:Oi(g,A):(k?!C&&f[g]&&(j=!0):delete f[g],j?f[g]=A:Na(f,g,A))})(Function.prototype,"toString",function(){return typeof this=="function"&&e(this).source||Pi(this)})}),mn=function(o){return typeof o=="function"?o:void 0},mc=function(o,e){return 2>arguments.length?mn(y[o])||mn(y[o]):y[o]&&y[o][e]||y[o]&&y[o][e]},uu=Math.ceil,vu=Math.floor,$b=function(o){return isNaN(o=+o)?0:(0<o?vu:uu)(o)},wu=Math.min,ta=function(o){return 0<o?wu($b(o),9007199254740991):0},xu=Math.max,yu=Math.min,xb=function(o,e){return 0>(o=$b(o))?xu(o+e,0):yu(o,e)},nn=function(o){return function(e,d,h){e=qb(e);var f=ta(e.length);if(h=xb(h,f),o&&d!=d){for(;f>h;)if((d=e[h++])!=d)return!0}else for(;f>h;h++)if((o||h in e)&&e[h]===d)return o||h||0;return!o&&-1}},on=nn(!0),Si=nn(!1),pn=function(o,e){o=qb(o);var d,h=0,f=[];for(d in o)!Q(Be,d)&&Q(o,d)&&f.push(d);for(;e.length>h;)Q(o,d=e[h++])&&(~Si(f,d)||f.push(d));return f},Rg="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),zu=Rg.concat("length","prototype"),Hd={f:Object.getOwnPropertyNames||function(o){return pn(o,zu)}},Bf={f:Object.getOwnPropertySymbols},qn=mc("Reflect","ownKeys")||function(o){var e=Hd.f(va(o)),d=Bf.f;return d?e.concat(d(o)):e},rn=function(o,e){for(var d=qn(e),h=Ra.f,f=Fb.f,g=0;g<d.length;g++){var A=d[g];Q(o,A)||h(o,A,f(e,A))}},Au=/#|\.prototype\./,nc=function(o,e){return(o=Bu[Cu(o)])==Du||o!=Eu&&(typeof e=="function"?R(e):!!e)},Cu=nc.normalize=function(o){return String(o).replace(Au,".").toLowerCase()},Bu=nc.data={},Eu=nc.NATIVE="N",Du=nc.POLYFILL="P",Fu=Fb.f,N=function(o,e){var d,h,f,g=o.target,A=o.global,C=o.stat;if(h=A?y:C?y[g]||Oi(g,{}):(y[g]||{}).prototype)for(f in e){var k=e[f],j=o.noTargetGet?(d=Fu(h,f))&&d.value:h[f];if(!(d=nc(A?f:g+(C?".":"#")+f,o.forced))&&j!==void 0){if(typeof k==typeof j)continue;rn(k,j)}(o.sham||j&&j.sham)&&Na(k,"sham",!0);try{Ta(h,f,k,o)}catch{}}},yb=function(o){if(typeof o!="function")throw TypeError(String(o)+" is not a function");return o},Id=function(o,e,d){if(yb(o),e===void 0)return o;switch(d){case 0:return function(){return o.call(e)};case 1:return function(h){return o.call(e,h)};case 2:return function(h,f){return o.call(e,h,f)};case 3:return function(h,f,g){return o.call(e,h,f,g)}}return function(){return o.apply(e,arguments)}},gd=Array.isArray||function(o){return Zb(o)=="Array"},De=mc("navigator","userAgent")||"",sn=y.process,tn=sn&&sn.versions,un=tn&&tn.v8;if(un)var hd=un.split("."),Ti=4>hd[0]?1:hd[0]+hd[1];else De&&(hd=De.match(/Edge\/(\d+)/),(!hd||74<=hd[1])&&(hd=De.match(/Chrome\/(\d+)/))&&(Ti=hd[1]));var id=Ti&&+Ti,oc=!!Object.getOwnPropertySymbols&&!R(function(){return!String(Symbol())||!Symbol.sham&&id&&41>id}),vn=oc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Cf=fd("wks"),Df=y.Symbol,Gu=vn?Df:Df&&Df.withoutSetter||Ae,qa=function(o){return Q(Cf,o)&&(oc||typeof Cf[o]=="string")||(oc&&Q(Df,o)?Cf[o]=Df[o]:Cf[o]=Gu("Symbol."+o)),Cf[o]},Hu=qa("species"),Sg=function(o,e){if(gd(o)){var d=o.constructor;typeof d!="function"||d!==Array&&!gd(d.prototype)?ha(d)&&(d=d[Hu])===null&&(d=void 0):d=void 0}return new(d===void 0?Array:d)(e===0?0:e)},wn=[].push,jd=function(o){var e=o==1,d=o==2,h=o==3,f=o==4,g=o==6,A=o==7,C=o==5||g;return function(k,j,_t,_n){var ue=Qa(k),Ei=Af(ue);j=Id(j,_t,3),_t=ta(Ei.length);var _s,_c=0;for(_n=_n||Sg,k=e?_n(k,_t):d||A?_n(k,0):void 0;_t>_c;_c++)if((C||_c in Ei)&&(_s=j(_n=Ei[_c],_c,ue),o))if(e)k[_c]=_s;else if(_s)switch(o){case 3:return!0;case 5:return _n;case 6:return _c;case 2:wn.call(k,_n)}else switch(o){case 4:return!1;case 7:wn.call(k,_n)}return g?-1:h||f?f:k}},Jd=jd(0),xn=jd(1),yn=jd(2),Iu=jd(3),Ju=jd(4),zn=jd(5),An=jd(6),Ku=qa("species"),Ef=function(o){return 51<=id||!R(function(){var e=[];return(e.constructor={})[Ku]=function(){return{foo:1}},e[o](Boolean).foo!==1})},Lu=Ef("filter");N({target:"Array",proto:!0,forced:!Lu},{filter:function(o){return yn(this,o,1<arguments.length?arguments[1]:void 0)}});var Dc=Object.keys||function(o){return pn(o,Rg)},Mu=R(function(){Dc(1)});N({target:"Object",stat:!0,forced:Mu},{keys:function(o){return Dc(Qa(o))}});var Ee=function(o,e){var d=[][o];return!!d&&R(function(){d.call(null,e||function(){throw 1},1)})},Nu=[].join,Ou=Af!=Object,Pu=Ee("join",",");N({target:"Array",proto:!0,forced:Ou||!Pu},{join:function(o){return Nu.call(qb(this),o===void 0?",":o)}});var Qu=Ef("map");N({target:"Array",proto:!0,forced:!Qu},{map:function(o){return xn(this,o,1<arguments.length?arguments[1]:void 0)}});var Ui=function(o){var e=o.return;if(e!==void 0)return va(e.call(o)).value},Fe={},Ru=qa("iterator"),Su=Array.prototype,Vi=function(o){return o!==void 0&&(Fe.Array===o||Su[Ru]===o)},Ge=function(o,e,d){(e=lc(e))in o?Ra.f(o,e,dd(0,d)):o[e]=d},Tu=qa("toStringTag"),Bn={};Bn[Tu]="z";var Wi=String(Bn)==="[object z]",Uu=qa("toStringTag"),Vu=Zb(function(){return arguments}())=="Arguments",Ff=Wi?Zb:function(o){var e;if(o===void 0)var d="Undefined";else{if(o===null)var h="Null";else{t:{var f=o=Object(o);try{h=f[Uu];break t}catch{}h=void 0}h=typeof(d=h)=="string"?d:Vu?Zb(o):(e=Zb(o))=="Object"&&typeof o.callee=="function"?"Arguments":e}d=h}return d},Wu=qa("iterator"),Xi=function(o){if(o!=null)return o[Wu]||o["@@iterator"]||Fe[Ff(o)]},Cn=qa("iterator"),Dn=!1;try{var Xu=0,En={next:function(){return{done:!!Xu++}},return:function(){Dn=!0}};En[Cn]=function(){return this},Array.from(En,function(){throw 2})}catch(o){}var Tg=function(o,e){if(!e&&!Dn)return!1;var d=!1;try{(e={})[Cn]=function(){return{next:function(){return{done:d=!0}}}},o(e)}catch{}return d},Yu=!Tg(function(o){Array.from(o)});N({target:"Array",stat:!0,forced:Yu},{from:function(o){var e,d=Qa(o),h=typeof this=="function"?this:Array,f=arguments.length,g=1<f?arguments[1]:void 0,A=g!==void 0,C=Xi(d),k=0;if(A&&(g=Id(g,2<f?arguments[2]:void 0,2)),C==null||h==Array&&Vi(C)){var j=ta(d.length);for(h=new h(j);j>k;k++)C=A?g(d[k],k):d[k],Ge(h,k,C)}else for(f=(d=C.call(d)).next,h=new h;!(e=f.call(d)).done;k++){if(A){C=d;var _t=g;e=[e.value,k];try{j=_t(va(e)[0],e[1])}catch(_n){throw Ui(C),_n}}else j=e.value;Ge(h,k,C=j)}return h.length=k,h}});var Fn=function(o){return function(e,d){e=String(jb(e)),d=$b(d);var h,f=e.length;if(0>d||d>=f)return o?"":void 0;var g=e.charCodeAt(d);return 55296>g||56319<g||d+1===f||56320>(h=e.charCodeAt(d+1))||57343<h?o?e.charAt(d):g:o?e.slice(d,d+2):h-56320+(g-55296<<10)+65536}},Gn=Fn(!0),Hn=!R(function(){function o(){}return o.prototype.constructor=null,Object.getPrototypeOf(new o)!==o.prototype}),In=Pg("IE_PROTO"),Zu=Object.prototype,Vb=Hn?Object.getPrototypeOf:function(o){return o=Qa(o),Q(o,In)?o[In]:typeof o.constructor=="function"&&o instanceof o.constructor?o.constructor.prototype:o instanceof Object?Zu:null},Yi=qa("iterator"),Jn=!1,$u=function(){return this},Kd;if([].keys){var Kn=[].keys();if("next"in Kn){var Ln=Vb(Vb(Kn));Ln!==Object.prototype&&(Kd=Ln)}else Jn=!0}(Kd==null||R(function(){var o={};return Kd[Yi].call(o)!==o}))&&(Kd={}),Q(Kd,Yi)||Na(Kd,Yi,$u);var Ug=Kd,Vg=Jn,av=ka?Object.defineProperties:function(o,e){va(o);for(var d,h=Dc(e),f=h.length,g=0;f>g;)Ra.f(o,d=h[g++],e[d]);return o},Zi=mc("document","documentElement"),Mn=Pg("IE_PROTO"),$i=function(){},aj,Wg=function(){try{aj=document.domain&&new ActiveXObject("htmlfile")}catch{}if(aj){var o=aj;o.write("<script><\/script>"),o.close(),o=o.parentWindow.Object}else(o=Og?ze.createElement("iframe"):{}).style.display="none",Zi.appendChild(o),o.src="javascript:",(o=o.contentWindow.document).open(),o.write("<script>document.F=Object<\/script>"),o.close(),o=o.F;for(Wg=o,o=Rg.length;o--;)delete Wg.prototype[Rg[o]];return Wg()};Be[Mn]=!0;var ac=Object.create||function(o,e){if(o!==null){$i.prototype=va(o);var d=new $i;$i.prototype=null,d[Mn]=o}else d=Wg();return e===void 0?d:av(d,e)},bv=Ra.f,Nn=qa("toStringTag"),Ec=function(o,e,d){o&&!Q(o=d?o:o.prototype,Nn)&&bv(o,Nn,{configurable:!0,value:e})},cv=function(){return this},dv=function(o,e,d){return e+=" Iterator",o.prototype=ac(Ug,{next:dd(1,d)}),Ec(o,e,!1),Fe[e]=cv,o},Ua=Object.setPrototypeOf||("__proto__"in{}?function(){var o=!1,e={};try{var d=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;d.call(e,[]),o=e instanceof Array}catch{}return function(h,f){if(va(h),!ha(f)&&f!==null)throw TypeError("Can't set "+String(f)+" as a prototype");return o?d.call(h,f):h.__proto__=f,h}}():void 0),Gf=qa("iterator"),ev=function(){return this},bj=function(o,e,d,h,f,g,A){dv(d,e,h),h=function(_c){if(_c===f&&ue)return ue;if(!Vg&&_c in _t)return _t[_c];switch(_c){case"keys":case"values":case"entries":return function(){return new d(this,_c)}}return function(){return new d(this)}};var C,k=e+" Iterator",j=!1,_t=o.prototype,_n=_t[Gf]||_t["@@iterator"]||f&&_t[f],ue=!Vg&&_n||h(f),Ei=e=="Array"&&_t.entries||_n;if(Ei&&(o=Vb(Ei.call(new o)),Ug!==Object.prototype&&o.next&&(Vb(o)!==Ug&&(Ua?Ua(o,Ug):typeof o[Gf]!="function"&&Na(o,Gf,ev)),Ec(o,k,!0))),f=="values"&&_n&&_n.name!=="values"&&(j=!0,ue=function(){return _n.call(this)}),_t[Gf]!==ue&&Na(_t,Gf,ue),Fe[e]=ue,f){var _s={values:h("values"),keys:g?ue:h("keys"),entries:h("entries")};if(A)for(C in _s)!Vg&&!j&&C in _t||Ta(_t,C,_s[C]);else N({target:e,proto:!0,forced:Vg||j},_s)}return _s},fv=Za.set,gv=Za.getterFor("String Iterator");bj(String,"String",function(o){fv(this,{type:"String Iterator",string:String(o),index:0})},function(){var o=gv(this),e=o.string,d=o.index;return d>=e.length?{value:void 0,done:!0}:(e=Gn(e,d),o.index+=e.length,{value:e,done:!1})});var cj=qa("unscopables"),dj=Array.prototype;dj[cj]==null&&Ra.f(dj,cj,{configurable:!0,value:ac(null)});var Ld=function(o){dj[cj][o]=!0},On=!0;"find"in[]&&Array(1).find(function(){On=!1}),N({target:"Array",proto:!0,forced:On},{find:function(o){return zn(this,o,1<arguments.length?arguments[1]:void 0)}}),Ld("find");var Pn=function(o){var e=String(jb(this)),d="";if(0>(o=$b(o))||1/0==o)throw RangeError("Wrong number of repetitions");for(;0<o;(o>>>=1)&&(e+=e))1&o&&(d+=e);return d};N({target:"String",proto:!0},{repeat:Pn}),N({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),N({target:"Number",stat:!0},{isNaN:function(o){return o!=o}}),y.Number.isNaN;var hv=Wi?{}.toString:function(){return"[object "+Ff(this)+"]"};Wi||Ta(Object.prototype,"toString",hv,{unsafe:!0});var Fc=y.Promise,Hf=function(o,e,d){for(var h in e)Ta(o,h,e[h],d);return o},Qn=qa("species"),If=function(o){o=mc(o);var e=Ra.f;ka&&o&&!o[Qn]&&e(o,Qn,{configurable:!0,get:function(){return this}})},Gc=function(o,e,d){if(!(o instanceof e))throw TypeError("Incorrect "+(d?d+" ":"")+"invocation");return o},Jf=function(o,e){this.stopped=o,this.result=e},Xg=function(o,e,d){var h,f=!(!d||!d.AS_ENTRIES),g=!(!d||!d.IS_ITERATOR),A=!(!d||!d.INTERRUPTED),C=Id(e,d&&d.that,1+f+A),k=function(_t){return j&&Ui(j),new Jf(!0,_t)};if(e=function(_t){return f?(va(_t),A?C(_t[0],_t[1],k):C(_t[0],_t[1])):A?C(_t,k):C(_t)},g)var j=o;else{if(typeof(g=Xi(o))!="function")throw TypeError("Target is not iterable");if(Vi(g)){for(g=0,d=ta(o.length);d>g;g++)if((h=e(o[g]))&&h instanceof Jf)return h;return new Jf(!1)}j=g.call(o)}for(o=j.next;!(g=o.call(j)).done;){try{h=e(g.value)}catch(_t){throw Ui(j),_t}if(typeof h=="object"&&h&&h instanceof Jf)return h}return new Jf(!1)},iv=qa("species"),kd=function(o,e){var d;return(o=va(o).constructor)===void 0||(d=va(o)[iv])==null?e:yb(d)},Rn=/(?:iphone|ipod|ipad).*applewebkit/i.test(De),Hc=Zb(y.process)=="process",Yg=y.location,ej=y.setImmediate,Sn=y.clearImmediate,jv=y.process,Tn=y.MessageChannel,fj=y.Dispatch,gj=0,Kf={},hj=function(o){if(Kf.hasOwnProperty(o)){var e=Kf[o];delete Kf[o],e()}},ij=function(o){return function(){hj(o)}},Un=function(o){hj(o.data)},Vn=function(o){y.postMessage(o+"",Yg.protocol+"//"+Yg.host)};if(!ej||!Sn)if(ej=function(o){for(var e=[],d=1;arguments.length>d;)e.push(arguments[d++]);return Kf[++gj]=function(){(typeof o=="function"?o:Function(o)).apply(void 0,e)},Lf(gj),gj},Sn=function(o){delete Kf[o]},Hc)var Lf=function(o){jv.nextTick(ij(o))};else if(fj&&fj.now)Lf=function(o){fj.now(ij(o))};else if(Tn&&!Rn){var Wn=new Tn,Xn=Wn.port2;Wn.port1.onmessage=Un,Lf=Id(Xn.postMessage,Xn,1)}else y.addEventListener&&typeof postMessage=="function"&&!y.importScripts&&Yg&&Yg.protocol!=="file:"&&!R(Vn)?(Lf=Vn,y.addEventListener("message",Un,!1)):Lf="onreadystatechange"in(Og?ze.createElement("script"):{})?function(o){Zi.appendChild(Og?ze.createElement("script"):{}).onreadystatechange=function(){Zi.removeChild(this),hj(o)}}:function(o){setTimeout(ij(o),0)};var jj=ej,kv=/web0s(?!.*chrome)/i.test(De),lv=Fb.f,Yn=y.MutationObserver||y.WebKitMutationObserver,Zn=y.document,$n=y.process,Zg=y.Promise,ao=lv(y,"queueMicrotask"),bo=ao&&ao.value,Md,Mf;if(!bo){var ah=function(){var o;for(Hc&&(o=$n.domain)&&o.exit();Md;){var e=Md.fn;Md=Md.next;try{e()}catch(d){throw Md?$g():Mf=void 0,d}}Mf=void 0,o&&o.enter()};if(Rn||Hc||kv||!Yn||!Zn)if(Zg&&Zg.resolve){var kj=Zg.resolve(void 0);kj.constructor=Zg;var mv=kj.then,$g=function(){mv.call(kj,ah)}}else $g=Hc?function(){$n.nextTick(ah)}:function(){jj.call(y,ah)};else{var co=!0,eo=Zn.createTextNode("");new Yn(ah).observe(eo,{characterData:!0}),$g=function(){eo.data=co=!co}}}var fo=bo||function(o){o={fn:o,next:void 0},Mf&&(Mf.next=o),Md||(Md=o,$g()),Mf=o},nv=function(o){var e,d;this.promise=new o(function(h,f){if(e!==void 0||d!==void 0)throw TypeError("Bad Promise constructor");e=h,d=f}),this.resolve=yb(e),this.reject=yb(d)},lj={f:function(o){return new nv(o)}},mj=function(o,e){return va(o),ha(e)&&e.constructor===o?e:((0,(o=lj.f(o)).resolve)(e),o.promise)},ov=function(o,e){var d=y.console;d&&d.error&&(arguments.length===1?d.error(o):d.error(o,e))},nj=function(o){try{return{error:!1,value:o()}}catch(e){return{error:!0,value:e}}},pv=typeof window=="object",qv=qa("species"),go=Za.get,rv=Za.set,sv=Za.getterFor("Promise"),Nd=Fc&&Fc.prototype,zb=Fc,bh=Nd,ho=y.TypeError,oj=y.document,pj=y.process,He=lj.f,tv=He,uv=!!(oj&&oj.createEvent&&y.dispatchEvent),io=typeof PromiseRejectionEvent=="function",jo=!1,Nf=nc("Promise",function(){var o=Pi(zb)!==String(zb);if(!o&&id===66)return!0;if(51<=id&&/native code/.test(zb))return!1;var e=new zb(function(h){h(1)}),d=function(h){h(function(){},function(){})};return(e.constructor={})[qv]=d,!(jo=e.then(function(){})instanceof d)||!o&&pv&&!io}),vv=Nf||!Tg(function(o){zb.all(o).catch(function(){})}),ko=function(o){var e;return!(!ha(o)||typeof(e=o.then)!="function")&&e},qj=function(o,e){if(!o.notified){o.notified=!0;var d=o.reactions;fo(function(){for(var h=o.value,f=o.state==1,g=0;d.length>g;){var A,C=d[g++],k=f?C.ok:C.fail,j=C.resolve,_t=C.reject,_n=C.domain;try{if(k){if(f||(o.rejection===2&&wv(o),o.rejection=1),k===!0)var ue=h;else if(_n&&_n.enter(),ue=k(h),_n){_n.exit();var Ei=!0}ue===C.promise?_t(ho("Promise-chain cycle")):(A=ko(ue))?A.call(ue,j,_t):j(ue)}else _t(h)}catch(_s){_n&&!Ei&&_n.exit(),_t(_s)}}o.reactions=[],o.notified=!1,e&&!o.rejection&&xv(o)})}},lo=function(o,e,d){var h;if(uv){var f=oj.createEvent("Event");f.promise=e,f.reason=d,f.initEvent(o,!1,!0),y.dispatchEvent(f)}else f={promise:e,reason:d};!io&&(h=y["on"+o])?h(f):o==="unhandledrejection"&&ov("Unhandled promise rejection",d)},xv=function(o){jj.call(y,function(){var e=o.facade,d=o.value;if(o.rejection!==1&&!o.parent){var h=nj(function(){Hc?pj.emit("unhandledRejection",d,e):lo("unhandledrejection",e,d)});if(o.rejection=Hc||o.rejection!==1&&!o.parent?2:1,h.error)throw h.value}})},wv=function(o){jj.call(y,function(){var e=o.facade;Hc?pj.emit("rejectionHandled",e):lo("rejectionhandled",e,o.value)})},Ie=function(o,e,d){return function(h){o(e,h,d)}},Je=function(o,e,d){o.done||(o.done=!0,d&&(o=d),o.value=e,o.state=2,qj(o,!0))},rj=function(o,e,d){if(!o.done){o.done=!0,d&&(o=d);try{if(o.facade===e)throw ho("Promise can't be resolved itself");var h=ko(e);h?fo(function(){var f={done:!1};try{h.call(e,Ie(rj,f,o),Ie(Je,f,o))}catch(g){Je(f,g,o)}}):(o.value=e,o.state=1,qj(o,!1))}catch(f){Je({done:!1},f,o)}}};if(Nf){zb=function(o){Gc(this,zb,"Promise"),yb(o),sj.call(this);var e=go(this);try{o(Ie(rj,e),Ie(Je,e))}catch(d){Je(e,d)}},bh=zb.prototype;var sj=function(o){rv(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};sj.prototype=Hf(bh,{then:function(o,e){var d=sv(this),h=He(kd(this,zb));return h.ok=typeof o!="function"||o,h.fail=typeof e=="function"&&e,h.domain=Hc?pj.domain:void 0,d.parent=!0,d.reactions.push(h),d.state!=0&&qj(d,!1),h.promise},catch:function(o){return this.then(void 0,o)}});var yv=function(){var o=new sj,e=go(o);this.promise=o,this.resolve=Ie(rj,e),this.reject=Ie(Je,e)};if(lj.f=He=function(o){return o===zb||o===zv?new yv(o):tv(o)},typeof Fc=="function"&&Nd!==Object.prototype){var Av=Nd.then;jo||(Ta(Nd,"then",function(o,e){var d=this;return new zb(function(h,f){Av.call(d,h,f)}).then(o,e)},{unsafe:!0}),Ta(Nd,"catch",bh.catch,{unsafe:!0}));try{delete Nd.constructor}catch{}Ua&&Ua(Nd,bh)}}N({global:!0,wrap:!0,forced:Nf},{Promise:zb}),Ec(zb,"Promise",!1),If("Promise");var zv=mc("Promise");N({target:"Promise",stat:!0,forced:Nf},{reject:function(o){var e=He(this);return e.reject.call(void 0,o),e.promise}}),N({target:"Promise",stat:!0,forced:Nf},{resolve:function(o){return mj(this,o)}}),N({target:"Promise",stat:!0,forced:vv},{all:function(o){var e=this,d=He(e),h=d.resolve,f=d.reject,g=nj(function(){var A=yb(e.resolve),C=[],k=0,j=1;Xg(o,function(_t){var _n=k++,ue=!1;C.push(void 0),j++,A.call(e,_t).then(function(Ei){ue||(ue=!0,C[_n]=Ei,--j||h(C))},f)}),--j||h(C)});return g.error&&f(g.value),d.promise},race:function(o){var e=this,d=He(e),h=d.reject,f=nj(function(){var g=yb(e.resolve);Xg(o,function(A){g.call(e,A).then(d.resolve,h)})});return f.error&&h(f.value),d.promise}});var mo=[].indexOf,no=!!mo&&0>1/[1].indexOf(1,-0),Bv=Ee("indexOf");N({target:"Array",proto:!0,forced:no||!Bv},{indexOf:function(o){return no?mo.apply(this,arguments)||0:Si(this,o,1<arguments.length?arguments[1]:void 0)}});var tj=function(){var o=va(this),e="";return o.global&&(e+="g"),o.ignoreCase&&(e+="i"),o.multiline&&(e+="m"),o.dotAll&&(e+="s"),o.unicode&&(e+="u"),o.sticky&&(e+="y"),e},pc=R(function(){var o=RegExp("a","y");return o.lastIndex=2,o.exec("abcd")!=null}),Cv=R(function(){var o=RegExp("^r","gy");return o.lastIndex=2,o.exec("str")!=null}),ch=RegExp.prototype.exec,Dv=fd("native-string-replace",String.prototype.replace),oo=ch,uj=(c=/a/,a=/b*/g,ch.call(c,"a"),ch.call(a,"a"),c.lastIndex!==0||a.lastIndex!==0),po=pc||Cv,vj=/()??/.exec("")[1]!==void 0,c,a;(uj||vj||po)&&(oo=function(o){var e,d=po&&this.sticky,h=tj.call(this),f=this.source,g=0,A=o;if(d){(h=h.replace("y","")).indexOf("g")===-1&&(h+="g"),A=String(o).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&o[this.lastIndex-1]!==`
`)&&(f="(?: "+f+")",A=" "+A,g++);var C=new RegExp("^(?:"+f+")",h)}if(vj&&(C=new RegExp("^"+f+"$(?!\\s)",h)),uj)var k=this.lastIndex;var j=ch.call(d?C:this,A);return d?j?(j.input=j.input.slice(g),j[0]=j[0].slice(g),j.index=this.lastIndex,this.lastIndex+=j[0].length):this.lastIndex=0:uj&&j&&(this.lastIndex=this.global?j.index+j[0].length:k),vj&&j&&1<j.length&&Dv.call(j[0],C,function(){for(e=1;e<arguments.length-2;e++)arguments[e]===void 0&&(j[e]=void 0)}),j});var Of=oo;N({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Ev=qa("species"),wj=RegExp.prototype,Fv=!R(function(){var o=/./;return o.exec=function(){var e=[];return e.groups={a:"7"},e},"".replace(o,"$<a>")!=="7"}),qo="a".replace(/./,"$0")==="$0",ro=qa("replace"),so=!!/./[ro]&&/./[ro]("a","$0")==="",Gv=!R(function(){var o=/(?:)/,e=o.exec;return o.exec=function(){return e.apply(this,arguments)},(o="ab".split(o)).length!==2||o[0]!=="a"||o[1]!=="b"}),dh=function(o,e,d,h){var f=qa(o),g=!R(function(){var j={};return j[f]=function(){return 7},""[o](j)!=7}),A=g&&!R(function(){var j=!1,_t=/a/;return o==="split"&&((_t={constructor:{}}).constructor[Ev]=function(){return _t},_t.flags="",_t[f]=/./[f]),_t.exec=function(){return j=!0,null},_t[f](""),!j});if(!g||!A||o==="replace"&&(!Fv||!qo||so)||o==="split"&&!Gv){var C=/./[f],k=(d=d(f,""[o],function(j,_t,_n,ue,Ei){var _s=_t.exec;return _s===Of||_s===wj.exec?g&&!Ei?{done:!0,value:C.call(_t,_n,ue)}:{done:!0,value:j.call(_n,_t,ue)}:{done:!1}},{REPLACE_KEEPS_$0:qo,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:so}))[1];Ta(String.prototype,o,d[0]),Ta(wj,f,e==2?function(j,_t){return k.call(j,this,_t)}:function(j){return k.call(j,this)})}h&&Na(wj[f],"sham",!0)},xj=function(o,e,d){return e+(d?Gn(o,e).length:1)},Hv=Math.floor,Iv="".replace,Jv=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Kv=/\$([$&'`]|\d{1,2})/g,Lv=function(o,e,d,h,f,g){var A=d+o.length,C=h.length,k=Kv;return f!==void 0&&(f=Qa(f),k=Jv),Iv.call(g,k,function(j,_t){switch(_t.charAt(0)){case"$":return"$";case"&":return o;case"`":return e.slice(0,d);case"'":return e.slice(A);case"<":j=f[_t.slice(1,-1)];break;default:var _n=+_t;if(_n===0)return j;if(_n>C)return(_n=Hv(_n/10))===0?j:_n<=C?h[_n-1]===void 0?_t.charAt(1):h[_n-1]+_t.charAt(1):j;j=h[_n-1]}return j===void 0?"":j})},Ke=function(o,e){var d=o.exec;if(typeof d=="function"){if(typeof(o=d.call(o,e))!="object")throw TypeError("RegExp exec method returned something other than an Object or null");return o}if(Zb(o)!=="RegExp")throw TypeError("RegExp#exec called on incompatible receiver");return Of.call(o,e)},Mv=Math.max,Nv=Math.min,Ov=function(o){return o===void 0?o:String(o)};dh("replace",2,function(o,e,d,h){var f=h.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,g=h.REPLACE_KEEPS_$0,A=f?"$":"$0";return[function(C,k){var j=jb(this),_t=C==null?void 0:C[o];return _t!==void 0?_t.call(C,j,k):e.call(String(j),C,k)},function(C,k){if(!f&&g||typeof k=="string"&&k.indexOf(A)===-1){var j=d(e,C,this,k);if(j.done)return j.value}var _t=va(C);C=String(this),(j=typeof k=="function")||(k=String(k));var _n=_t.global;if(_n){var ue=_t.unicode;_t.lastIndex=0}for(var Ei=[];;){var _s=Ke(_t,C);if(_s===null||(Ei.push(_s),!_n))break;String(_s[0])===""&&(_t.lastIndex=xj(C,ta(_t.lastIndex),ue))}for(ue="",_n=_t=0;_n<Ei.length;_n++){_s=Ei[_n];for(var _c=String(_s[0]),_u=Mv(Nv($b(_s.index),C.length),0),_d=[],_l=1;_l<_s.length;_l++)_d.push(Ov(_s[_l]));_s=_s.groups,j?(_d=[_c].concat(_d,_u,C),_s!==void 0&&_d.push(_s),_s=String(k.apply(void 0,_d))):_s=Lv(_c,C,_u,_d,_s,k),_u>=_t&&(ue+=C.slice(_t,_u)+_s,_t=_u+_c.length)}return ue+C.slice(_t)}]});var Pv=Ef("slice"),Qv=qa("species"),Rv=[].slice,Sv=Math.max;N({target:"Array",proto:!0,forced:!Pv},{slice:function(o,e){var d=qb(this),h=ta(d.length);if(o=xb(o,h),e=xb(e===void 0?h:e,h),gd(d)){var f=d.constructor;if(typeof f!="function"||f!==Array&&!gd(f.prototype)?ha(f)&&(f=f[Qv])===null&&(f=void 0):f=void 0,f===Array||f===void 0)return Rv.call(d,o,e)}for(f=new(f===void 0?Array:f)(Sv(e-o,0)),h=0;o<e;o++,h++)o in d&&Ge(f,h,d[o]);return f.length=h,f}});var Tv=Za.set,Uv=Za.getterFor("Array Iterator"),ld=bj(Array,"Array",function(o,e){Tv(this,{type:"Array Iterator",target:qb(o),index:0,kind:e})},function(){var o=Uv(this),e=o.target,d=o.kind,h=o.index++;return!e||h>=e.length?(o.target=void 0,{value:void 0,done:!0}):d=="keys"?{value:h,done:!1}:d=="values"?{value:e[h],done:!1}:{value:[h,e[h]],done:!1}},"values");Fe.Arguments=Fe.Array,Ld("keys"),Ld("values"),Ld("entries");var to=typeof ArrayBuffer<"u"&&typeof DataView<"u",Le=function(o){if(o===void 0)return 0;o=$b(o);var e=ta(o);if(o!==e)throw RangeError("Wrong length or index");return e},Vv=Math.abs,Ic=Math.pow,Wv=Math.floor,Xv=Math.log,Yv=Math.LN2,yj=function(o){var e=Qa(this),d=ta(e.length),h=arguments.length,f=xb(1<h?arguments[1]:void 0,d);for(d=(h=2<h?arguments[2]:void 0)===void 0?d:xb(h,d);d>f;)e[f++]=o;return e},Zv=Hd.f,$v=Ra.f,Me=Za.get,uo=Za.set,bc=y.ArrayBuffer,Ab=bc,cc=y.DataView,eh=cc&&cc.prototype,vo=Object.prototype,fh=y.RangeError,wo=function(o,e,d){var h,f=Array(d),g=(1<<(d=8*d-e-1))-1,A=g>>1,C=e===23?Ic(2,-24)-Ic(2,-77):0,k=0>o||o===0&&0>1/o?1:0,j=0;if((o=Vv(o))!=o||1/0===o){o=o!=o?1:0;var _t=g}else _t=Wv(Xv(o)/Yv),1>o*(h=Ic(2,-_t))&&(_t--,h*=2),2<=(o=1<=_t+A?o+C/h:o+C*Ic(2,1-A))*h&&(_t++,h/=2),_t+A>=g?(o=0,_t=g):1<=_t+A?(o=(o*h-1)*Ic(2,e),_t+=A):(o=o*Ic(2,A-1)*Ic(2,e),_t=0);for(;8<=e;f[j++]=255&o,o/=256,e-=8);for(_t=_t<<e|o,d+=e;0<d;f[j++]=255&_t,_t/=256,d-=8);return f[--j]|=128*k,f},xo=function(o,e){var d=o.length,h=8*d-e-1,f=(1<<h)-1,g=f>>1;h-=7,--d;var A=o[d--],C=127&A;for(A>>=7;0<h;C=256*C+o[d],d--,h-=8);var k=C&(1<<-h)-1;for(C>>=-h,h+=e;0<h;k=256*k+o[d],d--,h-=8);if(C===0)C=1-g;else{if(C===f)return k?NaN:A?-1/0:1/0;k+=Ic(2,e),C-=g}return(A?-1:1)*k*Ic(2,C-e)},yo=function(o){return[255&o]},zo=function(o){return[255&o,o>>8&255]},Ao=function(o){return[255&o,o>>8&255,o>>16&255,o>>24&255]},Bo=function(o){return o[3]<<24|o[2]<<16|o[1]<<8|o[0]},aw=function(o){return wo(o,23,4)},bw=function(o){return wo(o,52,8)},gh=function(o,e){$v(o.prototype,e,{get:function(){return Me(this)[e]}})},md=function(o,e,d,h){d=Le(d);var f=Me(o);if(d+e>f.byteLength)throw fh("Wrong index");return o=Me(f.buffer).bytes,d+=f.byteOffset,e=o.slice(d,d+e),h?e:e.reverse()},nd=function(o,e,d,h,f,g){d=Le(d);var A=Me(o);if(d+e>A.byteLength)throw fh("Wrong index");for(o=Me(A.buffer).bytes,d+=A.byteOffset,h=h(+f),f=0;f<e;f++)o[d+f]=h[g?f:e-f-1]};if(to){if(!R(function(){bc(1)})||!R(function(){new bc(-1)})||R(function(){return new bc,new bc(1.5),new bc(NaN),bc.name!="ArrayBuffer"})){Ab=function(o){return Gc(this,Ab),new bc(Le(o))};for(var cw=Ab.prototype=bc.prototype,Co=Zv(bc),Do=0,zj;Co.length>Do;)(zj=Co[Do++])in Ab||Na(Ab,zj,bc[zj]);cw.constructor=Ab}Ua&&Vb(eh)!==vo&&Ua(eh,vo);var hh=new cc(new Ab(2)),Eo=eh.setInt8;hh.setInt8(0,2147483648),hh.setInt8(1,2147483649),!hh.getInt8(0)&&hh.getInt8(1)||Hf(eh,{setInt8:function(o,e){Eo.call(this,o,e<<24>>24)},setUint8:function(o,e){Eo.call(this,o,e<<24>>24)}},{unsafe:!0})}else Ab=function(o){Gc(this,Ab,"ArrayBuffer"),o=Le(o),uo(this,{bytes:yj.call(Array(o),0),byteLength:o}),ka||(this.byteLength=o)},cc=function(o,e,d){Gc(this,cc,"DataView"),Gc(o,Ab,"DataView");var h=Me(o).byteLength;if(0>(e=$b(e))||e>h)throw fh("Wrong offset");if(e+(d=d===void 0?h-e:ta(d))>h)throw fh("Wrong length");uo(this,{buffer:o,byteLength:d,byteOffset:e}),ka||(this.buffer=o,this.byteLength=d,this.byteOffset=e)},ka&&(gh(Ab,"byteLength"),gh(cc,"buffer"),gh(cc,"byteLength"),gh(cc,"byteOffset")),Hf(cc.prototype,{getInt8:function(o){return md(this,1,o)[0]<<24>>24},getUint8:function(o){return md(this,1,o)[0]},getInt16:function(o){var e=md(this,2,o,1<arguments.length?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(o){var e=md(this,2,o,1<arguments.length?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(o){return Bo(md(this,4,o,1<arguments.length?arguments[1]:void 0))},getUint32:function(o){return Bo(md(this,4,o,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(o){return xo(md(this,4,o,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(o){return xo(md(this,8,o,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(o,e){nd(this,1,o,yo,e)},setUint8:function(o,e){nd(this,1,o,yo,e)},setInt16:function(o,e){nd(this,2,o,zo,e,2<arguments.length?arguments[2]:void 0)},setUint16:function(o,e){nd(this,2,o,zo,e,2<arguments.length?arguments[2]:void 0)},setInt32:function(o,e){nd(this,4,o,Ao,e,2<arguments.length?arguments[2]:void 0)},setUint32:function(o,e){nd(this,4,o,Ao,e,2<arguments.length?arguments[2]:void 0)},setFloat32:function(o,e){nd(this,4,o,aw,e,2<arguments.length?arguments[2]:void 0)},setFloat64:function(o,e){nd(this,8,o,bw,e,2<arguments.length?arguments[2]:void 0)}});Ec(Ab,"ArrayBuffer"),Ec(cc,"DataView");var Pf={ArrayBuffer:Ab,DataView:cc},Aj=Pf.ArrayBuffer,Fo=Pf.DataView,Go=Aj.prototype.slice,dw=R(function(){return!new Aj(2).slice(1,void 0).byteLength});N({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:dw},{slice:function(o,e){if(Go!==void 0&&e===void 0)return Go.call(va(this),o);var d=va(this).byteLength;o=xb(o,d),e=xb(e===void 0?d:e,d),d=new(kd(this,Aj))(ta(e-o));for(var h=new Fo(this),f=new Fo(d),g=0;o<e;)f.setUint8(g++,h.getUint8(o++));return d}});var ew=Ra.f,ih=y.Int8Array,Bj=ih&&ih.prototype,Ho=y.Uint8ClampedArray,Io=Ho&&Ho.prototype,qc=ih&&Vb(ih),dc=Bj&&Vb(Bj),Jo=Object.prototype,Ko=Jo.isPrototypeOf,Lo=qa("toStringTag"),Cj=Ae("TYPED_ARRAY_TAG"),Jc=to&&!!Ua&&Ff(y.opera)!=="Opera",Mo=!1,Bb,rc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},fw={BigInt64Array:8,BigUint64Array:8},jh=function(o){return!!ha(o)&&(o=Ff(o),Q(rc,o)||Q(fw,o))};for(Bb in rc)y[Bb]||(Jc=!1);if((!Jc||typeof qc!="function"||qc===Function.prototype)&&(qc=function(){throw TypeError("Incorrect invocation")},Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb],qc);if((!Jc||!dc||dc===Jo)&&(dc=qc.prototype,Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb].prototype,dc);if(Jc&&Vb(Io)!==dc&&Ua(Io,dc),ka&&!Q(dc,Lo))for(Bb in Mo=!0,ew(dc,Lo,{get:function(){return ha(this)?this[Cj]:void 0}}),rc)y[Bb]&&Na(y[Bb],Cj,Bb);var Qf=Jc,No=Mo&&Cj,Da=function(o){if(jh(o))return o;throw TypeError("Target is not a typed array")},Ne=function(o){if(Ua){if(Ko.call(qc,o))return o}else for(var e in rc)if(Q(rc,Bb)){var d=y[e];if(d&&(o===d||Ko.call(d,o)))return o}throw TypeError("Target is not a typed array constructor")},Aa=function(o,e,d){if(ka){if(d)for(var h in rc){var f=y[h];if(f&&Q(f.prototype,o))try{delete f.prototype[o]}catch{}}dc[o]&&!d||Ta(dc,o,d?e:Jc&&Bj[o]||e)}},Oo=function(o,e,d){var h,f;if(ka){if(Ua){if(d){for(h in rc)if((f=y[h])&&Q(f,o))try{delete f[o]}catch{}}if(qc[o]&&!d)return;try{return Ta(qc,o,d?e:Jc&&qc[o]||e)}catch{}}for(h in rc)!(f=y[h])||f[o]&&!d||Ta(f,o,e)}},Po=qc,Rf=dc,gw=y.ArrayBuffer,Od=y.Int8Array,Dj=!Qf||!R(function(){Od(1)})||!R(function(){new Od(-1)})||!Tg(function(o){new Od,new Od(null),new Od(1.5),new Od(o)},!0)||R(function(){return new Od(new gw(2),1,void 0).length!==1}),kh=function(o,e){if(0>(o=$b(o)))throw RangeError("The argument can't be less than 0");if(o%e)throw RangeError("Wrong offset");return o},Ej=function(o){var e=Qa(o),d=arguments.length,h=1<d?arguments[1]:void 0,f=h!==void 0,g=Xi(e);if(g!=null&&!Vi(g)){var A=g.call(e),C=A.next;for(e=[];!(g=C.call(A)).done;)e.push(g.value)}for(f&&2<d&&(h=Id(h,arguments[2],2)),g=ta(e.length),A=new(Ne(this))(g),d=0;g>d;d++)A[d]=f?h(e[d],d):e[d];return A},lh=function(o,e,d){var h,f;return Ua&&typeof(h=e.constructor)=="function"&&h!==d&&ha(f=h.prototype)&&f!==d.prototype&&Ua(o,f),o},Sf=$a(function(o){var e=Hd.f,d=Za.get,h=Za.set,f=Ra.f,g=Fb.f,A=Math.round,C=y.RangeError,k=Pf.ArrayBuffer,j=Pf.DataView,_t=function(_u,_d){var _l=0,nE=_d.length;for(_u=new(Ne(_u))(nE);nE>_l;)_u[_l]=_d[_l++];return _u},_n=function(_u,_d){f(_u,_d,{get:function(){return d(this)[_d]}})},ue=function(_u){var _d;return _u instanceof k||(_d=Ff(_u))=="ArrayBuffer"||_d=="SharedArrayBuffer"},Ei=function(_u,_d){return jh(_u)&&typeof _d!="symbol"&&_d in _u&&String(+_d)==String(_d)},_s=function(_u,_d){return Ei(_u,_d=lc(_d,!0))?dd(2,_u[_d]):g(_u,_d)},_c=function(_u,_d,_l){return!(Ei(_u,_d=lc(_d,!0))&&ha(_l)&&Q(_l,"value"))||Q(_l,"get")||Q(_l,"set")||_l.configurable||Q(_l,"writable")&&!_l.writable||Q(_l,"enumerable")&&!_l.enumerable?f(_u,_d,_l):(_u[_d]=_l.value,_u)};ka?(Qf||(Fb.f=_s,Ra.f=_c,_n(Rf,"buffer"),_n(Rf,"byteOffset"),_n(Rf,"byteLength"),_n(Rf,"length")),N({target:"Object",stat:!0,forced:!Qf},{getOwnPropertyDescriptor:_s,defineProperty:_c}),o.exports=function(_u,_d,_l){var nE=_u.match(/\d+$/)[0]/8,sE=_u+(_l?"Clamped":"")+"Array",vE="get"+_u,mE="set"+_u,yE=y[sE],BE=yE;_u=BE&&BE.prototype;var t_={},vf=function(fE,hE){f(fE,hE,{get:function(){var bE=d(this);return bE.view[vE](hE*nE+bE.byteOffset,!0)},set:function(bE){var _h=d(this);_l&&(bE=0>(bE=A(bE))?0:255<bE?255:255&bE),_h.view[mE](hE*nE+_h.byteOffset,bE,!0)},enumerable:!0})};Qf?Dj&&(BE=_d(function(fE,hE,bE,_h){return Gc(fE,BE,sE),lh(ha(hE)?ue(hE)?_h!==void 0?new yE(hE,kh(bE,nE),_h):bE!==void 0?new yE(hE,kh(bE,nE)):new yE(hE):jh(hE)?_t(BE,hE):Ej.call(BE,hE):new yE(Le(hE)),fE,BE)}),Ua&&Ua(BE,Po),Jd(e(yE),function(fE){fE in BE||Na(BE,fE,yE[fE])}),BE.prototype=_u):(BE=_d(function(fE,hE,bE,_h){Gc(fE,BE,sE);var tE=0,aE=0;if(ha(hE)){if(!ue(hE))return jh(hE)?_t(BE,hE):Ej.call(BE,hE);var TE=hE;if(aE=kh(bE,nE),hE=hE.byteLength,_h===void 0){if(hE%nE||0>(_h=hE-aE))throw C("Wrong length")}else if((_h=ta(_h)*nE)+aE>hE)throw C("Wrong length");hE=_h/nE}else hE=Le(hE),TE=new k(_h=hE*nE);for(h(fE,{buffer:TE,byteOffset:aE,byteLength:_h,length:hE,view:new j(TE)});tE<hE;)vf(fE,tE++)}),Ua&&Ua(BE,Po),_u=BE.prototype=ac(Rf)),_u.constructor!==BE&&Na(_u,"constructor",BE),No&&Na(_u,No,sE),t_[sE]=BE,N({global:!0,forced:BE!=yE,sham:!Qf},t_),"BYTES_PER_ELEMENT"in BE||Na(BE,"BYTES_PER_ELEMENT",nE),"BYTES_PER_ELEMENT"in _u||Na(_u,"BYTES_PER_ELEMENT",nE),If(sE)}):o.exports=function(){}});Sf("Uint8",function(o){return function(e,d,h){return o(this,e,d,h)}});var hw=Math.min,iw=[].copyWithin||function(o,e){var d=Qa(this),h=ta(d.length),f=xb(o,h),g=xb(e,h),A=2<arguments.length?arguments[2]:void 0;for(h=hw((A===void 0?h:xb(A,h))-g,h-f),A=1,g<f&&f<g+h&&(A=-1,g+=h-1,f+=h-1);0<h--;)g in d?d[f]=d[g]:delete d[f],f+=A,g+=A;return d};Aa("copyWithin",function(o,e){return iw.call(Da(this),o,e,2<arguments.length?arguments[2]:void 0)}),Aa("every",function(o){return Ju(Da(this),o,1<arguments.length?arguments[1]:void 0)}),Aa("fill",function(o){return yj.apply(Da(this),arguments)}),Aa("filter",function(o){var e=yn(Da(this),o,1<arguments.length?arguments[1]:void 0),d=kd(this,this.constructor),h=0,f=e.length;for(d=new(Ne(d))(f);f>h;)d[h]=e[h++];return d}),Aa("find",function(o){return zn(Da(this),o,1<arguments.length?arguments[1]:void 0)}),Aa("findIndex",function(o){return An(Da(this),o,1<arguments.length?arguments[1]:void 0)}),Aa("forEach",function(o){Jd(Da(this),o,1<arguments.length?arguments[1]:void 0)}),Aa("includes",function(o){return on(Da(this),o,1<arguments.length?arguments[1]:void 0)}),Aa("indexOf",function(o){return Si(Da(this),o,1<arguments.length?arguments[1]:void 0)});var Qo=qa("iterator"),Ro=y.Uint8Array,jw=ld.values,kw=ld.keys,lw=ld.entries,Fj=Ro&&Ro.prototype[Qo],So=!!Fj&&(Fj.name=="values"||Fj.name==null),To=function(){return jw.call(Da(this))};Aa("entries",function(){return lw.call(Da(this))}),Aa("keys",function(){return kw.call(Da(this))}),Aa("values",To,!So),Aa(Qo,To,!So);var mw=[].join;Aa("join",function(o){return mw.apply(Da(this),arguments)});var nw=Math.min,Gj=[].lastIndexOf,Uo=!!Gj&&0>1/[1].lastIndexOf(1,-0),ow=Ee("lastIndexOf"),pw=Uo||!ow?function(o){if(Uo)return Gj.apply(this,arguments)||0;var e=qb(this),d=ta(e.length),h=d-1;for(1<arguments.length&&(h=nw(h,$b(arguments[1]))),0>h&&(h=d+h);0<=h;h--)if(h in e&&e[h]===o)return h||0;return-1}:Gj;Aa("lastIndexOf",function(o){return pw.apply(Da(this),arguments)}),Aa("map",function(o){return xn(Da(this),o,1<arguments.length?arguments[1]:void 0,function(e,d){return new(Ne(kd(e,e.constructor)))(d)})});var Vo=function(o){return function(e,d,h,f){yb(d),e=Qa(e);var g=Af(e),A=ta(e.length),C=o?A-1:0,k=o?-1:1;if(2>h)for(;;){if(C in g){f=g[C],C+=k;break}if(C+=k,o?0>C:A<=C)throw TypeError("Reduce of empty array with no initial value")}for(;o?0<=C:A>C;C+=k)C in g&&(f=d(f,g[C],C,e));return f}},Wo=Vo(!1),qw=Vo(!0);Aa("reduce",function(o){return Wo(Da(this),o,arguments.length,1<arguments.length?arguments[1]:void 0)}),Aa("reduceRight",function(o){return qw(Da(this),o,arguments.length,1<arguments.length?arguments[1]:void 0)});var rw=Math.floor;Aa("reverse",function(){for(var o,e=Da(this).length,d=rw(e/2),h=0;h<d;)o=this[h],this[h++]=this[--e],this[e]=o;return this});var sw=R(function(){new Int8Array(1).set({})});Aa("set",function(o){Da(this);var e=kh(1<arguments.length?arguments[1]:void 0,1),d=this.length,h=Qa(o),f=ta(h.length),g=0;if(f+e>d)throw RangeError("Wrong length");for(;g<f;)this[e+g]=h[g++]},sw);var tw=[].slice,uw=R(function(){new Int8Array(1).slice()});Aa("slice",function(o,e){o=tw.call(Da(this),o,e);var d=kd(this,this.constructor);e=0;var h=o.length;for(d=new(Ne(d))(h);h>e;)d[e]=o[e++];return d},uw),Aa("some",function(o){return Iu(Da(this),o,1<arguments.length?arguments[1]:void 0)});var vw=[].sort;Aa("sort",function(o){return vw.call(Da(this),o)}),Aa("subarray",function(o,e){var d=Da(this),h=d.length;return o=xb(o,h),new(kd(d,d.constructor))(d.buffer,d.byteOffset+o*d.BYTES_PER_ELEMENT,ta((e===void 0?h:xb(e,h))-o))});var mh=y.Int8Array,Xo=[].toLocaleString,ww=[].slice,xw=!!mh&&R(function(){Xo.call(new mh(1))}),yw=R(function(){return[1,2].toLocaleString()!=new mh([1,2]).toLocaleString()})||!R(function(){mh.prototype.toLocaleString.call([1,2])});Aa("toLocaleString",function(){return Xo.apply(xw?ww.call(Da(this)):Da(this),arguments)},yw);var Yo=y.Uint8Array,zw=Yo&&Yo.prototype||{},nh=[].toString,Aw=[].join;R(function(){nh.call({})})&&(nh=function(){return Aw.call(this)}),Aa("toString",nh,zw.toString!=nh);var Zo=Pf.ArrayBuffer;N({global:!0,forced:y.ArrayBuffer!==Zo},{ArrayBuffer:Zo}),If("ArrayBuffer");var Bw=Ra.f,Hj=Function.prototype,Cw=Hj.toString,Dw=/^\s*function ([^ (]*)/;!ka||"name"in Hj||Bw(Hj,"name",{configurable:!0,get:function(){try{return Cw.call(this).match(Dw)[1]}catch{return""}}});var $o=RegExp.prototype,ap=$o.toString,Ew=R(function(){return ap.call({source:"a",flags:"b"})!="/a/b"}),Fw=ap.name!="toString";(Ew||Fw)&&Ta(RegExp.prototype,"toString",function(){var o=va(this),e=String(o.source),d=o.flags;return"/"+e+"/"+(o=String(d===void 0&&o instanceof RegExp&&!("flags"in $o)?tj.call(o):d))},{unsafe:!0});var Gw=Ef("splice"),Hw=Math.max,Iw=Math.min;N({target:"Array",proto:!0,forced:!Gw},{splice:function(o,e){var d,h,f=Qa(this),g=ta(f.length),A=xb(o,g),C=arguments.length;if(C===0?C=d=0:C===1?(C=0,d=g-A):(C-=2,d=Iw(Hw($b(e),0),g-A)),9007199254740991<g+C-d)throw TypeError("Maximum allowed length exceeded");var k=Sg(f,d);for(h=0;h<d;h++){var j=A+h;j in f&&Ge(k,h,f[j])}if(k.length=d,C<d){for(h=A;h<g-d;h++){var _t=h+C;(j=h+d)in f?f[_t]=f[j]:delete f[_t]}for(h=g;h>g-d+C;h--)delete f[h-1]}else if(C>d)for(h=g-d;h>A;h--)_t=h+C-1,(j=h+d-1)in f?f[_t]=f[j]:delete f[_t];for(h=0;h<C;h++)f[h+A]=arguments[h+2];return f.length=g-d+C,k}});var Ij={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Jj=qa("iterator"),bp=qa("toStringTag"),Kj=ld.values,oh;for(oh in Ij){var cp=y[oh],Kc=cp&&cp.prototype;if(Kc){if(Kc[Jj]!==Kj)try{Na(Kc,Jj,Kj)}catch{Kc[Jj]=Kj}if(Kc[bp]||Na(Kc,bp,oh),Ij[oh]){for(var Oe in ld)if(Kc[Oe]!==ld[Oe])try{Na(Kc,Oe,ld[Oe])}catch{Kc[Oe]=ld[Oe]}}}}var dp=Object.is||function(o,e){return o===e?o!==0||1/o==1/e:o!=o&&e!=e};dh("search",1,function(o,e,d){return[function(h){var f=jb(this),g=h==null?void 0:h[o];return g!==void 0?g.call(h,f):new RegExp(h)[o](String(f))},function(h){var f=d(e,h,this);if(f.done)return f.value;h=va(h);var g=String(this);return f=h.lastIndex,dp(f,0)||(h.lastIndex=0),g=Ke(h,g),dp(h.lastIndex,f)||(h.lastIndex=f),g===null?-1:g.index}]}),$a(function(o){(function(e,d){o.exports?o.exports=d(e):d(e)})(typeof self<"u"?self:Ya,function(e){function d(vf){return btoa(vf).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function h(vf){return vf=(vf+="===").slice(0,-vf.length%4),atob(vf.replace(/-/g,"+").replace(/_/g,"/"))}function f(vf){for(var fE=new Uint8Array(vf.length),hE=0;hE<vf.length;hE++)fE[hE]=vf.charCodeAt(hE);return fE}function g(vf){return vf instanceof ArrayBuffer&&(vf=new Uint8Array(vf)),String.fromCharCode.apply(String,vf)}function A(vf){var fE={name:(vf.name||vf||"").toUpperCase().replace("V","v")};switch(fE.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":vf.length&&(fE.length=vf.length);break;case"HMAC":vf.hash&&(fE.hash=A(vf.hash)),vf.length&&(fE.length=vf.length);break;case"RSAES-PKCS1-v1_5":vf.publicExponent&&(fE.publicExponent=new Uint8Array(vf.publicExponent)),vf.modulusLength&&(fE.modulusLength=vf.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":vf.hash&&(fE.hash=A(vf.hash)),vf.publicExponent&&(fE.publicExponent=new Uint8Array(vf.publicExponent)),vf.modulusLength&&(fE.modulusLength=vf.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return fE}function C(vf){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[vf.name][(vf.hash||{}).name||vf.length||""]}function k(vf){(vf instanceof ArrayBuffer||vf instanceof Uint8Array)&&(vf=JSON.parse(decodeURIComponent(escape(g(vf)))));var fE={kty:vf.kty,alg:vf.alg,ext:vf.ext||vf.extractable};switch(fE.kty){case"oct":fE.k=vf.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach(function(hE){hE in vf&&(fE[hE]=vf[hE])});break;default:throw new TypeError("Unsupported key type")}return fE}function j(vf){return vf=k(vf),vE&&(vf.extractable=vf.ext,delete vf.ext),f(unescape(encodeURIComponent(JSON.stringify(vf)))).buffer}function _t(vf){var fE=_n(vf),hE=!1;switch(2<fE.length&&(hE=!0,fE.shift()),vf={ext:!0},fE[0][0]){case"1.2.840.113549.1.1.1":var bE="n e d p q dp dq qi".split(" ");for(fE=_n(fE[1]),hE&&fE.shift(),hE=0;hE<fE.length;hE++)fE[hE][0]||(fE[hE]=fE[hE].subarray(1)),vf[bE[hE]]=d(g(fE[hE]));vf.kty="RSA";break;default:throw new TypeError("Unsupported key type")}return vf}function _n(vf,fE){if(vf instanceof ArrayBuffer&&(vf=new Uint8Array(vf)),fE||(fE={pos:0,end:vf.length}),2>fE.end-fE.pos||fE.end>vf.length)throw new RangeError("Malformed DER");var hE=vf[fE.pos++],bE=vf[fE.pos++];if(128<=bE){if(bE&=127,fE.end-fE.pos<bE)throw new RangeError("Malformed DER");for(var _h=0;bE--;)_h<<=8,_h|=vf[fE.pos++];bE=_h}if(fE.end-fE.pos<bE)throw new RangeError("Malformed DER");switch(hE){case 2:hE=vf.subarray(fE.pos,fE.pos+=bE);break;case 3:if(vf[fE.pos++])throw Error("Unsupported bit string");bE--;case 4:hE=new Uint8Array(vf.subarray(fE.pos,fE.pos+=bE)).buffer;break;case 5:hE=null;break;case 6:if(!((vf=btoa(g(vf.subarray(fE.pos,fE.pos+=bE))))in yE))throw Error("Unsupported OBJECT ID "+vf);hE=yE[vf];break;case 48:for(hE=[],bE=fE.pos+bE;fE.pos<bE;)hE.push(_n(vf,fE));break;default:throw Error("Unsupported DER tag 0x"+hE.toString(16))}return hE}function ue(vf,fE){fE||(fE=[]);var hE=fE.length+2;if(fE.push(0,0),vf instanceof Uint8Array)for(var bE=2,_h=vf.length,tE=0;tE<_h;tE++)fE.push(vf[tE]);else if(vf instanceof ArrayBuffer)for(bE=4,_h=vf.byteLength,vf=new Uint8Array(vf),tE=0;tE<_h;tE++)fE.push(vf[tE]);else if(vf===null)bE=5,_h=0;else if(typeof vf=="string"&&vf in BE)for(bE=6,_h=(vf=f(atob(BE[vf]))).length,tE=0;tE<_h;tE++)fE.push(vf[tE]);else if(vf instanceof Array){for(tE=0;tE<vf.length;tE++)ue(vf[tE],fE);bE=48,_h=fE.length-hE}else{if(!(X(vf)==="object"&&vf.tag===3&&vf.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+vf);for(bE=3,_h=(vf=new Uint8Array(vf.value)).byteLength,fE.push(0),tE=0;tE<_h;tE++)fE.push(vf[tE]);_h++}if(128<=_h){for(tE=_h,_h=4,fE.splice(hE,0,tE>>24&255,tE>>16&255,tE>>8&255,255&tE);1<_h&&!(tE>>24);)tE<<=8,_h--;4>_h&&fE.splice(hE,4-_h),_h|=128}return fE.splice(hE-2,2,bE,_h),fE}function Ei(vf,fE,hE,bE){Object.defineProperties(this,{_key:{value:vf},type:{value:vf.type,enumerable:!0},extractable:{value:hE===void 0?vf.extractable:hE,enumerable:!0},algorithm:{value:fE===void 0?vf.algorithm:fE,enumerable:!0},usages:{value:bE===void 0?vf.usages:bE,enumerable:!0}})}function _s(vf){return vf==="verify"||vf==="encrypt"||vf==="wrapKey"}function _c(vf){return vf==="sign"||vf==="decrypt"||vf==="unwrapKey"}if(typeof Promise!="function")throw"Promise support required";var _u=e.crypto||e.msCrypto;if(_u){var _d=_u.subtle||_u.webkitSubtle;if(_d){var _l=e.Crypto||_u.constructor||Object,nE=e.SubtleCrypto||_d.constructor||Object;e.CryptoKey||e.Key;var sE=-1<e.navigator.userAgent.indexOf("Edge/"),vE=!!e.msCrypto&&!sE,mE=!_u.subtle&&!!_u.webkitSubtle;if(vE||mE){var yE={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},BE={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach(function(vf){var fE=_d[vf];_d[vf]=function(hE,bE,_h){var tE=[].slice.call(arguments);switch(vf){case"generateKey":var aE=A(hE),TE=bE,OE=_h;break;case"importKey":aE=A(_h),TE=tE[3],OE=tE[4],hE==="jwk"&&((bE=k(bE)).alg||(bE.alg=C(aE)),bE.key_ops||(bE.key_ops=bE.kty!=="oct"?"d"in bE?OE.filter(_c):OE.filter(_s):OE.slice()),tE[1]=j(bE));break;case"unwrapKey":aE=tE[4],TE=tE[5],OE=tE[6],tE[2]=_h._key}if(vf==="generateKey"&&aE.name==="HMAC"&&aE.hash)return aE.length=aE.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[aE.hash.name],_d.importKey("raw",_u.getRandomValues(new Uint8Array(aE.length+7>>3)),aE,TE,OE);if(mE&&vf==="generateKey"&&aE.name==="RSASSA-PKCS1-v1_5"&&(!aE.modulusLength||2048<=aE.modulusLength))return(hE=A(hE)).name="RSAES-PKCS1-v1_5",delete hE.hash,_d.generateKey(hE,!0,["encrypt","decrypt"]).then(function(NE){return Promise.all([_d.exportKey("jwk",NE.publicKey),_d.exportKey("jwk",NE.privateKey)])}).then(function(NE){return NE[0].alg=NE[1].alg=C(aE),NE[0].key_ops=OE.filter(_s),NE[1].key_ops=OE.filter(_c),Promise.all([_d.importKey("jwk",NE[0],aE,!0,NE[0].key_ops),_d.importKey("jwk",NE[1],aE,TE,NE[1].key_ops)])}).then(function(NE){return{publicKey:NE[0],privateKey:NE[1]}});if((mE||vE&&(aE.hash||{}).name==="SHA-1")&&vf==="importKey"&&hE==="jwk"&&aE.name==="HMAC"&&bE.kty==="oct")return _d.importKey("raw",f(h(bE.k)),_h,tE[3],tE[4]);if(mE&&vf==="importKey"&&(hE==="spki"||hE==="pkcs8"))return _d.importKey("jwk",_t(bE),_h,tE[3],tE[4]);if(vE&&vf==="unwrapKey")return _d.decrypt(tE[3],_h,bE).then(function(NE){return _d.importKey(hE,NE,tE[4],tE[5],tE[6])});try{var e_=fE.apply(_d,tE)}catch(NE){return Promise.reject(NE)}return vE&&(e_=new Promise(function(NE,y_){e_.onabort=e_.onerror=function(YE){y_(YE)},e_.oncomplete=function(YE){NE(YE.target.result)}})),e_=e_.then(function(NE){return aE.name!=="HMAC"||aE.length||(aE.length=8*NE.algorithm.length),aE.name.search("RSA")==0&&(aE.modulusLength||(aE.modulusLength=(NE.publicKey||NE).algorithm.modulusLength),aE.publicExponent||(aE.publicExponent=(NE.publicKey||NE).algorithm.publicExponent)),NE.publicKey&&NE.privateKey?{publicKey:new Ei(NE.publicKey,aE,TE,OE.filter(_s)),privateKey:new Ei(NE.privateKey,aE,TE,OE.filter(_c))}:new Ei(NE,aE,TE,OE)})}}),["exportKey","wrapKey"].forEach(function(vf){var fE=_d[vf];_d[vf]=function(hE,bE,_h){var tE=[].slice.call(arguments);switch(vf){case"exportKey":tE[1]=bE._key;break;case"wrapKey":tE[1]=bE._key,tE[2]=_h._key}if((mE||vE&&(bE.algorithm.hash||{}).name==="SHA-1")&&vf==="exportKey"&&hE==="jwk"&&bE.algorithm.name==="HMAC"&&(tE[0]="raw"),!mE||vf!=="exportKey"||hE!=="spki"&&hE!=="pkcs8"||(tE[0]="jwk"),vE&&vf==="wrapKey")return _d.exportKey(hE,bE).then(function(TE){return hE==="jwk"&&(TE=f(unescape(encodeURIComponent(JSON.stringify(k(TE)))))),_d.encrypt(tE[3],_h,TE)});try{var aE=fE.apply(_d,tE)}catch(TE){return Promise.reject(TE)}return vE&&(aE=new Promise(function(TE,OE){aE.onabort=aE.onerror=function(e_){OE(e_)},aE.oncomplete=function(e_){TE(e_.target.result)}})),vf==="exportKey"&&hE==="jwk"&&(aE=aE.then(function(TE){return(mE||vE&&(bE.algorithm.hash||{}).name==="SHA-1")&&bE.algorithm.name==="HMAC"?{kty:"oct",alg:C(bE.algorithm),key_ops:bE.usages.slice(),ext:!0,k:d(g(TE))}:((TE=k(TE)).alg||(TE.alg=C(bE.algorithm)),TE.key_ops||(TE.key_ops=bE.type==="public"?bE.usages.filter(_s):bE.type==="private"?bE.usages.filter(_c):bE.usages.slice()),TE)})),!mE||vf!=="exportKey"||hE!=="spki"&&hE!=="pkcs8"||(aE=aE.then(function(TE){var OE=[["",null]],e_=!1;switch((TE=k(TE)).kty){case"RSA":for(var NE="n e d p q dp dq qi".split(" "),y_=[],YE=0;YE<NE.length&&NE[YE]in TE;YE++){var H_=y_[YE]=f(h(TE[NE[YE]]));128&H_[0]&&(y_[YE]=new Uint8Array(H_.length+1),y_[YE].set(H_,1))}2<y_.length&&(e_=!0,y_.unshift(new Uint8Array([0]))),OE[0][0]="1.2.840.113549.1.1.1";break;default:throw new TypeError("Unsupported key type")}return OE.push(new Uint8Array(ue(y_)).buffer),e_?OE.unshift(new Uint8Array([0])):OE[1]={tag:3,value:OE[1]},new Uint8Array(ue(OE)).buffer})),aE}}),["encrypt","decrypt","sign","verify"].forEach(function(vf){var fE=_d[vf];_d[vf]=function(hE,bE,_h,tE){if(vE&&(!_h.byteLength||tE&&!tE.byteLength))throw Error("Empty input is not allowed");var aE=[].slice.call(arguments),TE=A(hE);if(!vE||vf!=="sign"&&vf!=="verify"||hE!=="RSASSA-PKCS1-v1_5"&&hE!=="HMAC"||(aE[0]={name:hE}),vE&&bE.algorithm.hash&&(aE[0].hash=aE[0].hash||bE.algorithm.hash),vE&&vf==="decrypt"&&TE.name==="AES-GCM"){var OE=hE.tagLength>>3;aE[2]=(_h.buffer||_h).slice(0,_h.byteLength-OE),hE.tag=(_h.buffer||_h).slice(_h.byteLength-OE)}vE&&TE.name==="AES-GCM"&&aE[0].tagLength===void 0&&(aE[0].tagLength=128),aE[1]=bE._key;try{var e_=fE.apply(_d,aE)}catch(NE){return Promise.reject(NE)}return vE&&(e_=new Promise(function(NE,y_){e_.onabort=e_.onerror=function(YE){y_(YE)},e_.oncomplete=function(YE){if(YE=YE.target.result,vf==="encrypt"&&YE instanceof AesGcmEncryptResult){var H_=YE.ciphertext,FS=YE.tag;(YE=new Uint8Array(H_.byteLength+FS.byteLength)).set(new Uint8Array(H_),0),YE.set(new Uint8Array(FS),H_.byteLength),YE=YE.buffer}NE(YE)}})),e_}}),vE){var t_=_d.digest;_d.digest=function(vf,fE){if(!fE.byteLength)throw Error("Empty input is not allowed");try{var hE=t_.call(_d,vf,fE)}catch(bE){return Promise.reject(bE)}return hE=new Promise(function(bE,_h){hE.onabort=hE.onerror=function(tE){_h(tE)},hE.oncomplete=function(tE){bE(tE.target.result)}})},e.crypto=Object.create(_u,{getRandomValues:{value:function(vf){return _u.getRandomValues(vf)}},subtle:{value:_d}}),e.CryptoKey=Ei}mE&&(_u.subtle=_d,e.Crypto=_l,e.SubtleCrypto=nE,e.CryptoKey=Ei)}}}})});var Jw=qa("match"),Lj=function(o){var e;return ha(o)&&((e=o[Jw])!==void 0?!!e:Zb(o)=="RegExp")},Kw=[].push,Lw=Math.min;dh("split",2,function(o,e,d){var h="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||1<".".split(/()()/).length||"".split(/.?/).length?function(f,g){var A=String(jb(this));if((g=g===void 0?4294967295:g>>>0)===0)return[];if(f===void 0)return[A];if(!Lj(f))return e.call(A,f,g);var C,k,j,_t=[],_n=0;for(f=new RegExp(f.source,(f.ignoreCase?"i":"")+(f.multiline?"m":"")+(f.unicode?"u":"")+(f.sticky?"y":"")+"g");(C=Of.call(f,A))&&!((k=f.lastIndex)>_n&&(_t.push(A.slice(_n,C.index)),1<C.length&&C.index<A.length&&Kw.apply(_t,C.slice(1)),j=C[0].length,_n=k,_t.length>=g));)f.lastIndex===C.index&&f.lastIndex++;return _n===A.length?(j||!f.test(""))&&_t.push(""):_t.push(A.slice(_n)),_t.length>g?_t.slice(0,g):_t}:"0".split(void 0,0).length?function(f,g){return f===void 0&&g===0?[]:e.call(this,f,g)}:e;return[function(f,g){var A=jb(this),C=f==null?void 0:f[o];return C!==void 0?C.call(f,A,g):h.call(String(A),f,g)},function(f,g){var A=d(h,f,this,g,h!==e);if(A.done)return A.value;var C=va(f);f=String(this);var k=kd(C,RegExp);if(A=C.unicode,C=new k(pc?"^(?:"+C.source+")":C,(C.ignoreCase?"i":"")+(C.multiline?"m":"")+(C.unicode?"u":"")+(pc?"g":"y")),(g=g===void 0?4294967295:g>>>0)===0)return[];if(f.length===0)return Ke(C,f)===null?[f]:[];var j=0,_t=0;for(k=[];_t<f.length;){C.lastIndex=pc?0:_t;var _n,ue=Ke(C,pc?f.slice(_t):f);if(ue===null||(_n=Lw(ta(C.lastIndex+(pc?_t:0)),f.length))===j)_t=xj(f,_t,A);else{if(k.push(f.slice(j,_t)),k.length===g)return k;for(j=1;j<=ue.length-1;j++)if(k.push(ue[j]),k.length===g)return k;_t=j=_n}}return k.push(f.slice(j)),k}]},pc),function(o){o.console||(o.console={}),o=o.console;for(var e,d=function(){},h=["memory"],f="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");e=h.pop();)o[e]||(o[e]={});for(;e=f.pop();)o[e]||(o[e]=d)}(typeof window>"u"?Ya:window),N({target:"Object",stat:!0},{setPrototypeOf:Ua});var Mw=R(function(){Vb(1)});N({target:"Object",stat:!0,forced:Mw,sham:!Hn},{getPrototypeOf:function(o){return Vb(Qa(o))}});var ep=[].slice,Mj={},Nw=Function.bind||function(o){var e=yb(this),d=ep.call(arguments,1),h=function(){var f=d.concat(ep.call(arguments));if(this instanceof h){var g=f.length;if(!(g in Mj)){for(var A=[],C=0;C<g;C++)A[C]="a["+C+"]";Mj[g]=Function("C,a","return new C("+A.join(",")+")")}f=Mj[g](e,f)}else f=e.apply(o,f);return f};return ha(e.prototype)&&(h.prototype=e.prototype),h},Nj=mc("Reflect","construct"),fp=R(function(){function o(){}return!(Nj(function(){},[],o)instanceof o)}),gp=!R(function(){Nj(function(){})}),hp=fp||gp;N({target:"Reflect",stat:!0,forced:hp,sham:hp},{construct:function(o,e){yb(o),va(e);var d=3>arguments.length?o:yb(arguments[2]);if(gp&&!fp)return Nj(o,e,d);if(o==d){switch(e.length){case 0:return new o;case 1:return new o(e[0]);case 2:return new o(e[0],e[1]);case 3:return new o(e[0],e[1],e[2]);case 4:return new o(e[0],e[1],e[2],e[3])}return(d=[null]).push.apply(d,e),new(Nw.apply(o,d))}d=d.prototype,d=ac(ha(d)?d:Object.prototype);var h=Function.apply.call(o,d,e);return ha(h)?h:d}}),N({target:"Reflect",stat:!0},{get:wl});var ip=Fb.f,Ow=R(function(){ip(1)});N({target:"Object",stat:!0,forced:!ka||Ow,sham:!ka},{getOwnPropertyDescriptor:function(o,e){return ip(qb(o),e)}});var jp=Hd.f,Pw={}.toString,kp=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Oj=function(o){if(kp&&Pw.call(o)=="[object Window]")try{var e=jp(o)}catch{e=kp.slice()}else e=jp(qb(o));return e},lp={f:qa},Qw=Ra.f,ph=function(o){var e=y.Symbol||(y.Symbol={});Q(e,o)||Qw(e,o,{value:lp.f(o)})},rb=Pg("hidden"),mp=qa("toPrimitive"),Rw=Za.set,np=Za.getterFor("Symbol"),Ob=Object.prototype,sb=y.Symbol,Tf=mc("JSON","stringify"),op=Fb.f,od=Ra.f,pp=Oj,Sw=zf,Lc=fd("symbols"),Uf=fd("op-symbols"),Pj=fd("string-to-symbol-registry"),Qj=fd("symbol-to-string-registry"),Tw=fd("wks"),Rj=y.QObject,Sj=!Rj||!Rj.prototype||!Rj.prototype.findChild,Tj=ka&&R(function(){return ac(od({},"a",{get:function(){return od(this,"a",{value:7}).a}})).a!=7})?function(o,e,d){var h=op(Ob,e);h&&delete Ob[e],od(o,e,d),h&&o!==Ob&&od(Ob,e,h)}:od,Uj=function(o,e){var d=Lc[o]=ac(sb.prototype);return Rw(d,{type:"Symbol",tag:o,description:e}),ka||(d.description=e),d},Vj=vn?function(o){return typeof o=="symbol"}:function(o){return Object(o)instanceof sb},qh=function(o,e,d){return o===Ob&&qh(Uf,e,d),va(o),e=lc(e,!0),va(d),Q(Lc,e)?(d.enumerable?(Q(o,rb)&&o[rb][e]&&(o[rb][e]=!1),d=ac(d,{enumerable:dd(0,!1)})):(Q(o,rb)||od(o,rb,dd(1,{})),o[rb][e]=!0),Tj(o,e,d)):od(o,e,d)},qp=function(o,e){va(o);var d=qb(e);return e=Dc(d).concat(Wj(d)),Jd(e,function(h){ka&&!Xj.call(d,h)||qh(o,h,d[h])}),o},Xj=function(o){o=lc(o,!0);var e=Sw.call(this,o);return!(this===Ob&&Q(Lc,o)&&!Q(Uf,o))&&(!(e||!Q(this,o)||!Q(Lc,o)||Q(this,rb)&&this[rb][o])||e)},rp=function(o,e){if(o=qb(o),e=lc(e,!0),o!==Ob||!Q(Lc,e)||Q(Uf,e)){var d=op(o,e);return!d||!Q(Lc,e)||Q(o,rb)&&o[rb][e]||(d.enumerable=!0),d}},sp=function(o){o=pp(qb(o));var e=[];return Jd(o,function(d){Q(Lc,d)||Q(Be,d)||e.push(d)}),e},Wj=function(o){var e=o===Ob;o=pp(e?Uf:qb(o));var d=[];return Jd(o,function(h){!Q(Lc,h)||e&&!Q(Ob,h)||d.push(Lc[h])}),d};if(oc||(sb=function(){if(this instanceof sb)throw TypeError("Symbol is not a constructor");var o=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,e=Ae(o),d=function(h){this===Ob&&d.call(Uf,h),Q(this,rb)&&Q(this[rb],e)&&(this[rb][e]=!1),Tj(this,e,dd(1,h))};return ka&&Sj&&Tj(Ob,e,{configurable:!0,set:d}),Uj(e,o)},Ta(sb.prototype,"toString",function(){return np(this).tag}),Ta(sb,"withoutSetter",function(o){return Uj(Ae(o),o)}),zf=Xj,Ra.f=qh,Fb.f=rp,Hd.f=Oj=sp,Bf.f=Wj,lp.f=function(o){return Uj(qa(o),o)},ka&&(od(sb.prototype,"description",{configurable:!0,get:function(){return np(this).description}}),Ta(Ob,"propertyIsEnumerable",Xj,{unsafe:!0}))),N({global:!0,wrap:!0,forced:!oc,sham:!oc},{Symbol:sb}),Jd(Dc(Tw),function(o){ph(o)}),N({target:"Symbol",stat:!0,forced:!oc},{for:function(o){if(o=String(o),Q(Pj,o))return Pj[o];var e=sb(o);return Pj[o]=e,Qj[e]=o,e},keyFor:function(o){if(!Vj(o))throw TypeError(o+" is not a symbol");if(Q(Qj,o))return Qj[o]},useSetter:function(){Sj=!0},useSimple:function(){Sj=!1}}),N({target:"Object",stat:!0,forced:!oc,sham:!ka},{create:function(o,e){return e===void 0?ac(o):qp(ac(o),e)},defineProperty:qh,defineProperties:qp,getOwnPropertyDescriptor:rp}),N({target:"Object",stat:!0,forced:!oc},{getOwnPropertyNames:sp,getOwnPropertySymbols:Wj}),N({target:"Object",stat:!0,forced:R(function(){Bf.f(1)})},{getOwnPropertySymbols:function(o){return Bf.f(Qa(o))}}),Tf){var Uw=!oc||R(function(){var o=sb();return Tf([o])!="[null]"||Tf({a:o})!="{}"||Tf(Object(o))!="{}"});N({target:"JSON",stat:!0,forced:Uw},{stringify:function(o,e,d){for(var h,f=[o],g=1;arguments.length>g;)f.push(arguments[g++]);if(h=e,(ha(e)||o!==void 0)&&!Vj(o))return gd(e)||(e=function(A,C){if(typeof h=="function"&&(C=h.call(this,A,C)),!Vj(C))return C}),f[1]=e,Tf.apply(null,f)}})}sb.prototype[mp]||Na(sb.prototype,mp,sb.prototype.valueOf),Ec(sb,"Symbol"),Be[rb]=!0;var Vw=Ra.f,Mc=y.Symbol;if(ka&&typeof Mc=="function"&&(!("description"in Mc.prototype)||Mc().description!==void 0)){var tp={},Vf=function(){var o=1>arguments.length||arguments[0]===void 0?void 0:String(arguments[0]),e=this instanceof Vf?new Mc(o):o===void 0?Mc():Mc(o);return o===""&&(tp[e]=!0),e};rn(Vf,Mc);var Yj=Vf.prototype=Mc.prototype;Yj.constructor=Vf;var Ww=Yj.toString,Xw=String(Mc("test"))=="Symbol(test)",Yw=/^Symbol\((.*)\)[^)]+$/;Vw(Yj,"description",{configurable:!0,get:function(){var o=ha(this)?this.valueOf():this,e=Ww.call(o);return Q(tp,o)?"":(o=Xw?e.slice(7,-1):e.replace(Yw,"$1"))===""?void 0:o}}),N({global:!0,forced:!0},{Symbol:Vf})}ph("toStringTag"),Ec(y.JSON,"JSON",!0),Ec(Math,"Math",!0),function(){function o(ue,Ei){if(!(ue instanceof Ei))throw new TypeError("Cannot call a class as a function")}function e(ue,Ei){for(var _s=0;_s<Ei.length;_s++){var _c=Ei[_s];_c.enumerable=_c.enumerable||!1,_c.configurable=!0,"value"in _c&&(_c.writable=!0),Object.defineProperty(ue,_c.key,_c)}}function d(ue,Ei,_s){return Ei&&e(ue.prototype,Ei),_s&&e(ue,_s),ue}function h(ue,Ei){if(typeof Ei!="function"&&Ei!==null)throw new TypeError("Super expression must either be null or a function");ue.prototype=Object.create(Ei&&Ei.prototype,{constructor:{value:ue,writable:!0,configurable:!0}}),Ei&&g(ue,Ei)}function f(ue){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(Ei){return Ei.__proto__||Object.getPrototypeOf(Ei)})(ue)}function g(ue,Ei){return(g=Object.setPrototypeOf||function(_s,_c){return _s.__proto__=_c,_s})(ue,Ei)}function A(ue){if(ue===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ue}function C(ue){var Ei=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var _s=f(ue);if(Ei){var _c=f(this).constructor;_s=Reflect.construct(_s,arguments,_c)}else _s=_s.apply(this,arguments);return _s=!_s||X(_s)!=="object"&&typeof _s!="function"?A(this):_s}}function k(ue,Ei,_s){return(k=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(_c,_u,_d){for(;!Object.prototype.hasOwnProperty.call(_c,_u)&&(_c=f(_c))!==null;);if(_c)return(_u=Object.getOwnPropertyDescriptor(_c,_u)).get?_u.get.call(_d):_u.value})(ue,Ei,_s||ue)}var j=function(){function ue(){o(this,ue),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return d(ue,[{key:"addEventListener",value:function(Ei,_s,_c){Ei in this.listeners||(this.listeners[Ei]=[]),this.listeners[Ei].push({callback:_s,options:_c})}},{key:"removeEventListener",value:function(Ei,_s){if(Ei in this.listeners){for(var _c=0,_u=(Ei=this.listeners[Ei]).length;_c<_u;_c++)if(Ei[_c].callback===_s){Ei.splice(_c,1);break}}}},{key:"dispatchEvent",value:function(Ei){if(Ei.type in this.listeners){for(var _s=this.listeners[Ei.type].slice(),_c=0,_u=_s.length;_c<_u;_c++){var _d=_s[_c];try{_d.callback.call(this,Ei)}catch(_l){Promise.resolve().then(function(){throw _l})}_d.options&&_d.options.once&&this.removeEventListener(Ei.type,_d.callback)}return!Ei.defaultPrevented}}}]),ue}(),_t=function(ue){function Ei(){o(this,Ei);var _c=_s.call(this);return _c.listeners||j.call(A(_c)),Object.defineProperty(A(_c),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(A(_c),"onabort",{value:null,writable:!0,configurable:!0}),_c}h(Ei,ue);var _s=C(Ei);return d(Ei,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(_c){_c.type==="abort"&&(this.aborted=!0,typeof this.onabort=="function"&&this.onabort.call(this,_c)),k(f(Ei.prototype),"dispatchEvent",this).call(this,_c)}}]),Ei}(j),_n=function(){function ue(){o(this,ue),Object.defineProperty(this,"signal",{value:new _t,writable:!0,configurable:!0})}return d(ue,[{key:"abort",value:function(){try{var Ei=new Event("abort")}catch{typeof document<"u"?document.createEvent?(Ei=document.createEvent("Event")).initEvent("abort",!1,!1):(Ei=document.createEventObject()).type="abort":Ei={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(Ei)}},{key:"toString",value:function(){return"[object AbortController]"}}]),ue}();typeof Symbol<"u"&&Symbol.toStringTag&&(_n.prototype[Symbol.toStringTag]="AbortController",_t.prototype[Symbol.toStringTag]="AbortSignal"),function(ue){if(ue.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var Ei=!0}else Ei=typeof ue.Request=="function"&&!ue.Request.prototype.hasOwnProperty("signal")||!ue.AbortController;Ei&&(ue.AbortController=_n,ue.AbortSignal=_t)}(typeof self<"u"?self:Ya)}();var Zw=Math.floor,$w=Math.log,ax=Math.LOG2E;N({target:"Math",stat:!0},{clz32:function(o){return(o>>>=0)?31-Zw($w(o+.5)*ax):32}});var bx=Math.log,cx=Math.LN2,ss=Math.clz32||function(o){return 31-bx(o>>>0)/cx|0},xd=String.fromCharCode,up={}.toString,Zj=window.Uint8Array,ak=Zj||Array,dx=up.call((window.ArrayBuffer||ak).prototype),bk;xl.prototype.decode=function(o){if(o=o&&o.buffer||o,up.call(o)!==dx)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var e="",d=0,h=0|(o=Zj?new ak(o):o).length;d<h;d=d+32768|0)e+=xd.apply(0,o[Zj?"slice":"subarray"](d,d+32768|0));return e.replace(/[\xc0-\xff][\x80-\xbf]*/g,rs)},window.TextDecoder||(window.TextDecoder=xl),yl.prototype.encode=function(o){for(var e=0|(o=o===void 0?"":(""+o).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,ts)).length,d=new ak(e),h=0;h<e;h=h+1|0)d[h]=o.charCodeAt(h);return d},window.TextEncoder||(window.TextEncoder=yl),function(o){var e,d,h,f,g,A,C,k,j,_t,_n;(function(ue){ue.LOGIN="LOGIN",ue.LOGIN_SUCCESS="LOGIN_SUCCESS",ue.LOGIN_FAILURE="LOGIN_FAILURE",ue.LOGIN_TIMEOUT="LOGIN_TIMEOUT",ue.INTERRUPTED="INTERRUPTED",ue.LOGOUT="LOGOUT",ue.BANNED_BY_SERVER="BANNED_BY_SERVER",ue.REMOTE_LOGIN="REMOTE_LOGIN"})(e||(e={})),o.ConnectionChangeReason=e,function(ue){ue.DISCONNECTED="DISCONNECTED",ue.CONNECTING="CONNECTING",ue.CONNECTED="CONNECTED",ue.RECONNECTING="RECONNECTING",ue.ABORTED="ABORTED"}(d||(d={})),o.ConnectionState=d,function(ue){ue.IDLE="IDLE",ue.SENT_TO_REMOTE="SENT_TO_REMOTE",ue.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",ue.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",ue.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",ue.CANCELED="CANCELED",ue.FAILURE="FAILURE"}(h||(h={})),o.LocalInvitationState=h,function(ue){ue.INVITATION_RECEIVED="INVITATION_RECEIVED",ue.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",ue.REFUSED="REFUSED",ue.ACCEPTED="ACCEPTED",ue.CANCELED="CANCELED",ue.FAILURE="FAILURE"}(f||(f={})),o.RemoteInvitationState=f,function(ue){ue.UNKNOWN="UNKNOWN",ue.PEER_NO_RESPONSE="PEER_NO_RESPONSE",ue.INVITATION_EXPIRE="INVITATION_EXPIRE",ue.PEER_OFFLINE="PEER_OFFLINE",ue.NOT_LOGGEDIN="NOT_LOGGEDIN"}(g||(g={})),o.LocalInvitationFailureReason=g,function(ue){ue.UNKNOWN="UNKNOWN",ue.PEER_OFFLINE="PEER_OFFLINE",ue.ACCEPT_FAILURE="ACCEPT_FAILURE",ue.INVITATION_EXPIRE="INVITATION_EXPIRE"}(A||(A={})),o.RemoteInvitationFailureReason=A,function(ue){ue.ONLINE="ONLINE",ue.UNREACHABLE="UNREACHABLE",ue.OFFLINE="OFFLINE"}(C||(C={})),o.PeerOnlineState=C,(k||(k={})).ONLINE_STATUS="ONLINE_STATUS",o.PeerSubscriptionOption=k,function(ue){ue.TEXT="TEXT",ue.RAW="RAW",ue.IMAGE="IMAGE",ue.FILE="FILE"}(j||(j={})),o.MessageType=j,function(ue){ue.CN="CN",ue.NA="NA",ue.EU="EU",ue.AS="AS",ue.JP="JP",ue.IN="IN",ue.GLOB="GLOB",ue.OC="OC",ue.SA="SA",ue.AF="AF",ue.OVS="OVS"}(_t||(_t={})),o.LegacyAreaCode=_t,function(ue){ue.GLOBAL="GLOBAL",ue.INDIA="INDIA",ue.JAPAN="JAPAN",ue.ASIA="ASIA",ue.EUROPE="EUROPE",ue.CHINA="CHINA",ue.NORTH_AMERICA="NORTH_AMERICA"}(_n||(_n={})),o.AreaCode=_n}(bk||(bk={}));var S=bk;N({target:"Array",proto:!0},{includes:function(o){return on(this,o,1<arguments.length?arguments[1]:void 0)}}),Ld("includes");var ck=function(o){if(Lj(o))throw TypeError("The method doesn't accept regular expressions");return o},ex=qa("match"),dk=function(o){var e=/./;try{"/./"[o](e)}catch{try{return e[ex]=!1,"/./"[o](e)}catch{}}return!1};N({target:"String",proto:!0,forced:!dk("includes")},{includes:function(o){return!!~String(jb(this)).indexOf(ck(o),1<arguments.length?arguments[1]:void 0)}});var Nc={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0};ph("iterator"),ph("asyncIterator");var ek=Ee("forEach")?[].forEach:function(o){return Jd(this,o,1<arguments.length?arguments[1]:void 0)},vp;for(vp in Ij){var wp=y[vp],rh=wp&&wp.prototype;if(rh&&rh.forEach!==ek)try{Na(rh,"forEach",ek)}catch{rh.forEach=ek}}var fx=[].reverse,xp=[1,2];N({target:"Array",proto:!0,forced:String(xp)===String(xp.reverse())},{reverse:function(){return gd(this)&&(this.length=this.length),fx.call(this)}});var w=$a(function(o){o=function(e){function d(_h,tE,aE){return Object.defineProperty(_h,tE,{value:aE,enumerable:!0,configurable:!0,writable:!0}),_h[tE]}function h(_h,tE,aE,TE){return tE=Object.create((tE&&tE.prototype instanceof g?tE:g).prototype),TE=new Ei(TE||[]),tE._invoke=function(OE,e_,NE){var y_=yE;return function(YE,H_){if(y_===t_)throw Error("Generator is already running");if(y_===vf){if(YE==="throw")throw H_;return _c()}for(NE.method=YE,NE.arg=H_;;){if((YE=NE.delegate)&&(YE=_t(YE,NE))){if(YE===fE)continue;return YE}if(NE.method==="next")NE.sent=NE._sent=NE.arg;else if(NE.method==="throw"){if(y_===yE)throw y_=vf,NE.arg;NE.dispatchException(NE.arg)}else NE.method==="return"&&NE.abrupt("return",NE.arg);if(y_=t_,(YE=f(OE,e_,NE)).type==="normal"){if(y_=NE.done?vf:BE,YE.arg===fE)continue;return{value:YE.arg,done:NE.done}}YE.type==="throw"&&(y_=vf,NE.method="throw",NE.arg=YE.arg)}}}(_h,aE,TE),tE}function f(_h,tE,aE){try{return{type:"normal",arg:_h.call(tE,aE)}}catch(TE){return{type:"throw",arg:TE}}}function g(){}function A(){}function C(){}function k(_h){["next","throw","return"].forEach(function(tE){d(_h,tE,function(aE){return this._invoke(tE,aE)})})}function j(_h,tE){function aE(OE,e_,NE,y_){if((OE=f(_h[OE],_h,e_)).type!=="throw"){var YE=OE.arg;return(OE=YE.value)&&X(OE)==="object"&&_l.call(OE,"__await")?tE.resolve(OE.__await).then(function(H_){aE("next",H_,NE,y_)},function(H_){aE("throw",H_,NE,y_)}):tE.resolve(OE).then(function(H_){YE.value=H_,NE(YE)},function(H_){return aE("throw",H_,NE,y_)})}y_(OE.arg)}var TE;this._invoke=function(OE,e_){function NE(){return new tE(function(y_,YE){aE(OE,e_,y_,YE)})}return TE=TE?TE.then(NE,NE):NE()}}function _t(_h,tE){var aE=_h.iterator[tE.method];if(aE===_u){if(tE.delegate=null,tE.method==="throw"){if(_h.iterator.return&&(tE.method="return",tE.arg=_u,_t(_h,tE),tE.method==="throw"))return fE;tE.method="throw",tE.arg=new TypeError("The iterator does not provide a 'throw' method")}return fE}return(aE=f(aE,_h.iterator,tE.arg)).type==="throw"?(tE.method="throw",tE.arg=aE.arg,tE.delegate=null,fE):(aE=aE.arg)?aE.done?(tE[_h.resultName]=aE.value,tE.next=_h.nextLoc,tE.method!=="return"&&(tE.method="next",tE.arg=_u),tE.delegate=null,fE):aE:(tE.method="throw",tE.arg=new TypeError("iterator result is not an object"),tE.delegate=null,fE)}function _n(_h){var tE={tryLoc:_h[0]};1 in _h&&(tE.catchLoc=_h[1]),2 in _h&&(tE.finallyLoc=_h[2],tE.afterLoc=_h[3]),this.tryEntries.push(tE)}function ue(_h){var tE=_h.completion||{};tE.type="normal",delete tE.arg,_h.completion=tE}function Ei(_h){this.tryEntries=[{tryLoc:"root"}],_h.forEach(_n,this),this.reset(!0)}function _s(_h){if(_h){var tE=_h[sE];if(tE)return tE.call(_h);if(typeof _h.next=="function")return _h;if(!isNaN(_h.length)){var aE=-1;return(tE=function TE(){for(;++aE<_h.length;)if(_l.call(_h,aE))return TE.value=_h[aE],TE.done=!1,TE;return TE.value=_u,TE.done=!0,TE}).next=tE}}return{next:_c}}function _c(){return{value:_u,done:!0}}var _u,_d=Object.prototype,_l=_d.hasOwnProperty,nE=typeof Symbol=="function"?Symbol:{},sE=nE.iterator||"@@iterator",vE=nE.asyncIterator||"@@asyncIterator",mE=nE.toStringTag||"@@toStringTag";try{d({},"")}catch{d=function(tE,aE,TE){return tE[aE]=TE}}e.wrap=h;var yE="suspendedStart",BE="suspendedYield",t_="executing",vf="completed",fE={};d(nE={},sE,function(){return this});var hE=Object.getPrototypeOf;(hE=hE&&hE(hE(_s([]))))&&hE!==_d&&_l.call(hE,sE)&&(nE=hE);var bE=C.prototype=g.prototype=Object.create(nE);return A.prototype=C,d(bE,"constructor",C),d(C,"constructor",A),A.displayName=d(C,mE,"GeneratorFunction"),e.isGeneratorFunction=function(_h){return!!(_h=typeof _h=="function"&&_h.constructor)&&(_h===A||(_h.displayName||_h.name)==="GeneratorFunction")},e.mark=function(_h){return Object.setPrototypeOf?Object.setPrototypeOf(_h,C):(_h.__proto__=C,d(_h,mE,"GeneratorFunction")),_h.prototype=Object.create(bE),_h},e.awrap=function(_h){return{__await:_h}},k(j.prototype),d(j.prototype,vE,function(){return this}),e.AsyncIterator=j,e.async=function(_h,tE,aE,TE,OE){OE===void 0&&(OE=Promise);var e_=new j(h(_h,tE,aE,TE),OE);return e.isGeneratorFunction(tE)?e_:e_.next().then(function(NE){return NE.done?NE.value:e_.next()})},k(bE),d(bE,mE,"Generator"),d(bE,sE,function(){return this}),d(bE,"toString",function(){return"[object Generator]"}),e.keys=function(_h){var tE,aE=[];for(tE in _h)aE.push(tE);return aE.reverse(),function TE(){for(;aE.length;){var OE=aE.pop();if(OE in _h)return TE.value=OE,TE.done=!1,TE}return TE.done=!0,TE}},e.values=_s,Ei.prototype={constructor:Ei,reset:function(_h){if(this.next=this.prev=0,this.sent=this._sent=_u,this.done=!1,this.delegate=null,this.method="next",this.arg=_u,this.tryEntries.forEach(ue),!_h)for(var tE in this)tE.charAt(0)==="t"&&_l.call(this,tE)&&!isNaN(+tE.slice(1))&&(this[tE]=_u)},stop:function(){this.done=!0;var _h=this.tryEntries[0].completion;if(_h.type==="throw")throw _h.arg;return this.rval},dispatchException:function(_h){function tE(YE,H_){return e_.type="throw",e_.arg=_h,aE.next=YE,H_&&(aE.method="next",aE.arg=_u),!!H_}if(this.done)throw _h;for(var aE=this,TE=this.tryEntries.length-1;0<=TE;--TE){var OE=this.tryEntries[TE],e_=OE.completion;if(OE.tryLoc==="root")return tE("end");if(OE.tryLoc<=this.prev){var NE=_l.call(OE,"catchLoc"),y_=_l.call(OE,"finallyLoc");if(NE&&y_){if(this.prev<OE.catchLoc)return tE(OE.catchLoc,!0);if(this.prev<OE.finallyLoc)return tE(OE.finallyLoc)}else if(NE){if(this.prev<OE.catchLoc)return tE(OE.catchLoc,!0)}else{if(!y_)throw Error("try statement without catch or finally");if(this.prev<OE.finallyLoc)return tE(OE.finallyLoc)}}}},abrupt:function(_h,tE){for(var aE=this.tryEntries.length-1;0<=aE;--aE){var TE=this.tryEntries[aE];if(TE.tryLoc<=this.prev&&_l.call(TE,"finallyLoc")&&this.prev<TE.finallyLoc){var OE=TE;break}}return OE&&(_h==="break"||_h==="continue")&&OE.tryLoc<=tE&&tE<=OE.finallyLoc&&(OE=null),(aE=OE?OE.completion:{}).type=_h,aE.arg=tE,OE?(this.method="next",this.next=OE.finallyLoc,fE):this.complete(aE)},complete:function(_h,tE){if(_h.type==="throw")throw _h.arg;return _h.type==="break"||_h.type==="continue"?this.next=_h.arg:_h.type==="return"?(this.rval=this.arg=_h.arg,this.method="return",this.next="end"):_h.type==="normal"&&tE&&(this.next=tE),fE},finish:function(_h){for(var tE=this.tryEntries.length-1;0<=tE;--tE){var aE=this.tryEntries[tE];if(aE.finallyLoc===_h)return this.complete(aE.completion,aE.afterLoc),ue(aE),fE}},catch:function(_h){for(var tE=this.tryEntries.length-1;0<=tE;--tE){var aE=this.tryEntries[tE];if(aE.tryLoc===_h){if((_h=aE.completion).type==="throw"){var TE=_h.arg;ue(aE)}return TE}}throw Error("illegal catch attempt")},delegateYield:function(_h,tE,aE){return this.delegate={iterator:_s(_h),resultName:tE,nextLoc:aE},this.method==="next"&&(this.arg=_u),fE}},e}(o.exports);try{regeneratorRuntime=o}catch{(typeof globalThis>"u"?"undefined":X(globalThis))==="object"?globalThis.regeneratorRuntime=o:Function("r","regeneratorRuntime = r")(o)}}),yp=!R(function(){return Object.isExtensible(Object.preventExtensions({}))}),fk=$a(function(o){var e=Ra.f,d=Ae("meta"),h=0,f=Object.isExtensible||function(){return!0},g=function(C){e(C,d,{value:{objectID:"O"+ ++h,weakData:{}}})},A=o.exports={REQUIRED:!1,fastKey:function(C,k){if(!ha(C))return typeof C=="symbol"?C:(typeof C=="string"?"S":"P")+C;if(!Q(C,d)){if(!f(C))return"F";if(!k)return"E";g(C)}return C[d].objectID},getWeakData:function(C,k){if(!Q(C,d)){if(!f(C))return!0;if(!k)return!1;g(C)}return C[d].weakData},onFreeze:function(C){return yp&&A.REQUIRED&&f(C)&&!Q(C,d)&&g(C),C}};Be[d]=!0}),zp=function(o,e,d){var h=o.indexOf("Map")!==-1,f=o.indexOf("Weak")!==-1,g=h?"set":"add",A=y[o],C=A&&A.prototype,k=A,j={},_t=function(_u){var _d=C[_u];Ta(C,_u,_u=="add"?function(_l){return _d.call(this,_l===0?0:_l),this}:_u=="delete"?function(_l){return!(f&&!ha(_l))&&_d.call(this,_l===0?0:_l)}:_u=="get"?function(_l){return f&&!ha(_l)?void 0:_d.call(this,_l===0?0:_l)}:_u=="has"?function(_l){return!(f&&!ha(_l))&&_d.call(this,_l===0?0:_l)}:function(_l,nE){return _d.call(this,_l===0?0:_l,nE),this})};if(nc(o,typeof A!="function"||!(f||C.forEach&&!R(function(){new A().entries().next()}))))k=d.getConstructor(e,o,h,g),fk.REQUIRED=!0;else if(nc(o,!0)){var _n=new k,ue=_n[g](f?{}:-0,1)!=_n,Ei=R(function(){_n.has(1)}),_s=Tg(function(_u){new A(_u)}),_c=!f&&R(function(){for(var _u=new A,_d=5;_d--;)_u[g](_d,_d);return!_u.has(-0)});_s||((k=e(function(_u,_d){return Gc(_u,k,o),_u=lh(new A,_u,k),_d!=null&&Xg(_d,_u[g],{that:_u,AS_ENTRIES:h}),_u})).prototype=C,C.constructor=k),(Ei||_c)&&(_t("delete"),_t("has"),h&&_t("get")),(_c||ue)&&_t(g),f&&C.clear&&delete C.clear}return j[o]=k,N({global:!0,forced:k!=A},j),Ec(k,o),f||d.setStrong(k,o,h),k},gx=Ra.f,Ap=fk.fastKey,Bp=Za.set,gk=Za.getterFor,Cp={getConstructor:function(o,e,d,h){var f=o(function(k,j){Gc(k,f,e),Bp(k,{type:e,index:ac(null),first:void 0,last:void 0,size:0}),ka||(k.size=0),j!=null&&Xg(j,k[h],{that:k,AS_ENTRIES:d})}),g=gk(e),A=function(k,j,_t){var _n,ue=g(k),Ei=C(k,j);return Ei?Ei.value=_t:(ue.last=Ei={index:_n=Ap(j,!0),key:j,value:_t,previous:j=ue.last,next:void 0,removed:!1},ue.first||(ue.first=Ei),j&&(j.next=Ei),ka?ue.size++:k.size++,_n!=="F"&&(ue.index[_n]=Ei)),k},C=function(k,j){k=g(k);var _t=Ap(j);if(_t!=="F")return k.index[_t];for(k=k.first;k;k=k.next)if(k.key==j)return k};return Hf(f.prototype,{clear:function(){for(var k=g(this),j=k.index,_t=k.first;_t;)_t.removed=!0,_t.previous&&(_t.previous=_t.previous.next=void 0),delete j[_t.index],_t=_t.next;k.first=k.last=void 0,ka?k.size=0:this.size=0},delete:function(k){var j=g(this);if(k=C(this,k)){var _t=k.next,_n=k.previous;delete j.index[k.index],k.removed=!0,_n&&(_n.next=_t),_t&&(_t.previous=_n),j.first==k&&(j.first=_t),j.last==k&&(j.last=_n),ka?j.size--:this.size--}return!!k},forEach:function(k){for(var j,_t=g(this),_n=Id(k,1<arguments.length?arguments[1]:void 0,3);j=j?j.next:_t.first;)for(_n(j.value,j.key,this);j&&j.removed;)j=j.previous},has:function(k){return!!C(this,k)}}),Hf(f.prototype,d?{get:function(k){return(k=C(this,k))&&k.value},set:function(k,j){return A(this,k===0?0:k,j)}}:{add:function(k){return A(this,k=k===0?0:k,k)}}),ka&&gx(f.prototype,"size",{get:function(){return g(this).size}}),f},setStrong:function(o,e,d){var h=e+" Iterator",f=gk(e),g=gk(h);bj(o,e,function(A,C){Bp(this,{type:h,target:A,state:f(A),kind:C,last:void 0})},function(){for(var A=g(this),C=A.kind,k=A.last;k&&k.removed;)k=k.previous;return A.target&&(A.last=k=k?k.next:A.state.first)?C=="keys"?{value:k.key,done:!1}:C=="values"?{value:k.value,done:!1}:{value:[k.key,k.value],done:!1}:(A.target=void 0,{value:void 0,done:!0})},d?"entries":"values",!d,!0),If(e)}};zp("Set",function(o){return function(){return o(this,arguments.length?arguments[0]:void 0)}},Cp);var hx=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,ix=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,hk=function(o){return function(e){return e=String(jb(e)),1&o&&(e=e.replace(hx,"")),2&o&&(e=e.replace(ix,"")),e}},ik=hk(3),sh=y.parseInt,jx=/^[+-]?0[Xx]/,Dp=sh(`	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF08`)!==8||sh(`	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF0x16`)!==22?function(o,e){return o=ik(String(o)),sh(o,e>>>0||(jx.test(o)?16:10))}:sh;N({global:!0,forced:parseInt!=Dp},{parseInt:Dp});var kx=Hd.f,lx=Fb.f,mx=Ra.f,pd=y.Number,th=pd.prototype,nx=Zb(ac(th))=="Number",Ep=function(o){var e,d=lc(o,!1);if(typeof d=="string"&&2<d.length){if((o=(d=ik(d)).charCodeAt(0))===43||o===45){if((o=d.charCodeAt(2))===88||o===120)return NaN}else if(o===48){switch(d.charCodeAt(1)){case 66:case 98:o=2;var h=49;break;case 79:case 111:o=8,h=55;break;default:return+d}var f=(d=d.slice(2)).length;for(e=0;e<f;e++){var g=d.charCodeAt(e);if(48>g||g>h)return NaN}return parseInt(d,o)}}return+d};if(nc("Number",!pd(" 0o1")||!pd("0b1")||pd("+0x1"))){for(var Pd=function(o){var e=1>arguments.length?0:o,d=this;return d instanceof Pd&&(nx?R(function(){th.valueOf.call(d)}):Zb(d)!="Number")?lh(new pd(Ep(e)),d,Pd):Ep(e)},Fp=ka?kx(pd):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),jk=0,uh;Fp.length>jk;jk++)Q(pd,uh=Fp[jk])&&!Q(Pd,uh)&&mx(Pd,uh,lx(pd,uh));Pd.prototype=th,th.constructor=Pd,Ta(y,"Number",Pd)}var Gp=qa("isConcatSpreadable"),ox=51<=id||!R(function(){var o=[];return o[Gp]=!1,o.concat()[0]!==o}),px=Ef("concat");N({target:"Array",proto:!0,forced:!ox||!px},{concat:function(o){var e,d=Qa(this),h=Sg(d,0),f=0,g=-1;for(e=arguments.length;g<e;g++){var A=g===-1?d:arguments[g],C=A;if(ha(C)){var k=C[Gp];C=k!==void 0?!!k:gd(C)}else C=!1;if(C){if(9007199254740991<f+(k=ta(A.length)))throw TypeError("Maximum allowed index exceeded");for(C=0;C<k;C++,f++)C in A&&Ge(h,f,A[C])}else{if(9007199254740991<=f)throw TypeError("Maximum allowed index exceeded");Ge(h,f++,A)}}return h.length=f,h}});var kk=mc("Reflect","apply"),qx=Function.apply,rx=!R(function(){kk(function(){})});N({target:"Reflect",stat:!0,forced:rx},{apply:function(o,e,d){return yb(o),va(d),kk?kk(o,e,d):qx.call(o,e,d)}}),N({target:"Reflect",stat:!0},{ownKeys:qn});var sx=Oj,tx=R(function(){return!Object.getOwnPropertyNames(1)});N({target:"Object",stat:!0,forced:tx},{getOwnPropertyNames:sx});var Pe=(typeof Reflect>"u"?"undefined":X(Reflect))==="object"?Reflect:null,Hp=Pe&&typeof Pe.apply=="function"?Pe.apply:function(o,e,d){return Function.prototype.apply.call(o,e,d)},ux=Pe&&typeof Pe.ownKeys=="function"?Pe.ownKeys:Object.getOwnPropertySymbols?function(o){return Object.getOwnPropertyNames(o).concat(Object.getOwnPropertySymbols(o))}:function(o){return Object.getOwnPropertyNames(o)},Ip=Number.isNaN||function(o){return o!=o};ea.EventEmitter=ea,ea.prototype._events=void 0,ea.prototype._eventsCount=0,ea.prototype._maxListeners=void 0;var Jp=10;Object.defineProperty(ea,"defaultMaxListeners",{enumerable:!0,get:function(){return Jp},set:function(o){if(typeof o!="number"||0>o||Ip(o))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+o+".");Jp=o}}),ea.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ea.prototype.setMaxListeners=function(o){if(typeof o!="number"||0>o||Ip(o))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+o+".");return this._maxListeners=o,this},ea.prototype.getMaxListeners=function(){return this._maxListeners===void 0?ea.defaultMaxListeners:this._maxListeners},ea.prototype.emit=function(o){for(var e=[],d=1;d<arguments.length;d++)e.push(arguments[d]);d=o==="error";var h=this._events;if(h!==void 0)d=d&&h.error===void 0;else if(!d)return!1;if(d){var f;throw 0<e.length&&(f=e[0]),f instanceof Error?f:((e=Error("Unhandled error."+(f?" ("+f.message+")":""))).context=f,e)}if((d=h[o])===void 0)return!1;if(typeof d=="function")Hp(d,this,e);else for(h=Cl(d,f=d.length),d=0;d<f;++d)Hp(h[d],this,e);return!0},ea.prototype.addListener=function(o,e){return zl(this,o,e,!1)},ea.prototype.on=ea.prototype.addListener,ea.prototype.prependListener=function(o,e){return zl(this,o,e,!0)},ea.prototype.once=function(o,e){return ng(e),this.on(o,Al(this,o,e)),this},ea.prototype.prependOnceListener=function(o,e){return ng(e),this.prependListener(o,Al(this,o,e)),this},ea.prototype.removeListener=function(o,e){var d;ng(e);var h=this._events;if(h===void 0)return this;var f=h[o];if(f===void 0)return this;if(f===e||f.listener===e)--this._eventsCount==0?this._events=Object.create(null):(delete h[o],h.removeListener&&this.emit("removeListener",o,f.listener||e));else if(typeof f!="function"){var g=-1;for(d=f.length-1;0<=d;d--)if(f[d]===e||f[d].listener===e){var A=f[d].listener;g=d;break}if(0>g)return this;if(g===0)f.shift();else{for(;g+1<f.length;g++)f[g]=f[g+1];f.pop()}f.length===1&&(h[o]=f[0]),h.removeListener!==void 0&&this.emit("removeListener",o,A||e)}return this},ea.prototype.off=ea.prototype.removeListener,ea.prototype.removeAllListeners=function(o){var e=this._events;if(e===void 0)return this;if(e.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):e[o]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete e[o]),this;if(arguments.length===0){var d=Object.keys(e);for(e=0;e<d.length;++e){var h=d[e];h!=="removeListener"&&this.removeAllListeners(h)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(d=e[o])=="function")this.removeListener(o,d);else if(d!==void 0)for(e=d.length-1;0<=e;e--)this.removeListener(o,d[e]);return this},ea.prototype.listeners=function(o){return Bl(this,o,!0)},ea.prototype.rawListeners=function(o){return Bl(this,o,!1)},ea.listenerCount=function(o,e){return typeof o.listenerCount=="function"?o.listenerCount(e):Dl.call(o,e)},ea.prototype.listenerCount=Dl,ea.prototype.eventNames=function(){return 0<this._eventsCount?ux(this._events):[]},ea.once=function(o,e){return new Promise(function(d,h){function f(A){o.removeListener(e,g),h(A)}function g(){typeof o.removeListener=="function"&&o.removeListener("error",f),d([].slice.call(arguments))}El(o,e,g,{once:!0}),e!=="error"&&vs(o,f,{once:!0})})};var Qe=Object.assign,Kp=Object.defineProperty,Lp=!Qe||R(function(){if(ka&&Qe({b:1},Qe(Kp({},"a",{enumerable:!0,get:function(){Kp(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var o={},e={},d=Symbol();return o[d]=7,"abcdefghijklmnopqrst".split("").forEach(function(h){e[h]=h}),Qe({},o)[d]!=7||Dc(Qe({},e)).join("")!="abcdefghijklmnopqrst"})?function(o,e){for(var d=Qa(o),h=arguments.length,f=1,g=Bf.f,A=zf;h>f;)for(var C,k=Af(arguments[f++]),j=g?Dc(k).concat(g(k)):Dc(k),_t=j.length,_n=0;_t>_n;)C=j[_n++],(!ka||A.call(k,C))&&(d[C]=k[C]);return d}:Qe;N({target:"Object",stat:!0,forced:Object.assign!==Lp},{assign:Lp}),zp("Map",function(o){return function(){return o(this,arguments.length?arguments[0]:void 0)}},Cp);var vx=Math.log,wx=Math.LN2;N({target:"Math",stat:!0},{log2:function(o){return vx(o)/wx}});var xx=Ra.f,yx=Hd.f,zx=Za.enforce,Ax=qa("match"),sc=y.RegExp,lk=sc.prototype,Wf=/a/g,mk=/a/g,nk=new sc(Wf)!==Wf;if(ka&&nc("RegExp",!nk||pc||R(function(){return mk[Ax]=!1,sc(Wf)!=Wf||sc(mk)==mk||sc(Wf,"i")!="/a/i"}))){for(var Oc=function(o,e){var d,h=this instanceof Oc,f=Lj(o),g=e===void 0;return!h&&f&&o.constructor===Oc&&g||(nk?f&&!g&&(o=o.source):o instanceof Oc&&(g&&(e=tj.call(o)),o=o.source),pc&&(d=!!e&&-1<e.indexOf("y"))&&(e=e.replace(/y/g,"")),o=lh(nk?new sc(o,e):sc(o,e),h?this:lk,Oc),pc&&d&&(zx(o).sticky=!0)),o},Bx=function(o){o in Oc||xx(Oc,o,{configurable:!0,get:function(){return sc[o]},set:function(e){sc[o]=e}})},Mp=yx(sc),Np=0;Mp.length>Np;)Bx(Mp[Np++]);lk.constructor=Oc,Oc.prototype=lk,Ta(y,"RegExp",Oc)}If("RegExp"),Sf("Float32",function(o){return function(e,d,h){return o(this,e,d,h)}}),Sf("Float64",function(o){return function(e,d,h){return o(this,e,d,h)}}),Sf("Uint32",function(o){return function(e,d,h){return o(this,e,d,h)}}),Sf("Uint16",function(o){return function(e,d,h){return o(this,e,d,h)}});var ok=function(o,e){return o===e?0:o==null?e==null?0:-1:e==null?o==null?0:1:typeof o.compare=="function"?o.compare(e):typeof e.compare=="function"?-e.compare(o):o<e?-1:o>e?1:0},pk=[],Op=pk.sort,Cx=R(function(){pk.sort(void 0)}),Dx=R(function(){pk.sort(null)}),Ex=Ee("sort");N({target:"Array",proto:!0,forced:Cx||!Dx||!Ex},{sort:function(o){return o===void 0?Op.call(Qa(this)):Op.call(Qa(this),yb(o))}});var Pp=Object.getPrototypeOf({}),Xf=function(o,e){var d;return o===e||(o==null?o==e:X(o.equiv)==="function"?o.equiv(e):e==null?o==e:X(e.equiv)==="function"?e.equiv(o):X(o)!=="string"&&X(e)!=="string"&&((d=Object.getPrototypeOf(o))!=null&&d!==Pp||(d=Object.getPrototypeOf(e))!=null&&d!==Pp?X(o)!=="function"&&o.length!==void 0&&X(e)!=="function"&&e.length!==void 0?Gx(o,e):o instanceof Set&&e instanceof Set?Hx(o,e):o instanceof Map&&e instanceof Map?Ix(o,e):o instanceof Date&&e instanceof Date?o.getTime()===e.getTime():o instanceof RegExp&&e instanceof RegExp?o.toString()===e.toString():o!=o&&e!=e:Fx(o,e)))},Gx=function(o,e){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf,h=o.length;if(h===e.length)for(;0<=--h&&d(o[h],e[h]););return 0>h},Hx=function(o,e){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;return o.size===e.size&&d(G(o.keys()).sort(),G(e.keys()).sort())},Ix=function(o,e){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;return o.size===e.size&&d(G(o).sort(),G(e).sort())},Fx=function(o,e){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;if(Object.keys(o).length!==Object.keys(e).length)return!1;for(var h in o)if(!e.hasOwnProperty(h)||!d(o[h],e[h]))return!1;return!0},Qp=function(o){var e=1<arguments.length&&arguments[1]!==void 0?arguments[1]:function(d){return d!==void 0?": "+d:""};return function(d){function h(g){return W(this,h),f.call(this,o(g)+e(g))}la(h,d);var f=ma(h);return h}(ef(Error))},Jx=Qp(function(){return"illegal argument(s)"}),vh=function(o){throw new Jx(o)},qk=Qp(function(){return"index out of bounds"}),Rp=1/4294967295,Kx=function(){function o(){W(this,o)}return Ha(o,[{key:"float",value:function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return this.int()*Rp*e}},{key:"norm",value:function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(this.int()*Rp-.5)*e}},{key:"minmax",value:function(e,d){return this.float()*(d-e)+e}}]),o}(),rk=Math.random,Lx=new(function(o){function e(){return W(this,e),d.apply(this,arguments)}la(e,o);var d=ma(e);return Ha(e,[{key:"int",value:function(){return 4294967296*rk()>>>0}},{key:"float",value:function(){var h=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return rk()*h}},{key:"norm",value:function(){var h=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(rk()-.5)*h}}]),e}(Kx)),Vh=Symbol(),Hl=function(){},Mx=fk.onFreeze,sk=Object.freeze,Nx=R(function(){sk(1)});N({target:"Object",stat:!0,forced:Nx,sham:!yp},{freeze:function(o){return sk&&ha(o)?sk(Mx(o)):o}});var Ox=Ee("reduce"),Px=!Hc&&79<id&&83>id;N({target:"Array",proto:!0,forced:!Ox||Px},{reduce:function(o){return Wo(this,o,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Gl=function(o){return o!=null&&typeof o.xform=="function"?o.xform():o},og=function(){function o(e){W(this,o),this.value=e}return Ha(o,[{key:"deref",value:function(){return this.value}}]),o}(),Wh=function(o){return o instanceof og?o.deref():o},xs=function(o,e){return[o,function(d){return d},e]},Qx=w.mark(function(o,e){var d,h,f,g,A,C;return w.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:d=Gl(o)(ws()),h=d[1],f=d[2],g=0;case 4:if(!(g<e.length)){k.next=15;break}if(A=e[g],!((C=f([],A))instanceof og)){k.next=10;break}return k.delegateYield(Wh(h(C.deref())),"t0",9);case 9:return k.abrupt("return");case 10:if(!C.length){k.next=12;break}return k.delegateYield(C,"t1",12);case 12:g++,k.next=4;break;case 15:return k.delegateYield(Wh(h([])),"t2",16);case 16:case"end":return k.stop()}},Qx)}),ys=w.mark(Fl),zs=function(o,e){return[o[0],o[1],e]},Sp=!0;"findIndex"in[]&&Array(1).findIndex(function(){Sp=!1}),N({target:"Array",proto:!0,forced:Sp},{findIndex:function(o){return An(this,o,1<arguments.length?arguments[1]:void 0)}}),Ld("findIndex"),N({target:"Array",proto:!0},{fill:yj}),Ld("fill");var Rx=function(){function o(e){W(this,o),this._length=0,e&&this.into(e)}return Ha(o,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new o(this)}},{key:"empty",value:function(){return new o}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var e,d=this.head;d;)e=d.next,delete d.value,delete d.prev,delete d.next,d=e;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(e){var d=this._length;if(d<e._length)return-1;if(d>e._length)return 1;if(d===0)return 0;d=this.head,e=e.head;for(var h=0;d&&h==0;)h=ok(d.value,e.value),d=d.next,e=e.next;return h}},{key:"equiv",value:function(e){if(!(e instanceof o||e!=null&&typeof e!="function"&&e.length!==void 0)||this._length!==e.length)return!1;if(!this._length||this===e)return!0;for(var d=this.head,h=0;h<e.length;h++){if(!Xf(d.value,e[h]))return!1;d=d.next}return!0}},{key:Symbol.iterator,value:w.mark(function e(){var d;return w.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:d=this.head;case 1:if(!d){h.next=7;break}return h.next=4,d.value;case 4:d=d.next,h.next=1;break;case 7:case"end":return h.stop()}},e,this)})},{key:"seq",value:function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;if(!(e>=d||0>e)){e=this.nthCell(e);var h=this.nthCell(d-1);return d=function f(g){return{first:function(){return g.value},next:function(){return g!==h&&g.next?f(g.next):void 0}}},e?d(e):void 0}}},{key:"cycle",value:w.mark(function e(){return w.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.delegateYield(this,"t0",2);case 2:d.next=0;break;case 4:case"end":return d.stop()}},e,this)})},{key:"$reduce",value:function(e,d){for(var h=this.head;h&&!(d instanceof og);)d=e(d,h.value),h=h.next;return d}},{key:"drop",value:function(){var e=this.head;if(e)return(this.head=e.next)?delete this.head.prev:delete this.tail,this._length--,e.value}},{key:"cons",value:function(e){return e={value:e,next:this.head},this.head?this.head.prev=e:this.tail=e,this.head=e,this._length++,this}},{key:"insertBefore",value:function(e,d){return e||vh("cell is undefined"),d={value:d,next:e,prev:e.prev},e.prev?e.prev.next=d:this.head=d,e.prev=d,this._length++,this}},{key:"insertAfter",value:function(e,d){return e||vh("cell is undefined"),d={value:d,next:e.next,prev:e},e.next?e.next.prev=d:this.tail=d,e.next=d,this._length++,this}},{key:"insertBeforeNth",value:function(e,d){if(0>e&&(e+=this._length),0>=e)return this.cons(d);if(0>e||e>=this._length)throw new qk(e);return this.insertBefore(this.nthCellUnsafe(e),d)}},{key:"insertAfterNth",value:function(e,d){if(0>e&&(e+=this._length),e>=this._length-1)return this.push(d);if(0>e||e>=this._length)throw new qk(e);return this.insertAfter(this.nthCellUnsafe(e),d)}},{key:"insertSorted",value:function(e,d){d=d||ok;for(var h=this.head;h;){if(0>=d(e,h.value))return this.insertBefore(h,e);h=h.next}return this.push(e)}},{key:"find",value:function(e){for(var d=this.head;d;){if(d.value===e)return d;d=d.next}}},{key:"findWith",value:function(e){for(var d=this.head;d;){if(e(d.value))return d;d=d.next}}},{key:"concat",value:function(){for(var e=this.copy(),d=arguments.length,h=Array(d),f=0;f<d;f++)h[f]=arguments[f];for(d=0;d<h.length;d++)e.into(h[d]);return e}},{key:"into",value:function(e){for(var d=0;d<e.length;d++)this.push(e[d])}},{key:"slice",value:function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;e=0>e?e+this._length:e,d=0>d?d+this._length:d,(0>e||0>d)&&vh("invalid indices: ${from} / ${to}");for(var h=new o,f=this.nthCell(e);f&&++e<=d;)h.push(f.value),f=f.next;return h}},{key:"splice",value:function(e){var d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,h=2<arguments.length?arguments[2]:void 0;if(typeof e=="number"){if(0>e&&(e+=this._length),0>e||e>=this._length)throw new qk(e);var f=this.nthCellUnsafe(e)}else f=e;var g=new o;if(0<d)for(;f&&0<d--;)this.remove(f),g.push(f.value),f=f.next;else f&&(f=f.next);if(h)if(f)for(d=0;d<h.length;d++)this.insertBefore(f,h[d]);else for(f=0;f<h.length;f++)this.push(h[f]);return g}},{key:"remove",value:function(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,this._length--,this}},{key:"swap",value:function(e,d){if(e!==d){var h=e.value;e.value=d.value,d.value=h}return this}},{key:"push",value:function(e){return this.tail?(e={value:e,prev:this.tail},this.tail=this.tail.next=e,this._length++,this):this.cons(e)}},{key:"pop",value:function(){var e=this.tail;if(e)return(this.tail=e.prev)?delete this.tail.next:delete this.head,this._length--,e.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(e){return this.head?(this.head.value=e,this):this.cons(e)}},{key:"setTail",value:function(e){return this.tail?(this.tail.value=e,this):this.push(e)}},{key:"setNth",value:function(e,d){var h=this.nthCell(e);return!h&&vh("index out of bounds: ".concat(e)),h.value=d,this}},{key:"nth",value:function(e,d){return(e=this.nthCell(e))?e.value:d}},{key:"nthCell",value:function(e){if(0>e&&(e+=this._length),!(0>e||e>=this._length))return this.nthCellUnsafe(e)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var e=this.peek();return this.pop(),this.cons(e)}}},{key:"map",value:function(e){for(var d=new o,h=this.head;h;)d.push(e(h.value)),h=h.next;return d}},{key:"filter",value:function(e){for(var d=new o,h=this.head;h;)e(h.value)&&d.push(h.value),h=h.next;return d}},{key:"reduce",value:function(e,d){for(var h=this.head;h;)d=e(d,h.value),h=h.next;return d}},{key:"shuffle",value:function(e){var d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:Lx;if(2>this._length)return this;for(e=e??Math.ceil(1.5*Math.log2(this._length));0<e;e--)for(var h=this.head;h;){var f=h.next;.5>d.float()?this.asHead(h):this.asTail(h),h=f}return this}},{key:"sort",value:function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:ok;if(!this._length)return this;for(var d=1;;){var h=this.head;this.tail=this.head=void 0;for(var f=0;h;){f++;for(var g=h,A=0,C=0;C<d&&(A++,g=g.next);C++);for(C=d;0<A||0<C&&g;){if(A===0){var k=g;g=g.next,C--}else g&&C!==0?0>=e(h.value,g.value)?(k=h,h=h.next,A--):(k=g,g=g.next,C--):(k=h,h=h.next,A--);this.tail?this.tail.next=k:this.head=k,k.prev=this.tail,this.tail=k}h=g}if(this.tail.next=void 0,1>=f)return this;d*=2}}},{key:"reverse",value:function(){for(var e=this.head,d=this.tail,h=(this._length>>>1)+(1&this._length);e&&d&&0<h;){var f=e.value;e.value=d.value,d.value=f,e=e.next,d=d.prev,h--}return this}},{key:"asHead",value:function(e){return e===this.head||(this.remove(e),this.head.prev=e,e.next=this.head,e.prev=void 0,this.head=e,this._length++),this}},{key:"asTail",value:function(e){return e===this.tail||(this.remove(e),this.tail.next=e,e.prev=this.tail,e.next=void 0,this.tail=e,this._length++),this}},{key:"toString",value:function(){for(var e=[],d=this.head;d;)e.push(String(d.value)),d=d.next;return e.join(", ")}},{key:"toJSON",value:function(){return G(this)}},{key:"nthCellUnsafe",value:function(e){if(e<=this._length>>1)var d=this.head,h="next";else d=this.tail,h="prev",e=this._length-e-1;for(;0<e--&&d;)d=d[h];return d}}]),o}(),tc=function(){function o(e,d){W(this,o),d=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},d),this.map=d.map(),this.items=new Rx,this._size=0,this.opts=d,e&&this.into(e)}return Ha(o,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return pg(function(e){return[e.k,e]},this.items)}},{key:"keys",value:function(){return pg(function(e){return e.k},this.items)}},{key:"values",value:function(){return pg(function(e){return e.v},this.items)}},{key:"copy",value:function(){var e=this.empty();e.items=this.items.copy();for(var d=e.items.head;d;)e.map.set(d.value.k,d),d=d.next;return e}},{key:"empty",value:function(){return new o(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var e=this.opts.release;if(e){for(var d;d=this.items.drop();)e(d.k,d.v);return!0}return this.items.release()}},{key:"has",value:function(e){return this.map.has(e)}},{key:"get",value:function(e,d){return(e=this.map.get(e))?this.resetEntry(e):d}},{key:"set",value:function(e,d){var h=this.opts.ksize(e)+this.opts.vsize(d),f=this.map.get(e);return this._size+=Math.max(0,h-(f?f.value.s:0)),this.ensureSize()&&this.doSetEntry(f,e,d,h),d}},{key:"into",value:function(e){for(var d=0;d<e.length;d++){var h=e[d];this.set(h[0],h[1])}return this}},{key:"getSet",value:function(e,d){var h=this,f=this.map.get(e);return f?Promise.resolve(this.resetEntry(f)):d().then(function(g){return h.set(e,g)})}},{key:"delete",value:function(e){return!!(e=this.map.get(e))&&(this.removeEntry(e),!0)}},{key:"resetEntry",value:function(e){return this.items.asTail(e),e.value.v}},{key:"ensureSize",value:function(){for(var e=this.opts.release,d=this.opts.maxsize,h=this.opts.maxlen;this._size>d||this.length>=h;){var f=this.items.drop();if(!f)return!1;this.map.delete(f.k),e&&e(f.k,f.v),this._size-=f.s}return!0}},{key:"removeEntry",value:function(e){var d=e.value;this.map.delete(d.k),this.items.remove(e),this.opts.release&&this.opts.release(d.k,d.v),this._size-=d.s}},{key:"doSetEntry",value:function(e,d,h,f){e?(e.value.v=h,e.value.s=f,this.items.asTail(e)):(this.items.push({k:d,v:h,s:f}),this.map.set(d,this.items.tail))}}]),o}(),Sx=function(o){function e(h,f){return W(this,e),f=Object.assign({ttl:36e5},f),d.call(this,h,f)}la(e,o);var d=ma(e);return Ha(e,[{key:"empty",value:function(){return new e(null,this.opts)}},{key:"has",value:function(h){return this.get(h)!==void 0}},{key:"get",value:function(h,f){if(h=this.map.get(h)){if(h.value.t>=Date.now())return this.resetEntry(h);this.removeEntry(h)}return f}},{key:"set",value:function(h,f){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,A=this.opts.ksize(h)+this.opts.vsize(f),C=this.map.get(h);return this._size+=Math.max(0,A-(C?C.value.s:0)),this.ensureSize()&&(g=Date.now()+g,C?(C.value.v=f,C.value.s=A,C.value.t=g,this.items.asTail(C)):(this.items.push({k:h,v:f,s:A,t:g}),this.map.set(h,this.items.tail))),f}},{key:"getSet",value:function(h,f){var g=this,A=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,C=this.get(h);return C?Promise.resolve(C):f().then(function(k){return g.set(h,k,A)})}},{key:"prune",value:function(){for(var h=Date.now(),f=this.items.head;f;)f.value.t<h&&this.removeEntry(f),f=f.next}},{key:"ensureSize",value:function(){for(var h=this.opts.maxsize,f=this.opts.maxlen,g=Date.now(),A=this.items.head;A&&(this._size>h||this.length>=f);)A.value.t<g&&this.removeEntry(A),A=A.next;return Th(wd(e.prototype),"ensureSize",this).call(this)}}]),e}(tc),Tp=X(Ya)=="object"&&Ya&&Ya.Object===Object&&Ya,Tx=(typeof self>"u"?"undefined":X(self))=="object"&&self&&self.Object===Object&&self,Cb=Tp||Tx||Function("return this")(),Pb=Cb.Symbol,Up=Object.prototype,Ux=Up.hasOwnProperty,Vx=Up.toString,Yf=Pb?Pb.toStringTag:void 0,Wx=Object.prototype.toString,Vp=Pb?Pb.toStringTag:void 0,Qd=function(o){if(o==null)o=o===void 0?"[object Undefined]":"[object Null]";else if(Vp&&Vp in Object(o)){var e=Ux.call(o,Yf),d=o[Yf];try{o[Yf]=void 0;var h=!0}catch{}var f=Vx.call(o);h&&(e?o[Yf]=d:delete o[Yf]),o=f}else o=Wx.call(o);return o},lb=function(o){var e=X(o);return o!=null&&(e=="object"||e=="function")},qi=function(o){return!!lb(o)&&((o=Qd(o))=="[object Function]"||o=="[object GeneratorFunction]"||o=="[object AsyncFunction]"||o=="[object Proxy]")},tk=Cb["__core-js_shared__"],Wp=function(){var o=/[^.]+$/.exec(tk&&tk.keys&&tk.keys.IE_PROTO||"");return o?"Symbol(src)_1."+o:""}(),Xx=Function.prototype.toString,Rd=function(o){if(o!=null){try{return Xx.call(o)}catch{}return o+""}return""},Yx=/^\[object .+?Constructor\]$/,Zx=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Sd=function(o,e){return o=o==null?void 0:o[e],!lb(o)||Wp&&Wp in o||!(qi(o)?Zx:Yx).test(Rd(o))?void 0:o},Zf=Sd(Object,"create"),$x=Object.prototype.hasOwnProperty,ay=Object.prototype.hasOwnProperty;zd.prototype.clear=function(){this.__data__=Zf?Zf(null):{},this.size=0},zd.prototype.delete=function(o){return o=this.has(o)&&delete this.__data__[o],this.size-=o?1:0,o},zd.prototype.get=function(o){var e=this.__data__;return Zf?(o=e[o])==="__lodash_hash_undefined__"?void 0:o:$x.call(e,o)?e[o]:void 0},zd.prototype.has=function(o){var e=this.__data__;return Zf?e[o]!==void 0:ay.call(e,o)},zd.prototype.set=function(o,e){var d=this.__data__;return this.size+=this.has(o)?0:1,d[o]=Zf&&e===void 0?"__lodash_hash_undefined__":e,this};var $f=function(o,e){return o===e||o!=o&&e!=e},wh=function(o,e){for(var d=o.length;d--;)if($f(o[d][0],e))return d;return-1},by=Array.prototype.splice;ce.prototype.clear=function(){this.__data__=[],this.size=0},ce.prototype.delete=function(o){var e=this.__data__;return!(0>(o=wh(e,o)))&&(o==e.length-1?e.pop():by.call(e,o,1),--this.size,!0)},ce.prototype.get=function(o){var e=this.__data__;return 0>(o=wh(e,o))?void 0:e[o][1]},ce.prototype.has=function(o){return-1<wh(this.__data__,o)},ce.prototype.set=function(o,e){var d=this.__data__,h=wh(d,o);return 0>h?(++this.size,d.push([o,e])):d[h][1]=e,this};var rg=ce,ag=Sd(Cb,"Map"),xh=function(o,e){o=o.__data__;var d=X(e);return(d=="string"||d=="number"||d=="symbol"||d=="boolean"?e!=="__proto__":e===null)?o[typeof e=="string"?"string":"hash"]:o.map};de.prototype.clear=function(){this.size=0,this.__data__={hash:new zd,map:new(ag||rg),string:new zd}},de.prototype.delete=function(o){return o=xh(this,o).delete(o),this.size-=o?1:0,o},de.prototype.get=function(o){return xh(this,o).get(o)},de.prototype.has=function(o){return xh(this,o).has(o)},de.prototype.set=function(o,e){var d=xh(this,o),h=d.size;return d.set(o,e),this.size+=d.size==h?0:1,this};var qg=de;gf.prototype.add=gf.prototype.push=function(o){return this.__data__.set(o,"__lodash_hash_undefined__"),this},gf.prototype.has=function(o){return this.__data__.has(o)};var Xp=function(o,e,d,h){var f=o.length;for(d+=h?1:-1;h?d--:++d<f;)if(e(o[d],d,o))return d;return-1},cy=function(o){return o!=o},dy=function(o,e){var d;if(d=!(o==null||!o.length)){if(e==e)t:{d=-1;for(var h=o.length;++d<h;)if(o[d]===e){o=d;break t}o=-1}else o=Xp(o,cy,0);d=-1<o}return d},ey=function(o,e,d){for(var h=-1,f=o==null?0:o.length;++h<f;)if(d(e,o[h]))return!0;return!1},fy=function(o,e){return o.has(e)},Re=Sd(Cb,"Set"),gy=function(){},uk=function(o){var e=-1,d=Array(o.size);return o.forEach(function(h){d[++e]=h}),d},hy=1/0,iy=Re&&1/uk(new Re([,-0]))[1]==hy?function(o){return new Re(o)}:gy,vk=function(o,e,d){var h=-1,f=dy,g=o.length,A=!0,C=[],k=C;if(d)A=!1,f=ey;else if(200<=g){if(f=e?null:iy(o))return uk(f);A=!1,f=fy,k=new gf}else k=e?[]:C;t:for(;++h<g;){var j=o[h],_t=e?e(j):j;if(j=d||j!==0?j:0,A&&_t==_t){for(var _n=k.length;_n--;)if(k[_n]===_t)continue t;e&&k.push(_t),C.push(j)}else f(k,_t,d)||(k!==C&&k.push(_t),C.push(j))}return C},Yp=function(o){for(var e=-1,d=o==null?0:o.length,h={};++e<d;){var f=o[e];h[f[0]]=f[1]}return h},he=function(o,e){for(var d=-1,h=o==null?0:o.length,f=Array(h);++d<h;)f[d]=e(o[d],d,o);return f};ee.prototype.clear=function(){this.__data__=new rg,this.size=0},ee.prototype.delete=function(o){var e=this.__data__;return o=e.delete(o),this.size=e.size,o},ee.prototype.get=function(o){return this.__data__.get(o)},ee.prototype.has=function(o){return this.__data__.has(o)},ee.prototype.set=function(o,e){var d=this.__data__;if(d instanceof rg){var h=d.__data__;if(!ag||199>h.length)return h.push([o,e]),this.size=++d.size,this;d=this.__data__=new qg(h)}return d.set(o,e),this.size=d.size,this};var ge=ee,Is=function(o,e){for(var d=-1,h=o==null?0:o.length;++d<h&&e(o[d],d,o)!==!1;);return o},yh=function(){try{var o=Sd(Object,"defineProperty");return o({},"",{}),o}catch{}}(),bg=function(o,e,d){e=="__proto__"&&yh?yh(o,e,{configurable:!0,enumerable:!0,value:d,writable:!0}):o[e]=d},jy=Object.prototype.hasOwnProperty,Ml=function(o,e,d){var h=o[e];jy.call(o,e)&&$f(h,d)&&(d!==void 0||e in o)||bg(o,e,d)},re=function(o,e,d,h){var f=!d;d||(d={});for(var g=-1,A=e.length;++g<A;){var C=e[g],k=h?h(d[C],o[C],C,d,o):void 0;k===void 0&&(k=o[C]),f?bg(d,C,k):Ml(d,C,k)}return d},gc=function(o){return o!=null&&X(o)=="object"},Zp=function(o){return gc(o)&&Qd(o)=="[object Arguments]"},$p=Object.prototype,ky=$p.hasOwnProperty,ly=$p.propertyIsEnumerable,rf=Zp(function(){return arguments}())?Zp:function(o){return gc(o)&&ky.call(o,"callee")&&!ly.call(o,"callee")},Va=Array.isArray,my=function(){return!1},jf=$a(function(o,e){var d=(e=e&&!e.nodeType&&e)&&o&&!o.nodeType&&o;e=d&&d.exports===e?Cb.Buffer:void 0,o.exports=(e?e.isBuffer:void 0)||my}),ny=/^(?:0|[1-9]\d*)$/,wk=function(o,e){var d=X(o);return!!(e=e??9007199254740991)&&(d=="number"||d!="symbol"&&ny.test(o))&&-1<o&&o%1==0&&o<e},xk=function(o){return typeof o=="number"&&-1<o&&o%1==0&&9007199254740991>=o},Ea={};Ea["[object Float32Array]"]=Ea["[object Float64Array]"]=Ea["[object Int8Array]"]=Ea["[object Int16Array]"]=Ea["[object Int32Array]"]=Ea["[object Uint8Array]"]=Ea["[object Uint8ClampedArray]"]=Ea["[object Uint16Array]"]=Ea["[object Uint32Array]"]=!0,Ea["[object Arguments]"]=Ea["[object Array]"]=Ea["[object ArrayBuffer]"]=Ea["[object Boolean]"]=Ea["[object DataView]"]=Ea["[object Date]"]=Ea["[object Error]"]=Ea["[object Function]"]=Ea["[object Map]"]=Ea["[object Number]"]=Ea["[object Object]"]=Ea["[object RegExp]"]=Ea["[object Set]"]=Ea["[object String]"]=Ea["[object WeakMap]"]=!1;var oy=function(o){return gc(o)&&xk(o.length)&&!!Ea[Qd(o)]},zh=function(o){return function(e){return o(e)}},Se=$a(function(o,e){var d=e&&!e.nodeType&&e;d=(e=d&&o&&!o.nodeType&&o)&&e.exports===d&&Tp.process;t:{try{var h=e&&e.require&&e.require("util").types;if(h){var f=h;break t}f=d&&d.binding&&d.binding("util");break t}catch{}f=void 0}o.exports=f}),aq=Se&&Se.isTypedArray,bi=aq?zh(aq):oy,py=Object.prototype.hasOwnProperty,bq=function(o,e){var d=Va(o),h=!d&&rf(o),f=!d&&!h&&jf(o),g=!d&&!h&&!f&&bi(o);if(d=d||h||f||g){h=o.length;for(var A=String,C=-1,k=Array(h);++C<h;)k[C]=A(C);h=k}else h=[];for(var j in A=h.length,o)!e&&!py.call(o,j)||d&&(j=="length"||f&&(j=="offset"||j=="parent")||g&&(j=="buffer"||j=="byteLength"||j=="byteOffset")||wk(j,A))||h.push(j);return h},qy=Object.prototype,yk=function(o){var e=o&&o.constructor;return o===(typeof e=="function"&&e.prototype||qy)},cq=function(o,e){return function(d){return o(e(d))}},ry=cq(Object.keys,Object),sy=Object.prototype.hasOwnProperty,Ed=function(o){return o!=null&&xk(o.length)&&!qi(o)},Ad=function(o){if(Ed(o))o=bq(o);else if(yk(o)){var e,d=[];for(e in Object(o))sy.call(o,e)&&e!="constructor"&&d.push(e);o=d}else o=ry(o);return o},Es=function(o,e){return o&&re(e,Ad(e),o)},ty=Object.prototype.hasOwnProperty,kf=function(o){if(Ed(o))o=bq(o,!0);else if(lb(o)){var e=yk(o),d=[];for(h in o)(h!="constructor"||!e&&ty.call(o,h))&&d.push(h);o=d}else{var h=[];if(o!=null)for(e in Object(o))h.push(e);o=h}return o},Cs=function(o,e){return o&&re(e,kf(e),o)},Jl=$a(function(o,e){var d=(e=e&&!e.nodeType&&e)&&o&&!o.nodeType&&o,h=(e=d&&d.exports===e?Cb.Buffer:void 0)?e.allocUnsafe:void 0;o.exports=function(f,g){return g?f.slice():(g=f.length,g=h?h(g):new f.constructor(g),f.copy(g),g)}}),Xh=function(o,e){var d=-1,h=o.length;for(e||(e=Array(h));++d<h;)e[d]=o[d];return e},uy=function(o,e){for(var d=-1,h=o==null?0:o.length,f=0,g=[];++d<h;){var A=o[d];e(A,d,o)&&(g[f++]=A)}return g},dq=function(){return[]},vy=Object.prototype.propertyIsEnumerable,eq=Object.getOwnPropertySymbols,zk=eq?function(o){return o==null?[]:(o=Object(o),uy(eq(o),function(e){return vy.call(o,e)}))}:dq,Ds=function(o,e){return re(o,zk(o),e)},ai=function(o,e){for(var d=-1,h=e.length,f=o.length;++d<h;)o[f+d]=e[d];return o},Ak=cq(Object.getPrototypeOf,Object),fq=Object.getOwnPropertySymbols?function(o){for(var e=[];o;)ai(e,zk(o)),o=Ak(o);return e}:dq,Bs=function(o,e){return re(o,fq(o),e)},gq=function(o,e,d){return e=e(o),Va(o)?e:ai(e,d(o))},Yh=function(o){return gq(o,Ad,zk)},Ll=function(o){return gq(o,kf,fq)},Bk=Sd(Cb,"DataView"),Ck=Sd(Cb,"Promise"),Dk=Sd(Cb,"WeakMap"),wy=Rd(Bk),xy=Rd(ag),yy=Rd(Ck),zy=Rd(Re),Ay=Rd(Dk),Td=Qd;(Bk&&Td(new Bk(new ArrayBuffer(1)))!="[object DataView]"||ag&&Td(new ag)!="[object Map]"||Ck&&Td(Ck.resolve())!="[object Promise]"||Re&&Td(new Re)!="[object Set]"||Dk&&Td(new Dk)!="[object WeakMap]")&&(Td=function(o){var e=Qd(o);if(o=(o=e=="[object Object]"?o.constructor:void 0)?Rd(o):"")switch(o){case wy:return"[object DataView]";case xy:return"[object Map]";case yy:return"[object Promise]";case zy:return"[object Set]";case Ay:return"[object WeakMap]"}return e});var hf=Td,By=Object.prototype.hasOwnProperty,As=function(o){var e=o.length,d=new o.constructor(e);return e&&typeof o[0]=="string"&&By.call(o,"index")&&(d.index=o.index,d.input=o.input),d},Ah=Cb.Uint8Array,Ek=function(o){var e=new o.constructor(o.byteLength);return new Ah(e).set(new Ah(o)),e},Cy=/\w*$/,hq=Pb?Pb.prototype:void 0,iq=hq?hq.valueOf:void 0,vm=function(o,e){return e=e?Ek(o.buffer):o.buffer,new o.constructor(e,o.byteOffset,o.length)},Fs=function(o,e,d){var h=o.constructor;switch(e){case"[object ArrayBuffer]":return Ek(o);case"[object Boolean]":case"[object Date]":return new h(+o);case"[object DataView]":return e=d?Ek(o.buffer):o.buffer,new o.constructor(e,o.byteOffset,o.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return vm(o,d);case"[object Map]":return new h;case"[object Number]":case"[object String]":return new h(o);case"[object RegExp]":return(e=new o.constructor(o.source,Cy.exec(o))).lastIndex=o.lastIndex,e;case"[object Set]":return new h;case"[object Symbol]":return iq?Object(iq.call(o)):{}}},jq=Object.create,Dy=function(){function o(){}return function(e){return lb(e)?jq?jq(e):(o.prototype=e,e=new o,o.prototype=void 0,e):{}}}(),Kl=function(o){return typeof o.constructor!="function"||yk(o)?{}:Dy(Ak(o))},Ey=function(o){return gc(o)&&hf(o)=="[object Map]"},kq=Se&&Se.isMap,Hs=kq?zh(kq):Ey,Fy=function(o){return gc(o)&&hf(o)=="[object Set]"},lq=Se&&Se.isSet,Gs=lq?zh(lq):Fy,wa={};wa["[object Arguments]"]=wa["[object Array]"]=wa["[object ArrayBuffer]"]=wa["[object DataView]"]=wa["[object Boolean]"]=wa["[object Date]"]=wa["[object Float32Array]"]=wa["[object Float64Array]"]=wa["[object Int8Array]"]=wa["[object Int16Array]"]=wa["[object Int32Array]"]=wa["[object Map]"]=wa["[object Number]"]=wa["[object Object]"]=wa["[object RegExp]"]=wa["[object Set]"]=wa["[object String]"]=wa["[object Symbol]"]=wa["[object Uint8Array]"]=wa["[object Uint8ClampedArray]"]=wa["[object Uint16Array]"]=wa["[object Uint32Array]"]=!0,wa["[object Error]"]=wa["[object Function]"]=wa["[object WeakMap]"]=!1;var ie=function(o){return X(o)=="symbol"||gc(o)&&Qd(o)=="[object Symbol]"},Gy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hy=/^\w*$/,Fk=function(o,e){if(Va(o))return!1;var d=X(o);return!(d!="number"&&d!="symbol"&&d!="boolean"&&o!=null&&!ie(o))||Hy.test(o)||!Gy.test(o)||e!=null&&o in Object(e)};Zh.Cache=qg;var Iy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jy=/\\(\\)?/g,Ky=function(o){var e=(o=Zh(o,function(d){return e.size===500&&e.clear(),d})).cache;return o}(function(o){var e=[];return o.charCodeAt(0)===46&&e.push(""),o.replace(Iy,function(d,h,f,g){e.push(f?g.replace(Jy,"$1"):h||d)}),e}),Js=1/0,mq=Pb?Pb.prototype:void 0,Ol=mq?mq.toString:void 0,Bh=function(o,e){return Va(o)?o:Fk(o,e)?[o]:Ky(o==null?"":Nl(o))},Ly=1/0,cg=function(o){if(typeof o=="string"||ie(o))return o;var e=o+"";return e=="0"&&1/o==-Ly?"-0":e},Ch=function(o,e){for(var d=0,h=(e=Bh(e,o)).length;o!=null&&d<h;)o=o[cg(e[d++])];return d&&d==h?o:void 0},My=function(o,e){if(!(2>(e=Bh(e,o)).length)){var d=e,h=0,f=-1,g=-1,A=d.length;for(0>h&&(h=-h>A?0:A+h),0>(f=f>A?A:f)&&(f+=A),A=h>f?0:f-h>>>0,h>>>=0,f=Array(A);++g<A;)f[g]=d[g+h];o=Ch(o,f)}return(d=o==null)||(d=e==null?0:e.length,d=delete o[cg(d?e[d-1]:void 0)]),d},nq=Function.prototype.toString,Ny=Object.prototype.hasOwnProperty,Oy=nq.call(Object),wm=function(o){return!(!gc(o)||Qd(o)!="[object Object]")&&((o=Ak(o))===null||typeof(o=Ny.call(o,"constructor")&&o.constructor)=="function"&&o instanceof o&&nq.call(o)==Oy)},Py=function(o){return wm(o)?void 0:o},oq=Pb?Pb.isConcatSpreadable:void 0,Ks=function(o){return Va(o)||rf(o)||!!(oq&&o&&o[oq])},Qy=function(o){return o!=null&&o.length?$h(o,1):[]},Ry=function(o,e,d){switch(d.length){case 0:return o.call(e);case 1:return o.call(e,d[0]);case 2:return o.call(e,d[0],d[1]);case 3:return o.call(e,d[0],d[1],d[2])}return o.apply(e,d)},pq=Math.max,qq=function(o,e,d){return e=pq(e===void 0?o.length-1:e,0),function(){for(var h=arguments,f=-1,g=pq(h.length-e,0),A=Array(g);++f<g;)A[f]=h[e+f];for(f=-1,g=Array(e+1);++f<e;)g[f]=h[f];return g[e]=d(A),Ry(o,this,g)}},Sy=function(o){return function(){return o}},Dh=function(o){return o},Ty=Date.now,rq=function(o){var e=0,d=0;return function(){var h=Ty(),f=16-(h-d);if(d=h,0<f){if(800<=++e)return arguments[0]}else e=0;return o.apply(void 0,arguments)}}(yh?function(o,e){return yh(o,"toString",{configurable:!0,enumerable:!1,value:Sy(e),writable:!0})}:Dh),Gk=function(o){return rq(qq(o,void 0,Qy),o+"")}(function(o,e){var d={};if(o==null)return d;var h=!1;e=he(e,function(g){return g=Bh(g,o),h||(h=1<g.length),g}),re(o,Ll(o),d),h&&(d=fe(d,7,Py));for(var f=e.length;f--;)My(d,e[f]);return d}),Uy=function(o,e,d,h){for(var f=-1,g=o==null?0:o.length;++f<g;){var A=o[f];e(h,A,d(A),o)}return h},um=function(o,e,d){for(var h=-1,f=Object(o),g=(d=d(o)).length;g--;){var A=d[++h];if(e(f[A],A,f)===!1)break}return o},sq=function(o,e){return o&&um(o,e,Ad)},Hk=function(o,e){return function(d,h){if(d==null)return d;if(!Ed(d))return o(d,h);for(var f=d.length,g=-1,A=Object(d);++g<f&&h(A[g],g,A)!==!1;);return d}}(sq),Vy=function(o,e,d,h){return Hk(o,function(f,g,A){e(h,f,d(f),A)}),h},tq=function(o,e){for(var d=-1,h=o==null?0:o.length;++d<h;)if(e(o[d],d,o))return!0;return!1},Pl=function(o,e,d,h,f,g){var A=1&d,C=o.length,k=e.length;if(C!=k&&!(A&&k>C))return!1;k=g.get(o);var j=g.get(e);if(k&&j)return k==e&&j==o;k=-1,j=!0;var _t=2&d?new gf:void 0;for(g.set(o,e),g.set(e,o);++k<C;){var _n=o[k],ue=e[k];if(h)var Ei=A?h(ue,_n,k,e,o,g):h(_n,ue,k,o,e,g);if(Ei!==void 0){if(Ei)continue;j=!1;break}if(_t){if(!tq(e,function(_s,_c){if(!_t.has(_c)&&(_n===_s||f(_n,_s,d,h,g)))return _t.push(_c)})){j=!1;break}}else if(_n!==ue&&!f(_n,ue,d,h,g)){j=!1;break}}return g.delete(o),g.delete(e),j},Wy=function(o){var e=-1,d=Array(o.size);return o.forEach(function(h,f){d[++e]=[f,h]}),d},uq=Pb?Pb.prototype:void 0,Ik=uq?uq.valueOf:void 0,Ls=function(o,e,d,h,f,g,A){switch(d){case"[object DataView]":if(o.byteLength!=e.byteLength||o.byteOffset!=e.byteOffset)break;o=o.buffer,e=e.buffer;case"[object ArrayBuffer]":if(o.byteLength!=e.byteLength||!g(new Ah(o),new Ah(e)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return $f(+o,+e);case"[object Error]":return o.name==e.name&&o.message==e.message;case"[object RegExp]":case"[object String]":return o==e+"";case"[object Map]":var C=Wy;case"[object Set]":if(C||(C=uk),o.size!=e.size&&!(1&h))break;return(d=A.get(o))?d==e:(h|=2,A.set(o,e),e=Pl(C(o),C(e),h,f,g,A),A.delete(o),e);case"[object Symbol]":if(Ik)return Ik.call(o)==Ik.call(e)}return!1},Ms=Object.prototype.hasOwnProperty,Ql=Object.prototype.hasOwnProperty,Xy=function(o,e,d,h){var f=d.length,g=f,A=!h;if(o==null)return!g;for(o=Object(o);f--;){var C=d[f];if(A&&C[2]?C[1]!==o[C[0]]:!(C[0]in o))return!1}for(;++f<g;){var k=(C=d[f])[0],j=o[k],_t=C[1];if(A&&C[2]){if(j===void 0&&!(k in o))return!1}else{if(C=new ge,h)var _n=h(j,_t,k,o,e,C);if(_n===void 0?!je(_t,j,3,h,C):!_n)return!1}}return!0},Yy=function(o){for(var e=Ad(o),d=e.length;d--;){var h=e[d],f=o[h];e[d]=[h,f,f==f&&!lb(f)]}return e},vq=function(o,e){return function(d){return d!=null&&d[o]===e&&(e!==void 0||o in Object(d))}},Zy=function(o){var e=Yy(o);return e.length==1&&e[0][2]?vq(e[0][0],e[0][1]):function(d){return d===o||Xy(d,o,e)}},$y=function(o,e){return Fk(o)&&e==e&&!lb(e)?vq(cg(o),e):function(d){var h=d==null?void 0:Ch(d,o);if((h=h===void 0?void 0:h)===void 0&&h===e){if(h=d!=null){for(var f=-1,g=(h=Bh(h=o,d)).length,A=!1;++f<g;){var C=cg(h[f]);if(!(A=d!=null&&d!=null&&C in Object(d)))break;d=d[C]}A||++f!=g?h=A:h=!!(g=d==null?0:d.length)&&xk(g)&&wk(C,g)&&(Va(d)||rf(d))}C=h}else C=je(e,h,3);return C}},az=function(o){return function(e){return e==null?void 0:e[o]}},bz=function(o){return function(e){return Ch(e,o)}},Te=function(o){return typeof o=="function"?o:o==null?Dh:X(o)=="object"?Va(o)?$y(o[0],o[1]):Zy(o):Fk(o)?az(cg(o)):bz(o)},Jk=function(o,e){return function(d,h){var f={};return(Va(d)?Uy:Vy)(d,o,Te(h),f)}}(function(o,e,d){bg(o,d,e)}),uc=function(o,e){var d={};return e=Te(e),sq(o,function(h,f,g){bg(d,f,e(h,f,g))}),d};N({target:"String",proto:!0,forced:R(function(){var o="".sub('"');return o!==o.toLowerCase()||3<o.split('"').length})},{sub:function(){return"<sub>"+String(jb(this))+"</sub>"}});var U=xa,Qb=null;try{Qb=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(o){}xa.prototype.__isLong__,Object.defineProperty(xa.prototype,"__isLong__",{value:!0}),xa.isLong=mb;var Sl={},Rl={};xa.fromInt=Bd,xa.fromNumber=Gb,xa.fromBits=ya;var sg=Math.pow;xa.fromString=ci,xa.fromValue=Wb;var ke=4294967296,Tl=ke*ke,Vl=Tl/2,wq=Bd(16777216),Hb=Bd(0);xa.ZERO=Hb;var Cd=Bd(0,!0);xa.UZERO=Cd;var Ue=Bd(1);xa.ONE=Ue;var xq=Bd(1,!0);xa.UONE=xq;var Kk=Bd(-1);xa.NEG_ONE=Kk;var Wl=ya(-1,2147483647,!1);xa.MAX_VALUE=Wl;var Ul=ya(-1,-1,!0);xa.MAX_UNSIGNED_VALUE=Ul;var nb=ya(0,-2147483648,!1);xa.MIN_VALUE=nb;var D=xa.prototype;D.toInt=function(){return this.unsigned?this.low>>>0:this.low},D.toNumber=function(){return this.unsigned?(this.high>>>0)*ke+(this.low>>>0):this.high*ke+(this.low>>>0)},D.toString=function(o){if(2>(o=o||10)||36<o)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(nb)){var e=Gb(o),d=this.div(e);return e=d.mul(e).sub(this),d.toString(o)+e.toInt().toString(o)}return"-"+this.neg().toString(o)}d=Gb(sg(o,6),this.unsigned),e=this;for(var h="";;){var f=e.div(d),g=(e.sub(f.mul(d)).toInt()>>>0).toString(o);if((e=f).isZero())return g+h;for(;6>g.length;)g="0"+g;h=""+g+h}},D.getHighBits=function(){return this.high},D.getHighBitsUnsigned=function(){return this.high>>>0},D.getLowBits=function(){return this.low},D.getLowBitsUnsigned=function(){return this.low>>>0},D.getNumBitsAbs=function(){if(this.isNegative())return this.eq(nb)?64:this.neg().getNumBitsAbs();for(var o=this.high!=0?this.high:this.low,e=31;0<e&&!(o&1<<e);e--);return this.high!=0?e+33:e+1},D.isZero=function(){return this.high===0&&this.low===0},D.eqz=D.isZero,D.isNegative=function(){return!this.unsigned&&0>this.high},D.isPositive=function(){return this.unsigned||0<=this.high},D.isOdd=function(){return(1&this.low)==1},D.isEven=function(){return(1&this.low)==0},D.equals=function(o){return mb(o)||(o=Wb(o)),(this.unsigned===o.unsigned||this.high>>>31!=1||o.high>>>31!=1)&&this.high===o.high&&this.low===o.low},D.eq=D.equals,D.notEquals=function(o){return!this.eq(o)},D.neq=D.notEquals,D.ne=D.notEquals,D.lessThan=function(o){return 0>this.comp(o)},D.lt=D.lessThan,D.lessThanOrEqual=function(o){return 0>=this.comp(o)},D.lte=D.lessThanOrEqual,D.le=D.lessThanOrEqual,D.greaterThan=function(o){return 0<this.comp(o)},D.gt=D.greaterThan,D.greaterThanOrEqual=function(o){return 0<=this.comp(o)},D.gte=D.greaterThanOrEqual,D.ge=D.greaterThanOrEqual,D.compare=function(o){if(mb(o)||(o=Wb(o)),this.eq(o))return 0;var e=this.isNegative(),d=o.isNegative();return e&&!d?-1:!e&&d?1:this.unsigned?o.high>>>0>this.high>>>0||o.high===this.high&&o.low>>>0>this.low>>>0?-1:1:this.sub(o).isNegative()?-1:1},D.comp=D.compare,D.negate=function(){return!this.unsigned&&this.eq(nb)?nb:this.not().add(Ue)},D.neg=D.negate,D.add=function(o){mb(o)||(o=Wb(o));var e=this.high>>>16,d=65535&this.high,h=this.low>>>16,f=o.high>>>16,g=65535&o.high,A=o.low>>>16;return h=(A=((o=(65535&this.low)+(65535&o.low))>>>16)+(h+A))>>>16,ya((65535&A)<<16|65535&o,(e=((h+=d+g)>>>16)+(e+f)&65535)<<16|65535&h,this.unsigned)},D.subtract=function(o){return mb(o)||(o=Wb(o)),this.add(o.neg())},D.sub=D.subtract,D.multiply=function(o){if(this.isZero())return Hb;if(mb(o)||(o=Wb(o)),Qb){var e=Qb.mul(this.low,this.high,o.low,o.high);return ya(e,Qb.get_high(),this.unsigned)}if(o.isZero())return Hb;if(this.eq(nb))return o.isOdd()?nb:Hb;if(o.eq(nb))return this.isOdd()?nb:Hb;if(this.isNegative())return o.isNegative()?this.neg().mul(o.neg()):this.neg().mul(o).neg();if(o.isNegative())return this.mul(o.neg()).neg();if(this.lt(wq)&&o.lt(wq))return Gb(this.toNumber()*o.toNumber(),this.unsigned);e=this.high>>>16;var d=65535&this.high,h=this.low>>>16,f=65535&this.low,g=o.high>>>16,A=65535&o.high,C=o.low>>>16,k=f*(o=65535&o.low),j=(k>>>16)+h*o,_t=j>>>16;_t+=(j=(65535&j)+f*C)>>>16;var _n=(_t+=d*o)>>>16;return ya((65535&j)<<16|65535&k,(_n=(_n+=(_t=(65535&_t)+h*C)>>>16)+((_t=(65535&_t)+f*A)>>>16)+(e*o+d*C+h*A+f*g)&65535)<<16|65535&_t,this.unsigned)},D.mul=D.multiply,D.divide=function(o){if(mb(o)||(o=Wb(o)),o.isZero())throw Error("division by zero");if(Qb)return this.unsigned||this.high!==-2147483648||o.low!==-1||o.high!==-1?ya(o=(this.unsigned?Qb.div_u:Qb.div_s)(this.low,this.high,o.low,o.high),Qb.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Cd:Hb;if(this.unsigned){if(o.unsigned||(o=o.toUnsigned()),o.gt(this))return Cd;if(o.gt(this.shru(1)))return xq;var e=Cd}else{if(this.eq(nb)){if(o.eq(Ue)||o.eq(Kk))return nb;if(o.eq(nb))return Ue;var d=this.shr(1).div(o).shl(1);if(d.eq(Hb))return o.isNegative()?Ue:Kk;var h=this.sub(o.mul(d));return d.add(h.div(o))}if(o.eq(nb))return this.unsigned?Cd:Hb;if(this.isNegative())return o.isNegative()?this.neg().div(o.neg()):this.neg().div(o).neg();if(o.isNegative())return this.div(o.neg()).neg();e=Hb}for(h=this;h.gte(o);){d=Math.max(1,Math.floor(h.toNumber()/o.toNumber()));var f=Math.ceil(Math.log(d)/Math.LN2);f=48>=f?1:sg(2,f-48);for(var g=Gb(d),A=g.mul(o);A.isNegative()||A.gt(h);)A=(g=Gb(d-=f,this.unsigned)).mul(o);g.isZero()&&(g=Ue),e=e.add(g),h=h.sub(A)}return e},D.div=D.divide,D.modulo=function(o){return mb(o)||(o=Wb(o)),Qb?ya(o=(this.unsigned?Qb.rem_u:Qb.rem_s)(this.low,this.high,o.low,o.high),Qb.get_high(),this.unsigned):this.sub(this.div(o).mul(o))},D.mod=D.modulo,D.rem=D.modulo,D.not=function(){return ya(~this.low,~this.high,this.unsigned)},D.and=function(o){return mb(o)||(o=Wb(o)),ya(this.low&o.low,this.high&o.high,this.unsigned)},D.or=function(o){return mb(o)||(o=Wb(o)),ya(this.low|o.low,this.high|o.high,this.unsigned)},D.xor=function(o){return mb(o)||(o=Wb(o)),ya(this.low^o.low,this.high^o.high,this.unsigned)},D.shiftLeft=function(o){return mb(o)&&(o=o.toInt()),(o&=63)==0?this:32>o?ya(this.low<<o,this.high<<o|this.low>>>32-o,this.unsigned):ya(0,this.low<<o-32,this.unsigned)},D.shl=D.shiftLeft,D.shiftRight=function(o){return mb(o)&&(o=o.toInt()),(o&=63)==0?this:32>o?ya(this.low>>>o|this.high<<32-o,this.high>>o,this.unsigned):ya(this.high>>o-32,0<=this.high?0:-1,this.unsigned)},D.shr=D.shiftRight,D.shiftRightUnsigned=function(o){if(mb(o)&&(o=o.toInt()),(o&=63)===0)return this;var e=this.high;return 32>o?ya(this.low>>>o|e<<32-o,e>>>o,this.unsigned):ya(o===32?e:e>>>o-32,0,this.unsigned)},D.shru=D.shiftRightUnsigned,D.shr_u=D.shiftRightUnsigned,D.toSigned=function(){return this.unsigned?ya(this.low,this.high,!1):this},D.toUnsigned=function(){return this.unsigned?this:ya(this.low,this.high,!0)},D.toBytes=function(o){return o?this.toBytesLE():this.toBytesBE()},D.toBytesLE=function(){var o=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&o,o>>>8&255,o>>>16&255,o>>>24]},D.toBytesBE=function(){var o=this.high,e=this.low;return[o>>>24,o>>>16&255,o>>>8&255,255&o,e>>>24,e>>>16&255,e>>>8&255,255&e]},xa.fromBytes=function(o,e,d){return d?xa.fromBytesLE(o,e):xa.fromBytesBE(o,e)},xa.fromBytesLE=function(o,e){return new xa(o[0]|o[1]<<8|o[2]<<16|o[3]<<24,o[4]|o[5]<<8|o[6]<<16|o[7]<<24,e)},xa.fromBytesBE=function(o,e){return new xa(o[4]<<24|o[5]<<16|o[6]<<8|o[7],o[0]<<24|o[1]<<16|o[2]<<8|o[3],e)};var di=function(o,e){return(di=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,h){d.__proto__=h}||function(d,h){for(var f in h)h.hasOwnProperty(f)&&(d[f]=h[f])})(o,e)},Lk=!1,Ib={Promise:void 0,set useDeprecatedSynchronousErrorHandling(o){o?console.warn(`DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: 
`+Error().stack):Lk&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),Lk=o},get useDeprecatedSynchronousErrorHandling(){return Lk}},Eh={closed:!0,next:function(o){},error:function(o){if(Ib.useDeprecatedSynchronousErrorHandling)throw o;me(o)},complete:function(){}},Jb=Array.isArray||function(o){return o&&typeof o.length=="number"},lf=function(){function o(e){return Error.call(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(d,h){return h+1+") "+d.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e,this}return o.prototype=Object.create(Error.prototype),o}(),Oa=function(){function o(e){this.closed=!1,this._subscriptions=this._parentOrParents=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return o.prototype.unsubscribe=function(){if(!this.closed){var e=this._parentOrParents,d=this._ctorUnsubscribe,h=this._unsubscribe,f=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,e instanceof o)e.remove(this);else if(e!==null)for(var g=0;g<e.length;++g)e[g].remove(this);if(le(h)){d&&(this._unsubscribe=void 0);try{h.call(this)}catch(C){var A=C instanceof lf?Xl(C.errors):[C]}}if(Jb(f)){for(g=-1,e=f.length;++g<e;)if(ei(d=f[g]))try{d.unsubscribe()}catch(C){A=A||[],C instanceof lf?A=A.concat(Xl(C.errors)):A.push(C)}}if(A)throw new lf(A)}},o.prototype.add=function(e){var d=e;if(!e)return o.EMPTY;switch(X(e)){case"function":d=new o(e);case"object":if(d===this||d.closed||typeof d.unsubscribe!="function")return d;if(this.closed)return d.unsubscribe(),d;d instanceof o||(e=d,(d=new o)._subscriptions=[e]);break;default:throw Error("unrecognized teardown "+e+" added to Subscription.")}if((e=d._parentOrParents)===null)d._parentOrParents=this;else if(e instanceof o){if(e===this)return d;d._parentOrParents=[e,this]}else{if(e.indexOf(this)!==-1)return d;e.push(this)}return(e=this._subscriptions)===null?this._subscriptions=[d]:e.push(d),d},o.prototype.remove=function(e){var d=this._subscriptions;d&&(e=d.indexOf(e))!==-1&&d.splice(e,1)},o.EMPTY=function(e){return e.closed=!0,e}(new o),o}(),Fh=typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),ia=function(o){function e(d,h,f){var g=o.call(this)||this;switch(g.syncErrorValue=null,g.syncErrorThrown=!1,g.syncErrorThrowable=!1,g.isStopped=!1,arguments.length){case 0:g.destination=Eh;break;case 1:if(!d){g.destination=Eh;break}if(X(d)==="object"){d instanceof e?(g.syncErrorThrowable=d.syncErrorThrowable,g.destination=d,d.add(g)):(g.syncErrorThrowable=!0,g.destination=new yq(g,d));break}default:g.syncErrorThrowable=!0,g.destination=new yq(g,d,h,f)}return g}return O(e,o),e.prototype[Fh]=function(){return this},e.create=function(d,h,f){return(d=new e(d,h,f)).syncErrorThrowable=!1,d},e.prototype.next=function(d){this.isStopped||this._next(d)},e.prototype.error=function(d){this.isStopped||(this.isStopped=!0,this._error(d))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,o.prototype.unsubscribe.call(this))},e.prototype._next=function(d){this.destination.next(d)},e.prototype._error=function(d){this.destination.error(d),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var d=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=d,this},e}(Oa),yq=function(o){function e(d,h,f,g){var A=o.call(this)||this;if(A._parentSubscriber=d,d=A,le(h))var C=h;else h&&(C=h.next,f=h.error,g=h.complete,h!==Eh&&(le((d=Object.create(h)).unsubscribe)&&A.add(d.unsubscribe.bind(d)),d.unsubscribe=A.unsubscribe.bind(A)));return A._context=d,A._next=C,A._error=f,A._complete=g,A}return O(e,o),e.prototype.next=function(d){if(!this.isStopped&&this._next){var h=this._parentSubscriber;Ib.useDeprecatedSynchronousErrorHandling&&h.syncErrorThrowable?this.__tryOrSetError(h,this._next,d)&&this.unsubscribe():this.__tryOrUnsub(this._next,d)}},e.prototype.error=function(d){if(!this.isStopped){var h=this._parentSubscriber,f=Ib.useDeprecatedSynchronousErrorHandling;if(this._error)f&&h.syncErrorThrowable?this.__tryOrSetError(h,this._error,d):this.__tryOrUnsub(this._error,d),this.unsubscribe();else if(h.syncErrorThrowable)f?(h.syncErrorValue=d,h.syncErrorThrown=!0):me(d),this.unsubscribe();else{if(this.unsubscribe(),f)throw d;me(d)}}},e.prototype.complete=function(){var d=this;if(!this.isStopped){var h=this._parentSubscriber;if(this._complete){var f=function(){return d._complete.call(d._context)};Ib.useDeprecatedSynchronousErrorHandling&&h.syncErrorThrowable?this.__tryOrSetError(h,f):this.__tryOrUnsub(f)}this.unsubscribe()}},e.prototype.__tryOrUnsub=function(d,h){try{d.call(this._context,h)}catch(f){if(this.unsubscribe(),Ib.useDeprecatedSynchronousErrorHandling)throw f;me(f)}},e.prototype.__tryOrSetError=function(d,h,f){if(!Ib.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{h.call(this._context,f)}catch(g){return Ib.useDeprecatedSynchronousErrorHandling?(d.syncErrorValue=g,d.syncErrorThrown=!0):me(g),!0}return!1},e.prototype._unsubscribe=function(){var d=this._parentSubscriber;this._parentSubscriber=this._context=null,d.unsubscribe()},e}(ia),ne=typeof Symbol=="function"&&Symbol.observable||"@@observable",Y=function(){function o(e){this._isScalar=!1,e&&(this._subscribe=e)}return o.prototype.lift=function(e){var d=new o;return d.source=this,d.operator=e,d},o.prototype.subscribe=function(e,d,h){var f=this.operator;t:{if(e){if(e instanceof ia)break t;if(e[Fh]){e=e[Fh]();break t}}e=e||d||h?new ia(e,d,h):new ia(Eh)}if(f?e.add(f.call(e,this.source)):e.add(this.source||Ib.useDeprecatedSynchronousErrorHandling&&!e.syncErrorThrowable?this._subscribe(e):this._trySubscribe(e)),Ib.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable&&(e.syncErrorThrowable=!1,e.syncErrorThrown))throw e.syncErrorValue;return e},o.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(d){Ib.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=d),fi(e)?e.error(d):console.warn(d)}},o.prototype.forEach=function(e,d){var h=this;return new(d=Zl(d))(function(f,g){var A=h.subscribe(function(C){try{e(C)}catch(k){g(k),A&&A.unsubscribe()}},g,f)})},o.prototype._subscribe=function(e){var d=this.source;return d&&d.subscribe(e)},o.prototype[ne]=function(){return this},o.prototype.pipe=function(){for(var e=[],d=0;d<arguments.length;d++)e[d]=arguments[d];return e.length===0?this:Yl(e)(this)},o.prototype.toPromise=function(e){var d=this;return new(e=Zl(e))(function(h,f){var g;d.subscribe(function(A){return g=A},function(A){return f(A)},function(){return h(g)})})},o.create=function(e){return new o(e)},o}(),qd=function(){function o(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return o.prototype=Object.create(Error.prototype),o}(),zq=function(o){function e(d,h){var f=o.call(this)||this;return f.subject=d,f.subscriber=h,f.closed=!1,f}return O(e,o),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var d=this.subject,h=d.observers;this.subject=null,!h||h.length===0||d.isStopped||d.closed||(d=h.indexOf(this.subscriber))!==-1&&h.splice(d,1)}},e}(Oa),Aq=function(o){function e(d){var h=o.call(this,d)||this;return h.destination=d,h}return O(e,o),e}(ia),Pa=function(o){function e(){var d=o.call(this)||this;return d.observers=[],d.closed=!1,d.isStopped=!1,d.hasError=!1,d.thrownError=null,d}return O(e,o),e.prototype[Fh]=function(){return new Aq(this)},e.prototype.lift=function(d){var h=new Bq(this,this);return h.operator=d,h},e.prototype.next=function(d){if(this.closed)throw new qd;if(!this.isStopped){var h=this.observers,f=h.length;h=h.slice();for(var g=0;g<f;g++)h[g].next(d)}},e.prototype.error=function(d){if(this.closed)throw new qd;this.hasError=!0,this.thrownError=d,this.isStopped=!0;var h=this.observers,f=h.length;h=h.slice();for(var g=0;g<f;g++)h[g].error(d);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new qd;this.isStopped=!0;var d=this.observers,h=d.length;d=d.slice();for(var f=0;f<h;f++)d[f].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},e.prototype._trySubscribe=function(d){if(this.closed)throw new qd;return o.prototype._trySubscribe.call(this,d)},e.prototype._subscribe=function(d){if(this.closed)throw new qd;return this.hasError?(d.error(this.thrownError),Oa.EMPTY):this.isStopped?(d.complete(),Oa.EMPTY):(this.observers.push(d),new zq(this,d))},e.prototype.asObservable=function(){var d=new Y;return d.source=this,d},e.create=function(d,h){return new Bq(d,h)},e}(Y),Bq=function(o){function e(d,h){var f=o.call(this)||this;return f.destination=d,f.source=h,f}return O(e,o),e.prototype.next=function(d){var h=this.destination;h&&h.next&&h.next(d)},e.prototype.error=function(d){var h=this.destination;h&&h.error&&this.destination.error(d)},e.prototype.complete=function(){var d=this.destination;d&&d.complete&&this.destination.complete()},e.prototype._subscribe=function(d){return this.source?this.source.subscribe(d):Oa.EMPTY},e}(Pa),Ns=function(){function o(e){this.connectable=e}return o.prototype.call=function(e,d){var h=this.connectable;return h._refCount++,e=new cz(e,h),d=d.subscribe(e),e.closed||(e.connection=h.connect()),d},o}(),cz=function(o){function e(d,h){return(d=o.call(this,d)||this).connectable=h,d}return O(e,o),e.prototype._unsubscribe=function(){var d=this.connectable;if(d){this.connectable=null;var h=d._refCount;0>=h?this.connection=null:(d._refCount=h-1,1<h?this.connection=null:(h=this.connection,d=d._connection,this.connection=null,!d||h&&d!==h||d.unsubscribe()))}else this.connection=null},e}(ia),Cq=function(o){function e(d,h){var f=o.call(this)||this;return f.source=d,f.subjectFactory=h,f._refCount=0,f._isComplete=!1,f}return O(e,o),e.prototype._subscribe=function(d){return this.getSubject().subscribe(d)},e.prototype.getSubject=function(){var d=this._subject;return d&&!d.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var d=this._connection;return d||(this._isComplete=!1,(d=this._connection=new Oa).add(this.source.subscribe(new dz(this.getSubject(),this))),d.closed&&(this._connection=null,d=Oa.EMPTY)),d},e.prototype.refCount=function(){return $l()(this)},e}(Y),At=function(){var o=Cq.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:o._subscribe},_isComplete:{value:o._isComplete,writable:!0},getSubject:{value:o.getSubject},connect:{value:o.connect},refCount:{value:o.refCount}}}(),dz=function(o){function e(d,h){return(d=o.call(this,d)||this).connectable=h,d}return O(e,o),e.prototype._error=function(d){this._unsubscribe(),o.prototype._error.call(this,d)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),o.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var d=this.connectable;if(d){this.connectable=null;var h=d._connection;d._refCount=0,d._subject=null,d._connection=null,h&&h.unsubscribe()}},e}(Aq);(function(o){function e(d,h){return(d=o.call(this,d)||this).connectable=h,d}O(e,o),e.prototype._unsubscribe=function(){var d=this.connectable;if(d){this.connectable=null;var h=d._refCount;0>=h?this.connection=null:(d._refCount=h-1,1<h?this.connection=null:(h=this.connection,d=d._connection,this.connection=null,!d||h&&d!==h||d.unsubscribe()))}else this.connection=null}})(ia),function(o){function e(d,h,f,g,A){return(d=o.call(this,d)||this).keySelector=h,d.elementSelector=f,d.durationSelector=g,d.subjectSelector=A,d.groups=null,d.attemptedToUnsubscribe=!1,d.count=0,d}O(e,o),e.prototype._next=function(d){try{var h=this.keySelector(d)}catch(f){return void this.error(f)}this._group(d,h)},e.prototype._group=function(d,h){var f=this.groups;f||(f=this.groups=new Map);var g=f.get(h);if(this.elementSelector)try{var A=this.elementSelector(d)}catch(C){this.error(C)}else A=d;if(!g&&(g=this.subjectSelector?this.subjectSelector():new Pa,f.set(h,g),d=new Mk(h,g,this),this.destination.next(d),this.durationSelector)){d=void 0;try{d=this.durationSelector(new Mk(h,g))}catch(C){return void this.error(C)}this.add(d.subscribe(new ez(h,g,this)))}g.closed||g.next(A)},e.prototype._error=function(d){var h=this.groups;h&&(h.forEach(function(f,g){f.error(d)}),h.clear()),this.destination.error(d)},e.prototype._complete=function(){var d=this.groups;d&&(d.forEach(function(h,f){h.complete()}),d.clear()),this.destination.complete()},e.prototype.removeGroup=function(d){this.groups.delete(d)},e.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,this.count===0&&o.prototype.unsubscribe.call(this))}}(ia);var ez=function(o){function e(d,h,f){var g=o.call(this,h)||this;return g.key=d,g.group=h,g.parent=f,g}return O(e,o),e.prototype._next=function(d){this.complete()},e.prototype._unsubscribe=function(){var d=this.parent,h=this.key;this.key=this.parent=null,d&&d.removeGroup(h)},e}(ia),Mk=function(o){function e(d,h,f){var g=o.call(this)||this;return g.key=d,g.groupSubject=h,g.refCountSubscription=f,g}return O(e,o),e.prototype._subscribe=function(d){var h=new Oa,f=this.refCountSubscription,g=this.groupSubject;return f&&!f.closed&&h.add(new fz(f)),h.add(g.subscribe(d)),h},e}(Y),fz=function(o){function e(d){var h=o.call(this)||this;return h.parent=d,d.count++,h}return O(e,o),e.prototype.unsubscribe=function(){var d=this.parent;d.closed||this.closed||(o.prototype.unsubscribe.call(this),--d.count,d.count===0&&d.attemptedToUnsubscribe&&d.unsubscribe())},e}(Oa),gz=function(o){function e(d){var h=o.call(this)||this;return h._value=d,h}return O(e,o),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(d){var h=o.prototype._subscribe.call(this,d);return h&&!h.closed&&d.next(this._value),h},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new qd;return this._value},e.prototype.next=function(d){o.prototype.next.call(this,this._value=d)},e}(Pa),dg=function(o){function e(d,h){var f=o.call(this,d,h)||this;return f.scheduler=d,f.work=h,f.pending=!1,f}return O(e,o),e.prototype.schedule=function(d,h){if(h===void 0&&(h=0),this.closed)return this;this.state=d,d=this.id;var f=this.scheduler;return d!=null&&(this.id=this.recycleAsyncId(f,d,h)),this.pending=!0,this.delay=h,this.id=this.id||this.requestAsyncId(f,this.id,h),this},e.prototype.requestAsyncId=function(d,h,f){return f===void 0&&(f=0),setInterval(d.flush.bind(d,this),f)},e.prototype.recycleAsyncId=function(d,h,f){if(f===void 0&&(f=0),f!==null&&this.delay===f&&this.pending===!1)return h;clearInterval(h)},e.prototype.execute=function(d,h){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(d=this._execute(d,h))?d:void(this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},e.prototype._execute=function(d,h){h=!1;var f=void 0;try{this.work(d)}catch(g){h=!0,f=!!g&&g||Error(g)}if(h)return this.unsubscribe(),f},e.prototype._unsubscribe=function(){var d=this.id,h=this.scheduler,f=h.actions,g=f.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,g!==-1&&f.splice(g,1),d!=null&&(this.id=this.recycleAsyncId(h,d,null)),this.delay=null},e}(function(o){function e(d,h){return o.call(this)||this}return O(e,o),e.prototype.schedule=function(d,h){return this},e}(Oa)),hz=function(o){function e(d,h){var f=o.call(this,d,h)||this;return f.scheduler=d,f.work=h,f}return O(e,o),e.prototype.schedule=function(d,h){return h===void 0&&(h=0),0<h?o.prototype.schedule.call(this,d,h):(this.delay=h,this.state=d,this.scheduler.flush(this),this)},e.prototype.execute=function(d,h){return 0<h||this.closed?o.prototype.execute.call(this,d,h):this._execute(d,h)},e.prototype.requestAsyncId=function(d,h,f){return f===void 0&&(f=0),f!==null&&0<f||f===null&&0<this.delay?o.prototype.requestAsyncId.call(this,d,h,f):d.flush(this)},e}(dg),Nk=function(){function o(e,d){d===void 0&&(d=o.now),this.SchedulerAction=e,this.now=d}return o.prototype.schedule=function(e,d,h){return d===void 0&&(d=0),new this.SchedulerAction(this,e).schedule(h,d)},o.now=function(){return Date.now()},o}(),eg=function(o){function e(d,h){h===void 0&&(h=Nk.now);var f=o.call(this,d,function(){return e.delegate&&e.delegate!==f?e.delegate.now():h()})||this;return f.actions=[],f.active=!1,f.scheduled=void 0,f}return O(e,o),e.prototype.schedule=function(d,h,f){return h===void 0&&(h=0),e.delegate&&e.delegate!==this?e.delegate.schedule(d,h,f):o.prototype.schedule.call(this,d,h,f)},e.prototype.flush=function(d){var h=this.actions;if(this.active)h.push(d);else{var f;this.active=!0;do if(f=d.execute(d.state,d.delay))break;while(d=h.shift());if(this.active=!1,f){for(;d=h.shift();)d.unsubscribe();throw f}}},e}(Nk),fg=new(function(o){function e(){return o!==null&&o.apply(this,arguments)||this}return O(e,o),e}(eg))(hz),vb=new Y(function(o){return o.complete()}),am=function(o){return function(e){for(var d=0,h=o.length;d<h&&!e.closed;d++)e.next(o[d]);e.complete()}},Ok;(function(o){o.NEXT="N",o.ERROR="E",o.COMPLETE="C"})(Ok||(Ok={}));var Ve=function(){function o(e,d,h){this.kind=e,this.value=d,this.error=h,this.hasValue=e==="N"}return o.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},o.prototype.do=function(e,d,h){switch(this.kind){case"N":return e&&e(this.value);case"E":return d&&d(this.error);case"C":return h&&h()}},o.prototype.accept=function(e,d,h){return e&&typeof e.next=="function"?this.observe(e):this.do(e,d,h)},o.prototype.toObservable=function(){switch(this.kind){case"N":return bb(this.value);case"E":return Z(this.error);case"C":return mf()}throw Error("unexpected notification kind value")},o.createNext=function(e){return e!==void 0?new o("N",e):o.undefinedValueNotification},o.createError=function(e){return new o("E",void 0,e)},o.createComplete=function(){return o.completeNotification},o.completeNotification=new o("C"),o.undefinedValueNotification=new o("N",void 0),o}(),Rs=function(){function o(e,d){d===void 0&&(d=0),this.scheduler=e,this.delay=d}return o.prototype.call=function(e,d){return d.subscribe(new Dq(e,this.scheduler,this.delay))},o}(),Dq=function(o){function e(d,h,f){return f===void 0&&(f=0),(d=o.call(this,d)||this).scheduler=h,d.delay=f,d}return O(e,o),e.dispatch=function(d){d.notification.observe(d.destination),this.unsubscribe()},e.prototype.scheduleMessage=function(d){this.destination.add(this.scheduler.schedule(e.dispatch,this.delay,new iz(d,this.destination)))},e.prototype._next=function(d){this.scheduleMessage(Ve.createNext(d))},e.prototype._error=function(d){this.scheduleMessage(Ve.createError(d)),this.unsubscribe()},e.prototype._complete=function(){this.scheduleMessage(Ve.createComplete()),this.unsubscribe()},e}(ia),iz=function(o,e){this.notification=o,this.destination=e},qe=function(o){function e(d,h,f){d===void 0&&(d=Number.POSITIVE_INFINITY),h===void 0&&(h=Number.POSITIVE_INFINITY);var g=o.call(this)||this;return g.scheduler=f,g._events=[],g._infiniteTimeWindow=!1,g._bufferSize=1>d?1:d,g._windowTime=1>h?1:h,h===Number.POSITIVE_INFINITY?(g._infiniteTimeWindow=!0,g.next=g.nextInfiniteTimeWindow):g.next=g.nextTimeWindow,g}return O(e,o),e.prototype.nextInfiniteTimeWindow=function(d){if(!this.isStopped){var h=this._events;h.push(d),h.length>this._bufferSize&&h.shift()}o.prototype.next.call(this,d)},e.prototype.nextTimeWindow=function(d){this.isStopped||(this._events.push(new jz(this._getNow(),d)),this._trimBufferThenGetEvents()),o.prototype.next.call(this,d)},e.prototype._subscribe=function(d){var h=this._infiniteTimeWindow,f=h?this._events:this._trimBufferThenGetEvents(),g=this.scheduler,A=f.length;if(this.closed)throw new qd;if(this.isStopped||this.hasError)var C=Oa.EMPTY;else this.observers.push(d),C=new zq(this,d);if(g&&d.add(d=new Dq(d,g)),h)for(h=0;h<A&&!d.closed;h++)d.next(f[h]);else for(h=0;h<A&&!d.closed;h++)d.next(f[h].value);return this.hasError?d.error(this.thrownError):this.isStopped&&d.complete(),C},e.prototype._getNow=function(){return(this.scheduler||fg).now()},e.prototype._trimBufferThenGetEvents=function(){for(var d=this._getNow(),h=this._bufferSize,f=this._windowTime,g=this._events,A=g.length,C=0;C<A&&!(d-g[C].time<f);)C++;return A>h&&(C=Math.max(C,A-h)),0<C&&g.splice(0,C),g},e}(Pa),jz=function(o,e){this.time=o,this.value=e},of=function(o){function e(){var d=o!==null&&o.apply(this,arguments)||this;return d.value=null,d.hasNext=!1,d.hasCompleted=!1,d}return O(e,o),e.prototype._subscribe=function(d){return this.hasError?(d.error(this.thrownError),Oa.EMPTY):this.hasCompleted&&this.hasNext?(d.next(this.value),d.complete(),Oa.EMPTY):o.prototype._subscribe.call(this,d)},e.prototype.next=function(d){this.hasCompleted||(this.value=d,this.hasNext=!0)},e.prototype.error=function(d){this.hasCompleted||o.prototype.error.call(this,d)},e.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&o.prototype.next.call(this,this.value),o.prototype.complete.call(this)},e}(Pa),kz=1,lz=Promise.resolve(),ii={},Eq={setImmediate:function(o){var e=kz++;return ii[e]=!0,lz.then(function(){return bm(e)&&o()}),e},clearImmediate:function(o){bm(o)}},mz=function(o){function e(d,h){var f=o.call(this,d,h)||this;return f.scheduler=d,f.work=h,f}return O(e,o),e.prototype.requestAsyncId=function(d,h,f){return f===void 0&&(f=0),f!==null&&0<f?o.prototype.requestAsyncId.call(this,d,h,f):(d.actions.push(this),d.scheduled||(d.scheduled=Eq.setImmediate(d.flush.bind(d,null))))},e.prototype.recycleAsyncId=function(d,h,f){if(f===void 0&&(f=0),f!==null&&0<f||f===null&&0<this.delay)return o.prototype.recycleAsyncId.call(this,d,h,f);d.actions.length===0&&(Eq.clearImmediate(h),d.scheduled=void 0)},e}(dg),ri=new(function(o){function e(){return o!==null&&o.apply(this,arguments)||this}return O(e,o),e.prototype.flush=function(d){this.active=!0,this.scheduled=void 0;var h,f=this.actions,g=-1,A=f.length;d=d||f.shift();do if(h=d.execute(d.state,d.delay))break;while(++g<A&&(d=f.shift()));if(this.active=!1,h){for(;++g<A&&(d=f.shift());)d.unsubscribe();throw h}},e}(eg))(mz),nz=ri,Pk=new eg(dg),bd=Pk,oz=function(o){function e(d,h){var f=o.call(this,d,h)||this;return f.scheduler=d,f.work=h,f}return O(e,o),e.prototype.requestAsyncId=function(d,h,f){return f===void 0&&(f=0),f!==null&&0<f?o.prototype.requestAsyncId.call(this,d,h,f):(d.actions.push(this),d.scheduled||(d.scheduled=requestAnimationFrame(function(){return d.flush(null)})))},e.prototype.recycleAsyncId=function(d,h,f){if(f===void 0&&(f=0),f!==null&&0<f||f===null&&0<this.delay)return o.prototype.recycleAsyncId.call(this,d,h,f);d.actions.length===0&&(cancelAnimationFrame(h),d.scheduled=void 0)},e}(dg),Fq=new(function(o){function e(){return o!==null&&o.apply(this,arguments)||this}return O(e,o),e.prototype.flush=function(d){this.active=!0,this.scheduled=void 0;var h,f=this.actions,g=-1,A=f.length;d=d||f.shift();do if(h=d.execute(d.state,d.delay))break;while(++g<A&&(d=f.shift()));if(this.active=!1,h){for(;++g<A&&(d=f.shift());)d.unsubscribe();throw h}},e}(eg))(oz),pz=function(o){function e(d,h){d===void 0&&(d=Gq),h===void 0&&(h=Number.POSITIVE_INFINITY);var f=o.call(this,d,function(){return f.frame})||this;return f.maxFrames=h,f.frame=0,f.index=-1,f}return O(e,o),e.prototype.flush=function(){for(var d,h,f=this.actions,g=this.maxFrames;(h=f[0])&&h.delay<=g&&(f.shift(),this.frame=h.delay,!(d=h.execute(h.state,h.delay))););if(d){for(;h=f.shift();)h.unsubscribe();throw d}},e.frameTimeFactor=10,e}(eg),Gq=function(o){function e(d,h,f){f===void 0&&(f=d.index+=1);var g=o.call(this,d,h)||this;return g.scheduler=d,g.work=h,g.index=f,g.active=!0,g.index=d.index=f,g}return O(e,o),e.prototype.schedule=function(d,h){if(h===void 0&&(h=0),!this.id)return o.prototype.schedule.call(this,d,h);this.active=!1;var f=new e(this.scheduler,this.work);return this.add(f),f.schedule(d,h)},e.prototype.requestAsyncId=function(d,h,f){return f===void 0&&(f=0),this.delay=d.frame+f,(d=d.actions).push(this),d.sort(e.sortActions),!0},e.prototype.recycleAsyncId=function(d,h,f){},e.prototype._execute=function(d,h){if(this.active===!0)return o.prototype._execute.call(this,d,h)},e.sortActions=function(d,h){return d.delay===h.delay?d.index===h.index?0:d.index>h.index?1:-1:d.delay>h.delay?1:-1},e}(dg),Qk=function(){function o(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return o.prototype=Object.create(Error.prototype),o}(),vg=function(){function o(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return o.prototype=Object.create(Error.prototype),o}(),pb=function(){function o(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return o.prototype=Object.create(Error.prototype),o}(),Ss=function(){function o(e,d){this.project=e,this.thisArg=d}return o.prototype.call=function(e,d){return d.subscribe(new qz(e,this.project,this.thisArg))},o}(),qz=function(o){function e(d,h,f){return(d=o.call(this,d)||this).project=h,d.count=0,d.thisArg=f||d,d}return O(e,o),e.prototype._next=function(d){try{var h=this.project.call(this.thisArg,d,this.count++)}catch(f){return void this.destination.error(f)}this.destination.next(h)},e}(ia),Rk=function(o){function e(){return o!==null&&o.apply(this,arguments)||this}return O(e,o),e.prototype.notifyNext=function(d,h,f,g,A){this.destination.next(h)},e.prototype.notifyError=function(d,h){this.destination.error(d)},e.prototype.notifyComplete=function(d){this.destination.complete()},e}(ia),Xs=function(o){function e(d,h,f){var g=o.call(this)||this;return g.parent=d,g.outerValue=h,g.outerIndex=f,g.index=0,g}return O(e,o),e.prototype._next=function(d){this.parent.notifyNext(this.outerValue,d,this.outerIndex,this.index++,this)},e.prototype._error=function(d){this.parent.notifyError(d,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(ia),rz=function(o){return function(e){return o.then(function(d){e.closed||(e.next(d),e.complete())},function(d){return e.error(d)}).then(null,me),e}},$c=typeof Symbol=="function"&&Symbol.iterator?Symbol.iterator:"@@iterator",sz=function(o){return function(e){for(var d=o[$c]();;){var h=void 0;try{h=d.next()}catch(f){return e.error(f),e}if(h.done){e.complete();break}if(e.next(h.value),e.closed)break}return typeof d.return=="function"&&e.add(function(){d.return&&d.return()}),e}},tz=function(o){return function(e){var d=o[ne]();if(typeof d.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return d.subscribe(e)}},hm=function(o){return o&&typeof o.length=="number"&&typeof o!="function"},pf=function(o){if(o&&typeof o[ne]=="function")return tz(o);if(hm(o))return am(o);if(fm(o))return rz(o);if(o&&typeof o[$c]=="function")return sz(o);throw o=ei(o)?"an invalid object":"'"+o+"'",new TypeError("You provided "+o+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},Hq={},vz=function(){function o(e){this.resultSelector=e}return o.prototype.call=function(e,d){return d.subscribe(new uz(e,this.resultSelector))},o}(),uz=function(o){function e(d,h){return(d=o.call(this,d)||this).resultSelector=h,d.active=0,d.values=[],d.observables=[],d}return O(e,o),e.prototype._next=function(d){this.values.push(Hq),this.observables.push(d)},e.prototype._complete=function(){var d=this.observables,h=d.length;if(h===0)this.destination.complete();else{this.toRespond=this.active=h;for(var f=0;f<h;f++)this.add(ji(this,d[f],void 0,f))}},e.prototype.notifyComplete=function(d){--this.active==0&&this.destination.complete()},e.prototype.notifyNext=function(d,h,f){var g=(d=this.values)[f];g=this.toRespond?g===Hq?--this.toRespond:this.toRespond:0,d[f]=h,g===0&&(this.resultSelector?this._tryResultSelector(d):this.destination.next(d.slice()))},e.prototype._tryResultSelector=function(d){try{var h=this.resultSelector.apply(this,d)}catch(f){return void this.destination.error(f)}this.destination.next(h)},e}(Rk),vc=function(o){function e(d){var h=o.call(this)||this;return h.parent=d,h}return O(e,o),e.prototype._next=function(d){this.parent.notifyNext(d)},e.prototype._error=function(d){this.parent.notifyError(d),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(ia);(function(o){function e(d,h,f){var g=o.call(this)||this;return g.parent=d,g.outerValue=h,g.outerIndex=f,g}O(e,o),e.prototype._next=function(d){this.parent.notifyNext(this.outerValue,d,this.outerIndex,this)},e.prototype._error=function(d){this.parent.notifyError(d),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}})(ia);var wc=function(o){function e(){return o!==null&&o.apply(this,arguments)||this}return O(e,o),e.prototype.notifyNext=function(d){this.destination.next(d)},e.prototype.notifyError=function(d){this.destination.error(d)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(ia);(function(o){function e(){return o!==null&&o.apply(this,arguments)||this}O(e,o),e.prototype.notifyNext=function(d,h,f,g){this.destination.next(h)},e.prototype.notifyError=function(d){this.destination.error(d)},e.prototype.notifyComplete=function(d){this.destination.complete()}})(ia);var at=function(){function o(e,d){d===void 0&&(d=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=d}return o.prototype.call=function(e,d){return d.subscribe(new wz(e,this.project,this.concurrent))},o}(),wz=function(o){function e(d,h,f){return f===void 0&&(f=Number.POSITIVE_INFINITY),(d=o.call(this,d)||this).project=h,d.concurrent=f,d.hasCompleted=!1,d.buffer=[],d.active=0,d.index=0,d}return O(e,o),e.prototype._next=function(d){this.active<this.concurrent?this._tryNext(d):this.buffer.push(d)},e.prototype._tryNext=function(d){var h=this.index++;try{var f=this.project(d,h)}catch(g){return void this.destination.error(g)}this.active++,this._innerSub(f)},e.prototype._innerSub=function(d){var h=new vc(this),f=this.destination;f.add(h),(d=ic(d,h))!==h&&f.add(d)},e.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(d){this.destination.next(d)},e.prototype.notifyComplete=function(){var d=this.buffer;this.active--,0<d.length?this._next(d.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},e}(wc),Sk=y.parseFloat,Iq=-1/0!=1/Sk(`	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF-0`)?function(o){o=ik(String(o));var e=Sk(o);return e===0&&o.charAt(0)=="-"?-0:e}:Sk;N({global:!0,forced:parseFloat!=Iq},{parseFloat:Iq});var Tk=new Y(hc),ft=function(){function o(e,d){this.predicate=e,this.thisArg=d}return o.prototype.call=function(e,d){return d.subscribe(new xz(e,this.predicate,this.thisArg))},o}(),xz=function(o){function e(d,h,f){return(d=o.call(this,d)||this).predicate=h,d.thisArg=f,d.count=0,d}return O(e,o),e.prototype._next=function(d){try{var h=this.predicate.call(this.thisArg,d,this.count++)}catch(f){return void this.destination.error(f)}h&&this.destination.next(d)},e}(ia),gt=function(){function o(){}return o.prototype.call=function(e,d){return d.subscribe(new yz(e))},o}(),yz=function(o){function e(d){return(d=o.call(this,d)||this).hasFirst=!1,d.observables=[],d.subscriptions=[],d}return O(e,o),e.prototype._next=function(d){this.observables.push(d)},e.prototype._complete=function(){var d=this.observables,h=d.length;if(h===0)this.destination.complete();else{for(var f=0;f<h&&!this.hasFirst;f++){var g=ji(this,d[f],void 0,f);this.subscriptions&&this.subscriptions.push(g),this.add(g)}this.observables=null}},e.prototype.notifyNext=function(d,h,f){if(!this.hasFirst){for(this.hasFirst=!0,d=0;d<this.subscriptions.length;d++)if(d!==f){var g=this.subscriptions[d];g.unsubscribe(),this.remove(g)}this.subscriptions=null}this.destination.next(h)},e}(Rk),jt=function(){function o(e){this.resultSelector=e}return o.prototype.call=function(e,d){return d.subscribe(new zz(e,this.resultSelector))},o}(),zz=function(o){function e(d,h,f){return(d=o.call(this,d)||this).resultSelector=h,d.iterators=[],d.active=0,d.resultSelector=typeof h=="function"?h:void 0,d}return O(e,o),e.prototype._next=function(d){var h=this.iterators;Jb(d)?h.push(new Az(d)):typeof d[$c]=="function"?h.push(new Bz(d[$c]())):h.push(new Cz(this.destination,this,d))},e.prototype._complete=function(){var d=this.iterators,h=d.length;if(this.unsubscribe(),h===0)this.destination.complete();else{this.active=h;for(var f=0;f<h;f++){var g=d[f];g.stillUnsubscribed?this.destination.add(g.subscribe()):this.active--}}},e.prototype.notifyInactive=function(){this.active--,this.active===0&&this.destination.complete()},e.prototype.checkIterators=function(){for(var d=this.iterators,h=d.length,f=this.destination,g=0;g<h;g++){var A=d[g];if(typeof A.hasValue=="function"&&!A.hasValue())return}var C=!1,k=[];for(g=0;g<h;g++){var j=(A=d[g]).next();if(A.hasCompleted()&&(C=!0),j.done)return void f.complete();k.push(j.value)}this.resultSelector?this._tryresultSelector(k):f.next(k),C&&f.complete()},e.prototype._tryresultSelector=function(d){try{var h=this.resultSelector.apply(this,d)}catch(f){return void this.destination.error(f)}this.destination.next(h)},e}(ia),Bz=function(){function o(e){this.iterator=e,this.nextResult=e.next()}return o.prototype.hasValue=function(){return!0},o.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},o.prototype.hasCompleted=function(){var e=this.nextResult;return!(!e||!e.done)},o}(),Az=function(){function o(e){this.array=e,this.length=this.index=0,this.length=e.length}return o.prototype[$c]=function(){return this},o.prototype.next=function(e){e=this.index++;var d=this.array;return e<this.length?{value:d[e],done:!1}:{value:null,done:!0}},o.prototype.hasValue=function(){return this.array.length>this.index},o.prototype.hasCompleted=function(){return this.array.length===this.index},o}(),Cz=function(o){function e(d,h,f){return(d=o.call(this,d)||this).parent=h,d.observable=f,d.stillUnsubscribed=!0,d.buffer=[],d.isComplete=!1,d}return O(e,o),e.prototype[$c]=function(){return this},e.prototype.next=function(){var d=this.buffer;return d.length===0&&this.isComplete?{value:null,done:!0}:{value:d.shift(),done:!1}},e.prototype.hasValue=function(){return 0<this.buffer.length},e.prototype.hasCompleted=function(){return this.buffer.length===0&&this.isComplete},e.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},e.prototype.notifyNext=function(d){this.buffer.push(d),this.parent.checkIterators()},e.prototype.subscribe=function(){return ic(this.observable,new vc(this))},e}(wc),Dz=Object.freeze({__proto__:null,Observable:Y,ConnectableObservable:Cq,GroupedObservable:Mk,observable:ne,Subject:Pa,BehaviorSubject:gz,ReplaySubject:qe,AsyncSubject:of,asap:nz,asapScheduler:ri,async:bd,asyncScheduler:Pk,queue:fg,queueScheduler:fg,animationFrame:Fq,animationFrameScheduler:Fq,VirtualTimeScheduler:pz,VirtualAction:Gq,Scheduler:Nk,Subscription:Oa,Subscriber:ia,Notification:Ve,get NotificationKind(){return Ok},pipe:gi,noop:hc,identity:Yc,isObservable:function(o){return!!o&&(o instanceof Y||typeof o.lift=="function"&&typeof o.subscribe=="function")},ArgumentOutOfRangeError:Qk,EmptyError:vg,ObjectUnsubscribedError:qd,UnsubscriptionError:lf,TimeoutError:pb,bindCallback:cm,bindNodeCallback:dm,combineLatest:function(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];var d=e=void 0;return Zc(o[o.length-1])&&(d=o.pop()),typeof o[o.length-1]=="function"&&(e=o.pop()),o.length===1&&Jb(o[0])&&(o=o[0]),nf(o,d).lift(new vz(e))},concat:im,defer:ad,empty:mf,forkJoin:jm,from:Kb,fromEvent:gb,fromEventPattern:lm,generate:function(o,e,d,h,f){if(arguments.length==1){var g=o.initialState;e=o.condition,d=o.iterate;var A=o.resultSelector||Yc;f=o.scheduler}else h===void 0||Zc(h)?(g=o,A=Yc,f=h):(g=o,A=h);return new Y(function(C){var k=g;if(f)return f.schedule(bt,0,{subscriber:C,iterate:d,condition:e,resultSelector:A,state:k});for(;;){if(e){var j=void 0;try{j=e(k)}catch(_t){C.error(_t);break}if(!j){C.complete();break}}j=void 0;try{j=A(k)}catch(_t){C.error(_t);break}if(C.next(j),C.closed)break;try{k=d(k)}catch(_t){C.error(_t);break}}})},iif:function(o,e,d){return e===void 0&&(e=vb),d===void 0&&(d=vb),ad(function(){return o()?e:d})},interval:mm,merge:Xb,never:function(){return Tk},of:bb,onErrorResumeNext:li,pairs:function(o,e){return new Y(e?function(d){var h=Object.keys(o),f=new Oa;return f.add(e.schedule(dt,0,{keys:h,index:0,subscriber:d,subscription:f,obj:o})),f}:function(d){for(var h=Object.keys(o),f=0;f<h.length&&!d.closed;f++){var g=h[f];o.hasOwnProperty(g)&&d.next([g,o[g]])}d.complete()})},partition:function(o,e,d){return[wb(e,d)(new Y(pf(o))),wb(et(e,d))(new Y(pf(o)))]},race:Ca,range:function(o,e,d){return o===void 0&&(o=0),new Y(function(h){e===void 0&&(e=o,o=0);var f=0,g=o;if(d)return d.schedule(ht,0,{index:f,count:e,start:o,subscriber:h});for(;;){if(f++>=e){h.complete();break}if(h.next(g++),h.closed)break}})},throwError:Z,timer:Bc,using:function(o,e){return new Y(function(d){try{var h=o()}catch(A){return void d.error(A)}try{var f=e(h)}catch(A){return void d.error(A)}var g=(f?Kb(f):vb).subscribe(d);return function(){g.unsubscribe(),h&&h.unsubscribe()}})},zip:mi,scheduled:gm,EMPTY:vb,NEVER:Tk,config:Ib}),kt=function(){function o(e){this.selector=e}return o.prototype.call=function(e,d){return d.subscribe(new Ez(e,this.selector,this.caught))},o}(),Ez=function(o){function e(d,h,f){return(d=o.call(this,d)||this).selector=h,d.caught=f,d}return O(e,o),e.prototype.error=function(d){if(!this.isStopped){var h=void 0;try{h=this.selector(d,this.caught)}catch(f){return void o.prototype.error.call(this,f)}this._unsubscribeAndRecycle(),d=new vc(this),this.add(d),(h=ic(h,d))!==d&&this.add(h)}},e}(wc),lt=function(){function o(e){this.defaultValue=e}return o.prototype.call=function(e,d){return d.subscribe(new Fz(e,this.defaultValue))},o}(),Fz=function(o){function e(d,h){return(d=o.call(this,d)||this).defaultValue=h,d.isEmpty=!0,d}return O(e,o),e.prototype._next=function(d){this.isEmpty=!1,this.destination.next(d)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}(ia),mt=function(){function o(e,d){this.delay=e,this.scheduler=d}return o.prototype.call=function(e,d){return d.subscribe(new Gz(e,this.delay,this.scheduler))},o}(),Gz=function(o){function e(d,h,f){return(d=o.call(this,d)||this).delay=h,d.scheduler=f,d.queue=[],d.active=!1,d.errored=!1,d}return O(e,o),e.dispatch=function(d){for(var h=d.source,f=h.queue,g=d.scheduler,A=d.destination;0<f.length&&0>=f[0].time-g.now();)f.shift().notification.observe(A);0<f.length?(h=Math.max(0,f[0].time-g.now()),this.schedule(d,h)):(this.unsubscribe(),h.active=!1)},e.prototype._schedule=function(d){this.active=!0,this.destination.add(d.schedule(e.dispatch,this.delay,{source:this,destination:this.destination,scheduler:d}))},e.prototype.scheduleNotification=function(d){if(this.errored!==!0){var h=this.scheduler;d=new Hz(h.now()+this.delay,d),this.queue.push(d),this.active===!1&&this._schedule(h)}},e.prototype._next=function(d){this.scheduleNotification(Ve.createNext(d))},e.prototype._error=function(d){this.errored=!0,this.queue=[],this.destination.error(d),this.unsubscribe()},e.prototype._complete=function(){this.scheduleNotification(Ve.createComplete()),this.unsubscribe()},e}(ia),Hz=function(o,e){this.time=o,this.notification=e},nt=function(){function o(e,d){this.keySelector=e,this.flushes=d}return o.prototype.call=function(e,d){return d.subscribe(new Iz(e,this.keySelector,this.flushes))},o}(),Iz=function(o){function e(d,h,f){return(d=o.call(this,d)||this).keySelector=h,d.values=new Set,f&&d.add(ic(f,new vc(d))),d}return O(e,o),e.prototype.notifyNext=function(){this.values.clear()},e.prototype.notifyError=function(d){this._error(d)},e.prototype._next=function(d){this.keySelector?this._useKeySelector(d):this._finalizeNext(d,d)},e.prototype._useKeySelector=function(d){var h=this.destination;try{var f=this.keySelector(d)}catch(g){return void h.error(g)}this._finalizeNext(f,d)},e.prototype._finalizeNext=function(d,h){var f=this.values;f.has(d)||(f.add(d),this.destination.next(h))},e}(wc),pt=function(){function o(e){this.errorFactory=e}return o.prototype.call=function(e,d){return d.subscribe(new Jz(e,this.errorFactory))},o}(),Jz=function(o){function e(d,h){return(d=o.call(this,d)||this).errorFactory=h,d.hasValue=!1,d}return O(e,o),e.prototype._next=function(d){this.hasValue=!0,this.destination.next(d)},e.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var d=void 0;try{d=this.errorFactory()}catch(h){d=h}this.destination.error(d)},e}(ia),qt=function(){function o(e){if(this.total=e,0>this.total)throw new Qk}return o.prototype.call=function(e,d){return d.subscribe(new Kz(e,this.total))},o}(),Kz=function(o){function e(d,h){return(d=o.call(this,d)||this).total=h,d.count=0,d}return O(e,o),e.prototype._next=function(d){var h=this.total,f=++this.count;f<=h&&(this.destination.next(d),f===h&&(this.destination.complete(),this.unsubscribe()))},e}(ia),rt=function(){function o(e){this.project=e}return o.prototype.call=function(e,d){return d.subscribe(new Lz(e,this.project))},o}(),Lz=function(o){function e(d,h){return(d=o.call(this,d)||this).project=h,d.hasSubscription=!1,d.hasCompleted=!1,d.index=0,d}return O(e,o),e.prototype._next=function(d){this.hasSubscription||this.tryNext(d)},e.prototype.tryNext=function(d){var h=this.index++;try{var f=this.project(d,h)}catch(g){return void this.destination.error(g)}this.hasSubscription=!0,this._innerSub(f)},e.prototype._innerSub=function(d){var h=new vc(this),f=this.destination;f.add(h),(d=ic(d,h))!==h&&f.add(d)},e.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(d){this.destination.next(d)},e.prototype.notifyError=function(d){this.destination.error(d)},e.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},e}(wc),st=function(){function o(e){this.callback=e}return o.prototype.call=function(e,d){return d.subscribe(new Mz(e,this.callback))},o}(),Mz=function(o){function e(d,h){return(d=o.call(this,d)||this).add(new Oa(h)),d}return O(e,o),e}(ia),ut=function(){function o(){}return o.prototype.call=function(e,d){return d.subscribe(new Nz(e))},o}(),Nz=function(o){function e(){return o!==null&&o.apply(this,arguments)||this}return O(e,o),e.prototype._next=function(d){},e}(ia),vt=function(){function o(e){if(this.total=e,0>this.total)throw new Qk}return o.prototype.call=function(e,d){return d.subscribe(new Oz(e,this.total))},o}(),Oz=function(o){function e(d,h){return(d=o.call(this,d)||this).total=h,d.ring=[],d.count=0,d}return O(e,o),e.prototype._next=function(d){var h=this.ring,f=this.total,g=this.count++;h.length<f?h.push(d):h[g%f]=d},e.prototype._complete=function(){var d=this.destination,h=this.count;if(0<h)for(var f=this.count>=this.total?this.total:this.count,g=this.ring,A=0;A<f;A++){var C=h++%f;d.next(g[C])}d.complete()},e}(ia),wt=function(){function o(e){this.value=e}return o.prototype.call=function(e,d){return d.subscribe(new Pz(e,this.value))},o}(),Pz=function(o){function e(d,h){return(d=o.call(this,d)||this).value=h,d}return O(e,o),e.prototype._next=function(d){this.destination.next(this.value)},e}(ia),xt=function(){function o(e,d,h){h===void 0&&(h=!1),this.accumulator=e,this.seed=d,this.hasSeed=h}return o.prototype.call=function(e,d){return d.subscribe(new Qz(e,this.accumulator,this.seed,this.hasSeed))},o}(),Qz=function(o){function e(d,h,f,g){return(d=o.call(this,d)||this).accumulator=h,d._seed=f,d.hasSeed=g,d.index=0,d}return O(e,o),Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(d){this.hasSeed=!0,this._seed=d},enumerable:!0,configurable:!0}),e.prototype._next=function(d){if(this.hasSeed)return this._tryNext(d);this.seed=d,this.destination.next(d)},e.prototype._tryNext=function(d){var h=this.index++;try{var f=this.accumulator(this.seed,d,h)}catch(g){this.destination.error(g)}this.seed=f,this.destination.next(f)},e}(ia),zt=function(){function o(e,d){this.subjectFactory=e,this.selector=d}return o.prototype.call=function(e,d){var h=this.selector,f=this.subjectFactory();return(e=h(f).subscribe(e)).add(d.subscribe(f)),e},o}(),Bt=function(){function o(e,d){this.notifier=e,this.source=d}return o.prototype.call=function(e,d){return d.subscribe(new Rz(e,this.notifier,this.source))},o}(),Rz=function(o){function e(d,h,f){return(d=o.call(this,d)||this).notifier=h,d.source=f,d}return O(e,o),e.prototype.error=function(d){if(!this.isStopped){var h=this.errors,f=this.retries,g=this.retriesSubscription;if(f)this.retriesSubscription=this.errors=void 0;else{h=new Pa;try{f=(0,this.notifier)(h)}catch(A){return o.prototype.error.call(this,A)}g=ic(f,new vc(this))}this._unsubscribeAndRecycle(),this.errors=h,this.retries=f,this.retriesSubscription=g,h.next(d)}},e.prototype._unsubscribe=function(){var d=this.errors,h=this.retriesSubscription;d&&(d.unsubscribe(),this.errors=void 0),h&&(h.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},e.prototype.notifyNext=function(){var d=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=d,this.source.subscribe(this)},e}(wc),Et=function(){function o(e){this.project=e}return o.prototype.call=function(e,d){return d.subscribe(new Sz(e,this.project))},o}(),Sz=function(o){function e(d,h){return(d=o.call(this,d)||this).project=h,d.index=0,d}return O(e,o),e.prototype._next=function(d){var h=this.index++;try{var f=this.project(d,h)}catch(g){return void this.destination.error(g)}this._innerSub(f)},e.prototype._innerSub=function(d){var h=this.innerSubscription;h&&h.unsubscribe(),h=new vc(this);var f=this.destination;f.add(h),this.innerSubscription=ic(d,h),this.innerSubscription!==h&&f.add(this.innerSubscription)},e.prototype._complete=function(){var d=this.innerSubscription;d&&!d.closed||o.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=void 0},e.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&o.prototype._complete.call(this)},e.prototype.notifyNext=function(d){this.destination.next(d)},e}(wc),Ft=function(){function o(e){this.notifier=e}return o.prototype.call=function(e,d){e=new Tz(e);var h=ic(this.notifier,new vc(e));return h&&!e.seenValue?(e.add(h),d.subscribe(e)):e},o}(),Tz=function(o){function e(d){return(d=o.call(this,d)||this).seenValue=!1,d}return O(e,o),e.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},e.prototype.notifyComplete=function(){},e}(wc),Ht=function(){function o(e,d){this.predicate=e,this.inclusive=d}return o.prototype.call=function(e,d){return d.subscribe(new Uz(e,this.predicate,this.inclusive))},o}(),Uz=function(o){function e(d,h,f){return(d=o.call(this,d)||this).predicate=h,d.inclusive=f,d.index=0,d}return O(e,o),e.prototype._next=function(d){var h=this.destination;try{var f=this.predicate(d,this.index++)}catch(g){return void h.error(g)}this.nextOrComplete(d,f)},e.prototype.nextOrComplete=function(d,h){var f=this.destination;h?f.next(d):(this.inclusive&&f.next(d),f.complete())},e}(ia),It=function(){function o(e,d,h){this.nextOrObserver=e,this.error=d,this.complete=h}return o.prototype.call=function(e,d){return d.subscribe(new Vz(e,this.nextOrObserver,this.error,this.complete))},o}(),Vz=function(o){function e(d,h,f,g){return(d=o.call(this,d)||this)._tapNext=hc,d._tapError=hc,d._tapComplete=hc,d._tapError=f||hc,d._tapComplete=g||hc,le(h)?(d._context=d,d._tapNext=h):h&&(d._context=h,d._tapNext=h.next||hc,d._tapError=h.error||hc,d._tapComplete=h.complete||hc),d}return O(e,o),e.prototype._next=function(d){try{this._tapNext.call(this._context,d)}catch(h){return void this.destination.error(h)}this.destination.next(d)},e.prototype._error=function(d){try{this._tapError.call(this._context,d)}catch(h){return void this.destination.error(h)}this.destination.error(d)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(d){return void this.destination.error(d)}return this.destination.complete()},e}(ia),Kt={leading:!0,trailing:!1};(function(o){function e(d,h,f,g){var A=o.call(this,d)||this;return A.destination=d,A.durationSelector=h,A._leading=f,A._trailing=g,A._hasValue=!1,A}O(e,o),e.prototype._next=function(d){this._hasValue=!0,this._sendValue=d,this._throttled||(this._leading?this.send():this.throttle(d))},e.prototype.send=function(){var d=this._sendValue;this._hasValue&&(this.destination.next(d),this.throttle(d)),this._hasValue=!1,this._sendValue=void 0},e.prototype.throttle=function(d){(d=this.tryDurationSelector(d))&&this.add(this._throttled=ic(d,new vc(this)))},e.prototype.tryDurationSelector=function(d){try{return this.durationSelector(d)}catch(h){return this.destination.error(h),null}},e.prototype.throttlingDone=function(){var d=this._throttled,h=this._trailing;d&&d.unsubscribe(),this._throttled=void 0,h&&this.send()},e.prototype.notifyNext=function(){this.throttlingDone()},e.prototype.notifyComplete=function(){this.throttlingDone()}})(wc);for(var Lt=function(){function o(e,d,h,f){this.duration=e,this.scheduler=d,this.leading=h,this.trailing=f}return o.prototype.call=function(e,d){return d.subscribe(new Wz(e,this.duration,this.scheduler,this.leading,this.trailing))},o}(),Wz=function(o){function e(d,h,f,g,A){return(d=o.call(this,d)||this).duration=h,d.scheduler=f,d.leading=g,d.trailing=A,d._hasTrailingValue=!1,d._trailingValue=null,d}return O(e,o),e.prototype._next=function(d){this.throttled?this.trailing&&(this._trailingValue=d,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Mt,this.duration,{subscriber:this})),this.leading?this.destination.next(d):this.trailing&&(this._trailingValue=d,this._hasTrailingValue=!0))},e.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},e.prototype.clearThrottle=function(){var d=this.throttled;d&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),d.unsubscribe(),this.remove(d),this.throttled=null)},e}(ia),Ot=function(){function o(e,d,h,f){this.waitFor=e,this.absoluteTimeout=d,this.withObservable=h,this.scheduler=f}return o.prototype.call=function(e,d){return d.subscribe(new Xz(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},o}(),Xz=function(o){function e(d,h,f,g,A){return(d=o.call(this,d)||this).absoluteTimeout=h,d.waitFor=f,d.withObservable=g,d.scheduler=A,d.scheduleTimeout(),d}return O(e,o),e.dispatchTimeout=function(d){var h=d.withObservable;d._unsubscribeAndRecycle(),d.add(ic(h,new vc(d)))},e.prototype.scheduleTimeout=function(){var d=this.action;d?this.action=d.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(e.dispatchTimeout,this.waitFor,this))},e.prototype._next=function(d){this.absoluteTimeout||this.scheduleTimeout(),o.prototype._next.call(this,d)},e.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},e}(wc),Qt=function(){function o(e,d){this.observables=e,this.project=d}return o.prototype.call=function(e,d){return d.subscribe(new Yz(e,this.observables,this.project))},o}(),Yz=function(o){function e(d,h,f){(d=o.call(this,d)||this).observables=h,d.project=f,d.toRespond=[],f=h.length,d.values=Array(f);for(var g=0;g<f;g++)d.toRespond.push(g);for(g=0;g<f;g++)d.add(ji(d,h[g],void 0,g));return d}return O(e,o),e.prototype.notifyNext=function(d,h,f){this.values[f]=h,0<(d=this.toRespond).length&&(f=d.indexOf(f))!==-1&&d.splice(f,1)},e.prototype.notifyComplete=function(){},e.prototype._next=function(d){this.toRespond.length===0&&(d=[d].concat(this.values),this.project?this._tryProject(d):this.destination.next(d))},e.prototype._tryProject=function(d){try{var h=this.project.apply(this,d)}catch(f){return void this.destination.error(f)}this.destination.next(h)},e}(Rk),Jq=$a(function(o){var e=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(e){var d=new Uint8Array(16);o.exports=function(){return e(d),d}}else{var h=Array(16);o.exports=function(){for(var f,g=0;16>g;g++)!(3&g)&&(f=4294967296*Math.random()),h[g]=f>>>((3&g)<<3)&255;return h}}}),ab=[],Gh=0;256>Gh;++Gh)ab[Gh]=(Gh+256).toString(16).substr(1);var Kq=function(o,e){return e=e||0,[ab[o[e++]],ab[o[e++]],ab[o[e++]],ab[o[e++]],"-",ab[o[e++]],ab[o[e++]],"-",ab[o[e++]],ab[o[e++]],"-",ab[o[e++]],ab[o[e++]],"-",ab[o[e++]],ab[o[e++]],ab[o[e++]],ab[o[e++]],ab[o[e++]],ab[o[e++]]].join("")},Ud=function(o,e,d){if(d=e&&d||0,typeof o=="string"&&(e=o==="binary"?Array(16):null,o=null),(o=(o=o||{}).random||(o.rng||Jq)())[6]=15&o[6]|64,o[8]=63&o[8]|128,e)for(var h=0;16>h;++h)e[d+h]=o[h];return e||Kq(o)},gg=Ud(),Uk=!1,Pc,rd,Vk,Wk,sd,Vd,ec,We,Rb,Xk,Qc,Wd,Rc,Sc,Tc,Xe,Uc,Vc;(function(o){o[o.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",o[o.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",o[o.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",o[o.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",o[o.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",o[o.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",o[o.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"})(Pc||(Pc={})),function(o){o[o.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",o[o.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",o[o.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",o[o.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",o[o.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",o[o.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(rd||(rd={})),function(o){o[o.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(Vk||(Vk={})),function(o){o[o.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Wk||(Wk={})),function(o){o[o.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",o[o.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",o[o.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",o[o.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",o[o.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",o[o.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(sd||(sd={})),function(o){o[o.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",o[o.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",o[o.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",o[o.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",o[o.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(Vd||(Vd={})),function(o){o[o.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",o[o.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",o[o.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",o[o.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",o[o.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",o[o.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",o[o.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",o[o.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",o[o.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",o[o.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",o[o.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(ec||(ec={})),function(o){o[o.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",o[o.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",o[o.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",o[o.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(We||(We={})),function(o){o[o.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",o[o.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",o[o.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",o[o.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",o[o.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",o[o.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",o[o.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",o[o.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",o[o.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",o[o.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",o[o.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(Rb||(Rb={})),function(o){o[o.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Xk||(Xk={})),function(o){o[o.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",o[o.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",o[o.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",o[o.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",o[o.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",o[o.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",o[o.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Qc||(Qc={})),function(o){o[o.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",o[o.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",o[o.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",o[o.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",o[o.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(Wd||(Wd={})),function(o){o[o.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",o[o.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",o[o.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",o[o.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",o[o.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",o[o.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",o[o.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",o[o.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(Rc||(Rc={})),function(o){o[o.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",o[o.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",o[o.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",o[o.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",o[o.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",o[o.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",o[o.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(Sc||(Sc={})),function(o){o[o.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",o[o.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",o[o.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",o[o.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",o[o.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",o[o.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",o[o.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(Tc||(Tc={})),function(o){o[o.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",o[o.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",o[o.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",o[o.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(Xe||(Xe={})),function(o){o[o.UPLOAD_MEDIA_ERR_FAILURE=1]="UPLOAD_MEDIA_ERR_FAILURE",o[o.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="UPLOAD_MEDIA_ERR_INVALID_ARGUMENT",o[o.UPLOAD_MEDIA_ERR_TIMEOUT=3]="UPLOAD_MEDIA_ERR_TIMEOUT",o[o.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW=4]="UPLOAD_MEDIA_ERR_SIZE_OVERFLOW",o[o.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",o[o.UPLOAD_MEDIA_ERR_INTERRUPTED=6]="UPLOAD_MEDIA_ERR_INTERRUPTED",o[o.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="UPLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Uc||(Uc={})),function(o){o[o.DOWNLOAD_MEDIA_ERR_FAILURE=1]="DOWNLOAD_MEDIA_ERR_FAILURE",o[o.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT",o[o.DOWNLOAD_MEDIA_ERR_TIMEOUT=3]="DOWNLOAD_MEDIA_ERR_TIMEOUT",o[o.DOWNLOAD_MEDIA_ERR_NOT_EXIST=4]="DOWNLOAD_MEDIA_ERR_NOT_EXIST",o[o.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",o[o.DOWNLOAD_MEDIA_ERR_INTERRUPTED=6]="DOWNLOAD_MEDIA_ERR_INTERRUPTED",o[o.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Vc||(Vc={}));var Sb=Pc.ATTRIBUTE_OPERATION_ERR_FAILURE,Ja=Pc.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,se=Pc.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;Pc.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var Lq=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,Tb=Pc.ATTRIBUTE_OPERATION_ERR_TIMEOUT,Ub=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,hg=rd.CHANNEL_MESSAGE_ERR_FAILURE,Yk=rd.CHANNEL_MESSAGE_ERR_TIMEOUT,Mq=rd.CHANNEL_MESSAGE_ERR_TOO_OFTEN,Hh=rd.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE;rd.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL;var ig=rd.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,Zz=Vk.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,Nq=Wk.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var Oq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var Pq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,$z=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var aA=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,bA=sd.GET_MEMBERS_ERR_FAILURE,cA=sd.GET_MEMBERS_ERR_REJECTED;sd.GET_MEMBERS_ERR_TIMEOUT,sd.GET_MEMBERS_ERR_TOO_OFTEN;var dA=sd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,eA=sd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,xc=Vd.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,fA=Vd.INVITATION_API_CALL_ERR_NOT_STARTED,Ih=Vd.INVITATION_API_CALL_ERR_ALREADY_END,Qq=Vd.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,gA=Vd.INVITATION_API_CALL_ERR_ALREADY_SENT,Rq=ec.JOIN_CHANNEL_ERR_FAILURE;ec.JOIN_CHANNEL_ERR_REJECTED;var hA=ec.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,Sq=ec.JOIN_CHANNEL_TIMEOUT,Tq=ec.JOIN_CHANNEL_ERR_EXCEED_LIMIT,Uq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED;ec.JOIN_CHANNEL_ERR_TOO_OFTEN;var Vq=ec.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Wq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Xq=We.LEAVE_CHANNEL_ERR_FAILURE,Yq=We.LEAVE_CHANNEL_ERR_REJECTED,iA=We.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,jA=We.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,Zq=Rb.LOGIN_ERR_UNKNOWN,jg=Rb.LOGIN_ERR_REJECTED,Jh=Rb.LOGIN_ERR_INVALID_ARGUMENT,$q=Rb.LOGIN_ERR_INVALID_APP_ID,ar=Rb.LOGIN_ERR_INVALID_TOKEN,Kh=Rb.LOGIN_ERR_TOKEN_EXPIRED;Rb.LOGIN_ERR_NOT_AUTHORIZED;var kA=Rb.LOGIN_ERR_ALREADY_LOGIN,lA=Rb.LOGIN_ERR_TIMEOUT,mA=Rb.LOGIN_ERR_TOO_OFTEN,br=Xk.LOGOUT_ERR_USER_NOT_LOGGED_IN,cr=Qc.PEER_MESSAGE_ERR_FAILURE,Zk=Qc.PEER_MESSAGE_ERR_TIMEOUT,dr=Qc.PEER_MESSAGE_ERR_TOO_OFTEN,$k=Qc.PEER_MESSAGE_ERR_INVALID_USERID,ve=Qc.PEER_MESSAGE_ERR_INVALID_MESSAGE,al=Qc.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,nA=Qc.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE,er=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var oA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var pA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,qA=Rc.RENEW_TOKEN_ERR_FAILURE,rA=Rc.RENEW_TOKEN_ERR_INVALID_ARGUMENT;Rc.RENEW_TOKEN_ERR_REJECTED,Rc.RENEW_TOKEN_ERR_TOO_OFTEN;var sA=Rc.RENEW_TOKEN_ERR_TOKEN_EXPIRED,tA=Rc.RENEW_TOKEN_ERR_INVALID_TOKEN,uA=Rc.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,fr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,kg=Tc.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var vA=Tc.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var gr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,bl=Tc.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var lg=Uc.UPLOAD_MEDIA_ERR_FAILURE,wf=Uc.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT,Lh=Uc.UPLOAD_MEDIA_ERR_TIMEOUT,wA=Uc.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW,xA=Uc.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,hr=Uc.UPLOAD_MEDIA_ERR_INTERRUPTED,yA=Uc.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN,mg=Vc.DOWNLOAD_MEDIA_ERR_FAILURE,cl=Vc.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT,zA=Vc.DOWNLOAD_MEDIA_ERR_TIMEOUT,AA=Vc.DOWNLOAD_MEDIA_ERR_NOT_EXIST,BA=Vc.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,ir=Vc.DOWNLOAD_MEDIA_ERR_INTERRUPTED,CA=Vc.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN,DA=function(o,e){var d;return Hk(o,function(h,f,g){return!(d=e(h,f,g))}),!!d},Mh=function(o,e,d){if(!lb(d))return!1;var h=X(e);return!!(h=="number"?Ed(d)&&wk(e,d.length):h=="string"&&e in d)&&$f(d[e],o)},dl=function(o,e,d){var h=Va(o)?tq:DA;return d&&Mh(o,e,d)&&(e=void 0),h(o,Te(e))},EA=function(o,e){var d=-1,h=Ed(o)?Array(o.length):[];return Hk(o,function(f,g,A){h[++d]=e(f,g,A)}),h},FA=function(o,e){var d=o.length;for(o.sort(e);d--;)o[d]=o[d].value;return o},GA=function(o,e,d){e=e.length?he(e,function(f){return Va(f)?function(g){return Ch(g,f.length===1?f[0]:f)}:f}):[Dh];var h=-1;return e=he(e,zh(Te)),o=EA(o,function(f,g,A){return{criteria:he(e,function(C){return C(f)}),index:++h,value:f}}),FA(o,function(f,g){t:{for(var A=-1,C=f.criteria,k=g.criteria,j=C.length,_t=d.length;++A<j;){e:{var _n=C[A],ue=k[A];if(_n!==ue){var Ei=_n!==void 0,_s=_n===null,_c=_n==_n,_u=ie(_n),_d=ue!==void 0,_l=ue===null,nE=ue==ue,sE=ie(ue);if(!_l&&!sE&&!_u&&_n>ue||_u&&_d&&nE&&!_l&&!sE||_s&&_d&&nE||!Ei&&nE||!_c){_n=1;break e}if(!_s&&!_u&&!sE&&_n<ue||sE&&Ei&&_c&&!_s&&!_u||_l&&Ei&&_c||!_d&&_c||!nE){_n=-1;break e}}_n=0}if(_n){f=A>=_t?_n:_n*(d[A]=="desc"?-1:1);break t}}f=f.index-g.index}return f})},jr=function(o,e){return rq(qq(o,e,Dh),o+"")},kr=jr(function(o,e){if(o==null)return[];var d=e.length;return 1<d&&Mh(o,e[0],e[1])?e=[]:2<d&&Mh(e[0],e[1],e[2])&&(e=[e[0]]),GA(o,$h(e,1),[])}),lr=function(o){if(o.__esModule)return o;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(o).forEach(function(d){var h=Object.getOwnPropertyDescriptor(o,d);Object.defineProperty(e,d,h.get?h:{enumerable:!0,get:function(){return o[d]}})}),e}(Dz),mr=$a(function(o,e){Object.defineProperty(e,"__esModule",{value:!0});var d=[],h=function(f,g){return new WebSocket(f,g)};e.normalClosureMessage="Normal closure",e.default=function(f,g){var A=(g=g===void 0?{protocols:d,makeWebSocket:h}:g).protocols,C=A===void 0?d:A,k=(g=g.makeWebSocket)===void 0?h:g;return new lr.Observable(function(j){var _t,_n=new lr.Subject,ue=k(f,C),Ei=!1,_s=!1,_c=function(_u){if(_t)throw Ei=!0,_u=Error("Web socket message factory function called more than once"),j.error(_u),_u;return _t=_u.subscribe(function(_d){ue.send(_d)}),_n};return ue.onopen=function(){_s?(Ei=!0,ue.close()):j.next(_c)},ue.onmessage=function(_u){_n.next(_u.data)},ue.onerror=function(_u){Ei=!0,j.error(Error(_u.message))},ue.onclose=function(_u){Ei||(Ei=!0,_s?(j.complete(),_n.complete()):j.error(Error(_u.code===1e3?e.normalClosureMessage:_u.reason)))},function(){_s=!0,_t&&_t.unsubscribe(),Ei||(Ei=!0,ue.close())}})}});(function(o){o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")&&o.default})(mr);var pi=function(o,e,d){(d===void 0||$f(o[e],d))&&(d!==void 0||e in o)||bg(o,e,d)},oi=function(o,e){if((e!=="constructor"||typeof o[e]!="function")&&e!="__proto__")return o[e]},HA=function(o){return jr(function(e,d){var h=-1,f=d.length,g=1<f?d[f-1]:void 0,A=2<f?d[2]:void 0;for(g=3<o.length&&typeof g=="function"?(f--,g):void 0,A&&Mh(d[0],d[1],A)&&(g=3>f?void 0:g,f=1),e=Object(e);++h<f;)(A=d[h])&&o(e,A,h,g);return e})}(function(o,e,d,h){tm(o,e,d,h)}),IA=Math.floor,JA=Math.random,nr=function(o,e){return o+IA(JA()*(e-o+1))},or=function(o){var e=o.length;return e?o[nr(0,e-1)]:void 0},KA=function(o,e){return he(e,function(d){return o[d]})},Ni=function(o){return o==null?[]:KA(o,Ad(o))},LA=function(o){return or(Ni(o))},bn=function(o){return(Va(o)?or:LA)(o)},xm=[],ym=function(o,e){return new WebSocket(o,e)},MA=Math.floor;N({target:"Number",stat:!0},{isInteger:function(o){return!ha(o)&&isFinite(o)&&MA(o)===o}}),Oo("from",Ej,Dj);var NA=function(o,e){for(var d=Array(arguments.length-1),h=0,f=2,g=!0;f<arguments.length;)d[h++]=arguments[f++];return new Promise(function(A,C){d[h]=function(k){if(g)if(g=!1,k)C(k);else{for(var j=Array(arguments.length-1),_t=0;_t<j.length;)j[_t++]=arguments[_t];A.apply(null,j)}};try{o.apply(e||null,d)}catch(k){g&&(g=!1,C(k))}})},OA=$a(function(o,e){e.length=function(f){var g=f.length;if(!g)return 0;for(var A=0;1<--g%4&&f.charAt(g)==="=";)++A;return Math.ceil(3*f.length)/4-A};var d=Array(64),h=Array(123);for(o=0;64>o;)h[d[o]=26>o?o+65:52>o?o+71:62>o?o-4:o-59|43]=o++;e.encode=function(f,g,A){for(var C,k=null,j=[],_t=0,_n=0;g<A;){var ue=f[g++];switch(_n){case 0:j[_t++]=d[ue>>2],C=(3&ue)<<4,_n=1;break;case 1:j[_t++]=d[C|ue>>4],C=(15&ue)<<2,_n=2;break;case 2:j[_t++]=d[C|ue>>6],j[_t++]=d[63&ue],_n=0}8191<_t&&((k||(k=[])).push(String.fromCharCode.apply(String,j)),_t=0)}return _n&&(j[_t++]=d[C],j[_t++]=61,_n===1&&(j[_t++]=61)),k?(_t&&k.push(String.fromCharCode.apply(String,j.slice(0,_t))),k.join("")):String.fromCharCode.apply(String,j.slice(0,_t))},e.decode=function(f,g,A){for(var C,k=A,j=0,_t=0;_t<f.length;){var _n=f.charCodeAt(_t++);if(_n===61&&1<j)break;if((_n=h[_n])===void 0)throw Error("invalid encoding");switch(j){case 0:C=_n,j=1;break;case 1:g[A++]=C<<2|(48&_n)>>4,C=_n,j=2;break;case 2:g[A++]=(15&C)<<4|(60&_n)>>2,C=_n,j=3;break;case 3:g[A++]=(3&C)<<6|_n,j=0}}if(j===1)throw Error("invalid encoding");return A-k},e.test=function(f){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(f)}});yg.prototype.on=function(o,e,d){return(this._listeners[o]||(this._listeners[o]=[])).push({fn:e,ctx:d||this}),this},yg.prototype.off=function(o,e){if(o===void 0)this._listeners={};else if(e===void 0)this._listeners[o]=[];else{o=this._listeners[o];for(var d=0;d<o.length;)o[d].fn===e?o.splice(d,1):++d}return this},yg.prototype.emit=function(o){var e=this._listeners[o];if(e){for(var d=[],h=1;h<arguments.length;)d.push(arguments[h++]);for(h=0;h<e.length;)e[h].fn.apply(e[h++].ctx,d)}return this};var PA=zm(zm),QA=function(c){try{var a=eval("quire".replace(/^/,"re"))(c);if(a&&(a.length||Object.keys(a).length))return a}catch(o){}return null},RA=$a(function(o,e){e.length=function(d){for(var h,f=0,g=0;g<d.length;++g)128>(h=d.charCodeAt(g))?f+=1:2048>h?f+=2:(64512&h)==55296&&(64512&d.charCodeAt(g+1))==56320?(++g,f+=4):f+=3;return f},e.read=function(d,h,f){if(1>f-h)return"";for(var g,A=null,C=[],k=0;h<f;)128>(g=d[h++])?C[k++]=g:191<g&&224>g?C[k++]=(31&g)<<6|63&d[h++]:239<g&&365>g?(g=((7&g)<<18|(63&d[h++])<<12|(63&d[h++])<<6|63&d[h++])-65536,C[k++]=55296+(g>>10),C[k++]=56320+(1023&g)):C[k++]=(15&g)<<12|(63&d[h++])<<6|63&d[h++],8191<k&&((A||(A=[])).push(String.fromCharCode.apply(String,C)),k=0);return A?(k&&A.push(String.fromCharCode.apply(String,C.slice(0,k))),A.join("")):String.fromCharCode.apply(String,C.slice(0,k))},e.write=function(d,h,f){for(var g,A,C=f,k=0;k<d.length;++k)128>(g=d.charCodeAt(k))?h[f++]=g:(2048>g?h[f++]=g>>6|192:((64512&g)==55296&&(64512&(A=d.charCodeAt(k+1)))==56320?(g=65536+((1023&g)<<10)+(1023&A),++k,h[f++]=g>>18|240,h[f++]=g>>12&63|128):h[f++]=g>>12|224,h[f++]=g>>6&63|128),h[f++]=63&g|128);return f-C}}),SA=function(o,e,d){var h=d||8192,f=h>>>1,g=null,A=h;return function(C){return 1>C||C>f?o(C):(A+C>h&&(g=o(h),A=0),C=e.call(g,A,A+=C),7&A&&(A=1+(7|A)),C)}},Xd=Wa.zero=new Wa(0,0);Xd.toNumber=function(){return 0},Xd.zzEncode=Xd.zzDecode=function(){return this},Xd.length=function(){return 1};var TA=Wa.zeroHash="\0\0\0\0\0\0\0\0";Wa.fromNumber=function(o){if(o===0)return Xd;var e=0>o;e&&(o=-o);var d=o>>>0;return o=(o-d)/4294967296>>>0,e&&(o=~o>>>0,d=~d>>>0,4294967295<++d&&(d=0,4294967295<++o&&(o=0))),new Wa(d,o)},Wa.from=function(o){if(typeof o=="number")return Wa.fromNumber(o);if(V.isString(o)){if(!V.Long)return Wa.fromNumber(parseInt(o,10));o=V.Long.fromString(o)}return o.low||o.high?new Wa(o.low>>>0,o.high>>>0):Xd},Wa.prototype.toNumber=function(o){if(!o&&this.hi>>>31){o=1+~this.lo>>>0;var e=~this.hi>>>0;return o||(e=e+1>>>0),-(o+4294967296*e)}return this.lo+4294967296*this.hi},Wa.prototype.toLong=function(o){return V.Long?new V.Long(0|this.lo,0|this.hi,!!o):{low:0|this.lo,high:0|this.hi,unsigned:!!o}};var td=String.prototype.charCodeAt;Wa.fromHash=function(o){return o===TA?Xd:new Wa((td.call(o,0)|td.call(o,1)<<8|td.call(o,2)<<16|td.call(o,3)<<24)>>>0,(td.call(o,4)|td.call(o,5)<<8|td.call(o,6)<<16|td.call(o,7)<<24)>>>0)},Wa.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Wa.prototype.zzEncode=function(){var o=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^o)>>>0,this.lo=(this.lo<<1^o)>>>0,this},Wa.prototype.zzDecode=function(){var o=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^o)>>>0,this.hi=(this.hi>>>1^o)>>>0,this},Wa.prototype.length=function(){var o=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,d=this.hi>>>24;return d===0?e===0?16384>o?128>o?1:2:2097152>o?3:4:16384>e?128>e?5:6:2097152>e?7:8:128>d?9:10};var V=$a(function(o,e){function d(f,g,A){for(var C=Object.keys(g),k=0;k<C.length;++k)f[C[k]]!==void 0&&A||(f[C[k]]=g[C[k]]);return f}function h(f){function g(A,C){if(!(this instanceof g))return new g(A,C);Object.defineProperty(this,"message",{get:function(){return A}}),Error.captureStackTrace?Error.captureStackTrace(this,g):Object.defineProperty(this,"stack",{value:Error().stack||""}),C&&d(this,C)}return(g.prototype=Object.create(Error.prototype)).constructor=g,Object.defineProperty(g.prototype,"name",{get:function(){return f}}),g.prototype.toString=function(){return this.name+": "+this.message},g}e.asPromise=NA,e.base64=OA,e.EventEmitter=yg,e.float=PA,e.inquire=QA,e.utf8=RA,e.pool=SA,e.LongBits=Wa,e.isNode=!!(Ya!==void 0&&Ya&&Ya.process&&Ya.process.versions&&Ya.process.versions.node),e.global=e.isNode&&Ya||typeof window<"u"&&window||typeof self<"u"&&self||Ya,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(f){return typeof f=="number"&&isFinite(f)&&Math.floor(f)===f},e.isString=function(f){return typeof f=="string"||f instanceof String},e.isObject=function(f){return f&&X(f)==="object"},e.isset=e.isSet=function(f,g){var A=f[g];return!(A==null||!f.hasOwnProperty(g))&&(X(A)!=="object"||0<(Array.isArray(A)?A.length:Object.keys(A).length))},e.Buffer=function(){try{var f=e.inquire("buffer").Buffer;return f.prototype.utf8Write?f:null}catch{return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(f){return typeof f=="number"?e.Buffer?e._Buffer_allocUnsafe(f):new e.Array(f):e.Buffer?e._Buffer_from(f):typeof Uint8Array>"u"?f:new Uint8Array(f)},e.Array=typeof Uint8Array<"u"?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(f){return f?e.LongBits.from(f).toHash():e.LongBits.zeroHash},e.longFromHash=function(f,g){return f=e.LongBits.fromHash(f),e.Long?e.Long.fromBits(f.lo,f.hi,g):f.toNumber(!!g)},e.merge=d,e.lcFirst=function(f){return f.charAt(0).toLowerCase()+f.substring(1)},e.newError=h,e.ProtocolError=h("ProtocolError"),e.oneOfGetter=function(f){for(var g={},A=0;A<f.length;++A)g[f[A]]=1;return function(){for(var C=Object.keys(this),k=C.length-1;-1<k;--k)if(g[C[k]]===1&&this[C[k]]!==void 0&&this[C[k]]!==null)return C[k]}},e.oneOfSetter=function(f){return function(g){for(var A=0;A<f.length;++A)f[A]!==g&&delete this[f[A]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var f=e.Buffer;f?(e._Buffer_from=f.from!==Uint8Array.from&&f.from||function(g,A){return new f(g,A)},e._Buffer_allocUnsafe=f.allocUnsafe||function(g){return new f(g)}):e._Buffer_from=e._Buffer_allocUnsafe=null}}),xi=ja,el,Nh=V.LongBits,pr=V.base64,qr=V.utf8,rr=function(){return V.Buffer?function(){return(ja.create=function(){return new el})()}:function(){return new ja}};ja.create=rr(),ja.alloc=function(o){return new V.Array(o)},V.Array!==Array&&(ja.alloc=V.pool(ja.alloc,V.Array.prototype.subarray)),ja.prototype._push=function(o,e,d){return this.tail=this.tail.next=new sf(o,e,d),this.len+=e,this},ui.prototype=Object.create(sf.prototype),ui.prototype.fn=function(o,e,d){for(;127<o;)e[d++]=127&o|128,o>>>=7;e[d]=o},ja.prototype.uint32=function(o){return this.len+=(this.tail=this.tail.next=new ui(128>(o>>>=0)?1:16384>o?2:2097152>o?3:268435456>o?4:5,o)).len,this},ja.prototype.int32=function(o){return 0>o?this._push(vi,10,Nh.fromNumber(o)):this.uint32(o)},ja.prototype.sint32=function(o){return this.uint32((o<<1^o>>31)>>>0)},ja.prototype.uint64=function(o){return o=Nh.from(o),this._push(vi,o.length(),o)},ja.prototype.int64=ja.prototype.uint64,ja.prototype.sint64=function(o){return o=Nh.from(o).zzEncode(),this._push(vi,o.length(),o)},ja.prototype.bool=function(o){return this._push(ti,1,o?1:0)},ja.prototype.fixed32=function(o){return this._push(wi,4,o>>>0)},ja.prototype.sfixed32=ja.prototype.fixed32,ja.prototype.fixed64=function(o){return o=Nh.from(o),this._push(wi,4,o.lo)._push(wi,4,o.hi)},ja.prototype.sfixed64=ja.prototype.fixed64,ja.prototype.float=function(o){return this._push(V.float.writeFloatLE,4,o)},ja.prototype.double=function(o){return this._push(V.float.writeDoubleLE,8,o)};var UA=V.Array.prototype.set?function(o,e,d){e.set(o,d)}:function(o,e,d){for(var h=0;h<o.length;++h)e[d+h]=o[h]};ja.prototype.bytes=function(o){var e=o.length>>>0;if(!e)return this._push(ti,1,0);if(V.isString(o)){var d=ja.alloc(e=pr.length(o));pr.decode(o,d,0),o=d}return this.uint32(e)._push(UA,e,o)},ja.prototype.string=function(o){var e=qr.length(o);return e?this.uint32(e)._push(qr.write,e,o):this._push(ti,1,0)},ja.prototype.fork=function(){return this.states=new Tt(this),this.head=this.tail=new sf(si,0,0),this.len=0,this},ja.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new sf(si,0,0),this.len=0),this},ja.prototype.ldelim=function(){var o=this.head,e=this.tail,d=this.len;return this.reset().uint32(d),d&&(this.tail.next=o.next,this.tail=e,this.len+=d),this},ja.prototype.finish=function(){for(var o=this.head.next,e=this.constructor.alloc(this.len),d=0;o;)o.fn(o.val,e,d),d+=o.len,o=o.next;return e},ja._configure=function(o){el=o,ja.create=rr(),el._configure()},(jc.prototype=Object.create(xi.prototype)).constructor=jc,jc._configure=function(){jc.alloc=V._Buffer_allocUnsafe,jc.writeBytesBuffer=V.Buffer&&V.Buffer.prototype instanceof Uint8Array&&V.Buffer.prototype.set.name==="set"?function(o,e,d){e.set(o,d)}:function(o,e,d){if(o.copy)o.copy(e,d,0,o.length);else for(var h=0;h<o.length;)e[d++]=o[h++]}},jc.prototype.bytes=function(o){V.isString(o)&&(o=V._Buffer_from(o,"base64"));var e=o.length>>>0;return this.uint32(e),e&&this._push(jc.writeBytesBuffer,e,o),this},jc.prototype.string=function(o){var e=V.Buffer.byteLength(o);return this.uint32(e),e&&this._push(Ut,e,o),this},jc._configure();var zi=La,fl,Em=V.LongBits,VA=V.utf8,sr=typeof Uint8Array<"u"?function(o){if(o instanceof Uint8Array||Array.isArray(o))return new La(o);throw Error("illegal buffer")}:function(o){if(Array.isArray(o))return new La(o);throw Error("illegal buffer")},tr=function(){return V.Buffer?function(o){return(La.create=function(e){return V.Buffer.isBuffer(e)?new fl(e):sr(e)})(o)}:sr};La.create=tr(),La.prototype._slice=V.Array.prototype.subarray||V.Array.prototype.slice,La.prototype.uint32=function(){var o=4294967295;return function(){if(o=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++]||(o=(o|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])||(o=(o|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])||(o=(o|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])||(o=(o|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++]))return o;if((this.pos+=5)>this.len)throw this.pos=this.len,Yb(this,10);return o}}(),La.prototype.int32=function(){return 0|this.uint32()},La.prototype.sint32=function(){var o=this.uint32();return o>>>1^-(1&o)|0},La.prototype.bool=function(){return this.uint32()!==0},La.prototype.fixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return zg(this.buf,this.pos+=4)},La.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return 0|zg(this.buf,this.pos+=4)},La.prototype.float=function(){if(this.pos+4>this.len)throw Yb(this,4);var o=V.float.readFloatLE(this.buf,this.pos);return this.pos+=4,o},La.prototype.double=function(){if(this.pos+8>this.len)throw Yb(this,4);var o=V.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,o},La.prototype.bytes=function(){var o=this.uint32(),e=this.pos,d=this.pos+o;if(d>this.len)throw Yb(this,o);return this.pos+=o,Array.isArray(this.buf)?this.buf.slice(e,d):e===d?new this.buf.constructor(0):this._slice.call(this.buf,e,d)},La.prototype.string=function(){var o=this.bytes();return VA.read(o,0,o.length)},La.prototype.skip=function(o){if(typeof o=="number"){if(this.pos+o>this.len)throw Yb(this,o);this.pos+=o}else do if(this.pos>=this.len)throw Yb(this);while(128&this.buf[this.pos++]);return this},La.prototype.skipType=function(o){switch(o){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(o=7&this.uint32())!=4;)this.skipType(o);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+o+" at offset "+this.pos)}return this},La._configure=function(o){fl=o,La.create=tr(),fl._configure();var e=V.Long?"toLong":"toNumber";V.merge(La.prototype,{int64:function(){return yi.call(this)[e](!1)},uint64:function(){return yi.call(this)[e](!0)},sint64:function(){return yi.call(this).zzDecode()[e](!1)},fixed64:function(){return Fm.call(this)[e](!0)},sfixed64:function(){return Fm.call(this)[e](!1)}})},(Fd.prototype=Object.create(zi.prototype)).constructor=Fd,Fd._configure=function(){V.Buffer&&(Fd.prototype._slice=V.Buffer.prototype.slice)},Fd.prototype.string=function(){var o=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+o,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+o,this.len))},Fd._configure(),(tf.prototype=Object.create(V.EventEmitter.prototype)).constructor=tf,tf.prototype.rpcCall=function o(e,d,h,f,g){if(!f)throw TypeError("request must be specified");var A=this;if(!g)return V.asPromise(o,A,e,d,h,f);if(A.rpcImpl)try{return A.rpcImpl(e,d[A.requestDelimited?"encodeDelimited":"encode"](f).finish(),function(C,k){if(C)return A.emit("error",C,e),g(C);if(k!==null){if(!(k instanceof h))try{k=h[A.responseDelimited?"decodeDelimited":"decode"](k)}catch(j){return A.emit("error",j,e),g(j)}return A.emit("data",k,e),g(null,k)}A.end(!0)})}catch(C){A.emit("error",C,e),setTimeout(function(){g(C)},0)}else setTimeout(function(){g(Error("already ended"))},0)},tf.prototype.end=function(o){return this.rpcImpl&&(o||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var WA=$a(function(o,e){e.Service=tf}),XA={},fc=$a(function(o,e){function d(){h.util._configure(),h.Writer._configure(h.BufferWriter),h.Reader._configure(h.BufferReader)}var h=e;h.build="minimal",h.Writer=xi,h.BufferWriter=jc,h.Reader=zi,h.BufferReader=Fd,h.util=V,h.rpc=WA,h.roots=XA,h.configure=d,d()});fc.util.Long=U,fc.configure();var u=fc.Reader,L=fc.Writer,q=fc.util,t=fc.roots.default||(fc.roots.default={}),YA=t.URI=function(){var o={},e=Object.create(o);return e[o[0]="Unknown"]=0,e[o[1]="PingUri"]=1,e[o[2]="PongUri"]=2,e[o[11]="UserJoinUri"]=11,e[o[12]="UserRespUri"]=12,e[o[21]="UserQuitUri"]=21,e[o[22]="UserDropUri"]=22,e[o[31]="GroupEnterUri"]=31,e[o[32]="GroupLeaveUri"]=32,e[o[33]="GroupReplyUri"]=33,e[o[36]="GroupEnterNoticeUri"]=36,e[o[37]="GroupLeaveNoticeUri"]=37,e[o[38]="GroupEventNoticeUri"]=38,e[o[39]="GroupCountNoticeUri"]=39,e[o[41]="UserStatusListUri"]=41,e[o[42]="UserStatusResultUri"]=42,e[o[51]="GroupStatusListUri"]=51,e[o[52]="GroupStatusResultUri"]=52,e[o[55]="GroupAllUsersListUri"]=55,e[o[56]="GroupAllUsersResultUri"]=56,e[o[100]="MessageUri"]=100,e[o[101]="AckUri"]=101,e[o[115]="FileUploadIndexGetUri"]=115,e[o[116]="FileUploadIndexRetUri"]=116,e[o[117]="FileUploadIndexSetUri"]=117,e[o[118]="FileUploadIndexFinUri"]=118,e[o[119]="FileUploadIndexErrUri"]=119,e[o[125]="FileDownloadIndexGetUri"]=125,e[o[126]="FileDownloadIndexRetUri"]=126,e[o[127]="FileDownloadIndexErrUri"]=127,e[o[201]="UserJoinNoticeUri"]=201,e[o[202]="UserQuitNoticeUri"]=202,e[o[203]="UserWaitNoticeUri"]=203,e[o[301]="UserAttributeGetUri"]=301,e[o[302]="UserAttributeRetUri"]=302,e[o[303]="UserAttributeSetUri"]=303,e[o[304]="UserAttributeModUri"]=304,e[o[305]="UserAttributeDelUri"]=305,e[o[307]="UserAttributeRspUri"]=307,e[o[308]="UserAttributeErrUri"]=308,e[o[311]="UserAttributeKeysGetUri"]=311,e[o[312]="UserAttributeKeysRetUri"]=312,e[o[351]="GroupAttributeGetUri"]=351,e[o[352]="GroupAttributeRetUri"]=352,e[o[353]="GroupAttributeSetUri"]=353,e[o[354]="GroupAttributeModUri"]=354,e[o[355]="GroupAttributeDelUri"]=355,e[o[356]="GroupAttributeAltUri"]=356,e[o[357]="GroupAttributeRspUri"]=357,e[o[358]="GroupAttributeErrUri"]=358,e[o[361]="GroupAttributeKeysGetUri"]=361,e[o[362]="GroupAttributeKeysRetUri"]=362,e[o[401]="SubscribeUserStatusUri"]=401,e[o[402]="UnsubscribeUserStatusUri"]=402,e[o[499]="SubscribeResponseUri"]=499,e}(),Oh=t.Wrapper=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.uri=0,o.prototype.data=q.newBuffer([]),o.encode=function(e,d){return d||(d=L.create()),e.uri!=null&&Object.hasOwnProperty.call(e,"uri")&&d.uint32(8).int32(e.uri),e.data!=null&&Object.hasOwnProperty.call(e,"data")&&d.uint32(18).bytes(e.data),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.Wrapper;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.uri=e.int32();break;case 2:h.data=e.bytes();break;default:e.skipType(7&f)}}return h},o}(),ZA=t.Ping=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.ms!=null&&Object.hasOwnProperty.call(e,"ms")&&d.uint32(16).uint64(e.ms),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.Ping;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.ms=e.uint64();break;default:e.skipType(7&f)}}return h},o}(),$A=t.Pong=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.ms!=null&&Object.hasOwnProperty.call(e,"ms")&&d.uint32(16).uint64(e.ms),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.Pong;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.ms=e.uint64();break;default:e.skipType(7&f)}}return h},o}(),aB=t.UserJoin=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.opt=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.account="",o.prototype.ticket="",o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.opt!=null&&Object.hasOwnProperty.call(e,"opt")&&d.uint32(16).uint64(e.opt),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(24).uint64(e.instance),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(34).string(e.account),e.ticket!=null&&Object.hasOwnProperty.call(e,"ticket")&&d.uint32(42).string(e.ticket),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserJoin;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.opt=e.uint64();break;case 3:h.instance=e.uint64();break;case 4:h.account=e.string();break;case 5:h.ticket=e.string();break;default:e.skipType(7&f)}}return h},o}(),bB=t.UserResp=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.account="",o.prototype.code=0,o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(18).string(e.account),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&d.uint32(24).uint32(e.code),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserResp;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.account=e.string();break;case 3:h.code=e.uint32();break;default:e.skipType(7&f)}}return h},o}(),cB=t.UserQuit=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.encode=function(e,d){return d||(d=L.create()),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserQuit;e.pos<d;){var f=e.uint32();e.skipType(7&f)}return h},o}(),dB=t.UserDrop=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.code=0,o.encode=function(e,d){return d||(d=L.create()),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&d.uint32(8).uint32(e.code),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserDrop;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.code=e.uint32();break;default:e.skipType(7&f)}}return h},o}(),eB=t.GroupEnter=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.account="",o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(18).string(e.account),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupEnter;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.account=e.string();break;default:e.skipType(7&f)}}return h},o}(),fB=t.GroupLeave=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.account="",o.encode=function(e,d){return d||(d=L.create()),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(10).string(e.account),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupLeave;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.account=e.string();break;default:e.skipType(7&f)}}return h},o}(),gB=t.GroupReply=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.account="",o.prototype.code=0,o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(18).string(e.account),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&d.uint32(24).uint32(e.code),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupReply;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.account=e.string();break;case 3:h.code=e.uint32();break;default:e.skipType(7&f)}}return h},o}(),ur=t.GroupLeaveNotice=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.user="",o.prototype.group="",o.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.size=0,o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.user!=null&&Object.hasOwnProperty.call(e,"user")&&d.uint32(18).string(e.user),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(26).string(e.group),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(32).uint64(e.instance),e.size!=null&&Object.hasOwnProperty.call(e,"size")&&d.uint32(40).uint32(e.size),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupLeaveNotice;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.user=e.string();break;case 3:h.group=e.string();break;case 4:h.instance=e.uint64();break;case 5:h.size=e.uint32();break;default:e.skipType(7&f)}}return h},o}(),vr=t.GroupEnterNotice=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.user="",o.prototype.group="",o.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.size=0,o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.user!=null&&Object.hasOwnProperty.call(e,"user")&&d.uint32(18).string(e.user),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(26).string(e.group),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(32).uint64(e.instance),e.size!=null&&Object.hasOwnProperty.call(e,"size")&&d.uint32(40).uint32(e.size),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupEnterNotice;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.user=e.string();break;case 3:h.group=e.string();break;case 4:h.instance=e.uint64();break;case 5:h.size=e.uint32();break;default:e.skipType(7&f)}}return h},o}(),wr=t.Message=function(){function o(e){if(this.MiscMap={},e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.options=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.src="",o.prototype.dst="",o.prototype.payload=q.newBuffer([]),o.prototype.MiscMap=q.emptyObject,o.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,o.encode=function(e,d){if(d||(d=L.create()),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(8).uint64(e.instance),e.dialogue!=null&&Object.hasOwnProperty.call(e,"dialogue")&&d.uint32(16).uint64(e.dialogue),e.sequence!=null&&Object.hasOwnProperty.call(e,"sequence")&&d.uint32(24).uint64(e.sequence),e.options!=null&&Object.hasOwnProperty.call(e,"options")&&d.uint32(32).uint64(e.options),e.src!=null&&Object.hasOwnProperty.call(e,"src")&&d.uint32(42).string(e.src),e.dst!=null&&Object.hasOwnProperty.call(e,"dst")&&d.uint32(50).string(e.dst),e.payload!=null&&Object.hasOwnProperty.call(e,"payload")&&d.uint32(58).bytes(e.payload),e.MiscMap!=null&&Object.hasOwnProperty.call(e,"MiscMap"))for(var h=Object.keys(e.MiscMap),f=0;f<h.length;++f)d.uint32(66).fork().uint32(10).string(h[f]).uint32(18).bytes(e.MiscMap[h[f]]).ldelim();return e.ms!=null&&Object.hasOwnProperty.call(e,"ms")&&d.uint32(72).uint64(e.ms),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h,f,g=new t.Message;e.pos<d;)switch(h=e.uint32(),h>>>3){case 1:g.instance=e.uint64();break;case 2:g.dialogue=e.uint64();break;case 3:g.sequence=e.uint64();break;case 4:g.options=e.uint64();break;case 5:g.src=e.string();break;case 6:g.dst=e.string();break;case 7:g.payload=e.bytes();break;case 8:g.MiscMap===q.emptyObject&&(g.MiscMap={});var A=e.uint32()+e.pos;for(h="",f=[];e.pos<A;){var C=e.uint32();switch(C>>>3){case 1:h=e.string();break;case 2:f=e.bytes();break;default:e.skipType(7&C)}}g.MiscMap[h]=f;break;case 9:g.ms=e.uint64();break;default:e.skipType(7&h)}return g},o}(),xr=t.Ack=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.code=0,o.encode=function(e,d){return d||(d=L.create()),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(8).uint64(e.instance),e.dialogue!=null&&Object.hasOwnProperty.call(e,"dialogue")&&d.uint32(16).uint64(e.dialogue),e.sequence!=null&&Object.hasOwnProperty.call(e,"sequence")&&d.uint32(24).uint64(e.sequence),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&d.uint32(32).uint32(e.code),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.Ack;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.instance=e.uint64();break;case 2:h.dialogue=e.uint64();break;case 3:h.sequence=e.uint64();break;case 4:h.code=e.uint32();break;default:e.skipType(7&f)}}return h},o}(),hB=t.FileUploadIndexGet=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.hash=q.newBuffer([]),o.prototype.size=0,o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.hash!=null&&Object.hasOwnProperty.call(e,"hash")&&d.uint32(18).bytes(e.hash),e.size!=null&&Object.hasOwnProperty.call(e,"size")&&d.uint32(24).uint32(e.size),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.FileUploadIndexGet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.hash=e.bytes();break;case 3:h.size=e.uint32();break;default:e.skipType(7&f)}}return h},o}(),iB=t.FileUploadIndexRet=function(){function o(e){if(this.servers=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.unit=0,o.prototype.servers=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.unit!=null&&Object.hasOwnProperty.call(e,"unit")&&d.uint32(16).uint32(e.unit),e.servers!=null&&e.servers.length){d.uint32(26).fork();for(var h=0;h<e.servers.length;++h)d.uint32(e.servers[h]);d.ldelim()}return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.FileUploadIndexRet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.unit=e.uint32();break;case 3:if(h.servers&&h.servers.length||(h.servers=[]),(7&f)==2)for(f=e.uint32()+e.pos;e.pos<f;)h.servers.push(e.uint32());else h.servers.push(e.uint32());break;default:e.skipType(7&f)}}return h},o}(),jB=t.FileUploadIndexSet=function(){function o(e){if(this.servers=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.hash=q.newBuffer([]),o.prototype.unit=0,o.prototype.servers=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.hash!=null&&Object.hasOwnProperty.call(e,"hash")&&d.uint32(18).bytes(e.hash),e.unit!=null&&Object.hasOwnProperty.call(e,"unit")&&d.uint32(24).uint32(e.unit),e.servers!=null&&e.servers.length){d.uint32(34).fork();for(var h=0;h<e.servers.length;++h)d.uint32(e.servers[h]);d.ldelim()}return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.FileUploadIndexSet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.hash=e.bytes();break;case 3:h.unit=e.uint32();break;case 4:if(h.servers&&h.servers.length||(h.servers=[]),(7&f)==2)for(f=e.uint32()+e.pos;e.pos<f;)h.servers.push(e.uint32());else h.servers.push(e.uint32());break;default:e.skipType(7&f)}}return h},o}(),kB=t.FileUploadIndexFin=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.zone=0,o.prototype.unit=0,o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.zone!=null&&Object.hasOwnProperty.call(e,"zone")&&d.uint32(16).uint32(e.zone),e.unit!=null&&Object.hasOwnProperty.call(e,"unit")&&d.uint32(24).uint32(e.unit),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.FileUploadIndexFin;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.zone=e.uint32();break;case 3:h.unit=e.uint32();break;default:e.skipType(7&f)}}return h},o}(),lB=t.FileUploadIndexErr=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.code=0,o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&d.uint32(16).uint32(e.code),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.FileUploadIndexErr;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.code=e.uint32();break;default:e.skipType(7&f)}}return h},o}(),mB=t.FileDownloadIndexGet=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.zone=0,o.prototype.hash=q.newBuffer([]),o.prototype.size=0,o.prototype.unit=0,o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.zone!=null&&Object.hasOwnProperty.call(e,"zone")&&d.uint32(16).uint32(e.zone),e.hash!=null&&Object.hasOwnProperty.call(e,"hash")&&d.uint32(26).bytes(e.hash),e.size!=null&&Object.hasOwnProperty.call(e,"size")&&d.uint32(32).uint32(e.size),e.unit!=null&&Object.hasOwnProperty.call(e,"unit")&&d.uint32(40).uint32(e.unit),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.FileDownloadIndexGet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.zone=e.uint32();break;case 3:h.hash=e.bytes();break;case 4:h.size=e.uint32();break;case 5:h.unit=e.uint32();break;default:e.skipType(7&f)}}return h},o}(),nB=t.FileDownloadIndexRet=function(){function o(e){if(this.servers=[],this.backups=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.unit=0,o.prototype.zone=0,o.prototype.servers=q.emptyArray,o.prototype.backups=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.unit!=null&&Object.hasOwnProperty.call(e,"unit")&&d.uint32(16).uint32(e.unit),e.zone!=null&&Object.hasOwnProperty.call(e,"zone")&&d.uint32(24).uint32(e.zone),e.servers!=null&&e.servers.length){d.uint32(34).fork();for(var h=0;h<e.servers.length;++h)d.uint32(e.servers[h]);d.ldelim()}if(e.backups!=null&&e.backups.length){for(d.uint32(42).fork(),h=0;h<e.backups.length;++h)d.uint32(e.backups[h]);d.ldelim()}return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.FileDownloadIndexRet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.unit=e.uint32();break;case 3:h.zone=e.uint32();break;case 4:if(h.servers&&h.servers.length||(h.servers=[]),(7&f)==2)for(f=e.uint32()+e.pos;e.pos<f;)h.servers.push(e.uint32());else h.servers.push(e.uint32());break;case 5:if(h.backups&&h.backups.length||(h.backups=[]),(7&f)==2)for(f=e.uint32()+e.pos;e.pos<f;)h.backups.push(e.uint32());else h.backups.push(e.uint32());break;default:e.skipType(7&f)}}return h},o}(),oB=t.FileDownloadIndexErr=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.code=0,o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&d.uint32(16).uint32(e.code),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.FileDownloadIndexErr;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.code=e.uint32();break;default:e.skipType(7&f)}}return h},o}(),pB=t.GroupAllUsersList=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.group="",o.prototype.pageSize=0,o.prototype.pageNumber=0,o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(18).string(e.group),e.pageSize!=null&&Object.hasOwnProperty.call(e,"pageSize")&&d.uint32(24).uint32(e.pageSize),e.pageNumber!=null&&Object.hasOwnProperty.call(e,"pageNumber")&&d.uint32(32).uint32(e.pageNumber),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAllUsersList;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.group=e.string();break;case 3:h.pageSize=e.uint32();break;case 4:h.pageNumber=e.uint32();break;default:e.skipType(7&f)}}return h},o}(),qB=t.GroupAllUsersResult=function(){function o(e){if(this.memberInfos=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.group="",o.prototype.totalSize=0,o.prototype.pageSize=0,o.prototype.pageNumber=0,o.prototype.memberInfos=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(18).string(e.group),e.totalSize!=null&&Object.hasOwnProperty.call(e,"totalSize")&&d.uint32(24).uint32(e.totalSize),e.pageSize!=null&&Object.hasOwnProperty.call(e,"pageSize")&&d.uint32(32).uint32(e.pageSize),e.pageNumber!=null&&Object.hasOwnProperty.call(e,"pageNumber")&&d.uint32(40).uint32(e.pageNumber),e.memberInfos!=null&&e.memberInfos.length)for(var h=0;h<e.memberInfos.length;++h)t.GroupAllUsersResult.MemberInfo.encode(e.memberInfos[h],d.uint32(50).fork()).ldelim();return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAllUsersResult;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.group=e.string();break;case 3:h.totalSize=e.uint32();break;case 4:h.pageSize=e.uint32();break;case 5:h.pageNumber=e.uint32();break;case 6:h.memberInfos&&h.memberInfos.length||(h.memberInfos=[]),h.memberInfos.push(t.GroupAllUsersResult.MemberInfo.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},o.MemberInfo=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(d,h){return h||(h=L.create()),d.account!=null&&Object.hasOwnProperty.call(d,"account")&&h.uint32(10).string(d.account),d.ts!=null&&Object.hasOwnProperty.call(d,"ts")&&h.uint32(16).uint32(d.ts),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.GroupAllUsersResult.MemberInfo;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.account=d.string();break;case 2:f.ts=d.uint32();break;default:d.skipType(7&g)}}return f},e}(),o}(),rB=t.UserStatusList=function(){function o(e){if(this.users=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.users=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.users!=null&&e.users.length)for(var h=0;h<e.users.length;++h)d.uint32(18).string(e.users[h]);return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserStatusList;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.users&&h.users.length||(h.users=[]),h.users.push(e.string());break;default:e.skipType(7&f)}}return h},o}(),sB=t.UserStatusResult=function(){function o(e){if(this.userInfos=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.userInfos=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.userInfos!=null&&e.userInfos.length)for(var h=0;h<e.userInfos.length;++h)t.UserStatusResult.UserStatusInfo.encode(e.userInfos[h],d.uint32(18).fork()).ldelim();return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserStatusResult;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.userInfos&&h.userInfos.length||(h.userInfos=[]),h.userInfos.push(t.UserStatusResult.UserStatusInfo.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},o.UserStatusInfo=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(d,h){return h||(h=L.create()),d.account!=null&&Object.hasOwnProperty.call(d,"account")&&h.uint32(10).string(d.account),d.ts!=null&&Object.hasOwnProperty.call(d,"ts")&&h.uint32(16).uint32(d.ts),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.UserStatusResult.UserStatusInfo;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.account=d.string();break;case 2:f.ts=d.uint32();break;default:d.skipType(7&g)}}return f},e}(),o}(),tB=t.UserAttributeGet=function(){function o(e){if(this.attributes=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.account="",o.prototype.attributes=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(18).string(e.account),e.attributes!=null&&e.attributes.length)for(var h=0;h<e.attributes.length;++h)d.uint32(26).string(e.attributes[h]);return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserAttributeGet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.account=e.string();break;case 3:h.attributes&&h.attributes.length||(h.attributes=[]),h.attributes.push(e.string());break;default:e.skipType(7&f)}}return h},o}(),uB=t.UserAttributeRet=function(){function o(e){if(this.attributeInfos=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.attributeInfos=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.attributeInfos!=null&&e.attributeInfos.length)for(var h=0;h<e.attributeInfos.length;++h)t.UserAttributeRet.AttributeInfo.encode(e.attributeInfos[h],d.uint32(18).fork()).ldelim();return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserAttributeRet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.attributeInfos&&h.attributeInfos.length||(h.attributeInfos=[]),h.attributeInfos.push(t.UserAttributeRet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},o.AttributeInfo=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.key="",e.prototype.value="",e.encode=function(d,h){return h||(h=L.create()),d.key!=null&&Object.hasOwnProperty.call(d,"key")&&h.uint32(10).string(d.key),d.value!=null&&Object.hasOwnProperty.call(d,"value")&&h.uint32(18).string(d.value),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.UserAttributeRet.AttributeInfo;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.key=d.string();break;case 2:f.value=d.string();break;default:d.skipType(7&g)}}return f},e}(),o}(),vB=t.UserAttributeSet=function(){function o(e){if(this.attributeInfos=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.account="",o.prototype.attributeInfos=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(18).string(e.account),e.attributeInfos!=null&&e.attributeInfos.length)for(var h=0;h<e.attributeInfos.length;++h)t.UserAttributeSet.AttributeInfo.encode(e.attributeInfos[h],d.uint32(26).fork()).ldelim();return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserAttributeSet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.account=e.string();break;case 3:h.attributeInfos&&h.attributeInfos.length||(h.attributeInfos=[]),h.attributeInfos.push(t.UserAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},o.AttributeInfo=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.key="",e.prototype.value="",e.encode=function(d,h){return h||(h=L.create()),d.key!=null&&Object.hasOwnProperty.call(d,"key")&&h.uint32(10).string(d.key),d.value!=null&&Object.hasOwnProperty.call(d,"value")&&h.uint32(18).string(d.value),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.UserAttributeSet.AttributeInfo;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.key=d.string();break;case 2:f.value=d.string();break;default:d.skipType(7&g)}}return f},e}(),o}(),wB=t.UserAttributeMod=function(){function o(e){if(this.attributeInfos=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.account="",o.prototype.attributeInfos=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(18).string(e.account),e.attributeInfos!=null&&e.attributeInfos.length)for(var h=0;h<e.attributeInfos.length;++h)t.UserAttributeMod.AttributeInfo.encode(e.attributeInfos[h],d.uint32(26).fork()).ldelim();return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserAttributeMod;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.account=e.string();break;case 3:h.attributeInfos&&h.attributeInfos.length||(h.attributeInfos=[]),h.attributeInfos.push(t.UserAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},o.AttributeInfo=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.key="",e.prototype.value="",e.encode=function(d,h){return h||(h=L.create()),d.key!=null&&Object.hasOwnProperty.call(d,"key")&&h.uint32(10).string(d.key),d.value!=null&&Object.hasOwnProperty.call(d,"value")&&h.uint32(18).string(d.value),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.UserAttributeMod.AttributeInfo;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.key=d.string();break;case 2:f.value=d.string();break;default:d.skipType(7&g)}}return f},e}(),o}(),xB=t.UserAttributeDel=function(){function o(e){if(this.attributes=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.account="",o.prototype.attributes=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(18).string(e.account),e.attributes!=null&&e.attributes.length)for(var h=0;h<e.attributes.length;++h)d.uint32(26).string(e.attributes[h]);return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserAttributeDel;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.account=e.string();break;case 3:h.attributes&&h.attributes.length||(h.attributes=[]),h.attributes.push(e.string());break;default:e.skipType(7&f)}}return h},o}(),yB=t.UserAttributeErr=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.code=0,o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&d.uint32(16).uint32(e.code),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserAttributeErr;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.code=e.uint32();break;default:e.skipType(7&f)}}return h},o}(),zB=t.UserAttributeKeysGet=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.account="",o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(18).string(e.account),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserAttributeKeysGet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.account=e.string();break;default:e.skipType(7&f)}}return h},o}(),AB=t.UserAttributeKeysRet=function(){function o(e){if(this.keys=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.keys=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.keys!=null&&e.keys.length)for(var h=0;h<e.keys.length;++h)d.uint32(18).string(e.keys[h]);return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserAttributeKeysRet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.keys&&h.keys.length||(h.keys=[]),h.keys.push(e.string());break;default:e.skipType(7&f)}}return h},o}(),BB=t.UserAttributeRsp=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserAttributeRsp;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;default:e.skipType(7&f)}}return h},o}(),CB=t.GroupStatusList=function(){function o(e){if(this.groups=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.groups=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.groups!=null&&e.groups.length)for(var h=0;h<e.groups.length;++h)d.uint32(18).string(e.groups[h]);return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupStatusList;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.groups&&h.groups.length||(h.groups=[]),h.groups.push(e.string());break;default:e.skipType(7&f)}}return h},o}(),DB=t.GroupStatusResult=function(){function o(e){if(this.groupInfos=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.groupInfos=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.groupInfos!=null&&e.groupInfos.length)for(var h=0;h<e.groupInfos.length;++h)t.GroupStatusResult.GroupInfo.encode(e.groupInfos[h],d.uint32(18).fork()).ldelim();return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupStatusResult;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.groupInfos&&h.groupInfos.length||(h.groupInfos=[]),h.groupInfos.push(t.GroupStatusResult.GroupInfo.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},o.GroupInfo=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.group="",e.prototype.memberCount=0,e.encode=function(d,h){return h||(h=L.create()),d.group!=null&&Object.hasOwnProperty.call(d,"group")&&h.uint32(10).string(d.group),d.memberCount!=null&&Object.hasOwnProperty.call(d,"memberCount")&&h.uint32(16).uint32(d.memberCount),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.GroupStatusResult.GroupInfo;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.group=d.string();break;case 2:f.memberCount=d.uint32();break;default:d.skipType(7&g)}}return f},e}(),o}(),EB=t.GroupCountNotice=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.group="",o.prototype.size=0,o.encode=function(e,d){return d||(d=L.create()),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(8).uint64(e.instance),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(16).uint64(e.seq),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(26).string(e.group),e.size!=null&&Object.hasOwnProperty.call(e,"size")&&d.uint32(32).uint32(e.size),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupCountNotice;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.instance=e.uint64();break;case 2:h.seq=e.uint64();break;case 3:h.group=e.string();break;case 4:h.size=e.uint32();break;default:e.skipType(7&f)}}return h},o}(),FB=t.GroupAttributeGet=function(){function o(e){if(this.attributes=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.group="",o.prototype.attributes=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(18).string(e.group),e.attributes!=null&&e.attributes.length)for(var h=0;h<e.attributes.length;++h)d.uint32(26).string(e.attributes[h]);return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeGet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.group=e.string();break;case 3:h.attributes&&h.attributes.length||(h.attributes=[]),h.attributes.push(e.string());break;default:e.skipType(7&f)}}return h},o}(),GB=t.GroupAttributeRet=function(){function o(e){if(this.attributeMaps=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.attributeMaps=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.attributeMaps!=null&&e.attributeMaps.length)for(var h=0;h<e.attributeMaps.length;++h)t.GroupAttributeRet.AttributeMap.encode(e.attributeMaps[h],d.uint32(18).fork()).ldelim();return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeRet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.attributeMaps&&h.attributeMaps.length||(h.attributeMaps=[]),h.attributeMaps.push(t.GroupAttributeRet.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},o.AttributeMap=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(d,h){return h||(h=L.create()),d.key!=null&&Object.hasOwnProperty.call(d,"key")&&h.uint32(10).string(d.key),d.value!=null&&Object.hasOwnProperty.call(d,"value")&&h.uint32(18).string(d.value),d.origin!=null&&Object.hasOwnProperty.call(d,"origin")&&h.uint32(26).string(d.origin),d.ms!=null&&Object.hasOwnProperty.call(d,"ms")&&h.uint32(32).uint64(d.ms),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.GroupAttributeRet.AttributeMap;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.key=d.string();break;case 2:f.value=d.string();break;case 3:f.origin=d.string();break;case 4:f.ms=d.uint64();break;default:d.skipType(7&g)}}return f},e}(),o}(),HB=t.GroupAttributeSet=function(){function o(e){if(this.attributeInfos=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.group="",o.prototype.broadcast=!1,o.prototype.attributeInfos=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(18).string(e.group),e.broadcast!=null&&Object.hasOwnProperty.call(e,"broadcast")&&d.uint32(24).bool(e.broadcast),e.attributeInfos!=null&&e.attributeInfos.length)for(var h=0;h<e.attributeInfos.length;++h)t.GroupAttributeSet.AttributeInfo.encode(e.attributeInfos[h],d.uint32(34).fork()).ldelim();return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeSet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.group=e.string();break;case 3:h.broadcast=e.bool();break;case 4:h.attributeInfos&&h.attributeInfos.length||(h.attributeInfos=[]),h.attributeInfos.push(t.GroupAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},o.AttributeInfo=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.key="",e.prototype.value="",e.encode=function(d,h){return h||(h=L.create()),d.key!=null&&Object.hasOwnProperty.call(d,"key")&&h.uint32(10).string(d.key),d.value!=null&&Object.hasOwnProperty.call(d,"value")&&h.uint32(18).string(d.value),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.GroupAttributeSet.AttributeInfo;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.key=d.string();break;case 2:f.value=d.string();break;default:d.skipType(7&g)}}return f},e}(),o}(),IB=t.GroupAttributeMod=function(){function o(e){if(this.attributeInfos=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.group="",o.prototype.broadcast=!1,o.prototype.attributeInfos=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(18).string(e.group),e.broadcast!=null&&Object.hasOwnProperty.call(e,"broadcast")&&d.uint32(24).bool(e.broadcast),e.attributeInfos!=null&&e.attributeInfos.length)for(var h=0;h<e.attributeInfos.length;++h)t.GroupAttributeMod.AttributeInfo.encode(e.attributeInfos[h],d.uint32(34).fork()).ldelim();return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeMod;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.group=e.string();break;case 3:h.broadcast=e.bool();break;case 4:h.attributeInfos&&h.attributeInfos.length||(h.attributeInfos=[]),h.attributeInfos.push(t.GroupAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},o.AttributeInfo=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.key="",e.prototype.value="",e.encode=function(d,h){return h||(h=L.create()),d.key!=null&&Object.hasOwnProperty.call(d,"key")&&h.uint32(10).string(d.key),d.value!=null&&Object.hasOwnProperty.call(d,"value")&&h.uint32(18).string(d.value),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.GroupAttributeMod.AttributeInfo;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.key=d.string();break;case 2:f.value=d.string();break;default:d.skipType(7&g)}}return f},e}(),o}(),JB=t.GroupAttributeDel=function(){function o(e){if(this.attributes=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.group="",o.prototype.broadcast=!1,o.prototype.attributes=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(18).string(e.group),e.broadcast!=null&&Object.hasOwnProperty.call(e,"broadcast")&&d.uint32(24).bool(e.broadcast),e.attributes!=null&&e.attributes.length)for(var h=0;h<e.attributes.length;++h)d.uint32(34).string(e.attributes[h]);return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeDel;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.group=e.string();break;case 3:h.broadcast=e.bool();break;case 4:h.attributes&&h.attributes.length||(h.attributes=[]),h.attributes.push(e.string());break;default:e.skipType(7&f)}}return h},o}(),KB=t.GroupAttributeAlt=function(){function o(e){if(this.attributeMaps=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.group="",o.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.attributeMaps=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(18).string(e.group),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(24).uint64(e.instance),e.attributeMaps!=null&&e.attributeMaps.length)for(var h=0;h<e.attributeMaps.length;++h)t.GroupAttributeAlt.AttributeMap.encode(e.attributeMaps[h],d.uint32(34).fork()).ldelim();return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeAlt;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.group=e.string();break;case 3:h.instance=e.uint64();break;case 4:h.attributeMaps&&h.attributeMaps.length||(h.attributeMaps=[]),h.attributeMaps.push(t.GroupAttributeAlt.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},o.AttributeMap=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(d,h){return h||(h=L.create()),d.key!=null&&Object.hasOwnProperty.call(d,"key")&&h.uint32(10).string(d.key),d.value!=null&&Object.hasOwnProperty.call(d,"value")&&h.uint32(18).string(d.value),d.origin!=null&&Object.hasOwnProperty.call(d,"origin")&&h.uint32(26).string(d.origin),d.ms!=null&&Object.hasOwnProperty.call(d,"ms")&&h.uint32(32).uint64(d.ms),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.GroupAttributeAlt.AttributeMap;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.key=d.string();break;case 2:f.value=d.string();break;case 3:f.origin=d.string();break;case 4:f.ms=d.uint64();break;default:d.skipType(7&g)}}return f},e}(),o}(),LB=t.GroupAttributeRsp=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeRsp;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;default:e.skipType(7&f)}}return h},o}(),MB=t.GroupAttributeErr=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.code=0,o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&d.uint32(16).uint32(e.code),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeErr;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.code=e.uint32();break;default:e.skipType(7&f)}}return h},o}(),NB=t.GroupAttributeKeysGet=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.group="",o.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(18).string(e.group),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeKeysGet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.group=e.string();break;default:e.skipType(7&f)}}return h},o}(),OB=t.GroupAttributeKeysRet=function(){function o(e){if(this.keys=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.keys=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.keys!=null&&e.keys.length)for(var h=0;h<e.keys.length;++h)d.uint32(18).string(e.keys[h]);return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeKeysRet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.keys&&h.keys.length||(h.keys=[]),h.keys.push(e.string());break;default:e.skipType(7&f)}}return h},o}(),PB=t.SubscribeUserStatus=function(){function o(e){if(this.users=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.users=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.users!=null&&e.users.length)for(var h=0;h<e.users.length;++h)d.uint32(18).string(e.users[h]);return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.SubscribeUserStatus;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.users&&h.users.length||(h.users=[]),h.users.push(e.string());break;default:e.skipType(7&f)}}return h},o}(),QB=t.UnsubscribeUserStatus=function(){function o(e){if(this.users=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.users=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.users!=null&&e.users.length)for(var h=0;h<e.users.length;++h)d.uint32(18).string(e.users[h]);return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UnsubscribeUserStatus;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.users&&h.users.length||(h.users=[]),h.users.push(e.string());break;default:e.skipType(7&f)}}return h},o}(),RB=t.UserJoinNotice=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.user="",o.encode=function(e,d){return d||(d=L.create()),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(8).uint64(e.instance),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(16).uint64(e.seq),e.user!=null&&Object.hasOwnProperty.call(e,"user")&&d.uint32(26).string(e.user),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserJoinNotice;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.instance=e.uint64();break;case 2:h.seq=e.uint64();break;case 3:h.user=e.string();break;default:e.skipType(7&f)}}return h},o}(),SB=t.UserQuitNotice=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.user="",o.encode=function(e,d){return d||(d=L.create()),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(8).uint64(e.instance),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(16).uint64(e.seq),e.user!=null&&Object.hasOwnProperty.call(e,"user")&&d.uint32(26).string(e.user),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserQuitNotice;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.instance=e.uint64();break;case 2:h.seq=e.uint64();break;case 3:h.user=e.string();break;default:e.skipType(7&f)}}return h},o}(),TB=t.UserWaitNotice=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.user="",o.encode=function(e,d){return d||(d=L.create()),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(8).uint64(e.instance),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(16).uint64(e.seq),e.user!=null&&Object.hasOwnProperty.call(e,"user")&&d.uint32(26).string(e.user),d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserWaitNotice;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.instance=e.uint64();break;case 2:h.seq=e.uint64();break;case 3:h.user=e.string();break;default:e.skipType(7&f)}}return h},o}(),UB=t.SubscribeResponse=function(){function o(e){if(this.errors=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,o.prototype.errors=q.emptyArray,o.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.errors!=null&&e.errors.length)for(var h=0;h<e.errors.length;++h)t.SubscribeResponse.SubscribeErrorsType.encode(e.errors[h],d.uint32(18).fork()).ldelim();return d},o.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.SubscribeResponse;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.errors&&h.errors.length||(h.errors=[]),h.errors.push(t.SubscribeResponse.SubscribeErrorsType.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},o.SubscribeErrorsType=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.account="",e.prototype.code=0,e.encode=function(d,h){return h||(h=L.create()),d.account!=null&&Object.hasOwnProperty.call(d,"account")&&h.uint32(10).string(d.account),d.code!=null&&Object.hasOwnProperty.call(d,"code")&&h.uint32(16).uint32(d.code),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.SubscribeResponse.SubscribeErrorsType;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.account=d.string();break;case 2:f.code=d.uint32();break;default:d.skipType(7&g)}}return f},e}(),o}(),VB=Object.freeze({__proto__:null,URI:YA,Wrapper:Oh,Ping:ZA,Pong:$A,UserJoin:aB,UserResp:bB,UserQuit:cB,UserDrop:dB,GroupEnter:eB,GroupLeave:fB,GroupReply:gB,GroupLeaveNotice:ur,GroupEnterNotice:vr,Message:wr,Ack:xr,FileUploadIndexGet:hB,FileUploadIndexRet:iB,FileUploadIndexSet:jB,FileUploadIndexFin:kB,FileUploadIndexErr:lB,FileDownloadIndexGet:mB,FileDownloadIndexRet:nB,FileDownloadIndexErr:oB,GroupAllUsersList:pB,GroupAllUsersResult:qB,UserStatusList:rB,UserStatusResult:sB,UserAttributeGet:tB,UserAttributeRet:uB,UserAttributeSet:vB,UserAttributeMod:wB,UserAttributeDel:xB,UserAttributeErr:yB,UserAttributeKeysGet:zB,UserAttributeKeysRet:AB,UserAttributeRsp:BB,GroupStatusList:CB,GroupStatusResult:DB,GroupCountNotice:EB,GroupAttributeGet:FB,GroupAttributeRet:GB,GroupAttributeSet:HB,GroupAttributeMod:IB,GroupAttributeDel:JB,GroupAttributeAlt:KB,GroupAttributeRsp:LB,GroupAttributeErr:MB,GroupAttributeKeysGet:NB,GroupAttributeKeysRet:OB,SubscribeUserStatus:PB,UnsubscribeUserStatus:QB,UserJoinNotice:RB,UserQuitNotice:SB,UserWaitNotice:TB,SubscribeResponse:UB,default:t}),WB=Math.ceil,yr=function(o){return function(e,d,h){var f=(e=String(jb(e))).length;return h=h===void 0?" ":String(h),(d=ta(d))<=f||h==""?e:(d-=f,(f=Pn.call(h,WB(d/h.length))).length>d&&(f=f.slice(0,d)),o?e+f:f+e)}},XB=yr(!1),YB=yr(!0),zr=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(De);N({target:"String",proto:!0,forced:zr},{padEnd:function(o){return YB(this,o,1<arguments.length?arguments[1]:void 0)}});var ZB=zf,Ar=function(o){return function(e){e=qb(e);for(var d,h=Dc(e),f=h.length,g=0,A=[];f>g;)d=h[g++],ka&&!ZB.call(e,d)||A.push(o?[d,e[d]]:e[d]);return A}},$B=Ar(!0),aC=Ar(!1);N({target:"Object",stat:!0},{entries:function(o){return $B(o)}});var bC=Fb.f,Br="".endsWith,cC=Math.min,Cr=dk("endsWith"),dC=!Cr&&!!function(){var o=bC(String.prototype,"endsWith");return o&&!o.writable}();N({target:"String",proto:!0,forced:!dC&&!Cr},{endsWith:function(o){var e=String(jb(this));ck(o);var d=1<arguments.length?arguments[1]:void 0,h=ta(e.length);return d=d===void 0?h:cC(ta(d),h),h=String(o),Br?Br.call(e,h,d):e.slice(d-h.length,d)===h}}),dh("match",1,function(o,e,d){return[function(h){var f=jb(this),g=h==null?void 0:h[o];return g!==void 0?g.call(h,f):new RegExp(h)[o](String(f))},function(h){var f=d(e,h,this);if(f.done)return f.value;if(h=va(h),f=String(this),!h.global)return Ke(h,f);var g=h.unicode;h.lastIndex=0;for(var A,C=[],k=0;(A=Ke(h,f))!==null;)A=String(A[0]),C[k]=A,A===""&&(h.lastIndex=xj(f,ta(h.lastIndex),g)),k++;return k===0?null:C}]});var eC=Fb.f,Dr="".startsWith,fC=Math.min,Er=dk("startsWith"),gC=!Er&&!!function(){var o=eC(String.prototype,"startsWith");return o&&!o.writable}();N({target:"String",proto:!0,forced:!gC&&!Er},{startsWith:function(o){var e=String(jb(this));ck(o);var d=ta(fC(1<arguments.length?arguments[1]:void 0,e.length)),h=String(o);return Dr?Dr.call(e,h,d):e.slice(d,d+h.length)===h}});var Nm=function(o){var e=/(%?)(%([jds]))/g,d=Array.prototype.slice.call(arguments,1);return d.length&&(o=o.replace(e,function(h,f,g,A){switch(g=d.shift(),A){case"s":g=""+g;break;case"d":g=Number(g);break;case"j":g=JSON.stringify(g)}return f?(d.unshift(g),h):g})),d.length&&(o+=" "+d.join(" ")),""+(o=o.replace(/%{2,2}/g,"%"))},hC=/\s/,iC=function(o){for(var e=o.length;e--&&hC.test(o.charAt(e)););return e},jC=/^\s+/,Fr=NaN,kC=/^[-+]0x[0-9a-f]+$/i,lC=/^0b[01]+$/i,mC=/^0o[0-7]+$/i,nC=parseInt,gl=function(o){if(typeof o=="number")return o;if(ie(o))return Fr;if(lb(o)&&(o=typeof o.valueOf=="function"?o.valueOf():o,o=lb(o)?o+"":o),typeof o!="string")return o===0?o:+o;o=o&&o.slice(0,iC(o)+1).replace(jC,"");var e=lC.test(o);return e||mC.test(o)?nC(o.slice(2),e?2:8):kC.test(o)?Fr:+o},oC=Math.max,pC=Math.min,qC=function(o,e,d){function h(_l){var nE=k,sE=j;return k=j=void 0,Ei=_l,_t=o.apply(sE,nE)}function f(_l){var nE=_l-ue;return _l-=Ei,ue===void 0||nE>=e||0>nE||_c&&_l>=_d}function g(){var _l=Cb.Date.now();if(f(_l))return A(_l);var nE=setTimeout,sE=_l-Ei;_l=e-(_l-ue),sE=_c?pC(_l,_d-sE):_l,_n=nE(g,sE)}function A(_l){return _n=void 0,_u&&k?h(_l):(k=j=void 0,_t)}function C(){var _l=Cb.Date.now(),nE=f(_l);if(k=arguments,j=this,ue=_l,nE){if(_n===void 0)return Ei=_l=ue,_n=setTimeout(g,e),_s?h(_l):_t;if(_c)return clearTimeout(_n),_n=setTimeout(g,e),h(ue)}return _n===void 0&&(_n=setTimeout(g,e)),_t}var k,j,_t,_n,ue,Ei=0,_s=!1,_c=!1,_u=!0;if(typeof o!="function")throw new TypeError("Expected a function");if(e=gl(e)||0,lb(d)){_s=!!d.leading;var _d=(_c="maxWait"in d)?oC(gl(d.maxWait)||0,e):_d;_u="trailing"in d?!!d.trailing:_u}return C.cancel=function(){_n!==void 0&&clearTimeout(_n),Ei=0,k=ue=j=_n=void 0},C.flush=function(){return _n===void 0?_t:A(Cb.Date.now())},C},yc=function(o){function e(h,f){return W(this,e),m(n(h=d.call(this,Mm(h,f))),"originalError",void 0),m(n(h),"code",void 0),m(n(h),"serverCode",void 0),typeof f=="number"?h.code=f:typeof f=="string"?h.name=f:f!==void 0&&(f.originalError&&(h.originalError=f.originalError),f.code!==void 0&&(h.code=f.code),f.serverCode!==void 0&&(h.serverCode=f.serverCode)),h}la(e,o);var d=ma(e);return e}(ef(Error)),Ia=function(o){function e(h,f){return W(this,e),m(n(h=d.call(this,Mm(h,f))),"name","RtmInternalError"),m(n(h),"code",void 0),h.code=f,h}la(e,o);var d=ma(e);return e}(ef(Error)),Ph=function(){return function(o){function e(h){W(this,e);var f=Object.keys(h);return d.call(this,h[f[0]],f[0])}la(e,o);var d=ma(e);return e}(Ia)},Fa=Ph(),db=function(o){function e(){W(this,e);for(var h=arguments.length,f=Array(h),g=0;g<h;g++)f[g]=arguments[g];return m(n(h=d.call.apply(d,[this].concat(f))),"name","RtmTimeoutError"),h}la(e,o);var d=ma(e);return e}(yc),I=function(o){function e(){W(this,e);for(var h=arguments.length,f=Array(h),g=0;g<h;g++)f[g]=arguments[g];return m(n(h=d.call.apply(d,[this].concat(f))),"name","RtmInvalidArgumentError"),h}la(e,o);var d=ma(e);return e}(yc),K=function(o){function e(){W(this,e);for(var h=arguments.length,f=Array(h),g=0;g<h;g++)f[g]=arguments[g];return m(n(h=d.call.apply(d,[this].concat(f))),"name","RtmInvalidStatusError"),h}la(e,o);var d=ma(e);return e}(yc),hl=function(o){function e(){W(this,e);for(var h=arguments.length,f=Array(h),g=0;g<h;g++)f[g]=arguments[g];return m(n(h=d.call.apply(d,[this].concat(f))),"name","RtmInterruptedError"),h}la(e,o);var d=ma(e);return e}(yc),ib=function(o){function e(){W(this,e);for(var h=arguments.length,f=Array(h),g=0;g<h;g++)f[g]=arguments[g];return m(n(h=d.call.apply(d,[this].concat(f))),"name","RtmLimitExceededError"),h}la(e,o);var d=ma(e);return e}(yc),rC=function(o){function e(){W(this,e);for(var h=arguments.length,f=Array(h),g=0;g<h;g++)f[g]=arguments[g];return m(n(h=d.call.apply(d,[this].concat(f))),"name","RtmInvokeTooOftenError"),h}la(e,o);var d=ma(e);return e}(yc),da=function(o){function e(){W(this,e);for(var h=arguments.length,f=Array(h),g=0;g<h;g++)f[g]=arguments[g];return m(n(h=d.call.apply(d,[this].concat(f))),"name","RtmUnavailableError"),m(n(h),"serverCode",void 0),m(n(h),"statusCode",void 0),h}la(e,o);var d=ma(e);return e}(yc),Ye=function(o){function e(){W(this,e);for(var h=arguments.length,f=Array(h),g=0;g<h;g++)f[g]=arguments[g];return m(n(h=d.call.apply(d,[this].concat(f))),"name","RtmUnauthenticatedError"),m(n(h),"serverCode",void 0),h}la(e,o);var d=ma(e);return e}(yc),Wc=function(o){function e(){W(this,e);for(var h=arguments.length,f=Array(h),g=0;g<h;g++)f[g]=arguments[g];return m(n(h=d.call.apply(d,[this].concat(f))),"name","RtmUnknownError"),h}la(e,o);var d=ma(e);return e}(yc),Sa=function(o){return o instanceof db||o instanceof pb},sa=function(o){return o instanceof yc},Yd=function(o,e,d){return['Executing "%s.%s" timed out after %ds',o,e,d/1e3]},Lm=new Map,sC=function(){var o=new Date;return"".concat(o.toISOString().split("T")[1].replace(/\..+/,""),".").concat(o.getMilliseconds())},xf=Object.keys,Hg=Object.entries.bind(Object),Cg=function(o){return typeof o=="string"?o.endsWith(".")?o:"".concat(o,"."):o},Sm=function(o){for(var e="",d=(o=new Uint8Array(o)).byteLength,h=-1;++h<d;)e+=String.fromCharCode(o[h]);return e=btoa(e),"data:;base64,".concat(e)},tC=R(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1});N({target:"Date",proto:!0,forced:tC},{toJSON:function(o){o=Qa(this);var e=lc(o);return typeof e!="number"||isFinite(e)?o.toISOString():null}}),N({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var $t=Object.prototype.hasOwnProperty,Gr=function(o,e,d){return JSON.stringify(Ym(o),e,d)};Gr.ensureProperties=Ym;var uC=function(o,e){e=e||{};var d=X(o);if(d==="string"&&0<o.length)return au(o);if(d==="number"&&isFinite(o))return e.long?o=864e5<=(e=Math.abs(o))?Jg(o,e,864e5,"day"):36e5<=e?Jg(o,e,36e5,"hour"):6e4<=e?Jg(o,e,6e4,"minute"):1e3<=e?Jg(o,e,1e3,"second"):o+" ms":o=864e5<=(e=Math.abs(o))?Math.round(o/864e5)+"d":36e5<=e?Math.round(o/36e5)+"h":6e4<=e?Math.round(o/6e4)+"m":1e3<=e?Math.round(o/1e3)+"s":o+"ms",o;throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(o))},vC=function(o){function e(f){function g(){for(var k=arguments.length,j=Array(k),_t=0;_t<k;_t++)j[_t]=arguments[_t];if(g.enabled){k=Number(new Date),g.diff=k-(A||k),g.prev=A,A=g.curr=k,j[0]=e.coerce(j[0]),typeof j[0]!="string"&&j.unshift("%O");var _n=0;j[0]=j[0].replace(/%([a-zA-Z%])/g,function(ue,Ei){return ue==="%%"?"%":(_n++,typeof(Ei=e.formatters[Ei])=="function"&&(ue=Ei.call(g,j[_n]),j.splice(_n,1),_n--),ue)}),e.formatArgs.call(g,j),(g.log||e.log).apply(g,j)}}var A,C=null;return g.namespace=f,g.useColors=e.useColors(),g.color=e.selectColor(f),g.extend=d,g.destroy=e.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:function(){return C===null?e.enabled(f):C},set:function(k){C=k}}),typeof e.init=="function"&&e.init(g),g}function d(f,g){return(f=e(this.namespace+(g===void 0?":":g)+f)).log=this.log,f}function h(f){return f.toString().substring(2,f.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(f){return f instanceof Error?f.stack||f.message:f},e.disable=function(){var f=[].concat(G(e.names.map(h)),G(e.skips.map(h).map(function(g){return"-"+g}))).join(",");return e.enable(""),f},e.enable=function(f){e.save(f),e.names=[],e.skips=[];var g,A=(typeof f=="string"?f:"").split(/[\s,]+/),C=A.length;for(g=0;g<C;g++)A[g]&&((f=A[g].replace(/\*/g,".*?"))[0]==="-"?e.skips.push(new RegExp("^"+f.substr(1)+"$")):e.names.push(new RegExp("^"+f+"$")))},e.enabled=function(f){if(f[f.length-1]==="*")return!0;var g,A=0;for(g=e.skips.length;A<g;A++)if(e.skips[A].test(f))return!1;for(A=0,g=e.names.length;A<g;A++)if(e.names[A].test(f))return!0;return!1},e.humanize=uC,e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(o).forEach(function(f){e[f]=o[f]}),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(f){for(var g=0,A=0;A<f.length;A++)g=(g<<5)-g+f.charCodeAt(A),g|=0;return e.colors[Math.abs(g)%e.colors.length]},e.enable(e.load()),e},Hr=$a(function(o,e){e.formatArgs=function(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+o.exports.humanize(this.diff),this.useColors){var f="color: "+this.color;h.splice(1,0,f,"color: inherit");var g=0,A=0;h[0].replace(/%[a-zA-Z%]/g,function(C){C!=="%%"&&(g++,C==="%c"&&(A=g))}),h.splice(A,0,f)}},e.save=function(h){try{h?e.storage.setItem("debug",h):e.storage.removeItem("debug")}catch{}},e.load=function(){try{var h=e.storage.getItem("debug")}catch{}return!h&&typeof process<"u"&&"env"in process&&(h={}.DEBUG),h},e.useColors=function(){return!(typeof window>"u"||!window.process||window.process.type!=="renderer"&&!window.process.__nwjs)||(typeof navigator>"u"||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};t:{try{var d=localStorage;break t}catch{}d=void 0}e.storage=d,e.destroy=function(){var h=!1;return function(){h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),e.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),e.log=console.debug||console.log||function(){},o.exports=vC(e),o.exports.formatters.j=function(h){try{return JSON.stringify(h)}catch(f){return"[UnexpectedJSONParseError]: "+f.message}}}),Ir=Hr("RTM:DEBUG"),Ze;Ir.enabled=!1,function(o){o[o.Uploading=0]="Uploading",o[o.Free=1]="Free"}(Ze||(Ze={}));var wC=function(){function o(e){W(this,o),m(this,"uploadRequest",void 0),m(this,"uploadState",void 0),m(this,"uploadResendCount",void 0),m(this,"LogCache",void 0),m(this,"LogsToPost",void 0),m(this,"processId",void 0),m(this,"sdkVersion",void 0),m(this,"logId",void 0),m(this,"rtmConfig",void 0),this.processId=e.processId,this.sdkVersion=e.sdkVersion,this.rtmConfig=e.rtmConfig,this.uploadRequest=e.uploadRequest,this.uploadState=Ze.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return Ha(o,[{key:"upload",value:function(e){this.LogCache.push(e),this.uploadState===Ze.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(e){var d=this;this.uploadState=Ze.Uploading,setTimeout(J(w.mark(function h(){var f,g,A;return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return f={sdk_version:d.sdkVersion,process_id:d.processId,payload:JSON.stringify(e)},C.prev=1,C.next=4,d.uploadRequest(f,(g=d.rtmConfig.enableCloudProxy)!==null&&g!==void 0&&g);case 4:if(!Uk){C.next=6;break}throw Error("RTM is busy");case 6:C.next=13;break;case 8:return C.prev=8,C.t0=C.catch(1),A=2>d.uploadResendCount++?2e3:1e4,setTimeout(function(){return d.postLog(d.LogsToPost)},A),C.abrupt("return");case 13:if(Ir('The logs uploaded for "process-'.concat(gg,'"')),d.LogCache.length!==0){C.next=17;break}return d.uploadState=Ze.Free,C.abrupt("return");case 17:d.uploadResendCount=0,d.LogsToPost=40>d.LogCache.length?d.LogCache.splice(0,d.LogCache.length):d.LogCache.splice(0,40),d.postLog(d.LogsToPost);case 20:case"end":return C.stop()}},h,null,[[1,8]])})),Zd.getParameter("LOG_UPLOAD_INTERVAL"))}}]),o}(),Jr=function(o,e,d,h,f,g,A,C){var k=0;for(A=!!A&&Id(A,C,3);k<h;){if(k in d){if(C=A?A(d[k],k,e):d[k],0<g&&gd(C))f=Jr(o,e,C,ta(C.length),f,g-1)-1;else{if(9007199254740991<=f)throw TypeError("Exceed the acceptable array length");o[f]=C}f++}k++}return f},xC=Jr;N({target:"Array",proto:!0},{flat:function(){var o=arguments.length?arguments[0]:void 0,e=Qa(this),d=ta(e.length),h=Sg(e,0);return h.length=xC(h,e,e,d,0,o===void 0?1:$b(o)),h}}),N({target:"Object",stat:!0},{values:function(o){return aC(o)}});var yC=["CODE"],Db,ud,F;(function(o){o.CHINA="CN",o.ASIA="AS",o.NORTH_AMERICA="NA",o.EUROPE="EU",o.JAPAN="JP",o.INDIA="IN",o.OCEANIA="OC",o.SOUTH_AMERICA="SA",o.AFRICA="AF",o.OVERSEA="OVERSEA",o.GLOBAL="GLOBAL"})(F||(F={}));var zC={CN:F.CHINA,NA:F.NORTH_AMERICA,EU:F.EUROPE,AS:F.ASIA,JP:F.JAPAN,IN:F.INDIA,GLOB:F.GLOBAL,AF:F.AFRICA,OC:F.OVERSEA,OVS:F.OVERSEA,SA:F.SOUTH_AMERICA},Kg=Wm((Db={},m(Db,F.ASIA,{CODE:F.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.NORTH_AMERICA,{CODE:F.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.EUROPE,{CODE:F.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.JAPAN,{CODE:F.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.INDIA,{CODE:F.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OVERSEA,{CODE:F.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),m(Db,F.GLOBAL,{CODE:F.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OCEANIA,{CODE:F.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.SOUTH_AMERICA,{CODE:F.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.AFRICA,{CODE:F.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.CHINA,{CODE:F.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),Db)),yf=(ud={},m(ud,F.ASIA,[F.CHINA,F.JAPAN,F.INDIA]),m(ud,F.EUROPE,[]),m(ud,F.NORTH_AMERICA,[]),m(ud,F.SOUTH_AMERICA,[]),m(ud,F.OCEANIA,[]),m(ud,F.AFRICA,[]),ud),Kr=[F.OVERSEA,F.GLOBAL,F.CHINA,F.NORTH_AMERICA,F.EUROPE,F.ASIA,F.JAPAN,F.INDIA,F.OCEANIA,F.SOUTH_AMERICA,F.AFRICA],Zm=function(o){return Object.values(yf).flat().includes(o)},cu=function(o){var e;return(e=Hg(yf).find(function(d){return(d=ra(d,2))[0],d[1].includes(o)}))===null||e===void 0?void 0:e[0]},AC=function(o){return o.sort(function(e,d){return Kr.indexOf(e)-Kr.indexOf(d)})},xe=function(o){var e=new Set;if((o=AC(o).slice(0,3).map(function(d){var h=Kg[d];if(h===void 0)throw new Ia("invalid area key");return d=h.CODE,h=ff(h,yC),e.add(d),h})).length===0)throw new Ia("areas cannot be empty");return ua({CODES:e},o.reduce(function(d,h){for(var f=0,g=Hg(d);f<g.length;f++){var A=ra(g[f],2),C=A[0];A=A[1],d[C]=Array.from(new Set([].concat(G(h[C]),G(A))))}return d}))},M,Lr=function(){var o=J(w.mark(function e(d,h){var f,g,A,C,k,j=arguments;return w.wrap(function(_t){for(;;)switch(_t.prev=_t.next){case 0:if(!(2<(g=2<j.length&&j[2]!==void 0?j[2]:0))){_t.next=3;break}return _t.abrupt("return");case 3:return A={withCredentials:!0,body:d,timeout:2e4},C=0<g?(M==null?void 0:M.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(M==null?void 0:M.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",k=h?"https://".concat((f=M==null?void 0:M.PROXY_NGINX[0])!==null&&f!==void 0?f:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(C,"&p=443&d=upload/v1"):"https://".concat(C,"/upload/v1"),_t.next=8,te(k,A).catch(function(_n){return Lr(d,h,g+1)});case 8:case"end":return _t.stop()}},e)}));return function(e,d){return o.apply(this,arguments)}}(),Mr=new wC({processId:"process-".concat(gg),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.4.3-17-g1e27aa38"),uploadRequest:Lr,rtmConfig:{}}),il="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),Nr="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),Or="serverReceivedTs isOfflineMessage enableHistoricalMessaging enableOfflineMessaging hasPeerReceived messageType enableNotificationToChannelMembers lastUpdateTs".split(" "),BC="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),ye=function(o){if(typeof o=="string")return oa(o);if(Array.isArray(o)&&o.every(function(g){return typeof g=="string"}))return o.map(function(g){return oa(g)});if(!Il(o)){for(var e={},d=0;d<Or.length;d++){var h=Or[d];h in o&&(e[h]=o[h])}if(0<Object.keys(e).length)return e;if(5>Object.keys(o).length){for(d=0,o=Object.entries(o);d<o.length;d++){var f=ra(o[d],2);h=f[0],f=f[1],il.includes(h)?e[h]="[Hidden Info]":e[oa(h)]=typeof f=="string"?oa(f):"[Sensitive Info]"}return e}return"[Sensitive Info]"}return o},Pr=function(o){return X(o)==="object"?yd(o)?Vm(fe(o,5),il,Nr):o.constructor&&o.constructor.name:o},Qr=function(o,e){return o instanceof Error?o.message:typeof o!="string"?JSON.stringify(Vm(fe(o,5),il,Nr)):(e=e.map(function(d){return d instanceof Error?d.message:X(d)==="object"?Gr(Array.isArray(d)?d.map(Pr):Pr(d)):d}),Nm.apply(void 0,[o.replace(/%[%Oo]/g,function(d){return d==="%%"?"%":d==="%o"||d==="%O"?"%s":d})].concat(G(e))))},CC=1,Rr=function(o,e,d){var h=Hr(o);return h.enabled=!0,h.log=d,h.useColors=!1,function(f){for(var g=arguments.length,A=Array(1<g?g-1:0),C=1;C<g;C++)A[C-1]=arguments[C];if(e.enableLogUpload){g=Cg(f);var k=Qr(g,A);Mr.upload({log_item_id:"".concat(CC++),log_level:o,payload_str:"[".concat(sC(),"] ").concat(o," - ").concat(256<k.length?k.slice(0,256):k)})}switch(g=function(j){var _t=k||Qr(Cg(f),A),_n=Nc.LOG_HANDLER;typeof _n=="function"&&_n({level:j,message:_t}),h(_t)},o){case"RTM:INFO":e.logFilter.info&&g("log");break;case"RTM:WARN":e.logFilter.warn&&g("warning");break;case"RTM:ERROR":e.logFilter.error&&g("error");break;case"RTM:TRACK":e.logFilter.track&&g("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":e.logFilter.debug&&g("debug");break;case"RTM:DEBUG":e.logFilter.debug&&g("debug")}}},jl,Sr=function(o){return function(e){var d=jl===1||o===void 0?"":"Ins#".concat(o," ");return"".concat(d).concat(e)}},kl=function(o,e,d){var h=Sr(jl);return Rr("RTM:".concat(e),d,function(f){return o(h(f))})},tb=function(){return function(o){function e(h,f){var g=2<arguments.length&&arguments[2]!==void 0&&arguments[2];W(this,e);var A=d.call(this);if(m(n(A),"logError",void 0),m(n(A),"invokeTracker",void 0),m(n(A),"resultTracker",void 0),m(n(A),"errorTracker",void 0),m(n(A),"eventTracker",void 0),m(n(A),"info",void 0),m(n(A),"warn",void 0),m(n(A),"log",void 0),m(n(A),"genLogger",void 0),m(n(A),"loggerId",void 0),m(n(A),"logger",void 0),m(n(A),"name",void 0),A.logger=h,A.name=f,A.loggerId=h.loggerId,A.info=h.info,A.warn=h.warn,A.logError=h.logError,A.genLogger=h.genLogger,A.log=h.genLogger("RTM:DEBUG","<".concat(f,"> ")),A.invokeTracker=h.genTracker("Invoke"),A.eventTracker=h.genTracker("Event"),A.resultTracker=h.genTracker("Result"),A.errorTracker=h.genTracker("Error"),g){var C=A.emit.bind(n(A));A.emit=function(){for(var k=arguments.length,j=Array(k),_t=0;_t<k;_t++)j[_t]=arguments[_t];k=j[0],_t=j.slice(1);var _n=BC.includes(k);A.eventTracker.apply(A,["%s: ".concat(0<_t.length?"%s emitted with args: ".concat(_t.map(function(){return"%o"})):"%s emitted"),f,k].concat(G(_n?_t.map(ye):_t)));try{C.apply(void 0,j)}catch(ue){A.logError("Caught in the callback function of the event %s",k,ue)}}}return A}la(e,o);var d=ma(e);return e}(ea)},DC=function(o){return kl(console.log.bind(console),"INFO",o)},EC=function(o){return kl(console.warn.bind(console),"WARN",o)},FC=function(o){return kl(console.error.bind(console),"ERROR",o)},Tr=function(o,e){return function(d){var h=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"",f=Sr(o),g=console.debug.bind(console),A=Rr(d,e,function(C){return g(f(C))});return function(C){for(var k=arguments.length,j=Array(1<k?k-1:0),_t=1;_t<k;_t++)j[_t-1]=arguments[_t];return A.apply(void 0,[h+C].concat(j))}}},GC=function(o,e){return function(d){return Tr(o,e)("RTM:TRACK","[".concat(d,"] "))}},Li=t.URI,eu=Oh,HC=ff(VB,["Wrapper"]),$m=Gk(HC,"URI"),Ur=function(o,e){var d=-1,h=o.length,f=h-1;for(e=e===void 0?h:e;++d<e;){var g=o[h=nr(d,f)];o[h]=o[d],o[d]=g}return o.length=e,o},IC=function(o){return Ur(Xh(o))},JC=function(o){return Ur(Ni(o))},$e=function(o){return(Va(o)?IC:JC)(o)},af={0:9591,1:9593},$d=function(o){return"https://".concat(o,"/api/v1")},KC=bb.apply(void 0,G($e(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map($d)))),LC=bb.apply(void 0,G($e(["ap-web-1.agora.io","ap-web-2.agora.io"].map($d)))),MC=bb.apply(void 0,G($e(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map($d)))),NC=bb.apply(void 0,G($e(["ap-web-3.agora.io","ap-web-4.agora.io"].map($d)))),ll=Ph(),ml=function(o){function e(h,f,g,A,C,k){W(this,e);var j=d.call(this,C,Ai("Socket-",C.loggerId));if(m(n(j),"isActiveClose",!1),m(n(j),"loggedIn",!1),m(n(j),"useNewDomain",void 0),m(n(j),"receivedPacket",new Pa),m(n(j),"open$",void 0),m(n(j),"input$",new Pa),m(n(j),"userJoin$",new Pa),m(n(j),"attemptsSinceLastError",0),m(n(j),"message$",new Pa),m(n(j),"socket$",void 0),m(n(j),"toClose",new Pa),m(n(j),"toReconnect",new Pa),m(n(j),"sendLogger",void 0),m(n(j),"receiveLogger",void 0),m(n(j),"ip",void 0),m(n(j),"env",void 0),m(n(j),"ticket",void 0),m(n(j),"context",void 0),m(n(j),"getDomain",function(){return an(j.ip,j.useNewDomain)}),m(n(j),"socketReconnector",function(ue){var Ei=function(_s){return j.attemptsSinceLastError+=1,j.warn("The %s of Env %d reconnecting %s",j.name,j.env,_s.message),Bc(3e3)};return ue.pipe(Ga(function(_s){return j.log("socket connection closed"),j.loggedIn=!1,2<=j.attemptsSinceLastError?(j.warn("socket connection failure"),j.emit("connectionFailure"),j.close(),Z(_s)):j.isActiveClose?vb:(j.emit("reconnect"),j.useNewDomain=!j.useNewDomain,Z(_s))}),oe(function(_s){return _s.pipe(Cc(Ei))}))}),j.ip=h,j.env=f,j.ticket=g,j.context=A,j.useNewDomain=k??.5<=Math.random(),j.sendLogger=j.genLogger("RTM:MSG:SEND"),j.receiveLogger=j.genLogger("RTM:MSG:RECV"),f!==0&&f!==1)throw new ll({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});if(!Gm(h))throw new ll({IP_NOT_VALID:"The ip from ap is not valid"});var _t=af[f];j.log("Opening websocket address %s for the Env %d",j.ip,j.env);var _n=Xb(j.input$,j.userJoin$.pipe(Rt(2)),j.message$).pipe(ba(function(ue){return Oh.encode(ue).finish()}));return h=Xb(St("",{protocols:[],makeWebSocket:function(){if(j.context.config.enableCloudProxy){if(j.context.cloudProxyServers.length===0)throw j.logError("No cloud proxy server to connect"),new da;var ue="wss://".concat(an(bn(j.context.cloudProxyServers),!1),"/");ue=we(ue,"sid",j.context.sid),ue=we(ue,"remote_port",_t.toString()),ue=we(ue,"remote_ip",j.ip),ue=we(ue,"token",j.context.key),ue=new WebSocket(ue)}else ue=new WebSocket("wss://".concat(j.getDomain(),":").concat(_t));return ue.binaryType="arraybuffer",ue}}),j.toReconnect),j.socket$=Ca(h,Tk.pipe(hb(15e3),Ga(function(ue){return Sa(ue)&&j.warn("socket open timed out"),Z(ue)}))).pipe(ba(function(ue){if(ue instanceof Error)throw j.warn("Env_%d: Force reconnect the socket",j.env),ue;return ue(_n).pipe(ba(function(Ei){return Oh.decode(new Uint8Array(Ei))}))}),j.socketReconnector),j.open$=j.socket$.pipe(ca(function(ue){j.log("Websocket opened",j.name),ue.subscribe(function(Ei){var _s=Ei.data;Ei=Li[Ei.uri].slice(0,-3),_s=$m[Ei].decode(_s);var _c=HA({},Gk(_s,"toJSON"),function(nE,sE){return sE instanceof U?Km(sE):sE}),_u=!1;if((_s instanceof vr||_s instanceof ur)&&_s.instance.lessThanOrEqual(4294967295)&&(_u=!0),_s instanceof wr||_s instanceof xr){var _d=_s.instance,_l=_s.sequence;(_s.dialogue.lessThanOrEqual(4294967295)||_d.lessThanOrEqual(4294967295)||_l.lessThan(1))&&(_u=!0)}_u?j.warn("Env_%d: Illegal %s, abandoned %o",j.env,Ei,_c):(Ei!=="Pong"&&j.receiveLogger("Env_%d: %s %o",j.env,Ei,_c),j.receivedPacket.next([Ei,_s]))},function(){})}),qf(void 0),ob(j.toClose),pe()),j}la(e,o);var d=ma(e);return Ha(e,[{key:"address",get:function(){return"".concat(this.ip,":").concat(af[this.env])}},{key:"sendPacket",value:function(h,f){if(h!=="Ping"){var g=uc(f,function(A){return A instanceof U?Km(A):A});this.sendLogger("Env_%d: %s %o",this.env,h,g)}f=du(h,f),h==="UserJoin"?this.userJoin$.next(f):h==="Message"?this.message$.next(f):this.input$.next(f)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(h){var f=this;return this.receivedPacket.pipe(ca(function(g){var A=ra(g,2);g=A[0],A=A[1],g==="UserResp"&&(f.attemptsSinceLastError=0,f.loggedIn=!0),g==="UserDrop"&&f.emit("socketUserDrop",A)}),wb(function(g){return ra(g,1)[0]===h}),ba(function(g){return ra(g,2)[1]}))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new ll({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),e}(tb());N({target:"String",proto:!0,forced:zr},{padStart:function(o){return XB(this,o,1<arguments.length?arguments[1]:void 0)}});var OC=function(o){var e=xf(Kg);o=Yt(o);for(var d=0;d<e.length;d++){var h=Kg[e[d]];if(h!=null&&h.AP_DOMAINS.includes(o)||h!=null&&h.AP_BACKUP_DOMAINS.includes(o)||h!=null&&h.PROXY_AP.includes(o))return[h.CODE]}return[F.CHINA,F.GLOBAL]},PC={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},Vr={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},QC=[100,101,102],Qh=/web-(\d)/,Wr=function(o){function e(h,f){var g=2<arguments.length&&arguments[2]!==void 0&&arguments[2];W(this,e);var A=d.call(this,f,"AccessPoint");return m(n(A),"handleUniLbsError",function(C,k){var j=C;if(4<C.toString().length){var _t=C.toString().padStart(8,"0"),_n=parseInt(_t.slice(0,4),10);if(_t=parseInt(_t.slice(4,8),10),_n===201)j=_t;else if(_n===101&&!QC.includes(_t))return Z(Error("service is currently unavailable"))}if(_n=j.toString(),!Object.keys(Vr).includes(_n))return(C=new da(["Login is rejected by the server. The response code is %d",C],jg)).serverCode=j,Z(C);switch(_n=Vr[_n],j=PC[_n],_n){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(k=new Ye(j,$q)).serverCode=C,Z(k);case"INVALID_USER_ID":return(k=new Ye(j,Jh)).serverCode=C,Z(k);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(k=new Ye(j,Kh)).serverCode=C,Z(k);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(k=new Ye(j,ar)).serverCode=C,Z(k);case"CANNOT_MEET_AREA_DEMAND":return(k=OC(k)).forEach(function(ue){return A.failedAreas.add(ue)}),A.failedAreas.size===(M===void 0?2:M.CODES.size)?((k=new I(j,jg)).serverCode=C,Z(k)):Z(Error("ap ".concat(k.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(k=new da(j,jg)).serverCode=C,Z(k);default:return Z(Im("ApResErrType",_n))}}),m(n(A),"getApEdgeInfo$",void 0),m(n(A),"getApEdgeInfoEndFirst$",void 0),m(n(A),"apFinish$",new Pa),m(n(A),"retryCount",0),m(n(A),"failedAreas",new Set),m(n(A),"usedUrl",[]),m(n(A),"newDomainUsed",!1),m(n(A),"backupNewDomainUsed",!1),m(n(A),"genUrl",function(){return M===void 0?mi.apply(void 0,G($e([KC,LC]))).pipe(ni(function(C){return bb.apply(void 0,G(C))})):bb.apply(void 0,G(M.AP_DOMAINS.slice(0,3).map($d)))}),m(n(A),"genBackupUrl",function(){return M===void 0?mi.apply(void 0,G($e([MC,NC]))).pipe(ni(function(C){return bb.apply(void 0,G(C))})):bb.apply(void 0,G(M.AP_BACKUP_DOMAINS.slice(0,3).map($d)))}),m(n(A),"getApUrl$",function(C){var k,j;return A.genUrl().pipe(wb(function(_t){return(!A.newDomainUsed||!_t.includes("sd-rtn.com"))&&(_t.includes("sd-rtn.com")&&(A.newDomainUsed=!0),!dl(A.usedUrl,function(_n){var ue;return _n===((ue=_t.match(Qh))===null||ue===void 0?void 0:ue[1])}))}),ca(function(_t){var _n;M===void 0&&typeof(_t=(_n=_t.match(Qh))===null||_n===void 0?void 0:_n[1])=="string"&&A.usedUrl.push(_t)}),Ka(C?Math.max(Nc.RECONNECTING_AP_NUM,(k=M==null?void 0:M.CODES.size)!==null&&k!==void 0?k:0):(j=M==null?void 0:M.CODES.size)!==null&&j!==void 0?j:2),Dd(function(){return e.runOutOfUrlSymbol}),Ga(function(_t,_n){return A.newDomainUsed=!1,_t===e.runOutOfUrlSymbol?(A.usedUrl=[],_n):Z(_t)}))}),m(n(A),"getBackupApUrl$",function(C){var k,j;return A.genBackupUrl().pipe(wb(function(_t){return(!A.backupNewDomainUsed||!_t.includes("sd-rtn.com"))&&(_t.includes("sd-rtn.com")&&(A.backupNewDomainUsed=!0),!dl(A.usedUrl,function(_n){var ue;return _n===((ue=_t.match(Qh))===null||ue===void 0?void 0:ue[1])}))}),ca(function(_t){var _n;M===void 0&&typeof(_t=(_n=_t.match(Qh))===null||_n===void 0?void 0:_n[1])=="string"&&A.usedUrl.push(_t)}),Ka(C?Math.max(Nc.RECONNECTING_AP_NUM,(k=M==null?void 0:M.CODES.size)!==null&&k!==void 0?k:0):(j=M==null?void 0:M.CODES.size)!==null&&j!==void 0?j:2),Dd(function(){return e.runOutOfUrlSymbol}),Ga(function(_t,_n){return A.backupNewDomainUsed=!1,_t===e.runOutOfUrlSymbol?(A.usedUrl=[],_n):Z(_t)}))}),m(n(A),"getProxyApUrl$",function(C){var k,j;return bb.apply(void 0,G(((M==null?void 0:M.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map($d))).pipe(Ka(C?Math.max(Nc.RECONNECTING_AP_NUM,(k=M==null?void 0:M.CODES.size)!==null&&k!==void 0?k:0):(j=M==null?void 0:M.CODES.size)!==null&&j!==void 0?j:2))}),m(n(A),"context",void 0),m(n(A),"fetchCloudProxy",function(C,k){var j=Ai("AP-",A.loggerId);A.log("The AccessPoint requests %s(%s)",C,j);var _t=new AbortController;return A.apFinish$.pipe(Ka(1)).subscribe(function(){return _t.abort()}),ad(J(w.mark(function _n(){var ue;return w.wrap(function(Ei){for(;;)switch(Ei.prev=Ei.next){case 0:return ue=Ag(0,Number.MAX_SAFE_INTEGER),A.log("%s request opid: %d",j,ue),Ei.abrupt("return",te(C,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:A.context.sid,opid:ue,appid:A.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:k??A.context.key,cname:A.context.uid,uid:0,detail:ua({},M===void 0?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(_s){return _s===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):_s}).join(",")})}}]},signal:_t.signal}));case 3:case"end":return Ei.stop()}},_n)}))).pipe(Ga(function(_n){return _n.name!=="AbortError"&&(A.logError(_n),A.warn("The AP server %s request failure",C,_n)),vb}),cb(function(){var _n=J(w.mark(function ue(Ei){var _s,_c,_u,_d,_l,nE,sE,vE,mE,yE,BE,t_,vf,fE,hE,bE,_h,tE,aE;return w.wrap(function(TE){for(;;)switch(TE.prev=TE.next){case 0:if(_s=Ei.responseText,_c=JSON.parse(_s),A.log("The %s response is %o",j,_c),((_u=_c.response_body)===void 0||_u.length===0||_u.some(function(OE){var e_;return((e_=OE.buffer)===null||e_===void 0?void 0:e_.code)===void 0||OE.uri!==23}))&&Z(new da("cloud proxy response_body not valid",jg)),(_d=_u.filter(function(OE){return OE.buffer.code!==0})).length===0){TE.next=14;break}if((_l=_d.find(function(OE){return OE.buffer.flag===128}))===void 0){TE.next=12;break}return TE.abrupt("return",A.handleUniLbsError(_l.buffer.code,C));case 12:return A.logError("cloud proxy error response"),TE.abrupt("return",A.handleUniLbsError(_d[0].buffer.code,C));case 14:for(nE=[],sE=0;sE<_u.length;sE++)if(((yE=_u[sE])==null||(vE=yE.buffer)===null||vE===void 0?void 0:vE.flag)===262144)(BE=yE.buffer)===null||BE===void 0||(t_=BE.edges_services)===null||t_===void 0||(vf=t_.forEach)===null||vf===void 0||vf.call(t_,function(OE){Gm(OE=OE.ip)&&A.context.cloudProxyServers.indexOf(OE)===-1&&(A.log("got cloud proxy server: %s",OE),A.context.cloudProxyServers.push(OE))});else if((yE==null||(mE=yE.buffer)===null||mE===void 0?void 0:mE.flag)===128){for(_h=function(OE,e_){var NE=e_[OE];nE.some(function(y_){return y_.ip===NE.ip})||nE.push({ip:NE.ip,ticket:yE.buffer.cert})},tE=0,aE=yE.buffer.edges_services;tE<aE.length;tE++)_h(tE,aE);A.context.rtmArea=(fE=(hE=yE.buffer)===null||hE===void 0||(bE=hE.detail)===null||bE===void 0?void 0:bE[9])!==null&&fE!==void 0?fE:""}return TE.abrupt("return",bb.apply(void 0,G(nE).concat([fg])));case 19:case"end":return TE.stop()}},ue)}));return function(ue){return _n.apply(this,arguments)}}()),Ga(function(_n){return sa(_n)?Z(_n):vb}),tg(),wb(function(_n){return _n!==void 0&&typeof _n.ip=="string"&&typeof _n.ticket=="string"}))}),m(n(A),"fetchAp",function(C,k){var j=Ai("AP-",A.loggerId);A.log("The AccessPoint requests %s(%s)",C,j);var _t=new AbortController;return A.apFinish$.pipe(Ka(1)).subscribe(function(){return _t.abort()}),ad(J(w.mark(function _n(){var ue;return w.wrap(function(Ei){for(;;)switch(Ei.prev=Ei.next){case 0:return ue=Ag(0,Number.MAX_SAFE_INTEGER),A.log("%s request opid: %d",j,ue),Ei.abrupt("return",te(C,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:ue,key:k||A.context.key,cname:A.context.uid,detail:ua({},M===void 0?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(_s){return _s===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):_s}).join(",")}),uid:0,sid:A.context.sid},signal:_t.signal}));case 3:case"end":return Ei.stop()}},_n)}))).pipe(Ga(function(_n){return _n.name!=="AbortError"&&(A.logError(_n),A.warn("The AP server %s request failure",C,_n)),vb}),cb(function(){var _n=J(w.mark(function ue(Ei){var _s,_c,_u,_d,_l,nE,sE;return w.wrap(function(vE){for(;;)switch(vE.prev=vE.next){case 0:if(_s=Ei.responseText,_c=JSON.parse(_s),A.log("The %s response is %o",j,_c),_d=(_u=_c).code,_l=_u.addresses,nE=_u.detail,_d===0){vE.next=6;break}return vE.abrupt("return",A.handleUniLbsError(_d,C));case 6:if((sE=_l).length!==0){vE.next=11;break}return vE.abrupt("return",Z(Error("No available edge address to connect")));case 11:return A.context.rtmArea=nE==null?void 0:nE[9],vE.abrupt("return",bb.apply(void 0,G(sE).concat([fg])));case 13:case"end":return vE.stop()}},ue)}));return function(ue){return _n.apply(this,arguments)}}()),tg(),Ga(function(_n){return sa(_n)?Z(_n):vb}),wb(function(_n){return _n!==void 0&&typeof _n.ip=="string"&&typeof _n.ticket=="string"}))}),A.context=h,A.getApEdgeInfoEndFirst$=function(){var C=0<arguments.length&&arguments[0]!==void 0&&arguments[0];return Bc(0,C||g?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(1),ca(function(){A.retryCount+=1}),cb(function(){return A.context.config.enableCloudProxy?A.getProxyApUrl$(C||g):(4<=A.retryCount&&(A.retryCount=0),3>=A.retryCount?A.getApUrl$(C||g):A.getBackupApUrl$(C||g))}),cb(function(k){return A.context.config.enableCloudProxy?A.fetchCloudProxy(k):A.fetchAp(k)}),Ga(function(k){return k instanceof pb&&A.warn("AP request timeout"),Z(k)}),om(function(k){return k.ip}),ob(A.apFinish$))},A.getApEdgeInfo$=function(C){return Bc(0,C||g?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(8),ca(function(){A.retryCount+=1}),cb(function(){return A.context.config.enableCloudProxy?A.getProxyApUrl$(C||g):3>=A.retryCount?A.getApUrl$(C||g):A.getBackupApUrl$(C||g)}),cb(function(k){return(A.context.config.enableCloudProxy?A.fetchCloudProxy(k):A.fetchAp(k)).pipe()}),Ga(function(k){return k instanceof pb&&A.warn("AP request timeout"),Z(k)}),om(function(k){return k.ip}),ob(A.apFinish$))},A}la(e,o);var d=ma(e);return Ha(e,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),e}(tb());m(Wr,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var Xr=Ph(),Yr=function(o){function e(h,f,g){W(this,e);var A=d.call(this,f,"Connection");m(n(A),"apClient",void 0),m(n(A),"lastOpenSockets",[new qe(1),new qe(1)]),m(n(A),"curOpenSockets",[void 0,void 0]),m(n(A),"ipIterator",0),m(n(A),"firstEnv",.5<=Math.random()?1:0),m(n(A),"firstSocketOpener",void 0),m(n(A),"secondSocketOpener",void 0),m(n(A),"firstOpenKeeperSubject",new Pa),m(n(A),"secondOpenKeeperSubject",new Pa),m(n(A),"edgeInfoReplayed",void 0),m(n(A),"firstEnvOpenSocket",void 0),m(n(A),"firstOpenKeeperSub",void 0),m(n(A),"secondOpenKeeperSub",void 0),m(n(A),"context",void 0),m(n(A),"logger",void 0),A.context=h,A.logger=f,A.apClient=new Wr(A.context,f),A.apClient.apFinish$.subscribe(function(){A.log("Ap client fetch finished")});var C,k=[];return A.edgeInfoReplayed=A.apClient.getApEdgeInfo$(g).pipe(oe(function(j){return j.pipe(ca(function(_t){if(sa(_t))throw _t}),cd(g?Zd.getParameter("RECONNECTING_AP_INTERVAL"):900),ob(Bc(2e4)))}),wb(function(j){return!dl(k,j)}),Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),ca(function(j){k.push(j),A.log("An edge info got %o",j)}),ca({error:function(j){A.emit("connectionInitFailure",j)}}),wg(function(){A.apClient.clearUp()}),sm()),A.firstEnvOpenSocket=A.edgeInfoReplayed.pipe(cb(function(j){if(j===void 0)return Z(Error("Invalid edge info"));var _t=new ml(j.ip,A.firstEnv,j.ticket,A.context,f,C);return A.firstEnv=A.firstEnv===1?0:1,_t.on("connectionFailure",function(){return A.onSocketConnectionFailure(_t)}),C=!_t.useNewDomain,_t.open$.pipe(qf(_t))}),ca(function(j){A.log("The websocket of ENV_%d opened to %s:%d",j.env,j.ip,af[j.env]),A.curOpenSockets[j.env]=j,A.lastOpenSockets[j.env].next(j),A.firstEnv=j.env,A.openSecondSocket(j.env,j.ip,j.useNewDomain)}),Ka(1),pe()),A.firstSocketOpener=A.firstEnvOpenSocket.pipe(cb(function(j){return j.open$.pipe(ca(function(){A.log("The websocket of first ENV_%d re-opened to %s:%d",j.env,j.ip,af[j.env]),A.curOpenSockets[j.env]=j,A.lastOpenSockets[j.env].next(j)}))})),h=A.firstOpenKeeperSubject.pipe(Cc(Yc)),A.firstOpenKeeperSub=h.subscribe({error:A.logError}),A}la(e,o);var d=ma(e);return Ha(e,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(h,f){if(![0,1].includes(h))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});var g=h===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var A=this.curOpenSockets[h];this.curOpenSockets[h]=void 0,A&&(A.isActiveClose=!0,setTimeout(function(){A.close()},f)),g!==void 0&&setTimeout(function(){g==null||g.unsubscribe()},f)}},{key:"waitClosing",value:function(h){var f=this;return h.isActiveClose=!0,h.open$.pipe(tt(),Ga(function(g){return g.message===mr.normalClosureMessage?vb:Z(g)}),hb(5e3),Ga(function(g){return g instanceof pb?(f.warn("Force closing the ENV_%d connection",h.env),vb):Z(g)}))}},{key:"onSocketConnectionFailure",value:function(h){var f=[0,1].filter(function(g){return g!==h.env})[0];(f=this.curOpenSockets[f])&&f.loggedIn?this.reopenSocketWithApRequest(h.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(h,f,g){var A=this,C=h===1?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(rm(function(k,j){return[].concat(G(k),[j])},[]),ba(function(k){return kr(k,function(j){return Jm(f,j.ip)}).slice(-1)[0]}),Ka(1),cb(function(k){if(k===void 0)return Z(Error("Invalid edge info"));var j=new ml(k.ip,C,k.ticket,A.context,A.logger,g);return j.on("connectionFailure",function(){return A.onSocketConnectionFailure(j)}),j.open$.pipe(ca(function(){A.lastOpenSockets[C].next(j),A.curOpenSockets[C]=j}))}),pe()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Cc(Yc)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(h){var f=this,g=[0,1].filter(function(k){return k!==h})[0];if((g=this.curOpenSockets[g])!==void 0){var A,C=g.ip;g=this.apClient.getApEdgeInfoEndFirst$(!0).pipe(Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),oe(function(k){return k.pipe(ca(function(j){if(j.code===Kh)f.emit("tokenExpired"),f.apClient.apFinish$.next(void 0);else if(sa(j))throw j}),cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")),ob(Bc(15e3)))}),ca(function(k){f.log("An edge info got %o",k)}),wg(function(){f.apClient.clearUp()})).pipe(rm(function(k,j){return[].concat(G(k),[j])},[]),ba(function(k){return(k=kr(k,function(j){return Jm(C,j.ip)})).length-1>=f.ipIterator?k.slice(-f.ipIterator++-1)[0]:(f.ipIterator=0,k.slice(-1)[0])}),Dd(),cb(function(k){if(k===void 0)return Z(Error("Invalid edge info"));var j=new ml(k.ip,h,k.ticket,f.context,f.logger,A);return j.on("connectionFailure",function(){return f.onSocketConnectionFailure(j)}),A=!j.useNewDomain,j.open$.pipe(qf(j))}),ca(function(k){f.log("The websocket of ENV_%d re-opened to %s:%d using ap",k.env,k.ip,af[k.env]),f.curOpenSockets[h]=k,f.lastOpenSockets[h].next(k)}),cb(function(k){return k.open$.pipe(ca(function(){f.log("The websocket of ENV_%d re-opened to %s:%d",k.env,k.ip,af[k.env]),f.curOpenSockets[h]=k,f.lastOpenSockets[h].next(k)}))}),pe()),h===this.firstEnv?this.firstOpenKeeperSubject.next(g):this.secondOpenKeeperSubject.next(g)}}}]),e}(tb()),Xc=fc.Writer,na=fc.util,zc=fc.roots.default||(fc.roots.default={}),RC=zc.Session=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.sid="",o.prototype.userId="",o.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,o.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,o.prototype.appId="",o.prototype.ver="",o.prototype.buildno=0,o.prototype.installId="",o.prototype.os=0,o.prototype.did="",o.prototype.index=null,o.prototype.token="",o.prototype.version=0,o.prototype.subVersion=0,o.encode=function(e,d){return d||(d=Xc.create()),e.sid!=null&&Object.hasOwnProperty.call(e,"sid")&&d.uint32(10).string(e.sid),e.userId!=null&&Object.hasOwnProperty.call(e,"userId")&&d.uint32(18).string(e.userId),e.lts!=null&&Object.hasOwnProperty.call(e,"lts")&&d.uint32(24).int64(e.lts),e.elapse!=null&&Object.hasOwnProperty.call(e,"elapse")&&d.uint32(32).int64(e.elapse),e.appId!=null&&Object.hasOwnProperty.call(e,"appId")&&d.uint32(42).string(e.appId),e.ver!=null&&Object.hasOwnProperty.call(e,"ver")&&d.uint32(50).string(e.ver),e.buildno!=null&&Object.hasOwnProperty.call(e,"buildno")&&d.uint32(56).int32(e.buildno),e.installId!=null&&Object.hasOwnProperty.call(e,"installId")&&d.uint32(66).string(e.installId),e.os!=null&&Object.hasOwnProperty.call(e,"os")&&d.uint32(128).int32(e.os),e.did!=null&&Object.hasOwnProperty.call(e,"did")&&d.uint32(138).string(e.did),e.index!=null&&Object.hasOwnProperty.call(e,"index")&&zc.Session.CommonIndex.encode(e.index,d.uint32(162).fork()).ldelim(),e.token!=null&&Object.hasOwnProperty.call(e,"token")&&d.uint32(170).string(e.token),e.version!=null&&Object.hasOwnProperty.call(e,"version")&&d.uint32(176).int32(e.version),e.subVersion!=null&&Object.hasOwnProperty.call(e,"subVersion")&&d.uint32(184).int32(e.subVersion),d},o.CommonIndex=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.index1="",e.prototype.index2="",e.prototype.index3="",e.encode=function(d,h){return h||(h=Xc.create()),d.index1!=null&&Object.hasOwnProperty.call(d,"index1")&&h.uint32(10).string(d.index1),d.index2!=null&&Object.hasOwnProperty.call(d,"index2")&&h.uint32(18).string(d.index2),d.index3!=null&&Object.hasOwnProperty.call(d,"index3")&&h.uint32(26).string(d.index3),h},e}(),o}(),SC=zc.Link=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.sid="",o.prototype.userId="",o.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,o.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,o.prototype.ec=0,o.prototype.sc=0,o.prototype.destServerIp="",o.prototype.ackedServerIp="",o.prototype.responseTime=0,o.encode=function(e,d){return d||(d=Xc.create()),e.sid!=null&&Object.hasOwnProperty.call(e,"sid")&&d.uint32(10).string(e.sid),e.userId!=null&&Object.hasOwnProperty.call(e,"userId")&&d.uint32(18).string(e.userId),e.lts!=null&&Object.hasOwnProperty.call(e,"lts")&&d.uint32(24).int64(e.lts),e.elapse!=null&&Object.hasOwnProperty.call(e,"elapse")&&d.uint32(32).int64(e.elapse),e.ec!=null&&Object.hasOwnProperty.call(e,"ec")&&d.uint32(40).int32(e.ec),e.sc!=null&&Object.hasOwnProperty.call(e,"sc")&&d.uint32(48).int32(e.sc),e.destServerIp!=null&&Object.hasOwnProperty.call(e,"destServerIp")&&d.uint32(58).string(e.destServerIp),e.ackedServerIp!=null&&Object.hasOwnProperty.call(e,"ackedServerIp")&&d.uint32(66).string(e.ackedServerIp),e.responseTime!=null&&Object.hasOwnProperty.call(e,"responseTime")&&d.uint32(72).int32(e.responseTime),d},o}(),TC=zc.Logout=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.sid="",o.prototype.userId="",o.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,o.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,o.encode=function(e,d){return d||(d=Xc.create()),e.sid!=null&&Object.hasOwnProperty.call(e,"sid")&&d.uint32(10).string(e.sid),e.userId!=null&&Object.hasOwnProperty.call(e,"userId")&&d.uint32(18).string(e.userId),e.lts!=null&&Object.hasOwnProperty.call(e,"lts")&&d.uint32(24).int64(e.lts),e.elapse!=null&&Object.hasOwnProperty.call(e,"elapse")&&d.uint32(32).int64(e.elapse),d},o}(),UC=zc.KickedOff=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.sid="",o.prototype.userId="",o.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,o.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,o.prototype.linkId=0,o.prototype.code=0,o.prototype.server="",o.prototype.serverCode=0,o.encode=function(e,d){return d||(d=Xc.create()),e.sid!=null&&Object.hasOwnProperty.call(e,"sid")&&d.uint32(10).string(e.sid),e.userId!=null&&Object.hasOwnProperty.call(e,"userId")&&d.uint32(18).string(e.userId),e.lts!=null&&Object.hasOwnProperty.call(e,"lts")&&d.uint32(24).int64(e.lts),e.elapse!=null&&Object.hasOwnProperty.call(e,"elapse")&&d.uint32(32).int64(e.elapse),e.linkId!=null&&Object.hasOwnProperty.call(e,"linkId")&&d.uint32(48).int32(e.linkId),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&d.uint32(56).int32(e.code),e.server!=null&&Object.hasOwnProperty.call(e,"server")&&d.uint32(66).string(e.server),e.serverCode!=null&&Object.hasOwnProperty.call(e,"serverCode")&&d.uint32(72).int32(e.serverCode),d},o}(),VC=zc.ChnJoin=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.sid="",o.prototype.userId="",o.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,o.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,o.prototype.cname="",o.prototype.errCode=0,o.encode=function(e,d){return d||(d=Xc.create()),e.sid!=null&&Object.hasOwnProperty.call(e,"sid")&&d.uint32(10).string(e.sid),e.userId!=null&&Object.hasOwnProperty.call(e,"userId")&&d.uint32(18).string(e.userId),e.lts!=null&&Object.hasOwnProperty.call(e,"lts")&&d.uint32(24).int64(e.lts),e.elapse!=null&&Object.hasOwnProperty.call(e,"elapse")&&d.uint32(32).int64(e.elapse),e.cname!=null&&Object.hasOwnProperty.call(e,"cname")&&d.uint32(50).string(e.cname),e.errCode!=null&&Object.hasOwnProperty.call(e,"errCode")&&d.uint32(56).int32(e.errCode),d},o}(),WC=zc.ChnJoinRes=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.sid="",o.prototype.userId="",o.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,o.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,o.prototype.cname="",o.prototype.errCode=0,o.prototype.serverErrCode=0,o.encode=function(e,d){return d||(d=Xc.create()),e.sid!=null&&Object.hasOwnProperty.call(e,"sid")&&d.uint32(10).string(e.sid),e.userId!=null&&Object.hasOwnProperty.call(e,"userId")&&d.uint32(18).string(e.userId),e.lts!=null&&Object.hasOwnProperty.call(e,"lts")&&d.uint32(24).int64(e.lts),e.elapse!=null&&Object.hasOwnProperty.call(e,"elapse")&&d.uint32(32).int64(e.elapse),e.cname!=null&&Object.hasOwnProperty.call(e,"cname")&&d.uint32(50).string(e.cname),e.errCode!=null&&Object.hasOwnProperty.call(e,"errCode")&&d.uint32(56).int32(e.errCode),e.serverErrCode!=null&&Object.hasOwnProperty.call(e,"serverErrCode")&&d.uint32(64).int32(e.serverErrCode),d},o}(),XC=zc.ChnLeave=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.sid="",o.prototype.userId="",o.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,o.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,o.prototype.cname="",o.prototype.errCode=0,o.encode=function(e,d){return d||(d=Xc.create()),e.sid!=null&&Object.hasOwnProperty.call(e,"sid")&&d.uint32(10).string(e.sid),e.userId!=null&&Object.hasOwnProperty.call(e,"userId")&&d.uint32(18).string(e.userId),e.lts!=null&&Object.hasOwnProperty.call(e,"lts")&&d.uint32(24).int64(e.lts),e.elapse!=null&&Object.hasOwnProperty.call(e,"elapse")&&d.uint32(32).int64(e.elapse),e.cname!=null&&Object.hasOwnProperty.call(e,"cname")&&d.uint32(50).string(e.cname),e.errCode!=null&&Object.hasOwnProperty.call(e,"errCode")&&d.uint32(56).int32(e.errCode),d},o}(),YC=zc.ConnectionStateChange=function(){function o(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return o.prototype.sid="",o.prototype.userId="",o.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,o.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,o.prototype.oldState=0,o.prototype.newState=0,o.prototype.reason=0,o.prototype.reconnId=0,o.encode=function(e,d){return d||(d=Xc.create()),e.sid!=null&&Object.hasOwnProperty.call(e,"sid")&&d.uint32(10).string(e.sid),e.userId!=null&&Object.hasOwnProperty.call(e,"userId")&&d.uint32(18).string(e.userId),e.lts!=null&&Object.hasOwnProperty.call(e,"lts")&&d.uint32(24).int64(e.lts),e.elapse!=null&&Object.hasOwnProperty.call(e,"elapse")&&d.uint32(32).int64(e.elapse),e.oldState!=null&&Object.hasOwnProperty.call(e,"oldState")&&d.uint32(40).int32(e.oldState),e.newState!=null&&Object.hasOwnProperty.call(e,"newState")&&d.uint32(48).int32(e.newState),e.reason!=null&&Object.hasOwnProperty.call(e,"reason")&&d.uint32(56).int32(e.reason),e.reconnId!=null&&Object.hasOwnProperty.call(e,"reconnId")&&d.uint32(64).int32(e.reconnId),d},o}(),fu=Object.freeze({__proto__:null,Session:RC,Link:SC,Logout:TC,KickedOff:UC,ChnJoin:VC,ChnJoinRes:WC,ChnLeave:XC,ConnectionStateChange:YC,default:zc}),gu=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191}}),ZC=function(o){function e(h,f,g){return W(this,e),m(n(g=d.call(this,g,"Context")),"_token",void 0),m(n(g),"config",void 0),m(n(g),"_uid",void 0),m(n(g),"_sid",void 0),m(n(g),"_area","CN"),m(n(g),"appId",void 0),m(n(g),"enableCloudProxy",!1),m(n(g),"cloudProxyServers",[]),g.appId=h,g.config=f,g}la(e,o);var d=ma(e);return Ha(e,[{key:"token",set:function(h){this._token=typeof h=="string"&&h?h:void 0}},{key:"uid",get:function(){if(typeof this._uid=="string"&&this._uid)return this._uid;throw new Ia("Cannot get illegal uid")},set:function(h){if(this.log("The user ID is set to %s",oa(h)),!za(h))throw new Ia;this._uid=h}},{key:"key",get:function(){if(typeof this._token=="string"&&this._token)return this._token;if(typeof this.appId=="string"&&this.appId)return this.appId;throw new Ia("Cannot get illegal key")}},{key:"sid",get:function(){if(typeof this._sid=="string"&&this._sid)return this._sid;throw new Ia("Cannot get illegal sid")},set:function(h){if(this.log("sid is set to %s",h),typeof h!="string"||!h)throw new Ia;this._sid=h}},{key:"rtmArea",get:function(){if(typeof this._area=="string"&&this._area)return this._area;throw new Ia("Cannot get illegal area")},set:function(h){this.log("area is set to %s",h),typeof h=="string"&&h?this._area=h:this.warn("set area failed")}}]),e}(tb()),$C=!!Fc&&R(function(){Fc.prototype.finally.call({then:function(){}},function(){})});if(N({target:"Promise",proto:!0,real:!0,forced:$C},{finally:function(o){var e=kd(this,mc("Promise")),d=typeof o=="function";return this.then(d?function(h){return mj(e,o()).then(function(){return h})}:o,d?function(h){return mj(e,o()).then(function(){throw h})}:o)}}),typeof Fc=="function"){var Zr=mc("Promise").prototype.finally;Fc.prototype.finally!==Zr&&Ta(Fc.prototype,"finally",Zr,{unsafe:!0})}var aD=function(){var o=J(w.mark(function e(d){return w.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.t0=Uint8Array,h.next=3,crypto.subtle.digest("SHA-256",d);case 3:return h.t1=h.sent,h.abrupt("return",new h.t0(h.t1));case 5:case"end":return h.stop()}},e)}));return function(e){return o.apply(this,arguments)}}(),$r=function(o){return Array.from(o).map(function(e){return e.toString(16).padStart(2,"0")}).join("")},bD=function(o){if(typeof o!="string")throw new TypeError("Expected input to be a string");if(o.length%2!=0)throw new RangeError("Expected string to be an even number of characters");for(var e=new Uint8Array(o.length/2),d=0;d<o.length;d+=2)e[d/2]=parseInt(o.substring(d,d+2),16);return e},as=function(o){return btoa(String.fromCharCode.apply(String,G(o))).replace(/={1,2}$/,"")},bs=function(){var o=J(w.mark(function e(d){var h;return w.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.prev=0,f.next=3,crypto.subtle.digest("SHA-1",d);case 3:h=f.sent,f.next=9;break;case 6:f.prev=6,f.t0=f.catch(0),h=sha1.arrayBuffer(d);case 9:return f.abrupt("return",as(new Uint8Array(h)));case 10:case"end":return f.stop()}},e,null,[[0,6]])}));return function(e){return o.apply(this,arguments)}}(),cs=function(o,e,d,h){h[e]=!0,d.has(o)?d.get(o).add(e):d.set(o,new Set([e]))},cD=function(o){switch(o){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:return"application/octet-stream"}},ds=function(o){function e(h,f,g,A){W(this,e);var C=d.call(this,g,"ChunkDownloadManager");if(m(n(C),"abortController",new AbortController),m(n(C),"downloadedSize",0),m(n(C),"successCount",0),m(n(C),"timer",void 0),m(n(C),"chunks",[]),m(n(C),"retUnit",void 0),m(n(C),"singleThread",!1),m(n(C),"initialized",!1),m(n(C),"ee",void 0),m(n(C),"chunkCount",void 0),m(n(C),"aborted",!1),m(n(C),"serverToIndices",new Map),m(n(C),"backupToIndices",new Map),m(n(C),"indexToBackupServers",[]),m(n(C),"busyBackupServers",new Map),m(n(C),"downloadingChunks",new Set),m(n(C),"metaInfo",void 0),m(n(C),"transHandler",void 0),C.metaInfo=h,C.transHandler=f,C.ee=A===void 0?new ea:A,g=h.size,h=h.unit,g===0)throw new Ia("size cannot be 0");return f.cancelSignal!==void 0&&f.cancelSignal.addEventListener("abort",function(){C.abortController.abort()},{once:!0}),C.abortController.signal.addEventListener("abort",function(){C.aborted=!0},{once:!0}),C.chunkCount=Math.ceil(g/(32768*h)),C}la(e,o);var d=ma(e);return Ha(e,[{key:"setInfoByResponse",value:function(h){var f=this,g=h.serverList,A=h.backupList;if(h=h.unit,g.length<this.chunkCount&&A.length<this.chunkCount)throw new Ia("servers is not enough");this.updateProgress(0),this.initialized=!0;var C=Array(this.chunkCount).fill(!1);if(g.forEach(function(k,j){return k.forEach(function(_t){return cs(_t,j,f.serverToIndices,C)})}),A.forEach(function(k,j){return k.forEach(function(_t){return cs(_t,j,f.backupToIndices,C)})}),C.some(function(){return!1}))throw new da("Not enough servers to download",mg);this.indexToBackupServers=A.map(function(k){return new Set(k)}),this.retUnit=h}},{key:"downloadChunks",value:function(){this.aborted?this.warn("downloadChunks after abort, ignored"):this.serverToIndices.size===1&&Array.from(this.serverToIndices.keys())[0]===0?this.serversDownload(this.backupToIndices):1<=this.serverToIndices.size?this.serversDownload(this.serverToIndices,!0):this.ee.emit("error",new da("not enough servers to download",mg))}},{key:"updateProgress",value:function(h){var f=this,g=this.downloadedSize+h;this.downloadedSize>this.metaInfo.size?(this.warn("Invalid download size, overflowed"),this.ee.emit("error",new Wc("Invalid download size",mg))):(this.downloadedSize=g,this.timer!==void 0&&h!==0&&(clearTimeout(this.timer),this.timer=void 0),this.timer===void 0&&this.successCount!==this.chunkCount&&(this.timer=setTimeout(function(){f.ee.emit("timedOut"),f.abortController.abort()},12e4)),this.initialized&&h===0||this.transHandler.onOperationProgress===void 0||this.transHandler.onOperationProgress({totalSize:this.metaInfo.size,currentSize:this.downloadedSize}))}},{key:"getPayload",value:function(){for(var h=0,f=0,g=this.chunks;f<g.length;f++)h+=g[f].byteLength;if(h!==this.metaInfo.size)throw new Ia("invalid chunks total size");h=new Uint8Array(h),g=f=0;for(var A=this.chunks;g<A.length;g++){var C=A[g];h.set(new Uint8Array(C),f),f+=C.byteLength}return f=Array.from(h.subarray(0,4)).map(function(k){return k.toString(16)}).join("").toUpperCase(),Zt(h.buffer,cD(f))}},{key:"getDownloadUrl",value:function(h){var f=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(h).split(".").join("-"),".edge.").concat(f,":9601/api/v1/chuck/download")}},{key:"serversDownload",value:function(){var h=J(w.mark(function f(g){var A,C=this,k=arguments;return w.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return A=1<k.length&&k[1]!==void 0&&k[1],j.next=3,Promise.all(Array.from(g.entries()).map(function(_t){return _t=ra(_t,2),C.postDownloadRequest(_t[0],Array.from(_t[1]),A).catch(function(_n){_n.statusCode===404?(C.ee.emit("notExist"),C.abortController.abort()):_n.name!=="AbortError"&&(Sa(_n)?C.singleThread?(C.abortController.abort(),C.ee.emit("timedOut")):(C.warn("%d download timed out after %d, retrying use single thread",_n.index,C.singleThread?6e4:3e4),C.abortController.abort(),C.singleThread=!0,C.ee.emit("multiTimeOut")):(C.ee.emit("error",_n),C.abortController.abort()))})}));case 3:case"end":return j.stop()}},f)}));return function(f){return h.apply(this,arguments)}}()},{key:"postDownloadRequest",value:function(){var h=J(w.mark(function f(g,A,C){var k,j,_t,_n,ue,Ei,_s,_c,_u,_d=this;return w.wrap(function(_l){for(;;)switch(_l.prev=_l.next){case 0:if(_u=function(){return(_u=J(w.mark(function nE(sE){var vE,mE,yE,BE,t_,vf,fE,hE,bE;return w.wrap(function(_h){for(;;)switch(_h.prev=_h.next){case 0:if(_h.prev=0,sE!==void 0||g!==0){_h.next=5;break}throw new Ia("Invalid serverIp");case 5:vE=sE===void 0?_s.getDownloadUrl(g):sE;case 6:return _s.downloadingChunks.add(k),_h.next=9,Ei(vE);case 9:return mE=_h.sent,yE=mE.responseData,_s.downloadingChunks.delete(k),_h.abrupt("return",yE);case 15:if(_h.prev=15,_h.t0=_h.catch(0),_s.downloadingChunks.delete(k),A.unshift(k),_s.metaInfo.useNewDomain=!1,_h.t0.name!=="AbortError"){_h.next=22;break}throw _h.t0;case 22:if(!Sa(_h.t0)){_h.next=25;break}throw _h.t0.index=k,_h.t0;case 25:if(BE=_n,_n+=1,!(2>BE)){_h.next=30;break}return _h.t0 instanceof Ia||_s.warn("%o, %d download failed, retrying",_h.t0,k),_h.abrupt("return",_c());case 30:if(_h.t0.statusCode!==504){_h.next=34;break}throw(t_=new db("download server timed out",{originalError:_h.t0,serverCode:504})).index=k,t_;case 34:if(!C||BE!==2||ue[0]===0){_h.next=45;break}return _h.t0 instanceof Ia||_s.warn("%d download failed, using backup: %d, %o",k,ue[0],_h.t0),_h.next=38,_s.busyBackupServers.get(ue[0]);case 38:return vf=_c(_s.getDownloadUrl(ue[0])),_s.busyBackupServers.set(ue[0],vf),_h.next=42,vf;case 42:return fE=_h.sent,_s.busyBackupServers.delete(ue[0]),_h.abrupt("return",fE);case 45:if(!(C&&2<BE&&ue[1]!==void 0&&ue[1]!==0)){_h.next=56;break}return _s.warn("%d download failed, using backup 1: %d",k,ue[1]),_h.next=49,_s.busyBackupServers.get(ue[1]);case 49:return hE=_c(_s.getDownloadUrl(ue[1])),_s.busyBackupServers.set(ue[1],hE),_h.next=53,hE;case 53:return bE=_h.sent,_s.busyBackupServers.delete(ue[1]),_h.abrupt("return",bE);case 56:throw _h.t0.index=k,_h.t0;case 58:case"end":return _h.stop()}},nE,null,[[0,15]])}))).apply(this,arguments)},_c=function(nE){return _u.apply(this,arguments)},!this.aborted){_l.next=4;break}throw new Ia("download already aborted");case 4:if((k=A.shift())!==void 0){_l.next=8;break}return this.log("%s download finished",g),_l.abrupt("return");case 8:if(!(this.singleThread&&0<this.downloadingChunks.size)){_l.next=10;break}return _l.abrupt("return");case 10:if(!this.downloadingChunks.has(k)){_l.next=13;break}return this.log("%s already downloading, return",k),_l.abrupt("return");case 13:if(this.chunks[k]===void 0){_l.next=19;break}return this.successCount===this.chunkCount&&(this.log("chunks all download"),this.ee.emit("finished")),this.log("%s already downloaded, do next",k),_l.next=18,this.postDownloadRequest(g,A,C);case 18:return _l.abrupt("return");case 19:return j=new FormData,_t={hash:hu(this.metaInfo.hashHexStr),unit:this.retUnit===void 0?this.metaInfo.unit:this.retUnit,instance:this.metaInfo.instance,loginOpt:this.metaInfo.loginOpt,ticket:this.metaInfo.ticket,index:k},j.append("parameter",JSON.stringify(_t)),_n=0,ue=Array.from(this.indexToBackupServers[k]),Ei=function(nE){return te(nE,{body:j,signal:_d.abortController.signal,timeout:_d.singleThread?12e4:3e4},{useBinaryResponse:!0})},_s=this,_l.next=28,_c().then(function(nE){return _d.chunks[k]!==void 0?_d.log("chunk %d download duplicated",k):(_d.chunks[k]=nE,_d.log("chunk %d downloaded",k),_d.successCount+=1,_d.updateProgress(_d.chunks[k].byteLength)),_d.successCount===_d.chunkCount&&(_d.log("chunks all download"),_d.ee.emit("finished")),_d.singleThread?(_d.downloadChunks(),Promise.resolve()):_d.postDownloadRequest(g,A,C)});case 28:case"end":return _l.stop()}},f,this)}));return function(f,g,A){return h.apply(this,arguments)}}()}]),e}(tb()),es=function(o){function e(h,f,g,A){W(this,e);var C=d.call(this,g,"ChunkUploadManager");if(m(n(C),"chunkCount",0),m(n(C),"chunks",[]),m(n(C),"uploadedChunks",[]),m(n(C),"totalFailures",0),m(n(C),"timer",void 0),m(n(C),"initState","uninitialized"),m(n(C),"ee",void 0),m(n(C),"unit",0),m(n(C),"uploadedSize",0),m(n(C),"singleThread",!1),m(n(C),"abortController",new AbortController),m(n(C),"servers",[]),m(n(C),"aborted",!1),m(n(C),"metaInfo",void 0),m(n(C),"transHandler",void 0),C.metaInfo=h,C.transHandler=f,C.ee=A===void 0?new ea:A,h.file.length===0)throw new I("file not found or is empty",wf);return f.cancelSignal!==void 0&&f.cancelSignal.addEventListener("abort",function(){C.abortController.abort()},{once:!0}),C.abortController.signal.addEventListener("abort",function(){C.aborted=!0},{once:!0}),C}la(e,o);var d=ma(e);return Ha(e,[{key:"initChunks",value:function(){var h=J(w.mark(function f(g){var A,C,k,j,_t,_n=this;return w.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(this.initState!=="initialized"&&this.initState!=="initializing"){ue.next=2;break}throw new Ia("cannot re-initialize");case 2:for(this.initState="initializing",this.unit=g,A=this.sliceFile(g,this.metaInfo.file),this.chunkCount=A.length,C=[],k=function(Ei,_s){var _c=(Ei=ra(_s[Ei],2))[0],_u=Ei[1];Ei=bs(_u).then(function(_d){_n.chunks[_c]={payload:_u,sha1:_d,uploadedTo:void 0,index:_c,processed:!1}}),C.push(Ei)},j=0,_t=Array.from(A.entries());j<_t.length;j++)k(j,_t);return ue.next=11,Promise.all(C);case 11:this.updateProgress(0),this.initState="initialized",this.log("upload chunks initialized");case 14:case"end":return ue.stop()}},f,this)}));return function(f){return h.apply(this,arguments)}}()},{key:"uploadToServers",value:function(){var h=this;if(!this.aborted){for(var f=this.chunks.filter(function(C){return!C.processed}),g=function(C){var k=f[C],j=h.servers.filter(function(_n){return!_n.isUploading}).sort(function(_n,ue){return _n.successCount-ue.successCount}).sort(function(_n,ue){return _n.failureCount-ue.failureCount})[0];if(j===void 0||1<j.failureCount)return h.log("Upload server not available, waiting"),h.ee.emit("serverUsedUp"),Om(1e3).then(function(){h.totalFailures>2*h.chunkCount&&h.ee.emit("error"),h.totalFailures+=1,j!==void 0&&(j.failureCount=0),h.uploadToServers()}).catch(function(){}),"break";k.processed=!0,j.isUploading=!0,h.log("uploading chunk %d to server %s",k.index,Dg(j.ip));var _t=h.getUploadUrl(j.ip);return J(w.mark(function _n(){var ue;return w.wrap(function(Ei){for(;;)switch(Ei.prev=Ei.next){case 0:return Ei.prev=0,Ei.next=3,h.postChunk(k.payload,_t,k.index);case 3:ue=h.chunks.findIndex(function(_s){return _s===k}),k.uploadedTo=j.ip,h.chunks.splice(ue,1),h.uploadedChunks.push(k),j.successCount+=1,j.isUploading=!1,h.updateProgress(k.payload.byteLength),h.log("upload chunk %d successfully",k.index),Ei.next=31;break;case 13:if(Ei.prev=13,Ei.t0=Ei.catch(0),j.isUploading=!1,k.processed=!1,Ei.t0.statusCode!==504&&!Sa(Ei.t0)){Ei.next=27;break}if(h.singleThread){Ei.next=24;break}return h.warn("%d upload timed out after %d, retrying use single thread",k.index,h.singleThread?12e4:3e4),h.abortController.abort(),h.singleThread=!0,h.ee.emit("multiTimeOut"),Ei.abrupt("return");case 24:return h.ee.emit("timedOut"),h.abortController.abort(),Ei.abrupt("return");case 27:return h.metaInfo.useNewDomain=!1,j.failureCount+=1,Ei.next=31,Om(1e3);case 31:h.uploadedChunks.length===h.chunkCount?(h.log("chunks uploaded"),h.ee.emit("finished")):(h.singleThread||h.chunks.filter(function(_s){return!_s.processed}).length===1)&&h.uploadToServers();case 32:case"end":return Ei.stop()}},_n,null,[[0,13]])}))(),h.singleThread?"break":void 0},A=0;A<f.length&&g(A)!=="break";A++);f.length===0&&this.uploadedChunks.length!==this.chunkCount&&this.log("%d chunks left uploading",this.chunkCount-this.uploadedChunks.length)}}},{key:"getUploadServerIPs",value:function(){var h=!0,f=[],g=G(this.uploadedChunks).sort(function(k,j){return k.index-j.index}),A=0;for(g=Array.from(g.values());A<g.length;A++){var C=g[A].uploadedTo;if(C===void 0){h=!1;break}f.push(C)}if(!h)throw new Ia("some chunks not uploaded, cannot get upload server ips");return f}},{key:"addServers",value:function(h){var f=this;h.forEach(function(g){var A=f.servers.findIndex(function(C){return C.ip===g});A!==-1?f.servers[A].failureCount=0:(f.log("server %s added",Dg(g)),f.servers.push({successCount:0,isUploading:!1,ip:g,failureCount:0}))})}},{key:"updateProgress",value:function(h){var f=this,g=h!==void 0?this.uploadedSize+h:this.metaInfo.file.length;g>this.metaInfo.file.length?(this.warn("Invalid upload size, overflowed"),this.ee.emit("error",new Wc("Invalid upload size",lg))):(this.uploadedSize=g,this.timer!==void 0&&h!==0&&(clearTimeout(this.timer),this.timer=void 0),this.timer===void 0&&h!==void 0&&this.uploadedChunks.length!==this.chunkCount&&(this.timer=setTimeout(function(){f.ee.emit("timedOut"),f.abortController.abort()},12e4)),this.initState==="initialized"&&h===0||this.transHandler.onOperationProgress===void 0||this.transHandler.onOperationProgress({totalSize:this.metaInfo.file.length,currentSize:this.uploadedSize}))}},{key:"sliceFile",value:function(h,f){var g=0,A=[],C=f.length;for(h*=32768;g<C;)A.push(f.slice(g,g+h)),g+=h;return this.log("chunks split into %d",A.length),A}},{key:"postChunk",value:function(){var h=J(w.mark(function f(g,A,C){var k,j,_t,_n,ue,Ei,_s,_c;return w.wrap(function(_u){for(;;)switch(_u.prev=_u.next){case 0:if(!this.aborted){_u.next=2;break}throw new Ia("upload already aborted");case 2:if(this.unit!==void 0){_u.next=4;break}throw new Ia("unit is undefined");case 4:return k=this.metaInfo,j=k.ticket,_t=k.instance,_n=k.loginOpt,ue=k.hashStr,_u.t0=C,_u.t1=ue,_u.next=9,bs(g);case 9:return _u.t2=_u.sent,_u.t3=this.unit,_u.t4=j,_u.t5=_t,_u.t6=_n,Ei={index:_u.t0,hash:_u.t1,sha1:_u.t2,unit:_u.t3,ticket:_u.t4,instance:_u.t5,loginOpt:_u.t6},(_s=new FormData).append("parameter",JSON.stringify(Ei)),_s.append("payload",new Blob([g])),_u.next=20,te(A,{headers:{Accept:"application/json"},body:_s,timeout:this.singleThread?12e4:3e4,signal:this.abortController.signal});case 20:if(_c=_u.sent,_c.status===201){_u.next=24;break}throw new da("uploading chunk ".concat(C," failed"));case 24:case"end":return _u.stop()}},f,this)}));return function(f,g,A){return h.apply(this,arguments)}}()},{key:"getUploadUrl",value:function(h){var f=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(h).split(".").join("-"),".edge.").concat(f,":9601/api/v1/chuck/upload")}}]),e}(tb()),fs=function(o){function e(h){W(this,e);var f=d.call(this,h,"MediaTaskManager");return m(n(f),"isProcessing",!1),m(n(f),"authInfo",void 0),m(n(f),"taskFinishers",{}),m(n(f),"mediaTasks",new Map),m(n(f),"ongoingTask",void 0),f.on("connectionStateChanged",function(g){if(g===S.ConnectionState.ABORTED||g===S.ConnectionState.DISCONNECTED){f.ongoingTask!==void 0&&f.cancelTask(f.ongoingTask),g=0;for(var A=Array.from(f.mediaTasks.entries());g<A.length;g++){var C=ra(A[g],2)[1];f.cancelTask(C)}f.mediaTasks.clear(),f.taskFinishers={}}else g===S.ConnectionState.RECONNECTING?f.ongoingTask!==void 0&&f.ongoingTask.manager.abortController.abort():g===S.ConnectionState.CONNECTED&&f.ongoingTask!==void 0&&f.ongoingTask.manager.ee.emit("reconnected")}),f}la(e,o);var d=ma(e);return Ha(e,[{key:"setAuthInfo",value:function(h){this.authInfo=h}},{key:"waitMediaTask",value:function(h){var f=this;return new Promise(function(g,A){f.taskFinishers[h]={resolve:g,reject:A},f.isProcessing||f.processMediaTask()}).finally(function(){f.ongoingTask!==void 0&&f.ongoingTask.manager.timer!==void 0&&clearTimeout(f.ongoingTask.manager.timer),delete f.taskFinishers[h],f.mediaTasks.size!==0?f.processMediaTask():f.isProcessing=!1})}},{key:"addUploadTask",value:function(h,f,g,A){var C=h.file;if(h=h.hash,this.authInfo===void 0)throw new Ia("session not found");if(this.mediaTasks.size>=e.MAX_PENDING_TASK_COUNT-1)throw new ib("Upload media failed, exceed max pending jobs",xA);return A=new es({hashStr:as(h),file:C,ticket:this.authInfo.ticket,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),useNewDomain:this.authInfo.useNewDomain},A,this.logger),C=Ud(),this.mediaTasks.set(C,{type:"UPLOAD",manager:A,hash:h,setter:g,fetcher:f,taskId:C}),C}},{key:"addDownloadTask",value:function(h,f,g){var A=h.hashHexStr,C=h.size,k=h.unit;if(h=h.zone,this.authInfo===void 0)throw new Ia("session not found");if(this.mediaTasks.size>=e.MAX_PENDING_TASK_COUNT-1)throw new ib("Download media failed, exceed max pending jobs",BA);return g=new ds({hashHexStr:A,ticket:this.authInfo.ticket,useNewDomain:this.authInfo.useNewDomain,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),size:C,zone:h,unit:k},g,this.logger),A=Ud(),this.mediaTasks.set(A,{type:"DOWNLOAD",manager:g,fetcher:f,taskId:A}),A}},{key:"doDownloadTaskImpl",value:function(){var h=J(w.mark(function f(g,A){var C,k,j,_t,_n,ue,Ei,_s,_c=this,_u=arguments;return w.wrap(function(_d){for(;;)switch(_d.prev=_d.next){case 0:return C=2<_u.length&&_u[2]!==void 0&&_u[2],j=k=g.manager,C&&(k=new ds(j.metaInfo,j.transHandler,this.logger,j.ee)),_t=g.fetcher,_d.next=7,_t();case 7:if(_n=_d.sent,ue=_n.serverList,Ei=_n.backupList,_s=_n.unit,!C||_s===j.retUnit){_d.next=13;break}throw new da("download unit is different, reject to continue",mg);case 13:C&&(g.manager=k,k.downloadedSize=j.downloadedSize,k.successCount=j.successCount,k.timer=j.timer,k.chunks=j.chunks,k.initialized=j.initialized,k.singleThread=j.singleThread,k.updateProgress(0)),k.ee.once("reconnected",function(){k.ee.removeAllListeners(),_c.doDownloadTaskImpl(g,A,!0).catch(function(_l){A.reject(_l)})}),k.ee.once("multiTimeOut",function(){k.ee.removeAllListeners(),_c.doDownloadTaskImpl(g,A,!0).catch(function(_l){A.reject(_l)})}),k.ee.once("error",function(_l){k.ee.removeAllListeners(),A.reject(new da(["download file file, index %d",_l.index],{code:mg,originalError:_l}))}),k.ee.once("notExist",function(){k.abortController.abort(),k.ee.removeAllListeners(),A.reject(new da("download file not found",AA))}),k.ee.once("timedOut",function(){k.ee.removeAllListeners(),k.abortController.abort(),A.reject(new db("download timed out",zA))}),k.transHandler.cancelSignal!==void 0&&k.transHandler.cancelSignal.addEventListener("abort",function(){A.reject(new hl("Downloading canceled",ir))},{once:!0}),k.ee.once("finished",function(){A.resolve({type:"DOWNLOAD",payload:k.getPayload()})}),k.setInfoByResponse({serverList:ue,backupList:Ei,unit:_s}),k.downloadChunks();case 23:case"end":return _d.stop()}},f,this)}));return function(f,g){return h.apply(this,arguments)}}()},{key:"doDownloadTask",value:function(h,f){var g=this,A=2<arguments.length&&arguments[2]!==void 0&&arguments[2],C=h.taskId;return A||(this.mediaTasks.delete(C),this.ongoingTask=h),new Promise(function(k,j){g.doDownloadTaskImpl(h,f,A).then(k).catch(j)})}},{key:"doUploadTaskImpl",value:function(){var h=J(w.mark(function f(g,A){var C,k,j,_t,_n,ue,Ei,_s,_c,_u=this,_d=arguments;return w.wrap(function(_l){for(;;)switch(_l.prev=_l.next){case 0:return C=2<_d.length&&_d[2]!==void 0&&_d[2],j=k=g.manager,C&&(k=new es(j.metaInfo,j.transHandler,this.logger,j.ee)),_t=g.fetcher,_n=new Pa,Ei=new Promise(function(nE,sE){var vE=_t(),mE=vE.ret,yE=vE.err,BE=vE.timeout;vE.fin.pipe(ob(_n)).subscribe({next:function(t_){A.resolve({type:"UPLOAD",retUnit:t_.unit,zone:t_.zone})},complete:function(){nE({hasExist:!0}),_n.next(),_n.complete()}}),mE.pipe(ob(_n),cb(function(){var t_=J(w.mark(function vf(fE){var hE,bE;return w.wrap(function(_h){for(;;)switch(_h.prev=_h.next){case 0:if(hE=fE.servers,bE=fE.unit,C&&j.unit!==bE?A.reject(new da("upload unit is different, reject to continue",lg)):C&&(g.manager=k,k.chunkCount=j.chunkCount,k.chunks=j.chunks,k.totalFailures=j.totalFailures,k.uploadedChunks=j.uploadedChunks,k.timer=j.timer,k.initState=j.initState,k.unit=j.unit,k.uploadedSize=j.uploadedSize,k.singleThread=j.singleThread,k.updateProgress(0)),k.addServers(hE),k.initState!=="uninitialized"){_h.next=7;break}return ue=k.initChunks(bE),_h.next=7,ue;case 7:case"end":return _h.stop()}},vf)}));return function(vf){return t_.apply(this,arguments)}}())).subscribe({complete:function(){return nE({hasExist:!1})},error:sE}),vE=function(t_){k.initState!=="uninitialized"&&ue?nE(ue.then(function(){return{hasExist:!1}})):sE(t_)},yE.pipe(ob(_n)).subscribe({error:vE}),BE.pipe(ob(_n)).subscribe({error:vE})}),_l.next=9,Ei;case 9:if(_s=_l.sent,!_s.hasExist){_l.next=15;break}return k.updateProgress(),this.log("file already exists, skipping upload"),_l.abrupt("return");case 15:_n.next(),_n.complete(),this.log("chunks initialization promise resolved"),_c=gb(k.ee,"serverUsedUp").pipe(Gt(function(){return k.chunkCount!==k.uploadedChunks.length}),Jt(5e3,void 0,{leading:!1}),pm(function(){return _t().ret})).subscribe(function(nE){k.addServers(nE.servers)}),k.ee.once("reconnected",function(){k.ee.removeAllListeners(),_u.doUploadTask(g,A,!0).catch(function(nE){A.reject(nE)})}),k.ee.once("multiTimeOut",function(){k.ee.removeAllListeners(),_u.doUploadTask(g,A,!0).catch(function(nE){A.reject(nE)})}),k.ee.once("timedOut",function(){_c.unsubscribe(),k.ee.removeAllListeners(),k.abortController.abort(),A.reject(new db("upload timed out",Lh))}),k.ee.once("error",function(nE){_c.unsubscribe(),k.ee.removeAllListeners(),k.abortController.abort(),A.reject(nE||new da("upload error",lg))}),k.transHandler.cancelSignal!==void 0&&k.transHandler.cancelSignal.addEventListener("abort",function(){A.reject(new hl("Uploading canceled",hr))},{once:!0}),k.ee.once("finished",J(w.mark(function nE(){var sE,vE,mE;return w.wrap(function(yE){for(;;)switch(yE.prev=yE.next){case 0:return _c.unsubscribe(),yE.next=3,g.setter(k.unit,k.getUploadServerIPs());case 3:sE=yE.sent,vE=sE.zone,mE=sE.unit,k.ee.removeAllListeners(),A.resolve({type:"UPLOAD",retUnit:mE,zone:vE});case 8:case"end":return yE.stop()}},nE)}))),k.uploadToServers();case 26:case"end":return _l.stop()}},f,this)}));return function(f,g){return h.apply(this,arguments)}}()},{key:"doUploadTask",value:function(h,f){var g=this,A=2<arguments.length&&arguments[2]!==void 0&&arguments[2],C=h.taskId;return A||(this.mediaTasks.delete(C),this.ongoingTask=h),new Promise(function(k,j){g.doUploadTaskImpl(h,f,A).then(k).catch(j)})}},{key:"processMediaTask",value:function(){var h=J(w.mark(function f(){var g,A,C;return w.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(this.mediaTasks.size!==0){k.next=2;break}throw Error("no upload tasks");case 2:if(this.isProcessing=!0,g=this.mediaTasks.keys().next().value,(A=this.taskFinishers[g])!==void 0){k.next=7;break}throw Error("top task not found");case 7:if((C=this.mediaTasks.get(g))!==void 0){k.next=10;break}throw new Ia("task invalid");case 10:if(C.type!=="UPLOAD"){k.next=15;break}return k.next=13,this.doUploadTask(C,A).catch(function(j){C.manager.ee.removeAllListeners(),A.reject(j)});case 13:k.next=18;break;case 15:if(C.type!=="DOWNLOAD"){k.next=18;break}return k.next=18,this.doDownloadTask(C,A).catch(function(j){C.manager.ee.removeAllListeners(),A.reject(j)});case 18:case"end":return k.stop()}},f,this)}));return function(){return h.apply(this,arguments)}}()},{key:"cancelTask",value:function(h){var f=h.type==="DOWNLOAD"?ir:hr;h.manager.ee.removeAllListeners(),h.manager.abortController.abort(),this.taskFinishers[h.taskId]!==void 0&&this.taskFinishers[h.taskId].reject(new hl("User logged out or kicked off, media task canceled",f))}}]),e}(tb());m(fs,"MAX_PENDING_TASK_COUNT",9),Oo("of",function(){for(var o=0,e=arguments.length,d=new(Ne(this))(e);e>o;)d[o]=arguments[o++];return d},Dj);var gs=1/0,dD=Math.max,ju=function(o,e,d){var h=Object(o);if(!Ed(o)){var f=Te(e);o=Ad(o),e=function(g){return f(h[g],g,h)}}return-1<(e=function(g,A,C){var k=g==null?0:g.length;if(!k)return-1;if(C==null)C=0;else{var j=(C=C?(C=gl(C))===gs||C===-gs?17976931348623157e292*(0>C?-1:1):C==C?C:0:C===0?C:0)%1;C=C==C?j?C-j:C:0}return 0>C&&(C=dD(k+C,0)),Xp(g,Te(A),C)}(o,e,d))?h[f?o[e]:e]:void 0},iu=function(o,e){return o&&o.length?vk(o,void 0,typeof e=="function"?e:void 0):[]},hs=function(){function o(){W(this,o),m(this,"size",0),m(this,"fields",new Map)}return Ha(o,[{key:"define",value:function(e,d,h){if(this.size+=h,64<this.size)throw new RangeError("the struct over 64 bits is not supported");Mg(d={val:0,isNumber:d==="number",isBoolean:d==="boolean",oneof:d==="number"||d==="boolean"?void 0:d,len:h}),this.fields.set(e,d)}},{key:"set",value:function(e,d){if(!(e=this.fields.get(e)))throw Error("field not found");var h=e.oneof;if(!U.isLong(d)&&typeof d!="number")if(typeof d=="boolean")d=d?1:0;else{if(h===void 0)throw Error("invalid field type");if((d=h[d])===void 0)throw Error("field type not found")}Mg(e,d),e.val=d}},{key:"toNumber",value:function(){for(var e=0,d=0,h=0,f=Array.from(this.fields);h<f.length;h++){var g=ra(f[h],2)[1],A=g.len;(g=g.val)!==void 0&&(e+=U.fromValue(g).shiftLeft(d).toNumber(),d+=A)}return e}},{key:"toLong",value:function(){for(var e=U.fromNumber(0,!0),d=0,h=0,f=Array.from(this.fields);h<f.length;h++){var g=ra(f[h],2)[1],A=g.len;(g=g.val)!==void 0&&(e=U.fromValue(g).shiftLeft(d).add(e),d+=A)}return e}},{key:"assert",value:function(e,d){function h(A){if(!U.isLong(A)&&typeof A!="number")if(typeof A=="boolean")A=A?1:0;else{if(g===void 0)throw Error("invalid field type");if((A=g[A])===void 0)throw Error("field type not found")}return Mg(f,A),Lg(A,f.val)}var f=this.fields.get(e);if(!f)throw Error("field not found");var g=f.oneof;if(!Array.isArray(d))return h(d);if(d.length===1)return h(d[0]);if(d.every(function(A){return typeof A=="string"})&&g!==void 0)return d.some(function(A){return h(A)});throw Error("invalid valueTypes")}},{key:"from",value:function(e){e=U.fromValue(e);for(var d=0,h=0,f=Array.from(this.fields);h<f.length;h++){var g=ra(f[h],2)[1],A=g.len,C=U.fromNumber(Math.pow(2,A)-1,!0).shiftLeft(d);Mg(g,C=e.and(C).shiftRightUnsigned(d)),g.val=C,d+=A}}},{key:"typeOf",value:function(e){if((e=this.fields.get(e))!==void 0){var d=e.oneof;if(e=e.val,d!==void 0){var h=0;for(d=Object.entries(d);h<d.length;h++){var f=ra(d[h],2),g=f[0];if(Lg(e,f[1]))return g}}}throw new TypeError("can only get type of oneof type")}}]),o}(),is=function(o){function e(h){W(this,e);var f=d.call(this);return f.define("Rejoin","boolean",1),f.define("Unused","number",31),f.define("Platform","number",8),f.define("Version","number",12),f.define("Subversion","number",12),f.set("Platform",7),f.set("Version",4),f.set("Subversion",203),f.set("Rejoin",h),f}la(e,o);var d=ma(e);return e}(hs),eD=ua(ua(ua(ua({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),{PeerImageMessage:6,ChannelImageMessage:7,VendorImageMessage:8}),{PeerFileMessage:15,ChannelFileMessage:16,VendorFileMessage:17}),js={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},fD=ua(ua({},eD),js),gD={Uncompressed:0,Zlib:1},ae=function(o){function e(h){W(this,e);var f=d.call(this);if(f.define("MessageType",fD,8),f.define("BroadcastJumps","number",2),f.define("ToCache","boolean",1),f.define("FromCache","boolean",1),f.define("CompressionMethod",gD,2),f.define("IterationNumber","number",4),f.define("BufferedMessage","boolean",1),f.define("ToArchive","boolean",1),f.define("FromArchive","boolean",1),typeof h=="number"||U.isLong(h))f.from(h);else if(h!==void 0){var g=0;for(h=Hg(h);g<h.length;g++){var A=ra(h[g],2);f.set(A[0],A[1])}}return f}la(e,o);var d=ma(e);return Ha(e,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(h){var f=this;return h!==void 0?this.assert("MessageType",h):xf(js).some(function(g){return f.assert("MessageType",g)})}},{key:"isFileMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","ChannelFileMessage","VendorFileMessage"])}},{key:"isImageMessage",value:function(){return this.assert("MessageType",["PeerImageMessage","ChannelImageMessage","VendorImageMessage"])}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","PeerTextMessage","PeerImageMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),e}(hs),hD=function(o){function e(h){return W(this,e),m(n(h=d.call(this,h,"ChatManager")),"dialogueLru",new Sx(void 0,{maxlen:1e4,ttl:1e4})),h}la(e,o);var d=ma(e);return Ha(e,[{key:"getChatInfo",value:function(h){var f=this.dialogueLru.get(h);if(this.dialogueLru.prune(),f){var g=f.dialogue,A={dialogue:g,sequence:f=f.sequence.add(1)};return this.dialogueLru.set(h,{dialogue:g,sequence:f}),A}return g={dialogue:Bg(),sequence:U.fromNumber(1,!0)},this.dialogueLru.set(h,g),g}}]),e}(tb()),v={};X(module)=="object"&&(module.exports=v),v.parse=function(o,e){var d,h=v.bin.readUshort,f=v.bin.readUint,g={};for(d=(o=new Uint8Array(o)).length-4;f(o,d)!=101010256;)d--;var A=h(o,d=d+4+4);h(o,d+=2),f(o,d+=2),d=f(o,d+=4);for(var C=0;C<A;C++){f(o,d),d+=4,d+=4,d+=4,f(o,d+=4);var k=f(o,d+=4),j=f(o,d+=4),_t=h(o,d+=4),_n=h(o,d+2),ue=h(o,d+4);d+=6;var Ei=f(o,d+=8);d+=4,d+=_t+_n+ue,v._readLocal(o,Ei,g,k,j,e)}return g},v._readLocal=function(o,e,d,h,f,g){var A=v.bin.readUshort,C=v.bin.readUint;C(o,e),A(o,e+=4),A(o,e+=2);var k=A(o,e+=2);C(o,e+=2),C(o,e+=4),C=A(o,e=e+4+8);var j=A(o,e+=2);if(e+=2,A=v.bin.readUTF8(o,e,C),e=e+C+j,g)d[A]={size:f,csize:h};else if(o=new Uint8Array(o.buffer,e),k==0)d[A]=new Uint8Array(o.buffer.slice(e,e+h));else{if(k!=8)throw"unknown compression method: "+k;e=new Uint8Array(f),v.inflateRaw(o,e),d[A]=e}},v.inflateRaw=function(o,e){return v.F.inflate(o,e)},v.inflate=function(o,e){return o[0],o[1],v.inflateRaw(new Uint8Array(o.buffer,o.byteOffset+2,o.length-2),e)},v.deflate=function(o,e){e==null&&(e={level:6});var d=0,h=new Uint8Array(50+Math.floor(1.1*o.length));return h[d]=120,h[d+1]=156,d=v.F.deflateRaw(o,h,d+2,e.level),o=v.adler(o,0,o.length),h[d+0]=o>>>24&255,h[d+1]=o>>>16&255,h[d+2]=o>>>8&255,h[d+3]=o>>>0&255,new Uint8Array(h.buffer,0,d+4)},v.deflateRaw=function(o,e){e==null&&(e={level:6});var d=new Uint8Array(50+Math.floor(1.1*o.length)),h=v.F.deflateRaw(o,d,h,e.level);return new Uint8Array(d.buffer,0,h)},v.encode=function(o,e){e==null&&(e=!1);var d,h=0,f=v.bin.writeUint,g=v.bin.writeUshort,A={};for(d in o){var C=!v._noNeed(d)&&!e,k=o[d],j=v.crc.crc(k,0,k.length);A[d]={cpr:C,usize:k.length,crc:j,file:C?v.deflateRaw(k):k}}for(d in A)h+=A[d].file.length+30+46+2*v.bin.sizeUTF8(d);for(d in o=new Uint8Array(h+22),e=0,k=[],A)j=A[d],k.push(e),e=v._writeHeader(o,e,d,j,0);for(d in h=0,C=e,A)j=A[d],k.push(e),e=v._writeHeader(o,e,d,j,1,k[h++]);return A=e-C,f(o,e,101010256),g(o,e=e+4+4,h),g(o,e+=2,h),f(o,e+=2,A),f(o,e+4,C),o.buffer},v._noNeed=function(o){return o=o.split(".").pop().toLowerCase(),"png,jpg,jpeg,zip".indexOf(o)!=-1},v._writeHeader=function(o,e,d,h,f,g){var A=v.bin.writeUint,C=v.bin.writeUshort,k=h.file;return A(o,e,f==0?67324752:33639248),e+=4,f==1&&(e+=2),C(o,e,20),C(o,e+=2,0),C(o,e+=2,h.cpr?8:0),A(o,e+=2,0),A(o,e+=4,h.crc),A(o,e+=4,k.length),A(o,e+=4,h.usize),C(o,e+=4,v.bin.sizeUTF8(d)),C(o,e+=2,0),e+=2,f==1&&(A(o,e=e+2+2+6,g),e+=4),e+=d=v.bin.writeUTF8(o,e,d),f==0&&(o.set(k,e),e+=k.length),e},v.crc={table:function(){for(var o=new Uint32Array(256),e=0;256>e;e++){for(var d=e,h=0;8>h;h++)d=1&d?3988292384^d>>>1:d>>>1;o[e]=d}return o}(),update:function(o,e,d,h){for(var f=0;f<h;f++)o=v.crc.table[255&(o^e[d+f])]^o>>>8;return o},crc:function(o,e,d){return 4294967295^v.crc.update(4294967295,o,e,d)}},v.adler=function(o,e,d){var h=1,f=0,g=e;for(e+=d;g<e;){for(d=Math.min(g+5552,e);g<d;)f+=h+=o[g++];h%=65521,f%=65521}return f<<16|h},v.bin={readUshort:function(o,e){return o[e]|o[e+1]<<8},writeUshort:function(o,e,d){o[e]=255&d,o[e+1]=d>>8&255},readUint:function(o,e){return 16777216*o[e+3]+(o[e+2]<<16|o[e+1]<<8|o[e])},writeUint:function(o,e,d){o[e]=255&d,o[e+1]=d>>8&255,o[e+2]=d>>16&255,o[e+3]=d>>24&255},readASCII:function(o,e,d){for(var h="",f=0;f<d;f++)h+=String.fromCharCode(o[e+f]);return h},writeASCII:function(o,e,d){for(var h=0;h<d.length;h++)o[e+h]=d.charCodeAt(h)},pad:function(o){return 2>o.length?"0"+o:o},readUTF8:function(o,e,d){for(var h,f="",g=0;g<d;g++)f+="%"+v.bin.pad(o[e+g].toString(16));try{h=decodeURIComponent(f)}catch{return v.bin.readASCII(o,e,d)}return h},writeUTF8:function(o,e,d){for(var h=d.length,f=0,g=0;g<h;g++){var A=d.charCodeAt(g);if(!(4294967168&A))o[e+f]=A,f++;else if(!(4294965248&A))o[e+f]=192|A>>6,o[e+f+1]=128|A>>0&63,f+=2;else if(!(4294901760&A))o[e+f]=224|A>>12,o[e+f+1]=128|A>>6&63,o[e+f+2]=128|A>>0&63,f+=3;else{if(4292870144&A)throw"e";o[e+f]=240|A>>18,o[e+f+1]=128|A>>12&63,o[e+f+2]=128|A>>6&63,o[e+f+3]=128|A>>0&63,f+=4}}return f},sizeUTF8:function(o){for(var e=o.length,d=0,h=0;h<e;h++){var f=o.charCodeAt(h);if(!(4294967168&f))d++;else if(!(4294965248&f))d+=2;else if(!(4294901760&f))d+=3;else{if(4292870144&f)throw"e";d+=4}}return d}},v.F={},v.F.deflateRaw=function(o,e,d,h){var f=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][h],g=v.F.U,A=v.F._goodIndex;v.F._hash;var C=v.F._putsE,k=0;d<<=3;var j=0,_t=o.length;if(h==0){for(;k<_t;){var _n=Math.min(65535,_t-k);C(e,d,k+_n==_t?1:0),d=v.F._copyExact(o,k,_n,e,d+8),k+=_n}return d>>>3}C=g.lits,h=g.strt;var ue=g.prev,Ei=0,_s=0,_c=0,_u=0,_d=0;for(2<_t&&(h[_d=v.F._hash(o,0)]=0),k=0;k<_t;k++){if(_n=_d,k+1<_t-2){_d=v.F._hash(o,k+1);var _l=k+1&32767;ue[_l]=h[_d],h[_d]=_l}if(j<=k){if((14e3<Ei||26697<_s)&&100<_t-k&&(j<k&&(C[Ei]=k-j,Ei+=2,j=k),d=v.F._writeBlock(k==_t-1||j==_t?1:0,C,Ei,_u,o,_c,k-_c,e,d),Ei=_s=_u=0,_c=k),_l=0,k<_t-2&&(_l=v.F._bestMatch(o,k,ue,_n,Math.min(f[2],_t-k),f[3])),_l!=0){_n=_l>>>16,_l&=65535;var nE=A(_n,g.of0);g.lhst[257+nE]++;var sE=A(_l,g.df0);g.dhst[sE]++,_u+=g.exb[nE]+g.dxb[sE],C[Ei]=_n<<23|k-j,C[Ei+1]=_l<<16|nE<<8|sE,Ei+=2,j=k+_n}else g.lhst[o[k]]++;_s++}}for(_c==k&&o.length!=0||(j<k&&(C[Ei]=k-j,Ei+=2),d=v.F._writeBlock(1,C,Ei,_u,o,_c,k-_c,e,d));7&d;)d++;return d>>>3},v.F._bestMatch=function(o,e,d,h,f,g){var A=32767&e,C=d[A],k=A-C+32768&32767;if(C==A||h!=v.F._hash(o,e-k))return 0;for(var j=h=0,_t=Math.min(32767,e);k<=_t&&--g!=0&&C!=A;){if((h==0||o[e+h]==o[e+h-k])&&(A=v.F._howLong(o,e,k))>h){if(j=k,(h=A)>=f)break;k+2<A&&(A=k+2);for(var _n=0,ue=0;ue<A-2;ue++){var Ei=e-k+ue+32768&32767,_s=Ei-d[Ei]+32768&32767;_s>_n&&(_n=_s,C=Ei)}}k+=(A=C)-(C=d[A])+32768&32767}return h<<16|j},v.F._howLong=function(o,e,d){if(o[e]!=o[e-d]||o[e+1]!=o[e+1-d]||o[e+2]!=o[e+2-d])return 0;var h=e,f=Math.min(o.length,e+258);for(e+=3;e<f&&o[e]==o[e-d];)e++;return e-h},v.F._hash=function(o,e){return(o[e]<<8|o[e+1])+(o[e+2]<<4)&65535},v.saved=0,v.F._writeBlock=function(o,e,d,h,f,g,A,C,k){var j=v.F.U,_t=v.F._putsF,_n=v.F._putsE;j.lhst[256]++;var ue=v.F.getTrees(),Ei=ue[0],_s=ue[1],_c=ue[2],_u=ue[3],_d=ue[4],_l=ue[5],nE=ue[6];ue=ue[7];var sE=32+(k+3&7?8-(k+3&7):0)+(A<<3),vE=h+v.F.contSize(j.fltree,j.lhst)+v.F.contSize(j.fdtree,j.dhst);h=h+v.F.contSize(j.ltree,j.lhst)+v.F.contSize(j.dtree,j.dhst),h+=14+3*_l+v.F.contSize(j.itree,j.ihst)+(2*j.ihst[16]+3*j.ihst[17]+7*j.ihst[18]);for(var mE=0;286>mE;mE++)j.lhst[mE]=0;for(mE=0;30>mE;mE++)j.dhst[mE]=0;for(mE=0;19>mE;mE++)j.ihst[mE]=0;if(sE=sE<vE&&sE<h?0:vE<h?1:2,_t(C,k,o),_t(C,k+1,sE),k+=3,sE==0){for(;7&k;)k++;k=v.F._copyExact(f,g,A,C,k)}else{if(sE==1)var yE=j.fltree,BE=j.fdtree;if(sE==2){for(v.F.makeCodes(j.ltree,Ei),v.F.revCodes(j.ltree,Ei),v.F.makeCodes(j.dtree,_s),v.F.revCodes(j.dtree,_s),v.F.makeCodes(j.itree,_c),v.F.revCodes(j.itree,_c),yE=j.ltree,BE=j.dtree,_n(C,k,_u-257),_n(C,k+=5,_d-1),_n(C,k+=5,_l-4),k+=4,o=0;o<_l;o++)_n(C,k+3*o,j.itree[1+(j.ordr[o]<<1)]);k=v.F._codeTiny(nE,j.itree,C,k+3*_l),k=v.F._codeTiny(ue,j.itree,C,k)}for(_l=0;_l<d;_l+=2){for(nE=(o=e[_l])>>>23,o=g+(8388607&o);g<o;)k=v.F._writeLit(f[g++],yE,C,k);nE!=0&&(o=(Ei=e[_l+1])>>16,A=Ei>>8&255,Ei&=255,_n(C,k=v.F._writeLit(257+A,yE,C,k),nE-j.of0[A]),k+=j.exb[A],_t(C,k=v.F._writeLit(Ei,BE,C,k),o-j.df0[Ei]),k+=j.dxb[Ei],g+=nE)}k=v.F._writeLit(256,yE,C,k)}return k},v.F._copyExact=function(o,e,d,h,f){var g=f>>>3;return h[g]=d,h[g+1]=d>>>8,h[g+2]=255-h[g],h[g+3]=255-h[g+1],g+=4,h.set(new Uint8Array(o.buffer,e,d),g),f+(d+4<<3)},v.F.getTrees=function(){for(var o=v.F.U,e=v.F._hufTree(o.lhst,o.ltree,15),d=v.F._hufTree(o.dhst,o.dtree,15),h=[],f=v.F._lenCodes(o.ltree,h),g=[],A=v.F._lenCodes(o.dtree,g),C=0;C<h.length;C+=2)o.ihst[h[C]]++;for(C=0;C<g.length;C+=2)o.ihst[g[C]]++;C=v.F._hufTree(o.ihst,o.itree,7);for(var k=19;4<k&&o.itree[1+(o.ordr[k-1]<<1)]==0;)k--;return[e,d,C,f,A,k,h,g]},v.F.getSecond=function(o){for(var e=[],d=0;d<o.length;d+=2)e.push(o[d+1]);return e},v.F.nonZero=function(o){for(var e="",d=0;d<o.length;d+=2)o[d+1]!=0&&(e+=(d>>1)+",");return e},v.F.contSize=function(o,e){for(var d=0,h=0;h<e.length;h++)d+=e[h]*o[1+(h<<1)];return d},v.F._codeTiny=function(o,e,d,h){for(var f=0;f<o.length;f+=2){var g=o[f],A=o[f+1];h=v.F._writeLit(g,e,d,h);var C=g==16?2:g==17?3:7;15<g&&(v.F._putsE(d,h,A,C),h+=C)}return h},v.F._lenCodes=function(o,e){for(var d=o.length;d!=2&&o[d-1]==0;)d-=2;for(var h=0;h<d;h+=2){var f=o[h+1],g=h+3<d?o[h+3]:-1,A=h+5<d?o[h+5]:-1,C=h==0?-1:o[h-1];if(f==0&&g==f&&A==f){for(g=h+5;g+2<d&&o[g+2]==f;)g+=2;11>(f=Math.min(g+1-h>>>1,138))?e.push(17,f-3):e.push(18,f-11),h+=2*f-2}else if(f==C&&g==f&&A==f){for(g=h+5;g+2<d&&o[g+2]==f;)g+=2;f=Math.min(g+1-h>>>1,6),e.push(16,f-3),h+=2*f-2}else e.push(f,0)}return d>>>1},v.F._hufTree=function(o,e,d){var h=[],f=o.length,g=e.length,A=0;for(A=0;A<g;A+=2)e[A]=0,e[A+1]=0;for(A=0;A<f;A++)o[A]!=0&&h.push({lit:A,f:o[A]});if(o=h.length,f=h.slice(0),o==0)return 0;if(o==1)return e[1+((d=h[0].lit)<<1)]=1,e[1+((d==0?1:0)<<1)]=1;h.sort(function(_t,_n){return _t.f-_n.f}),A=h[0],g=h[1];var C=0,k=1,j=2;for(h[0]={lit:-1,f:A.f+g.f,l:A,r:g,d:0};k!=o-1;)A=C!=k&&(j==o||h[C].f<h[j].f)?h[C++]:h[j++],g=C!=k&&(j==o||h[C].f<h[j].f)?h[C++]:h[j++],h[k++]={lit:-1,f:A.f+g.f,l:A,r:g};for((h=v.F.setDepth(h[k-1],0))>d&&(v.F.restrictDepth(f,d,h),h=d),A=0;A<o;A++)e[1+(f[A].lit<<1)]=f[A].d;return h},v.F.setDepth=function(o,e){return o.lit!=-1?o.d=e:Math.max(v.F.setDepth(o.l,e+1),v.F.setDepth(o.r,e+1))},v.F.restrictDepth=function(o,e,d){var h=0,f=1<<d-e,g=0;for(o.sort(function(C,k){return k.d==C.d?C.f-k.f:k.d-C.d}),h=0;h<o.length&&o[h].d>e;h++){var A=o[h].d;o[h].d=e,g+=f-(1<<d-A)}for(g>>>=d-e;0<g;)(A=o[h].d)<e?(o[h].d++,g-=1<<e-A-1):h++;for(;0<=h;h--)o[h].d==e&&0>g&&(o[h].d--,g++);g!=0&&console.log("debt left")},v.F._goodIndex=function(o,e){var d=0;return e[16|d]<=o&&(d|=16),e[8|d]<=o&&(d|=8),e[4|d]<=o&&(d|=4),e[2|d]<=o&&(d|=2),e[1|d]<=o&&(d|=1),d},v.F._writeLit=function(o,e,d,h){return v.F._putsF(d,h,e[o<<1]),h+e[1+(o<<1)]},v.F.inflate=function(o,e){var d=Uint8Array;if(o[0]==3&&o[1]==0)return e||new d(0);var h=v.F,f=h._bitsF,g=h._bitsE,A=h._decodeTiny,C=h.makeCodes,k=h.codes2map,j=h._get17,_t=h.U,_n=e==null;_n&&(e=new d(o.length>>>2<<3));for(var ue,Ei,_s,_c,_u=0,_d=0,_l=Ei=0,nE=0;_u==0;)if(_u=f(o,nE,1),ue=f(o,nE+1,2),nE+=3,ue==0)7&nE&&(nE+=8-(7&nE)),ue=o[(nE=4+(nE>>>3))-4]|o[nE-3]<<8,_n&&(e=v.F._check(e,_l+ue)),e.set(new d(o.buffer,o.byteOffset+nE,ue),_l),nE=nE+ue<<3,_l+=ue;else{if(_n&&(e=v.F._check(e,_l+131072)),ue==1&&(_s=_t.flmap,_c=_t.fdmap,_d=511,Ei=31),ue==2){for(Ei=g(o,nE,5)+257,ue=g(o,nE+5,5)+1,_s=g(o,nE+10,4)+4,nE+=14,_c=0;38>_c;_c+=2)_t.itree[_c]=0,_t.itree[_c+1]=0;for(_d=1,_c=0;_c<_s;_c++){var sE=g(o,nE+3*_c,3);_t.itree[1+(_t.ordr[_c]<<1)]=sE,sE>_d&&(_d=sE)}nE+=3*_s,C(_t.itree,_d),k(_t.itree,_d,_t.imap),_s=_t.lmap,_c=_t.dmap,nE=A(_t.imap,(1<<_d)-1,Ei+ue,o,nE,_t.ttree),_d=(1<<(sE=h._copyOut(_t.ttree,0,Ei,_t.ltree)))-1,Ei=(1<<(ue=h._copyOut(_t.ttree,Ei,ue,_t.dtree)))-1,C(_t.ltree,sE),k(_t.ltree,sE,_s),C(_t.dtree,ue),k(_t.dtree,ue,_c)}for(;;)if(nE+=15&(ue=_s[j(o,nE)&_d]),(sE=ue>>>4)>>>8==0)e[_l++]=sE;else{if(sE==256)break;ue=_l+sE-254,264<sE&&(ue=_l+((sE=_t.ldef[sE-257])>>>3)+g(o,nE,7&sE),nE+=7&sE),nE+=15&(sE=_c[j(o,nE)&Ei]);var vE=((sE=_t.ddef[sE>>>4])>>>4)+f(o,nE,15&sE);for(nE+=15&sE,_n&&(e=v.F._check(e,_l+131072));_l<ue;)e[_l]=e[_l++-vE],e[_l]=e[_l++-vE],e[_l]=e[_l++-vE],e[_l]=e[_l++-vE];_l=ue}}return e.length==_l?e:e.slice(0,_l)},v.F._check=function(o,e){var d=o.length;return e<=d?o:((e=new Uint8Array(Math.max(d<<1,e))).set(o,0),e)},v.F._decodeTiny=function(o,e,d,h,f,g){for(var A=v.F._bitsE,C=v.F._get17,k=0;k<d;){var j=o[C(h,f)&e];f+=15&j;var _t=j>>>4;if(15>=_t)g[k]=_t,k++;else{var _n=j=0;for(_t==16?(_n=3+A(h,f,2),f+=2,j=g[k-1]):_t==17?(_n=3+A(h,f,3),f+=3):_t==18&&(_n=11+A(h,f,7),f+=7),_t=k+_n;k<_t;)g[k]=j,k++}}return f},v.F._copyOut=function(o,e,d,h){for(var f=0,g=0,A=h.length>>>1;g<d;){var C=o[g+e];h[g<<1]=0,h[1+(g<<1)]=C,C>f&&(f=C),g++}for(;g<A;)h[g<<1]=0,h[1+(g<<1)]=0,g++;return f},v.F.makeCodes=function(o,e){var d,h,f=v.F.U,g=o.length,A=f.bl_count;for(d=0;d<=e;d++)A[d]=0;for(d=1;d<g;d+=2)A[o[d]]++;for(f=f.next_code,d=0,A[0]=0,h=1;h<=e;h++)d=d+A[h-1]<<1,f[h]=d;for(e=0;e<g;e+=2)(A=o[e+1])!=0&&(o[e]=f[A],f[A]++)},v.F.codes2map=function(o,e,d){for(var h=o.length,f=v.F.U.rev15,g=0;g<h;g+=2)if(o[g+1]!=0){var A=o[g+1],C=g>>1<<4|A,k=e-A;for(k=(A=o[g]<<k)+(1<<k);A!=k;)d[f[A]>>>15-e]=C,A++}},v.F.revCodes=function(o,e){for(var d=v.F.U.rev15,h=15-e,f=0;f<o.length;f+=2)o[f]=d[o[f]<<e-o[f+1]]>>>h},v.F._putsE=function(o,e,d){d<<=7&e,o[e>>>=3]|=d,o[e+1]|=d>>>8},v.F._putsF=function(o,e,d){d<<=7&e,o[e>>>=3]|=d,o[e+1]|=d>>>8,o[e+2]|=d>>>16},v.F._bitsE=function(o,e,d){return(o[e>>>3]|o[1+(e>>>3)]<<8)>>>(7&e)&(1<<d)-1},v.F._bitsF=function(o,e,d){return(o[e>>>3]|o[1+(e>>>3)]<<8|o[2+(e>>>3)]<<16)>>>(7&e)&(1<<d)-1},v.F._get17=function(o,e){return(o[e>>>3]|o[1+(e>>>3)]<<8|o[2+(e>>>3)]<<16)>>>(7&e)},v.F._get25=function(o,e){return(o[e>>>3]|o[1+(e>>>3)]<<8|o[2+(e>>>3)]<<16|o[3+(e>>>3)]<<24)>>>(7&e)},v.F.U=function(){var o=Uint16Array,e=Uint32Array;return{next_code:new o(16),bl_count:new o(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new o(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new e(32),flmap:new o(512),fltree:[],fdmap:new o(32),fdtree:[],lmap:new o(32768),ltree:[],ttree:[],dmap:new o(32768),dtree:[],imap:new o(512),itree:[],rev15:new o(32768),lhst:new e(286),dhst:new e(30),ihst:new e(19),lits:new e(15e3),strt:new o(65536),prev:new o(32768)}}(),function(){function o(f,g,A){for(;g--!=0;)f.push(0,A)}for(var e=v.F.U,d=0;32768>d;d++){var h=d;h=(4278255360&(h=(4042322160&(h=(3435973836&(h=(2863311530&h)>>>1|(1431655765&h)<<1))>>>2|(858993459&h)<<2))>>>4|(252645135&h)<<4))>>>8|(16711935&h)<<8,e.rev15[d]=(h>>>16|h<<16)>>>17}for(d=0;32>d;d++)e.ldef[d]=e.of0[d]<<3|e.exb[d],e.ddef[d]=e.df0[d]<<4|e.dxb[d];o(e.fltree,144,8),o(e.fltree,112,9),o(e.fltree,24,7),o(e.fltree,8,8),v.F.makeCodes(e.fltree,9),v.F.codes2map(e.fltree,9,e.flmap),v.F.revCodes(e.fltree,9),o(e.fdtree,32,5),v.F.makeCodes(e.fdtree,5),v.F.codes2map(e.fdtree,5,e.fdmap),v.F.revCodes(e.fdtree,5),o(e.itree,19,0),o(e.ltree,286,0),o(e.dtree,30,0),o(e.ttree,320,0)}();var iD=["backups","servers"],jD=["backups","servers"],kD=["group"],nl=v.inflate,ks=v.deflate,ls=function(o){function e(h,f,g,A){W(this,e);var C=d.call(this,A,"Session");return m(n(C),"chatManager",void 0),m(n(C),"joinedChannels",new Set),m(n(C),"msgDedupLru",new tc(void 0,{maxlen:200})),m(n(C),"startTime",Date.now()),m(n(C),"seq",U.fromNumber(1,!0)),m(n(C),"userJoinOptions",new is(!1)),m(n(C),"seqSentStatuses",[!1,!1]),m(n(C),"dialogueSequenceLru",new tc(void 0,{maxlen:1e4})),m(n(C),"loggedOut",!1),m(n(C),"messageSentTimes",[]),m(n(C),"curLoginSockets",[void 0,void 0]),m(n(C),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),m(n(C),"lastLoginSockets",[new qe(1),new qe(1)]),m(n(C),"dialPendingMsgSubjectMap",new Map),m(n(C),"context",void 0),m(n(C),"connection",void 0),m(n(C),"instanceId",void 0),m(n(C),"registerSocketsFailureListener",function(){C.connection.once("socketsFailure",function(){C.log("socketsFailure, creating a new connection"),ad(function(){return C.connection.removeAllListeners(),C.connection=new Yr(C.context,C.logger,!0),C.loginHandler(15e3,!0)}).pipe(oe(function(k){return k.pipe(cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")))}),ob(C.connection.apClient.apFinish$)).subscribe(function(){C.log("new connection connected")})}),C.connection.listenerCount("tokenExpired")===0&&C.connection.on("tokenExpired",function(){C.emit("tokenExpired")})}),C.context=h,C.connection=f,C.instanceId=g,C.chatManager=new hD(A),C.log("The instanceId is %s",C.instanceId.toString()),C}la(e,o);var d=ma(e);return Ha(e,[{key:"fetchFileUploadIndexGet",value:function(h){var f=h.hash,g=h.size;if((h=this.getLoginSockets()).length===0)throw new K("Client is not logged in");var A=this.incGetSeq();return h.forEach(function(C){C.sendPacket("FileUploadIndexGet",{seq:A,hash:f,size:g})}),{ret:Ca.apply(void 0,G(h.map(function(C){return C.fromReceived("FileUploadIndexRet").pipe(aa(function(k){return A.eq(k.seq)}))}))),fin:Ca.apply(void 0,G(h.map(function(C){return C.fromReceived("FileUploadIndexFin").pipe(aa(function(k){return A.eq(k.seq)}))}))),err:Xb.apply(void 0,G(h.map(function(C){return C.fromReceived("FileUploadIndexErr").pipe(aa(function(k){return A.eq(k.seq)}),ba(function(k){throw new da(["The media message upload failure, code %d",k.code],lg)}))}))),timeout:e.genTimeoutError(Lh)}}},{key:"requestFileUploadIndexSet",value:function(h){var f=h.hash,g=h.unit,A=h.servers;if((h=this.getLoginSockets()).length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return h.forEach(function(k){k.sendPacket("FileUploadIndexSet",{seq:C,servers:A,hash:f,unit:g})}),Ca.apply(void 0,[e.genTimeoutError(Lh)].concat(G(h.map(function(k){return k.fromReceived("FileUploadIndexErr").pipe(aa(function(j){return C.eq(j.seq)}),ba(function(j){throw new da(["FileUploadIndexSet failure, code %d",j.code],lg)}))})),G(h.map(function(k){return k.fromReceived("FileUploadIndexFin").pipe(aa(function(j){return C.eq(j.seq)}))}))))}},{key:"requestFileDownloadIndexGet",value:function(h){var f=h.size,g=h.zone,A=h.unit,C=h.hash,k=this.getLoginSockets();if(k.length===0)throw new K("Client is not logged in");var j=this.incGetSeq();return k.forEach(function(_t){_t.sendPacket("FileDownloadIndexGet",{seq:j,size:f,zone:g,unit:A,hash:C})}),h=Ca.apply(void 0,G(k.map(function(_t){return _t.fromReceived("FileDownloadIndexRet").pipe(aa(function(_n){return j.eq(_n.seq)}))}))).pipe(ba(function(_t){var _n=_t.backups,ue=_t.servers;return _t=ff(_t,iD),ua({backupList:_n.map(function(Ei){return[Ei]}),serverList:ue.map(function(Ei){return[Ei]})},_t)}),cd(500)),k=jm(k.map(function(_t){return _t.fromReceived("FileDownloadIndexRet").pipe(aa(function(_n){return j.eq(_n.seq)}))})),Ca(h,k.pipe(ba(function(_t){return _t.reduce(function(_n,ue){var Ei=_n.backupList,_s=_n.serverList;_n=ue.backups;var _c=ue.servers;return ue=ff(ue,jD),ua({backupList:_n.map(function(_u,_d){return[_u].concat(G(Ei!==void 0&&Array.isArray(Ei[_d])?Ei[_d]:[]))}),serverList:_c.map(function(_u,_d){return[_u].concat(G(Ei!==void 0&&Array.isArray(_s[_d])?_s[_d]:[]))})},ue)},{})})),e.genTimeoutError(Lh))}},{key:"loginHandler",value:function(){var h=this,f=0<arguments.length&&arguments[0]!==void 0?arguments[0]:2e4,g=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(this.loggedOut&&g)throw new K("Already logged out, request ignored");g&&this.registerSocketsFailureListener(),this.connection.initConnection();var A=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),C=Date.now();return A.forEach(function(k,j){var _t=h.loginSocketSubs[j].login;_t!==void 0&&_t.unsubscribe(),h.loginSocketSubs[j].login=k.pipe(ca(function(_n){var ue;h.curLoginSockets[j]=_n;var Ei=Date.now();eb("Link",{ackedServerIp:_n.address,destServerIp:_n.ip,ec:0,sc:0,elapse:fb(h.startTime),lts:U.fromNumber(Ei),responseTime:C-Ei,sid:Xa(h.instanceId),userId:h.context.uid},(ue=h.context.config.enableCloudProxy)!==null&&ue!==void 0&&ue),h.emit("userJoined",_n.env),g&&h.connection.apClient.apFinish$.next(void 0)})).subscribe(h.lastLoginSockets[j])}),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Xb.apply(void 0,G(A).concat([gb(this.connection,"connectionInitFailure").pipe(ca(function(k){throw sa(k)||Sa(k)?k:new da("Login failure",{code:Zq,originalError:k})}))])).pipe(Ka(1),hb(f),Ga(function(k){return k instanceof pb&&h.warn("Client login timeout"),k&&k.code===Kh&&(h.connection.emit("tokenExpired"),h.connection.apClient.apFinish$.next(void 0)),h.clearSockets(0,g),Z(k)}),ca(function(){g||h.registerSocketsFailureListener()}),wg(function(){g||h.connection.apClient.apFinish$.next(void 0)}))}},{key:"logoutHandler",value:function(){var h=J(w.mark(function f(){var g,A,C,k=this;return w.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),g=this.getLoginSockets(),A=g.map(function(_t){return _t.sendPacket("UserQuit",{}),k.connection.waitClosing(_t)}),this.clearSockets(5e3),C=g.map(function(_t){return _t.env}),[0,1].filter(function(_t){return!C.includes(_t)}).forEach(function(_t){k.connection.closeSocket(_t,0)}),j.abrupt("return",Xb.apply(void 0,G(A)).toPromise());case 9:case"end":return j.stop()}},f,this)}));return function(){return h.apply(this,arguments)}}()},{key:"requestChannelJoin",value:function(){var h=J(w.mark(function f(g,A){var C,k,j,_t=this;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:if(this.getLoginSockets().length!==0){_n.next=2;break}throw new K("Client is not logged in. Cannot join the channel",Vq);case 2:return C=gb(this,"channelLeft").pipe(wb(function(ue){return ue===g}),Ka(1)),k=this.incGetSeq(),(j=this.lastLoginSockets.map(function(ue){return ue.pipe(Cc(function(Ei,_s){_s!==0&&_t.incSeqIfNeeded(Ei.env);var _c=_s===0?k:_t.seq;return Ei.sendPacket("GroupEnter",{account:A,seq:_c}),Ei.fromReceived("GroupReply").pipe(aa(function(_u){return _c.eq(_u.seq)}),ca(function(_u){if((_u=_u.code)!==0)throw new da(["Channel join failure. The response code is %d",_u],Rq)}))}),ob(C),pe())})).forEach(function(ue,Ei){var _s=function(){return _t.loginSocketSubs[Ei].channels.delete(g.channelId)};_t.loginSocketSubs[Ei].channels.set(g.channelId,ue.subscribe({error:_s,complete:_s}))}),_n.next=8,Xb.apply(void 0,G(j)).pipe(Ka(1),hb(1e4),Ga(function(ue){return ue instanceof pb&&_t.warn("Channel join timeout"),Z(ue)})).toPromise();case 8:this.joinedChannels.add(g);case 9:case"end":return _n.stop()}},f,this)}));return function(f,g){return h.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(h,f){this.emit("channelLeft",h),this.joinedChannels.delete(h),this.getLoginSockets().forEach(function(g){g.sendPacket("GroupLeave",{account:f})})}},{key:"requestChannelMemberList",value:function(h){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in. Cannot get the channel members",cA);var g=this.incGetSeq();return f.forEach(function(A){A.sendPacket("GroupAllUsersList",{group:h,pageNumber:0,pageSize:200,seq:g})}),Ca.apply(void 0,[e.genTimeoutError(Pq)].concat(G(f.map(function(A){return A.fromReceived("GroupAllUsersResult").pipe(aa(function(C){var k=C.seq;return C.group===h&&g.eq(k)}))}))))}},{key:"requestPeersOnlineStatus",value:function(h){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();return f.forEach(function(A){A.sendPacket("UserStatusList",{users:h,seq:g})}),Ca.apply(void 0,[e.genTimeoutError(oA)].concat(G(f.map(function(A){return A.fromReceived("UserStatusResult").pipe(aa(function(C){return g.eq(C.seq)}))}))))}},{key:"requestSetLocalUserAttributes",value:function(h,f){var g=this,A=this.getLoginSockets();if(A.length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return A.forEach(function(k,j){f!==void 0&&j!==f||k.sendPacket("UserAttributeSet",{account:g.context.uid,attributeInfos:Object.entries(h).map(function(_t){return{key:(_t=ra(_t,2))[0],value:_t[1]}}),seq:C})}),Ca.apply(void 0,G(A.map(function(k){return k.fromReceived("UserAttributeErr").pipe(aa(function(j){return C.eq(j.seq)}),ba(function(j){throw new da(["The user attributes set failure, code %d",j.code],Sb)}))})).concat([e.genTimeoutError(Tb)],G(A.map(function(k){return k.fromReceived("UserAttributeRsp").pipe(aa(function(j){return C.eq(j.seq)}))}))))}},{key:"requestSetChannelAttributes",value:function(h,f,g){var A=this.getLoginSockets();if(A.length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return A.forEach(function(k){k.sendPacket("GroupAttributeSet",{broadcast:g,group:h,attributeInfos:Object.entries(f).map(function(j){return{key:(j=ra(j,2))[0],value:j[1]}}),seq:C})}),Ca.apply(void 0,G(A.map(function(k){return k.fromReceived("GroupAttributeErr").pipe(aa(function(j){return C.eq(j.seq)}),ba(function(j){throw new da(["The group attributes set failure, code %d",j.code],Sb)}))})).concat([e.genTimeoutError(Tb)],G(A.map(function(k){return k.fromReceived("GroupAttributeRsp").pipe(aa(function(j){return C.eq(j.seq)}))}))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(h){var f=this,g=this.getLoginSockets();if(g.length===0)throw new K("Client is not logged in");var A=this.incGetSeq();return g.forEach(function(C){C.sendPacket("UserAttributeMod",{account:f.context.uid,attributeInfos:Object.entries(h).map(function(k){return{key:(k=ra(k,2))[0],value:k[1]}}),seq:A})}),Ca.apply(void 0,G(g.map(function(C){return C.fromReceived("UserAttributeErr").pipe(aa(function(k){return A.eq(k.seq)}),ba(function(k){throw new da(["The user attributes add or update failure, code %d",k.code],Sb)}))})).concat([e.genTimeoutError(Tb)],G(g.map(function(C){return C.fromReceived("UserAttributeRsp").pipe(aa(function(k){return A.eq(k.seq)}))}))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(h,f,g){var A=this.getLoginSockets();if(A.length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return A.forEach(function(k){k.sendPacket("GroupAttributeMod",{broadcast:g,group:h,attributeInfos:Object.entries(f).map(function(j){return{key:(j=ra(j,2))[0],value:j[1]}}),seq:C})}),Ca.apply(void 0,G(A.map(function(k){return k.fromReceived("GroupAttributeErr").pipe(aa(function(j){return C.eq(j.seq)}),ba(function(j){throw new da(["The group attributes add or update failure, code %d",j.code],Sb)}))})).concat([e.genTimeoutError(Tb)],G(A.map(function(k){return k.fromReceived("GroupAttributeRsp").pipe(aa(function(j){return C.eq(j.seq)}))}))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(h){var f=this,g=this.getLoginSockets();if(g.length===0)throw new K("Client is not logged in");var A=this.incGetSeq();return g.forEach(function(C){C.sendPacket("UserAttributeDel",{account:f.context.uid,attributes:h,seq:A})}),Ca.apply(void 0,G(g.map(function(C){return C.fromReceived("UserAttributeErr").pipe(aa(function(k){return A.eq(k.seq)}),ba(function(k){throw new da(["The user attributes delete failure, code %d",k.code],Sb)}))})).concat([e.genTimeoutError(Tb)],G(g.map(function(C){return C.fromReceived("UserAttributeRsp").pipe(aa(function(k){return A.eq(k.seq)}))}))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(h,f,g){var A=this.getLoginSockets();if(A.length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return A.forEach(function(k){k.sendPacket("GroupAttributeDel",{group:h,broadcast:g,attributes:f,seq:C})}),Ca.apply(void 0,G(A.map(function(k){return k.fromReceived("GroupAttributeErr").pipe(aa(function(j){return C.eq(j.seq)}),ba(function(j){throw new da(["The channel attributes delete failure, code %d",j.code],Sb)}))})).concat([e.genTimeoutError(Tb)],G(A.map(function(k){return k.fromReceived("GroupAttributeRsp").pipe(aa(function(j){return C.eq(j.seq)}))}))))}},{key:"requestClearLocalUserAttributes",value:function(){var h=this,f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();return f.forEach(function(A){A.sendPacket("UserAttributeSet",{account:h.context.uid,seq:g,attributeInfos:[]})}),Ca.apply(void 0,G(f.map(function(A){return A.fromReceived("UserAttributeErr").pipe(aa(function(C){return g.eq(C.seq)}),ba(function(C){throw new da(["The user attributes clear failure, code %d",C.code],Sb)}))})).concat([e.genTimeoutError(Tb)],G(f.map(function(A){return A.fromReceived("UserAttributeRsp").pipe(aa(function(C){return g.eq(C.seq)}))}))))}},{key:"requestClearChannelAttributes",value:function(h,f){var g=this.getLoginSockets();if(g.length===0)throw new K("Client is not logged in");var A=this.incGetSeq();return g.forEach(function(C){C.sendPacket("GroupAttributeSet",{group:h,seq:A,attributeInfos:[],broadcast:f})}),Ca.apply(void 0,G(g.map(function(C){return C.fromReceived("GroupAttributeErr").pipe(aa(function(k){return A.eq(k.seq)}),ba(function(k){throw new da(["The channel attributes clear failure, code %d",k.code],Sb)}))})).concat([e.genTimeoutError(Tb)],G(g.map(function(C){return C.fromReceived("GroupAttributeRsp").pipe(aa(function(k){return A.eq(k.seq)}))}))))}},{key:"requestGetUserAttributesByKeys",value:function(h,f){var g=this.getLoginSockets();if(g.length===0)throw new K("Client is not logged in");var A=this.incGetSeq();return g.forEach(function(C){C.sendPacket("UserAttributeGet",{account:h,seq:A,attributes:f})}),Ca.apply(void 0,[e.genTimeoutError(Tb)].concat(G(g.map(function(C){return C.fromReceived("UserAttributeErr").pipe(aa(function(k){return A.eq(k.seq)}),ba(function(k){throw(k=k.code)===10008?new da("The user requested is not online",Lq):new Wc(["User attribute operation unknown error code: %d",k],Sb)}))})),G(g.map(function(C){return C.fromReceived("UserAttributeRet").pipe(aa(function(k){return A.eq(k.seq)}))}))))}},{key:"requestGetChannelAttributesByKeys",value:function(h,f){var g=this.getLoginSockets();if(g.length===0)throw new K("Client is not logged in");var A=this.incGetSeq();return g.forEach(function(C){C.sendPacket("GroupAttributeGet",{group:h,seq:A,attributes:f})}),Ca.apply(void 0,[e.genTimeoutError(Tb)].concat(G(g.map(function(C){return C.fromReceived("GroupAttributeErr").pipe(aa(function(k){return A.eq(k.seq)}),ba(function(k){throw new da(["The channel attributes get failure, code %d",k.code],Sb)}))})),G(g.map(function(C){return C.fromReceived("GroupAttributeRet").pipe(aa(function(k){return A.eq(k.seq)}))}))))}},{key:"requestGetUserAttributeKeys",value:function(h){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();return f.forEach(function(A){A.sendPacket("UserAttributeKeysGet",{account:h,seq:g})}),Ca.apply(void 0,[e.genTimeoutError(Tb)].concat(G(f.map(function(A){return A.fromReceived("UserAttributeErr").pipe(aa(function(C){return g.eq(C.seq)}),ba(function(C){throw(C=C.code)===10008?new da("The user requested is not online",Lq):new Wc(["User attribute operation unknown error code: %d",C],Sb)}))})),G(f.map(function(A){return A.fromReceived("UserAttributeKeysRet").pipe(aa(function(C){return g.eq(C.seq)}))}))))}},{key:"requestGetChannelAttributesKeys",value:function(h){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();return f.forEach(function(A){A.sendPacket("GroupAttributeKeysGet",{group:h,seq:g})}),Ca.apply(void 0,[e.genTimeoutError(Tb)].concat(G(f.map(function(A){return A.fromReceived("GroupAttributeErr").pipe(aa(function(C){return g.eq(C.seq)}),ba(function(C){throw new Wc(["Channel attribute operation unknown error code: %d",C.code],Sb)}))})),G(f.map(function(A){return A.fromReceived("GroupAttributeKeysRet").pipe(aa(function(C){return g.eq(C.seq)}))}))))}},{key:"requestGetChannelMemberCount",value:function(h){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();return f.forEach(function(A){A.sendPacket("GroupStatusList",{groups:h,seq:g})}),Ca.apply(void 0,[e.genTimeoutError(Pq)].concat(G(f.map(function(A){return A.fromReceived("GroupStatusResult").pipe(aa(function(C){return g.eq(C.seq)}))}))))}},{key:"requestSubscribePeersOnlineStatus",value:function(h){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();return f.forEach(function(A){A.sendPacket("SubscribeUserStatus",{seq:g,users:h})}),Ca.apply(void 0,[e.genTimeoutError(vA)].concat(G(f.map(function(A){return A.fromReceived("SubscribeResponse").pipe(aa(function(C){return g.eq(C.seq)}))}))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(h){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();f.forEach(function(A){A.sendPacket("UnsubscribeUserStatus",{seq:g,users:h})})}},{key:"sendInvitationMessage",value:function(){var h=J(w.mark(function f(g){var A,C,k,j,_t,_n,ue,Ei,_s,_c,_u,_d,_l=this;return w.wrap(function(nE){for(;;)switch(nE.prev=nE.next){case 0:if(A=g.peerId,C=g.callId,k=g.extra,j=g.isAcceptAck,_t=g.channelId,_n=g.type,ue={callId:C},j===void 0){nE.next=6;break}if(_n==="CallAccept"){nE.next=5;break}throw Error("invalid invitation type");case 5:ue.type=j?"ack":"request";case 6:return ue.channel=_t,(_n==="CallInvite"||_n==="CallCancel"||_n==="CallReject"||_n==="CallAccept"&&j===!1)&&k!==void 0&&(ue.extra=k),Ei=Bg(),this.log("The sent invitation body is %o",ue),_s=function(sE){return{MiscMap:{},sequence:U.fromNumber(1),dialogue:Ei,instance:_l.instanceId,dst:A,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:sE,MessageType:_n}).toLong(),payload:new TextEncoder().encode(JSON.stringify(ue)),src:_l.context.uid}},nE.next=14,Kb(this.sendMessageToRetry(_s,!0)).pipe(hb(1e4),Ga(function(sE){return sE instanceof pb&&_l.warn("Send invitation timeout"),Z(sE)})).toPromise();case 14:return _c=nE.sent,_u=_c.code,_d=_c.retryTimes,nE.abrupt("return",{hasPeerReceived:_u===0,hasReSent:_d!==0});case 18:case"end":return nE.stop()}},f,this)}));return function(f){return h.apply(this,arguments)}}()},{key:"sendMediaMessage",value:function(){var h=J(w.mark(function f(g,A,C,k,j,_t){var _n,ue,Ei,_s,_c,_u,_d,_l,nE,sE,vE,mE,yE,BE,t_,vf,fE,hE,bE,_h,tE,aE,TE,OE,e_,NE,y_,YE,H_,FS=this;return w.wrap(function(gT){for(;;)switch(gT.prev=gT.next){case 0:if(ue=A.width,Ei=ue===void 0?0:ue,_s=A.height,_c=_s===void 0?0:_s,_u=A.fileName,_d=_u===void 0?"":_u,_l=A.description,nE=_l===void 0?"":_l,sE=A.thumbnail,vE=sE===void 0?new Blob:sE,mE=A.thumbnailHeight,yE=mE===void 0?0:mE,BE=A.thumbnailWidth,t_=BE===void 0?0:BE,vf=A.size,fE=vf===void 0?0:vf,hE=A.mediaId,bE=j.enableOfflineMessaging,_h=j.enableHistoricalMessaging,za(C)){gT.next=4;break}throw new I("The send message arguments are not valid",k?$k:hg);case 4:if(!(32768<new Blob([_d,vE,nE]).size)){gT.next=6;break}throw new I("The size of message overflowed ",k?ve:Hh);case 6:return tE=this.chatManager.getChatInfo(C),aE=tE.dialogue,TE=tE.sequence,OE=this.instanceId,this.log('A%s media message is sending to %s: "'.concat(OE,"-").concat(aE,"#").concat(TE,'"'),k?" peer":" channel",oa(C)),m(_n={},"media_description",nE),m(_n,"media_width",Ei),m(_n,"media_height",_c),m(_n,"media_thumbnailwidth",t_),m(_n,"media_thumbnailheight",yE),m(_n,"media_size",fE),m(_n,"media_id",hE),m(_n,"media_filename",_d),e_=uc(_n,function(CS){return new TextEncoder().encode(CS.toString())}),gT.t0=Uint8Array,gT.next=14,Ji(vE);case 14:return gT.t1=gT.sent,e_.media_thumbnail=new gT.t0(gT.t1),NE=k&&g==="IMAGE"?"PeerImageMessage":k&&g==="FILE"?"PeerFileMessage":k||g!=="IMAGE"?"ChannelFileMessage":"ChannelImageMessage",y_=function(CS){return{MiscMap:e_,sequence:TE,dialogue:aE,instance:OE,dst:C,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:CS,CompressionMethod:"Uncompressed",MessageType:NE,ToCache:bE,ToArchive:_h}).toLong(),payload:new Uint8Array,src:FS.context.uid}},gT.next=20,Kb(this.sendMessageToRetry(y_,!0)).pipe(hb(_t===void 0?1e4:_t),Ga(function(CS){return CS instanceof pb&&FS.warn("Send message timeout"),Z(CS)})).toPromise();case 20:if(YE=gT.sent,(H_=YE.code)!==2){gT.next=24;break}throw new da("The peer does not support this type of message",nA);case 24:return gT.abrupt("return",{hasPeerReceived:H_===0});case 25:case"end":return gT.stop()}},f,this)}));return function(f,g,A,C,k,j){return h.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var h=J(w.mark(function f(g,A,C,k,j,_t){var _n,ue,Ei,_s,_c,_u,_d,_l,nE,sE,vE=this;return w.wrap(function(mE){for(;;)switch(mE.prev=mE.next){case 0:if(_n=j.enableOfflineMessaging,ue=j.enableHistoricalMessaging,za(C)&&g instanceof Uint8Array&&typeof A=="string"){mE.next=3;break}throw new I("The send message arguments are not valid",k?$k:hg);case 3:if(!(32768<g.byteLength+new Blob([A]).size)){mE.next=5;break}throw new ib("The message size is over the 32KB limit",k?ve:Hh);case 5:return Ei=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=g.byteLength,_s=this.chatManager.getChatInfo(C),_c=_s.dialogue,_u=_s.sequence,_d=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(_d,"-").concat(_c,"#").concat(_u,'"'),Ei?" compressed":"",k?"peer":"channel",oa(C)),_l=function(yE){return{MiscMap:{description:new TextEncoder().encode(A)},sequence:_u,dialogue:_c,instance:_d,dst:C,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:yE,CompressionMethod:Ei?"Zlib":"Uncompressed",MessageType:k?"PeerRawMessage":"ChannelRawMessage",ToCache:_n,ToArchive:ue}).toLong(),payload:Ei?ks(g):g,src:vE.context.uid}},mE.next=12,Kb(this.sendMessageToRetry(_l,!0)).pipe(hb(_t===void 0?1e4:_t),Ga(function(yE){return yE instanceof pb&&vE.warn("Send message timeout"),Z(yE)})).toPromise();case 12:return nE=mE.sent,sE=nE.code,mE.abrupt("return",{hasPeerReceived:sE===0});case 15:case"end":return mE.stop()}},f,this)}));return function(f,g,A,C,k,j){return h.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var h=J(w.mark(function f(g,A,C,k,j){var _t,_n,ue,Ei,_s,_c,_u,_d,_l,nE,sE,vE=this;return w.wrap(function(mE){for(;;)switch(mE.prev=mE.next){case 0:if(_t=k.enableOfflineMessaging,_n=k.enableHistoricalMessaging,za(A)){mE.next=3;break}throw new I("The send message arguments are not valid",C?$k:hg);case 3:if(!(32768<new Blob([g]).size)){mE.next=5;break}throw new ib("The message size is over the 32KB limit",C?ve:Hh);case 5:return ue=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([g]).size,Ei=this.chatManager.getChatInfo(A),_s=Ei.dialogue,_c=Ei.sequence,_u=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(_u,"-").concat(_s,"#").concat(_c,'"'),ue?" compressed":"",C?"peer":"channel",oa(A)),_d=new TextEncoder().encode(g),_l=function(yE){return{MiscMap:{},sequence:_c,dialogue:_s,instance:_u,dst:A,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:yE,CompressionMethod:ue?"Zlib":"Uncompressed",MessageType:C?"PeerTextMessage":"ChannelTextMessage",ToCache:_t,ToArchive:_n}).toLong(),payload:ue?ks(_d):_d,src:vE.context.uid}},mE.next=13,Kb(this.sendMessageToRetry(_l,!0)).pipe(hb(j===void 0?1e4:j),Ga(function(yE){return yE instanceof pb&&vE.warn("Send message timeout"),Z(yE)})).toPromise();case 13:return nE=mE.sent,sE=nE.code,mE.abrupt("return",{hasPeerReceived:sE===0});case 16:case"end":return mE.stop()}},f,this)}));return function(f,g,A,C,k){return h.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(h,f){Object.entries(this.loginSocketSubs[h]).forEach(function(g){var A=(g=ra(g,2))[1];g[0]==="channels"&&f||(Array.isArray(A)||A instanceof Map?A.forEach(function(C){return C.unsubscribe()}):A&&A.unsubscribe())}),this.loginSocketSubs[h]={channels:f?this.loginSocketSubs[h].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var h=J(w.mark(function f(g,A){var C,k,j,_t,_n,ue,Ei,_s,_c,_u=this,_d=arguments;return w.wrap(function(_l){for(;;)switch(_l.prev=_l.next){case 0:if(C=2<_d.length&&_d[2]!==void 0?_d[2]:0,this.log("Attempt to send the message ".concat(A?" with retrying, %o":"without retrying"),{retryTimes:C}),(k=this.getLoginSockets()).length!==0){_l.next=5;break}throw Error("no logged-in sockets");case 5:return j=g(C),k.forEach(function(nE){nE.sendPacket("Message",j)}),_t=j.dialogue,_n=j.sequence,ue=j.instance,Ei=k.map(function(nE){return nE.fromReceived("Ack").pipe(wb(function(sE){return _t.eq(sE.dialogue)&&_n.eq(sE.sequence)&&ue.eq(sE.instance)}))}),_l.prev=9,_l.next=12,Xb.apply(void 0,G(Ei)).pipe(hb(6e3),Ga(function(nE){return Sa(nE)&&_u.warn("Message send timeout, retry times %d",C),Z(nE)}),Ka(1)).toPromise();case 12:return _s=_l.sent,_c=_s.code,this.log("The message has been acked, %o",{code:_c}),_l.abrupt("return",{code:_c,retryTimes:C});case 18:if(_l.prev=18,_l.t0=_l.catch(9),!(_l.t0 instanceof pb&&A)){_l.next=22;break}return _l.abrupt("return",this.sendMessageToRetry(g,!1,C+1));case 22:throw _l.t0;case 23:case"end":return _l.stop()}},f,this,[[9,18]])}));return function(f,g){return h.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var h=this;this.lastLoginSockets.map(function(f){return f.pipe(Cc(function(g){return Bc(0,2750).pipe(ca(function(){h.incSeqIfNeeded(g.env),g.sendPacket("Ping",{ms:U.fromNumber(Date.now(),!0),seq:h.seq})}))}))}).forEach(function(f,g){var A=h.loginSocketSubs[g].keepAlive;A!==void 0&&A.unsubscribe(),h.loginSocketSubs[g].keepAlive=f.subscribe({error:function(){}})})}},{key:"initKeepAliveReconnector",value:function(){var h=this;this.lastLoginSockets.map(function(f){return f.pipe(Cc(function(g){var A,C=!1,k=g.userJoin$.pipe(ca(function(){C=!0})),j=g.input$.pipe(ca(function(_t){Li[_t.uri].slice(0,-3)!=="Ping"&&(C=!1)}));return Xb(Bc(15e3,1e4).pipe(Pt(g.receivedPacket),ca(function(_t){_t=ra(_t,2),_t=ra(_t[1],2)[1],A!==_t||C||g.forceReconnect(),A=_t})),k,j)}))}).forEach(function(f,g){var A=h.loginSocketSubs[g].keepAliveReconnector;A!==void 0&&A.unsubscribe(),h.loginSocketSubs[g].keepAliveReconnector=f.subscribe({error:function(){}})})}},{key:"initLoginReceiver",value:function(){var h=this;this.lastLoginSockets.map(function(f){return f.pipe(Cc(function(g){return Xb(gb(g,"reconnect").pipe(ca(h.onSocketReconnect(g))),g.fromReceived("Message").pipe(ca(h.onMessage(g))),g.fromReceived("GroupEnterNotice").pipe(ca(h.onGroupEnterNotice())),g.fromReceived("GroupLeaveNotice").pipe(ca(h.onGroupLeaveNotice())),g.fromReceived("GroupCountNotice").pipe(ca(h.onGroupCountNotice())),g.fromReceived("GroupAttributeAlt").pipe(ca(h.onGroupAttributeAlt())),g.fromReceived("UserJoinNotice").pipe(ca(h.onUserNotice(S.PeerOnlineState.ONLINE))),g.fromReceived("UserQuitNotice").pipe(ca(h.onUserNotice(S.PeerOnlineState.OFFLINE))),g.fromReceived("UserWaitNotice").pipe(ca(h.onUserNotice(S.PeerOnlineState.UNREACHABLE)))).pipe(qf(void 0))}))}).forEach(function(f,g){h.loginSocketSubs[g].receivers.push(f.subscribe({error:function(){}}))})}},{key:"requestSocketLogin",value:function(h,f,g){var A=this;return im(ad(function(){A.userJoinOptions=new is(f),h.sendPacket("UserJoin",{account:A.context.uid,instance:A.instanceId,opt:A.userJoinOptions.toLong(),seq:g,ticket:h.ticket})}),h.fromReceived("UserResp").pipe(aa(function(C){return g.eq(C.seq)}),ca(function(C){if((C=C.code)!==0)throw A.clearSockets(),A.logError("Connected to gateway success but the Rtm server rejected login"),new da(["Login failure. The response code from the RTM service is %d",C],jg);A.log("ENV_%d logged in",h.env)}),qf(h),hb(15e3))).pipe(wb(function(C){return C!==void 0}),Ga(function(C){return C instanceof pb&&A.warn("Login response timeout, rejoin: %s",f),Z(C)}))}},{key:"getSocketLoginObservables",value:function(h,f){var g=this;return h.map(function(A){return A.pipe(ca(function(C){C.listenerCount("socketUserDrop")===0&&C.on("socketUserDrop",function(k){return g.onUserDrop(k,C)})}),Cc(function(C,k){return g.incSeqIfNeeded(C.env),g.requestSocketLogin(C,k!==0,k===0?f:g.seq)}),pe())})}},{key:"incSeqIfNeeded",value:function(h){if(![0,1].includes(h))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[h]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[h]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var h=this.curLoginSockets,f=-1,g=h==null?0:h.length,A=0,C=[];++f<g;){var k=h[f];k&&(C[A++]=k)}return C}},{key:"emitMessage",value:function(h,f){var g=h.options,A=h.payload,C=h.src,k=h.dst,j=h.instance,_t=h.dialogue,_n=h.sequence,ue=h.ms,Ei=h.MiscMap;this.dialogueSequenceLru.set(_t.toString(),_n),j="".concat(j,"-").concat(_t,"#").concat(_n),this.msgDedupLru.has(j)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",f,j):(this.msgDedupLru.set(j,void 0),f=new ae(g),this.lastLoginSockets.forEach(function(){var _s=J(w.mark(function _c(_u){var _d;return w.wrap(function(_l){for(;;)switch(_l.prev=_l.next){case 0:return _l.next=2,_u.pipe(Ka(1)).toPromise();case 2:_d=_l.sent,e.sendMessageAck(h,_d);case 4:case"end":return _l.stop()}},_c)}));return function(_c){return _s.apply(this,arguments)}}()),g=f.isZlibCompressed(),f.isInvitation()?(k=pa(g?nl(Xm(A,Uint8Array.of(0,0,0,0))):A),k=JSON.parse(k),this.log("The received invitation body is %o",k),this.emit("invitationMessage",{body:k,type:f.getInvitationType(),peerId:C,serverReceivedTs:ue.toNumber()})):f.isTextMessage()?(Ei=f.isPeerTextMessage(),A=pa(g?nl(Xm(A,Uint8Array.of(0,0,0,0))):A),this.info("Received a %s %s text message from %s to %s, %s",g?" compressed":"",Ei?"peer":"channel",oa(C),oa(k),j),Ei?(C={text:A,peerId:C,properties:{serverReceivedTs:ue.toNumber(),isOfflineMessage:f.isFromCache()}},this.emit("peerTextMessage",C)):this.emit("channelTextMessage",{channelId:k,memberId:C,text:A,properties:{serverReceivedTs:ue.toNumber(),isOfflineMessage:!1}})):f.isRawMessage()?(_t=f.isRawPeerMessage(),Ei=(Ei=Ei.description)===void 0?"":pa(Ei),A=g?nl(A):A,this.info("Received a %s %s raw message from %s to %s, %s",g?" compressed":"",_t?"peer":"channel",oa(C),oa(k),j),_t?(C={desc:Ei,raw:A,peerId:C,properties:{serverReceivedTs:ue.toNumber(),isOfflineMessage:f.isFromCache()}},this.emit("peerRawMessage",C)):this.emit("channelRawMessage",{desc:Ei,raw:A,channelId:k,memberId:C,properties:{serverReceivedTs:ue.toNumber(),isOfflineMessage:!1}})):(f.isImageMessage()||f.isFileMessage())&&(A=f.isPeerMessage(),this.info("Received a %s media message from %s to %s, %s",A?"peer":"channel",oa(C),oa(k),j),A?this.emit("peerMediaMessage",{messageType:f.isImageMessage()?"IMAGE":"FILE",details:Ei,peerId:C,properties:{serverReceivedTs:ue.toNumber(),isOfflineMessage:f.isFromCache()}}):this.emit("channelMediaMessage",{messageType:f.isImageMessage()?"IMAGE":"FILE",details:Ei,memberId:C,channelId:k,properties:{serverReceivedTs:ue.toNumber(),isOfflineMessage:f.isFromCache()}})))}},{key:"onSocketReconnect",value:function(h){var f=this;return function(){var g=[0,1].filter(function(A){return A!==h.env})[0];(g=f.connection.curOpenSockets[g])&&!g.loggedIn&&f.emit("connectionLost")}}},{key:"onUserDrop",value:function(h,f){var g;h=h.code,eb("KickedOff",{code:0,elapse:fb(this.startTime),linkId:parseInt(f.name.split("-")[1],10),lts:U.fromNumber(Date.now()),server:f.address,serverCode:h,sid:Xa(this.instanceId),userId:this.context.uid},(g=this.context.config.enableCloudProxy)!==null&&g!==void 0&&g),h===10006||h===10001?this.warn("Login too often and kicked off, reconnect and login"):h===10009?(this.warn("The instance ID conflicts, reconnecting"),this.instanceId=Bg(),this.context.sid=Xa(this.instanceId),this.emit("instanceChanged",this.instanceId)):[11,14,15,16].includes(h)&&(this.emit("userDrop",h),this.clearSockets())}},{key:"clearSockets",value:function(){var h=this,f=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,g=1<arguments.length&&arguments[1]!==void 0&&arguments[1];[0,1].forEach(function(A){h.cleanLoginSubs(A,g),h.connection.closeSocket(A,f)})}},{key:"onMessage",value:function(h){var f=this;return function(g){var A=g.dialogue,C=g.instance,k=g.sequence,j=g.options;if(g.src===f.context.uid)f.log("The message is from the local account, ignored");else{var _t=A.toString(),_n=f.dialPendingMsgSubjectMap.get(_t);if(A="".concat(C,"-").concat(A,"#").concat(k),_n)_n.next(g),f.log("Env_%d: The dialogue has pending messages, next: %s",h.env,A);else{var ue=f.dialogueSequenceLru.get(_t);if(_n=!ue&&k.eq(1),C=ue!==void 0&&k.sub(ue).eq(1),_n||C)f.emitMessage(g,h.env);else{if(ue){if(k.lte(ue))return;f.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",h.env,A)}else f.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",h.env,A);k=new Pa,f.dialPendingMsgSubjectMap.set(_t,k);var Ei=k.pipe(Qs(Pk),xg(function(_s,_c){return[].concat(G(_s),[_c])},[]),ba(function(_s){return G(_s).sort(function(_c,_u){return _c=_c.sequence,_u=_u.sequence,_c.eq(_u)?0:_c.gt(_u)?1:-1})}),sm(1));j=!(j=new ae(j)).isFromCache()&&!j.isBufferedMessage(),Ei.pipe(ob(Bc(j?750:1500)),aa(function(_s){if(2>_s.length)return!1;for(var _c=ue===void 0?U.fromNumber(1,!0):ue.add(1),_u=0;_u<_s.length;_c=_c.add(1),_u++)if(!_s[_u].sequence.eq(_c))return!1;return!0}),wg(function(){f.dialPendingMsgSubjectMap.delete(_t)})).subscribe(function(_s){_s.forEach(function(_c){f.emitMessage(_c,h.env),f.log("Env_%d: The message queue has fully ordered, emitting: %s",h.env,"".concat(_c.instance,"-").concat(_c.dialogue,"#").concat(_c.sequence))})},function(_s){_s instanceof vg&&Ei.pipe(Ka(1)).subscribe(function(_c){return _c.forEach(function(_u){f.log("Env_%d: The message pending queue expired, emitting: %s",h.env,"".concat(_u.instance,"-").concat(_u.dialogue,"#").concat(_u.sequence)),f.emitMessage(_u,h.env)})})}),k.next(g)}}}}}},{key:"onGroupEnterNotice",value:function(){var h=this;return function(f){h.emit("memberNotice",{channelId:f.group,seq:f.seq,instance:f.instance,memberId:f.user,type:"MemberJoined",size:f.size})}}},{key:"onGroupLeaveNotice",value:function(){var h=this;return function(f){h.emit("memberNotice",{channelId:f.group,seq:f.seq,instance:f.instance,memberId:f.user,type:"MemberLeft",size:f.size})}}},{key:"onGroupCountNotice",value:function(){var h=this;return function(f){h.emit("memberNotice",{channelId:f.group,seq:f.seq,instance:f.instance,type:"MemberCountUpdated",size:f.size})}}},{key:"onGroupAttributeAlt",value:function(){var h=this;return function(f){var g=f.group;f=ff(f,kD),h.emit("channelAttributesUpdated",ua({channelId:g},f))}}},{key:"onUserNotice",value:function(h){var f=this;return function(g){f.emit("peerOnlineStatusChanged",{peerId:g.user,instance:g.instance,seq:g.seq,state:h})}}}],[{key:"sendMessageAck",value:function(h,f){var g=new ae(h.options);(g.isInvitation()||g.isPeerMessage())&&f.sendPacket("Ack",{code:0,dialogue:h.dialogue,instance:h.instance,sequence:h.sequence})}}]),e}(tb());m(ls,"genTimeoutError",function(o,e){return bb(void 0).pipe(cd(e===void 0?1e4:e),ba(function(){throw new db(["Request timed out after %ds",e===void 0?1e4:e],o)}))});var ms,ol,pl=0,ql=0;Ud.v1=function(o,e,d){d=e&&d||0;var h=e||[],f=(o=o||{}).node||ms,g=o.clockseq!==void 0?o.clockseq:ol;if(f==null||g==null){var A=Jq();f==null&&(f=ms=[1|A[0],A[1],A[2],A[3],A[4],A[5]]),g==null&&(g=ol=16383&(A[6]<<8|A[7]))}A=o.msecs!==void 0?o.msecs:new Date().getTime();var C=o.nsecs!==void 0?o.nsecs:ql+1,k=A-pl+(C-ql)/1e4;if(0>k&&o.clockseq===void 0&&(g=g+1&16383),(0>k||A>pl)&&o.nsecs===void 0&&(C=0),1e4<=C)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(pl=A,ql=C,ol=g,o=(1e4*(268435455&(A+=122192928e5))+C)%4294967296,h[d++]=o>>>24&255,h[d++]=o>>>16&255,h[d++]=o>>>8&255,h[d++]=255&o,o=A/4294967296*1e4&268435455,h[d++]=o>>>8&255,h[d++]=255&o,h[d++]=o>>>24&15|16,h[d++]=o>>>16&255,h[d++]=g>>>8|128,h[d++]=255&g,g=0;6>g;++g)h[d+g]=f[g];return e||Kq(h)},Ud.v4=Ud;var rl=Ph(),vd,bf=S.LocalInvitationFailureReason,Ba=S.LocalInvitationState,lD=(vd=function(o){function e(h,f,g){W(this,e);var A=d.call(this,g,"RtmLocalInvitation",!0);return m(n(A),"state",Ba.IDLE),m(n(A),"localInvitationEnd$",Ca(gb(n(A),"LocalInvitationAccepted"),gb(n(A),"LocalInvitationRefused"),gb(n(A),"LocalInvitationFailure"),gb(n(A),"LocalInvitationCanceled")).pipe(Ka(1))),m(n(A),"callId",Ud.v4()),m(n(A),"_content",""),m(n(A),"_channelId",""),m(n(A),"_response",""),m(n(A),"calleeId",void 0),m(n(A),"logger",void 0),m(n(A),"getSession",void 0),A.calleeId=h,A.getSession=f,A.logger=g,A}la(e,o);var d=ma(e);return Ha(e,[{key:"channelId",get:function(){return this._channelId},set:function(h){this.state!==Ba.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=h)}},{key:"content",get:function(){return this._content},set:function(h){this.log("set content for %s",this.callId),this._content=h}},{key:"response",get:function(){return this._response},set:function(h){throw new I('Cannot set the "response" of the LocalInvitation instance.',xc)}},{key:"send",value:function(){var h,f=this;if(this.state===Ba.SENT_TO_REMOTE||this.state===Ba.RECEIVED_BY_REMOTE)throw new K("The local invitation send failure. The call invitation has already been sent.",gA);if(this.isLocalInvitationEnd())throw new K("The local invitation send failure. The call invitation has ended.",Ih);if(0<this._channelId.length&&!za(this._channelId))throw new I("Illegal invitation channel ID",xc);if(!za(this.calleeId))throw new I("Illegal invitation callee user ID",xc);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',xc);this.state=Ba.SENT_TO_REMOTE,ad(J(w.mark(function g(){var A,C,k;return w.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,f.getSession().sendInvitationMessage({peerId:f.calleeId,callId:f.callId,extra:f._content,type:"CallInvite",channelId:f._channelId});case 2:if(A=j.sent,C=A.hasPeerReceived,k=A.hasReSent,!f.isLocalInvitationEnd()){j.next=7;break}throw new db("send invitation timeout");case 7:if(f.log("The local invitation has sent to the callee"),C||k){j.next=11;break}throw h=new rl({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(C){j.next=14;break}throw h=new rl({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return j.stop()}},g)}))).pipe(oe(function(g){return g.pipe(ca(function(A){if(!(A instanceof rl))throw A}),cd(2e3))}),hb(3e4),Ga(function(g){return Sa(g)&&f.warn("local invitation ack timed out"),Z(g)}),ob(this.localInvitationEnd$)).subscribe({next:function(){f.state===Ba.RECEIVED_BY_REMOTE?f.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):f.state!==Ba.SENT_TO_REMOTE?f.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(f.info("The peer received the local invitation %s.",f.callId),f.state=Ba.RECEIVED_BY_REMOTE,f.emit("LocalInvitationReceivedByPeer"),f.localInvitationEnd$.pipe(hb(6e4),Ga(function(g){return Sa(g)&&f.warn("local invitation expired"),Z(g)})).subscribe({error:function(){f.state=Ba.FAILURE,f.emit("LocalInvitationFailure",bf.INVITATION_EXPIRE)}}))},error:function(g){f.isLocalInvitationEnd()?f.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(f.state=Ba.FAILURE,Sa(g)&&h?h.code==="PEER_NOT_ONLINE"?f.emit("LocalInvitationFailure",bf.PEER_OFFLINE):h.code==="RESENT_AND_OFFLINE"&&f.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):Sa(g)?f.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):g.name==="RtmInvalidStatusError"?f.emit("LocalInvitationFailure",bf.NOT_LOGGEDIN):f.emit("LocalInvitationFailure",bf.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new K("The local invitation cancel failure",Ih);if(this.state===Ba.IDLE)throw new K("The local invitation has not been sent",fA);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',xc);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Ba.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(h){if(this.isLocalInvitationEnd()&&this.state!==Ba.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Ba.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Ba.ACCEPTED_BY_REMOTE,this._response=h,this.emit("LocalInvitationAccepted",h))}}},{key:"onRefuseReceived",value:function(h){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote refuse it?");this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=h,this.state=Ba.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",h)}}},{key:"isLocalInvitationEnd",value:function(){return[Ba.CANCELED,Ba.FAILURE,Ba.ACCEPTED_BY_REMOTE,Ba.REFUSED_BY_REMOTE].includes(this.state)}}]),e}(tb()),fa(vd.prototype,"send",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"send"),vd.prototype),fa(vd.prototype,"cancel",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"cancel"),vd.prototype),vd),Rh=S.RemoteInvitationFailureReason,kb=S.RemoteInvitationState,mD=function(o){function e(h){var f=h.invitationChannel,g=h.extraContent,A=h.callId,C=h.callerId,k=h.logger;h=h.getSession,W(this,e);var j=d.call(this,k,"RtmRemoteInvitation",!0);return m(n(j),"state",kb.INVITATION_RECEIVED),m(n(j),"remoteInvitationEnd$",Ca(gb(n(j),"RemoteInvitationCanceled"),gb(n(j),"RemoteInvitationRefused"),gb(n(j),"RemoteInvitationAccepted"),gb(n(j),"RemoteInvitationFailure")).pipe(Ka(1))),m(n(j),"callerId",void 0),m(n(j),"callId",void 0),m(n(j),"_getSession",void 0),m(n(j),"logger",void 0),m(n(j),"_content",void 0),m(n(j),"_channelId",void 0),m(n(j),"_response",""),j._channelId=f,j._content=g,j.callId=A,j.callerId=C,j._getSession=h,j.logger=k,j.remoteInvitationEnd$.pipe(hb(6e4),Ga(function(_t){return Sa(_t)&&j.warn("Remote invitation expired"),Z(_t)})).subscribe({error:function(){j.state=kb.FAILURE,j.emit("RemoteInvitationFailure",Rh.INVITATION_EXPIRE)}}),j}la(e,o);var d=ma(e);return Ha(e,[{key:"channelId",get:function(){return this._channelId},set:function(h){throw new I('Cannot set the "response" of the RemoteInvitation instance.',xc)}},{key:"content",get:function(){return this._content},set:function(h){throw new I('Cannot set the "content" of the RemoteInvitation instance.',xc)}},{key:"response",get:function(){return this._response},set:function(h){this._response=h}},{key:"accept",value:function(){var h,f=this;if(this.isRemoteInvitationEnd())throw new K("The local invitation has ended. Cannot accept.",Ih);if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',xc);this.state=kb.ACCEPT_SENT_TO_LOCAL,Xb(mm(1e3).pipe(cb(function(){return ad(J(w.mark(function g(){return w.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.abrupt("return",f._getSession().sendInvitationMessage({peerId:f.callerId,callId:f.callId,extra:f.response,type:"CallAccept",isAcceptAck:!1,channelId:f.channelId}));case 1:case"end":return A.stop()}},g)})))}),wb(function(g){return h=g.hasPeerReceived}),Ka(1)),gb(this,"RemoteInvitationAccepted")).pipe(hb(5e3),ob(this.remoteInvitationEnd$)).subscribe({error:function(g){if(f.logError(g),f.state=kb.FAILURE,Sa(g))switch(h){case void 0:case!0:return void f.emit("RemoteInvitationFailure",Rh.ACCEPT_FAILURE);case!1:return void f.emit("RemoteInvitationFailure",Rh.PEER_OFFLINE)}f.emit("RemoteInvitationFailure",Rh.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(this.isRemoteInvitationEnd())throw new K("The invitation is end. Cannot refuse",Ih);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',xc);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=kb.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(h){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===kb.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=h,this.state=kb.CANCELED,this.emit("RemoteInvitationCanceled",h))}},{key:"onAcceptAckReceived",value:function(){this.state!==kb.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=kb.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[kb.ACCEPTED,kb.REFUSED,kb.CANCELED,kb.FAILURE].includes(this.state)}}]),e}(tb()),nD=function(o){function e(h,f){W(this,e);var g=d.call(this,f,"InvitationManager");return m(n(g),"getSession",void 0),m(n(g),"invitationDispatcher",new ea.EventEmitter),m(n(g),"outgoingLocalInvitations",new Map),m(n(g),"receivedRemoteInvitations",new tc(void 0,{maxlen:1e4})),m(n(g),"logger",void 0),g.getSession=cn(h),g.logger=f,g.invitationDispatcher.on("remoteInvitationToManager",function(A){var C=A.callId,k=A.extra,j=A.callerId;A=A.channelId,g.receivedRemoteInvitations.has(C)||((k=new mD({callerId:j,callId:C,getSession:g.getSession,logger:f,extraContent:k,invitationChannel:A})).remoteInvitationEnd$.subscribe(function(){g.receivedRemoteInvitations.delete(C)}),g.receivedRemoteInvitations.set(C,k),g.emit("remoteInvitationInstance",k))}),g.invitationDispatcher.on("acceptAckToRemoteInvitation",function(A){(A=g.receivedRemoteInvitations.get(A.callId))&&A.onAcceptAckReceived()}),g.invitationDispatcher.on("cancelToRemoteInvitation",function(A){var C=A.extra;(A=g.receivedRemoteInvitations.get(A.callId))&&A.onCancelReceived(C)}),g.invitationDispatcher.on("acceptToLocalInvitation",function(A){var C=A.extra;(A=g.outgoingLocalInvitations.get(A.callId))&&A.onAcceptReceived(C)}),g.invitationDispatcher.on("refuseToLocalInvitation",function(A){var C=A.extra;(A=g.outgoingLocalInvitations.get(A.callId))&&A.onRefuseReceived(C)}),g}la(e,o);var d=ma(e);return Ha(e,[{key:"invitationMessageHandler",value:function(h){var f=h.body,g=f.callId,A=f.extra;A=A===void 0?"":A;var C=f.type,k=(f=f.channel)===void 0?"":f,j=h.type;switch(f=h.peerId,h=h.serverReceivedTs,j){case"CallAccept":C==="ack"?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:g}):C==="request"&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:g,extra:A});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:g,callerId:f,extra:A,channelId:k});break;case"CallCancel":if(g==="0"){g="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(k,"_").concat(A),this.getSession().emit("peerTextMessage",{peerId:f,properties:{serverReceivedTs:h,isOfflineMessage:!1},text:g});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:g,extra:A});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:g,extra:A});break;default:throw Im("invitationType",j)}}},{key:"genLocalInvitation",value:function(h){var f=this,g=new lD(h,this.getSession,this.logger);return g.localInvitationEnd$.subscribe(function(){f.outgoingLocalInvitations.delete(g.callId)}),this.outgoingLocalInvitations.set(g.callId,g),g}}]),e}(tb()),oD=function(o,e,d){var h=!0,f=!0;if(typeof o!="function")throw new TypeError("Expected a function");return lb(d)&&(h="leading"in d?!!d.leading:h,f="trailing"in d?!!d.trailing:f),qC(o,e,{leading:h,maxWait:e,trailing:f})},ub,cf;(function(o){o[o.JOINED=0]="JOINED",o[o.LEFT=1]="LEFT"})(cf||(cf={}));var ns=S.ConnectionState,pD=(ub=function(o){function e(h,f,g,A){W(this,e);var C=d.call(this,A,"RtmChannel",!0);return m(n(C),"onMemberCountUpdated",oD(function(k){k!==C.memberCount&&(C.memberCount=k,C.emit("MemberCountUpdated",k))},1e3)),m(n(C),"getSession",void 0),m(n(C),"memberCount",0),m(n(C),"memberJoinedLru",new tc(void 0,{maxlen:1e4})),m(n(C),"memberLeftLru",new tc(void 0,{maxlen:1e4})),m(n(C),"memberJoinStateLru",new tc(void 0,{maxlen:1e4})),m(n(C),"attributesSeqLru",new tc(void 0,{maxlen:1e4})),m(n(C),"channelId",void 0),m(n(C),"client",void 0),m(n(C),"onAttributesUpdated",function(k){var j=k.channelId,_t=k.attributeMaps,_n=k.seq;k=k.instance.toString();var ue=C.attributesSeqLru.get(k);if((!ue||_n.greaterThan(ue))&&(C.attributesSeqLru.set(k,_n),j===C.channelId)){for(j={},_n=0;_n<_t.length;_n++){var Ei=_t[_n];k=Ei.key,ue=Ei.ms;var _s=Ei.value;if(Ei=Ei.origin,typeof k!="string"||!U.isLong(ue)||typeof _s!="string"||!za(Ei))break;j[k]={value:_s,lastUpdateUserId:Ei,lastUpdateTs:ue.toNumber()}}C.emit("AttributesUpdated",j)}}),m(n(C),"onChannelTextMessage",function(k){var j=k.memberId,_t=k.text,_n=k.properties;k.channelId===C.channelId&&C.emit("ChannelMessage",{text:_t,messageType:S.MessageType.TEXT},j,_n)}),m(n(C),"onChannelMediaMessage",function(k){var j=k.memberId,_t=k.properties,_n=k.details,ue=k.messageType;k.channelId===C.channelId&&(ue==="FILE"?C.emit("ChannelMessage",{messageType:S.MessageType.FILE,size:parseInt(pa(_n.media_size),10),description:pa(_n.media_description),fileName:pa(_n.media_filename),mediaId:pa(_n.media_id),thumbnail:new Blob([_n.media_thumbnail])},j,_t):ue==="IMAGE"&&C.emit("ChannelMessage",{messageType:S.MessageType.IMAGE,size:parseInt(pa(_n.media_size),10),description:pa(_n.media_description),fileName:pa(_n.media_filename),mediaId:pa(_n.media_id),thumbnail:new Blob([_n.media_thumbnail]),height:parseInt(pa(_n.media_height),10),width:parseInt(pa(_n.media_width),10),thumbnailHeight:parseInt(pa(_n.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(_n.media_thumbnailwidth),10)},j,_t))}),m(n(C),"onChannelRawMessage",function(k){var j=k.desc,_t=k.raw,_n=k.memberId,ue=k.properties;k.channelId===C.channelId&&C.emit("ChannelMessage",{messageType:S.MessageType.RAW,rawMessage:_t,description:j},_n,ue)}),m(n(C),"onMemberNotice",function(k){var j=k.memberId,_t=k.type,_n=k.size;if(k.channelId===C.channelId){var ue=k.instance.toString();k=k.seq.toString();var Ei={MemberLeft:C.memberLeftLru,MemberJoined:C.memberJoinedLru,MemberCountUpdated:void 0}[_t];if(Ei){if(Ei.has(ue+k))return void C.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",_t,k,oa(C.channelId),oa(j||""));if(Ei.set(ue+k,void 0),typeof j!="string")return;if(j!==C.getSession().context.uid&&((ue=C.memberJoinStateLru.get(j))===cf.JOINED&&_t==="MemberJoined"||ue===cf.LEFT&&_t==="MemberLeft"))return void C.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",_t,k,oa(C.channelId),oa(j||""));C.memberJoinStateLru.set(j,_t==="MemberJoined"?cf.JOINED:cf.LEFT)}C.info("Channel %s - %s, memberId: %s",_t,oa(C.channelId),_t==="MemberCountUpdated"?"[unknown]":oa(j||"")),ue=j===C.getSession().context.uid,_t==="MemberLeft"&&za(j)||_t==="MemberJoined"&&za(j)?(ue||C.emit(_t,j),C.onMemberCountUpdated(_n)):_t==="MemberCountUpdated"&&typeof _n=="number"&&C.onMemberCountUpdated(_n)}}),C.getSession=cn(f),C.channelId=h,C.client=g,C.info("A channel created, id %s",oa(h)),C}la(e,o);var d=ma(e);return Ha(e,[{key:"join",value:function(){var h=J(w.mark(function f(){var g,A,C,k,j,_t,_n;return w.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(za(this.channelId)){ue.next=2;break}throw new I(["The %s in the arguments is invalid","channelId"],hA);case 2:ue.prev=2,g=this.getSession(),ue.next=9;break;case 6:throw ue.prev=6,ue.t0=ue.catch(2),new K("The client is not logged in. Cannot do the operation",Vq);case 9:if(!g.joinedChannels.has(this)){ue.next=12;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:g.context.uid,elapse:fb(g.startTime),errCode:Uq,sid:Xa(g.instanceId)},(A=this.client.context.config.enableCloudProxy)!==null&&A!==void 0&&A),new K("The channel has joined. Cannot rejoin",Uq);case 12:if(ue.prev=12,this.log("Joining the channel %s",oa(this.channelId)),!this.hasOtherChannelJoined()){ue.next=17;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:g.context.uid,elapse:fb(g.startTime),errCode:Wq,sid:Xa(g.instanceId)},(j=this.client.context.config.enableCloudProxy)!==null&&j!==void 0&&j),new K("A channel of the same channel ID has already joined. Cannot rejoin",Wq);case 17:if(g.joinedChannels.size!==20){ue.next=20;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:g.context.uid,elapse:fb(g.startTime),errCode:Tq,sid:Xa(g.instanceId)},(_t=this.client.context.config.enableCloudProxy)!==null&&_t!==void 0&&_t),new ib("The joined channels has exceeded the limit of 20",Tq);case 20:return eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:g.context.uid,elapse:fb(g.startTime),errCode:0,sid:Xa(g.instanceId)},(C=this.client.context.config.enableCloudProxy)!==null&&C!==void 0&&C),ue.next=23,g.requestChannelJoin(this,this.channelId);case 23:eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(g.startTime),errCode:0,sid:Xa(g.instanceId),serverErrCode:0,userId:g.context.uid},(k=this.client.context.config.enableCloudProxy)!==null&&k!==void 0&&k),this.info("The channel %s joined successfully",oa(this.channelId)),g.on("channelTextMessage",this.onChannelTextMessage),g.on("channelRawMessage",this.onChannelRawMessage),g.on("channelMediaMessage",this.onChannelMediaMessage),g.on("memberNotice",this.onMemberNotice),g.on("channelAttributesUpdated",this.onAttributesUpdated),ue.next=41;break;case 32:if(ue.prev=32,ue.t1=ue.catch(12),this.logError(ue.t1),!sa(ue.t1)){ue.next=37;break}throw ue.t1;case 37:if(!Sa(ue.t1)){ue.next=40;break}throw eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(g.startTime),errCode:Sq,sid:Xa(g.instanceId),serverErrCode:0,userId:g.context.uid},(_n=this.client.context.config.enableCloudProxy)!==null&&_n!==void 0&&_n),new db(["Join channel %s timed out",oa(this.channelId)],Sq);case 40:throw new Wc(["The channel %s join failure",oa(this.channelId)],{code:Rq,originalError:ue.t1});case 41:case"end":return ue.stop()}},f,this,[[2,6],[12,32]])}));return function(){return h.apply(this,arguments)}}()},{key:"leave",value:function(){var h=J(w.mark(function f(){var g,A,C,k;return w.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:j.prev=0,A=this.getSession(),j.next=7;break;case 4:throw j.prev=4,j.t0=j.catch(0),new K("The client is not logged in. Cannot do the operation",jA);case 7:if(A.joinedChannels.has(this)){j.next=9;break}throw new K("The channel does not join. Cannot do the operation",iA);case 9:j.prev=9,A.requestChannelLeave(this,this.channelId),this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,A.removeListener("channelTextMessage",this.onChannelTextMessage),A.removeListener("channelRawMessage",this.onChannelRawMessage),A.removeListener("channelMediaMessage",this.onChannelMediaMessage),A.removeListener("memberNotice",this.onMemberNotice),A.removeListener("channelAttributesUpdated",this.onAttributesUpdated),j.next=32;break;case 23:if(j.prev=23,j.t1=j.catch(9),this.logError(j.t1),!sa(j.t1)){j.next=30;break}throw j.t1.code===void 0&&(j.t1.code=Yq),eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(A.startTime),errCode:Yq,sid:Xa(A.instanceId),userId:A.context.uid},(k=this.client.context.config.enableCloudProxy)!==null&&k!==void 0&&k),j.t1;case 30:throw eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(A.startTime),errCode:Xq,sid:Xa(A.instanceId),userId:A.context.uid},(C=this.client.context.config.enableCloudProxy)!==null&&C!==void 0&&C),new Wc("The channel leave failure",{code:Xq,originalError:j.t1});case 32:eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(A.startTime),errCode:0,sid:Xa(A.instanceId),userId:A.context.uid},(g=this.client.context.config.enableCloudProxy)!==null&&g!==void 0&&g);case 33:case"end":return j.stop()}},f,this,[[0,4],[9,23]])}));return function(){return h.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var h=J(w.mark(function f(g){var A,C,k,j,_t,_n=this,ue=arguments;return w.wrap(function(Ei){for(;;)switch(Ei.prev=Ei.next){case 0:A=1<ue.length&&ue[1]!==void 0?ue[1]:{},C=A.enableHistoricalMessaging,k=C!==void 0&&C,Tm(g,Hh),Ei.prev=2,j=this.getSession(),Ei.next=9;break;case 6:throw Ei.prev=6,Ei.t0=Ei.catch(2),new K("The client is not logged in. Cannot do the operation",ig);case 9:if(j.joinedChannels.has(this)){Ei.next=11;break}throw new K("The channel does not join. Cannot do the operation",ig);case 11:if(this.client.connectionState!==ns.RECONNECTING){Ei.next=16;break}return _t=Date.now(),Ei.next=15,new Promise(function(_s,_c){var _u=function(){var _l=J(w.mark(function nE(){var sE;return w.wrap(function(vE){for(;;)switch(vE.prev=vE.next){case 0:return sE=Date.now()-_t,vE.prev=1,vE.next=4,Gg({message:g,peerId:_n.channelId,toPeer:!1,session:_n.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:sE,logger:_n.logger,options:{enableHistoricalMessaging:k,enableOfflineMessaging:!1}});case 4:_s(),vE.next=12;break;case 7:vE.prev=7,vE.t0=vE.catch(1),Sa(vE.t0)&&_c(new db(Yd(_n.name,"sendMessageToPeer",1e4),Yk)),sa(vE.t0)&&_c(vE.t0),_c(new da("Channel message send failure",{code:hg,originalError:vE.t0}));case 12:return vE.prev=12,clearTimeout(_d),vE.finish(12);case 15:case"end":return vE.stop()}},nE,null,[[1,7,12,15]])}));return function(){return _l.apply(this,arguments)}}();_n.client.internalEmitter.once("RECONNECTED",_u);var _d=setTimeout(function(){_n.client.internalEmitter.off("RECONNECTED",_u),_c(new db(Yd(_n.name,"sendMessageToPeer",1e4),Yk))},9e3)});case 15:return Ei.abrupt("return");case 16:if(this.client.connectionState===ns.CONNECTED){Ei.next=18;break}throw new K("The client is not logged in. Cannot do the operation",ig);case 18:return Ei.prev=18,Ei.next=21,Gg({message:g,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:0,logger:this.logger,options:{enableHistoricalMessaging:k,enableOfflineMessaging:!1}});case 21:Ei.next=31;break;case 23:if(Ei.prev=23,Ei.t1=Ei.catch(18),!Sa(Ei.t1)){Ei.next=27;break}throw new db(Yd(this.name,"sendMessage",1e4),Yk);case 27:if(!sa(Ei.t1)){Ei.next=30;break}throw this.logError(Ei.t1),Ei.t1;case 30:throw new Wc("The channel message send failure",hg);case 31:case"end":return Ei.stop()}},f,this,[[2,6],[18,23]])}));return function(f){return h.apply(this,arguments)}}()},{key:"getMembers",value:function(){var h=J(w.mark(function f(){var g,A,C;return w.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:k.prev=0,k.prev=1,g=this.getSession(),k.next=8;break;case 5:throw k.prev=5,k.t0=k.catch(1),new K("The client is not logged in. Cannot do the operation",eA);case 8:if(g.joinedChannels.has(this)){k.next=10;break}throw new K("The channel does not join. Cannot do the operation",dA);case 10:return A=this.getSession().requestChannelMemberList(this.channelId),k.next=13,A.pipe(ba(function(j){return j.memberInfos.map(function(_t){return _t.account})})).toPromise();case 13:return C=k.sent,this.info("Channel %s - get members success, %o",oa(this.channelId),C.map(oa)),k.abrupt("return",C);case 18:if(k.prev=18,k.t1=k.catch(0),!sa(k.t1)){k.next=23;break}throw this.logError(k.t1),k.t1;case 23:throw new Wc("The channel members get failure",bA);case 24:case"end":return k.stop()}},f,this,[[0,18],[1,5]])}));return function(){return h.apply(this,arguments)}}()},{key:"hasOtherChannelJoined",value:function(){var h=this;return!this.getSession().joinedChannels.has(this)&&Array.from(this.getSession().joinedChannels).some(function(f){return f.channelId===h.channelId})}}]),e}(tb()),fa(ub.prototype,"join",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"join"),ub.prototype),fa(ub.prototype,"leave",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"leave"),ub.prototype),fa(ub.prototype,"sendMessage",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"sendMessage"),ub.prototype),fa(ub.prototype,"getMembers",[Ma],Object.getOwnPropertyDescriptor(ub.prototype,"getMembers"),ub.prototype),ub),E,Eb=S.ConnectionChangeReason,T=S.ConnectionState,os={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},qD={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8},rD=(E=function(o){function e(h,f,g,A){W(this,e);var C=d.call(this,f,"RtmClient",!0);return m(n(C),"connectionState",T.DISCONNECTED),m(n(C),"internalEmitter",new ea),m(n(C),"context",void 0),m(n(C),"attributes",{}),m(n(C),"loginPromise",void 0),m(n(C),"attributeDrafts",new Set),m(n(C),"session",void 0),m(n(C),"lastLoginTime",void 0),m(n(C),"reconnId",0),m(n(C),"channelAttributesCacheLru",new tc(void 0,{maxlen:1e4})),m(n(C),"invitationManager",void 0),m(n(C),"subscribedPeerStatusCache",{}),m(n(C),"peerStatusSeqLru",new tc(void 0,{maxlen:1e4})),m(n(C),"peerUnreachableTimers",{}),m(n(C),"mediaTaskManager",void 0),m(n(C),"setParameters",void 0),m(n(C),"updateConfig",void 0),m(n(C),"userDropHandler",function(k){if(C.connectionState!==T.ABORTED)switch(k){case 11:C.logError("Kicked off by remote session"),C.onConnectionStateChanged(T.ABORTED,Eb.REMOTE_LOGIN);break;case 14:case 15:case 16:C.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[k])),C.onConnectionStateChanged(T.ABORTED,Eb.BANNED_BY_SERVER);break;default:C.logError("User kicked off for unknown code: ".concat(k)),C.onConnectionStateChanged(T.ABORTED,Eb.INTERRUPTED)}}),C.context=new ZC(h,g,f),C.mediaTaskManager=new fs(f),C.context.config=g,C.internalEmitter.setMaxListeners(512),C.setParameters=A.bind(n(C)),C.updateConfig=A.bind(n(C)),C.invitationManager=new nD(function(){return C.session},f),C.invitationManager.on("remoteInvitationInstance",function(k){C.emit("RemoteInvitationReceived",k)}),C}la(e,o);var d=ma(e);return Ha(e,[{key:"renewToken",value:function(){var h=J(w.mark(function f(g){var A,C,k,j=this;return w.wrap(function(_t){for(;;)switch(_t.prev=_t.next){case 0:if(typeof g=="string"&&g.length!==0){_t.next=2;break}throw new I("Invalid argument",rA);case 2:if(this.connectionState!==T.ABORTED){_t.next=5;break}return _t.next=5,new Promise(function(){});case 5:if(this.connectionState===T.CONNECTED||this.connectionState===T.RECONNECTING){_t.next=7;break}throw new K("The client is not logged in",uA);case 7:if(this.session!==void 0){_t.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return _t.prev=9,A=this.context.token,this.context.token=g,_t.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe(Dd(function(){return Error("No available edge address to connect")}),oe(function(_n){return _n.pipe(ca(function(ue){if(sa(ue))throw ue}),cd(2500),Ka(4))}),Ka(1),hb(2e4),Ga(function(_n){return Sa(_n)&&j.warn("renewToken timed out"),Z(_n)})).toPromise();case 14:C=_t.sent,k=C.ticket,_t.next=27;break;case 18:if(_t.prev=18,_t.t0=_t.catch(9),this.context.token=A,_t.t0.code!==$q&&_t.t0.code!==ar){_t.next=23;break}throw new Ye("Invalid token",tA);case 23:if(_t.t0.code!==Kh){_t.next=25;break}throw new Ye("The token expired",sA);case 25:if(!Sa(_t.t0)){_t.next=27;break}throw new db("Renew token timed out",qA);case 27:this.session.curLoginSockets.filter(function(_n){return _n!==void 0}).forEach(function(_n){return _n.ticket=k});case 28:case"end":return _t.stop()}},f,this,[[9,18]])}));return function(f){return h.apply(this,arguments)}}()},{key:"queryPeersOnlineStatus",value:function(){var h=J(w.mark(function f(g){var A,C,k=this;return w.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(this.connectionState===T.CONNECTED){j.next=2;break}throw new K("The client is not logged in",pA);case 2:if(this.session!==void 0){j.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(g)||g.length===0||g.some(function(_t){return!za(_t)})||256<g.length)){j.next=6;break}throw new I("invalid arguments",er);case 6:return j.next=8,this.session.requestPeersOnlineStatus(g).toPromise();case 8:return A=j.sent,C=uc(Jk(A.userInfos,"account"),function(_t){return!!_t.ts}),Object.keys(C).forEach(function(_t){if(_t in k.subscribedPeerStatusCache&&k.subscribedPeerStatusCache[_t]!==S.PeerOnlineState.UNREACHABLE){var _n=C[_t]?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE;k.emit("PeersOnlineStatusChanged",m({},_t,_n)),k.subscribedPeerStatusCache[_t]=_n}}),j.abrupt("return",C);case 12:case"end":return j.stop()}},f,this)}));return function(f){return h.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var h=J(w.mark(function f(g){var A,C,k,j,_t,_n,ue,Ei=this;return w.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:if(this.connectionState===T.CONNECTED){_s.next=2;break}throw new K("The client is not logged in",aA);case 2:if(this.session!==void 0){_s.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(g)&&g.every(function(_c){return typeof _c=="string"})&&g.length!==0){_s.next=6;break}throw new I("Invalid arguments: channelIds",Oq);case 6:if(!(32<g.length)){_s.next=8;break}throw new I("getChannelMemberCount exceed limit of 32 channelIds",$z);case 8:A=0;case 9:if(!(A<g.length)){_s.next=16;break}if(za(C=g[A])){_s.next=13;break}throw new I(["getChannelMemberCount channel id %s is invalid",C],Oq);case 13:A++,_s.next=9;break;case 16:return _s.next=18,this.session.requestGetChannelMemberCount(g).toPromise();case 18:for(k=_s.sent,j=k.groupInfos,_t={},_n=function(_c){var _u=(_c=j[_c]).group,_d=_c.memberCount;za(_u)&&typeof _d=="number"&&(Ei.session.joinedChannels.forEach(function(_l){_l.channelId===_u&&_l.onMemberCountUpdated(_d)}),_t[_u]=_d)},ue=0;ue<j.length;ue++)_n(ue);return _s.abrupt("return",_t);case 24:case"end":return _s.stop()}},f,this)}));return function(f){return h.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var h=J(w.mark(function f(g){var A,C;return w.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(uf({attributes:g,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){k.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(this.session!==void 0){k.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return A=this.session.requestSetLocalUserAttributes(g).toPromise(),C={attribute:g,promise:A},this.attributeDrafts.add(C),k.prev=8,k.next=11,A;case 11:this.attributes=g,k.next=19;break;case 14:if(k.prev=14,k.t0=k.catch(8),!sa(k.t0)){k.next=18;break}throw k.t0;case 18:throw new I("arguments is not valid",Ja);case 19:return k.prev=19,this.attributeDrafts.delete(C),k.finish(19);case 22:case"end":return k.stop()}},f,this,[[8,14,19,22]])}));return function(f){return h.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var h=J(w.mark(function f(g,A){var C,k,j,_t,_n,ue=arguments;return w.wrap(function(Ei){for(;;)switch(Ei.prev=Ei.next){case 0:if(C=2<ue.length&&ue[2]!==void 0?ue[2]:{},k=C.enableNotificationToChannelMembers,j=k!==void 0&&k,uf({attributes:A,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){Ei.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){Ei.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return _t=this.session.requestSetChannelAttributes(g,A,j).toPromise(),Ei.prev=7,Ei.next=10,_t;case 10:_n=uc(A,function(_s){return new Blob([_s]).size}),this.channelAttributesCacheLru.set(g,_n),Ei.next=19;break;case 14:if(Ei.prev=14,Ei.t0=Ei.catch(7),!sa(Ei.t0)){Ei.next=18;break}throw Ei.t0;case 18:throw new I("arguments is not valid",Ja);case 19:case"end":return Ei.stop()}},f,this,[[7,14]])}));return function(f,g){return h.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var h=J(w.mark(function f(g){var A,C,k;return w.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(A=ua(ua({},this.attributes),g),uf({attributes:g,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),uf({attributes:A,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){j.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(this.session!==void 0){j.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return C=this.session.requestAddOrUpdateLocalUserAttributes(g).toPromise(),k={attribute:A,promise:C},this.attributeDrafts.add(k),j.prev=10,j.next=13,C;case 13:this.attributes=A,j.next=21;break;case 16:if(j.prev=16,j.t0=j.catch(10),!sa(j.t0)){j.next=20;break}throw j.t0;case 20:throw new I("arguments is not valid",er);case 21:return j.prev=21,this.attributeDrafts.delete(k),j.finish(21);case 24:case"end":return j.stop()}},f,this,[[10,16,21,24]])}));return function(f){return h.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var h=J(w.mark(function f(g,A){var C,k,j,_t,_n,ue,Ei,_s=arguments;return w.wrap(function(_c){for(;;)switch(_c.prev=_c.next){case 0:if(C=2<_s.length&&_s[2]!==void 0?_s[2]:{},k=C.enableNotificationToChannelMembers,j=k!==void 0&&k,_t=this.channelAttributesCacheLru.get(g,{}),_n=uc(A,function(_u){return new Blob([_u]).size}),ue=ua(ua({},_t),_n),uf({attributes:A,attrSizeMap:ue,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){_c.next=7;break}throw new K("The client is not logged in",Ub);case 7:if(this.session!==void 0){_c.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return Ei=this.session.requestAddOrUpdateChannelAttributes(g,A,j).toPromise(),_c.prev=10,_c.next=13,Ei;case 13:this.channelAttributesCacheLru.set(g,ue),_c.next=21;break;case 16:if(_c.prev=16,_c.t0=_c.catch(10),!sa(_c.t0)){_c.next=20;break}throw _c.t0;case 20:throw new I("arguments is not valid",Ja);case 21:case"end":return _c.stop()}},f,this,[[10,16]])}));return function(f,g){return h.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var h=J(w.mark(function f(g){var A,C,k,j;return w.wrap(function(_t){for(;;)switch(_t.prev=_t.next){case 0:if(Array.isArray(g)&&g.length!==0&&!g.some(function(_n){return _n.length===0})){_t.next=2;break}throw new K("arguments is not valid",Ja);case 2:if(this.connectionState===T.CONNECTED){_t.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){_t.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return A=this.session.requestDeleteLocalUserAttributesByKeys(g).toPromise(),C={attribute:Gk(this.attributes,g),promise:A},this.attributeDrafts.add(C),_t.prev=9,_t.next=12,A;case 12:for(k=0;k<g.length;k++)j=g[k],delete this.attributes[j];_t.next=20;break;case 15:if(_t.prev=15,_t.t0=_t.catch(9),!sa(_t.t0)){_t.next=19;break}throw _t.t0;case 19:throw new I("arguments is not valid",Ja);case 20:return _t.prev=20,this.attributeDrafts.delete(C),_t.finish(20);case 23:case"end":return _t.stop()}},f,this,[[9,15,20,23]])}));return function(f){return h.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var h=J(w.mark(function f(g,A){var C,k,j,_t,_n,ue,Ei,_s=arguments;return w.wrap(function(_c){for(;;)switch(_c.prev=_c.next){case 0:if(C=2<_s.length&&_s[2]!==void 0?_s[2]:{},k=C.enableNotificationToChannelMembers,j=k!==void 0&&k,Array.isArray(A)&&A.length!==0&&za(g)&&!A.some(function(_u){return _u.length===0||512<_u.length})){_c.next=3;break}throw new K("arguments is not valid",Ja);case 3:if(this.connectionState===T.CONNECTED){_c.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(this.session!==void 0){_c.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return _t=this.session.requestDeleteChannelAttributesByKeys(g,A,j).toPromise(),_c.prev=8,_c.next=11,_t;case 11:if(_n=this.channelAttributesCacheLru.get(g))for(ue=0;ue<A.length;ue++)Ei=A[ue],delete _n[Ei];_c.next=20;break;case 15:if(_c.prev=15,_c.t0=_c.catch(8),!sa(_c.t0)){_c.next=19;break}throw _c.t0;case 19:throw new I("arguments is not valid",Ja);case 20:case"end":return _c.stop()}},f,this,[[8,15]])}));return function(f,g){return h.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var h=J(w.mark(function f(){var g,A;return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(this.connectionState===T.CONNECTED){C.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){C.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return g=this.session.requestClearLocalUserAttributes().toPromise(),A={attribute:{},promise:g},this.attributeDrafts.add(A),C.prev=7,C.next=10,g;case 10:this.attributes={},C.next=18;break;case 13:if(C.prev=13,C.t0=C.catch(7),!sa(C.t0)){C.next=17;break}throw C.t0;case 17:throw new I("arguments is not valid",Ja);case 18:return C.prev=18,this.attributeDrafts.delete(A),C.finish(18);case 21:case"end":return C.stop()}},f,this,[[7,13,18,21]])}));return function(){return h.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var h=J(w.mark(function f(g){var A,C,k,j,_t=arguments;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:if(A=1<_t.length&&_t[1]!==void 0?_t[1]:{},C=A.enableNotificationToChannelMembers,k=C!==void 0&&C,this.connectionState===T.CONNECTED){_n.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(this.session!==void 0){_n.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return j=this.session.requestClearChannelAttributes(g,k).toPromise(),_n.prev=6,_n.next=9,j;case 9:this.channelAttributesCacheLru.delete(g),_n.next=17;break;case 12:if(_n.prev=12,_n.t0=_n.catch(6),!sa(_n.t0)){_n.next=16;break}throw _n.t0;case 16:throw new I("arguments is not valid",Ja);case 17:case"end":return _n.stop()}},f,this,[[6,12]])}));return function(f){return h.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var h=J(w.mark(function f(g){var A,C,k;return w.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(za(g)){j.next=2;break}throw new I("Not a valid user ID",Ja);case 2:if(this.connectionState===T.CONNECTED){j.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){j.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return j.prev=6,j.next=9,this.session.requestGetUserAttributeKeys(g).toPromise();case 9:return A=j.sent,C=A.keys,j.next=13,this.session.requestGetUserAttributesByKeys(g,C.slice(0,512)).toPromise();case 13:k=j.sent,j.next=21;break;case 16:if(j.prev=16,j.t0=j.catch(6),!sa(j.t0)){j.next=20;break}throw j.t0;case 20:throw new I("arguments is not valid",Ja);case 21:return j.abrupt("return",Yp(k.attributeInfos.map(function(_t){return[_t.key,_t.value]})));case 22:case"end":return j.stop()}},f,this,[[6,16]])}));return function(f){return h.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var h=J(w.mark(function f(g){var A,C,k,j,_t,_n,ue,Ei,_s,_c,_u;return w.wrap(function(_d){for(;;)switch(_d.prev=_d.next){case 0:if(za(g)){_d.next=2;break}throw new I("Not a valid channel ID",Ja);case 2:if(this.connectionState===T.CONNECTED){_d.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){_d.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return _d.prev=6,_d.next=9,this.session.requestGetChannelAttributesKeys(g).toPromise();case 9:return A=_d.sent,C=A.keys,_d.next=13,this.session.requestGetChannelAttributesByKeys(g,C).toPromise();case 13:k=_d.sent,j=k.attributeMaps,_d.next=22;break;case 17:if(_d.prev=17,_d.t0=_d.catch(6),!sa(_d.t0)){_d.next=21;break}throw _d.t0;case 21:throw new I("arguments is not valid",Ja);case 22:_t={},_n=0;case 24:if(!(_n<j.length)){_d.next=32;break}if(ue=j[_n],Ei=ue.key,_s=ue.ms,_c=ue.value,_u=ue.origin,typeof Ei=="string"&&U.isLong(_s)&&typeof _c=="string"&&za(_u)){_d.next=28;break}return _d.abrupt("break",32);case 28:_t[Ei]={value:_c,lastUpdateUserId:_u,lastUpdateTs:_s.toNumber()};case 29:_n++,_d.next=24;break;case 32:return this.channelAttributesCacheLru.set(g,uc(_t,function(_l){return new Blob([_l.value]).size})),_d.abrupt("return",_t);case 34:case"end":return _d.stop()}},f,this,[[6,17]])}));return function(f){return h.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var h=J(w.mark(function f(g,A){var C,k,j,_t,_n,ue,Ei,_s,_c,_u;return w.wrap(function(_d){for(;;)switch(_d.prev=_d.next){case 0:if(this.connectionState===T.CONNECTED){_d.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){_d.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(g,A),_d.prev=5,_d.next=8,this.session.requestGetChannelAttributesByKeys(g,A).toPromise();case 8:C=_d.sent,k=C.attributeMaps,_d.next=17;break;case 12:if(_d.prev=12,_d.t0=_d.catch(5),!sa(_d.t0)){_d.next=16;break}throw _d.t0;case 16:throw new I("arguments is not valid",Ja);case 17:j={},_t=this.channelAttributesCacheLru.get(g,{}),_n=0;case 20:if(!(_n<k.length)){_d.next=29;break}if(ue=k[_n],Ei=ue.key,_s=ue.ms,_c=ue.value,_u=ue.origin,typeof Ei=="string"&&U.isLong(_s)&&typeof _c=="string"&&za(_u)){_d.next=24;break}return _d.abrupt("break",29);case 24:_t[Ei]=new Blob([_c]).size,j[Ei]={value:_c,lastUpdateUserId:_u,lastUpdateTs:_s.toNumber()};case 26:_n++,_d.next=20;break;case 29:return this.channelAttributesCacheLru.set(g,_t),_d.abrupt("return",j);case 31:case"end":return _d.stop()}},f,this,[[5,12]])}));return function(f,g){return h.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var h=J(w.mark(function f(g,A){var C;return w.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(this.connectionState===T.CONNECTED){k.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){k.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(g,A),k.prev=5,k.next=8,this.session.requestGetUserAttributesByKeys(g,A).toPromise();case 8:C=k.sent,k.next=16;break;case 11:if(k.prev=11,k.t0=k.catch(5),!sa(k.t0)){k.next=15;break}throw k.t0;case 15:throw new I("arguments is not valid",Ja);case 16:return k.abrupt("return",Yp(C.attributeInfos.map(function(j){return[j.key,j.value]})));case 17:case"end":return k.stop()}},f,this,[[5,11]])}));return function(f,g){return h.apply(this,arguments)}}()},{key:"login",value:function(){var h=J(w.mark(function f(g){var A,C,k,j,_t=this;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:if(Uk=!0,A=Bg(),C=g.token,g.token===this.context.appId&&(C=void 0),setTimeout(function(){var ue;eb("Session",{appId:_t.context.appId,did:navigator.userAgent,elapse:fb(_t.session&&_t.session.startTime),index:{index1:g.uid,index2:_t.context.appId,index3:"enableLogUpload=".concat(_t.context.config.enableLogUpload)},installId:gg,lts:U.fromNumber(Date.now()),os:7,sid:Xa(A),token:C||"",userId:g.uid,ver:"1.4.3-203",buildno:603,subVersion:203,version:4},(ue=_t.context.config.enableCloudProxy)!==null&&ue!==void 0&&ue)},1e4),yd(g)&&za(g.uid)){_n.next=7;break}throw new I("not a valid user id",Jh);case 7:if(typeof C!="string"||!C){_n.next=11;break}this.context.token=C,_n.next=13;break;case 11:if(typeof C=="string"||C==null){_n.next=13;break}throw new I('The "token" is not a valid string.',Jh);case 13:return k=Date.now(),this.context.sid=Xa(A),this.loginPromise=this.loginImpl({uid:g.uid,instanceId:A}),this.info("RTM Client logging in as ".concat(oa(g.uid))),_n.prev=17,_n.next=20,this.loginPromise;case 20:_n.next=27;break;case 22:throw _n.prev=22,_n.t0=_n.catch(17),sa(_n.t0)&&eb("Link",{ackedServerIp:"",destServerIp:"",ec:_n.t0.code||1,sc:_n.t0.serverCode,elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),responseTime:Date.now()-k,sid:Xa(A),userId:g.uid},(j=this.context.config.enableCloudProxy)!==null&&j!==void 0&&j),this.context.token=void 0,_n.t0;case 27:return _n.prev=27,this.loginPromise=void 0,_n.finish(27);case 30:Uk=!1;case 31:case"end":return _n.stop()}},f,this,[[17,22,27,30]])}));return function(f){return h.apply(this,arguments)}}()},{key:"logout",value:function(){var h=J(w.mark(function f(){var g;return w.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!this.loginPromise){A.next=3;break}return A.next=3,this.loginPromise;case 3:if(this.connectionState!==T.DISCONNECTED){A.next=6;break}throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);case 6:if(this.connectionState!==T.ABORTED){A.next=10;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),A.abrupt("return");case 10:if(this.session!==void 0){A.next=13;break}return this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),A.abrupt("return");case 13:return eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},(g=this.context.config.enableCloudProxy)!==null&&g!==void 0&&g),A.next=16,this.session.logoutHandler();case 16:this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),this.log("Log out success");case 18:case"end":return A.stop()}},f,this)}));return function(){return h.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var h,f=this;if(this.connectionState===T.DISCONNECTED)throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);this.connectionState===T.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):this.session!==void 0&&(eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},(h=this.context.config.enableCloudProxy)!==null&&h!==void 0&&h),this.session.logoutHandler().then(function(){f.log("Log out success")})),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var h=J(w.mark(function f(g,A){var C,k,j,_t,_n,ue,Ei=this,_s=arguments;return w.wrap(function(_c){for(;;)switch(_c.prev=_c.next){case 0:if(C=2<_s.length&&_s[2]!==void 0?_s[2]:{},k=C.enableOfflineMessaging,j=k!==void 0&&k,_t=C.enableHistoricalMessaging,_n=_t!==void 0&&_t,Tm(g,ve),this.connectionState!==T.RECONNECTING){_c.next=5;break}return ue=Date.now(),_c.abrupt("return",new Promise(function(_u,_d){var _l=function(){var sE=J(w.mark(function vE(){var mE;return w.wrap(function(yE){for(;;)switch(yE.prev=yE.next){case 0:if(Ei.session!==void 0){yE.next=2;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return mE=Date.now()-ue,yE.prev=3,yE.t0=_u,yE.next=7,Gg({message:g,peerId:A,toPeer:!0,session:Ei.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:mE,logger:Ei.logger,options:{enableHistoricalMessaging:_n,enableOfflineMessaging:j}});case 7:yE.t1=yE.sent,(0,yE.t0)(yE.t1),yE.next=16;break;case 11:yE.prev=11,yE.t2=yE.catch(3),Sa(yE.t2)&&_d(new db(Yd(Ei.name,"sendMessageToPeer",1e4),Zk)),sa(yE.t2)&&_d(yE.t2),_d(new da("Peer-to-peer message send failure",{code:cr,originalError:yE.t2}));case 16:return yE.prev=16,clearTimeout(nE),yE.finish(16);case 19:case"end":return yE.stop()}},vE,null,[[3,11,16,19]])}));return function(){return sE.apply(this,arguments)}}();Ei.internalEmitter.once("RECONNECTED",_l);var nE=setTimeout(function(){Ei.internalEmitter.off("RECONNECTED",_l),_d(new db(Yd(Ei.name,"sendMessageToPeer",1e4),Zk))},9e3)}));case 5:if(this.connectionState===T.CONNECTED){_c.next=7;break}throw new K("Failed to send the peer-to-peer message. The client is not logged in",al);case 7:if(this.session!==void 0){_c.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return _c.prev=9,_c.next=12,Gg({message:g,peerId:A,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:0,logger:this.logger,options:{enableHistoricalMessaging:_n,enableOfflineMessaging:j}});case 12:return _c.abrupt("return",_c.sent);case 15:if(_c.prev=15,_c.t0=_c.catch(9),!Sa(_c.t0)){_c.next=19;break}throw new db(Yd(this.name,"sendMessageToPeer",1e4),Zk);case 19:if(!sa(_c.t0)){_c.next=21;break}throw _c.t0;case 21:throw new da("Peer-to-peer message send failure",{code:cr,originalError:_c.t0});case 22:case"end":return _c.stop()}},f,this,[[9,15]])}));return function(f,g){return h.apply(this,arguments)}}()},{key:"createChannel",value:function(h){var f=this;if(!za(h))throw new I(["The %s in the arguments is invalid",Object.keys({channelId:h})[0]],Zz);return new pD(h,function(){return f.session},this,this.logger)}},{key:"createLocalInvitation",value:function(h){if(!za(h))throw new I(["The %s in the arguments is invalid",Object.keys({calleeId:h})[0]],xc);return this.invitationManager.genLocalInvitation(h)}},{key:"subscribePeersOnlineStatus",value:function(){var h=J(w.mark(function f(g){var A,C,k,j,_t,_n,ue,Ei,_s,_c,_u,_d,_l,nE=this;return w.wrap(function(sE){for(;;)switch(sE.prev=sE.next){case 0:if(this.connectionState===T.CONNECTED){sE.next=2;break}throw new K("The client is not logged in",bl);case 2:if(this.session!==void 0){sE.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(g)&&g.length!==0){sE.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:A=0;case 7:if(!(A<g.length)){sE.next=14;break}if(za(C=g[A])){sE.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",C],kg);case 11:A++,sE.next=7;break;case 14:if(!(512<(k=g&&g.length?vk(g):[]).length+Object.keys(this.subscribedPeerStatusCache).length)){sE.next=17;break}throw new ib("Subscribed peers overflows",gr);case 17:return sE.next=19,this.session.requestSubscribePeersOnlineStatus(k).toPromise();case 19:j=sE.sent,_t=j.errors,_n=[],ue=[],Ei=0;case 24:if(!(Ei<_t.length)){sE.next=32;break}if(_s=_t[Ei],_c=_s.code,typeof(_u=_s.account)=="string"){sE.next=28;break}throw new da("Returned account is invalid",fr);case 28:_c!==0&&_n.push(_u);case 29:Ei++,sE.next=24;break;case 32:for(_d=0;_d<k.length;_d++)_l=k[_d],_n.includes(_l)||(ue.push(_l),this.subscribedPeerStatusCache[_l]=void 0);if(this.session.requestPeersOnlineStatus(ue).pipe(ba(function(vE){return uc(Jk(vE.userInfos,"account"),function(mE){return!!mE.ts})})).subscribe(function(vE){vE=uc(vE,function(mE,yE){return mE=mE?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,nE.subscribedPeerStatusCache[yE]=mE}),nE.emit("PeersOnlineStatusChanged",vE)}),_n.length===0){sE.next=36;break}throw new da("Subscription failed",fr);case 36:case"end":return sE.stop()}},f,this)}));return function(f){return h.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var h=J(w.mark(function f(g){var A,C,k,j,_t;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:if(this.connectionState===T.CONNECTED){_n.next=2;break}throw new K("The client is not logged in",bl);case 2:if(this.session!==void 0){_n.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(g)&&g.length!==0){_n.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:A=0;case 7:if(!(A<g.length)){_n.next=14;break}if(za(C=g[A])){_n.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",C],kg);case 11:A++,_n.next=7;break;case 14:if(!(512<g.length)){_n.next=16;break}throw new ib("Unsubscribed peers overflows",gr);case 16:for(k=g&&g.length?vk(g):[],this.session.requestUnsubscribePeersOnlineStatus(k),j=0;j<k.length;j++)_t=k[j],delete this.subscribedPeerStatusCache[_t];case 19:case"end":return _n.stop()}},f,this)}));return function(f){return h.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var h=J(w.mark(function f(g){return w.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(this.connectionState===T.CONNECTED){A.next=2;break}throw new K("The client is not logged in",bl);case 2:if(g!==S.PeerSubscriptionOption.ONLINE_STATUS){A.next=4;break}return A.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new I("Subscription option not supported",kg);case 5:case"end":return A.stop()}},f,this)}));return function(f){return h.apply(this,arguments)}}()},{key:"createMessage",value:function(h){return h.messageType==="IMAGE"?ua({width:0,height:0,fileName:"",description:"",thumbnail:new Blob,thumbnailWidth:0,thumbnailHeight:0,size:0},h):h.messageType==="FILE"?ua({fileName:"",description:"",thumbnail:new Blob,size:0},h):h}},{key:"downloadMedia",value:function(){var h=J(w.mark(function f(g){var A,C,k,j,_t,_n,ue,Ei,_s,_c,_u,_d,_l,nE,sE=this,vE=arguments;return w.wrap(function(mE){for(;;)switch(mE.prev=mE.next){case 0:if(A=1<vE.length&&vE[1]!==void 0?vE[1]:{},typeof g=="string"){mE.next=3;break}throw new I("invalid mediaId format",cl);case 3:if(mE.prev=3,C=g.split("z"),k=ra(C,3),j=k[0],_t=k[1],_n=k[2],ue=j.slice(1,65),Ei=bD(ue),_s=parseInt(j.slice(65),10),_c=parseInt(_t,10),_u=parseInt(_n,10),!(Number.isNaN(_s)||Number.isNaN(_c)||Number.isNaN(_u))){mE.next=12;break}throw new I("Invalid mediaId content",cl);case 12:mE.next=19;break;case 14:if(mE.prev=14,mE.t0=mE.catch(3),!sa(mE.t0)){mE.next=18;break}throw mE.t0;case 18:throw new I("parse mediaId failure",{code:cl,originalError:mE.t0});case 19:if(this.connectionState===T.CONNECTED){mE.next=21;break}throw new K("The client is not logged in, cannot download",CA);case 21:if(this.session!==void 0){mE.next=23;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 23:return _d=this.mediaTaskManager.addDownloadTask({unit:_c,zone:_s,hashHexStr:ue,size:_u},function(){if(sE.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return sE.session.requestFileDownloadIndexGet({hash:Ei,zone:_s,unit:_c,size:_u}).toPromise()},A),mE.next=26,this.mediaTaskManager.waitMediaTask(_d);case 26:return _l=mE.sent,nE=_l.payload,mE.abrupt("return",nE);case 29:case"end":return mE.stop()}},f,this,[[3,14]])}));return function(f){return h.apply(this,arguments)}}()},{key:"createMediaMessageByUploading",value:function(){var h=J(w.mark(function f(g){var A,C,k,j,_t,_n,ue,Ei,_s,_c,_u,_d,_l,nE,sE,vE,mE,yE,BE,t_,vf,fE,hE,bE,_h=this,tE=arguments;return w.wrap(function(aE){for(;;)switch(aE.prev=aE.next){case 0:if(A=1<tE.length&&tE[1]!==void 0?tE[1]:{},C=2<tE.length&&tE[2]!==void 0?tE[2]:{},yd(A)){aE.next=4;break}throw new I("Invalid params",wf);case 4:if(k="thumbnailWidth"in A||"thumbnailHeight"in A||"width"in A||"height"in A,j=A.messageType,_t=j===void 0?k?"IMAGE":"FILE":j,_n=A.description,ue=_n===void 0?"":_n,Ei=A.fileName,_s=Ei===void 0?"":Ei,_c=A.thumbnail,typeof A.messageType=="string"&&typeof ue=="string"&&typeof _s=="string"&&(Pm(_c)||_c===void 0)&&Pm(g)){aE.next=8;break}throw new I("Invalid message params type",wf);case 8:if(!k||_t!=="FILE"){aE.next=10;break}throw new I("Invalid message params, unexpected field in RtmFileMessage",wf);case 10:if(!(33554432<(_u=g.size))){aE.next=13;break}throw new ib("The payload size overflow 32 MB",wA);case 13:return aE.next=15,Ji(g);case 15:return _d=aE.sent,aE.next=18,aD(_d);case 18:if(_l=aE.sent,this.connectionState===T.CONNECTED){aE.next=21;break}throw new K("The client is not logged in",yA);case 21:if(_t!=="IMAGE"){aE.next=29;break}return aE.next=24,Xt(A,_d);case 24:nE=aE.sent,sE=nE.height,vE=nE.width,mE=nE.thumbnailWidth,yE=nE.thumbnailHeight;case 29:return BE=this.mediaTaskManager.addUploadTask({file:new Uint8Array(_d),hash:_l},function(){if(_h.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return _h.session.fetchFileUploadIndexGet({hash:_l,size:_u})},function(TE,OE){if(_h.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return _h.session.requestFileUploadIndexSet({hash:_l,unit:TE,servers:OE}).toPromise()},C),aE.next=32,this.mediaTaskManager.waitMediaTask(BE);case 32:if(t_=aE.sent,vf=t_.zone,fE=t_.retUnit,_t!=="IMAGE"){aE.next=38;break}return hE={height:sE,width:vE,fileName:_s,size:_u,description:ue,thumbnail:_c,messageType:_t,thumbnailWidth:mE,thumbnailHeight:yE,mediaId:"0".concat($r(_l)).concat(vf,"z").concat(fE,"z").concat(_u,"z").concat(sE,"z").concat(vE)},aE.abrupt("return",hE);case 38:return bE={fileName:_s,size:_u,description:ue,mediaId:"0".concat($r(_l)).concat(vf,"z").concat(fE,"z").concat(_u),thumbnail:_c,messageType:_t},aE.abrupt("return",bE);case 40:case"end":return aE.stop()}},f,this)}));return function(f){return h.apply(this,arguments)}}()},{key:"loginImpl",value:function(){var h=J(w.mark(function f(g){var A,C,k,j,_t=this;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:if(A=g.uid,C=g.instanceId,!(this.lastLoginTime!==void 0&&500>Date.now()-this.lastLoginTime)){_n.next=4;break}throw new rC(["The frequency of login exceeded the limit of %d queries per second",2],mA);case 4:if(this.connectionState===T.DISCONNECTED){_n.next=6;break}throw new K("The SDK is either logging in or has logged in the Agora RTM system",kA);case 6:_n.prev=6,this.context.uid=A,_n.next=13;break;case 10:throw _n.prev=10,_n.t0=_n.catch(6),new I(["The %s in the arguments is invalid",Object.keys({uid:A})[0]],Jh);case 13:return this.onConnectionStateChanged(T.CONNECTING,Eb.LOGIN),this.session=k=new ls(this.context,new Yr(this.context,this.logger,!1),C,this.logger),j=function(){_t.connectionState===T.CONNECTED&&(_t.onConnectionStateChanged(T.RECONNECTING,Eb.INTERRUPTED),_t.session)&&_t.session.once("userJoined",function(){_t.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS)})},k.on("connectionLost",j),k.on("tokenExpired",function(){_t.emit("TokenExpired")}),k.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",function(ue){_t.emit("MessageFromPeer",{text:ue.text,messageType:S.MessageType.TEXT},ue.peerId,ue.properties)}),this.session.on("peerMediaMessage",function(ue){var Ei=ue.peerId,_s=ue.properties,_c=ue.messageType;ue=ue.details,_c==="FILE"?_t.emit("MessageFromPeer",{messageType:S.MessageType.FILE,size:parseInt(pa(ue.media_size),10),description:pa(ue.media_description),fileName:pa(ue.media_filename),mediaId:pa(ue.media_id),thumbnail:new Blob([ue.media_thumbnail])},Ei,_s):_c==="IMAGE"&&_t.emit("MessageFromPeer",{messageType:S.MessageType.IMAGE,size:parseInt(pa(ue.media_size),10),description:pa(ue.media_description),fileName:pa(ue.media_filename),mediaId:pa(ue.media_id),thumbnail:new Blob([ue.media_thumbnail]),height:parseInt(pa(ue.media_height),10),width:parseInt(pa(ue.media_width),10),thumbnailHeight:parseInt(pa(ue.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(ue.media_thumbnailwidth),10)},Ei,_s)}),this.session.on("peerRawMessage",function(ue){_t.emit("MessageFromPeer",{rawMessage:ue.raw,description:ue.desc,messageType:S.MessageType.RAW},ue.peerId,ue.properties)}),k.on("instanceChanged",function(ue){return C=ue}),k.on("peerOnlineStatusChanged",function(ue){var Ei=ue.instance.toString()+ue.state,_s=_t.peerStatusSeqLru.get(Ei);!_s||ue.seq.greaterThan(_s)?(_t.peerStatusSeqLru.set(Ei,ue.seq),ue.state!==_t.subscribedPeerStatusCache[ue.peerId]&&_t.emit("PeersOnlineStatusChanged",m({},ue.peerId,ue.state)),_t.subscribedPeerStatusCache[ue.peerId]=ue.state,clearTimeout(_t.peerUnreachableTimers[Ei]),ue.state===S.PeerOnlineState.UNREACHABLE&&(_t.peerUnreachableTimers[Ei]=setTimeout(function(){_t.subscribedPeerStatusCache[ue.peerId]===S.PeerOnlineState.UNREACHABLE&&(_t.subscribedPeerStatusCache[ue.peerId]=S.PeerOnlineState.ONLINE,_t.emit("PeersOnlineStatusChanged",m({},ue.peerId,S.PeerOnlineState.ONLINE)))},3e4))):_t.log("peerOnlineStatusChanged dedup for %s, %d",Ei,ue.seq.toNumber())}),k.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),k.on("channelAttributesUpdated",function(ue){var Ei=ue.channelId;ue=ue.attributeMaps;for(var _s={},_c=0;_c<ue.length;_c++){var _u=ue[_c],_d=_u.key,_l=_u.ms,nE=_u.value;if(_u=_u.origin,typeof _d!="string"||!U.isLong(_l)||typeof nE!="string"||!za(_u))break;_s[_d]=new Blob([nE]).size}_t.channelAttributesCacheLru.set(Ei,_s)}),k.on("userJoined",function(ue){if(Object.keys(_t.attributes).length!==0){if(_t.session===void 0)return;_t.session.requestSetLocalUserAttributes(_t.attributes,ue).toPromise()}if(_t.attributeDrafts.size!==0)for(var Ei=function(_u,_d){var _l=(_u=_d[_u]).attribute;_u.promise.then(function(){_t.session!==void 0&&_t.session.requestSetLocalUserAttributes(_l,ue).toPromise()})},_s=0,_c=Array.from(_t.attributeDrafts);_s<_c.length;_s++)Ei(_s,_c);Object.keys(_t.subscribedPeerStatusCache).length!==0&&k.requestSubscribePeersOnlineStatus(Object.keys(_t.subscribedPeerStatusCache))}),this.lastLoginTime=Date.now(),_n.prev=29,_n.next=32,k.loginHandler().toPromise();case 32:this.mediaTaskManager.setAuthInfo({ticket:k.connection.curOpenSockets.filter(function(ue){return ue!==void 0})[0].ticket,instance:k.instanceId,useNewDomain:.5<=Math.random(),loginOpt:k.userJoinOptions.toLong()}),_n.next=44;break;case 35:if(_n.prev=35,_n.t1=_n.catch(29),!Sa(_n.t1)){_n.next=40;break}throw this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_TIMEOUT),new db(Yd(this.name,"login",2e4),lA);case 40:if(this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_FAILURE),!sa(_n.t1)){_n.next=43;break}throw _n.t1;case 43:throw new da("Login failure",{code:Zq,originalError:_n.t1});case 44:this.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS);case 45:case"end":return _n.stop()}},f,this,[[6,10],[29,35]])}));return function(f){return h.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(h,f){var g,A=this;h===T.RECONNECTING&&(this.reconnId+=1),eb("ConnectionStateChange",{elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),newState:os[h],oldState:os[this.connectionState],reason:qD[f],sid:Xa(this.session&&this.session.instanceId||U.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},(g=this.context.config.enableCloudProxy)!==null&&g!==void 0&&g),this.connectionState===T.RECONNECTING&&h===T.CONNECTED&&(Object.keys(this.subscribedPeerStatusCache).length!==0&&this.session!==void 0&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(ba(function(C){return uc(Jk(C.userInfos,"account"),function(k){return!!k.ts})})).subscribe(function(C){C=uc(C,function(k,j){return k=k?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,A.subscribedPeerStatusCache[j]=k}),A.emit("PeersOnlineStatusChanged",C)}),this.internalEmitter.emit("RECONNECTED")),this.connectionState=h,h!==T.ABORTED&&h!==T.DISCONNECTED||(this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.joinedChannels.clear(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.session=void 0,this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.mediaTaskManager.emit("connectionStateChanged",h),this.emit("ConnectionStateChanged",h,f)}}]),e}(tb()),fa(E.prototype,"renewToken",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"renewToken"),E.prototype),fa(E.prototype,"queryPeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersOnlineStatus"),E.prototype),fa(E.prototype,"getChannelMemberCount",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelMemberCount"),E.prototype),fa(E.prototype,"setLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setLocalUserAttributes"),E.prototype),fa(E.prototype,"setChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setChannelAttributes"),E.prototype),fa(E.prototype,"addOrUpdateLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateLocalUserAttributes"),E.prototype),fa(E.prototype,"addOrUpdateChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateChannelAttributes"),E.prototype),fa(E.prototype,"deleteLocalUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteLocalUserAttributesByKeys"),E.prototype),fa(E.prototype,"deleteChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteChannelAttributesByKeys"),E.prototype),fa(E.prototype,"clearLocalUserAttributes",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"clearLocalUserAttributes"),E.prototype),fa(E.prototype,"clearChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"clearChannelAttributes"),E.prototype),fa(E.prototype,"getUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributes"),E.prototype),fa(E.prototype,"getChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributes"),E.prototype),fa(E.prototype,"getChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributesByKeys"),E.prototype),fa(E.prototype,"getUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributesByKeys"),E.prototype),fa(E.prototype,"login",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"login"),E.prototype),fa(E.prototype,"logout",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logout"),E.prototype),fa(E.prototype,"logoutSync",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logoutSync"),E.prototype),fa(E.prototype,"sendMessageToPeer",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"sendMessageToPeer"),E.prototype),fa(E.prototype,"createChannel",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createChannel"),E.prototype),fa(E.prototype,"createLocalInvitation",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createLocalInvitation"),E.prototype),fa(E.prototype,"subscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"subscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"unsubscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"unsubscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"queryPeersBySubscriptionOption",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersBySubscriptionOption"),E.prototype),fa(E.prototype,"createMessage",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMessage"),E.prototype),fa(E.prototype,"downloadMedia",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"downloadMedia"),E.prototype),fa(E.prototype,"createMediaMessageByUploading",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMediaMessageByUploading"),E.prototype),E),ps={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},qs={enableLogUpload:!1,logFilter:ps.LOG_FILTER_INFO,enableCloudProxy:!1},Zd=ua(ua({createInstance:function(o){var e=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},d=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(o))throw new I(["The %s in the arguments is invalid",Object.keys({appId:o})[0]],Nq);var h=Object.keys(e).filter(function(_t){return!(_t in qs)});if(h.length!==0)throw new I("Invalid RTM config: ".concat(h.join(", ")),Nq);var f=ua(ua({},qs),e);if(d!==void 0&&(!Array.isArray(d)||d.length===0))throw new I("Invalid area config");if(d!=null){if(!d.every(function(_t){return _t in S.LegacyAreaCode}))throw new I("Invalid area codes: ".concat(d.filter(function(_t){return!(_t in S)}).join(", ")));M=xe(d.map(function(_t){return zC[_t]}))}d=jl=Ya.__global_unique_id__=(Ya.__global_unique_id__||0)+1;var g=DC(f);h=EC(f);var A=FC(f),C=GC(d,f),k=Tr(d,f),j=k("RTM:DEBUG","<Entry> ");return Mr.rtmConfig=f,g("The Agora RTM Web SDK version is %s","1.4.3-203"),e.enableCloudProxy&&g("RTM cloud proxy enabled"),e.enableLogUpload&&g("Log upload enabled"),M&&j("Area is set to %s",Array.from(M.CODES).map(function(_t){return xf(F).find(function(_n){return F[_n]===_t})}).join(", ")),j("Creating an RtmClient instance"),j('The Git commit ID is "'.concat("v1.4.3-17-g1e27aa38",'"')),j("The App ID is %s",Um(o,4,10,"*".repeat(6))),g("The process ID is %s",gg),j("The build is %s","v1.4.3-17-g1e27aa38"),j("NODE_ENV is %s","production"),new rD(o,{genLogger:k,genTracker:C,info:g,warn:h,logError:A,loggerId:d},f,function(_t){for(var _n=0,ue=xf(_t);_n<ue.length;_n++){var Ei=ue[_n];try{var _s=_t[Ei];_s!=null&&(_t.enableCloudProxy&&g("RTM cloud proxy enabled"),_t.enableLogUpload&&g("Log upload enabled"),f[Ei]=_s)}catch{throw new I(["The %s in the arguments is invalid",Ei],void 0)}}})},BUILD:"v1.4.3-17-g1e27aa38",VERSION:"1.4.3-203",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:gg,ConnectionChangeReason:S.ConnectionChangeReason,ConnectionState:S.ConnectionState,LocalInvitationFailureReason:S.LocalInvitationFailureReason,LocalInvitationState:S.LocalInvitationState,RemoteInvitationFailureReason:S.RemoteInvitationFailureReason,RemoteInvitationState:S.RemoteInvitationState,MessageType:S.MessageType,PeerOnlineState:S.PeerOnlineState,PeerSubscriptionOption:S.PeerSubscriptionOption},ps),{},{setParameter:function(o,e){Object.keys(Nc).includes(o)&&(Nc[o]=e)},getParameter:function(o){return Nc[o]},setArea:function(o){var e=o.areaCodes;if(o=o.excludedArea,!Array.isArray(e)||e.length===0||!e.every(function(d){return d in S.AreaCode}))throw new I("Invalid area config");if(o!==void 0&&o===S.AreaCode.GLOBAL)throw new I("Excluded area cannot be global");if(o===void 0)M=xe(e.map(function(d){return F[d]}));else{if(e.includes(o))throw new I("Excluded area cannot be in areaCodes");if(!(o in F))throw new I("Invalid excludedArea:",o);M=bu({areas:e.map(function(d){return F[d]}),excludedArea:F[o]})}}});return Zd})})(agoraRtmSdk,agoraRtmSdk.exports);var agoraRtmSdkExports=agoraRtmSdk.exports;const AgoraRTM__default=getDefaultExportFromCjs(agoraRtmSdkExports);var createClient=function o(e,d,h){var f;function g(){return f||(f=AgoraRTM__default.createInstance(e,d,h)),f}return function(){return g()}},AreaCode;(function(o){o.GLOBAL="GLOBAL",o.INDIA="INDIA",o.JAPAN="JAPAN",o.ASIA="ASIA",o.EUROPE="EUROPE",o.CHINA="CHINA",o.NORTH_AMERICA="NORTH_AMERICA"})(AreaCode||(AreaCode={}));const APP_ID="83d163cf0e5c4e7a86b996057621147a",token=null,config={mode:"rtc",codec:"vp8",APP_ID,token},useRTCClient=createClient$1(config),useRTMClient=createClient(config.APP_ID),useMicrophoneAndCameraTracks=createMicrophoneAndCameraTracks();export{AgoraVideoPlayer as A,person3 as a,person1 as b,useRTMClient as c,useMicrophoneAndCameraTracks as d,config as e,person2 as p,useRTCClient as u};
