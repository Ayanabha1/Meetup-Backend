import{c as commonjsGlobal,d as getDefaultExportFromCjs,r as reactExports,R as React}from"./index-657572e1.js";const person1="/assets/person1-59094681.jpg",person3="/assets/person3-b0872c6e.jpg";var AgoraRTC_NProduction={exports:{}};(function(r,e){(function(d,h){r.exports=h()})(commonjsGlobal,function(){function d(o,s){return s.forEach(function(l){l&&typeof l!="string"&&!Array.isArray(l)&&Object.keys(l).forEach(function(p){if(p!=="default"&&!(p in o)){var _=Object.getOwnPropertyDescriptor(l,p);Object.defineProperty(o,p,_.get?_:{enumerable:!0,get:function(){return l[p]}})}})}),Object.freeze(o)}var h=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{},f=function(o){try{return!!o()}catch{return!0}},g=!f(function(){var o=function(){}.bind();return typeof o!="function"||o.hasOwnProperty("prototype")}),C=g,P=Function.prototype,x=P.bind,B=P.call,Vt=C&&x.bind(B,B),_r=C?function(o){return o&&Vt(o)}:function(o){return o&&function(){return B.apply(o,arguments)}},_e=_r({}.isPrototypeOf),_i=function(o){return o&&o.Math==Math&&o},_a=_i(typeof globalThis=="object"&&globalThis)||_i(typeof window=="object"&&window)||_i(typeof self=="object"&&self)||_i(typeof h=="object"&&h)||function(){return this}()||Function("return this")(),kc=g,_d=Function.prototype,_l=_d.apply,_h=_d.call,rE=typeof Reflect=="object"&&Reflect.apply||(kc?_h.bind(_l):function(){return _h.apply(_l,arguments)}),aE=function(o){return typeof o=="function"},yE={},gE=!f(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),bE=g,GE=Function.prototype.call,Qm=bE?GE.bind(GE):function(){return GE.apply(GE,arguments)},tE={},EE={}.propertyIsEnumerable,pE=Object.getOwnPropertyDescriptor,TE=pE&&!EE.call({1:2},1);tE.f=TE?function(o){var s=pE(this,o);return!!s&&s.enumerable}:EE;var _p,eE,cE=function(o,s){return{enumerable:!(1&o),configurable:!(2&o),writable:!(4&o),value:s}},SE=_r,AE=SE({}.toString),t_=SE("".slice),PE=function(o){return t_(AE(o),8,-1)},v_=_r,zE=f,K_=PE,GS=_a.Object,vT=v_("".split),NS=zE(function(){return!GS("z").propertyIsEnumerable(0)})?function(o){return K_(o)=="String"?vT(o,""):GS(o)}:GS,J6=_a.TypeError,P0=function(o){if(o==null)throw J6("Can't call method on "+o);return o},X6=NS,Q6=P0,nR=function(o){return X6(Q6(o))},$6=aE,uS=function(o){return typeof o=="object"?o!==null:$6(o)},rR={},hN=rR,pN=_a,Z6=aE,e1=function(o){return Z6(o)?o:void 0},PS=function(o,s){return arguments.length<2?e1(hN[o])||e1(pN[o]):hN[o]&&hN[o][s]||pN[o]&&pN[o][s]},CR=PS("navigator","userAgent")||"",n1=_a,fN=CR,r1=n1.process,i1=n1.Deno,o1=r1&&r1.versions||i1&&i1.version,s1=o1&&o1.v8;s1&&(eE=(_p=s1.split("."))[0]>0&&_p[0]<4?1:+(_p[0]+_p[1])),!eE&&fN&&(!(_p=fN.match(/Edge\/(\d+)/))||_p[1]>=74)&&(_p=fN.match(/Chrome\/(\d+)/))&&(eE=+_p[1]);var eI=eE,a1=eI,tW=f,EN=!!Object.getOwnPropertySymbols&&!tW(function(){var o=Symbol();return!String(o)||!(Object(o)instanceof Symbol)||!Symbol.sham&&a1&&a1<41}),c1=EN&&!Symbol.sham&&typeof Symbol.iterator=="symbol",eW=PS,nW=aE,rW=_e,iW=c1,oW=_a.Object,mN=iW?function(o){return typeof o=="symbol"}:function(o){var s=eW("Symbol");return nW(s)&&rW(s.prototype,oW(o))},sW=_a.String,D0=function(o){try{return sW(o)}catch{return"Object"}},aW=aE,cW=D0,uW=_a.TypeError,qS=function(o){if(aW(o))return o;throw uW(cW(o)+" is not a function")},dW=qS,_N=function(o,s){var l=o[s];return l==null?void 0:dW(l)},gN=Qm,vN=aE,yN=uS,lW=_a.TypeError,k0={exports:{}},u1=_a,hW=Object.defineProperty,pW=function(o,s){try{hW(u1,o,{value:s,configurable:!0,writable:!0})}catch{u1[o]=s}return s},d1="__core-js_shared__",bN=_a[d1]||pW(d1,{}),l1=bN;(k0.exports=function(o,s){return l1[o]||(l1[o]=s!==void 0?s:{})})("versions",[]).push({version:"3.20.3",mode:"pure",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.20.3/LICENSE",source:"https://github.com/zloirock/core-js"});var fW=P0,EW=_a.Object,iR=function(o){return EW(fW(o))},mW=iR,_W=_r({}.hasOwnProperty),DT=Object.hasOwn||function(o,s){return _W(mW(o),s)},gW=_r,vW=0,yW=Math.random(),bW=gW(1 .toString),TN=function(o){return"Symbol("+(o===void 0?"":o)+")_"+bW(++vW+yW,36)},TW=_a,SW=k0.exports,h1=DT,RW=TN,p1=EN,f1=c1,HI=SW("wks"),NR=TW.Symbol,E1=NR&&NR.for,IW=f1?NR:NR&&NR.withoutSetter||RW,Mb=function(o){if(!h1(HI,o)||!p1&&typeof HI[o]!="string"){var s="Symbol."+o;p1&&h1(NR,o)?HI[o]=NR[o]:HI[o]=f1&&E1?E1(s):IW(s)}return HI[o]},OW=Qm,m1=uS,_1=mN,AW=_N,wW=function(o,s){var l,p;if(s==="string"&&vN(l=o.toString)&&!yN(p=gN(l,o))||vN(l=o.valueOf)&&!yN(p=gN(l,o))||s!=="string"&&vN(l=o.toString)&&!yN(p=gN(l,o)))return p;throw lW("Can't convert object to primitive value")},CW=Mb,NW=_a.TypeError,PW=CW("toPrimitive"),DW=function(o,s){if(!m1(o)||_1(o))return o;var l,p=AW(o,PW);if(p){if(s===void 0&&(s="default"),l=OW(p,o,s),!m1(l)||_1(l))return l;throw NW("Can't convert object to primitive value")}return s===void 0&&(s="number"),wW(o,s)},kW=mN,L0=function(o){var s=DW(o,"string");return kW(s)?s:s+""},g1=uS,SN=_a.document,LW=g1(SN)&&g1(SN.createElement),RN=function(o){return LW?SN.createElement(o):{}},MW=RN,v1=!gE&&!f(function(){return Object.defineProperty(MW("div"),"a",{get:function(){return 7}}).a!=7}),UW=gE,xW=Qm,jW=tE,VW=cE,FW=nR,BW=L0,GW=DT,qW=v1,y1=Object.getOwnPropertyDescriptor;yE.f=UW?y1:function(o,s){if(o=FW(o),s=BW(s),qW)try{return y1(o,s)}catch{}if(GW(o,s))return VW(!xW(jW.f,o,s),o[s])};var WW=f,KW=aE,HW=/#|\.prototype\./,YI=function(o,s){var l=zW[YW(o)];return l==XW||l!=JW&&(KW(s)?WW(s):!!s)},YW=YI.normalize=function(o){return String(o).replace(HW,".").toLowerCase()},zW=YI.data={},JW=YI.NATIVE="N",XW=YI.POLYFILL="P",b1=YI,QW=qS,$W=g,ZW=_r(_r.bind),zI=function(o,s){return QW(o),s===void 0?o:$W?ZW(o,s):function(){return o.apply(s,arguments)}},yS={},T1=gE&&f(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),S1=_a,t5=uS,e5=S1.String,n5=S1.TypeError,bS=function(o){if(t5(o))return o;throw n5(e5(o)+" is not an object")},r5=gE,i5=v1,o5=T1,M0=bS,R1=L0,s5=_a.TypeError,IN=Object.defineProperty,a5=Object.getOwnPropertyDescriptor,c5="enumerable",u5="configurable",d5="writable";yS.f=r5?o5?function(o,s,l){if(M0(o),s=R1(s),M0(l),typeof o=="function"&&s==="prototype"&&"value"in l&&d5 in l&&!l.writable){var p=a5(o,s);p&&p.writable&&(o[s]=l.value,l={configurable:u5 in l?l.configurable:p.configurable,enumerable:c5 in l?l.enumerable:p.enumerable,writable:!1})}return IN(o,s,l)}:IN:function(o,s,l){if(M0(o),s=R1(s),M0(l),i5)try{return IN(o,s,l)}catch{}if("get"in l||"set"in l)throw s5("Accessors not supported");return"value"in l&&(o[s]=l.value),o};var l5=yS,h5=cE,PR=gE?function(o,s,l){return l5.f(o,s,h5(1,l))}:function(o,s,l){return o[s]=l,o},U0=_a,p5=rE,f5=_r,E5=aE,m5=yE.f,_5=b1,nI=rR,g5=zI,rI=PR,I1=DT,v5=function(o){var s=function(l,p,_){if(this instanceof s){switch(arguments.length){case 0:return new o;case 1:return new o(l);case 2:return new o(l,p)}return new o(l,p,_)}return p5(o,this,arguments)};return s.prototype=o.prototype,s},yT=function(o,s){var l,p,_,b,A,k,j,z,H=o.target,$=o.global,ue=o.stat,Ei=o.proto,Fi=$?U0:ue?U0[H]:(U0[H]||{}).prototype,Gi=$?nI:nI[H]||rI(nI,H,{})[H],_o=Gi.prototype;for(_ in s)l=!_5($?_:H+(ue?".":"#")+_,o.forced)&&Fi&&I1(Fi,_),A=Gi[_],l&&(k=o.noTargetGet?(z=m5(Fi,_))&&z.value:Fi[_]),b=l&&k?k:s[_],l&&typeof A==typeof b||(j=o.bind&&l?g5(b,U0):o.wrap&&l?v5(b):Ei&&E5(b)?f5(b):b,(o.sham||b&&b.sham||A&&A.sham)&&rI(j,"sham",!0),rI(Gi,_,j),Ei&&(I1(nI,p=H+"Prototype")||rI(nI,p,{}),rI(nI[p],_,b),o.real&&_o&&!_o[_]&&rI(_o,_,b)))},y5=Math.ceil,b5=Math.floor,ON=function(o){var s=+o;return s!=s||s===0?0:(s>0?b5:y5)(s)},T5=ON,S5=Math.min,R5=function(o){return o>0?S5(T5(o),9007199254740991):0},oR=function(o){return R5(o.length)},I5=qS,O5=iR,A5=NS,w5=oR,C5=_a.TypeError,O1=function(o){return function(s,l,p,_){I5(l);var b=O5(s),A=A5(b),k=w5(b),j=o?k-1:0,z=o?-1:1;if(p<2)for(;;){if(j in A){_=A[j],j+=z;break}if(j+=z,o?j<0:k<=j)throw C5("Reduce of empty array with no initial value")}for(;o?j>=0:k>j;j+=z)j in A&&(_=l(_,A[j],j,b));return _}},N5={left:O1(!1),right:O1(!0)},P5=f,AN=function(o,s){var l=[][o];return!!l&&P5(function(){l.call(null,s||function(){throw 1},1)})},x0=PE(_a.process)=="process",D5=N5.left,A1=eI,k5=x0;yT({target:"Array",proto:!0,forced:!AN("reduce")||!k5&&A1>79&&A1<83},{reduce:function(o){var s=arguments.length;return D5(this,o,s,s>1?arguments[1]:void 0)}});var L5=rR,sR=function(o){return L5[o+"Prototype"]},M5=sR("Array").reduce,U5=_e,x5=M5,wN=Array.prototype,w1=function(o){var s=o.reduce;return o===wN||U5(wN,o)&&s===wN.reduce?x5:s},aR=w1;let C1=!0,N1=!0;function j0(o,s,l){const p=o.match(s);return p&&p.length>=l&&parseInt(p[l],10)}function DR(o,s,l){if(!o.RTCPeerConnection)return;const p=o.RTCPeerConnection.prototype,_=p.addEventListener;p.addEventListener=function(A,k){if(A!==s)return _.apply(this,arguments);const j=z=>{const H=l(z);H&&(k.handleEvent?k.handleEvent(H):k(H))};return this._eventMap=this._eventMap||{},this._eventMap[s]||(this._eventMap[s]=new Map),this._eventMap[s].set(k,j),_.apply(this,[A,j])};const b=p.removeEventListener;p.removeEventListener=function(A,k){if(A!==s||!this._eventMap||!this._eventMap[s])return b.apply(this,arguments);if(!this._eventMap[s].has(k))return b.apply(this,arguments);const j=this._eventMap[s].get(k);return this._eventMap[s].delete(k),this._eventMap[s].size===0&&delete this._eventMap[s],Object.keys(this._eventMap).length===0&&delete this._eventMap,b.apply(this,[A,j])},Object.defineProperty(p,"on"+s,{get(){return this["_on"+s]},set(A){this["_on"+s]&&(this.removeEventListener(s,this["_on"+s]),delete this["_on"+s]),A&&this.addEventListener(s,this["_on"+s]=A)},enumerable:!0,configurable:!0})}function j5(o){return typeof o!="boolean"?new Error("Argument type: "+typeof o+". Please use a boolean."):(C1=o,o?"adapter.js logging disabled":"adapter.js logging enabled")}function V5(o){return typeof o!="boolean"?new Error("Argument type: "+typeof o+". Please use a boolean."):(N1=!o,"adapter.js deprecation warnings "+(o?"disabled":"enabled"))}function P1(){if(typeof window=="object"){if(C1)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function CN(o,s){N1&&console.warn(o+" is deprecated, please use "+s+" instead.")}function F5(o){const s={browser:null,version:null};if(o===void 0||!o.navigator)return s.browser="Not a browser.",s;const{navigator:l}=o;if(l.mozGetUserMedia)s.browser="firefox",s.version=j0(l.userAgent,/Firefox\/(\d+)\./,1);else if(l.webkitGetUserMedia||o.isSecureContext===!1&&o.webkitRTCPeerConnection)s.browser="chrome",s.version=j0(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!o.RTCPeerConnection||!l.userAgent.match(/AppleWebKit\/(\d+)\./))return s.browser="Not a supported browser.",s;s.browser="safari",s.version=j0(l.userAgent,/AppleWebKit\/(\d+)\./,1),s.supportsUnifiedPlan=o.RTCRtpTransceiver&&"currentDirection"in o.RTCRtpTransceiver.prototype}return s}function D1(o){return Object.prototype.toString.call(o)==="[object Object]"}function k1(o){var s;return D1(o)?aR(s=Object.keys(o)).call(s,function(l,p){const _=D1(o[p]),b=_?k1(o[p]):o[p],A=_&&!Object.keys(b).length;return b===void 0||A?l:Object.assign(l,{[p]:b})},{}):o}function L1(o,s,l){const p=l?"outbound-rtp":"inbound-rtp",_=new Map;if(s===null)return _;const b=[];return o.forEach(A=>{A.type==="track"&&A.trackIdentifier===s.id&&b.push(A)}),b.forEach(A=>{o.forEach(k=>{k.type===p&&k.trackId===A.id&&function j(z,H,$){H&&!$.has(H.id)&&($.set(H.id,H),Object.keys(H).forEach(ue=>{ue.endsWith("Id")?j(z,z.get(H[ue]),$):ue.endsWith("Ids")&&H[ue].forEach(Ei=>{j(z,z.get(Ei),$)})}))}(o,k,_)})}),_}var B5=k0.exports,G5=TN,M1=B5("keys"),V0=function(o){return M1[o]||(M1[o]=G5(o))},q5=!f(function(){function o(){}return o.prototype.constructor=null,Object.getPrototypeOf(new o)!==o.prototype}),W5=_a,K5=DT,H5=aE,Y5=iR,z5=q5,U1=V0("IE_PROTO"),NN=W5.Object,J5=NN.prototype,PN=z5?NN.getPrototypeOf:function(o){var s=Y5(o);if(K5(s,U1))return s[U1];var l=s.constructor;return H5(l)&&s instanceof l?l.prototype:s instanceof NN?J5:null},x1=_a,X5=aE,Q5=x1.String,$5=x1.TypeError,Z5=_r,tK=bS,eK=function(o){if(typeof o=="object"||X5(o))return o;throw $5("Can't set "+Q5(o)+" as a prototype")},nK=Object.setPrototypeOf||("__proto__"in{}?function(){var o,s=!1,l={};try{(o=Z5(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(l,[]),s=l instanceof Array}catch{}return function(p,_){return tK(p),eK(_),s?o(p,_):p.__proto__=_,p}}():void 0),F0={},rK=ON,iK=Math.max,oK=Math.min,DN=function(o,s){var l=rK(o);return l<0?iK(l+s,0):oK(l,s)},sK=nR,aK=DN,cK=oR,j1=function(o){return function(s,l,p){var _,b=sK(s),A=cK(b),k=aK(p,A);if(o&&l!=l){for(;A>k;)if((_=b[k++])!=_)return!0}else for(;A>k;k++)if((o||k in b)&&b[k]===l)return o||k||0;return!o&&-1}},uK={includes:j1(!0),indexOf:j1(!1)},B0={},kN=DT,dK=nR,lK=uK.indexOf,hK=B0,V1=_r([].push),F1=function(o,s){var l,p=dK(o),_=0,b=[];for(l in p)!kN(hK,l)&&kN(p,l)&&V1(b,l);for(;s.length>_;)kN(p,l=s[_++])&&(~lK(b,l)||V1(b,l));return b},LN=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],pK=F1,fK=LN.concat("length","prototype");F0.f=Object.getOwnPropertyNames||function(o){return pK(o,fK)};var MN={};MN.f=Object.getOwnPropertySymbols;var EK=PS,mK=F0,_K=MN,gK=bS,vK=_r([].concat),yK=EK("Reflect","ownKeys")||function(o){var s=mK.f(gK(o)),l=_K.f;return l?vK(s,l(o)):s},B1=DT,bK=yK,TK=yE,SK=yS,UN={},RK=F1,IK=LN,xN=Object.keys||function(o){return RK(o,IK)},OK=gE,AK=T1,wK=yS,CK=bS,NK=nR,PK=xN;UN.f=OK&&!AK?Object.defineProperties:function(o,s){CK(o);for(var l,p=NK(s),_=PK(s),b=_.length,A=0;b>A;)wK.f(o,l=_[A++],p[l]);return o};var G0,G1=PS("document","documentElement"),DK=bS,kK=UN,q1=LN,LK=B0,MK=G1,UK=RN,W1=V0("IE_PROTO"),jN=function(){},K1=function(o){return"<script>"+o+"<\/script>"},H1=function(o){o.write(K1("")),o.close();var s=o.parentWindow.Object;return o=null,s},q0=function(){try{G0=new ActiveXObject("htmlfile")}catch{}var o,s;q0=typeof document<"u"?document.domain&&G0?H1(G0):((s=UK("iframe")).style.display="none",MK.appendChild(s),s.src="javascript:",(o=s.contentWindow.document).open(),o.write(K1("document.F=Object")),o.close(),o.F):H1(G0);for(var l=q1.length;l--;)delete q0.prototype[q1[l]];return q0()};LK[W1]=!0;var W0=Object.create||function(o,s){var l;return o!==null?(jN.prototype=DK(o),l=new jN,jN.prototype=null,l[W1]=o):l=q0(),s===void 0?l:kK.f(l,s)},xK=_r("".replace),jK=String(Error("zxcasd").stack),Y1=/\n\s*at [^:]*:[^\n]*/,VK=Y1.test(jK),FK=uS,BK=PR,iI={},GK=iI,qK=Mb("iterator"),WK=Array.prototype,z1={};z1[Mb("toStringTag")]="z";var VN=String(z1)==="[object z]",KK=_a,HK=VN,YK=aE,K0=PE,zK=Mb("toStringTag"),JK=KK.Object,XK=K0(function(){return arguments}())=="Arguments",cR=HK?K0:function(o){var s,l,p;return o===void 0?"Undefined":o===null?"Null":typeof(l=function(_,b){try{return _[b]}catch{}}(s=JK(o),zK))=="string"?l:XK?K0(s):(p=K0(s))=="Object"&&YK(s.callee)?"Arguments":p},QK=cR,J1=_N,$K=iI,ZK=Mb("iterator"),X1=function(o){if(o!=null)return J1(o,ZK)||J1(o,"@@iterator")||$K[QK(o)]},tH=Qm,eH=qS,nH=bS,rH=D0,iH=X1,oH=_a.TypeError,sH=Qm,Q1=bS,aH=_N,cH=zI,uH=Qm,dH=bS,lH=D0,hH=function(o){return o!==void 0&&(GK.Array===o||WK[qK]===o)},pH=oR,$1=_e,fH=function(o,s){var l=arguments.length<2?iH(o):s;if(eH(l))return nH(tH(l,o));throw oH(rH(o)+" is not iterable")},EH=X1,Z1=function(o,s,l){var p,_;Q1(o);try{if(!(p=aH(o,"return"))){if(s==="throw")throw l;return l}p=sH(p,o)}catch(b){_=!0,p=b}if(s==="throw")throw l;if(_)throw p;return Q1(p),l},mH=_a.TypeError,H0=function(o,s){this.stopped=o,this.result=s},tM=H0.prototype,Y0=function(o,s,l){var p,_,b,A,k,j,z,H=l&&l.that,$=!(!l||!l.AS_ENTRIES),ue=!(!l||!l.IS_ITERATOR),Ei=!(!l||!l.INTERRUPTED),Fi=cH(s,H),Gi=function(_f){return p&&Z1(p,"normal",_f),new H0(!0,_f)},_o=function(_f){return $?(dH(_f),Ei?Fi(_f[0],_f[1],Gi):Fi(_f[0],_f[1])):Ei?Fi(_f,Gi):Fi(_f)};if(ue)p=o;else{if(!(_=EH(o)))throw mH(lH(o)+" is not iterable");if(hH(_)){for(b=0,A=pH(o);A>b;b++)if((k=_o(o[b]))&&$1(tM,k))return k;return new H0(!1)}p=fH(o,_)}for(j=p.next;!(z=uH(j,p)).done;){try{k=_o(z.value)}catch(_f){Z1(p,"throw",_f)}if(typeof k=="object"&&k&&$1(tM,k))return k}return new H0(!1)},_H=cR,gH=_a.String,oI=function(o){if(_H(o)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return gH(o)},vH=oI,yH=cE,bH=!f(function(){var o=Error("a");return!("stack"in o)||(Object.defineProperty(o,"stack",yH(1,7)),o.stack!==7)}),TH=yT,SH=_a,RH=_e,IH=PN,z0=nK,OH=function(o,s,l){for(var p=bK(s),_=SK.f,b=TK.f,A=0;A<p.length;A++){var k=p[A];B1(o,k)||l&&B1(l,k)||_(o,k,b(s,k))}},eM=W0,J0=PR,FN=cE,AH=function(o,s){if(VK&&typeof o=="string")for(;s--;)o=xK(o,Y1,"");return o},wH=function(o,s){FK(s)&&"cause"in s&&BK(o,"cause",s.cause)},CH=Y0,NH=function(o,s){return o===void 0?arguments.length<2?"":s:vH(o)},PH=bH,DH=Mb("toStringTag"),X0=SH.Error,kH=[].push,JI=function(o,s){var l,p=arguments.length>2?arguments[2]:void 0,_=RH(BN,this);z0?l=z0(new X0,_?IH(this):BN):(l=_?this:eM(BN),J0(l,DH,"Error")),s!==void 0&&J0(l,"message",NH(s)),PH&&J0(l,"stack",AH(l.stack,1)),wH(l,p);var b=[];return CH(o,kH,{that:b}),J0(l,"errors",b),l};z0?z0(JI,X0):OH(JI,X0,{name:!0});var BN=JI.prototype=eM(X0.prototype,{constructor:FN(1,JI),message:FN(1,""),name:FN(1,"AggregateError")});TH({global:!0},{AggregateError:JI});var LH=aE,GN=bN,MH=_r(Function.toString);LH(GN.inspectSource)||(GN.inspectSource=function(o){return MH(o)});var Q0,XI,$0,qN=GN.inspectSource,UH=aE,xH=qN,nM=_a.WeakMap,jH=UH(nM)&&/native code/.test(xH(nM)),rM=_a,WN=_r,VH=uS,FH=PR,KN=DT,HN=bN,BH=V0,GH=B0,iM="Object already initialized",YN=rM.TypeError,qH=rM.WeakMap;if(jH||HN.state){var kR=HN.state||(HN.state=new qH),WH=WN(kR.get),oM=WN(kR.has),KH=WN(kR.set);Q0=function(o,s){if(oM(kR,o))throw new YN(iM);return s.facade=o,KH(kR,o,s),s},XI=function(o){return WH(kR,o)||{}},$0=function(o){return oM(kR,o)}}else{var sI=BH("state");GH[sI]=!0,Q0=function(o,s){if(KN(o,sI))throw new YN(iM);return s.facade=o,FH(o,sI,s),s},XI=function(o){return KN(o,sI)?o[sI]:{}},$0=function(o){return KN(o,sI)}}var LR,sM,aM,Z0={set:Q0,get:XI,has:$0,enforce:function(o){return $0(o)?XI(o):Q0(o,{})},getterFor:function(o){return function(s){var l;if(!VH(s)||(l=XI(s)).type!==o)throw YN("Incompatible receiver, "+o+" required");return l}}},zN=gE,HH=DT,cM=Function.prototype,YH=zN&&Object.getOwnPropertyDescriptor,JN=HH(cM,"name"),uM={EXISTS:JN,PROPER:JN&&function(){}.name==="something",CONFIGURABLE:JN&&(!zN||zN&&YH(cM,"name").configurable)},zH=PR,tO=function(o,s,l,p){p&&p.enumerable?o[s]=l:zH(o,s,l)},JH=f,XH=aE,QH=W0,dM=PN,$H=tO,XN=Mb("iterator"),lM=!1;[].keys&&("next"in(aM=[].keys())?(sM=dM(dM(aM)))!==Object.prototype&&(LR=sM):lM=!0);var ZH=LR==null||JH(function(){var o={};return LR[XN].call(o)!==o});XH((LR=ZH?{}:QH(LR))[XN])||$H(LR,XN,function(){return this});var hM={IteratorPrototype:LR,BUGGY_SAFARI_ITERATORS:lM},t8=cR,e8=VN?{}.toString:function(){return"[object "+t8(this)+"]"},n8=VN,r8=yS.f,i8=PR,o8=DT,s8=e8,pM=Mb("toStringTag"),QI=function(o,s,l,p){if(o){var _=l?o:o.prototype;o8(_,pM)||r8(_,pM,{configurable:!0,value:s}),p&&!n8&&i8(_,"toString",s8)}},a8=hM.IteratorPrototype,c8=W0,u8=cE,d8=QI,l8=iI,h8=function(){return this},p8=yT,f8=Qm,E8=function(o,s,l,p){var _=s+" Iterator";return o.prototype=c8(a8,{next:u8(+!p,l)}),d8(o,_,!1,!0),l8[_]=h8,o},m8=PN,_8=QI,fM=tO,EM=iI,g8=uM.PROPER,eO=hM.BUGGY_SAFARI_ITERATORS,QN=Mb("iterator"),mM="keys",nO="values",_M="entries",v8=function(){return this},gM=function(o,s,l,p,_,b,A){E8(l,s,p);var k,j,z,H=function(_f){if(_f===_&&Gi)return Gi;if(!eO&&_f in Ei)return Ei[_f];switch(_f){case mM:case nO:case _M:return function(){return new l(this,_f)}}return function(){return new l(this)}},$=s+" Iterator",ue=!1,Ei=o.prototype,Fi=Ei[QN]||Ei["@@iterator"]||_&&Ei[_],Gi=!eO&&Fi||H(_),_o=s=="Array"&&Ei.entries||Fi;if(_o&&(k=m8(_o.call(new o)))!==Object.prototype&&k.next&&(_8(k,$,!0,!0),EM[$]=v8),g8&&_==nO&&Fi&&Fi.name!==nO&&(ue=!0,Gi=function(){return f8(Fi,this)}),_)if(j={values:H(nO),keys:b?Gi:H(mM),entries:H(_M)},A)for(z in j)(eO||ue||!(z in Ei))&&fM(Ei,z,j[z]);else p8({target:s,proto:!0,forced:eO||ue},j);return A&&Ei[QN]!==Gi&&fM(Ei,QN,Gi,{name:_}),EM[s]=Gi,j},y8=nR,vM=iI,yM=Z0;yS.f;var b8=gM,bM="Array Iterator",T8=yM.set,S8=yM.getterFor(bM);b8(Array,"Array",function(o,s){T8(this,{type:bM,target:y8(o),index:0,kind:s})},function(){var o=S8(this),s=o.target,l=o.kind,p=o.index++;return!s||p>=s.length?(o.target=void 0,{value:void 0,done:!0}):l=="keys"?{value:p,done:!1}:l=="values"?{value:s[p],done:!1}:{value:[p,s[p]],done:!1}},"values"),vM.Arguments=vM.Array;var TM=_a.Promise,R8=tO,I8=PS,O8=yS,A8=gE,SM=Mb("species"),w8=_e,C8=_a.TypeError,RM=Mb("iterator"),IM=!1;try{var N8=0,OM={next:function(){return{done:!!N8++}},return:function(){IM=!0}};OM[RM]=function(){return this},Array.from(OM,function(){throw 2})}catch{}var P8=_r,D8=f,AM=aE,k8=cR,L8=qN,wM=function(){},M8=[],CM=PS("Reflect","construct"),$N=/^\s*(?:class|function)\b/,U8=P8($N.exec),x8=!$N.exec(wM),$I=function(o){if(!AM(o))return!1;try{return CM(wM,M8,o),!0}catch{return!1}},NM=function(o){if(!AM(o))return!1;switch(k8(o)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return x8||!!U8($N,L8(o))}catch{return!0}};NM.sham=!0;var ZI,aI,PM,ZN,tP=!CM||D8(function(){var o;return $I($I.call)||!$I(Object)||!$I(function(){o=!0})||o})?NM:$I,j8=tP,V8=D0,F8=_a.TypeError,DM=bS,B8=function(o){if(j8(o))return o;throw F8(V8(o)+" is not a constructor")},G8=Mb("species"),kM=function(o,s){var l,p=DM(o).constructor;return p===void 0||(l=DM(p)[G8])==null?s:B8(l)},eP=_r([].slice),LM=/(?:ipad|iphone|ipod).*applewebkit/i.test(CR),XT=_a,q8=rE,W8=zI,MM=aE,K8=DT,H8=f,UM=G1,Y8=eP,xM=RN,z8=LM,J8=x0,nP=XT.setImmediate,rP=XT.clearImmediate,X8=XT.process,iP=XT.Dispatch,Q8=XT.Function,jM=XT.MessageChannel,$8=XT.String,oP=0,t0={},Z8="onreadystatechange";try{ZI=XT.location}catch{}var sP=function(o){if(K8(t0,o)){var s=t0[o];delete t0[o],s()}},aP=function(o){return function(){sP(o)}},VM=function(o){sP(o.data)},FM=function(o){XT.postMessage($8(o),ZI.protocol+"//"+ZI.host)};nP&&rP||(nP=function(o){var s=Y8(arguments,1);return t0[++oP]=function(){q8(MM(o)?o:Q8(o),void 0,s)},aI(oP),oP},rP=function(o){delete t0[o]},J8?aI=function(o){X8.nextTick(aP(o))}:iP&&iP.now?aI=function(o){iP.now(aP(o))}:jM&&!z8?(ZN=(PM=new jM).port2,PM.port1.onmessage=VM,aI=W8(ZN.postMessage,ZN)):XT.addEventListener&&MM(XT.postMessage)&&!XT.importScripts&&ZI&&ZI.protocol!=="file:"&&!H8(FM)?(aI=FM,XT.addEventListener("message",VM,!1)):aI=Z8 in xM("script")?function(o){UM.appendChild(xM("script")).onreadystatechange=function(){UM.removeChild(this),sP(o)}}:function(o){setTimeout(aP(o),0)});var e0,MR,n0,cI,cP,uP,dP,BM,GM={set:nP,clear:rP},tY=_a,eY=/ipad|iphone|ipod/i.test(CR)&&tY.Pebble!==void 0,nY=/web0s(?!.*chrome)/i.test(CR),UR=_a,qM=zI,rY=yE.f,lP=GM.set,iY=LM,oY=eY,sY=nY,hP=x0,WM=UR.MutationObserver||UR.WebKitMutationObserver,KM=UR.document,HM=UR.process,rO=UR.Promise,YM=rY(UR,"queueMicrotask"),zM=YM&&YM.value;zM||(e0=function(){var o,s;for(hP&&(o=HM.domain)&&o.exit();MR;){s=MR.fn,MR=MR.next;try{s()}catch(l){throw MR?cI():n0=void 0,l}}n0=void 0,o&&o.enter()},iY||hP||sY||!WM||!KM?!oY&&rO&&rO.resolve?((dP=rO.resolve(void 0)).constructor=rO,BM=qM(dP.then,dP),cI=function(){BM(e0)}):hP?cI=function(){HM.nextTick(e0)}:(lP=qM(lP,UR),cI=function(){lP(e0)}):(cP=!0,uP=KM.createTextNode(""),new WM(e0).observe(uP,{characterData:!0}),cI=function(){uP.data=cP=!cP}));var aY=zM||function(o){var s={fn:o,next:void 0};n0&&(n0.next=s),MR||(MR=s,cI()),n0=s},uI={},JM=qS,cY=function(o){var s,l;this.promise=new o(function(p,_){if(s!==void 0||l!==void 0)throw TypeError("Bad Promise constructor");s=p,l=_}),this.resolve=JM(s),this.reject=JM(l)};uI.f=function(o){return new cY(o)};var uY=bS,dY=uS,lY=uI,XM=function(o,s){if(uY(o),dY(s)&&s.constructor===o)return s;var l=lY.f(o);return(0,l.resolve)(s),l.promise},hY=_a,iO=function(o){try{return{error:!1,value:o()}}catch(s){return{error:!0,value:s}}},QM=function(){this.head=null,this.tail=null};QM.prototype={add:function(o){var s={item:o,next:null};this.head?this.tail.next=s:this.head=s,this.tail=s},get:function(){var o=this.head;if(o)return this.head=o.next,this.tail===o&&(this.tail=null),o.item}};var pP,$M,fP,pY=typeof window=="object",oO=yT,KS=_a,fY=PS,uR=Qm,EP=TM,EY=function(o,s,l){for(var p in s)l&&l.unsafe&&o[p]?o[p]=s[p]:R8(o,p,s[p],l);return o},mY=QI,_Y=function(o){var s=I8(o),l=O8.f;A8&&s&&!s[SM]&&l(s,SM,{configurable:!0,get:function(){return this}})},mP=qS,sO=aE,gY=uS,vY=function(o,s){if(w8(s,o))return o;throw C8("Incorrect invocation")},yY=qN,ZM=Y0,bY=function(o,s){if(!s&&!IM)return!1;var l=!1;try{var p={};p[RM]=function(){return{next:function(){return{done:l=!0}}}},o(p)}catch{}return l},TY=kM,tU=GM.set,_P=aY,SY=XM,RY=function(o,s){var l=hY.console;l&&l.error&&(arguments.length==1?l.error(o):l.error(o,s))},eU=uI,gP=iO,IY=QM,vP=Z0,OY=b1,AY=pY,aO=x0,nU=eI,wY=Mb("species"),DS="Promise",rU=vP.getterFor(DS),CY=vP.set,NY=vP.getterFor(DS),PY=EP&&EP.prototype,kS=EP,cO=PY,iU=KS.TypeError,yP=KS.document,bP=KS.process,dI=eU.f,DY=dI,kY=!!(yP&&yP.createEvent&&KS.dispatchEvent),oU=sO(KS.PromiseRejectionEvent),sU="unhandledrejection",uO=OY(DS,function(){var o=yY(kS),s=o!==String(kS);if(!s&&nU===66||!cO.finally)return!0;if(nU>=51&&/native code/.test(o))return!1;var l=new kS(function(_){_(1)}),p=function(_){_(function(){},function(){})};return(l.constructor={})[wY]=p,!(l.then(function(){})instanceof p)||!s&&AY&&!oU}),LY=uO||!bY(function(o){kS.all(o).catch(function(){})}),aU=function(o){var s;return!(!gY(o)||!sO(s=o.then))&&s},cU=function(o,s){var l,p,_,b=s.value,A=s.state==1,k=A?o.ok:o.fail,j=o.resolve,z=o.reject,H=o.domain;try{k?(A||(s.rejection===2&&UY(s),s.rejection=1),k===!0?l=b:(H&&H.enter(),l=k(b),H&&(H.exit(),_=!0)),l===o.promise?z(iU("Promise-chain cycle")):(p=aU(l))?uR(p,l,j,z):j(l)):z(b)}catch($){H&&!_&&H.exit(),z($)}},uU=function(o,s){o.notified||(o.notified=!0,_P(function(){for(var l,p=o.reactions;l=p.get();)cU(l,o);o.notified=!1,s&&!o.rejection&&MY(o)}))},dU=function(o,s,l){var p,_;kY?((p=yP.createEvent("Event")).promise=s,p.reason=l,p.initEvent(o,!1,!0),KS.dispatchEvent(p)):p={promise:s,reason:l},!oU&&(_=KS["on"+o])?_(p):o===sU&&RY("Unhandled promise rejection",l)},MY=function(o){uR(tU,KS,function(){var s,l=o.facade,p=o.value;if(lU(o)&&(s=gP(function(){aO?bP.emit("unhandledRejection",p,l):dU(sU,l,p)}),o.rejection=aO||lU(o)?2:1,s.error))throw s.value})},lU=function(o){return o.rejection!==1&&!o.parent},UY=function(o){uR(tU,KS,function(){var s=o.facade;aO?bP.emit("rejectionHandled",s):dU("rejectionhandled",s,o.value)})},lI=function(o,s,l){return function(p){o(s,p,l)}},hI=function(o,s,l){o.done||(o.done=!0,l&&(o=l),o.value=s,o.state=2,uU(o,!0))},TP=function(o,s,l){if(!o.done){o.done=!0,l&&(o=l);try{if(o.facade===s)throw iU("Promise can't be resolved itself");var p=aU(s);p?_P(function(){var _={done:!1};try{uR(p,s,lI(TP,_,o),lI(hI,_,o))}catch(b){hI(_,b,o)}}):(o.value=s,o.state=1,uU(o,!1))}catch(_){hI({done:!1},_,o)}}};uO&&(cO=(kS=function(o){vY(this,cO),mP(o),uR(pP,this);var s=rU(this);try{o(lI(TP,s),lI(hI,s))}catch(l){hI(s,l)}}).prototype,(pP=function(o){CY(this,{type:DS,done:!1,notified:!1,parent:!1,reactions:new IY,rejection:!1,state:0,value:void 0})}).prototype=EY(cO,{then:function(o,s){var l=NY(this),p=dI(TY(this,kS));return l.parent=!0,p.ok=!sO(o)||o,p.fail=sO(s)&&s,p.domain=aO?bP.domain:void 0,l.state==0?l.reactions.add(p):_P(function(){cU(p,l)}),p.promise},catch:function(o){return this.then(void 0,o)}}),$M=function(){var o=new pP,s=rU(o);this.promise=o,this.resolve=lI(TP,s),this.reject=lI(hI,s)},eU.f=dI=function(o){return o===kS||o===fP?new $M(o):DY(o)}),oO({global:!0,wrap:!0,forced:uO},{Promise:kS}),mY(kS,DS,!1,!0),_Y(DS),fP=fY(DS),oO({target:DS,stat:!0,forced:uO},{reject:function(o){var s=dI(this);return uR(s.reject,void 0,o),s.promise}}),oO({target:DS,stat:!0,forced:!0},{resolve:function(o){return SY(this===fP?kS:this,o)}}),oO({target:DS,stat:!0,forced:LY},{all:function(o){var s=this,l=dI(s),p=l.resolve,_=l.reject,b=gP(function(){var A=mP(s.resolve),k=[],j=0,z=1;ZM(o,function(H){var $=j++,ue=!1;z++,uR(A,s,H).then(function(Ei){ue||(ue=!0,k[$]=Ei,--z||p(k))},_)}),--z||p(k)});return b.error&&_(b.value),l.promise},race:function(o){var s=this,l=dI(s),p=l.reject,_=gP(function(){var b=mP(s.resolve);ZM(o,function(A){uR(b,s,A).then(l.resolve,p)})});return _.error&&p(_.value),l.promise}});var xY=Qm,jY=qS,VY=uI,FY=iO,BY=Y0;yT({target:"Promise",stat:!0},{allSettled:function(o){var s=this,l=VY.f(s),p=l.resolve,_=l.reject,b=FY(function(){var A=jY(s.resolve),k=[],j=0,z=1;BY(o,function(H){var $=j++,ue=!1;z++,xY(A,s,H).then(function(Ei){ue||(ue=!0,k[$]={status:"fulfilled",value:Ei},--z||p(k))},function(Ei){ue||(ue=!0,k[$]={status:"rejected",reason:Ei},--z||p(k))})}),--z||p(k)});return b.error&&_(b.value),l.promise}});var GY=qS,qY=PS,WY=Qm,KY=uI,HY=iO,YY=Y0,hU="No one promise resolved";yT({target:"Promise",stat:!0},{any:function(o){var s=this,l=qY("AggregateError"),p=KY.f(s),_=p.resolve,b=p.reject,A=HY(function(){var k=GY(s.resolve),j=[],z=0,H=1,$=!1;YY(o,function(ue){var Ei=z++,Fi=!1;H++,WY(k,s,ue).then(function(Gi){Fi||$||($=!0,_(Gi))},function(Gi){Fi||$||(Fi=!0,j[Ei]=Gi,--H||b(new l(j,hU)))})}),--H||b(new l(j,hU))});return A.error&&b(A.value),p.promise}});var pU=TM,zY=PS,JY=aE,XY=kM,fU=XM;yT({target:"Promise",proto:!0,real:!0,forced:!!pU&&f(function(){pU.prototype.finally.call({then:function(){}},function(){})})},{finally:function(o){var s=XY(this,zY("Promise")),l=JY(o);return this.then(l?function(p){return fU(s,o()).then(function(){return p})}:o,l?function(p){return fU(s,o()).then(function(){throw p})}:o)}});var SP=_r,QY=ON,$Y=oI,ZY=P0,_z=SP("".charAt),EU=SP("".charCodeAt),tJ=SP("".slice),mU=function(o){return function(s,l){var p,_,b=$Y(ZY(s)),A=QY(l),k=b.length;return A<0||A>=k?o?"":void 0:(p=EU(b,A))<55296||p>56319||A+1===k||(_=EU(b,A+1))<56320||_>57343?o?_z(b,A):p:o?tJ(b,A,A+2):_-56320+(p-55296<<10)+65536}},eJ={codeAt:mU(!1),charAt:mU(!0)}.charAt,nJ=oI,_U=Z0,rJ=gM,gU="String Iterator",iJ=_U.set,oJ=_U.getterFor(gU);rJ(String,"String",function(o){iJ(this,{type:gU,string:nJ(o),index:0})},function(){var o,s=oJ(this),l=s.string,p=s.index;return p>=l.length?{value:void 0,done:!0}:(o=eJ(l,p),s.index+=o.length,{value:o,done:!1})});var sJ=rR.Promise,aJ={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},cJ=_a,uJ=cR,dJ=PR,vU=iI,yU=Mb("toStringTag");for(var RP in aJ){var bU=cJ[RP],IP=bU&&bU.prototype;IP&&uJ(IP)!==yU&&dJ(IP,yU,RP),vU[RP]=vU.Array}var TU=sJ,RE=TU;const SU=P1;function RU(o,s){const l=o&&o.navigator;if(!l.mediaDevices)return;const p=function(A){if(typeof A!="object"||A.mandatory||A.optional)return A;const k={};return Object.keys(A).forEach(j=>{if(j==="require"||j==="advanced"||j==="mediaSource")return;const z=typeof A[j]=="object"?A[j]:{ideal:A[j]};z.exact!==void 0&&typeof z.exact=="number"&&(z.min=z.max=z.exact);const H=function($,ue){return $?$+ue.charAt(0).toUpperCase()+ue.slice(1):ue==="deviceId"?"sourceId":ue};if(z.ideal!==void 0){k.optional=k.optional||[];let $={};typeof z.ideal=="number"?($[H("min",j)]=z.ideal,k.optional.push($),$={},$[H("max",j)]=z.ideal,k.optional.push($)):($[H("",j)]=z.ideal,k.optional.push($))}z.exact!==void 0&&typeof z.exact!="number"?(k.mandatory=k.mandatory||{},k.mandatory[H("",j)]=z.exact):["min","max"].forEach($=>{z[$]!==void 0&&(k.mandatory=k.mandatory||{},k.mandatory[H($,j)]=z[$])})}),A.advanced&&(k.optional=(k.optional||[]).concat(A.advanced)),k},_=function(A,k){if(s.version>=61)return k(A);if((A=JSON.parse(JSON.stringify(A)))&&typeof A.audio=="object"){const j=function(z,H,$){H in z&&!($ in z)&&(z[$]=z[H],delete z[H])};j((A=JSON.parse(JSON.stringify(A))).audio,"autoGainControl","googAutoGainControl"),j(A.audio,"noiseSuppression","googNoiseSuppression"),A.audio=p(A.audio)}if(A&&typeof A.video=="object"){let j=A.video.facingMode;j=j&&(typeof j=="object"?j:{ideal:j});const z=s.version<66;if(j&&(j.exact==="user"||j.exact==="environment"||j.ideal==="user"||j.ideal==="environment")&&(!l.mediaDevices.getSupportedConstraints||!l.mediaDevices.getSupportedConstraints().facingMode||z)){let H;if(delete A.video.facingMode,j.exact==="environment"||j.ideal==="environment"?H=["back","rear"]:j.exact!=="user"&&j.ideal!=="user"||(H=["front"]),H)return l.mediaDevices.enumerateDevices().then($=>{let ue=($=$.filter(Ei=>Ei.kind==="videoinput")).find(Ei=>H.some(Fi=>Ei.label.toLowerCase().includes(Fi)));return!ue&&$.length&&H.includes("back")&&(ue=$[$.length-1]),ue&&(A.video.deviceId=j.exact?{exact:ue.deviceId}:{ideal:ue.deviceId}),A.video=p(A.video),SU("chrome: "+JSON.stringify(A)),k(A)})}A.video=p(A.video)}return SU("chrome: "+JSON.stringify(A)),k(A)},b=function(A){return s.version>=64?A:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[A.name]||A.name,message:A.message,constraint:A.constraint||A.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(l.getUserMedia=function(A,k,j){_(A,z=>{l.webkitGetUserMedia(z,k,H=>{j&&j(b(H))})})}.bind(l),l.mediaDevices.getUserMedia){const A=l.mediaDevices.getUserMedia.bind(l.mediaDevices);l.mediaDevices.getUserMedia=function(k){return _(k,j=>A(j).then(z=>{if(j.audio&&!z.getAudioTracks().length||j.video&&!z.getVideoTracks().length)throw z.getTracks().forEach(H=>{H.stop()}),new DOMException("","NotFoundError");return z},z=>RE.reject(b(z))))}}}function IU(o){o.MediaStream=o.MediaStream||o.webkitMediaStream}function OU(o){if(typeof o=="object"&&o.RTCPeerConnection&&!("ontrack"in o.RTCPeerConnection.prototype)){Object.defineProperty(o.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(l){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=l)},enumerable:!0,configurable:!0});const s=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=l=>{l.stream.addEventListener("addtrack",p=>{let _;_=o.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(A=>A.track&&A.track.id===p.track.id):{track:p.track};const b=new Event("track");b.track=p.track,b.receiver=_,b.transceiver={receiver:_},b.streams=[l.stream],this.dispatchEvent(b)}),l.stream.getTracks().forEach(p=>{let _;_=o.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(A=>A.track&&A.track.id===p.id):{track:p};const b=new Event("track");b.track=p,b.receiver=_,b.transceiver={receiver:_},b.streams=[l.stream],this.dispatchEvent(b)})},this.addEventListener("addstream",this._ontrackpoly)),s.apply(this,arguments)}}else DR(o,"track",s=>(s.transceiver||Object.defineProperty(s,"transceiver",{value:{receiver:s.receiver}}),s))}function AU(o){if(typeof o=="object"&&o.RTCPeerConnection&&!("getSenders"in o.RTCPeerConnection.prototype)&&"createDTMFSender"in o.RTCPeerConnection.prototype){const s=function(_,b){return{track:b,get dtmf(){return this._dtmf===void 0&&(b.kind==="audio"?this._dtmf=_.createDTMFSender(b):this._dtmf=null),this._dtmf},_pc:_}};if(!o.RTCPeerConnection.prototype.getSenders){o.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const _=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addTrack=function(A,k){let j=_.apply(this,arguments);return j||(j=s(this,A),this._senders.push(j)),j};const b=o.RTCPeerConnection.prototype.removeTrack;o.RTCPeerConnection.prototype.removeTrack=function(A){b.apply(this,arguments);const k=this._senders.indexOf(A);k!==-1&&this._senders.splice(k,1)}}const l=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(_){this._senders=this._senders||[],l.apply(this,[_]),_.getTracks().forEach(b=>{this._senders.push(s(this,b))})};const p=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(_){this._senders=this._senders||[],p.apply(this,[_]),_.getTracks().forEach(b=>{const A=this._senders.find(k=>k.track===b);A&&this._senders.splice(this._senders.indexOf(A),1)})}}else if(typeof o=="object"&&o.RTCPeerConnection&&"getSenders"in o.RTCPeerConnection.prototype&&"createDTMFSender"in o.RTCPeerConnection.prototype&&o.RTCRtpSender&&!("dtmf"in o.RTCRtpSender.prototype)){const s=o.RTCPeerConnection.prototype.getSenders;o.RTCPeerConnection.prototype.getSenders=function(){const l=s.apply(this,[]);return l.forEach(p=>p._pc=this),l},Object.defineProperty(o.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function wU(o){if(!o.RTCPeerConnection)return;const s=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){const[l,p,_]=arguments;if(arguments.length>0&&typeof l=="function")return s.apply(this,arguments);if(s.length===0&&(arguments.length===0||typeof l!="function"))return s.apply(this,[]);const b=function(k){const j={};return k.result().forEach(z=>{const H={id:z.id,timestamp:z.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[z.type]||z.type};z.names().forEach($=>{H[$]=z.stat($)}),j[H.id]=H}),j},A=function(k){return new Map(Object.keys(k).map(j=>[j,k[j]]))};if(arguments.length>=2){const k=function(j){p(A(b(j)))};return s.apply(this,[k,l])}return new RE((k,j)=>{s.apply(this,[function(z){k(A(b(z)))},j])}).then(p,_)}}function CU(o){if(!(typeof o=="object"&&o.RTCPeerConnection&&o.RTCRtpSender&&o.RTCRtpReceiver))return;if(!("getStats"in o.RTCRtpSender.prototype)){const l=o.RTCPeerConnection.prototype.getSenders;l&&(o.RTCPeerConnection.prototype.getSenders=function(){const _=l.apply(this,[]);return _.forEach(b=>b._pc=this),_});const p=o.RTCPeerConnection.prototype.addTrack;p&&(o.RTCPeerConnection.prototype.addTrack=function(){const _=p.apply(this,arguments);return _._pc=this,_}),o.RTCRtpSender.prototype.getStats=function(){const _=this;return this._pc.getStats().then(b=>L1(b,_.track,!0))}}if(!("getStats"in o.RTCRtpReceiver.prototype)){const l=o.RTCPeerConnection.prototype.getReceivers;l&&(o.RTCPeerConnection.prototype.getReceivers=function(){const p=l.apply(this,[]);return p.forEach(_=>_._pc=this),p}),DR(o,"track",p=>(p.receiver._pc=p.srcElement,p)),o.RTCRtpReceiver.prototype.getStats=function(){const p=this;return this._pc.getStats().then(_=>L1(_,p.track,!1))}}if(!("getStats"in o.RTCRtpSender.prototype)||!("getStats"in o.RTCRtpReceiver.prototype))return;const s=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof o.MediaStreamTrack){const l=arguments[0];let p,_,b;return this.getSenders().forEach(A=>{A.track===l&&(p?b=!0:p=A)}),this.getReceivers().forEach(A=>(A.track===l&&(_?b=!0:_=A),A.track===l)),b||p&&_?RE.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):p?p.getStats():_?_.getStats():RE.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return s.apply(this,arguments)}}function NU(o){o.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(b=>this._shimmedLocalStreams[b][0])};const s=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addTrack=function(b,A){if(!A)return s.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const k=s.apply(this,arguments);return this._shimmedLocalStreams[A.id]?this._shimmedLocalStreams[A.id].indexOf(k)===-1&&this._shimmedLocalStreams[A.id].push(k):this._shimmedLocalStreams[A.id]=[A,k],k};const l=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(b){this._shimmedLocalStreams=this._shimmedLocalStreams||{},b.getTracks().forEach(j=>{if(this.getSenders().find(z=>z.track===j))throw new DOMException("Track already exists.","InvalidAccessError")});const A=this.getSenders();l.apply(this,arguments);const k=this.getSenders().filter(j=>A.indexOf(j)===-1);this._shimmedLocalStreams[b.id]=[b].concat(k)};const p=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(b){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[b.id],p.apply(this,arguments)};const _=o.RTCPeerConnection.prototype.removeTrack;o.RTCPeerConnection.prototype.removeTrack=function(b){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},b&&Object.keys(this._shimmedLocalStreams).forEach(A=>{const k=this._shimmedLocalStreams[A].indexOf(b);k!==-1&&this._shimmedLocalStreams[A].splice(k,1),this._shimmedLocalStreams[A].length===1&&delete this._shimmedLocalStreams[A]}),_.apply(this,arguments)}}function PU(o,s){if(!o.RTCPeerConnection)return;if(o.RTCPeerConnection.prototype.addTrack&&s.version>=65)return NU(o);const l=o.RTCPeerConnection.prototype.getLocalStreams;o.RTCPeerConnection.prototype.getLocalStreams=function(){const z=l.apply(this);return this._reverseStreams=this._reverseStreams||{},z.map(H=>this._reverseStreams[H.id])};const p=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(z){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},z.getTracks().forEach(H=>{if(this.getSenders().find($=>$.track===H))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[z.id]){const H=new o.MediaStream(z.getTracks());this._streams[z.id]=H,this._reverseStreams[H.id]=z,z=H}p.apply(this,[z])};const _=o.RTCPeerConnection.prototype.removeStream;function b(z,H){let $=H.sdp;return Object.keys(z._reverseStreams||[]).forEach(ue=>{const Ei=z._reverseStreams[ue],Fi=z._streams[Ei.id];$=$.replace(new RegExp(Fi.id,"g"),Ei.id)}),new RTCSessionDescription({type:H.type,sdp:$})}function A(z,H){let $=H.sdp;return Object.keys(z._reverseStreams||[]).forEach(ue=>{const Ei=z._reverseStreams[ue],Fi=z._streams[Ei.id];$=$.replace(new RegExp(Ei.id,"g"),Fi.id)}),new RTCSessionDescription({type:H.type,sdp:$})}o.RTCPeerConnection.prototype.removeStream=function(z){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.apply(this,[this._streams[z.id]||z]),delete this._reverseStreams[this._streams[z.id]?this._streams[z.id].id:z.id],delete this._streams[z.id]},o.RTCPeerConnection.prototype.addTrack=function(z,H){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const $=[].slice.call(arguments,1);if($.length!==1||!$[0].getTracks().find(Fi=>Fi===z))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(Fi=>Fi.track===z))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const Ei=this._streams[H.id];if(Ei)Ei.addTrack(z),RE.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const Fi=new o.MediaStream([z]);this._streams[H.id]=Fi,this._reverseStreams[Fi.id]=H,this.addStream(Fi)}return this.getSenders().find(Fi=>Fi.track===z)},["createOffer","createAnswer"].forEach(function(z){const H=o.RTCPeerConnection.prototype[z],$={[z](){const ue=arguments;return arguments.length&&typeof arguments[0]=="function"?H.apply(this,[Ei=>{const Fi=b(this,Ei);ue[0].apply(null,[Fi])},Ei=>{ue[1]&&ue[1].apply(null,Ei)},arguments[2]]):H.apply(this,arguments).then(Ei=>b(this,Ei))}};o.RTCPeerConnection.prototype[z]=$[z]});const k=o.RTCPeerConnection.prototype.setLocalDescription;o.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=A(this,arguments[0]),k.apply(this,arguments)):k.apply(this,arguments)};const j=Object.getOwnPropertyDescriptor(o.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(o.RTCPeerConnection.prototype,"localDescription",{get(){const z=j.get.apply(this);return z.type===""?z:b(this,z)}}),o.RTCPeerConnection.prototype.removeTrack=function(z){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!z._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(z._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let H;this._streams=this._streams||{},Object.keys(this._streams).forEach($=>{this._streams[$].getTracks().find(ue=>z.track===ue)&&(H=this._streams[$])}),H&&(H.getTracks().length===1?this.removeStream(this._reverseStreams[H.id]):H.removeTrack(z.track),this.dispatchEvent(new Event("negotiationneeded")))}}function OP(o,s){!o.RTCPeerConnection&&o.webkitRTCPeerConnection&&(o.RTCPeerConnection=o.webkitRTCPeerConnection),o.RTCPeerConnection&&s.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(l){const p=o.RTCPeerConnection.prototype[l],_={[l](){return arguments[0]=new(l==="addIceCandidate"?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),p.apply(this,arguments)}};o.RTCPeerConnection.prototype[l]=_[l]})}function DU(o,s){DR(o,"negotiationneeded",l=>{const p=l.target;if(!(s.version<72||p.getConfiguration&&p.getConfiguration().sdpSemantics==="plan-b")||p.signalingState==="stable")return l})}var kU=Object.freeze({__proto__:null,shimMediaStream:IU,shimOnTrack:OU,shimGetSendersWithDtmf:AU,shimGetStats:wU,shimSenderReceiverGetStats:CU,shimAddTrackRemoveTrackWithNative:NU,shimAddTrackRemoveTrack:PU,shimPeerConnection:OP,fixNegotiationNeeded:DU,shimGetUserMedia:RU,shimGetDisplayMedia:function(o,s){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&(typeof s=="function"?o.navigator.mediaDevices.getDisplayMedia=function(l){return s(l).then(p=>{const _=l.video&&l.video.width,b=l.video&&l.video.height,A=l.video&&l.video.frameRate;return l.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:p,maxFrameRate:A||3}},_&&(l.video.mandatory.maxWidth=_),b&&(l.video.mandatory.maxHeight=b),o.navigator.mediaDevices.getUserMedia(l)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function LU(o,s){const l=o&&o.navigator,p=o&&o.MediaStreamTrack;if(l.getUserMedia=function(_,b,A){CN("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),l.mediaDevices.getUserMedia(_).then(b,A)},!(s.version>55&&"autoGainControl"in l.mediaDevices.getSupportedConstraints())){const _=function(A,k,j){k in A&&!(j in A)&&(A[j]=A[k],delete A[k])},b=l.mediaDevices.getUserMedia.bind(l.mediaDevices);if(l.mediaDevices.getUserMedia=function(A){return typeof A=="object"&&typeof A.audio=="object"&&(A=JSON.parse(JSON.stringify(A)),_(A.audio,"autoGainControl","mozAutoGainControl"),_(A.audio,"noiseSuppression","mozNoiseSuppression")),b(A)},p&&p.prototype.getSettings){const A=p.prototype.getSettings;p.prototype.getSettings=function(){const k=A.apply(this,arguments);return _(k,"mozAutoGainControl","autoGainControl"),_(k,"mozNoiseSuppression","noiseSuppression"),k}}if(p&&p.prototype.applyConstraints){const A=p.prototype.applyConstraints;p.prototype.applyConstraints=function(k){return this.kind==="audio"&&typeof k=="object"&&(k=JSON.parse(JSON.stringify(k)),_(k,"autoGainControl","mozAutoGainControl"),_(k,"noiseSuppression","mozNoiseSuppression")),A.apply(this,[k])}}}}function MU(o){typeof o=="object"&&o.RTCTrackEvent&&"receiver"in o.RTCTrackEvent.prototype&&!("transceiver"in o.RTCTrackEvent.prototype)&&Object.defineProperty(o.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function AP(o,s){if(typeof o!="object"||!o.RTCPeerConnection&&!o.mozRTCPeerConnection)return;!o.RTCPeerConnection&&o.mozRTCPeerConnection&&(o.RTCPeerConnection=o.mozRTCPeerConnection),s.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(_){const b=o.RTCPeerConnection.prototype[_],A={[_](){return arguments[0]=new(_==="addIceCandidate"?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),b.apply(this,arguments)}};o.RTCPeerConnection.prototype[_]=A[_]});const l={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},p=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){const[_,b,A]=arguments;return p.apply(this,[_||null]).then(k=>{if(s.version<53&&!b)try{k.forEach(j=>{j.type=l[j.type]||j.type})}catch(j){if(j.name!=="TypeError")throw j;k.forEach((z,H)=>{k.set(H,Object.assign({},z,{type:l[z.type]||z.type}))})}return k}).then(b,A)}}function UU(o){if(typeof o!="object"||!o.RTCPeerConnection||!o.RTCRtpSender||o.RTCRtpSender&&"getStats"in o.RTCRtpSender.prototype)return;const s=o.RTCPeerConnection.prototype.getSenders;s&&(o.RTCPeerConnection.prototype.getSenders=function(){const p=s.apply(this,[]);return p.forEach(_=>_._pc=this),p});const l=o.RTCPeerConnection.prototype.addTrack;l&&(o.RTCPeerConnection.prototype.addTrack=function(){const p=l.apply(this,arguments);return p._pc=this,p}),o.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):RE.resolve(new Map)}}function xU(o){if(typeof o!="object"||!o.RTCPeerConnection||!o.RTCRtpSender||o.RTCRtpSender&&"getStats"in o.RTCRtpReceiver.prototype)return;const s=o.RTCPeerConnection.prototype.getReceivers;s&&(o.RTCPeerConnection.prototype.getReceivers=function(){const l=s.apply(this,[]);return l.forEach(p=>p._pc=this),l}),DR(o,"track",l=>(l.receiver._pc=l.srcElement,l)),o.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function jU(o){o.RTCPeerConnection&&!("removeStream"in o.RTCPeerConnection.prototype)&&(o.RTCPeerConnection.prototype.removeStream=function(s){CN("removeStream","removeTrack"),this.getSenders().forEach(l=>{l.track&&s.getTracks().includes(l.track)&&this.removeTrack(l)})})}function VU(o){o.DataChannel&&!o.RTCDataChannel&&(o.RTCDataChannel=o.DataChannel)}function FU(o){if(typeof o!="object"||!o.RTCPeerConnection)return;const s=o.RTCPeerConnection.prototype.addTransceiver;s&&(o.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let l=arguments[1]&&arguments[1].sendEncodings;l===void 0&&(l=[]),l=[...l];const p=l.length>0;p&&l.forEach(b=>{if("rid"in b&&!/^[a-z0-9]{0,16}$/i.test(b.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in b&&!(parseFloat(b.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in b&&!(parseFloat(b.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const _=s.apply(this,arguments);if(p){const{sender:b}=_,A=b.getParameters();(!("encodings"in A)||A.encodings.length===1&&Object.keys(A.encodings[0]).length===0)&&(A.encodings=l,b.sendEncodings=l,this.setParametersPromises.push(b.setParameters(A).then(()=>{delete b.sendEncodings}).catch(()=>{delete b.sendEncodings})))}return _})}function BU(o){if(typeof o!="object"||!o.RTCRtpSender)return;const s=o.RTCRtpSender.prototype.getParameters;s&&(o.RTCRtpSender.prototype.getParameters=function(){const l=s.apply(this,arguments);return"encodings"in l||(l.encodings=[].concat(this.sendEncodings||[{}])),l})}function GU(o){if(typeof o!="object"||!o.RTCPeerConnection)return;const s=o.RTCPeerConnection.prototype.createOffer;o.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?RE.all(this.setParametersPromises).then(()=>s.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):s.apply(this,arguments)}}function qU(o){if(typeof o!="object"||!o.RTCPeerConnection)return;const s=o.RTCPeerConnection.prototype.createAnswer;o.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?RE.all(this.setParametersPromises).then(()=>s.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):s.apply(this,arguments)}}var WU=Object.freeze({__proto__:null,shimOnTrack:MU,shimPeerConnection:AP,shimSenderGetStats:UU,shimReceiverGetStats:xU,shimRemoveStream:jU,shimRTCDataChannel:VU,shimAddTransceiver:FU,shimGetParameters:BU,shimCreateOffer:GU,shimCreateAnswer:qU,shimGetUserMedia:LU,shimGetDisplayMedia:function(o,s){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&(o.navigator.mediaDevices.getDisplayMedia=function(l){if(!l||!l.video){const p=new DOMException("getDisplayMedia without video constraints is undefined");return p.name="NotFoundError",p.code=8,RE.reject(p)}return l.video===!0?l.video={mediaSource:s}:l.video.mediaSource=s,o.navigator.mediaDevices.getUserMedia(l)})}});function KU(o){if(typeof o=="object"&&o.RTCPeerConnection){if("getLocalStreams"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in o.RTCPeerConnection.prototype)){const s=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addStream=function(l){this._localStreams||(this._localStreams=[]),this._localStreams.includes(l)||this._localStreams.push(l),l.getAudioTracks().forEach(p=>s.call(this,p,l)),l.getVideoTracks().forEach(p=>s.call(this,p,l))},o.RTCPeerConnection.prototype.addTrack=function(l){for(var p=arguments.length,_=new Array(p>1?p-1:0),b=1;b<p;b++)_[b-1]=arguments[b];return _&&_.forEach(A=>{this._localStreams?this._localStreams.includes(A)||this._localStreams.push(A):this._localStreams=[A]}),s.apply(this,arguments)}}"removeStream"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.removeStream=function(s){this._localStreams||(this._localStreams=[]);const l=this._localStreams.indexOf(s);if(l===-1)return;this._localStreams.splice(l,1);const p=s.getTracks();this.getSenders().forEach(_=>{p.includes(_.track)&&this.removeTrack(_)})})}}function HU(o){if(typeof o=="object"&&o.RTCPeerConnection&&("getRemoteStreams"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in o.RTCPeerConnection.prototype))){Object.defineProperty(o.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(l){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=l),this.addEventListener("track",this._onaddstreampoly=p=>{p.streams.forEach(_=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(_))return;this._remoteStreams.push(_);const b=new Event("addstream");b.stream=_,this.dispatchEvent(b)})})}});const s=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){const l=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(p){p.streams.forEach(_=>{if(l._remoteStreams||(l._remoteStreams=[]),l._remoteStreams.indexOf(_)>=0)return;l._remoteStreams.push(_);const b=new Event("addstream");b.stream=_,l.dispatchEvent(b)})}),s.apply(l,arguments)}}}function YU(o){if(typeof o!="object"||!o.RTCPeerConnection)return;const s=o.RTCPeerConnection.prototype,l=s.createOffer,p=s.createAnswer,_=s.setLocalDescription,b=s.setRemoteDescription,A=s.addIceCandidate;s.createOffer=function(j,z){const H=arguments.length>=2?arguments[2]:arguments[0],$=l.apply(this,[H]);return z?($.then(j,z),RE.resolve()):$},s.createAnswer=function(j,z){const H=arguments.length>=2?arguments[2]:arguments[0],$=p.apply(this,[H]);return z?($.then(j,z),RE.resolve()):$};let k=function(j,z,H){const $=_.apply(this,[j]);return H?($.then(z,H),RE.resolve()):$};s.setLocalDescription=k,k=function(j,z,H){const $=b.apply(this,[j]);return H?($.then(z,H),RE.resolve()):$},s.setRemoteDescription=k,k=function(j,z,H){const $=A.apply(this,[j]);return H?($.then(z,H),RE.resolve()):$},s.addIceCandidate=k}function zU(o){const s=o&&o.navigator;if(s.mediaDevices&&s.mediaDevices.getUserMedia){const l=s.mediaDevices,p=l.getUserMedia.bind(l);s.mediaDevices.getUserMedia=_=>p(JU(_))}!s.getUserMedia&&s.mediaDevices&&s.mediaDevices.getUserMedia&&(s.getUserMedia=function(l,p,_){s.mediaDevices.getUserMedia(l).then(p,_)}.bind(s))}function JU(o){return o&&o.video!==void 0?Object.assign({},o,{video:k1(o.video)}):o}function XU(o){if(!o.RTCPeerConnection)return;const s=o.RTCPeerConnection;o.RTCPeerConnection=function(l,p){if(l&&l.iceServers){const _=[];for(let b=0;b<l.iceServers.length;b++){let A=l.iceServers[b];!A.hasOwnProperty("urls")&&A.hasOwnProperty("url")?(CN("RTCIceServer.url","RTCIceServer.urls"),A=JSON.parse(JSON.stringify(A)),A.urls=A.url,delete A.url,_.push(A)):_.push(l.iceServers[b])}l.iceServers=_}return new s(l,p)},o.RTCPeerConnection.prototype=s.prototype,"generateCertificate"in s&&Object.defineProperty(o.RTCPeerConnection,"generateCertificate",{get:()=>s.generateCertificate})}function QU(o){typeof o=="object"&&o.RTCTrackEvent&&"receiver"in o.RTCTrackEvent.prototype&&!("transceiver"in o.RTCTrackEvent.prototype)&&Object.defineProperty(o.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function $U(o){const s=o.RTCPeerConnection.prototype.createOffer;o.RTCPeerConnection.prototype.createOffer=function(l){if(l){l.offerToReceiveAudio!==void 0&&(l.offerToReceiveAudio=!!l.offerToReceiveAudio);const p=this.getTransceivers().find(b=>b.receiver.track.kind==="audio");l.offerToReceiveAudio===!1&&p?p.direction==="sendrecv"?p.setDirection?p.setDirection("sendonly"):p.direction="sendonly":p.direction==="recvonly"&&(p.setDirection?p.setDirection("inactive"):p.direction="inactive"):l.offerToReceiveAudio!==!0||p||this.addTransceiver("audio",{direction:"recvonly"}),l.offerToReceiveVideo!==void 0&&(l.offerToReceiveVideo=!!l.offerToReceiveVideo);const _=this.getTransceivers().find(b=>b.receiver.track.kind==="video");l.offerToReceiveVideo===!1&&_?_.direction==="sendrecv"?_.setDirection?_.setDirection("sendonly"):_.direction="sendonly":_.direction==="recvonly"&&(_.setDirection?_.setDirection("inactive"):_.direction="inactive"):l.offerToReceiveVideo!==!0||_||this.addTransceiver("video",{direction:"recvonly"})}return s.apply(this,arguments)}}function ZU(o){typeof o!="object"||o.AudioContext||(o.AudioContext=o.webkitAudioContext)}var _x=Object.freeze({__proto__:null,shimLocalStreamsAPI:KU,shimRemoteStreamsAPI:HU,shimCallbacksAPI:YU,shimGetUserMedia:zU,shimConstraints:JU,shimRTCIceServerUrls:XU,shimTrackEventTransceiver:QU,shimCreateOfferLegacy:$U,shimAudioContext:ZU}),lJ=`	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF`,hJ=P0,pJ=oI,t2=_r("".replace),dO=`[	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF]`,fJ=RegExp("^"+dO+dO+"*"),EJ=RegExp(dO+dO+"*$"),wP=function(o){return function(s){var l=pJ(hJ(s));return 1&o&&(l=t2(l,fJ,"")),2&o&&(l=t2(l,EJ,"")),l}},mJ={start:wP(1),end:wP(2),trim:wP(3)},_J=uM.PROPER,gJ=f,e2=lJ,vJ=mJ.trim;yT({target:"String",proto:!0,forced:function(o){return gJ(function(){return!!e2[o]()||"âÂá "[o]()!=="âÂá "||_J&&e2[o].name!==o})}("trim")},{trim:function(){return vJ(this)}});var yJ=sR("String").trim,bJ=_e,TJ=yJ,CP=String.prototype,HS=function(o){var s=o.trim;return typeof o=="string"||o===CP||bJ(CP,o)&&s===CP.trim?TJ:s},NP={exports:{}};(function(o){const s={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};s.localCName=s.generateIdentifier(),s.splitLines=function(l){return HS(l).call(l).split(`
`).map(p=>HS(p).call(p))},s.splitSections=function(l){return l.split(`
m=`).map((p,_)=>{var b;return HS(b=_>0?"m="+p:p).call(b)+`\r
`})},s.getDescription=function(l){const p=s.splitSections(l);return p&&p[0]},s.getMediaSections=function(l){const p=s.splitSections(l);return p.shift(),p},s.matchPrefix=function(l,p){return s.splitLines(l).filter(_=>_.indexOf(p)===0)},s.parseCandidate=function(l){let p;p=l.indexOf("a=candidate:")===0?l.substring(12).split(" "):l.substring(10).split(" ");const _={foundation:p[0],component:{1:"rtp",2:"rtcp"}[p[1]]||p[1],protocol:p[2].toLowerCase(),priority:parseInt(p[3],10),ip:p[4],address:p[4],port:parseInt(p[5],10),type:p[7]};for(let b=8;b<p.length;b+=2)switch(p[b]){case"raddr":_.relatedAddress=p[b+1];break;case"rport":_.relatedPort=parseInt(p[b+1],10);break;case"tcptype":_.tcpType=p[b+1];break;case"ufrag":_.ufrag=p[b+1],_.usernameFragment=p[b+1];break;default:_[p[b]]===void 0&&(_[p[b]]=p[b+1])}return _},s.writeCandidate=function(l){const p=[];p.push(l.foundation);const _=l.component;_==="rtp"?p.push(1):_==="rtcp"?p.push(2):p.push(_),p.push(l.protocol.toUpperCase()),p.push(l.priority),p.push(l.address||l.ip),p.push(l.port);const b=l.type;return p.push("typ"),p.push(b),b!=="host"&&l.relatedAddress&&l.relatedPort&&(p.push("raddr"),p.push(l.relatedAddress),p.push("rport"),p.push(l.relatedPort)),l.tcpType&&l.protocol.toLowerCase()==="tcp"&&(p.push("tcptype"),p.push(l.tcpType)),(l.usernameFragment||l.ufrag)&&(p.push("ufrag"),p.push(l.usernameFragment||l.ufrag)),"candidate:"+p.join(" ")},s.parseIceOptions=function(l){return l.substr(14).split(" ")},s.parseRtpMap=function(l){let p=l.substr(9).split(" ");const _={payloadType:parseInt(p.shift(),10)};return p=p[0].split("/"),_.name=p[0],_.clockRate=parseInt(p[1],10),_.channels=p.length===3?parseInt(p[2],10):1,_.numChannels=_.channels,_},s.writeRtpMap=function(l){let p=l.payloadType;l.preferredPayloadType!==void 0&&(p=l.preferredPayloadType);const _=l.channels||l.numChannels||1;return"a=rtpmap:"+p+" "+l.name+"/"+l.clockRate+(_!==1?"/"+_:"")+`\r
`},s.parseExtmap=function(l){const p=l.substr(9).split(" ");return{id:parseInt(p[0],10),direction:p[0].indexOf("/")>0?p[0].split("/")[1]:"sendrecv",uri:p[1]}},s.writeExtmap=function(l){return"a=extmap:"+(l.id||l.preferredId)+(l.direction&&l.direction!=="sendrecv"?"/"+l.direction:"")+" "+l.uri+`\r
`},s.parseFmtp=function(l){const p={};let _;const b=l.substr(l.indexOf(" ")+1).split(";");for(let j=0;j<b.length;j++){var A,k;_=HS(A=b[j]).call(A).split("="),p[HS(k=_[0]).call(k)]=_[1]}return p},s.writeFmtp=function(l){let p="",_=l.payloadType;if(l.preferredPayloadType!==void 0&&(_=l.preferredPayloadType),l.parameters&&Object.keys(l.parameters).length){const b=[];Object.keys(l.parameters).forEach(A=>{l.parameters[A]!==void 0?b.push(A+"="+l.parameters[A]):b.push(A)}),p+="a=fmtp:"+_+" "+b.join(";")+`\r
`}return p},s.parseRtcpFb=function(l){const p=l.substr(l.indexOf(" ")+1).split(" ");return{type:p.shift(),parameter:p.join(" ")}},s.writeRtcpFb=function(l){let p="",_=l.payloadType;return l.preferredPayloadType!==void 0&&(_=l.preferredPayloadType),l.rtcpFeedback&&l.rtcpFeedback.length&&l.rtcpFeedback.forEach(b=>{p+="a=rtcp-fb:"+_+" "+b.type+(b.parameter&&b.parameter.length?" "+b.parameter:"")+`\r
`}),p},s.parseSsrcMedia=function(l){const p=l.indexOf(" "),_={ssrc:parseInt(l.substr(7,p-7),10)},b=l.indexOf(":",p);return b>-1?(_.attribute=l.substr(p+1,b-p-1),_.value=l.substr(b+1)):_.attribute=l.substr(p+1),_},s.parseSsrcGroup=function(l){const p=l.substr(13).split(" ");return{semantics:p.shift(),ssrcs:p.map(_=>parseInt(_,10))}},s.getMid=function(l){const p=s.matchPrefix(l,"a=mid:")[0];if(p)return p.substr(6)},s.parseFingerprint=function(l){const p=l.substr(14).split(" ");return{algorithm:p[0].toLowerCase(),value:p[1].toUpperCase()}},s.getDtlsParameters=function(l,p){return{role:"auto",fingerprints:s.matchPrefix(l+p,"a=fingerprint:").map(s.parseFingerprint)}},s.writeDtlsParameters=function(l,p){let _="a=setup:"+p+`\r
`;return l.fingerprints.forEach(b=>{_+="a=fingerprint:"+b.algorithm+" "+b.value+`\r
`}),_},s.parseCryptoLine=function(l){const p=l.substr(9).split(" ");return{tag:parseInt(p[0],10),cryptoSuite:p[1],keyParams:p[2],sessionParams:p.slice(3)}},s.writeCryptoLine=function(l){return"a=crypto:"+l.tag+" "+l.cryptoSuite+" "+(typeof l.keyParams=="object"?s.writeCryptoKeyParams(l.keyParams):l.keyParams)+(l.sessionParams?" "+l.sessionParams.join(" "):"")+`\r
`},s.parseCryptoKeyParams=function(l){if(l.indexOf("inline:")!==0)return null;const p=l.substr(7).split("|");return{keyMethod:"inline",keySalt:p[0],lifeTime:p[1],mkiValue:p[2]?p[2].split(":")[0]:void 0,mkiLength:p[2]?p[2].split(":")[1]:void 0}},s.writeCryptoKeyParams=function(l){return l.keyMethod+":"+l.keySalt+(l.lifeTime?"|"+l.lifeTime:"")+(l.mkiValue&&l.mkiLength?"|"+l.mkiValue+":"+l.mkiLength:"")},s.getCryptoParameters=function(l,p){return s.matchPrefix(l+p,"a=crypto:").map(s.parseCryptoLine)},s.getIceParameters=function(l,p){const _=s.matchPrefix(l+p,"a=ice-ufrag:")[0],b=s.matchPrefix(l+p,"a=ice-pwd:")[0];return _&&b?{usernameFragment:_.substr(12),password:b.substr(10)}:null},s.writeIceParameters=function(l){let p="a=ice-ufrag:"+l.usernameFragment+`\r
a=ice-pwd:`+l.password+`\r
`;return l.iceLite&&(p+=`a=ice-lite\r
`),p},s.parseRtpParameters=function(l){const p={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},_=s.splitLines(l)[0].split(" ");for(let b=3;b<_.length;b++){const A=_[b],k=s.matchPrefix(l,"a=rtpmap:"+A+" ")[0];if(k){const j=s.parseRtpMap(k),z=s.matchPrefix(l,"a=fmtp:"+A+" ");switch(j.parameters=z.length?s.parseFmtp(z[0]):{},j.rtcpFeedback=s.matchPrefix(l,"a=rtcp-fb:"+A+" ").map(s.parseRtcpFb),p.codecs.push(j),j.name.toUpperCase()){case"RED":case"ULPFEC":p.fecMechanisms.push(j.name.toUpperCase())}}}return s.matchPrefix(l,"a=extmap:").forEach(b=>{p.headerExtensions.push(s.parseExtmap(b))}),p},s.writeRtpDescription=function(l,p){let _="";_+="m="+l+" ",_+=p.codecs.length>0?"9":"0",_+=" UDP/TLS/RTP/SAVPF ",_+=p.codecs.map(A=>A.preferredPayloadType!==void 0?A.preferredPayloadType:A.payloadType).join(" ")+`\r
`,_+=`c=IN IP4 0.0.0.0\r
`,_+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,p.codecs.forEach(A=>{_+=s.writeRtpMap(A),_+=s.writeFmtp(A),_+=s.writeRtcpFb(A)});let b=0;return p.codecs.forEach(A=>{A.maxptime>b&&(b=A.maxptime)}),b>0&&(_+="a=maxptime:"+b+`\r
`),p.headerExtensions&&p.headerExtensions.forEach(A=>{_+=s.writeExtmap(A)}),_},s.parseRtpEncodingParameters=function(l){const p=[],_=s.parseRtpParameters(l),b=_.fecMechanisms.indexOf("RED")!==-1,A=_.fecMechanisms.indexOf("ULPFEC")!==-1,k=s.matchPrefix(l,"a=ssrc:").map(ue=>s.parseSsrcMedia(ue)).filter(ue=>ue.attribute==="cname"),j=k.length>0&&k[0].ssrc;let z;const H=s.matchPrefix(l,"a=ssrc-group:FID").map(ue=>ue.substr(17).split(" ").map(Ei=>parseInt(Ei,10)));H.length>0&&H[0].length>1&&H[0][0]===j&&(z=H[0][1]),_.codecs.forEach(ue=>{if(ue.name.toUpperCase()==="RTX"&&ue.parameters.apt){let Ei={ssrc:j,codecPayloadType:parseInt(ue.parameters.apt,10)};j&&z&&(Ei.rtx={ssrc:z}),p.push(Ei),b&&(Ei=JSON.parse(JSON.stringify(Ei)),Ei.fec={ssrc:j,mechanism:A?"red+ulpfec":"red"},p.push(Ei))}}),p.length===0&&j&&p.push({ssrc:j});let $=s.matchPrefix(l,"b=");return $.length&&($=$[0].indexOf("b=TIAS:")===0?parseInt($[0].substr(7),10):$[0].indexOf("b=AS:")===0?1e3*parseInt($[0].substr(5),10)*.95-16e3:void 0,p.forEach(ue=>{ue.maxBitrate=$})),p},s.parseRtcpParameters=function(l){const p={},_=s.matchPrefix(l,"a=ssrc:").map(k=>s.parseSsrcMedia(k)).filter(k=>k.attribute==="cname")[0];_&&(p.cname=_.value,p.ssrc=_.ssrc);const b=s.matchPrefix(l,"a=rtcp-rsize");p.reducedSize=b.length>0,p.compound=b.length===0;const A=s.matchPrefix(l,"a=rtcp-mux");return p.mux=A.length>0,p},s.writeRtcpParameters=function(l){let p="";return l.reducedSize&&(p+=`a=rtcp-rsize\r
`),l.mux&&(p+=`a=rtcp-mux\r
`),l.ssrc!==void 0&&l.cname&&(p+="a=ssrc:"+l.ssrc+" cname:"+l.cname+`\r
`),p},s.parseMsid=function(l){let p;const _=s.matchPrefix(l,"a=msid:");if(_.length===1)return p=_[0].substr(7).split(" "),{stream:p[0],track:p[1]};const b=s.matchPrefix(l,"a=ssrc:").map(A=>s.parseSsrcMedia(A)).filter(A=>A.attribute==="msid");return b.length>0?(p=b[0].value.split(" "),{stream:p[0],track:p[1]}):void 0},s.parseSctpDescription=function(l){const p=s.parseMLine(l),_=s.matchPrefix(l,"a=max-message-size:");let b;_.length>0&&(b=parseInt(_[0].substr(19),10)),isNaN(b)&&(b=65536);const A=s.matchPrefix(l,"a=sctp-port:");if(A.length>0)return{port:parseInt(A[0].substr(12),10),protocol:p.fmt,maxMessageSize:b};const k=s.matchPrefix(l,"a=sctpmap:");if(k.length>0){const j=k[0].substr(10).split(" ");return{port:parseInt(j[0],10),protocol:j[1],maxMessageSize:b}}},s.writeSctpDescription=function(l,p){let _=[];return _=l.protocol!=="DTLS/SCTP"?["m="+l.kind+" 9 "+l.protocol+" "+p.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+p.port+`\r
`]:["m="+l.kind+" 9 "+l.protocol+" "+p.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+p.port+" "+p.protocol+` 65535\r
`],p.maxMessageSize!==void 0&&_.push("a=max-message-size:"+p.maxMessageSize+`\r
`),_.join("")},s.generateSessionId=function(){return Math.random().toString().substr(2,21)},s.writeSessionBoilerplate=function(l,p,_){let b;const A=p!==void 0?p:2;return b=l||s.generateSessionId(),`v=0\r
o=`+(_||"thisisadapterortc")+" "+b+" "+A+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},s.getDirection=function(l,p){const _=s.splitLines(l);for(let b=0;b<_.length;b++)switch(_[b]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return _[b].substr(2)}return p?s.getDirection(p):"sendrecv"},s.getKind=function(l){return s.splitLines(l)[0].split(" ")[0].substr(2)},s.isRejected=function(l){return l.split(" ",2)[1]==="0"},s.parseMLine=function(l){const p=s.splitLines(l)[0].substr(2).split(" ");return{kind:p[0],port:parseInt(p[1],10),protocol:p[2],fmt:p.slice(3).join(" ")}},s.parseOLine=function(l){const p=s.matchPrefix(l,"o=")[0].substr(2).split(" ");return{username:p[0],sessionId:p[1],sessionVersion:parseInt(p[2],10),netType:p[3],addressType:p[4],address:p[5]}},s.isValidSDP=function(l){if(typeof l!="string"||l.length===0)return!1;const p=s.splitLines(l);for(let _=0;_<p.length;_++)if(p[_].length<2||p[_].charAt(1)!=="=")return!1;return!0},o.exports=s})(NP);var pI=NP.exports,SJ=Object.freeze(d({__proto__:null,default:pI},[NP.exports]));function lO(o){if(!o.RTCIceCandidate||o.RTCIceCandidate&&"foundation"in o.RTCIceCandidate.prototype)return;const s=o.RTCIceCandidate;o.RTCIceCandidate=function(l){if(typeof l=="object"&&l.candidate&&l.candidate.indexOf("a=")===0&&((l=JSON.parse(JSON.stringify(l))).candidate=l.candidate.substr(2)),l.candidate&&l.candidate.length){const p=new s(l),_=pI.parseCandidate(l.candidate),b=Object.assign(p,_);return b.toJSON=function(){return{candidate:b.candidate,sdpMid:b.sdpMid,sdpMLineIndex:b.sdpMLineIndex,usernameFragment:b.usernameFragment}},b}return new s(l)},o.RTCIceCandidate.prototype=s.prototype,DR(o,"icecandidate",l=>(l.candidate&&Object.defineProperty(l,"candidate",{value:new o.RTCIceCandidate(l.candidate),writable:"false"}),l))}function PP(o){!o.RTCIceCandidate||o.RTCIceCandidate&&"relayProtocol"in o.RTCIceCandidate.prototype||DR(o,"icecandidate",s=>{if(s.candidate){const l=pI.parseCandidate(s.candidate.candidate);l.type==="relay"&&(s.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[l.priority>>24])}return s})}function hO(o,s){if(!o.RTCPeerConnection)return;"sctp"in o.RTCPeerConnection.prototype||Object.defineProperty(o.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const l=function(k){if(!k||!k.sdp)return!1;const j=pI.splitSections(k.sdp);return j.shift(),j.some(z=>{const H=pI.parseMLine(z);return H&&H.kind==="application"&&H.protocol.indexOf("SCTP")!==-1})},p=function(k){const j=k.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(j===null||j.length<2)return-1;const z=parseInt(j[1],10);return z!=z?-1:z},_=function(k){let j=65536;return s.browser==="firefox"&&(j=s.version<57?k===-1?16384:2147483637:s.version<60?s.version===57?65535:65536:2147483637),j},b=function(k,j){let z=65536;s.browser==="firefox"&&s.version===57&&(z=65535);const H=pI.matchPrefix(k.sdp,"a=max-message-size:");return H.length>0?z=parseInt(H[0].substr(19),10):s.browser==="firefox"&&j!==-1&&(z=2147483637),z},A=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,s.browser==="chrome"&&s.version>=76){const{sdpSemantics:k}=this.getConfiguration();k==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(l(arguments[0])){const k=p(arguments[0]),j=_(k),z=b(arguments[0],k);let H;H=j===0&&z===0?Number.POSITIVE_INFINITY:j===0||z===0?Math.max(j,z):Math.min(j,z);const $={};Object.defineProperty($,"maxMessageSize",{get:()=>H}),this._sctp=$}return A.apply(this,arguments)}}function pO(o){if(!o.RTCPeerConnection||!("createDataChannel"in o.RTCPeerConnection.prototype))return;function s(p,_){const b=p.send;p.send=function(){const A=arguments[0],k=A.length||A.size||A.byteLength;if(p.readyState==="open"&&_.sctp&&k>_.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+_.sctp.maxMessageSize+" bytes)");return b.apply(p,arguments)}}const l=o.RTCPeerConnection.prototype.createDataChannel;o.RTCPeerConnection.prototype.createDataChannel=function(){const p=l.apply(this,arguments);return s(p,this),p},DR(o,"datachannel",p=>(s(p.channel,p.target),p))}function DP(o){if(!o.RTCPeerConnection||"connectionState"in o.RTCPeerConnection.prototype)return;const s=o.RTCPeerConnection.prototype;Object.defineProperty(s,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(s,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(l){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),l&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=l)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(l=>{const p=s[l];s[l]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=_=>{const b=_.target;if(b._lastConnectionState!==b.connectionState){b._lastConnectionState=b.connectionState;const A=new Event("connectionstatechange",_);b.dispatchEvent(A)}return _},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),p.apply(this,arguments)}})}function kP(o,s){if(!o.RTCPeerConnection||s.browser==="chrome"&&s.version>=71||s.browser==="safari"&&s.version>=605)return;const l=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(p){if(p&&p.sdp&&p.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const _=p.sdp.split(`
`).filter(b=>HS(b).call(b)!=="a=extmap-allow-mixed").join(`
`);o.RTCSessionDescription&&p instanceof o.RTCSessionDescription?arguments[0]=new o.RTCSessionDescription({type:p.type,sdp:_}):p.sdp=_}return l.apply(this,arguments)}}function fO(o,s){if(!o.RTCPeerConnection||!o.RTCPeerConnection.prototype)return;const l=o.RTCPeerConnection.prototype.addIceCandidate;l&&l.length!==0&&(o.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(s.browser==="chrome"&&s.version<78||s.browser==="firefox"&&s.version<68||s.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?RE.resolve():l.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),RE.resolve())})}function EO(o,s){if(!o.RTCPeerConnection||!o.RTCPeerConnection.prototype)return;const l=o.RTCPeerConnection.prototype.setLocalDescription;l&&l.length!==0&&(o.RTCPeerConnection.prototype.setLocalDescription=function(){let p=arguments[0]||{};if(typeof p!="object"||p.type&&p.sdp)return l.apply(this,arguments);if(p={type:p.type,sdp:p.sdp},!p.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":p.type="offer";break;default:p.type="answer"}return p.sdp||p.type!=="offer"&&p.type!=="answer"?l.apply(this,[p]):(p.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(b=>l.apply(this,[b]))})}var RJ=Object.freeze({__proto__:null,shimRTCIceCandidate:lO,shimRTCIceCandidateRelayProtocol:PP,shimMaxMessageSize:hO,shimSendThrowTypeError:pO,shimConnectionState:DP,removeExtmapAllowMixed:kP,shimAddIceCandidateNullOrEmpty:fO,shimParameterlessSetLocalDescription:EO});let tT,c_;(function(){let{window:o}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const l=P1,p=F5(o),_={browserDetails:p,commonShim:RJ,extractVersion:j0,disableLog:j5,disableWarnings:V5,sdp:SJ};switch(p.browser){case"chrome":if(!kU||!OP||!s.shimChrome)return l("Chrome shim is not included in this adapter release."),_;if(p.version===null)return l("Chrome shim can not determine version, not shimming."),_;l("adapter.js shimming chrome."),_.browserShim=kU,fO(o,p),EO(o),RU(o,p),IU(o),OP(o,p),OU(o),PU(o,p),AU(o),wU(o),CU(o),DU(o,p),lO(o),PP(o),DP(o),hO(o,p),pO(o),kP(o,p);break;case"firefox":if(!WU||!AP||!s.shimFirefox)return l("Firefox shim is not included in this adapter release."),_;l("adapter.js shimming firefox."),_.browserShim=WU,fO(o,p),EO(o),LU(o,p),AP(o,p),MU(o),jU(o),UU(o),xU(o),VU(o),FU(o),BU(o),GU(o),qU(o),lO(o),DP(o),hO(o,p),pO(o);break;case"safari":if(!_x||!s.shimSafari)return l("Safari shim is not included in this adapter release."),_;l("adapter.js shimming safari."),_.browserShim=_x,fO(o,p),EO(o),XU(o),$U(o),YU(o),KU(o),HU(o),QU(o),zU(o),ZU(o),lO(o),PP(o),hO(o,p),pO(o),kP(o,p);break;default:l("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),function(o){o.WIN_10="Windows 10",o.WIN_81="Windows 8.1",o.WIN_8="Windows 8",o.WIN_7="Windows 7",o.WIN_VISTA="Windows Vista",o.WIN_SERVER_2003="Windows Server 2003",o.WIN_XP="Windows XP",o.WIN_2000="Windows 2000",o.ANDROID="Android",o.HARMONY_OS="HarmonyOS",o.OPEN_BSD="Open BSD",o.SUN_OS="Sun OS",o.LINUX="Linux",o.IOS="iOS",o.MAC_OS="Mac OS",o.QNX="QNX",o.UNIX="UNIX",o.BEOS="BeOS",o.OS_2="OS/2",o.SEARCH_BOT="Search Bot"}(tT||(tT={})),function(o){o.CHROME="Chrome",o.SAFARI="Safari",o.EDGE="Edge",o.FIREFOX="Firefox",o.OPERA="OPR",o.QQ="QQBrowser",o.WECHAT="MicroMessenger"}(c_||(c_={}));var LP={exports:{}};(function(o,s){(function(l,p){var _="function",b="undefined",A="object",k="string",j="major",z="model",H="name",$="type",ue="vendor",Ei="version",Fi="architecture",Gi="console",_o="mobile",_f="tablet",vf="smarttv",uE="wearable",IE="embedded",lE="Amazon",hE="Apple",sE="ASUS",mE="BlackBerry",n_="Firefox",DE="Google",__="Huawei",d_="LG",U_="Microsoft",_b="Motorola",k_="Opera",NT="Samsung",nE="Sharp",dE="Sony",vE="Xiaomi",xE="Zebra",ZE="Facebook",fE="Chromium OS",Wt="Mac OS",_s=function(N_){for(var W_={},f_=0;f_<N_.length;f_++)W_[N_[f_].toUpperCase()]=N_[f_];return W_},_c=function(N_,W_){return typeof N_===k&&iE(W_).indexOf(iE(N_))!==-1},iE=function(N_){return N_.toLowerCase()},VE=function(N_,W_){if(typeof N_===k)return N_=N_.replace(/^\s\s*/,""),typeof W_===b?N_:N_.substring(0,350)},g_=function(N_,W_){for(var f_,RT,BS,P_,$E,PT,wR=0;wR<W_.length&&!$E;){var CS=W_[wR],Y6=W_[wR+1];for(f_=RT=0;f_<CS.length&&!$E&&CS[f_];)if($E=CS[f_++].exec(N_))for(BS=0;BS<Y6.length;BS++)PT=$E[++RT],typeof(P_=Y6[BS])===A&&P_.length>0?P_.length===2?typeof P_[1]==_?this[P_[0]]=P_[1].call(this,PT):this[P_[0]]=P_[1]:P_.length===3?typeof P_[1]!==_||P_[1].exec&&P_[1].test?this[P_[0]]=PT?PT.replace(P_[1],P_[2]):p:this[P_[0]]=PT?P_[1].call(this,PT,P_[2]):p:P_.length===4&&(this[P_[0]]=PT?P_[3].call(this,PT.replace(P_[1],P_[2])):p):this[P_]=PT||p;wR+=2}},Lb=function(N_,W_){for(var f_ in W_)if(typeof W_[f_]===A&&W_[f_].length>0){for(var RT=0;RT<W_[f_].length;RT++)if(_c(W_[f_][RT],N_))return f_==="?"?p:f_}else if(_c(W_[f_],N_))return f_==="?"?p:f_;return N_},vS={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},OR={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[Ei,[H,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[Ei,[H,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[H,Ei],[/opios[\/ ]+([\w\.]+)/i],[Ei,[H,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[Ei,[H,k_]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[H,Ei],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[Ei,[H,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[Ei,[H,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[Ei,[H,"WeChat"]],[/konqueror\/([\w\.]+)/i],[Ei,[H,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[Ei,[H,"IE"]],[/yabrowser\/([\w\.]+)/i],[Ei,[H,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[H,/(.+)/,"$1 Secure Browser"],Ei],[/\bfocus\/([\w\.]+)/i],[Ei,[H,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[Ei,[H,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[Ei,[H,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[Ei,[H,"Dolphin"]],[/coast\/([\w\.]+)/i],[Ei,[H,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[Ei,[H,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[Ei,[H,n_]],[/\bqihu|(qi?ho?o?|360)browser/i],[[H,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[H,/(.+)/,"$1 Browser"],Ei],[/(comodo_dragon)\/([\w\.]+)/i],[[H,/_/g," "],Ei],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[H,Ei],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[H],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[H,ZE],Ei],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[H,Ei],[/\bgsa\/([\w\.]+) .*safari\//i],[Ei,[H,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[Ei,[H,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[H,"Chrome WebView"],Ei],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[Ei,[H,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[H,Ei],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[Ei,[H,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[Ei,H],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[H,[Ei,Lb,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[H,Ei],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[H,"Netscape"],Ei],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[Ei,[H,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[H,Ei],[/(cobalt)\/([\w\.]+)/i],[H,[Ei,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[Fi,"amd64"]],[/(ia32(?=;))/i],[[Fi,iE]],[/((?:i[346]|x)86)[;\)]/i],[[Fi,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[Fi,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[Fi,"armhf"]],[/windows (ce|mobile); ppc;/i],[[Fi,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[Fi,/ower/,"",iE]],[/(sun4\w)[;\)]/i],[[Fi,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[Fi,iE]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[z,[ue,NT],[$,_f]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[z,[ue,NT],[$,_o]],[/\((ip(?:hone|od)[\w ]*);/i],[z,[ue,hE],[$,_o]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[z,[ue,hE],[$,_f]],[/(macintosh);/i],[z,[ue,hE]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[z,[ue,nE],[$,_o]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[z,[ue,__],[$,_f]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[z,[ue,__],[$,_o]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[z,/_/g," "],[ue,vE],[$,_o]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[z,/_/g," "],[ue,vE],[$,_f]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[z,[ue,"OPPO"],[$,_o]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[z,[ue,"Vivo"],[$,_o]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[z,[ue,"Realme"],[$,_o]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[z,[ue,_b],[$,_o]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[z,[ue,_b],[$,_f]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[z,[ue,d_],[$,_f]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[z,[ue,d_],[$,_o]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[z,[ue,"Lenovo"],[$,_f]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[z,/_/g," "],[ue,"Nokia"],[$,_o]],[/(pixel c)\b/i],[z,[ue,DE],[$,_f]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[z,[ue,DE],[$,_o]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[z,[ue,dE],[$,_o]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[z,"Xperia Tablet"],[ue,dE],[$,_f]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[z,[ue,"OnePlus"],[$,_o]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[z,[ue,lE],[$,_f]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[z,/(.+)/g,"Fire Phone $1"],[ue,lE],[$,_o]],[/(playbook);[-\w\),; ]+(rim)/i],[z,ue,[$,_f]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[z,[ue,mE],[$,_o]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[z,[ue,sE],[$,_f]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[z,[ue,sE],[$,_o]],[/(nexus 9)/i],[z,[ue,"HTC"],[$,_f]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[ue,[z,/_/g," "],[$,_o]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[z,[ue,"Acer"],[$,_f]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[z,[ue,"Meizu"],[$,_o]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[ue,z,[$,_o]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[ue,z,[$,_f]],[/(surface duo)/i],[z,[ue,U_],[$,_f]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[z,[ue,"Fairphone"],[$,_o]],[/(u304aa)/i],[z,[ue,"AT&T"],[$,_o]],[/\bsie-(\w*)/i],[z,[ue,"Siemens"],[$,_o]],[/\b(rct\w+) b/i],[z,[ue,"RCA"],[$,_f]],[/\b(venue[\d ]{2,7}) b/i],[z,[ue,"Dell"],[$,_f]],[/\b(q(?:mv|ta)\w+) b/i],[z,[ue,"Verizon"],[$,_f]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[z,[ue,"Barnes & Noble"],[$,_f]],[/\b(tm\d{3}\w+) b/i],[z,[ue,"NuVision"],[$,_f]],[/\b(k88) b/i],[z,[ue,"ZTE"],[$,_f]],[/\b(nx\d{3}j) b/i],[z,[ue,"ZTE"],[$,_o]],[/\b(gen\d{3}) b.+49h/i],[z,[ue,"Swiss"],[$,_o]],[/\b(zur\d{3}) b/i],[z,[ue,"Swiss"],[$,_f]],[/\b((zeki)?tb.*\b) b/i],[z,[ue,"Zeki"],[$,_f]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[ue,"Dragon Touch"],z,[$,_f]],[/\b(ns-?\w{0,9}) b/i],[z,[ue,"Insignia"],[$,_f]],[/\b((nxa|next)-?\w{0,9}) b/i],[z,[ue,"NextBook"],[$,_f]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[ue,"Voice"],z,[$,_o]],[/\b(lvtel\-)?(v1[12]) b/i],[[ue,"LvTel"],z,[$,_o]],[/\b(ph-1) /i],[z,[ue,"Essential"],[$,_o]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[z,[ue,"Envizen"],[$,_f]],[/\b(trio[-\w\. ]+) b/i],[z,[ue,"MachSpeed"],[$,_f]],[/\btu_(1491) b/i],[z,[ue,"Rotor"],[$,_f]],[/(shield[\w ]+) b/i],[z,[ue,"Nvidia"],[$,_f]],[/(sprint) (\w+)/i],[ue,z,[$,_o]],[/(kin\.[onetw]{3})/i],[[z,/\./g," "],[ue,U_],[$,_o]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[z,[ue,xE],[$,_f]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[z,[ue,xE],[$,_o]],[/smart-tv.+(samsung)/i],[ue,[$,vf]],[/hbbtv.+maple;(\d+)/i],[[z,/^/,"SmartTV"],[ue,NT],[$,vf]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[ue,d_],[$,vf]],[/(apple) ?tv/i],[ue,[z,"Apple TV"],[$,vf]],[/crkey/i],[[z,"Chromecast"],[ue,DE],[$,vf]],[/droid.+aft(\w)( bui|\))/i],[z,[ue,lE],[$,vf]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[z,[ue,nE],[$,vf]],[/(bravia[\w ]+)( bui|\))/i],[z,[ue,dE],[$,vf]],[/(mitv-\w{5}) bui/i],[z,[ue,vE],[$,vf]],[/Hbbtv.*(technisat) (.*);/i],[ue,z,[$,vf]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[ue,VE],[z,VE],[$,vf]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[$,vf]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[ue,z,[$,Gi]],[/droid.+; (shield) bui/i],[z,[ue,"Nvidia"],[$,Gi]],[/(playstation [345portablevi]+)/i],[z,[ue,dE],[$,Gi]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[z,[ue,U_],[$,Gi]],[/((pebble))app/i],[ue,z,[$,uE]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[z,[ue,hE],[$,uE]],[/droid.+; (glass) \d/i],[z,[ue,DE],[$,uE]],[/droid.+; (wt63?0{2,3})\)/i],[z,[ue,xE],[$,uE]],[/(quest( 2| pro)?)/i],[z,[ue,ZE],[$,uE]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[ue,[$,IE]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[z,[$,_o]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[z,[$,_f]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[$,_f]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[$,_o]],[/(android[-\w\. ]{0,9});.+buil/i],[z,[ue,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[Ei,[H,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[Ei,[H,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[H,Ei],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[Ei,H]],os:[[/microsoft (windows) (vista|xp)/i],[H,Ei],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[H,[Ei,Lb,vS]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[H,"Windows"],[Ei,Lb,vS]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[Ei,/_/g,"."],[H,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[H,Wt],[Ei,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[Ei,H],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[H,Ei],[/\(bb(10);/i],[Ei,[H,mE]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[Ei,[H,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[Ei,[H,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[Ei,[H,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[Ei,[H,"watchOS"]],[/crkey\/([\d\.]+)/i],[Ei,[H,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[H,fE],Ei],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[H,Ei],[/(sunos) ?([\w\.\d]*)/i],[[H,"Solaris"],Ei],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[H,Ei]]},cS=function(N_,W_){if(typeof N_===A&&(W_=N_,N_=p),!(this instanceof cS))return new cS(N_,W_).getResult();var f_=typeof l!==b&&l.navigator?l.navigator:p,RT=N_||(f_&&f_.userAgent?f_.userAgent:""),BS=f_&&f_.userAgentData?f_.userAgentData:p,P_=W_?function($E,PT){var wR={};for(var CS in $E)PT[CS]&&PT[CS].length%2==0?wR[CS]=PT[CS].concat($E[CS]):wR[CS]=$E[CS];return wR}(OR,W_):OR;return this.getBrowser=function(){var $E={};return $E.name=p,$E.version=p,g_.call($E,RT,P_.browser),$E.major=function(PT){return typeof PT===k?PT.replace(/[^\d\.]/g,"").split(".")[0]:p}($E.version),f_&&f_.brave&&typeof f_.brave.isBrave==_&&($E.name="Brave"),$E},this.getCPU=function(){var $E={};return $E.architecture=p,g_.call($E,RT,P_.cpu),$E},this.getDevice=function(){var $E={};return $E.vendor=p,$E.model=p,$E.type=p,g_.call($E,RT,P_.device),!$E.type&&BS&&BS.mobile&&($E.type=_o),$E.model=="Macintosh"&&f_&&typeof f_.standalone!==b&&f_.maxTouchPoints&&f_.maxTouchPoints>2&&($E.model="iPad",$E.type=_f),$E},this.getEngine=function(){var $E={};return $E.name=p,$E.version=p,g_.call($E,RT,P_.engine),$E},this.getOS=function(){var $E={};return $E.name=p,$E.version=p,g_.call($E,RT,P_.os),!$E.name&&BS&&BS.platform!="Unknown"&&($E.name=BS.platform.replace(/chrome os/i,fE).replace(/macos/i,Wt)),$E},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return RT},this.setUA=function($E){return RT=typeof $E===k&&$E.length>350?VE($E,350):$E,this},this.setUA(RT),this};cS.VERSION="0.7.34",cS.BROWSER=_s([H,Ei,j]),cS.CPU=_s([Fi]),cS.DEVICE=_s([z,ue,$,Gi,_o,vf,_f,uE,IE]),cS.ENGINE=cS.OS=_s([H,Ei]),o.exports&&(s=o.exports=cS),s.UAParser=cS;var AR=typeof l!==b&&(l.jQuery||l.Zepto);if(AR&&!AR.ua){var WI=new cS;AR.ua=WI.getResult(),AR.ua.get=function(){return WI.getUA()},AR.ua.set=function(N_){WI.setUA(N_);var W_=WI.getResult();for(var f_ in W_)AR.ua[f_]=W_[f_]}}})(typeof window=="object"?window:h)})(LP,LP.exports);const MP=new LP.exports;let UP,xT,YS=MP.getResult(),xP=null;function r_(o){if(!xP){o&&MP.setUA(o),YS=MP.getResult();const s=function(b){if(b.engine.name==="Blink"&&b.browser.name!=="WeChat")return c_.CHROME;switch(b.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return c_.CHROME;case"Safari":case"Mobile Safari":return c_.SAFARI;case"Edge":return c_.EDGE;case"Firefox":return c_.FIREFOX;case"QQBrowser":return c_.QQ;case"Opera":return c_.OPERA;case"WeChat":return c_.WECHAT;default:return b.browser.name||""}}(YS),l=function(b){let A;return A=b.engine.name==="Blink"?b.engine.version||"":b.browser.version||"",A.split(".")[0]}(YS),p=function(b){switch(b.os.name){case"Windows":return b.os.version?b.os.name+" "+b.os.version:b.os.name;default:return b.os.name||""}}(YS),_=YS.os.version;if(!(s&&l&&p&&_))return{name:s,version:l,os:p,osVersion:_};xP={name:s,version:l,os:p,osVersion:_}}return xP}function n2(){return r_().os}function r2(){const o=r_();return"".concat(o.os," ").concat(o.osVersion)}function mO(){const o=r_();return!!(YS.engine.name==="WebKit"&&o.os===tT.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&o.name!==c_.SAFARI||ET()&&o.name!==c_.SAFARI)}function IJ(){const o=r_();if(mO()){if(o.os===tT.MAC_OS)return!0;if(o.os===tT.IOS){const s=YS.os.version&&YS.os.version.split(".");if(s&&Number(s[0])===14&&s[1]&&Number(s[1])>=3||s&&Number(s[0])>14)return!0}}return!1}function OJ(){return YS.engine.name==="WebKit"}function jP(){return r_().name===c_.CHROME}function fT(){return r_().name===c_.SAFARI}function O_(){return r_().name===c_.FIREFOX}function ET(){return r_().os===tT.IOS}function VP(o){const s=r_();return!(s.name!==c_.CHROME||!s.osVersion)&&Number(s.version)>=o}function i2(o){const s=r_();return!(s.name!==c_.EDGE||!s.osVersion)&&Number(s.version)>=o}function o2(o){const s=r_();return!(s.name!==c_.OPERA||!s.osVersion)&&Number(s.version)>=o}function s2(){const o=r_();return!(o.name!==c_.CHROME||!o.osVersion)&&Number(o.version)<=90}function a2(){const o=r_();if(o.os!==tT.IOS||!o.osVersion)return!1;const s=o.osVersion.split(".");return Number(s[0])<14||Number(s[0])===14&&Number(s[1])<=6}function fI(){const o=r_();if(o.os!==tT.IOS||!o.osVersion)return!1;const s=o.osVersion.split(".");return Number(s[0])===15}function FP(){const o=r_();if(o.os!==tT.IOS||!o.osVersion)return!1;const s=o.osVersion.split(".");return Number(s[0])===16}function c2(){const o=r_();if(o.os!==tT.IOS||!o.osVersion)return!1;const s=o.osVersion.split(".");return Number(s[0])===15&&Number(s[1])>=1}function LS(){return fT()&&navigator.maxTouchPoints>0}function u2(){return r_().name===c_.WECHAT}function d2(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function xR(){const o=r_();return o.name===c_.EDGE||o.name===c_.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function _O(){return n2()===tT.ANDROID}function r0(){const o=r_();return _O()&&(o.name===c_.CHROME||o.name===c_.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}(function(o){o.L1T1="L1T1",o.L1T2="L1T2",o.L1T3="L1T3",o.L2T1_KEY="L2T1_KEY",o.L2T2_KEY="L2T2_KEY",o.L2T3_KEY="L2T3_KEY",o.L3T1_KEY="L3T1_KEY",o.L3T2_KEY="L3T2_KEY",o.L3T3_KEY="L3T3_KEY"})(UP||(UP={})),function(o){o.CERTIFICATE="certificate",o.CODEC="codec",o.CANDIDATE_PAIR="candidate-pair",o.LOCAL_CANDIDATE="local-candidate",o.REMOTE_CANDIDATE="remote-candidate",o.INBOUND="inbound-rtp",o.TRACK="track",o.OUTBOUND="outbound-rtp",o.PC="peer-connection",o.REMOTE_INBOUND="remote-inbound-rtp",o.REMOTE_OUTBOUND="remote-outbound-rtp",o.TRANSPORT="transport",o.CSRC="csrc",o.DATA_CHANNEL="data-channel",o.STREAM="stream",o.SENDER="sender",o.RECEIVER="receiver"}(xT||(xT={}));var l2={exports:{}},AJ=yT,wJ=gE,h2=yS.f;AJ({target:"Object",stat:!0,forced:Object.defineProperty!==h2,sham:!wJ},{defineProperty:h2});var p2=rR.Object,CJ=l2.exports=function(o,s,l){return p2.defineProperty(o,s,l)};p2.defineProperty.sham&&(CJ.sham=!0);var f2=l2.exports;function _t(o,s,l){return s in o?f2(o,s,{value:l,enumerable:!0,configurable:!0,writable:!0}):o[s]=l,o}var BP,GP={exports:{}},E2=function(o,s){return function(){for(var l=new Array(arguments.length),p=0;p<l.length;p++)l[p]=arguments[p];return o.apply(s,l)}},NJ=E2,qP=Object.prototype.toString,WP=(BP=Object.create(null),function(o){var s=qP.call(o);return BP[s]||(BP[s]=s.slice(8,-1).toLowerCase())});function jR(o){return o=o.toLowerCase(),function(s){return WP(s)===o}}function KP(o){return Array.isArray(o)}function gO(o){return o===void 0}var m2=jR("ArrayBuffer");function _2(o){return o!==null&&typeof o=="object"}function vO(o){if(WP(o)!=="object")return!1;var s=Object.getPrototypeOf(o);return s===null||s===Object.prototype}var PJ=jR("Date"),DJ=jR("File"),kJ=jR("Blob"),LJ=jR("FileList");function HP(o){return qP.call(o)==="[object Function]"}var MJ=jR("URLSearchParams");function YP(o,s){if(o!=null)if(typeof o!="object"&&(o=[o]),KP(o))for(var l=0,p=o.length;l<p;l++)s.call(null,o[l],l,o);else for(var _ in o)Object.prototype.hasOwnProperty.call(o,_)&&s.call(null,o[_],_,o)}var zP,UJ=(zP=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(o){return zP&&o instanceof zP}),bT={isArray:KP,isArrayBuffer:m2,isBuffer:function(o){return o!==null&&!gO(o)&&o.constructor!==null&&!gO(o.constructor)&&typeof o.constructor.isBuffer=="function"&&o.constructor.isBuffer(o)},isFormData:function(o){var s="[object FormData]";return o&&(typeof FormData=="function"&&o instanceof FormData||qP.call(o)===s||HP(o.toString)&&o.toString()===s)},isArrayBufferView:function(o){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(o):o&&o.buffer&&m2(o.buffer)},isString:function(o){return typeof o=="string"},isNumber:function(o){return typeof o=="number"},isObject:_2,isPlainObject:vO,isUndefined:gO,isDate:PJ,isFile:DJ,isBlob:kJ,isFunction:HP,isStream:function(o){return _2(o)&&HP(o.pipe)},isURLSearchParams:MJ,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:YP,merge:function o(){var s={};function l(b,A){vO(s[A])&&vO(b)?s[A]=o(s[A],b):vO(b)?s[A]=o({},b):KP(b)?s[A]=b.slice():s[A]=b}for(var p=0,_=arguments.length;p<_;p++)YP(arguments[p],l);return s},extend:function(o,s,l){return YP(s,function(p,_){o[_]=l&&typeof p=="function"?NJ(p,l):p}),o},trim:function(o){return o.trim?o.trim():o.replace(/^\s+|\s+$/g,"")},stripBOM:function(o){return o.charCodeAt(0)===65279&&(o=o.slice(1)),o},inherits:function(o,s,l,p){o.prototype=Object.create(s.prototype,p),o.prototype.constructor=o,l&&Object.assign(o.prototype,l)},toFlatObject:function(o,s,l){var p,_,b,A={};s=s||{};do{for(_=(p=Object.getOwnPropertyNames(o)).length;_-- >0;)A[b=p[_]]||(s[b]=o[b],A[b]=!0);o=Object.getPrototypeOf(o)}while(o&&(!l||l(o,s))&&o!==Object.prototype);return s},kindOf:WP,kindOfTest:jR,endsWith:function(o,s,l){o=String(o),(l===void 0||l>o.length)&&(l=o.length),l-=s.length;var p=o.indexOf(s,l);return p!==-1&&p===l},toArray:function(o){if(!o)return null;var s=o.length;if(gO(s))return null;for(var l=new Array(s);s-- >0;)l[s]=o[s];return l},isTypedArray:UJ,isFileList:LJ},EI=bT;function g2(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var v2=function(o,s,l){if(!s)return o;var p;if(l)p=l(s);else if(EI.isURLSearchParams(s))p=s.toString();else{var _=[];EI.forEach(s,function(A,k){A!=null&&(EI.isArray(A)?k+="[]":A=[A],EI.forEach(A,function(j){EI.isDate(j)?j=j.toISOString():EI.isObject(j)&&(j=JSON.stringify(j)),_.push(g2(k)+"="+g2(j))}))}),p=_.join("&")}if(p){var b=o.indexOf("#");b!==-1&&(o=o.slice(0,b)),o+=(o.indexOf("?")===-1?"?":"&")+p}return o},xJ=bT;function yO(){this.handlers=[]}yO.prototype.use=function(o,s,l){return this.handlers.push({fulfilled:o,rejected:s,synchronous:!!l&&l.synchronous,runWhen:l?l.runWhen:null}),this.handlers.length-1},yO.prototype.eject=function(o){this.handlers[o]&&(this.handlers[o]=null)},yO.prototype.forEach=function(o){xJ.forEach(this.handlers,function(s){s!==null&&o(s)})};var jJ=yO,VJ=bT,y2=bT;function mI(o,s,l,p,_){Error.call(this),this.message=o,this.name="AxiosError",s&&(this.code=s),l&&(this.config=l),p&&(this.request=p),_&&(this.response=_)}y2.inherits(mI,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var b2=mI.prototype,T2={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(o){T2[o]={value:o}}),Object.defineProperties(mI,T2),Object.defineProperty(b2,"isAxiosError",{value:!0}),mI.from=function(o,s,l,p,_,b){var A=Object.create(b2);return y2.toFlatObject(o,A,function(k){return k!==Error.prototype}),mI.call(A,o.message,s,l,p,_),A.name=o.name,b&&Object.assign(A,b),A};var _I=mI,S2={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},TS=bT,R2=function(o,s){s=s||new FormData;var l=[];function p(_){return _===null?"":TS.isDate(_)?_.toISOString():TS.isArrayBuffer(_)||TS.isTypedArray(_)?typeof Blob=="function"?new Blob([_]):Buffer.from(_):_}return function _(b,A){if(TS.isPlainObject(b)||TS.isArray(b)){if(l.indexOf(b)!==-1)throw Error("Circular reference detected in "+A);l.push(b),TS.forEach(b,function(k,j){if(!TS.isUndefined(k)){var z,H=A?A+"."+j:j;if(k&&!A&&typeof k=="object"){if(TS.endsWith(j,"{}"))k=JSON.stringify(k);else if(TS.endsWith(j,"[]")&&(z=TS.toArray(k)))return void z.forEach(function($){!TS.isUndefined($)&&s.append(H,p($))})}_(k,H)}}),l.pop()}else s.append(A,p(b))}(o),s},JP=_I,bO=bT,FJ=bO.isStandardBrowserEnv()?{write:function(o,s,l,p,_,b){var A=[];A.push(o+"="+encodeURIComponent(s)),bO.isNumber(l)&&A.push("expires="+new Date(l).toGMTString()),bO.isString(p)&&A.push("path="+p),bO.isString(_)&&A.push("domain="+_),b===!0&&A.push("secure"),document.cookie=A.join("; ")},read:function(o){var s=document.cookie.match(new RegExp("(^|;\\s*)("+o+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove:function(o){this.write(o,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},BJ=function(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)},GJ=function(o,s){return s?o.replace(/\/+$/,"")+"/"+s.replace(/^\/+/,""):o},I2=function(o,s){return o&&!BJ(s)?GJ(o,s):s},XP=bT,qJ=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],O2=bT,WJ=O2.isStandardBrowserEnv()?function(){var o,s=/(msie|trident)/i.test(navigator.userAgent),l=document.createElement("a");function p(_){var b=_;return s&&(l.setAttribute("href",b),b=l.href),l.setAttribute("href",b),{href:l.href,protocol:l.protocol?l.protocol.replace(/:$/,""):"",host:l.host,search:l.search?l.search.replace(/^\?/,""):"",hash:l.hash?l.hash.replace(/^#/,""):"",hostname:l.hostname,port:l.port,pathname:l.pathname.charAt(0)==="/"?l.pathname:"/"+l.pathname}}return o=p(window.location.href),function(_){var b=O2.isString(_)?p(_):_;return b.protocol===o.protocol&&b.host===o.host}}():function(){return!0},QP=_I;function A2(o){QP.call(this,o??"canceled",QP.ERR_CANCELED),this.name="CanceledError"}bT.inherits(A2,QP,{__CANCEL__:!0});var TO=A2,i0=bT,KJ=function(o,s,l){var p=l.config.validateStatus;l.status&&p&&!p(l.status)?s(new JP("Request failed with status code "+l.status,[JP.ERR_BAD_REQUEST,JP.ERR_BAD_RESPONSE][Math.floor(l.status/100)-4],l.config,l.request,l)):o(l)},HJ=FJ,YJ=v2,zJ=I2,JJ=function(o){var s,l,p,_={};return o&&XP.forEach(o.split(`
`),function(b){if(p=b.indexOf(":"),s=XP.trim(b.substr(0,p)).toLowerCase(),l=XP.trim(b.substr(p+1)),s){if(_[s]&&qJ.indexOf(s)>=0)return;_[s]=s==="set-cookie"?(_[s]?_[s]:[]).concat([l]):_[s]?_[s]+", "+l:l}}),_},XJ=WJ,QJ=S2,zS=_I,$J=TO,ZJ=function(o){var s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return s&&s[1]||""},t7=function(o){return new Promise(function(s,l){var p,_=o.data,b=o.headers,A=o.responseType;function k(){o.cancelToken&&o.cancelToken.unsubscribe(p),o.signal&&o.signal.removeEventListener("abort",p)}i0.isFormData(_)&&i0.isStandardBrowserEnv()&&delete b["Content-Type"];var j=new XMLHttpRequest;if(o.auth){var z=o.auth.username||"",H=o.auth.password?unescape(encodeURIComponent(o.auth.password)):"";b.Authorization="Basic "+btoa(z+":"+H)}var $=zJ(o.baseURL,o.url);function ue(){if(j){var Gi="getAllResponseHeaders"in j?JJ(j.getAllResponseHeaders()):null,_o={data:A&&A!=="text"&&A!=="json"?j.response:j.responseText,status:j.status,statusText:j.statusText,headers:Gi,config:o,request:j};KJ(function(_f){s(_f),k()},function(_f){l(_f),k()},_o),j=null}}if(j.open(o.method.toUpperCase(),YJ($,o.params,o.paramsSerializer),!0),j.timeout=o.timeout,"onloadend"in j?j.onloadend=ue:j.onreadystatechange=function(){j&&j.readyState===4&&(j.status!==0||j.responseURL&&j.responseURL.indexOf("file:")===0)&&setTimeout(ue)},j.onabort=function(){j&&(l(new zS("Request aborted",zS.ECONNABORTED,o,j)),j=null)},j.onerror=function(){l(new zS("Network Error",zS.ERR_NETWORK,o,j,j)),j=null},j.ontimeout=function(){var Gi=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded",_o=o.transitional||QJ;o.timeoutErrorMessage&&(Gi=o.timeoutErrorMessage),l(new zS(Gi,_o.clarifyTimeoutError?zS.ETIMEDOUT:zS.ECONNABORTED,o,j)),j=null},i0.isStandardBrowserEnv()){var Ei=(o.withCredentials||XJ($))&&o.xsrfCookieName?HJ.read(o.xsrfCookieName):void 0;Ei&&(b[o.xsrfHeaderName]=Ei)}"setRequestHeader"in j&&i0.forEach(b,function(Gi,_o){_===void 0&&_o.toLowerCase()==="content-type"?delete b[_o]:j.setRequestHeader(_o,Gi)}),i0.isUndefined(o.withCredentials)||(j.withCredentials=!!o.withCredentials),A&&A!=="json"&&(j.responseType=o.responseType),typeof o.onDownloadProgress=="function"&&j.addEventListener("progress",o.onDownloadProgress),typeof o.onUploadProgress=="function"&&j.upload&&j.upload.addEventListener("progress",o.onUploadProgress),(o.cancelToken||o.signal)&&(p=function(Gi){j&&(l(!Gi||Gi&&Gi.type?new $J:Gi),j.abort(),j=null)},o.cancelToken&&o.cancelToken.subscribe(p),o.signal&&(o.signal.aborted?p():o.signal.addEventListener("abort",p))),_||(_=null);var Fi=ZJ($);Fi&&["http","https","file"].indexOf(Fi)===-1?l(new zS("Unsupported protocol "+Fi+":",zS.ERR_BAD_REQUEST,o)):j.send(_)})},mT=bT,w2=function(o,s){VJ.forEach(o,function(l,p){p!==s&&p.toUpperCase()===s.toUpperCase()&&(o[s]=l,delete o[p])})},C2=_I,e7=R2,n7={"Content-Type":"application/x-www-form-urlencoded"};function N2(o,s){!mT.isUndefined(o)&&mT.isUndefined(o["Content-Type"])&&(o["Content-Type"]=s)}var P2,SO={transitional:S2,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(P2=t7),P2),transformRequest:[function(o,s){if(w2(s,"Accept"),w2(s,"Content-Type"),mT.isFormData(o)||mT.isArrayBuffer(o)||mT.isBuffer(o)||mT.isStream(o)||mT.isFile(o)||mT.isBlob(o))return o;if(mT.isArrayBufferView(o))return o.buffer;if(mT.isURLSearchParams(o))return N2(s,"application/x-www-form-urlencoded;charset=utf-8"),o.toString();var l,p=mT.isObject(o),_=s&&s["Content-Type"];if((l=mT.isFileList(o))||p&&_==="multipart/form-data"){var b=this.env&&this.env.FormData;return e7(l?{"files[]":o}:o,b&&new b)}return p||_==="application/json"?(N2(s,"application/json"),function(A,k,j){if(mT.isString(A))try{return(k||JSON.parse)(A),mT.trim(A)}catch(z){if(z.name!=="SyntaxError")throw z}return(j||JSON.stringify)(A)}(o)):o}],transformResponse:[function(o){var s=this.transitional||SO.transitional,l=s&&s.silentJSONParsing,p=s&&s.forcedJSONParsing,_=!l&&this.responseType==="json";if(_||p&&mT.isString(o)&&o.length)try{return JSON.parse(o)}catch(b){if(_)throw b.name==="SyntaxError"?C2.from(b,C2.ERR_BAD_RESPONSE,this,null,this.response):b}return o}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:null},validateStatus:function(o){return o>=200&&o<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};mT.forEach(["delete","get","head"],function(o){SO.headers[o]={}}),mT.forEach(["post","put","patch"],function(o){SO.headers[o]=mT.merge(n7)});var $P=SO,r7=bT,i7=$P,D2=function(o){return!(!o||!o.__CANCEL__)},k2=bT,ZP=function(o,s,l){var p=this||i7;return r7.forEach(l,function(_){o=_.call(p,o,s)}),o},o7=D2,s7=$P,a7=TO;function tD(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new a7}var QT=bT,L2=function(o,s){s=s||{};var l={};function p(z,H){return QT.isPlainObject(z)&&QT.isPlainObject(H)?QT.merge(z,H):QT.isPlainObject(H)?QT.merge({},H):QT.isArray(H)?H.slice():H}function _(z){return QT.isUndefined(s[z])?QT.isUndefined(o[z])?void 0:p(void 0,o[z]):p(o[z],s[z])}function b(z){if(!QT.isUndefined(s[z]))return p(void 0,s[z])}function A(z){return QT.isUndefined(s[z])?QT.isUndefined(o[z])?void 0:p(void 0,o[z]):p(void 0,s[z])}function k(z){return z in s?p(o[z],s[z]):z in o?p(void 0,o[z]):void 0}var j={url:b,method:b,data:b,baseURL:A,transformRequest:A,transformResponse:A,paramsSerializer:A,timeout:A,timeoutMessage:A,withCredentials:A,adapter:A,responseType:A,xsrfCookieName:A,xsrfHeaderName:A,onUploadProgress:A,onDownloadProgress:A,decompress:A,maxContentLength:A,maxBodyLength:A,beforeRedirect:A,transport:A,httpAgent:A,httpsAgent:A,cancelToken:A,socketPath:A,responseEncoding:A,validateStatus:k};return QT.forEach(Object.keys(o).concat(Object.keys(s)),function(z){var H=j[z]||_,$=H(z);QT.isUndefined($)&&H!==k||(l[z]=$)}),l},M2="0.27.2",c7=M2,dR=_I,sD={};["object","boolean","number","function","string","symbol"].forEach(function(o,s){sD[o]=function(l){return typeof l===o||"a"+(s<1?"n ":" ")+o}});var U2={};sD.transitional=function(o,s,l){function p(_,b){return"[Axios v"+c7+"] Transitional option '"+_+"'"+b+(l?". "+l:"")}return function(_,b,A){if(o===!1)throw new dR(p(b," has been removed"+(s?" in "+s:"")),dR.ERR_DEPRECATED);return s&&!U2[b]&&(U2[b]=!0,console.warn(p(b," has been deprecated since v"+s+" and will be removed in the near future"))),!o||o(_,b,A)}};var x2=bT,u7=v2,j2=jJ,V2=function(o){return tD(o),o.headers=o.headers||{},o.data=ZP.call(o,o.data,o.headers,o.transformRequest),o.headers=k2.merge(o.headers.common||{},o.headers[o.method]||{},o.headers),k2.forEach(["delete","get","head","post","put","patch","common"],function(s){delete o.headers[s]}),(o.adapter||s7.adapter)(o).then(function(s){return tD(o),s.data=ZP.call(o,s.data,s.headers,o.transformResponse),s},function(s){return o7(s)||(tD(o),s&&s.response&&(s.response.data=ZP.call(o,s.response.data,s.response.headers,o.transformResponse))),Promise.reject(s)})},RO=L2,d7=I2,F2={assertOptions:function(o,s,l){if(typeof o!="object")throw new dR("options must be an object",dR.ERR_BAD_OPTION_VALUE);for(var p=Object.keys(o),_=p.length;_-- >0;){var b=p[_],A=s[b];if(A){var k=o[b],j=k===void 0||A(k,b,o);if(j!==!0)throw new dR("option "+b+" must be "+j,dR.ERR_BAD_OPTION_VALUE)}else if(l!==!0)throw new dR("Unknown option "+b,dR.ERR_BAD_OPTION)}},validators:sD},gI=F2.validators;function vI(o){this.defaults=o,this.interceptors={request:new j2,response:new j2}}vI.prototype.request=function(o,s){typeof o=="string"?(s=s||{}).url=o:s=o||{},(s=RO(this.defaults,s)).method?s.method=s.method.toLowerCase():this.defaults.method?s.method=this.defaults.method.toLowerCase():s.method="get";var l=s.transitional;l!==void 0&&F2.assertOptions(l,{silentJSONParsing:gI.transitional(gI.boolean),forcedJSONParsing:gI.transitional(gI.boolean),clarifyTimeoutError:gI.transitional(gI.boolean)},!1);var p=[],_=!0;this.interceptors.request.forEach(function($){typeof $.runWhen=="function"&&$.runWhen(s)===!1||(_=_&&$.synchronous,p.unshift($.fulfilled,$.rejected))});var b,A=[];if(this.interceptors.response.forEach(function($){A.push($.fulfilled,$.rejected)}),!_){var k=[V2,void 0];for(Array.prototype.unshift.apply(k,p),k=k.concat(A),b=Promise.resolve(s);k.length;)b=b.then(k.shift(),k.shift());return b}for(var j=s;p.length;){var z=p.shift(),H=p.shift();try{j=z(j)}catch($){H($);break}}try{b=V2(j)}catch($){return Promise.reject($)}for(;A.length;)b=b.then(A.shift(),A.shift());return b},vI.prototype.getUri=function(o){o=RO(this.defaults,o);var s=d7(o.baseURL,o.url);return u7(s,o.params,o.paramsSerializer)},x2.forEach(["delete","get","head","options"],function(o){vI.prototype[o]=function(s,l){return this.request(RO(l||{},{method:o,url:s,data:(l||{}).data}))}}),x2.forEach(["post","put","patch"],function(o){function s(l){return function(p,_,b){return this.request(RO(b||{},{method:o,headers:l?{"Content-Type":"multipart/form-data"}:{},url:p,data:_}))}}vI.prototype[o]=s(),vI.prototype[o+"Form"]=s(!0)});var l7=vI,h7=TO;function yI(o){if(typeof o!="function")throw new TypeError("executor must be a function.");var s;this.promise=new Promise(function(p){s=p});var l=this;this.promise.then(function(p){if(l._listeners){var _,b=l._listeners.length;for(_=0;_<b;_++)l._listeners[_](p);l._listeners=null}}),this.promise.then=function(p){var _,b=new Promise(function(A){l.subscribe(A),_=A}).then(p);return b.cancel=function(){l.unsubscribe(_)},b},o(function(p){l.reason||(l.reason=new h7(p),s(l.reason))})}yI.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},yI.prototype.subscribe=function(o){this.reason?o(this.reason):this._listeners?this._listeners.push(o):this._listeners=[o]},yI.prototype.unsubscribe=function(o){if(this._listeners){var s=this._listeners.indexOf(o);s!==-1&&this._listeners.splice(s,1)}},yI.source=function(){var o;return{token:new yI(function(s){o=s}),cancel:o}};var p7=yI,f7=bT,B2=bT,E7=E2,IO=l7,m7=L2,jT=function o(s){var l=new IO(s),p=E7(IO.prototype.request,l);return B2.extend(p,IO.prototype,l),B2.extend(p,l),p.create=function(_){return o(m7(s,_))},p}($P);jT.Axios=IO,jT.CanceledError=TO,jT.CancelToken=p7,jT.isCancel=D2,jT.VERSION=M2,jT.toFormData=R2,jT.AxiosError=_I,jT.Cancel=jT.CanceledError,jT.all=function(o){return Promise.all(o)},jT.spread=function(o){return function(s){return o.apply(null,s)}},jT.isAxiosError=function(o){return f7.isObject(o)&&o.isAxiosError===!0},GP.exports=jT,GP.exports.default=jT;var VT=GP.exports;class _7{constructor(s){_t(this,"logger",void 0),_t(this,"prefixLists",[]),this.logger=s}debug(){for(var s=arguments.length,l=new Array(s),p=0;p<s;p++)l[p]=arguments[p];this.logger.debug(...this.prefixLists,...l)}info(){for(var s=arguments.length,l=new Array(s),p=0;p<s;p++)l[p]=arguments[p];this.logger.info(...this.prefixLists,...l)}warning(){for(var s=arguments.length,l=new Array(s),p=0;p<s;p++)l[p]=arguments[p];this.logger.warning(...this.prefixLists,...l)}error(){for(var s=arguments.length,l=new Array(s),p=0;p<s;p++)l[p]=arguments[p];this.logger.error(...this.prefixLists,...l)}prefix(s){return this.prefixLists.push(s),this}popPrefix(){return this.prefixLists.pop(),this}}class R_{constructor(){_t(this,"_events",{}),_t(this,"addListener",this.on)}getListeners(s){return this._events[s]?this._events[s].map(l=>l.listener):[]}on(s,l){this._events[s]||(this._events[s]=[]);const p=this._events[s];this._indexOfListener(p,l)===-1&&p.push({listener:l,once:!1})}once(s,l){this._events[s]||(this._events[s]=[]);const p=this._events[s];this._indexOfListener(p,l)===-1&&p.push({listener:l,once:!0})}off(s,l){if(!this._events[s])return;const p=this._events[s],_=this._indexOfListener(p,l);_!==-1&&p.splice(_,1),this._events[s].length===0&&delete this._events[s]}removeAllListeners(s){s?delete this._events[s]:this._events={}}emit(s){this._events[s]||(this._events[s]=[]);const l=this._events[s].map(A=>A);for(var p=arguments.length,_=new Array(p>1?p-1:0),b=1;b<p;b++)_[b-1]=arguments[b];for(let A=0;A<l.length;A+=1){const k=l[A];k.once&&this.off(s,k.listener),k.listener.apply(this,_||[])}}safeEmit(s){for(var l=arguments.length,p=new Array(l>1?l-1:0),_=1;_<l;_++)p[_-1]=arguments[_];[...this._events[s]||[]].forEach(b=>{b.once&&this.off(s,b.listener);try{b.listener.apply(this,p)}catch(A){_n.error("safeEmit event:".concat(s," error ").concat(A==null?void 0:A.toString()))}})}_indexOfListener(s,l){let p=s.length;for(;p--;)if(s[p].listener===l)return p;return-1}}const OO=new class extends R_{reportLogUploadError(o){this.emit("REPORT_LOG_UPLOAD",o)}};let Di;(function(o){o.UNEXPECTED_ERROR="UNEXPECTED_ERROR",o.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",o.TIMEOUT="TIMEOUT",o.INVALID_PARAMS="INVALID_PARAMS",o.NOT_READABLE="NOT_READABLE",o.NOT_SUPPORTED="NOT_SUPPORTED",o.INVALID_OPERATION="INVALID_OPERATION",o.OPERATION_ABORTED="OPERATION_ABORTED",o.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",o.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",o.NETWORK_ERROR="NETWORK_ERROR",o.NETWORK_TIMEOUT="NETWORK_TIMEOUT",o.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",o.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",o.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",o.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",o.ELECTRON_IS_NULL="ELECTRON_IS_NULL",o.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",o.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",o.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",o.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",o.PERMISSION_DENIED="PERMISSION_DENIED",o.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",o.TRACK_IS_DISABLED="TRACK_IS_DISABLED",o.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",o.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",o.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",o.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",o.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",o.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",o.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",o.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",o.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",o.UID_CONFLICT="UID_CONFLICT",o.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",o.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",o.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",o.INVALID_TRACK="INVALID_TRACK",o.SENDER_NOT_FOUND="SENDER_NOT_FOUND",o.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",o.SET_ANSWER_FAILED="SET_ANSWER_FAILED",o.ICE_FAILED="ICE_FAILED",o.PC_CLOSED="PC_CLOSED",o.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",o.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",o.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",o.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",o.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",o.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",o.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",o.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",o.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",o.INVALID_REMOTE_USER="INVALID_REMOTE_USER",o.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",o.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",o.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",o.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",o.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",o.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",o.WS_ABORT="WS_ABORT",o.WS_DISCONNECT="WS_DISCONNECT",o.WS_ERR="WS_ERR",o.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",o.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",o.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",o.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",o.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",o.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",o.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",o.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",o.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",o.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",o.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",o.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",o.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",o.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",o.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",o.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",o.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",o.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",o.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",o.INVALID_PLUGIN="INVALID_PLUGIN",o.DISCONNECT_P2P="DISCONNECT_P2P",o.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",o.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",o.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",o.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",o.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",o.PROHIBITED_OPERATION="PROHIBITED_OPERATION",o.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"})(Di||(Di={}));class ga extends Error{constructor(s){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",p=arguments.length>2?arguments[2]:void 0;super(l),_t(this,"code",void 0),_t(this,"message",void 0),_t(this,"data",void 0),_t(this,"name","AgoraRTCException"),this.code=s,this.message="AgoraRTCError ".concat(this.code,": ").concat(l),this.data=p}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return s==="error"&&_n.error(this.toString()),s==="warning"&&_n.warning(this.toString()),this}throw(){throw this.print(),this}}const x_={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function uD(o,s){const l=Math.floor(s.timeout*Math.pow(s.timeoutFactor,o));return Math.min(s.maxRetryTimeout,l)}function SS(o,s,l,p){const _=Object.assign({},x_,p);let b=_.timeout;const A=async()=>{await function(z){return new RE(H=>{window.setTimeout(H,z)})}(b),b*=_.timeoutFactor,b=Math.min(_.maxRetryTimeout,b)};let k=!1;const j=new RE(async(z,H)=>{s=s||(()=>!1),l=l||(()=>!0);for(let $=0;$<_.maxRetryCount;$+=1){if(k)return H(new ga(Di.OPERATION_ABORTED));try{const ue=await o();if(!s(ue,$)||$+1===_.maxRetryCount)return z(ue);await A()}catch(ue){if(!l(ue,$)||$+1===_.maxRetryCount)return H(ue);await A()}}});return j.cancel=()=>k=!0,j}function ED(){const o=new Date;return o.toTimeString().split(" ")[0]+":"+o.getMilliseconds()}function G2(){const o=new Date,s=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return s?(s==null?void 0:s[0])+":"+o.getUTCMilliseconds():o.toTimeString().split(" ")[0]+":"+o.getMilliseconds()}const $T={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},AO=Date.now(),o0=o=>{for(const s in $T)if(Object.prototype.hasOwnProperty.call($T,s)&&$T[s]===o)return s;return"DEFAULT"},_n=new class{constructor(){_t(this,"proxyServerURL",void 0),_t(this,"logLevel",$T.DEBUG),_t(this,"uploadState","collecting"),_t(this,"uploadLogWaitingList",[]),_t(this,"uploadLogUploadingList",[]),_t(this,"uploadErrorCount",0),_t(this,"currentLogID",0),_t(this,"url",void 0),_t(this,"extLog",(o,s)=>{this.appendLogToWaitingList(o,...s)})}debug(){for(var o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];const p=[$T.DEBUG].concat(s);this.log.apply(this,p)}info(){for(var o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];const p=[$T.INFO].concat(s);this.log.apply(this,p)}warning(){for(var o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];const p=[$T.WARNING].concat(s);this.log.apply(this,p)}error(){for(var o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];const p=[$T.ERROR].concat(s);this.log.apply(this,p)}upload(){for(var o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];const p=[$T.DEBUG].concat(s);this.uploadLog.apply(this,p)}setLogLevel(o){o=Math.min(Math.max(0,o),4),this.logLevel=o}enableLogUpload(){p_("UPLOAD_LOG",!0)}disableLogUpload(){p_("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(o){this.proxyServerURL=o}prefix(o){return new _7(this).prefix(o)}log(){for(var o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];if(Date.now()-AO<100)return void setTimeout(()=>{this.log(...s)},Date.now()-AO);const p=Math.max(0,Math.min(4,s[0]));if(s[0]=ED()+" Agora-SDK [".concat(o0(p),"]:"),this.appendLogToWaitingList(p,...s),p<this.logLevel)return;const _=ED()+" %cAgora-SDK [".concat(o0(p),"]:");let b=[];if(!_u("USE_NEW_LOG"))switch(p){case $T.DEBUG:b=[_,"color: #64B5F6;"].concat(s.slice(1)),console.log.apply(console,b);break;case $T.INFO:b=[_,"color: #1E88E5; font-weight: bold;"].concat(s.slice(1)),console.log.apply(console,b);break;case $T.WARNING:b=[_,"color: #FB8C00; font-weight: bold;"].concat(s.slice(1)),console.warn.apply(console,b);break;case $T.ERROR:b=[_,"color: #B00020; font-weight: bold;"].concat(s.slice(1)),console.error.apply(console,b)}}uploadLog(){for(var o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];if(Date.now()-AO<100)return void setTimeout(()=>{this.uploadLog(...s)},Date.now()-AO);const p=Math.max(0,Math.min(4,s[0]));s[0]=ED()+" Agora-SDK [".concat(o0(p),"]:"),this.appendLogToWaitingList(p,...s)}appendLogToWaitingList(o){if(!_u("UPLOAD_LOG"))return;for(var s=arguments.length,l=new Array(s>1?s-1:0),p=1;p<s;p++)l[p-1]=arguments[p];Array.isArray(l[0])?l[0][0]=G2()+" Agora-SDK [".concat(o0(o),"]:"):l[0]=G2()+" Agora-SDK [".concat(o0(o),"]:");let _="";l.forEach(b=>{typeof b=="object"&&(b=JSON.stringify(b)),_+="".concat(b," ")}),this.uploadLogWaitingList.push({payload_str:_,log_level:o,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const o=this.uploadLogUploadingList,s={sdk_version:ZT,process_id:_u("PROCESS_ID"),payload:JSON.stringify(o)};return SS(async()=>{const l=await VT.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(_u("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(_u("LOG_UPLOAD_SERVER"),"/upload/v1")),s,{responseType:"text"});if(l.data!=="OK"){const p=new Error("unexpected upload log response");throw p.response=l,p}},()=>(this.uploadLogUploadingList=[],!1),l=>(l.response?OO.reportLogUploadError({status:l.response.status,data:l.response.data,headers:l.response.headers,message:l.message}):l.request?OO.reportLogUploadError({status:l.request.status,message:l.message}):OO.reportLogUploadError({status:-1,message:l.message}),!0),{timeout:_u("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:_u("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,_u("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),_u("UPLOAD_LOG_INTERVAL"))}).catch(o=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),_u("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),_u("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}},_D="v4.18.2-0-g8d83af1d-dirty(7/11/2023, 7:07:15 PM)",ZT=function(o){if(o.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return o;const s=o.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(s&&s[1]&&s[2]){const p=s[1],_=s[2];return"".concat(p,".").concat(_)}const l=o.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(l&&l[1]&&l[2]){const p=l[1],_=l[2];return"".concat(p,".").concat(100*(Number(_)+1))}return"4.0.0.999"}("4.18.2"),vD=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),q2=["CHINA","GLOBAL"],FT=function(){const o="us".concat("erna","me"),s="pa".concat("sswo","rd"),l=["t","s","t"];l.splice(1,0,"e");const p=l.join(""),_=[];for(let k=0;k<6;k++)_.push("1");const b=_.join(""),A={};return A[o]=p,A[s]=b,Object.assign(A,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=FT;const g7={"90p":JE(160,90),"90p_1":JE(160,90),"120p":JE(160,120,15,30,65),"120p_1":JE(160,120,15,30,65),"120p_3":JE(120,120,15,30,50),"120p_4":JE(212,120),"180p":JE(320,180,15,30,140),"180p_1":JE(320,180,15,30,140),"180p_3":JE(180,180,15,30,100),"180p_4":JE(240,180,15,30,120),"240p":JE(320,240,15,40,200),"240p_1":JE(320,240,15,40,200),"240p_3":JE(240,240,15,40,140),"240p_4":JE(424,240,15,40,220),"360p":JE(640,360,15,80,400),"360p_1":JE(640,360,15,80,400),"360p_3":JE(360,360,15,80,260),"360p_4":JE(640,360,30,80,600),"360p_6":JE(360,360,30,80,400),"360p_7":JE(480,360,15,80,320),"360p_8":JE(480,360,30,80,490),"360p_9":JE(640,360,15,80,800),"360p_10":JE(640,360,24,80,800),"360p_11":JE(640,360,24,80,1e3),"480p":JE(640,480,15,100,500),"480p_1":JE(640,480,15,100,500),"480p_2":JE(640,480,30,100,1e3),"480p_3":JE(480,480,15,100,400),"480p_4":JE(640,480,30,100,750),"480p_6":JE(480,480,30,100,600),"480p_8":JE(848,480,15,100,610),"480p_9":JE(848,480,30,100,930),"480p_10":JE(640,480,10,100,400),"720p":JE(1280,720,15,120,1130),"720p_1":JE(1280,720,15,120,1130),"720p_2":JE(1280,720,30,120,2e3),"720p_3":JE(1280,720,30,120,1710),"720p_5":JE(960,720,15,120,910),"720p_6":JE(960,720,30,120,1380),"1080p":JE(1920,1080,15,120,2080),"1080p_1":JE(1920,1080,15,120,2080),"1080p_2":JE(1920,1080,30,120,3e3),"1080p_3":JE(1920,1080,30,120,3150),"1080p_5":JE(1920,1080,60,120,4780),"1440p":JE(2560,1440,30,120,4850),"1440p_1":JE(2560,1440,30,120,4850),"1440p_2":JE(2560,1440,60,120,7350),"4k":JE(3840,2160,30,120,8910),"4k_1":JE(3840,2160,30,120,8910),"4k_3":JE(3840,2160,60,120,13500)},v7={"480p":dS(640,480,5),"480p_1":dS(640,480,5),"480p_2":dS(640,480,30),"480p_3":dS(640,480,15),"720p":dS(1280,720,5),"720p_1":dS(1280,720,5),"720p_2":dS(1280,720,30),"720p_3":dS(1280,720,15),"1080p":dS(1920,1080,5),"1080p_1":dS(1920,1080,5),"1080p_2":dS(1920,1080,30),"1080p_3":dS(1920,1080,15)},y7={"1SL1TL":TD(1,1),"3SL3TL":TD(3,3),"2SL3TL":TD(2,3)};function VR(o){return o||(o="480p_1"),typeof o=="string"?Object.assign({},g7[o]):o}function yD(o){return typeof o=="string"?Object.assign({},v7[o]):o}function wO(o){return typeof o=="string"?Object.assign({},y7[o]):o}const b7={speech_low_quality:bI(16e3,!1),speech_standard:bI(32e3,!1,18),music_standard:bI(48e3,!1),standard_stereo:bI(48e3,!0,56),high_quality:bI(48e3,!1,128),high_quality_stereo:bI(48e3,!0,192)};function CO(o){return typeof o=="string"?Object.assign({},b7[o]):o}function p_(o,s,l){Object.keys(IT).includes(o)&&(!l&&Object.keys(FR).includes(o)||(IT[o]=s))}function _u(o){return IT[o]}const IT={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:q2,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION:2e3,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}},FR={};function bI(o,s,l){return{sampleRate:o,stereo:s,bitrate:l}}function JE(o,s,l,p,_){return{width:o,height:s,frameRate:l,bitrateMin:p,bitrateMax:_}}function dS(o,s,l,p,_){return{width:{max:o},height:{max:s},frameRate:l,bitrateMin:p,bitrateMax:_}}function TD(o,s){return{numSpatialLayers:o,numTemporalLayers:s}}vD||(IT.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],IT.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],IT.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],IT.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],IT.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],IT.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],IT.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",IT.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",IT.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",IT.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",IT.AREAS=["NORTH_AMERICA","OVERSEA"]);const T7=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],BR=[],s0=[];function GR(o,s){return!!s&&BR.some(l=>l.uid===o&&l.channelName===s)}var S7=L0,R7=yS,I7=cE,SD=function(o,s,l){var p=S7(s);p in o?R7.f(o,p,I7(0,l)):o[p]=l},W2=DN,O7=oR,A7=SD,w7=_a.Array,C7=Math.max,K2=function(o,s,l){for(var p=O7(o),_=W2(s,p),b=W2(l===void 0?p:l,p),A=w7(C7(b-_,0)),k=0;_<b;_++,k++)A7(A,k,o[_]);return A.length=k,A},H2=K2,N7=Math.floor,RD=function(o,s){var l=o.length,p=N7(l/2);return l<8?P7(o,s):D7(o,RD(H2(o,0,p),s),RD(H2(o,p),s),s)},P7=function(o,s){for(var l,p,_=o.length,b=1;b<_;){for(p=b,l=o[b];p&&s(o[p-1],l)>0;)o[p]=o[--p];p!==b++&&(o[p]=l)}return o},D7=function(o,s,l,p){for(var _=s.length,b=l.length,A=0,k=0;A<_||k<b;)o[A+k]=A<_&&k<b?p(s[A],l[k])<=0?s[A++]:l[k++]:A<_?s[A++]:l[k++];return o},k7=RD,Y2=CR.match(/firefox\/(\d+)/i),L7=!!Y2&&+Y2[1],M7=/MSIE|Trident/.test(CR),z2=CR.match(/AppleWebKit\/(\d+)\./),U7=!!z2&&+z2[1],x7=yT,J2=_r,j7=qS,V7=iR,F7=oR,X2=oI,ID=f,B7=k7,G7=AN,Q2=L7,q7=M7,$2=eI,Z2=U7,lR=[],_j=J2(lR.sort),W7=J2(lR.push),K7=ID(function(){lR.sort(void 0)}),H7=ID(function(){lR.sort(null)}),Y7=G7("sort"),$j=!ID(function(){if($2)return $2<70;if(!(Q2&&Q2>3)){if(q7)return!0;if(Z2)return Z2<603;var o,s,l,p,_="";for(o=65;o<76;o++){switch(s=String.fromCharCode(o),o){case 66:case 69:case 70:case 72:l=3;break;case 68:case 71:l=4;break;default:l=2}for(p=0;p<47;p++)lR.push({k:s+p,v:l})}for(lR.sort(function(b,A){return A.v-b.v}),p=0;p<lR.length;p++)s=lR[p].k.charAt(0),_.charAt(_.length-1)!==s&&(_+=s);return _!=="DGBEFHACIJK"}});x7({target:"Array",proto:!0,forced:K7||!H7||!Y7||!$j},{sort:function(o){o!==void 0&&j7(o);var s=V7(this);if($j)return o===void 0?_j(s):_j(s,o);var l,p,_=[],b=F7(s);for(p=0;p<b;p++)p in s&&W7(_,s[p]);for(B7(_,function(A){return function(k,j){return j===void 0?-1:k===void 0?1:A!==void 0?+A(k,j)||0:X2(k)>X2(j)?1:-1}}(o)),l=_.length,p=0;p<l;)s[p]=_[p++];for(;p<b;)delete s[p++];return s}});var z7=sR("Array").sort,J7=_e,X7=z7,OD=Array.prototype,AD=function(o){var s=o.sort;return o===OD||J7(OD,o)&&s===OD.sort?X7:s};function TI(o,s){if(typeof o!="boolean")throw new ga(Di.INVALID_PARAMS,"Invalid ".concat(s,": The value is of the boolean type."))}function Eg(o,s,l){if(!l.includes(o))throw new ga(Di.INVALID_PARAMS,"".concat(s," can only be set as ").concat(JSON.stringify(l)))}function E_(o,s){let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4,_=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(o<l||o>p||_&&!Q7(o))throw new ga(Di.INVALID_PARAMS,"invalid ".concat(s,": the value range is [").concat(l,", ").concat(p,"]. integer only"))}function wD(o,s){if(typeof o!="number"){if(!(o.min||o.max||o.ideal||o.exact))throw new ga(Di.INVALID_PARAMS,"".concat(s," is not a valid ConstrainLong"));o.min!==void 0&&E_(o.min,"".concat(s,".min"),0,1/0),o.max!==void 0&&E_(o.max,"".concat(s,".max"),1,1/0),o.exact!==void 0&&E_(o.exact,"".concat(s,".exact"),1,1/0),o.ideal!==void 0&&E_(o.ideal,"".concat(s,".ideal"),1,1/0)}else E_(o,s,1,1/0)}function eT(o,s){let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,_=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(o==null)throw new ga(Di.INVALID_PARAMS,"".concat(s||"param"," cannot be empty"));if(!tV(o,l,p,_))throw new ga(Di.INVALID_PARAMS,"Invalid ".concat(s||"string param",": Length of the string: [").concat(l,",").concat(p,"].").concat(_?" ASCII characters only.":""))}function JS(o,s){if(!Array.isArray(o))throw new ga(Di.INVALID_PARAMS,"".concat(s," should be an array"))}function CD(o){if(typeof o!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(o))throw _n.error("Invalid Channel Name ".concat(o)),new ga(Di.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function ND(o){if(s=o,!(typeof s=="number"&&Math.floor(s)===s&&0<=s&&s<=4294967295||tV(o,1,255)))throw _n.error("Invalid UID ".concat(o," ").concat(typeof o)),new ga(Di.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var s;typeof o=="string"&&_n.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function b_(o){return o==null}function tV(o){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,p=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof o=="string"&&o.length<=l&&o.length>=s&&(!p||$7(o))}function Q7(o){return typeof o=="number"&&o%1==0}function $7(o){if(typeof o!="string")return!1;for(let s=0;s<o.length;s+=1){const l=o.charCodeAt(s);if(l<0||l>255)return!1}return!0}let eV,nV,nT;(function(o){o.FREE="free",o.UPLOADING="uploading"})(eV||(eV={})),function(o){o[o.MISC=0]="MISC",o[o.INTERNAL_EVENT=1]="INTERNAL_EVENT",o[o.PUBLIC_EVENT=2]="PUBLIC_EVENT",o[o.WEB_EVENT=3]="WEB_EVENT",o[o.INTERNAL_API=4]="INTERNAL_API",o[o.WEB_API=5]="WEB_API",o[o.PUBLIC_API=6]="PUBLIC_API"}(nV||(nV={})),function(o){o.NONE="none",o.INIT="init",o.CANPLAY="canplay",o.PLAYING="playing",o.PAUSED="paused",o.SUSPEND="suspend",o.STALLED="stalled",o.WAITING="waiting",o.ERROR="error",o.DESTROYED="destroyed",o.ABORT="abort",o.ENDED="ended",o.EMPTIED="emptied",o.LOADEDDATA="loadeddata"}(nT||(nT={}));const PD={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};function Z7(o){return eT(o.reportId,"params.reportId",0,100,!1),eT(o.category,"params.category",0,100,!1),eT(o.event,"params.event",0,100,!1),eT(o.label,"params.label",0,100,!1),E_(o.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}const t9={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Fg,I_,rV,DD,j_,T_,qR,XS,SI,a0,BT,rT,LE,LD,i_,KE,TT,u_,NE,ME,kT,qE,iV,OT;function oV(o){return E_(o.timeout,"config.timeout",0,1e5),E_(o.timeoutFactor,"config.timeoutFactor",0,100,!1),E_(o.maxRetryCount,"config.maxRetryConfig",0,1/0),E_(o.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function e9(o){return Eg(o.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Eg(o.mode,"config.mode",["rtc","live"]),o.audioCodec!==void 0&&Eg(o.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),o.proxyServer!==void 0&&eT(o.proxyServer,"config.proxyServer",1,1e4),o.turnServer!==void 0&&sV(o.turnServer),o.httpRetryConfig!==void 0&&oV(o.httpRetryConfig),o.websocketRetryConfig!==void 0&&oV(o.websocketRetryConfig),!0}function c0(o){if(!Array.isArray(o)||o.length<1)return!1;try{o.forEach(s=>{if(!s.urls)throw Error()})}catch{return!1}return!0}function sV(o){return eT(o.turnServerURL,"turnServerURL"),eT(o.username,"username"),eT(o.password,"password"),o.udpport&&E_(o.udpport,"udpport",1,99999,!0),o.forceturn&&TI(o.forceturn,"forceturn"),o.security&&TI(o.security,"security"),o.tcpport&&E_(o.tcpport,"tcpport",1,99999,!0),!0}function aV(o){return o.level!==void 0&&Eg(o.level,"level",[1,2,3]),!0}(function(o){o.PUBLISH="publish",o.SUBSCRIBE="subscribe",o.WS_COMPRESSOR_INIT="ws_compressor_init",o.SESSION_INIT="session_init",o.JOIN_CHOOSE_SERVER="join_choose_server",o.REQ_USER_ACCOUNT="req_user_account",o.JOIN_GATEWAY="join_gateway",o.REJOIN_GATEWAY="rejoin_gateway",o.STREAM_SWITCH="stream_switch",o.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",o.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",o.FIRST_VIDEO_RECEIVED="first_video_received",o.FIRST_AUDIO_RECEIVED="first_audio_received",o.FIRST_VIDEO_DECODE="first_video_decode",o.FIRST_AUDIO_DECODE="first_audio_decode",o.ON_ADD_AUDIO_STREAM="on_add_audio_stream",o.ON_ADD_VIDEO_STREAM="on_add_video_stream",o.ON_UPDATE_STREAM="on_update_stream",o.ON_REMOVE_STREAM="on_remove_stream",o.USER_ANALYTICS="req_user_analytics",o.PC_STATS="pc_stats"})(Fg||(Fg={})),function(o){o.SESSION="io.agora.pb.Wrtc.Session",o.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",o.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",o.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",o.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",o.PUBLISH="io.agora.pb.Wrtc.Publish",o.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",o.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",o.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",o.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",o.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",o.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",o.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",o.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",o.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",o.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",o.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",o.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",o.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",o.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",o.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",o.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",o.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",o.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",o.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",o.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",o.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",o.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",o.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",o.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",o.PC_STATS="io.agora.pb.Wrtc.PCStats"}(I_||(I_={})),function(o){o[o.WORKER_EVENT=156]="WORKER_EVENT",o[o.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(rV||(rV={})),function(o){o[o.SESSION=26]="SESSION",o[o.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",o[o.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",o[o.JOIN_GATEWAY=28]="JOIN_GATEWAY",o[o.PUBLISH=30]="PUBLISH",o[o.SUBSCRIBE=29]="SUBSCRIBE",o[o.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",o[o.STREAM_SWITCH=32]="STREAM_SWITCH",o[o.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",o[o.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",o[o.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",o[o.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",o[o.API_INVOKE=41]="API_INVOKE",o[o.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",o[o.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",o[o.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",o[o.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",o[o.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",o[o.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",o[o.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",o[o.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",o[o.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",o[o.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",o[o.WORKER_EVENT=156]="WORKER_EVENT",o[o.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",o[o.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",o[o.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",o[o.USER_ANALYTICS=1e4]="USER_ANALYTICS",o[o.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(DD||(DD={})),function(o){o.CREATE_CLIENT="createClient",o.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",o.SET_AREA="setArea",o.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",o.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",o.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",o.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",o.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",o.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",o.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",o.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",o.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",o.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",o.START_PROXY_SERVER="Client.startProxyServer",o.STOP_PROXY_SERVER="Client.stopProxyServer",o.SET_PROXY_SERVER="Client.setProxyServer",o.SET_TURN_SERVER="Client.setTurnServer",o.SET_CLIENT_ROLE="Client.setClientRole",o.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",o.ENABLE_DUAL_STREAM="Client.enableDualStream",o.DISABLE_DUAL_STREAM="Client.disableDualStream",o.JOIN="Client.join",o.LEAVE="Client.leave",o.PUBLISH="Client.publish",o.UNPUBLISH="Client.unpublish",o.SUBSCRIBE="Client.subscribe",o.MASS_SUBSCRIBE="Client.massSubscribe",o.MASS_UNSUBSCRIBE="Client.massUnsubscribe",o.UNSUBSCRIBE="Client.unsubscribe",o.RENEW_TOKEN="Client.renewToken",o.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",o.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",o.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",o.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",o.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",o.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",o.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",o.DATACHANNEL_FAILBACK="Client._datachannelFailback",o.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",o.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",o.START_LIVE_STREAMING="Client.startLiveStreaming",o.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",o.STOP_LIVE_STREAMING="Client.stopLiveStreaming",o.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",o.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",o.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",o.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",o.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",o.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",o.SET_CONFIG_DISTRIBUTE="_configDistribute",o.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",o.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",o.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",o.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",o.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",o.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",o.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",o.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",o.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",o.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",o.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",o.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",o.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",o.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",o.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",o.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",o.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",o.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",o.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",o.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",o.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",o.STREAM_TYPE_CHANGE="streamTypeChange",o.CONNECTION_STATE_CHANGE="connectionStateChange",o.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",o.IMAGE_MODERATION_UPLOAD="imageModerationUpload"}(j_||(j_={})),function(o){o.TRACER="tracer"}(T_||(T_={})),function(o){o.IDLE="IDLE",o.INITING="INITING",o.INITEND="INITEND"}(qR||(qR={})),function(o){o.STATE_CHANGE="state_change",o.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",o.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",o.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(XS||(XS={})),function(o){o[o.ACCESS_POINT=101]="ACCESS_POINT",o[o.UNILBS=201]="UNILBS",o[o.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(SI||(SI={})),function(o){o[o.IIIEGAL_APPID=1]="IIIEGAL_APPID",o[o.IIIEGAL_UID=2]="IIIEGAL_UID",o[o.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(a0||(a0={})),function(o){o[o.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",o[o.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",o[o.INTERNAL_ERROR=8]="INTERNAL_ERROR",o[o.NO_AUTHORIZED=9]="NO_AUTHORIZED",o[o.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",o[o.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",o[o.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",o[o.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",o[o.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",o[o.USER_OVERLOAD=16]="USER_OVERLOAD",o[o.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",o[o.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(BT||(BT={})),function(o){o[o.NO_FLAG_SET=100]="NO_FLAG_SET",o[o.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",o[o.INVALID_FALG_SET=102]="INVALID_FALG_SET",o[o.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",o[o.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",o[o.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",o[o.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",o[o.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",o[o.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",o[o.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",o[o.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",o[o.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",o[o.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",o[o.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",o[o.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",o[o.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",o[o.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",o[o.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",o[o.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(rT||(rT={})),function(o){o[o.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",o[o.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",o[o.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",o[o.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",o[o.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",o[o.K_TICKET_INVALID=7]="K_TICKET_INVALID",o[o.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",o[o.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",o[o.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",o[o.K_UID_BANNED=14]="K_UID_BANNED",o[o.K_IP_BANNED=15]="K_IP_BANNED",o[o.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",o[o.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",o[o.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",o[o.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",o[o.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",o[o.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",o[o.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",o[o.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",o[o.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",o[o.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",o[o.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",o[o.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",o[o.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",o[o.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",o[o.ERR_INVALID_UID=117]="ERR_INVALID_UID",o[o.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",o[o.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",o[o.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",o[o.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",o[o.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",o[o.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",o[o.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",o[o.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",o[o.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",o[o.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",o[o.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",o[o.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",o[o.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",o[o.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",o[o.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",o[o.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",o[o.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",o[o.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",o[o.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",o[o.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",o[o.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",o[o.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",o[o.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",o[o.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",o[o.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",o[o.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",o[o.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",o[o.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",o[o.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",o[o.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",o[o.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",o[o.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",o[o.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",o[o.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",o[o.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",o[o.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",o[o.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(LE||(LE={})),function(o){o[o.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",o[o.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",o[o.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(LD||(LD={})),function(o){o.LEAVE="LEAVE",o.NETWORK_ERROR="NETWORK_ERROR",o.SERVER_ERROR="SERVER_ERROR",o.UID_BANNED="UID_BANNED",o.IP_BANNED="IP_BANNED",o.CHANNEL_BANNED="CHANNEL_BANNED",o.FALLBACK="FALLBACK",o.LICENSE_MISSING="LICENSE_MISSING",o.LICENSE_EXPIRED="LICENSE_EXPIRED",o.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",o.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",o.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",o.LICENSE_ILLEGAL="LICENSE_ILLEGAL"}(i_||(i_={})),function(o){o.CONNECTION_STATE_CHANGE="connection-state-change",o.MEDIA_RECONNECT_START="media-reconnect-start",o.MEDIA_RECONNECT_END="media-reconnect-end",o.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",o.USER_JOINED="user-joined",o.USER_LEAVED="user-left",o.USER_PUBLISHED="user-published",o.USER_UNPUBLISHED="user-unpublished",o.USER_INFO_UPDATED="user-info-updated",o.CLIENT_BANNED="client-banned",o.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",o.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",o.VOLUME_INDICATOR="volume-indicator",o.CRYPT_ERROR="crypt-error",o.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",o.NETWORK_QUALITY="network-quality",o.STREAM_TYPE_CHANGED="stream-type-changed",o.STREAM_FALLBACK="stream-fallback",o.RECEIVE_METADATA="receive-metadata",o.STREAM_MESSAGE="stream-message",o.LIVE_STREAMING_ERROR="live-streaming-error",o.LIVE_STREAMING_WARNING="live-streaming-warning",o.INJECT_STREAM_STATUS="stream-inject-status",o.EXCEPTION="exception",o.ERROR="error",o.P2P_LOST="p2p_lost",o.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",o.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",o.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",o.PUBLISHED_USER_LIST="published-user-list",o.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",o.CONTENT_INSPECT_ERROR="content-inspect-error",o.CONTENT_INSPECT_RESULT="content-inspect-result",o.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(KE||(KE={})),function(o){o.NETWORK_ERROR="NETWORK_ERROR",o.SERVER_ERROR="SERVER_ERROR",o.MULTI_IP="MULTI_IP",o.TIMEOUT="TIMEOUT",o.OFFLINE="OFFLINE",o.LEAVE="LEAVE",o.P2P_FAILED="P2P_FAILED",o.FALLBACK="FALLBACK"}(TT||(TT={})),function(o){o.CONNECTING="connecting",o.CONNECTED="connected",o.RECONNECTING="reconnecting",o.CLOSED="closed"}(u_||(u_={})),function(o){o.WS_CONNECTED="ws_connected",o.WS_RECONNECTING="ws_reconnecting",o.WS_CLOSED="ws_closed",o.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",o.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",o.ON_BINARY_DATA="on_binary_data",o.REQUEST_RECOVER="request_recover",o.REQUEST_JOIN_INFO="request_join_info",o.REQUEST_REJOIN_INFO="req_rejoin_info",o.IS_P2P_DISCONNECTED="is_p2p_dis",o.DISCONNECT_P2P="dis_p2p",o.ABORT_P2P_EXECUTION="abort_p2p_execution",o.NEED_RENEW_SESSION="need-sid",o.REPORT_JOIN_GATEWAY="report_join_gateway",o.REQUEST_TIMEOUT="request_timeout",o.REQUEST_SUCCESS="request_success",o.JOIN_RESPONSE="join_response",o.DATACHANNEL_PRECONNECT="datachannel_preconnect",o.DATACHANNEL_CONNECTING="datachannel_connecting",o.DATACHANNEL_FAILBACK="datachannel_failback"}(NE||(NE={})),function(o){o.PING="ping",o.PING_BACK="ping_back",o.JOIN="join_v3",o.REJOIN="rejoin_v3",o.LEAVE="leave",o.SET_CLIENT_ROLE="set_client_role",o.PUBLISH="publish",o.UNPUBLISH="unpublish",o.SUBSCRIBE="subscribe",o.SUBSCRIBE_STREAMS="subscribe_streams",o.UNSUBSCRIBE="unsubscribe",o.UNSUBSCRIBE_STREAMS="unsubscribe_streams",o.SUBSCRIBE_CHANGE="subscribe_change",o.TRAFFIC_STATS="traffic_stats",o.RENEW_TOKEN="renew_token",o.SWITCH_VIDEO_STREAM="switch_video_stream",o.DEFAULT_VIDEO_STREAM="default_video_stream",o.SET_FALLBACK_OPTION="set_fallback_option",o.GATEWAY_INFO="gateway_info",o.CONTROL="control",o.SEND_METADATA="send_metadata",o.DATA_STREAM="data_stream",o.PICK_SVC_LAYER="pick_svc_layer",o.RESTART_ICE="restart_ice",o.CONNECT_PC="connect_pc",o.SET_VIDEO_PROFILE="set_video_profile",o.SET_PARAMETER="set_parameter"}(ME||(ME={})),function(o){o.PUBLISH_STATS="publish_stats",o.PUBLISH_RELATED_STATS="publish_related_stats",o.SUBSCRIBE_STATS="subscribe_stats",o.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",o.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",o.DENOISER_STATS="denoiser_stats",o.TRANSPORT_STATS="transport_stats",o.EXTENSION_USAGE_STATS="extension_usage_stats"}(kT||(kT={})),function(o){o.ON_USER_ONLINE="on_user_online",o.ON_USER_OFFLINE="on_user_offline",o.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",o.ON_PUBLISH_STREAM="on_publish_stream",o.ON_UPLINK_STATS="on_uplink_stats",o.ON_P2P_LOST="on_p2p_lost",o.ON_REMOVE_STREAM="on_remove_stream",o.ON_ADD_AUDIO_STREAM="on_add_audio_stream",o.ON_ADD_VIDEO_STREAM="on_add_video_stream",o.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",o.ON_USER_BANNED="on_user_banned",o.ON_USER_LICENSE_BANNED="on_user_license_banned",o.ON_NOTIFICATION="on_notification",o.ON_CRYPT_ERROR="on_crypt_error",o.MUTE_AUDIO="mute_audio",o.MUTE_VIDEO="mute_video",o.UNMUTE_AUDIO="unmute_audio",o.UNMUTE_VIDEO="unmute_video",o.ON_P2P_OK="on_p2p_ok",o.RECEIVE_METADATA="receive_metadata",o.ON_DATA_STREAM="on_data_stream",o.ENABLE_LOCAL_VIDEO="enable_local_video",o.DISABLE_LOCAL_VIDEO="disable_local_video",o.ENABLE_LOCAL_AUDIO="enable_local_audio",o.DISABLE_LOCAL_AUDIO="disable_local_audio",o.ON_PUBLISHED_USER_LIST="on_published_user_list"}(qE||(qE={})),function(o){o.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",o.NEED_ANSWER="NEED_ANSWER",o.NEED_RENEGOTIATE="NEED_RENEGOTIATE",o.P2P_LOST="P2P_LOST",o.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",o.NEED_UNPUB="NEED_UNPUB",o.NEED_UNSUB="NEED_UNSUB",o.NEED_UPLOAD="NEED_UPLOAD",o.NEED_CONTROL="NEED_CONTROL",o.START_RECONNECT="START_RECONNECT",o.END_RECONNECT="END_RECONNECT",o.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(iV||(iV={})),function(o){o.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",o.RECEIVE_TRACK_BUFFER="receive_track_buffer",o.ON_AUDIO_BUFFER="on_audio_buffer",o.UPDATE_SOURCE="update_source"}(OT||(OT={}));const MD={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},UD={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},cV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},n9={uplinkNetworkQuality:0,downlinkNetworkQuality:0},uV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let jE,H_,hR;(function(o){o.CONNECTED="websocket:connected",o.RECONNECTING="websocket:reconnecting",o.WILL_RECONNECT="websocket:will_reconnect",o.CLOSED="websocket:closed",o.FAILED="websocket:failed",o.ON_MESSAGE="websocket:on_message",o.REQUEST_NEW_URLS="websocket:request_new_urls",o.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",o.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"})(jE||(jE={})),function(o){o.TRANSCODE="mix_streaming",o.RAW="raw_streaming",o.INJECT="inject_streaming"}(H_||(H_={})),function(o){o[o.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",o[o.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",o[o.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",o[o.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",o[o.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",o[o.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",o[o.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",o[o.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",o[o.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",o[o.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",o[o.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(hR||(hR={}));const r9={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},xD={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function VD(o,s){eT(o.url,"".concat(s,".url"),1,1e3,!1),b_(o.x)||E_(o.x,"".concat(s,".x"),0,1e4),b_(o.y)||E_(o.y,"".concat(s,".y"),0,1e4),b_(o.width)||E_(o.width,"".concat(s,".width"),0,1e4),b_(o.height)||E_(o.height,"".concat(s,".height"),0,1e4),b_(o.zOrder)||E_(o.zOrder,"".concat(s,".zOrder"),0,255),b_(o.alpha)||E_(o.alpha,"".concat(s,".alpha"),0,1,!1)}const i9={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},o9={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};let lS,RI,D_,dV,iT,RS,_T,pR,Y_,S_,V_,NO,UE,J_,II,FD,BD,u0,fR,OI,XE;function lV(o){if(!o.channelName)throw new ga(Di.INVALID_PARAMS,"invalid channelName in info");if(typeof o.uid!="number")throw new ga(Di.INVALID_PARAMS,"invalid uid in info, uid must be a number");return o.token&&eT(o.token,"info.token",1,2047),ND(o.uid),CD(o.channelName),!0}function hV(o){return Eg(o,"mediaSource",["screen","window","application"]),!0}(function(o){o.WARNING="@live_uap-warning",o.ERROR="@line_uap-error",o.PUBLISH_STREAM_STATUS="@live_uap-publish-status",o.INJECT_STREAM_STATUS="@live_uap-inject-status",o.WORKER_STATUS="@live_uap-worker-status",o.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(lS||(lS={})),function(o){o.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(RI||(RI={})),function(o){o[o.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",o[o.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",o[o.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",o[o.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",o[o.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",o[o.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",o[o.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",o[o.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",o[o.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",o[o.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",o[o.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",o[o.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",o[o.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",o[o.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",o[o.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",o[o.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",o[o.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",o[o.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",o[o.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",o[o.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",o[o.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(D_||(D_={})),function(o){o.CONNECT_FAILED="connect failed",o.CONNECT_TIMEOUT="connect timeout",o.WS_DISCONNECTED="websocket disconnected",o.REQUEST_TIMEOUT="request timeout",o.REQUEST_FAILED="request failed",o.WAIT_STATUS_TIMEOUT="wait status timeout",o.WAIT_STATUS_ERROR="wait status error",o.BAD_STATE="bad state",o.WS_ABORT="ws abort",o.AP_REQUEST_TIMEOUT="AP request timeout",o.AP_JSON_PARSE_ERROR="AP json parse error",o.AP_REQUEST_ERROR="AP request error",o.AP_REQUEST_ABORT="AP request abort"}(dV||(dV={})),function(o){o[o.SetSdkProfile=0]="SetSdkProfile",o[o.SetSourceChannel=1]="SetSourceChannel",o[o.SetSourceUserId=2]="SetSourceUserId",o[o.SetDestChannel=3]="SetDestChannel",o[o.StartPacketTransfer=4]="StartPacketTransfer",o[o.StopPacketTransfer=5]="StopPacketTransfer",o[o.UpdateDestChannel=6]="UpdateDestChannel",o[o.Reconnect=7]="Reconnect",o[o.SetVideoProfile=8]="SetVideoProfile"}(iT||(iT={})),function(o){o.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",o.NETWORK_CONNECTED="NETWORK_CONNECTED",o.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",o.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",o.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",o.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",o.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",o.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",o.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",o.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(RS||(RS={})),function(o){o.RELAY_STATE_IDLE="RELAY_STATE_IDLE",o.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",o.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",o.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(_T||(_T={})),function(o){o.RELAY_OK="RELAY_OK",o.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",o.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",o.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(pR||(pR={})),function(o){o.High="high",o.Low="low",o.Audio="audio",o.Screen="screen",o.ScreenLow="screen_low"}(Y_||(Y_={})),function(o){o.DISCONNECT="disconnect",o.CONNECTION_STATE_CHANGE="connection-state-change",o.NETWORK_QUALITY="network-quality",o.STREAM_TYPE_CHANGE="stream-type-change",o.IS_P2P_DISCONNECTED="is-p2p-dis",o.DISCONNECT_P2P="dis-p2p",o.REQUEST_NEW_GATEWAY_LIST="req-gate-url",o.NEED_RENEW_SESSION="need-sid",o.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",o.JOIN_RESPONSE="join-response",o.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",o.RESET_CONNECTION_EVENTS="reset-connection-events",o.DATACHANNEL_PRECONNECT="datachannel_preconnect",o.DATACHANNEL_FAILBACK="datachannel_failback",o.RESET_SIGNAL="reset-signal"}(S_||(S_={})),function(o){o[o.Nothing=0]="Nothing",o[o.Audio=1]="Audio",o[o.LwoVideo=2]="LwoVideo",o[o.Video=4]="Video",o[o.Data=8]="Data"}(V_||(V_={})),function(o){o[o.websocket=0]="websocket",o[o.datachannel=1]="datachannel"}(NO||(NO={})),function(o){o.NEED_RENEGOTIATE="@need_renegotiate",o.NEED_REPLACE_TRACK="@need_replace_track",o.NEED_CLOSE="@need_close",o.NEED_ENABLE_TRACK="@need_enable_track",o.NEED_DISABLE_TRACK="@need_disable_track",o.NEED_SESSION_ID="@need_sid",o.SET_OPTIMIZATION_MODE="@set_optimization_mode",o.GET_STATS="@get_stats",o.GET_LOW_VIDEO_TRACK="@get_low_video_track",o.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",o.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",o.NEED_MUTE_TRACK="@need_mute_track",o.NEED_UNMUTE_TRACK="@need_unmute_track"}(UE||(UE={})),function(o){o.SCREEN_TRACK="screen_track",o.CUSTOM_TRACK="custome_track",o.LOW_STREAM="low_stream"}(J_||(J_={})),function(o){o[o.HIGH_STREAM=0]="HIGH_STREAM",o[o.LOW_STREAM=1]="LOW_STREAM"}(II||(II={})),function(o){o[o.HIGH_STREAM=0]="HIGH_STREAM",o[o.LOW_STREAM=1]="LOW_STREAM"}(FD||(FD={})),function(o){o[o.DISABLE=0]="DISABLE",o[o.LOW_STREAM=1]="LOW_STREAM",o[o.AUDIO_ONLY=2]="AUDIO_ONLY"}(BD||(BD={})),function(o){o.TRANSCEIVER_UPDATED="transceiver-updated"}(u0||(u0={})),function(o){o.SOURCE_STATE_CHANGE="source-state-change",o.TRACK_ENDED="track-ended",o.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",o.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",o.CLOSED="closed"}(fR||(fR={})),function(o){o.FIRST_FRAME_DECODED="first-frame-decoded",o.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(OI||(OI={})),function(o){o.CHINA="CHINA",o.ASIA="ASIA",o.NORTH_AMERICA="NORTH_AMERICA",o.EUROPE="EUROPE",o.JAPAN="JAPAN",o.INDIA="INDIA",o.KOREA="KOREA",o.HKMC="HKMC",o.US="US",o.OCEANIA="OCEANIA",o.SOUTH_AMERICA="SOUTH_AMERICA",o.AFRICA="AFRICA",o.OVERSEA="OVERSEA",o.GLOBAL="GLOBAL",o.EXTENSIONS="EXTENSIONS"}(XE||(XE={}));const s9=[XE.AFRICA,XE.ASIA,XE.CHINA,XE.EUROPE,XE.GLOBAL,XE.INDIA,XE.JAPAN,XE.NORTH_AMERICA,XE.OCEANIA,XE.OVERSEA,XE.SOUTH_AMERICA];let _g;(function(o){o.CHINA="CN",o.ASIA="AS",o.NORTH_AMERICA="NA",o.EUROPE="EU",o.JAPAN="JP",o.INDIA="IN",o.KOREA="KR",o.HKMC="HK",o.US="US",o.OCEANIA="OC",o.SOUTH_AMERICA="SA",o.AFRICA="AF",o.OVERSEA="OVERSEA",o.GLOBAL="GLOBAL",o.EXTENSIONS="GLOBAL"})(_g||(_g={}));const PO={CHINA:{},ASIA:{CODE:_g.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:_g.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:_g.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:_g.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:_g.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:_g.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:_g.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:_g.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:_g.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:_g.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:_g.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:_g.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:_g.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};let d0,pV,FE,_v,IS,OE,X_,QE,dT,ER,oT,AT,GT,qT,z_,MS,A_,OS,fV,LT,tS,mR;vD&&(PO.CHINA={CODE:_g.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(o){o.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(d0||(d0={}));class DO extends R_{constructor(s,l){super(),_t(this,"onICEConnectionStateChange",void 0),_t(this,"onConnectionStateChange",void 0),_t(this,"onDTLSTransportStateChange",void 0),_t(this,"onDTLSTransportError",void 0),_t(this,"onICETransportStateChange",void 0),_t(this,"onFirstAudioReceived",void 0),_t(this,"onFirstVideoReceived",void 0),_t(this,"onFirstAudioDecoded",void 0),_t(this,"onFirstVideoDecoded",void 0),_t(this,"onFirstVideoDecodedTimeout",void 0),_t(this,"onSelectedLocalCandidateChanged",void 0),_t(this,"onSelectedRemoteCandidateChanged",void 0),_t(this,"establishPromise",void 0)}}(function(o){o.SEND="sendonly",o.RECV="recvonly",o.SENDRECV="sendrecv",o.INACTIVE="inactive"})(pV||(pV={})),function(o){o.VIDEO="video",o.AUDIO="audio"}(FE||(FE={})),function(o){o[o.UDP=0]="UDP",o[o.TCP=1]="TCP",o[o.RELAY=2]="RELAY"}(_v||(_v={})),function(o){o[o.FIRST_CONNECTION=0]="FIRST_CONNECTION",o[o.TCP_RESTART=1]="TCP_RESTART",o[o.RELAY_RESTART=2]="RELAY_RESTART",o[o.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",o[o.OLD_RESTART=11]="OLD_RESTART",o[o.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(IS||(IS={})),function(o){o.LocalVideoTrack="videoTrack",o.LocalAudioTrack="audioTrack",o.LocalVideoLowTrack="videoLowTrack"}(OE||(OE={})),function(o){o.New="new",o.Connected="connected",o.Reconnecting="reconnecting",o.Disconnected="disconnected"}(X_||(X_={})),function(o){o.StateChange="stateChange",o.IceConnectionStateChange="iceConnectionStateChange",o.RequestMuteLocal="requestMuteLocal",o.RequestUnmuteLocal="requestUnmuteLocal",o.RequestRePublish="requestRePublish",o.RequestReSubscribe="requestReSubscribe",o.RequestUploadStats="requestUploadStats",o.MediaReconnectStart="MediaReconnectStart",o.MediaReconnectEnd="MediaReconnectEnd",o.NeedSignalRTT="NeedSignalRTT",o.RequestRestartICE="RequestRestartIce",o.PeerConnectionStateChange="PeerConnectionStateChange",o.RequestReconnect="RequestReconnect",o.RequestReconnectPC="RequestReconnectPC",o.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",o.P2PLost="P2PLost",o.UpdateVideoEncoder="UpdateVideoEncoder",o.ConnectionTypeChange="ConnectionTypeChange",o.RequestLowStreamParameter="RequestLowStreamParameter",o.QueryClientConnectionState="QueryClientConnectionState"}(QE||(QE={})),function(o){o.ONLINE="ONLINE",o.OFFLINE="OFFLINE"}(dT||(dT={})),function(o){o.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",o.ONLINE="ONLINE",o.OFFLINE="OFFLINE"}(ER||(ER={})),function(o){o.ON_TRACK="on_track",o.ON_NODE="on_node"}(oT||(oT={})),function(o){o.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",o.REQUEST_CONSTRAINTS="request_constraints"}(AT||(AT={})),function(o){o.CONNECTING="CONNECTING",o.RECONNECTING="RECONNECTING",o.CONNECTED="CONNECTED",o.CLOSED="CLOSED"}(GT||(GT={})),function(o){o[o.CONNECT_AP=0]="CONNECT_AP",o[o.AP_CONNECTED=1]="AP_CONNECTED",o[o.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",o[o.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",o[o.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",o[o.CONNECT_WORKER=5]="CONNECT_WORKER",o[o.WORKER_CONNECTED=6]="WORKER_CONNECTED",o[o.CLOSED=7]="CLOSED"}(qT||(qT={})),function(o){o.CONNECTION_STATE_CHANGE="connection-state-change",o.STATE_CHANGE="state-change",o.INSPECT_RESULT="inspect-result",o.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",o.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(z_||(z_={})),function(o){o.NETWORK_ERROR="NETWORK_ERROR",o.SERVER_ERROR="SERVER_ERROR",o.MULTI_IP="MULTI_IP",o.TIMEOUT="TIMEOUT",o.OFFLINE="OFFLINE",o.LEAVE="LEAVE",o.P2P_FAILED="P2P_FAILED",o.FALLBACK="FALLBACK"}(MS||(MS={})),function(o){o.CONNECTED="transmitter:connected",o.RECONNECTING="transmitter:reconnecting",o.WILL_RECONNECT="transmitter:will_reconnect",o.CLOSED="transmitter:closed",o.FAILED="transmitter:failed",o.ON_MESSAGE="transmitter:on_message",o.REQUEST_NEW_URLS="transmitter:request_new_urls",o.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",o.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",o.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",o.FAILBACK="transmitter:failback"}(A_||(A_={})),function(o){o.CAMERA_CHANGED="camera-changed",o.MICROPHONE_CHANGED="microphone-changed",o.PLAYBACK_DEVICE_CHANGED="playback-device-changed",o.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",o.AUTOPLAY_FAILED="autoplay-failed",o.SECURITY_POLICY_VIOLATION="security-policy-violation"}(OS||(OS={})),function(o){o[o.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",o[o.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",o[o.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",o[o.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",o[o.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",o[o.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",o[o.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",o[o.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",o[o.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",o[o.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",o[o.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",o[o.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",o[o.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",o[o.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",o[o.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",o[o.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",o[o.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",o[o.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",o[o.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",o[o.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(fV||(fV={})),function(o){o.CONNECTING="CONNECTING",o.RECONNECTING="RECONNECTING",o.CONNECTED="CONNECTED",o.CLOSED="CLOSED"}(LT||(LT={})),function(o){o.CONNECTION_STATE_CHANGE="connection-state-change",o.STATE_CHANGE="state-change",o.INSPECT_RESULT="inspect-result",o.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",o.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(tS||(tS={})),function(o){o[o.CONNECT_AP=0]="CONNECT_AP",o[o.AP_CONNECTED=1]="AP_CONNECTED",o[o.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",o[o.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",o[o.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",o[o.CONNECT_WORKER=5]="CONNECT_WORKER",o[o.WORKER_CONNECTED=6]="WORKER_CONNECTED",o[o.CLOSED=7]="CLOSED"}(mR||(mR={}));const lT={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1};function L_(){return lT}let $_;(function(o){o[o.CHOOSE_SERVER=11]="CHOOSE_SERVER",o[o.CLOUD_PROXY=18]="CLOUD_PROXY",o[o.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",o[o.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})($_||($_={}));var a9=PE,l0=Array.isArray||function(o){return a9(o)=="Array"},c9=_a,EV=l0,u9=tP,d9=uS,l9=Mb("species"),mV=c9.Array,h9=function(o){var s;return EV(o)&&(s=o.constructor,(u9(s)&&(s===mV||EV(s.prototype))||d9(s)&&(s=s[l9])===null)&&(s=void 0)),s===void 0?mV:s},_V=function(o,s){return new(h9(o))(s===0?0:s)},p9=zI,f9=NS,E9=iR,m9=oR,_9=_V,gV=_r([].push),_R=function(o){var s=o==1,l=o==2,p=o==3,_=o==4,b=o==6,A=o==7,k=o==5||b;return function(j,z,H,$){for(var ue,Ei,Fi=E9(j),Gi=f9(Fi),_o=p9(z,H),_f=m9(Gi),vf=0,uE=$||_9,IE=s?uE(j,_f):l||A?uE(j,0):void 0;_f>vf;vf++)if((k||vf in Gi)&&(Ei=_o(ue=Gi[vf],vf,Fi),o))if(s)IE[vf]=Ei;else if(Ei)switch(o){case 3:return!0;case 5:return ue;case 6:return vf;case 2:gV(IE,ue)}else switch(o){case 4:return!1;case 7:gV(IE,ue)}return b?-1:p||_?_:IE}},vV={forEach:_R(0),map:_R(1),filter:_R(2),some:_R(3),every:_R(4),find:_R(5),findIndex:_R(6),filterReject:_R(7)},g9=vV.forEach,yV=AN("forEach")?[].forEach:function(o){return g9(this,o,arguments.length>1?arguments[1]:void 0)};yT({target:"Array",proto:!0,forced:[].forEach!=yV},{forEach:yV});var v9=sR("Array").forEach,y9=cR,b9=DT,T9=_e,S9=v9,GD=Array.prototype,R9={DOMTokenList:!0,NodeList:!0},I9=function(o){var s=o.forEach;return o===GD||T9(GD,o)&&s===GD.forEach||b9(R9,y9(o))?S9:s},O9=iR,bV=xN;yT({target:"Object",stat:!0,forced:f(function(){bV(1)})},{keys:function(o){return bV(O9(o))}});var A9=rR.Object.keys,w9=w1,C9=yT,N9=l0,P9=_r([].reverse),TV=[1,2];C9({target:"Array",proto:!0,forced:String(TV)===String(TV.reverse())},{reverse:function(){return N9(this)&&(this.length=this.length),P9(this)}});var D9=sR("Array").reverse,k9=_e,L9=D9,WD=Array.prototype,M9=function(o){var s=o.reverse;return o===WD||k9(WD,o)&&s===WD.reverse?L9:s},U9=f,x9=eI,j9=Mb("species"),SV=function(o){return x9>=51||!U9(function(){var s=[];return(s.constructor={})[j9]=function(){return{foo:1}},s[o](Boolean).foo!==1})},V9=yT,F9=_a,RV=l0,B9=tP,G9=uS,IV=DN,q9=oR,W9=nR,K9=SD,H9=Mb,Y9=eP,z9=SV("slice"),J9=H9("species"),KD=F9.Array,X9=Math.max;V9({target:"Array",proto:!0,forced:!z9},{slice:function(o,s){var l,p,_,b=W9(this),A=q9(b),k=IV(o,A),j=IV(s===void 0?A:s,A);if(RV(b)&&(l=b.constructor,(B9(l)&&(l===KD||RV(l.prototype))||G9(l)&&(l=l[J9])===null)&&(l=void 0),l===KD||l===void 0))return Y9(b,k,j);for(p=new(l===void 0?KD:l)(X9(j-k,0)),_=0;k<j;k++,_++)k in b&&K9(p,_,b[k]);return p.length=_,p}});var Q9=sR("Array").slice,$9=_e,Z9=Q9,HD=Array.prototype,tX=function(o){var s=o.slice;return o===HD||$9(HD,o)&&s===HD.slice?Z9:s};function oE(o,s,l,p,_){var b,A,k,j={};return I9(b=A9(p)).call(b,function(z){j[z]=p[z]}),j.enumerable=!!j.enumerable,j.configurable=!!j.configurable,("value"in j||j.initializer)&&(j.writable=!0),j=w9(A=M9(k=tX(l).call(l)).call(k)).call(A,function(z,H){return H(o,s,z)||z},j),_&&j.initializer!==void 0&&(j.value=j.initializer?j.initializer.call(_):void 0,j.initializer=void 0),j.initializer===void 0&&(f2(o,s,j),j=null),j}var eX=sR("Array").keys,nX=cR,rX=DT,iX=_e,oX=eX,YD=Array.prototype,sX={DOMTokenList:!0,NodeList:!0},WR=function(o){var s=o.keys;return o===YD||iX(YD,o)&&s===YD.keys||rX(sX,nX(o))?oX:s};function OV(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function AV(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?OV(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):OV(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}let kO=0,zD=0;function hS(o,s,l,p){return new RE((_,b)=>{s.timeout=s.timeout||_u("HTTP_CONNECT_TIMEOUT"),s.responseType=s.responseType||"json",s.data&&!l?(s.data=JSON.stringify(s.data),kO+=DI(s.data)):l&&(s.data.size?kO+=s.data.size:s.data instanceof FormData?kO+=function(A){let k=0;return/DingTalk/i.test(navigator.userAgent)&&A.realFormData&&(A=A.realFormData),A.forEach(j=>{k+=typeof j=="string"?DI(j):j.size}),k+138}(s.data):kO+=DI(JSON.stringify(s.data))),s.headers=s.headers||{},s.headers["Content-Type"]=s.headers["Content-Type"]||"application/json",s.method="POST",s.url=o,VT.request(s).then(A=>{typeof A.data=="string"?zD+=DI(A.data):A.data instanceof ArrayBuffer||A.data instanceof Uint8Array?zD+=A.data.byteLength:zD+=DI(JSON.stringify(A.data)),p&&_({data:A.data,headers:A.headers}),_(A.data)}).catch(A=>{VT.isCancel(A)?b(new ga(Di.OPERATION_ABORTED,"cancel token canceled")):A.code==="ECONNABORTED"?b(new ga(Di.NETWORK_TIMEOUT,A.message)):A.response?b(new ga(Di.NETWORK_RESPONSE_ERROR,A.response.status)):b(new ga(Di.NETWORK_ERROR,A.message))})})}async function aX(o,s){const l=new Blob([s.data],{type:"buffer"});return await hS(o,AV(AV({},s),{},{data:l,headers:{"Content-Type":"application/octet-stream"}}),!0)}const F_=new class extends R_{set networkState(o){_n.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+o),this.emit(ER.NETWORK_STATE_CHANGE,o,this._networkState),o===dT.ONLINE?this.emit(ER.ONLINE):o===dT.OFFLINE&&(this.onlineWaiter=new RE(s=>{this.once(ER.ONLINE,()=>{this.onlineWaiter=void 0,s(dT.ONLINE)})}),this.emit(ER.OFFLINE)),this._networkState=o}get networkState(){return this._networkState}constructor(){super(),_t(this,"_moduleName","network-indicator"),_t(this,"_networkState",dT.ONLINE),_t(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=dT.ONLINE}),window.addEventListener("offline",()=>{this.networkState=dT.OFFLINE})}};let JD=!1;const KT=new class extends R_{constructor(){super(...arguments),_t(this,"onAutoplayFailed",void 0),_t(this,"onAudioAutoplayFailed",void 0)}};function wV(){if(r_(),!JD){const o=s=>{s.preventDefault(),JD=!1,r0()?document.body.removeEventListener("click",o,!0):(document.body.removeEventListener("touchstart",o,!0),document.body.removeEventListener("mousedown",o,!0))};JD=!0,r0()?document.body.addEventListener("click",o,!0):(document.body.addEventListener("touchstart",o,!0),document.body.addEventListener("mousedown",o,!0)),_n.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),KT.onAutoplayFailed?KT.onAutoplayFailed():KT.onAudioAutoplayFailed?_n.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):_n.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),KT.emit("autoplay-failed")}}function XD(o){return new TextEncoder().encode(o)}const CV=function(o,s){const l=new Uint8Array(o.byteLength+s.byteLength);return l.set(new Uint8Array(o),0),l.set(new Uint8Array(s),o.byteLength),l},cX=async o=>function(s,l){let p="";return new Uint8Array(s).forEach(_=>{p+=_.toString(l).padStart(2,"0")}),p}(await crypto.subtle.digest("SHA-256",XD(o)),16);function NV(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function BE(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?NV(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):NV(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}function kE(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(s,l,p){const _=p.value;if(typeof _=="function"){const b=o.className||s.__className__||(s.constructor.name==="AgoraRTCClient"?"Client":s.constructor.name);p.value=function(){for(var A=arguments.length,k=new Array(A),j=0;j<A;j++)k[j]=arguments[j];let z=k;if(o.argsMap)try{z=o.argsMap(this,...k)}catch($){_n.warning($),z=[]}try{JSON.stringify(z)}catch{_n.warning("arguments for method ".concat(b,".").concat(String(l)," not serializable for apiInvoke.")),z=[]}const H=(o.report||wE).reportApiInvoke(this._sessionId||null,{name:"".concat(b,".").concat(String(l)),options:z,tag:T_.TRACER,reportResult:o.reportResult},o.throttleTime);try{const $=_.apply(this,k);return $ instanceof RE?$.then(ue=>(H.onSuccess(o.reportResult&&ue),ue)).catch(ue=>{throw H.onError(ue),ue}):(H.onSuccess(o.reportResult&&$),$)}catch($){throw H.onError($),$}}}return p}}const wE=new class{constructor(){_t(this,"baseInfoMap",new Map),_t(this,"proxyServer",void 0),_t(this,"clientList",BR),_t(this,"eventUploadTimer",void 0),_t(this,"setSessionIdTimer",void 0),_t(this,"url",void 0),_t(this,"backupUrl",void 0),_t(this,"_appId",void 0),_t(this,"keyEventUploadPendingItems",[]),_t(this,"normalEventUploadPendingItems",[]),_t(this,"apiInvokeUploadPendingItems",[]),_t(this,"apiInvokeCount",0),_t(this,"ltsList",[]),_t(this,"lastSendNormalEventTime",Date.now()),_t(this,"customReportCounterTimer",void 0),_t(this,"customReportCount",0),_t(this,"extApiInvoke",async o=>{for(const s of o){const l=BE(BE({},s),{},{sid:null,invokeId:++this.apiInvokeCount,tag:T_.TRACER});this.sendApiInvoke(l)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),_u("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),_u("EVENT_REPORT_SEND_INTERVAL"))}adjustSessionStartTime(o){if(!this.baseInfoMap.has(o)&&!this.baseInfoMap.get(o))return void _n.error("adjust session ".concat(o," start time, sid is not exist or info is undefined"));const s=this.baseInfoMap.get(o),l=Date.now(),p=s.startTime;s.startTime=l,_n.debug("rewrite session ".concat(o," startTime: ").concat(l," , ").concat(l-p,"ms")),this.baseInfoMap.set(o,s)}setAppId(o){this._appId=o}reportApiInvoke(o,s,l){s.timeout=s.timeout||6e4,s.reportResult=s.reportResult===void 0||s.reportResult;const p=Date.now();this.apiInvokeCount+=1;const _=this.apiInvokeCount,b=()=>({tag:s.tag,invokeId:_,sid:o,name:s.name,apiInvokeTime:p,options:s.options,states:s.states||null}),A=!!_u("SHOW_REPORT_INVOKER_LOG");A&&_n.info("".concat(s.name," start"),s.options);let k=!1;aT(s.timeout).then(()=>{k||(this.sendApiInvoke(BE(BE({},b()),{},{error:Di.API_INVOKE_TIMEOUT,success:!1})),_n.debug("".concat(s.name," timeout")))});const j=new ga(Di.UNEXPECTED_ERROR,"".concat(s.name,": this api invoke is end"));return{onSuccess:z=>{const H=()=>{if(k)throw j;return k=!0,this.sendApiInvoke(BE(BE({},b()),{},{success:!0},s.reportResult&&{result:z})),A&&_n.info("".concat(s.name," onSuccess")),z};return l?HF(H,s.name+"Success",l,()=>k=!0):H()},onError:z=>{const H=()=>{if(k)throw z;k=!0,this.sendApiInvoke(BE(BE({},b()),{},{success:!1,error:z})),A&&_n.info("".concat(s.name," onFailure"),z.toString())};return l?HF(H,s.name+"Error",l,()=>k=!0):H()}}}sessionInit(o,s){if(this.baseInfoMap.has(o))return;const l=Date.now(),p=this.createBaseInfo(o,l);p.cname=s.cname;const _=Object.assign({},{willUploadConsoleLog:_u("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:vD?"global":"oversea",areas:_u("AREAS")&&_u("AREAS").join(",")},s.extend),b=Date.now(),A=BE(BE({},p),{},{eventType:Fg.SESSION_INIT,appid:s.appid,browser:navigator.userAgent,build:_D,lts:b,elapse:b-l,extend:JSON.stringify(_),mode:s.mode,process:_u("PROCESS_ID"),appType:_u("APP_TYPE"),success:!0,version:ZT});this.send({type:I_.SESSION,data:A},!0)}joinChooseServer(o,s){const l=this.baseInfoMap.get(o);if(!l)return;const p=l.info,_=Date.now(),b=BE(BE({},p),{},{eventType:Fg.JOIN_CHOOSE_SERVER,lts:_,eventElapse:_-s.lts,chooseServerAddr:s.csAddr,errorCode:s.ec,elapse:_-l.startTime,success:s.succ,chooseServerAddrList:JSON.stringify(s.serverList),uid:s.uid?parseInt(s.uid):null,cid:s.cid?parseInt(s.cid):null,chooseServerIp:s.csIp||"",opid:s.opid,unilbsServerIds:s.unilbsServerIds,extend:s.extend||void 0,isHttp3:s.isHttp3});this.send({type:I_.JOIN_CHOOSE_SERVER,data:b},!0)}reqUserAccount(o,s){const l=this.baseInfoMap.get(o);if(!l)return;const p=l.info,_=Date.now(),b=BE(BE({},p),{},{eventType:Fg.REQ_USER_ACCOUNT,lts:_,success:s.success,serverAddress:s.serverAddr,stringUid:s.stringUid,uid:s.uid,errorCode:s.errorCode,elapse:_-l.startTime,eventElapse:_-s.lts,extend:JSON.stringify(s.extend)});this.send({type:I_.REQ_USER_ACCOUNT,data:b},!0)}joinGateway(o,s){const l=this.baseInfoMap.get(o);if(!l)return;const p=l.info;s.vid&&(p.vid=s.vid),p.uid=s.uid,p.cid=s.cid;const _=Date.now(),{firstSuccess:b,avoidJoinStartTime:A,isProxy:k,addr:j}=s,z=_-(b&&A?A:l.startTime),H=BE(BE({},p),{},{eventType:Fg.JOIN_GATEWAY,lts:_,gatewayAddr:s.addr,success:s.succ,errorCode:s.ec,elapse:z,eventElapse:_-s.lts,firstSuccess:b,signalChannel:s.signalChannel}),$=H.success?1:0;if(s.succ&&(l.lastJoinSuccessTime=_),b)this.send({type:I_.JOIN_GATEWAY,data:H},!0);else{let ue;if(j)if(k){const Fi=j.match(/h=(\d{1,3}-){3}\d{1,3}/g),Gi=j.match(/p=[0-9]{1,6}/g);ue={isSuccess:$,gatewayIp:Fi&&Fi.length?Fi[0].split("=")[1].replace(/-/g,"."):"",port:Gi&&Gi.length?Gi[0].split("=")[1]:"",isProxy:k?1:0}}else{const Fi=j.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),Gi=j.match(/:[0-9]{1,6}/g);ue={isSuccess:$,gatewayIp:Fi&&Fi.length?Fi[0].split("//")[1].replace(/-/g,"."):"",port:Gi&&Gi.length?Gi[0].split(":")[1]:"",isProxy:k?1:0}}else ue={isSuccess:$,gatewayIp:"",port:"",isProxy:k?1:0};delete H.success,delete H.eventType,delete H.firstSuccess,H.vid=Number(H.vid);const Ei=Object.assign({},H,ue,{eventType:Fg.REJOIN_GATEWAY});this.send({type:I_.RE_JOIN_GATEWAY,data:Ei},!0)}}joinChannelTimeout(o,s){const l=this.baseInfoMap.get(o);if(!l)return;const p=Date.now(),_=BE(BE({},l.info),{},{lts:p,timeout:s,elapse:p-l.startTime});this.send({type:I_.JOIN_CHANNEL_TIMEOUT,data:_},!0)}publish(o,s){const l=this.baseInfoMap.get(o);if(!l)return;const p=l.info,_=Date.now(),b=BE(BE({},p),{},{eventType:Fg.PUBLISH,lts:_,eventElapse:s.eventElapse,elapse:_-l.startTime,success:s.succ,errorCode:s.ec,videoName:s.videoName,audioName:s.audioName,screenName:s.screenName,screenshare:s.screenshare,audio:s.audio,video:s.video,p2pid:s.p2pid,publishRequestid:s.publishRequestid});this.send({type:I_.PUBLISH,data:b},!0)}subscribe(o,s,l){const p=this.baseInfoMap.get(o);if(!p)return;const _=p.info,b=Date.now(),A=BE(BE({},_),{},{eventType:Fg.SUBSCRIBE,lts:b,eventElapse:s.eventElapse,elapse:b-p.startTime,success:s.succ,errorCode:s.ec,video:s.video,audio:s.audio,subscribeRequestid:s.subscribeRequestid,p2pid:s.p2pid},l&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof s.peerid=="string"?A.peerSuid=s.peerid:A.peer=s.peerid,this.send({type:I_.SUBSCRIBE,data:A},!0)}wsCompressorInit(o){var s;const l=[...WR(s=this.baseInfoMap).call(s)],p=l.length?l[0]:"UnableToGetSid",_=this.baseInfoMap.get(p);if(!_)return;const b=_.info,A=Date.now(),k=BE(BE({},b),{},{eventType:Fg.WS_COMPRESSOR_INIT,lts:A,eventElapse:o.eventElapse,elapse:A-_.startTime,status:o.status?1:2});this.send({type:I_.WS_COMPRESSOR_INIT,data:k},!0)}firstRemoteVideoDecode(o,s,l,p){const _=this.baseInfoMap.get(o);if(!_)return;const b=_.info,A=Date.now(),k=BE(BE(BE({},b),p),{},{elapse:A-_.startTime,eventType:s,lts:A,firstDecodeFrame:Math.max(A-_.startTime,0),apEnd:Math.max(p.apEnd-_.startTime,0),apStart:Math.max(p.apStart-_.startTime,0),joinGwEnd:Math.max(p.joinGwEnd-_.startTime,0),joinGwStart:Math.max(p.joinGwStart-_.startTime,0),pcEnd:Math.max(p.pcEnd-_.startTime,0),pcStart:Math.max(p.pcStart-_.startTime,0),subscriberEnd:Math.max(p.subscriberEnd-_.startTime,0),subscriberStart:Math.max(p.subscriberStart-_.startTime,0),videoAddNotify:Math.max(p.videoAddNotify-_.startTime,0)});this.send({type:l,data:k},!0)}firstRemoteFrame(o,s,l,p){const _=this.baseInfoMap.get(o);if(!_)return;const b=_.info,A=Date.now(),k=BE(BE(BE({},b),p),{},{elapse:A-_.startTime,eventType:s,lts:A});this.send({type:l,data:k},!0)}pcStats(o,s){const l=this.baseInfoMap.get(o);if(!l)return;const p=l.info,_=Date.now(),b=BE(BE(BE({},p),s),{},{vid:p.vid===void 0?0:Number(p.vid),elapse:_-l.startTime,eventType:Fg.PC_STATS,lts:_});this.send({type:I_.PC_STATS,data:b},!0)}onGatewayStream(o,s,l,p){const _=this.baseInfoMap.get(o);if(!_)return;const b=_.info,A=Date.now(),k=BE(BE(BE({},b),p),{},{eventType:s,lts:A});this.send({type:l,data:k},!0)}streamSwitch(o,s){const l=this.baseInfoMap.get(o);if(!l)return;const p=l.info,_=Date.now(),b=BE(BE({},p),{},{eventType:Fg.STREAM_SWITCH,lts:_,isDual:s.isdual,elapse:_-l.startTime,success:s.succ});this.send({type:I_.STREAM_SWITCH,data:b},!0)}requestProxyAppCenter(o,s){const l=this.baseInfoMap.get(o);if(!l)return;const p=l.info,_=Date.now(),b=BE(BE({},p),{},{eventType:Fg.REQUEST_PROXY_APPCENTER,lts:_,eventElapse:_-s.lts,elapse:_-l.startTime,APAddr:s.APAddr,workerManagerList:s.workerManagerList,response:s.response,errorCode:s.ec,success:s.succ});this.send({type:I_.REQUEST_PROXY_APPCENTER,data:b},!0)}requestProxyWorkerManager(o,s){const l=this.baseInfoMap.get(o);if(!l)return;const p=l.info,_=Date.now(),b=BE(BE({},p),{},{eventType:Fg.REQUEST_PROXY_WORKER_MANAGER,lts:_,eventElapse:_-s.lts,elapse:_-l.startTime,workerManagerAddr:s.workerManagerAddr,response:s.response,errorCode:s.ec,success:s.succ});this.send({type:I_.REQUEST_PROXY_WORKER_MANAGER,data:b},!0)}setProxyServer(o){this.proxyServer=o,o?_n.debug("reportProxyServerurl: ".concat(o)):_n.debug("disable reportProxyServerurl: ".concat(o))}peerPublishStatus(o,s){const l=this.baseInfoMap.get(o);if(!l)return;const p=l.info,_=Date.now(),b=BE(BE({},p),{},{subscribeElapse:s.subscribeElapse,peer:s.peer,peerPublishDuration:Math.max(s.audioPublishDuration,s.videoPublishDuration),audiotag:s.audioPublishDuration>0?1:-1,videotag:s.videoPublishDuration>0?1:-1,lts:_,elapse:_-l.startTime,joinChannelSuccessElapse:_-(l.lastJoinSuccessTime||_),peerPublishDurationVideo:s.videoPublishDuration,peerPublishDurationAudio:s.audioPublishDuration});this.send({type:I_.PEER_PUBLISH_STATUS,data:b},!0)}workerEvent(o,s){const l=this.baseInfoMap.get(o);if(!l)return;const p=l.info,_=Date.now();(function(b,A,k){const j=b[A];if(!j||typeof j!="string")return[b];b[A]="";const z=DI(JSON.stringify(b));let H=0;const $=[];let ue=0;for(let Ei=0;Ei<j.length;Ei++)ue+=j.charCodeAt(Ei)<=127?1:3,ue<=k-z||($[$.length]=YR(YR({},b),{},{[A]:j.substring(H,Ei)}),H=Ei,ue=j.charCodeAt(Ei)<=127?1:3);return H!==j.length-1&&($[$.length]=YR(YR({},b),{},{[A]:j.substring(H)})),$})(BE(BE(BE({},p),s),{},{elapse:_-l.startTime,lts:_,productType:"WebRTC"}),"payload",1300).forEach(b=>this.send({type:I_.WORKER_EVENT,data:b},!0))}apworkerEvent(o,s){const l=this.baseInfoMap.get(o);if(!l)return;const p=l.info,_=Date.now(),b=BE(BE(BE({},p),s),{},{elapse:_-l.startTime,lts:_});this.send({type:I_.AP_WORKER_EVENT,data:b},!0)}joinWebProxyAP(o,s){const l=this.baseInfoMap.get(o);if(!l)return;const p=l.info,_=Date.now(),b=BE(BE(BE({},p),s),{},{elapse:_-l.startTime,lts:_,extend:s.extend||void 0});this.send({type:I_.JOIN_WEB_PROXY_AP,data:b},!0)}WebSocketQuit(o,s){const l=this.baseInfoMap.get(o);if(!l)return;const p=l.info,_=Date.now(),b=BE(BE(BE({},p),s),{},{elapse:_-l.startTime,lts:_});this.send({type:I_.WEBSOCKET_QUIT,data:b},!0)}async sendCustomReportMessage(o,s){if(this.customReportCount+=s.length,this.customReportCount>_u("CUSTOM_REPORT_LIMIT"))throw new ga(Di.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const l=Date.now(),p=s.map(_=>({type:I_.USER_ANALYTICS,data:BE(BE({sid:o},_),{},{lts:l})}));try{_u("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(p):await this.postDataToStatsCollector(p)}catch(_){throw _n.error("send custom report message failed",_.toString()),new ga(Di.CUSTOM_REPORT_SEND_FAILED,_.message)}}autoplayFailed(o,s,l,p){if(!o)return;const _=this.baseInfoMap.get(o);if(!_)return;const b=_.info,A=Date.now(),k=BE(BE({},b),{},{vid:b.vid===void 0?0:Number(b.vid),lts:A,elapse:A-_.startTime,cbRegistered:KT.onAutoplayFailed||KT.onAudioAutoplayFailed?1:-1,errorMsg:l,mediaType:s,trackId:p,extend:void 0});this.send({type:I_.AUTOPLAY_FAILED,data:k},!0)}sendApiInvoke(o){const s=_u("NOT_REPORT_EVENT");if(o.tag&&s.includes&&s.includes(o.tag))return!1;if(o.sid===null)return this.apiInvokeUploadPendingItems.push(o),!1;const l=this.baseInfoMap.get(o.sid);if(!l)return this.apiInvokeUploadPendingItems.push(o),!1;const{cname:p,uid:_,cid:b}=l.info;o.lts=o.lts||Date.now();let A;if(o.error)if(o.error instanceof ga){const{code:j,message:z}=o.error;A=j||z||o.error.toString()}else A=o.error.toString();const k={invokeId:o.invokeId,sid:o.sid,cname:p,cid:b,uid:_,lts:o.lts,success:o.success,elapse:o.lts-l.startTime,execElapse:o.lts-o.apiInvokeTime,apiName:o.name,options:o.options?JSON.stringify(o.options):void 0,execStates:o.states?JSON.stringify(o.states):void 0,execResult:o.result?JSON.stringify(o.result):void 0,errorCode:o.error?A:void 0,errorMsg:o.error?JSON.stringify(o.error):void 0};return this.send({type:I_.API_INVOKE,data:k},!1),!0}appendSessionId(){this.clientList.forEach(o=>{if(o._sessionId){const s=this.apiInvokeUploadPendingItems.length;for(let l=0;l<s;l++){const p=this.apiInvokeUploadPendingItems.shift();p&&(p.sid=o._sessionId,this.sendApiInvoke(Object.assign({},p)))}}})}send(o,s){if(s)return this.keyEventUploadPendingItems.push(o),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(o),this.normalEventUploadPendingItems.length>_u("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(o,s){const l=[],p=[];for(;o.length;){const b=o.shift();l.length<20?l.push(b):p.push(b)}o.push(...p);for(const b of[...l]){var _;this.ltsList.indexOf(b.data.lts)!==-1?(b.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(b.data.lts)):(this.ltsList.push(b.data.lts),AD(_=this.ltsList).call(_,(A,k)=>A-k))}return s||(this.lastSendNormalEventTime=Date.now()),_u("ENABLE_EVENT_REPORT")&&l.length&&(_u("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(l):this.postDataToStatsCollector(l)).catch((b=>A=>{_u("EVENT_REPORT_RETRY")&&(s?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(b):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(b),this.normalEventUploadPendingItems.length>_u("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-_u("NORMAL_EVENT_QUEUE_CAPACITY")),_n.warning("report: drop normal events"))))})(l)),o}async postDataToStatsCollector2(o){F_.networkState===dT.OFFLINE&&await RE.race([F_.onlineWaiter,aT(2*x_.maxRetryTimeout)]);const s=_=>{let b=new Uint8Array;return _.forEach(A=>{const k=XD(JSON.stringify(A.data)),j=new ArrayBuffer(5),z=($=>{let ue=0;return Object.entries(I_).forEach(Ei=>{let[Fi,Gi]=Ei;Gi===$.type&&(ue=DD[Fi])}),ue})(A),H=new DataView(j);H.setUint16(0,k.byteLength,!0),H.setUint8(2,255&z),H.setUint8(3,z>>>8&255),H.setUint8(4,z>>>16&255),b=CV(b,new Uint8Array(j)),b=CV(b,k)}),b},l="event";let p=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(_u("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(l):"https://".concat(_u("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(l);for(let _=0;_<2;_+=1){_===1&&(p=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(_u("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(l):"https://".concat(_u("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(l));try{await hS(p,{timeout:1e4,data:s(o),headers:BE(BE({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(b){if(_===1)throw b;continue}return}}async postDataToStatsCollector(o){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const l={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:o.map(b=>JSON.stringify(b)),vid:(b=>{const A=b&&b.data.sid&&this.baseInfoMap.get(b.data.sid);return A&&A.info.vid&&+A.info.vid||0})(o[0])};F_.networkState===dT.OFFLINE&&await RE.race([F_.onlineWaiter,aT(2*x_.maxRetryTimeout)]);const p=s?"/events/proto-raws":"/events/messages";let _=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(_u("EVENT_REPORT_DOMAIN"),"&p=").concat(_u("STATS_COLLECTOR_PORT"),"&d=").concat(p):"https://".concat(_u("EVENT_REPORT_DOMAIN"),":").concat(_u("STATS_COLLECTOR_PORT")).concat(p));for(let b=0;b<2;b+=1){b===1&&(_=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(_u("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(_u("STATS_COLLECTOR_PORT"),"&d=").concat(p):"https://".concat(_u("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(_u("STATS_COLLECTOR_PORT")).concat(p)));try{s?await aX(_,{timeout:1e4,data:l}):await hS(_,{timeout:1e4,data:l})}catch(A){if(b===1)throw A;continue}return}}createBaseInfo(o,s){const l=Object.assign({},t9);return l.sid=o,this.baseInfoMap.set(o,{info:l,startTime:s}),l}reportResourceTiming(o,s){const l=performance.getEntriesByName(o),p=l[l.length-1];p&&this.reportApiInvoke(s,{name:"Client.resourceTiming",options:p,tag:T_.TRACER}).onSuccess()}};OO.on("REPORT_LOG_UPLOAD",o=>{o.networkState=F_.networkState,wE.reportApiInvoke(null,{name:"logUploadError",options:o,tag:T_.TRACER})});class PV extends R_{constructor(s,l){super(),_t(this,"trackMediaType",void 0),_t(this,"_ID",void 0),_t(this,"_rtpTransceiver",void 0),_t(this,"_lowRtpTransceiver",void 0),_t(this,"_hints",[]),_t(this,"_isClosed",!1),_t(this,"_originMediaStreamTrack",void 0),_t(this,"_mediaStreamTrack",void 0),_t(this,"_external",{}),this._ID=l||y_(8,"track-"),this._originMediaStreamTrack=s,this._mediaStreamTrack=s,function(p){s0.includes(p)||s0.push(p)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(s){if(!s){const l=wE.reportApiInvoke(null,{name:j_.GET_MEDIA_STREAM_TRACK,options:[],tag:T_.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?l.onSuccess(this._mediaStreamTrack.label):l.onSuccess("")}return this._mediaStreamTrack}getRTCRtpTransceiver(s){return s===II.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(s){const l=s0.indexOf(s);l!==-1&&s0.splice(l,1)}(this),this.emit(fR.CLOSED)}_updateRtpTransceiver(s,l){if(l===II.LOW_STREAM){if(this._lowRtpTransceiver===s)return;this._lowRtpTransceiver=s}else{if(this._rtpTransceiver===s)return;this._rtpTransceiver=s}this.emit(u0.TRANSCEIVER_UPDATED,s,l)}}let Z_,uX=1;class gT{constructor(s){_t(this,"lockingPromise",RE.resolve()),_t(this,"locks",0),_t(this,"name",""),_t(this,"lockId",void 0),this.lockId=uX++,s&&(this.name=s),_n.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(s){let l;this.locks+=1,_n.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof s=="string"?s:""));const p=new RE(b=>{l=()=>{this.locks-=1,_n.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof s=="string"?s:"")),b()}}),_=this.lockingPromise.then(()=>l);return this.lockingPromise=this.lockingPromise.then(()=>p),_}}function AI(o,s){return function(l,p,_){const b=_.value;if(typeof b!="function")throw new Error("Cannot use mutex on object property.");return _.value=async function(){const A=this[s];if(!A)throw new Error("mutex property key ".concat(s," doesn't exist on ").concat(o));const k=await A.lock("From ".concat(o,".").concat(p));try{for(var j=arguments.length,z=new Array(j),H=0;H<j;H++)z[H]=arguments[H];return await b.apply(this,z)}finally{k()}},_}}class QD extends PV{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(s){this._processorContext=s}constructor(s,l){super(s,l),_t(this,"_enabled",!0),_t(this,"_muted",!1),_t(this,"_isExternalTrack",!1),_t(this,"_isClosed",!1),_t(this,"_enabledMutex",void 0),_t(this,"processor",void 0),_t(this,"_processorContext",void 0),_t(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new gT("".concat(this.getTrackId())),s.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var s,l;return(s=(l=this._originMediaStreamTrack)===null||l===void 0?void 0:l.label)!==null&&s!==void 0?s:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,_n.debug("[".concat(this.getTrackId(),"] close")),this.emit(UE.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(s,l){let p=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=p,s!==this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),l&&this._originMediaStreamTrack.stop(),s.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=s,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await C_(this,UE.NEED_REPLACE_TRACK,this),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){_n.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(fR.TRACK_ENDED)}stateCheck(s,l){if(_n.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(s,": ").concat(l,"]")),TI(l,s),this._enabled&&this._muted&&s==="enabled"&&l===!1)throw new ga(Di.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&s==="muted"&&l===!0)throw new ga(Di.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function DV(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}(function(o){o.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",o.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",o.IOS_INTERRUPTION_START="ios-interruption-start",o.IOS_INTERRUPTION_END="ios-interruption-end",o.STATE_CHANGE="state-change"})(Z_||(Z_={}));const kV=window.AudioContext||window.webkitAudioContext;let HT=null;const o_=new class extends R_{constructor(){super(...arguments),_t(this,"prevState",void 0),_t(this,"curState",void 0),_t(this,"currentTime",void 0),_t(this,"currentTimeStuckAt",void 0),_t(this,"interruptDetectorTrack",void 0),_t(this,"onLocalAudioTrackMute",()=>{_n.info("ios15-interruption-start"),this.emit(Z_.IOS_15_16_INTERRUPTION_START)}),_t(this,"onLocalAudioTrackUnmute",async()=>{_n.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?_n.info("ios15-interruption-end-canceled"):(HT&&await HT.suspend(),this.emit(Z_.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(o){_n.debug("webaudio bindInterruptDetectorTrack ".concat(o.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=o,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(o){_n.debug("webaudio unbindInterruptDetectorTrack ".concat(o.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===o&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function dX(){if(!kV)return void _n.error("your browser is not support web audio");_n.info("create audio context");const o=function(s){for(var l=1;l<arguments.length;l++){var p=arguments[l]!=null?arguments[l]:{};l%2?DV(Object(p),!0).forEach(function(_){_t(s,_,p[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(p)):DV(Object(p)).forEach(function(_){Object.defineProperty(s,_,Object.getOwnPropertyDescriptor(p,_))})}return s}({},_u("WEBAUDIO_INIT_OPTIONS"));_n.debug("audio context init option:",JSON.stringify(o)),HT=new kV(o),o_.curState=HT.state,HT.onstatechange=()=>{o_.prevState=o_.curState,o_.curState=HT?HT.state:void 0;const{prevState:s,curState:l}=o_,p=l==="running",_=l==="interrupted",b=s==="running",A=s==="suspended",k=s==="interrupted",j=r_().osVersion;(ET()||LS())&&b&&_&&(_n.info("ios".concat(j,"-interruption-start")),o_.emit(Z_.IOS_INTERRUPTION_START)),(ET()||LS())&&(A||k)&&p&&(_n.info("ios".concat(j,"-interruption-end")),o_.emit(Z_.IOS_INTERRUPTION_END)),s!==l&&(_n.debug("AudioContext State Change","".concat(s,"=>").concat(l)),o_.emit(Z_.STATE_CHANGE))},setInterval(()=>{var s;const l=(s=HT)===null||s===void 0?void 0:s.currentTime;o_.currentTime!==l?(o_.currentTimeStuckAt&&(_n.debug("AudioContext current time resume at ".concat(l)),o_.currentTimeStuckAt=void 0),o_.currentTime=l):(l!==o_.currentTimeStuckAt&&(wE.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:l},tag:T_.TRACER}).onSuccess(),_n.warning("AudioContext current time stuck at ".concat(l))),o_.currentTimeStuckAt=l)},5e3),async function(s){const l=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let p,_=!1,b=!1,A=!1;function k(_o){s.state==="running"?j(!1):ET()||LS()?s.state==="suspended"&&(j(!0),_o&&s.resume().then(H,H)):s.state!=="closed"&&(j(!0),_o&&s.resume().then(H,H))}function j(_o){if(_!==_o){_=_o;for(let _f=0,vf=l;_f<vf.length;_f+=1){const uE=vf[_f];_o?window.addEventListener(uE,$,{capture:!0,passive:!0}):window.removeEventListener(uE,$,{capture:!0,passive:!0})}}}function z(){k(!0)}function H(){k(!1)}function $(){k(!0)}function ue(_o){if(!A)if(p.paused)if(_o){Ei(!1),A=!0;let _f;try{_f=p.play(),_f?_f.then(Fi,Fi):(p.addEventListener("playing",Fi),p.addEventListener("abort",Fi),p.addEventListener("error",Fi))}catch{Fi()}}else Ei(!0);else Ei(!1)}function Ei(_o){if(b!==_o){b=_o;for(let _f=0,vf=l;_f<vf.length;_f++){const uE=vf[_f];_o?window.addEventListener(uE,Gi,{capture:!0,passive:!0}):window.removeEventListener(uE,Gi,{capture:!0,passive:!0})}}}function Fi(){p.removeEventListener("playing",Fi),p.removeEventListener("abort",Fi),p.removeEventListener("error",Fi),A=!1,ue(!1)}function Gi(){ue(!0)}if(ET()){const _o=s.createMediaStreamDestination(),_f=document.createElement("div");_f.innerHTML="<audio x-webkit-airplay='deny'></audio>",p=_f.children.item(0),p.controls=!1,p.disableRemotePlayback=!0,p.preload="auto",p.srcObject=_o.stream,ue(!0)}o_.on(Z_.STATE_CHANGE,z),k(!1)}(HT)}function wI(){if(!HT){if(dX(),!HT)throw new ga(Di.NOT_SUPPORTED,"can not create audio context");return HT}return HT}function LV(){return!!HT}function KR(o){if(function(){if($D!==null)return $D;const p=wI(),_=p.createBufferSource(),b=p.createGain(),A=p.createGain();_.connect(b),_.connect(A),_.disconnect(b);let k=!1;try{_.disconnect(b)}catch{k=!0}return _.disconnect(),$D=k,k}())return;const s=o.connect,l=o.disconnect;o.connect=(p,_,b)=>(o._inputNodes||(o._inputNodes=[]),o._inputNodes.includes(p)||(p instanceof AudioNode?(o._inputNodes.push(p),s.call(o,p,_,b)):s.call(o,p,_)),o),o.disconnect=(p,_,b)=>{l.call(o),p?sL(o._inputNodes,p):o._inputNodes=[];for(const A of o._inputNodes)s.call(o,A)}}let $D=null;function MV(o,s){let l=!1;const p=1/s;if(_u("DISABLE_WEBAUDIO")){const _=window.setInterval(()=>{l?window.clearInterval(_):o(performance.now()/1e3)},1e3*p)}else{const _=wI();let b=_.createGain();b.gain.value=0,b.connect(_.destination);const A=()=>{if(l)return void(b=null);const k=_.createOscillator();k.onended=A,k.connect(b),k.start(0),k.stop(_.currentTime+p),o(_.currentTime)};A()}return()=>{l=!0}}class UV{constructor(){_t(this,"context",void 0),_t(this,"analyserNode",void 0),_t(this,"sourceNode",void 0),this.context=wI(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(s){if(s!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=s,s==null||s.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ET()||LS()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const s=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(s);else{const p=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(p);for(let _=0;_<s.length;++_)s[_]=p[_]/128-1}const l=aR(s).call(s,(p,_)=>p+_*_,0)/s.length;return Math.max(10*Math.log10(l)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var s,l;(s=this.sourceNode)===null||s===void 0||s.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(l=this.sourceNode)===null||l===void 0||l.connect(this.analyserNode)}catch{_n.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class xV extends R_{get processSourceNode(){return this.sourceNode}set processedNode(s){var l;if(!this.isDestroyed&&this._processedNode!==s){try{var p;(p=this.sourceNode)===null||p===void 0||p.disconnect(this.outputNode)}catch{}(l=this._processedNode)===null||l===void 0||l.disconnect(),this._processedNode=s,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),_t(this,"outputNode",void 0),_t(this,"outputTrack",void 0),_t(this,"isPlayed",!1),_t(this,"sourceNode",void 0),_t(this,"context",void 0),_t(this,"audioBufferNode",void 0),_t(this,"destNode",void 0),_t(this,"audioOutputLevel",0),_t(this,"volumeLevelAnalyser",void 0),_t(this,"_processedNode",void 0),_t(this,"playNode",void 0),_t(this,"isDestroyed",!1),_t(this,"onNoAudioInput",void 0),_t(this,"isNoAudioInput",!1),_t(this,"_noAudioInputCount",0),this.context=wI(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),KR(this.outputNode),this.volumeLevelAnalyser=new UV}startGetAudioBuffer(s){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(s),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=l=>{this.emit(OT.ON_AUDIO_BUFFER,function(p){for(let _=0;_<p.outputBuffer.numberOfChannels;_+=1){const b=p.outputBuffer.getChannelData(_);for(let A=0;A<b.length;A+=1)b[A]=0}return p.inputBuffer}(l))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!L_().webAudioMediaStreamDest)throw new ga(Di.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(s){this.context.state!=="running"&&AS(()=>{o_.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=s||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(s>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ET()||LS()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const l=this.volumeLevelAnalyser.getAnalyserNode();let p;l.getFloatTimeDomainData?(p=new Float32Array(l.fftSize),l.getFloatTimeDomainData(p)):(p=new Uint8Array(l.fftSize),l.getByteTimeDomainData(p));let _=!1;for(let b=0;b<p.length;b++)p[b]!==0&&(_=!0);return _?(this.isNoAudioInput=!1,!0):(await aT(200),await this.checkHasAudioInput(s?s+1:1)&&_)}getAudioVolume(){return this.outputNode.gain.value}setVolume(s){this.outputNode.gain.setValueAtTime(s,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var s,l;(s=this.processedNode)===null||s===void 0||s.disconnect(),(l=this.sourceNode)===null||l===void 0||l.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var s;this.processedNode?(s=this.processedNode)===null||s===void 0||s.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class ZD extends xV{get isFreeze(){return!1}constructor(s,l,p){var _;if(super(),_t(this,"sourceNode",void 0),_t(this,"track",void 0),_t(this,"clonedTrack",void 0),_t(this,"audioElement",void 0),_t(this,"isCurrentTrackCloned",!1),_t(this,"isRemoteTrack",!1),_t(this,"originVolumeLevelAnalyser",void 0),_t(this,"rebuildWebAudio",async()=>{if(_n.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void _n.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>_n.info("resume success")),_n.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const k=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?k.stop():this.isCurrentTrackCloned=!0;const j=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(j),KR(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const z=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(z,this.context.currentTime),KR(this.outputNode),this.emit(OT.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=j,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),s.kind!=="audio")throw new ga(Di.UNEXPECTED_ERROR);this.track=s;const b=new MediaStream([this.track]);if(this.isRemoteTrack=!!l,this.sourceNode=this.context.createMediaStreamSource(b),KR(this.sourceNode),p){const k=p.clone();k.enabled=!0,this.clonedTrack=k,_n.debug("create an unmuted track ".concat(k.id," from the original track ").concat(p.id," to get the volume"));const j=this.context.createMediaStreamSource(new MediaStream([k]));KR(j),this.originVolumeLevelAnalyser=new UV,this.originVolumeLevelAnalyser.updateSource(j)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=b;const A=r_();l&&A.os===tT.IOS&&Number((_=A.osVersion)===null||_===void 0?void 0:_.split(".")[0])<15&&(o_.on(Z_.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(k=>{k||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(s){this.sourceNode.disconnect(),this.track=s,this.isCurrentTrackCloned=!1;const l=new MediaStream([s]);this.sourceNode=this.context.createMediaStreamSource(l),KR(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(OT.UPDATE_SOURCE),this.audioElement.srcObject=l}destroy(){var s;this.audioElement.srcObject=null,this.audioElement.remove(),o_.off("state-change",this.rebuildWebAudio),(s=this.originVolumeLevelAnalyser)===null||s===void 0||s.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(s){return this.context.createMediaStreamSource(new MediaStream([s]))}updateOriginTrack(s){const l=s.clone();l.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=l),_n.debug("create an unmuted track ".concat(l.id," from the original track ").concat(s.id," to get the volume"));const p=this.context.createMediaStreamSource(new MediaStream([l]));KR(p),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(p)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function jV(o,s){const l=(_,b)=>_?typeof _!="number"?_.max||_.exact||_.ideal||_.min||b:_:b,p={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxHeight:l(s.height,1080),maxWidth:l(s.width,1920)}}};return s.frameRate&&typeof s.frameRate!="number"?(p.video.mandatory.maxFrameRate=s.frameRate.max,p.video.mandatory.minFrameRate=s.frameRate.min):typeof s.frameRate=="number"&&(p.video.mandatory.maxFrameRate=s.frameRate),await navigator.mediaDevices.getUserMedia(p)}async function lX(o){const s=await VV(o.mediaSource),l=await function(p){return new RE((_,b)=>{const A=document.createElement("div");A.innerText="share screen",A.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const k=document.createElement("div");k.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const j=document.createElement("div");j.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",j.setAttribute("style","height: 12%;");const z=document.createElement("div");z.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const H=document.createElement("div");H.setAttribute("style","text-align: right; padding: 16px 0;");const $=document.createElement("button");$.innerHTML="cancel",$.setAttribute("style","width: 85px;"),$.onclick=()=>{document.body.removeChild(ue);const Ei=new Error("NotAllowedError");Ei.name="NotAllowedError",b(Ei)},H.appendChild($),k.appendChild(j),k.appendChild(z),k.appendChild(H);const ue=document.createElement("div");ue.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),ue.appendChild(A),ue.appendChild(k),document.body.appendChild(ue),p.map(Ei=>{if(Ei.id){const Fi=document.createElement("div");Fi.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let Gi=Ei.thumbnail;const{width:_o}=Gi.getSize();_o>1920&&(Gi=Gi.resize({width:1920})),Fi.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+Gi.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(Ei.name.replace(/[\u00A0-\u9999<>\&]/g,function(_f){return"&#"+_f.charCodeAt(0)+";"})+"</span>"),Fi.onclick=()=>{document.body.removeChild(ue),_(Ei.id)},z.appendChild(Fi)}})})}(s);return await jV(l,o)}async function VV(o){let s=["window","screen"];o!=="application"&&o!=="window"||(s=["window"]),o==="screen"&&(s=["screen"]);const l=FV();if(!l)throw new ga(Di.ELECTRON_IS_NULL);let p=null;try{var _;p=((_=l.desktopCapturer)===null||_===void 0?void 0:_.getSources({types:s}))||l.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:s})}catch{p=null}p&&p.then||(p=new RE((b,A)=>{l.desktopCapturer.getSources({types:s},(k,j)=>{k?A(k):b(j)})}));try{return await p}catch(b){throw new ga(Di.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,b.toString())}}let LO=null;function FV(){if(LO)return LO;try{return LO=window.require("electron"),LO}catch{return null}}function BV(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}const _k=new gT("safari");let GV=!1,qV=!1;async function pS(o,s){let l=0,p=null;for(;l<2;)try{p=await hX(o,s,l>0);break}catch(_){if(_ instanceof ga)throw _n.error("[".concat(s,"] ").concat(_.toString())),_;const b=MO(_.name||_.code||_,_.message);if(b.code===Di.MEDIA_OPTION_INVALID){_n.debug("[".concat(s,"] detect media option invalid, retry")),l+=1,await aT(500);continue}throw _n.error("[".concat(s,"] ").concat(b.toString())),b}if(!p)throw new ga(Di.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return p}async function hX(o,s,l){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ga(Di.NOT_SUPPORTED,"can not find getUserMedia");l&&(o.video&&(delete o.video.width,delete o.video.height),o.screen&&(delete o.screen.width,delete o.screen.height));const p=L_(),_=new MediaStream;if(o.audioSource&&_.addTrack(o.audioSource),o.videoSource&&_.addTrack(o.videoSource),!o.audio&&!o.video&&!o.screen)return _n.debug("Using Video Source/ Audio Source"),_;if(o.screen)if(FV())o.screen.sourceId?CI(_,await jV(o.screen.sourceId,o.screen)):CI(_,await lX(o.screen));else if(jP()&&o.screen.extensionId&&o.screen.mandatory){if(!p.getStreamFromExtension)throw new ga(Di.NOT_SUPPORTED,"This browser does not support screen sharing");_n.debug("[".concat(s,'] Screen access on chrome stable, looking for extension"'));const ue=await(A=o.screen.extensionId,k=s,new RE((Ei,Fi)=>{try{chrome.runtime.sendMessage(A,{getStream:!0},Gi=>{if(!Gi||!Gi.streamId)return _n.error("[".concat(k,"] No response from Chrome Plugin. Plugin not installed properly"),Gi),void Fi(new ga(Di.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));Ei(Gi.streamId)})}catch(Gi){_n.error("[".concat(k,"] AgoraRTC screensharing plugin is not accessible(").concat(A,")"),Gi.toString()),Fi(new ga(Di.CHROME_PLUGIN_NOT_INSTALL))}}));o.screen.mandatory.chromeMediaSourceId=ue,CI(_,await navigator.mediaDevices.getUserMedia({video:{mandatory:o.screen.mandatory}}))}else if(p.getDisplayMedia){var b;o.screen.mediaSource&&hV(o.screen.mediaSource);const ue={width:o.screen.width,height:o.screen.height,frameRate:o.screen.frameRate,displaySurface:(b=o.screen.displaySurface)!==null&&b!==void 0?b:o.screen.mediaSource==="screen"?"monitor":o.screen.mediaSource},{selfBrowserSurface:Ei,surfaceSwitching:Fi,systemAudio:Gi}=o.screen,_o={selfBrowserSurface:Ei,surfaceSwitching:Fi,systemAudio:Gi};!Ei&&delete _o.selfBrowserSurface,!Fi&&delete _o.surfaceSwitching,!Gi&&delete _o.systemAudio,_n.debug("[".concat(s,"] getDisplayMedia:"),JSON.stringify({video:ue,audio:!!o.screenAudio,controls:_o})),CI(_,await navigator.mediaDevices.getDisplayMedia(function(_f){for(var vf=1;vf<arguments.length;vf++){var uE=arguments[vf]!=null?arguments[vf]:{};vf%2?BV(Object(uE),!0).forEach(function(IE){_t(_f,IE,uE[IE])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_f,Object.getOwnPropertyDescriptors(uE)):BV(Object(uE)).forEach(function(IE){Object.defineProperty(_f,IE,Object.getOwnPropertyDescriptor(uE,IE))})}return _f}({video:ue,audio:!!o.screenAudio},_o)))}else{if(!O_())throw _n.error("[".concat(s,"] This browser does not support screenSharing")),new ga(Di.NOT_SUPPORTED,"This browser does not support screen sharing");{o.screen.mediaSource&&hV(o.screen.mediaSource);const ue={video:{mediaSource:o.screen.mediaSource,width:o.screen.width,height:o.screen.height,frameRate:o.screen.frameRate}};_n.debug("[".concat(s,"] getUserMedia: ").concat(JSON.stringify(ue))),CI(_,await navigator.mediaDevices.getUserMedia(ue))}}var A,k;if(!o.video&&!o.audio)return _;let j={video:o.video,audio:o.audio},z=_u("MEDIA_DEVICE_CONSTRAINTS");if(z)try{typeof z=="string"&&(z=JSON.parse(z)),j=function ue(Ei,Fi){if(!YF(Ei)||!YF(Fi)||Array.isArray(Ei)&&!Array.isArray(Fi)||!Array.isArray(Ei)&&Array.isArray(Fi))return Fi;if(Array.isArray(Fi)&&Array.isArray(Ei)){const Gi=[...Ei];for(let _o=0;_o<Fi.length;_o++)Gi[_o]=ue(Ei[_o],Fi[_o]);return Gi}{const Gi=YR({},Ei);for(const _o in Fi)Object.prototype.hasOwnProperty.call(Fi,_o)&&(Object.prototype.hasOwnProperty.call(Ei,_o)?Gi[_o]=ue(Ei[_o],Fi[_o]):Gi[_o]=Fi[_o]);return Gi}}(j,z)}catch{}_n.debug("[".concat(s,"] GetUserMedia"),JSON.stringify(j)),r_();let H,$=null;(fT()||ET()||mO())&&($=await _k.lock());try{H=await navigator.mediaDevices.getUserMedia(j)}catch(ue){throw $&&$(),ue}return j.audio&&(GV=!0),j.video&&(qV=!0),CI(_,H),$&&$(),_}function MO(o,s){switch(o){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ga(Di.MEDIA_OPTION_INVALID,"".concat(o,": ").concat(s));case"NotFoundError":case"DevicesNotFoundError":return new ga(Di.DEVICE_NOT_FOUND,"".concat(o,": ").concat(s));case"NotSupportedError":return new ga(Di.NOT_SUPPORTED,"".concat(o,": ").concat(s));case"NotReadableError":return new ga(Di.NOT_READABLE,"".concat(o,": ").concat(s));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ga(Di.PERMISSION_DENIED,"".concat(o,": ").concat(s));case"ConstraintNotSatisfiedError":return new ga(Di.CONSTRAINT_NOT_SATISFIED,"".concat(o,": ").concat(s));default:return _n.error("getUserMedia unexpected error",o),new ga(Di.UNEXPECTED_ERROR,"".concat(o,": ").concat(s))}}function CI(o,s){const l=o.getVideoTracks()[0],p=o.getAudioTracks()[0],_=s.getVideoTracks()[0],b=s.getAudioTracks()[0];b&&(p&&o.removeTrack(p),o.addTrack(b)),_&&(l&&o.removeTrack(l),o.addTrack(_))}const YT=new class extends R_{get state(){return this._state}set state(o){o!==this._state&&(this.emit(XS.STATE_CHANGE,o),this._state=o)}constructor(){super(),_t(this,"_state",qR.IDLE),_t(this,"isAccessMicrophonePermission",!1),_t(this,"isAccessCameraPermission",!1),_t(this,"lastAccessMicrophonePermission",!1),_t(this,"lastAccessCameraPermission",!1),_t(this,"checkdeviceMatched",!1),_t(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(_u("ENUMERATE_DEVICES_INTERVAL")||(_O()||n2()===tT.HARMONY_OS)&&xR())&&this.updateDevicesInfo()},_u("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(o=>_n.error(o.toString()))}async enumerateDevices(o,s){let l=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new ga(Di.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const p=await navigator.mediaDevices.enumerateDevices(),_=this.checkMediaDeviceInfoIsOk(p);let b=!this.isAccessMicrophonePermission&&o,A=!this.isAccessCameraPermission&&s;_.audio&&(b=!1),_.video&&(A=!1);let k=null,j=null,z=null;if(!l&&(b||A)){if(_k.isLocked&&(_n.debug("[device manager] wait GUM lock"),(await _k.lock())(),_n.debug("[device manager] GUM unlock")),GV&&(b=!1,this.isAccessMicrophonePermission=!0),qV&&(A=!1,this.isAccessCameraPermission=!0),_n.debug("[device manager] check media device permissions",o,s,b,A),b&&A){try{z=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(H){const $=MO(H.name||H.code||H,H.message);if($.code===Di.PERMISSION_DENIED)throw $;_n.warning("getUserMedia failed in getDevices",$)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(b){try{k=await navigator.mediaDevices.getUserMedia({audio:o})}catch(H){const $=MO(H.name||H.code||H,H.message);if($.code===Di.PERMISSION_DENIED)throw $;_n.warning("getUserMedia failed in getDevices",$)}this.isAccessMicrophonePermission=!0}else if(A){try{j=await navigator.mediaDevices.getUserMedia({video:s})}catch(H){const $=MO(H.name||H.code||H,H.message);if($.code===Di.PERMISSION_DENIED)throw $;_n.warning("getUserMedia failed in getDevices",$)}this.isAccessCameraPermission=!0}_n.debug("[device manager] mic permission",o,"cam permission",s)}try{const H=await navigator.mediaDevices.enumerateDevices();return k&&k.getTracks().forEach($=>$.stop()),j&&j.getTracks().forEach($=>$.stop()),z&&z.getTracks().forEach($=>$.stop()),k=null,j=null,z=null,H}catch(H){return k&&k.getTracks().forEach($=>$.stop()),j&&j.getTracks().forEach($=>$.stop()),z&&z.getTracks().forEach($=>$.stop()),k=null,j=null,z=null,new ga(Di.ENUMERATE_DEVICES_FAILED,H.toString()).throw()}}async getRecordingDevices(){let o=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,o)).filter(s=>s.kind==="audioinput")}async getCamerasDevices(){let o=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,o)).filter(s=>s.kind==="videoinput")}async getSpeakers(){let o=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,o)).filter(s=>s.kind==="audiooutput")}searchDeviceIdByName(o){let s=null;return this.deviceInfoMap.forEach(l=>{l.device.label===o&&(s=l.device.deviceId)}),s}async getDeviceById(o){const s=(await this.enumerateDevices(!0,!0,!0)).find(l=>l.deviceId===o);if(!s)throw new ga(Di.DEVICE_NOT_FOUND,"deviceId: ".concat(o));return s}async init(){this.state=qR.INITING;try{await this.updateDevicesInfo(),this.state=qR.INITEND}catch(o){throw _n.warning("Device Detection functionality cannot start properly.",o.toString()),this.state=qR.IDLE,!function(){return typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1"}()&&new ga(Di.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),o}}async updateDevicesInfo(){const o=await this.enumerateDevices(!0,!0,!0),s=Date.now(),l=[];if(o[0]&&o[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const _=o.find(A=>A.kind==="audioinput"&&A.deviceId==="default"),b=o.find(A=>A.kind==="audiooutput"&&A.deviceId==="default");_&&b?b.groupId===_.groupId?_n.debug("[device-check] default input ".concat(_.label," and output ").concat(b.label," is the same group")):_n.warning("[device-check] default input ".concat(_.label," and output ").concat(b.label," is not the same group")):_n.debug("[device-check] default input or output not found")}const p=this.checkMediaDeviceInfoIsOk(o);if(o.forEach(_=>{if(!_.deviceId)return;const b=this.deviceInfoMap.get("".concat(_.kind,"_").concat(_.deviceId));if((b?b.state:"INACTIVE")!=="ACTIVE"){const A={initAt:s,updateAt:s,device:_,state:"ACTIVE"};this.deviceInfoMap.set("".concat(_.kind,"_").concat(_.deviceId),A),l.push(A)}b&&(b.updateAt=s)}),this.deviceInfoMap.forEach((_,b)=>{_.state==="ACTIVE"&&_.updateAt!==s&&(_.state="INACTIVE",l.push(_))}),this.state!==qR.INITEND)return p.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(p.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));l.forEach(_=>{switch(_.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(XS.RECORDING_DEVICE_CHANGED,_);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(XS.CAMERA_DEVICE_CHANGED,_);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(XS.PLAYOUT_DEVICE_CHANGED,_)}}),p.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),p.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(o){const s=o.filter(_=>_.kind==="audioinput"),l=o.filter(_=>_.kind==="videoinput"),p={audio:!1,video:!1};for(const _ of s)if(_.label&&_.deviceId){p.audio=!0;break}for(const _ of l)if(_.label&&_.deviceId){p.video=!0;break}return p}},pX=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],MT=new class{constructor(){_t(this,"onAutoplayFailed",void 0),_t(this,"elementMap",new Map),_t(this,"elementStateMap",new Map),_t(this,"elementsNeedToResume",[]),_t(this,"sinkIdMap",new Map),_t(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(o=>{let[s,l]=o;const p=this.elementStateMap.get(s),_=l.srcObject.getAudioTracks()[0];fI()?_&&_.readyState==="live"&&o_.curState==="running"&&(_n.debug("auto resume after interruption for iOS 15"),l.pause(),l.play()):p&&p==="paused"&&_&&_.readyState==="live"&&o_.curState==="running"&&(_n.debug("auto resume after interruption for iOS"),l.play())})}),_t(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(o=>{let[s,l]=o;const p=l.srcObject.getAudioTracks()[0];p&&p.readyState==="live"&&(_n.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),l.pause(),l.play())})}),this.autoResumeAudioElement(),o_.on(Z_.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),o_.on(Z_.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),o_.on(Z_.STATE_CHANGE,()=>{ET()&&o_.prevState==="suspended"&&o_.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(o,s){const l=this.elementMap.get(o);if(this.sinkIdMap.set(o,s),l)try{await l.setSinkId(s)}catch(p){throw new ga(Di.PERMISSION_DENIED,"can not set sink id: "+p.toString())}}play(o,s,l,p){if(this.elementMap.has(s))return;const _=document.createElement("audio");_.autoplay=!0,_.srcObject=new MediaStream([o]),this.bindAudioElementEvents(s,_),this.elementMap.set(s,_),this.elementStateMap.set(s,nT.INIT),this.setVolume(s,l);const b=this.sinkIdMap.get(s);if(b)try{_.setSinkId(b).catch(k=>{_n.warning("[".concat(s,"] set sink id failed"),k.toString())})}catch(k){_n.warning("[".concat(s,"] set sink id failed"),k.toString())}const A=_.play();A&&A.then&&A.catch(k=>{p&&wE.autoplayFailed(p,"audio",k.message,s),_n.warning("audio element play warning",k.toString()),this.elementMap.has(s)&&k.name==="NotAllowedError"&&(_n.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(_),AS(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),wV()}))})}updateTrack(o,s){const l=this.elementMap.get(o);l&&(l.srcObject=new MediaStream([s]))}isPlaying(o){return this.elementMap.has(o)&&this.elementStateMap.get(o)==="playing"}setVolume(o,s){const l=this.elementMap.get(o);l&&(s=Math.max(0,Math.min(100,s)),l.volume=s/100)}stop(o){const s=this.elementMap.get(o);if(this.sinkIdMap.delete(o),!s)return;const l=this.elementsNeedToResume.indexOf(s);this.elementsNeedToResume.splice(l,1),s.srcObject=null,s.remove(),this.elementMap.delete(o),this.elementStateMap.delete(o)}bindAudioElementEvents(o,s){pX.forEach(l=>{s.addEventListener(l,p=>{const _=this.elementStateMap.get(o),b=p.type==="pause"?"paused":p.type;if(_n.debug("[".concat(o,"] audio-element-status change ").concat(_," => ").concat(b)),p.type==="error"){const A=s==null?void 0:s.error;A&&_n.error("[".concat(o,"] media error, code: ").concat(A.code,", message: ").concat(A.message))}this.elementStateMap.set(o,b)})})}getPlayerState(o){return this.elementStateMap.get(o)||"uninit"}autoResumeAudioElement(){const o=()=>{this.elementsNeedToResume.forEach(s=>{s.play().then(l=>{_n.debug("Auto resume audio element success")}).catch(l=>{_n.warning("Auto resume audio element failed!",l)})}),this.elementsNeedToResume=[]};new RE(s=>{document.body?s():window.addEventListener("load",()=>s())}).then(()=>{r0()?document.body.addEventListener("click",o,!0):(document.body.addEventListener("touchstart",o,!0),document.body.addEventListener("mousedown",o,!0))})}};function w_(){return function(o,s,l){const p=l.value;return typeof p=="function"&&(l.value=function(){this._isClosed&&new ga(Di.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");for(var _=arguments.length,b=new Array(_),A=0;A<_;A++)b[A]=arguments[A];const k=p.apply(this,b);return k instanceof RE?new RE((j,z)=>{k.then(j).catch(z)}):k}),l}}var fX=sR("Array").values,EX=cR,mX=DT,_X=_e,gX=fX,tL=Array.prototype,vX={DOMTokenList:!0,NodeList:!0},US=function(o){var s=o.values;return o===tL||_X(tL,o)&&s===tL.values||mX(vX,EX(o))?gX:s};function WV(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function UO(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?WV(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):WV(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}class KV extends R_{constructor(s){super(),_t(this,"name","VideoProcessorDestination"),_t(this,"ID","0"),_t(this,"_source",void 0),_t(this,"videoContext",void 0),_t(this,"inputTrack",void 0),this.videoContext=s}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ga(Di.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ga(Di.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(s){if(s.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);s.track&&s.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=s.track,this.emit(oT.ON_TRACK,s.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(oT.ON_TRACK,void 0)}}class HV extends R_{set chained(s){this._chained=s}get chained(){return this._chained}constructor(s,l){super(),_t(this,"constraintsMap",new Map),_t(this,"statsRegistry",[]),_t(this,"usageRegistry",[]),_t(this,"trackId",void 0),_t(this,"direction",void 0),_t(this,"_chained",!1),this.trackId=s,this.direction=l}async getConstraints(){return await cT(this,AT.REQUEST_CONSTRAINTS)}async requestApplyConstraints(s,l){var p;return _n.info("processor ".concat(l.name," requestApplyConstraints for ").concat(this.trackId)),s&&this.constraintsMap.set(l,s),C_(this,AT.REQUEST_UPDATE_CONSTRAINTS,Array.from(US(p=this.constraintsMap).call(p)))}async requestRevertConstraints(s){var l;if(this.constraintsMap.has(s))return _n.info("processor ".concat(s.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(s),C_(this,AT.REQUEST_UPDATE_CONSTRAINTS,Array.from(US(l=this.constraintsMap).call(l)))}registerStats(s,l,p){this.statsRegistry.find(_=>_.processorID===s.ID&&_.processorName===s.name&&_.type===l)||this.statsRegistry.push({processorName:s.name,processorID:s.ID,type:l,cb:p})}unregisterStats(s,l){const p=this.statsRegistry.findIndex(_=>_.processorID===s.ID&&_.processorName===s.name&&_.type===l);p!==-1&&this.statsRegistry.splice(p,1)}gatherStats(){const s=[];for(const{processorID:l,processorName:p,type:_,cb:b}of this.statsRegistry)try{const A=b();s.push({processorID:l,processorName:p,type:_,stats:A})}catch(A){_n.error(new ga(Di.UNEXPECTED_ERROR,A.message))}return s}registerUsage(s,l){this.usageRegistry.find(p=>p.processorID===s.ID&&p.processorName===s.name)||this.usageRegistry.push({processorID:s.ID,processorName:s.name,cb:l})}unregisterUsage(s){const l=this.usageRegistry.findIndex(p=>p.processorID===s.ID&&p.processorName===s.name);l!==-1&&this.usageRegistry.splice(l,1)}async gatherUsage(){const s=[];if(!this.chained)return[];for(const{cb:l}of this.usageRegistry)try{let p=l();p instanceof RE&&(p=await p),s.push(UO(UO({},p),{},{direction:this.direction}))}catch(p){_n.error("gather extension usage error",p)}return s}getDirection(){return this.direction}}class YV extends R_{constructor(s){super(),_t(this,"name","AudioProcessorDestination"),_t(this,"ID","0"),_t(this,"inputTrack",void 0),_t(this,"inputNode",void 0),_t(this,"audioProcessorContext",void 0),_t(this,"_source",void 0),this.audioProcessorContext=s}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ga(Di.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ga(Di.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(oT.ON_TRACK,void 0),this.emit(oT.ON_NODE,void 0)}updateInput(s){if(s.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);s.track&&this.inputTrack!==s.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=s.track,this.emit(oT.ON_TRACK,this.inputTrack)),s.node&&this.inputNode!==s.node&&(this.audioProcessorContext.chained=!0,this.inputNode=s.node,this.emit(oT.ON_NODE,this.inputNode))}}class zV extends R_{set chained(s){this._chained=s}get chained(){return this._chained}constructor(s,l,p){super(),_t(this,"constraintsMap",new Map),_t(this,"statsRegistry",[]),_t(this,"audioContext",void 0),_t(this,"trackId",void 0),_t(this,"direction",void 0),_t(this,"usageRegistry",[]),_t(this,"_chained",!1),this.audioContext=s,this.trackId=l,this.direction=p}async getConstraints(){return cT(this,AT.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(s,l){var p;return _n.info("processor ".concat(l.name," requestApplyConstraints for ").concat(this.trackId)),s&&this.constraintsMap.set(l,s),C_(this,AT.REQUEST_UPDATE_CONSTRAINTS,Array.from(US(p=this.constraintsMap).call(p)))}async requestRevertConstraints(s){var l;if(this.constraintsMap.has(s))return this.constraintsMap.delete(s),C_(this,AT.REQUEST_UPDATE_CONSTRAINTS,Array.from(US(l=this.constraintsMap).call(l)))}registerStats(s,l,p){this.statsRegistry.find(_=>_.processorID===s.ID&&_.processorName===s.name&&_.type===l)||this.statsRegistry.push({processorName:s.name,processorID:s.ID,type:l,cb:p})}unregisterStats(s,l){const p=this.statsRegistry.findIndex(_=>_.processorID===s.ID&&_.processorName===s.name&&_.type===l);p!==-1&&this.statsRegistry.splice(p,1)}gatherStats(){const s=[];for(const{processorID:l,processorName:p,type:_,cb:b}of this.statsRegistry)try{const A=b();s.push({processorID:l,processorName:p,type:_,stats:A})}catch(A){_n.error(new ga(Di.UNEXPECTED_ERROR,A.message))}return s}registerUsage(s,l){this.usageRegistry.find(p=>p.processorID===s.ID&&p.processorName===s.name)||this.usageRegistry.push({processorID:s.ID,processorName:s.name,cb:l})}unregisterUsage(s){const l=this.usageRegistry.findIndex(p=>p.processorID===s.ID&&p.processorName===s.name);l!==-1&&this.usageRegistry.splice(l,1)}async gatherUsage(){const s=[];if(!this.chained)return[];for(const{cb:l}of this.usageRegistry)try{let p=l();p instanceof RE&&(p=await p),s.push(UO(UO({},p),{},{direction:this.direction}))}catch(p){_n.error("gather extension usage error",p)}return s}getDirection(){return this.direction}}class eL extends R_{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),_t(this,"context",void 0),_t(this,"processSourceNode",void 0),_t(this,"outputTrack",void 0),_t(this,"processedNode",void 0),_t(this,"clonedTrack",void 0),_t(this,"outputNode",void 0),this.outputNode=new yX}setVolume(){}createOutputTrack(){throw new ga(Di.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class yX{disconnect(){}connect(){}}let xO,NI=null;class bX{constructor(){_t(this,"state","open"),_t(this,"trigger",void 0),_t(this,"tasks",[]),_n.debug("[macro-task-queue] is created."),this.trigger=setTimeout(()=>{this.state="closed",_n.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(s=>s.key),"]")),this.trigger=void 0,this.tasks.forEach(s=>{let{func:l}=s;return l()}),this.tasks.length=0,_n.debug("[macro-task-queue] is closed.")})}enqueue(s,l){this.state!=="closed"&&(this.tasks.push({key:s,func:l}),_n.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat(typeof s=="string"?s:"")))}runTask(s){if(this.state==="closed")return;const l=this.tasks.findIndex(p=>p.key===s);if(l!==-1){const p=this.tasks.splice(l,1);_n.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat(typeof s=="string"?s:"")),p[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,_n.debug("[macro-task-queue] is closed."))}}function nL(o){return function(s,l,p){var _;const b=(_=p.value)!==null&&_!==void 0?_:p.get,A=function(){NI&&NI.state==="open"&&NI.runTask(o);for(var k=arguments.length,j=new Array(k),z=0;z<k;z++)j[z]=arguments[z];return b==null?void 0:b.apply(this,...j)};return p.value?p.value=A:p.get=A,p}}var JV,XV,QV,$V,ZV,tF,eF,nF,rF,iF,oF,sF,aF,cF,uF,dF,lF,hF,pF,fF,EF,s_,mF,_F,gF,vF,yF,bF,xS,TF,SF,RF,IF,OF,AF,wF,CF,NF,PF,DF,kF,hT;function LF(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function rL(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?LF(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):LF(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}(function(o){o.UPDATE_TRACK_SOURCE="update-track-source"})(xO||(xO={}));let sT=(JV=nL("INIT_WEBAUDIO"),XV=nL("INIT_WEBAUDIO"),QV=nL("INIT_WEBAUDIO"),$V=kE({argsMap:(o,s)=>[o.getTrackId(),s],throttleTime:300}),ZV=kE({argsMap:(o,s)=>[o.getTrackId(),s]}),tF=w_(),eF=AI("LocalAudioTrack","_enabledMutex"),nF=kE({argsMap:(o,s)=>[o.getTrackId(),s]}),rF=w_(),iF=AI("LocalAudioTrack","_enabledMutex"),oF=kE({argsMap:(o,s)=>[o.getTrackId(),s]}),sF=w_(),aF=w_(),cF=w_(),uF=kE({argsMap:o=>[o.getTrackId()]}),dF=w_(),lF=kE({argsMap:o=>[o.getTrackId()]}),hF=w_(),pF=kE({argsMap:o=>[o.getTrackId()]}),fF=kE({argsMap:(o,s)=>[o.getTrackId(),s.name]}),EF=kE({argsMap:o=>[o.getTrackId()]}),oE((s_=class extends QD{get _source(){return this._trackSource}set _source(o){this._trackSource=o}get processorContext(){return this._processorContext}set processorContext(o){this._processorContext=o}get processorDestination(){return this._processorDestination}set processorDestination(o){this._processorDestination=o}get isPlaying(){return this._useAudioElement?MT.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(o,s,l,p,_){super(o,l),_t(this,"trackMediaType","audio"),_t(this,"_encoderConfig",void 0),_t(this,"_trackSource",void 0),_t(this,"_enabled",!0),_t(this,"_volume",100),_t(this,"_useAudioElement",!1),_t(this,"_bypassWebAudio",!1),_t(this,"processor",void 0),_t(this,"_processorContext",void 0),_t(this,"_processorDestination",void 0),_t(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=s,this._getOriginVolumeLevel=!!p;const b=()=>{this.processorContext=new zV(this._source.context,this.getTrackId(),"local"),this.processorDestination=new YV(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(OT.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},A=_&&fT()&&!LV();_u("DISABLE_WEBAUDIO")?(this._source=new eL,this._useAudioElement=!0,this._bypassWebAudio=!0):A?this._source=new eL:(this._source=new ZD(o,!1,this._getOriginVolumeLevel?o:void 0),_u("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),b(),!_u("DISABLE_WEBAUDIO")&&A&&(NI||(NI=new bX),NI).enqueue("INIT_WEBAUDIO",()=>{this._source=new ZD(o,!1,this._getOriginVolumeLevel?o:void 0),_u("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),b(),this.emit(xO.UPDATE_TRACK_SOURCE)})}setVolume(o){E_(o,"volume",0,1e3),this._volume=o,this._source.setVolume(o/100),this._useAudioElement&&MT.setVolume(this.getTrackId(),o);try{if(this._bypassWebAudio)return void _n.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const s=this._source.createOutputTrack();this._mediaStreamTrack!==s&&(this._mediaStreamTrack=s,C_(this,UE.NEED_REPLACE_TRACK,this).then(()=>{_n.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(l=>{_n.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),l)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(o){if(!this._useAudioElement)throw new ga(Di.NOT_SUPPORTED,"your browser does not support setting the audio output device");await MT.setSinkID(this.getTrackId(),o)}async setEnabled(o,s,l){return this._setEnabled(o,s,l)}async _setEnabled(o,s,l){if(!l){if(o===this._enabled)return;this.stateCheck("enabled",o)}if(_n.info("[".concat(this.getTrackId(),"] start setEnabled"),o),o){this._originMediaStreamTrack.enabled=!0;try{l||(this._enabled=!0),await C_(this,UE.NEED_ENABLE_TRACK,this),_n.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(o," success"))}catch(p){throw l||(this._enabled=!1),_n.error("[".concat(this.getTrackId(),"] setEnabled to true error"),p.toString()),p}}else{this._originMediaStreamTrack.enabled=!1,l||(this._enabled=!1);try{await C_(this,UE.NEED_DISABLE_TRACK,this)}catch(p){throw l||(this._enabled=!0),_n.error("[".concat(this.getTrackId(),"] setEnabled to false error"),p.toString()),p}}}async setMuted(o){o!==this._muted&&(this.stateCheck("muted",o),this._muted=o,this._originMediaStreamTrack.enabled=!o,_n.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(o)),o?await C_(this,UE.NEED_MUTE_TRACK,this):await C_(this,UE.NEED_UNMUTE_TRACK,this))}getStats(){return h0(()=>{_n.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),fS(this,UE.GET_STATS)||rL({},MD)}setAudioFrameCallback(o){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!o)return this._source.removeAllListeners(OT.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(s),this._source.removeAllListeners(OT.ON_AUDIO_BUFFER),this._source.on(OT.ON_AUDIO_BUFFER,l=>o(l))}play(){_n.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(_n.debug("[".concat(this.getTrackId(),"] start audio playback in element")),MT.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){_n.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?MT.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let o=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];_n.debug("[".concat(this.getTrackId(),"] update player source track")),o&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&MT.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(o,s){this._originMediaStreamTrack!==o&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),o.addEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=o,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:o,context:this.processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await C_(this,UE.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(o))}renewMediaStreamTrack(o){return RE.resolve(void 0)}pipe(o){if(this._bypassWebAudio)throw new ga(Di.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===o)return o;if(o._source)throw new ga(Di.INVALID_OPERATION,"Processor ".concat(o.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=o,this.processor._source=this,o.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),o}unpipe(){var o;if(!this.processor)return;const s=this.processor;(o=this._source.processSourceNode)===null||o===void 0||o.disconnect(),this.processor._source=!1,this.processor=void 0,s.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(oT.ON_TRACK,async o=>{o?o!==this._mediaStreamTrack&&(this._mediaStreamTrack=o,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(o),await C_(this,UE.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await C_(this,UE.NEED_REPLACE_TRACK,this))}),this.processorDestination.on(oT.ON_NODE,o=>{this._source.processedNode=o})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(oT.ON_TRACK),this.processorDestination.removeAllListeners(oT.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(AT.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(AT.REQUEST_CONSTRAINTS)}}).prototype,"_source",[JV],Object.getOwnPropertyDescriptor(s_.prototype,"_source"),s_.prototype),oE(s_.prototype,"processorContext",[XV],Object.getOwnPropertyDescriptor(s_.prototype,"processorContext"),s_.prototype),oE(s_.prototype,"processorDestination",[QV],Object.getOwnPropertyDescriptor(s_.prototype,"processorDestination"),s_.prototype),oE(s_.prototype,"setVolume",[$V],Object.getOwnPropertyDescriptor(s_.prototype,"setVolume"),s_.prototype),oE(s_.prototype,"setPlaybackDevice",[ZV,tF],Object.getOwnPropertyDescriptor(s_.prototype,"setPlaybackDevice"),s_.prototype),oE(s_.prototype,"setEnabled",[eF,nF,rF],Object.getOwnPropertyDescriptor(s_.prototype,"setEnabled"),s_.prototype),oE(s_.prototype,"setMuted",[iF,oF,sF],Object.getOwnPropertyDescriptor(s_.prototype,"setMuted"),s_.prototype),oE(s_.prototype,"getStats",[aF],Object.getOwnPropertyDescriptor(s_.prototype,"getStats"),s_.prototype),oE(s_.prototype,"setAudioFrameCallback",[cF],Object.getOwnPropertyDescriptor(s_.prototype,"setAudioFrameCallback"),s_.prototype),oE(s_.prototype,"play",[uF,dF],Object.getOwnPropertyDescriptor(s_.prototype,"play"),s_.prototype),oE(s_.prototype,"stop",[lF,hF],Object.getOwnPropertyDescriptor(s_.prototype,"stop"),s_.prototype),oE(s_.prototype,"close",[pF],Object.getOwnPropertyDescriptor(s_.prototype,"close"),s_.prototype),oE(s_.prototype,"pipe",[fF],Object.getOwnPropertyDescriptor(s_.prototype,"pipe"),s_.prototype),oE(s_.prototype,"unpipe",[EF],Object.getOwnPropertyDescriptor(s_.prototype,"unpipe"),s_.prototype),s_),jO=(mF=kE({argsMap:(o,s)=>[o.getTrackId(),s]}),_F=w_(),gF=AI("MicrophoneAudioTrack","_enabledMutex"),vF=kE({argsMap:(o,s,l)=>[o.getTrackId(),s,l]}),yF=w_(),bF=kE({argsMap:o=>[o.getTrackId()]}),oE((xS=class extends sT{get __className__(){return"MicrophoneAudioTrack"}constructor(o,s,l,p){super(o,s.encoderConfig?CO(s.encoderConfig):{},p,_u("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),_t(this,"_config",void 0),_t(this,"_deviceName","default"),_t(this,"_constraints",void 0),_t(this,"_originalConstraints",void 0),_t(this,"_enabled",!0),this._config=s,this._constraints=l,this._originalConstraints=l,this._deviceName=o.label,typeof s.bypassWebAudio=="boolean"&&(this._bypassWebAudio=s.bypassWebAudio),(fI()||FP())&&o_.bindInterruptDetectorTrack(this),this.on(xO.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),LV()&&this.bindProcessorContextEvents()}async setDevice(o){if(_n.info("[".concat(this.getTrackId(),"] start set device to ").concat(o)),this._enabled)try{const s=await YT.getDeviceById(o),l={};l.audio=rL({},this._constraints),l.audio.deviceId={exact:o},this._originMediaStreamTrack.stop();let p=null;try{p=await pS(l,this.getTrackId())}catch(_){throw _n.error("[".concat(this.getTrackId(),"] setDevice failed"),_.toString()),p=await pS({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(p.getAudioTracks()[0],!1),_}await this._updateOriginMediaStreamTrack(p.getAudioTracks()[0],!1),this._deviceName=s.label,this._config.microphoneId=o,this._constraints.deviceId={exact:o}}catch(s){throw _n.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await YT.getDeviceById(o);this._deviceName=s.label,this._config.microphoneId=o,this._constraints.deviceId={exact:o}}catch(s){throw _n.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}_n.info("[".concat(this.getTrackId(),"] set device to ").concat(o," success"))}async setEnabled(o,s,l){if(s)return _n.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(o);if(!l){if(o===this._enabled)return;this.stateCheck("enabled",o)}if(_n.info("[".concat(this.getTrackId(),"] start setEnabled"),o),!o){var p;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(p=this._source.clonedTrack)===null||p===void 0||p.stop(),l||(this._enabled=!1);try{await C_(this,UE.NEED_DISABLE_TRACK,this)}catch(A){throw _n.error("[".concat(this.getTrackId(),"] setEnabled false failed"),A.toString()),A}return}const _=rL({},this._constraints),b=YT.searchDeviceIdByName(this._deviceName);b&&!_.deviceId&&(_.deviceId=b);try{l||(this._enabled=!0);const A=await pS({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(A.getAudioTracks()[0],!1),await C_(this,UE.NEED_ENABLE_TRACK,this)}catch(A){throw l||(this._enabled=!1),_n.error("[".concat(this.getTrackId(),"] setEnabled true failed"),A.toString()),A}_n.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(fI()||FP())&&o_.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((ET()||LS())&&this._enabled&&!this._isClosed&&o_.duringInterruption){const o=async()=>{o_.off(Z_.IOS_INTERRUPTION_END,o),this._enabled&&!this._isClosed&&(_n.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};o_.on(Z_.IOS_INTERRUPTION_END,o)}else _n.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(fR.TRACK_ENDED)}async renewMediaStreamTrack(o){const s=o||this._constraints,l=YT.searchDeviceIdByName(this._deviceName);if(l&&!s.deviceId&&(s.deviceId=l),this._constraints=s,this._enabled){this._originMediaStreamTrack.stop();const p=await pS({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(p.getAudioTracks()[0],!0)}}bindProcessorContextEvents(){this.processorContext.on(AT.REQUEST_UPDATE_CONSTRAINTS,async(o,s,l)=>{try{const p=Object.assign({},this._originalConstraints,...o);await this.renewMediaStreamTrack(p),s()}catch(p){l(p)}}),this.processorContext.on(AT.REQUEST_CONSTRAINTS,async o=>{o(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[mF,_F],Object.getOwnPropertyDescriptor(xS.prototype,"setDevice"),xS.prototype),oE(xS.prototype,"setEnabled",[gF,vF,yF],Object.getOwnPropertyDescriptor(xS.prototype,"setEnabled"),xS.prototype),oE(xS.prototype,"close",[bF],Object.getOwnPropertyDescriptor(xS.prototype,"close"),xS.prototype),xS),TX=(TF=kE({argsMap:(o,s)=>[o.getTrackId(),s,o.duration]}),SF=w_(),RF=kE({argsMap:o=>[o.getTrackId()]}),IF=w_(),OF=kE({argsMap:o=>[o.getTrackId()]}),AF=w_(),wF=kE({argsMap:o=>[o.getTrackId()]}),CF=w_(),NF=kE({argsMap:o=>[o.getTrackId()]}),PF=w_(),DF=kE({argsMap:o=>[o.getTrackId()]}),kF=w_(),oE((hT=class extends sT{get __className__(){return"BufferSourceAudioTrack"}constructor(o,s,l,p){super(s.createOutputTrack(),l,p),_t(this,"source",void 0),_t(this,"_bufferSource",void 0),this.source=o,this._bufferSource=s,this._bufferSource.on(OT.AUDIO_SOURCE_STATE_CHANGE,_=>{this.safeEmit(fR.SOURCE_STATE_CHANGE,_)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(o){o&&this._bufferSource.updateOptions(o),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(o){this._bufferSource.seekAudioBuffer(o)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}setAudioBufferPlaybackSpeed(o){E_(o,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(o)}}).prototype,"startProcessAudioBuffer",[TF,SF],Object.getOwnPropertyDescriptor(hT.prototype,"startProcessAudioBuffer"),hT.prototype),oE(hT.prototype,"pauseProcessAudioBuffer",[RF,IF],Object.getOwnPropertyDescriptor(hT.prototype,"pauseProcessAudioBuffer"),hT.prototype),oE(hT.prototype,"seekAudioBuffer",[OF,AF],Object.getOwnPropertyDescriptor(hT.prototype,"seekAudioBuffer"),hT.prototype),oE(hT.prototype,"resumeProcessAudioBuffer",[wF,CF],Object.getOwnPropertyDescriptor(hT.prototype,"resumeProcessAudioBuffer"),hT.prototype),oE(hT.prototype,"stopProcessAudioBuffer",[NF,PF],Object.getOwnPropertyDescriptor(hT.prototype,"stopProcessAudioBuffer"),hT.prototype),oE(hT.prototype,"setAudioBufferPlaybackSpeed",[DF,kF],Object.getOwnPropertyDescriptor(hT.prototype,"setAudioBufferPlaybackSpeed"),hT.prototype),hT);class wT extends sT{get __className__(){return"MixingAudioTrack"}get isActive(){for(const s of this.trackList)if(s._enabled&&!s._isClosed&&!s.muted)return!0;return!1}constructor(){const s=wI().createMediaStreamDestination();super(s.stream.getAudioTracks()[0],void 0,y_(8,"track-mix-")),_t(this,"trackList",void 0),_t(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=s,this.trackList=[]}hasAudioTrack(s){return this.trackList.indexOf(s)!==-1}addAudioTrack(s){this.trackList.indexOf(s)===-1?(_n.debug("add ".concat(s.getTrackId()," to mixing track")),s._source.outputNode.connect(this.destNode),this.trackList.push(s),this.updateEncoderConfig()):_n.debug("track ".concat(s.getTrackId()," is already added"))}removeAudioTrack(s){if(this.trackList.indexOf(s)!==-1){_n.debug("remove ".concat(s.getTrackId()," from mixing track"));try{s._source.outputNode.disconnect(this.destNode)}catch{}sL(this.trackList,s),this.updateEncoderConfig()}}updateEncoderConfig(){const s={};this.trackList.forEach(l=>{l._encoderConfig&&((l._encoderConfig.bitrate||0)>(s.bitrate||0)&&(s.bitrate=l._encoderConfig.bitrate),(l._encoderConfig.sampleRate||0)>(s.sampleRate||0)&&(s.sampleRate=l._encoderConfig.sampleRate),(l._encoderConfig.sampleSize||0)>(s.sampleSize||0)&&(s.sampleSize=l._encoderConfig.sampleSize),l._encoderConfig.stereo&&(s.stereo=!0))}),this._encoderConfig=s}_updateRtpTransceiver(s){this._rtpTransceiver!==s&&(this._rtpTransceiver=s,this.trackList.forEach(l=>{l instanceof wT?l.emit(u0.TRANSCEIVER_UPDATED,s):l._updateRtpTransceiver(s)}))}}class SX extends R_{constructor(){super(...arguments),_t(this,"resultStorage",new Map)}setLocalAudioStats(s,l,p){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",s,this.checkAudioInputLevel(p,l)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",s,this.checkSendAudioBitrate(p,l))}setLocalVideoStats(s,l,p){this.record("SEND_VIDEO_BITRATE_TOO_LOW",s,this.checkSendVideoBitrate(p,l)),this.record("FRAMERATE_INPUT_TOO_LOW",s,this.checkFramerateInput(p,l)),this.record("FRAMERATE_SENT_TOO_LOW",s,this.checkFramerateSent(p))}setRemoteAudioStats(s,l){const p=s.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",p,this.checkAudioOutputLevel(l))}setRemoteVideoStats(s,l){const p=s.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",p,this.checkVideoDecode(l))}record(s,l,p){if(_u("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(s)||this.resultStorage.set(s,{result:[],isPrevNormal:!0});const _=this.resultStorage.get(s);if(_&&(_.result.push(p),_.result.length>=5)){const b=_.result.includes(!0);_.isPrevNormal&&!b&&this.emit("exception",MF[s],s,l),!_.isPrevNormal&&b&&this.emit("exception",MF[s]+2e3,s+"_RECOVER",l),_.isPrevNormal=b,_.result=[]}}checkAudioOutputLevel(s){return!(s.receiveBitrate>0&&s.receiveLevel===0)}checkAudioInputLevel(s,l){return l instanceof wT&&!l.isActive||!!l.muted||s.sendVolumeLevel!==0}checkFramerateInput(s,l){let p=null;l._encoderConfig&&l._encoderConfig.frameRate&&(p=$S(l._encoderConfig.frameRate));const _=s.captureFrameRate;return!p||!_||!(p>10&&_<5||p<10&&p>=5&&_<=1)}checkFramerateSent(s){return!(s.captureFrameRate&&s.sendFrameRate&&s.captureFrameRate>5&&s.sendFrameRate<=1)}checkSendVideoBitrate(s,l){return!!l.muted||s.sendBitrate!==0}checkSendAudioBitrate(s,l){return l instanceof wT&&!l.isActive||!!l.muted||s.sendBitrate!==0}checkVideoDecode(s){return s.receiveBitrate===0||s.decodeFrameRate!==0}}const MF={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},eS=new class{markSubscribeStart(o,s){performance.mark("agora-web-sdk/".concat(o,"/subscribe-").concat(s))}markPublishStart(o,s){performance.mark("agora-web-sdk/".concat(o,"/publish-").concat(s))}measureFromSubscribeStart(o,s){const l=performance.getEntriesByName("agora-web-sdk/".concat(o,"/subscribe-").concat(s));if(l.length>0){const p=l[l.length-1];return Math.round(performance.now()-p.startTime)}return 0}measureFromPublishStart(o,s){const l=performance.getEntriesByName("agora-web-sdk/".concat(o,"/publish-").concat(s));if(l.length>0){const p=l[l.length-1];return Math.round(performance.now()-p.startTime)}return 0}};function UF(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function HR(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?UF(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):UF(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}class PI{constructor(s){_t(this,"store",void 0),_t(this,"onStatsException",void 0),_t(this,"onUploadPublishDuration",void 0),_t(this,"onStatsChanged",void 0),_t(this,"localStats",new Map),_t(this,"remoteStats",new Map),_t(this,"updateStatsInterval",void 0),_t(this,"trafficStats",void 0),_t(this,"trafficStatsPeerList",[]),_t(this,"uplinkStats",void 0),_t(this,"exceptionMonitor",void 0),_t(this,"p2pChannel",void 0),_t(this,"scalabilityMode",UP.L1T1),_t(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=s,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new SX,this.exceptionMonitor.on("exception",(l,p,_)=>{this.onStatsException&&this.onStatsException(l,p,_)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(OE.LocalAudioTrack)||HR({},MD)}getLocalVideoTrackStats(){return this.localStats.get(OE.LocalVideoTrack)||HR({},UD)}getRemoteAudioTrackStats(s){const l=(b,A)=>{if(!this.trafficStats)return A;const k=this.trafficStats.peer_delay.find(j=>j.peer_uid===b);return k&&(A.publishDuration=k.B_ppad+(Date.now()-this.trafficStats.timestamp)),A},p={};if(s){var _;const b=(_=this.remoteStats.get(s))===null||_===void 0?void 0:_.audioStats;b&&(p[s]=l(s,b))}else Array.from(this.remoteStats.entries()).forEach(b=>{let[A,{audioStats:k}]=b;k&&(p[A]=l(A,k))});return p}getRemoteNetworkQualityStats(s){const l={};if(s){var p;const _=(p=this.remoteStats.get(s))===null||p===void 0?void 0:p.networkStats;_&&(l[s]=_)}else Array.from(this.remoteStats.entries()).forEach(_=>{let[b,{networkStats:A}]=_;A&&(l[b]=A)});return l}getRemoteVideoTrackStats(s){const l=(b,A)=>{if(!this.trafficStats)return A;const k=this.trafficStats.peer_delay.find(j=>j.peer_uid===b);return k&&(A.publishDuration=k.B_ppvd+(Date.now()-this.trafficStats.timestamp)),A},p={};if(s){var _;const b=(_=this.remoteStats.get(s))===null||_===void 0?void 0:_.videoStats;b&&(p[s]=l(s,b))}else Array.from(this.remoteStats.entries()).forEach(b=>{let[A,{videoStats:k}]=b;k&&(p[A]=l(A,k))});return p}getRTCStats(){let s=0,l=0,p=0,_=0;const b=this.localStats.get(OE.LocalAudioTrack);b&&(s+=b.sendBytes,l+=b.sendBitrate);const A=this.localStats.get(OE.LocalVideoTrack);A&&(s+=A.sendBytes,l+=A.sendBitrate);const k=this.localStats.get(OE.LocalVideoLowTrack);k&&(s+=k.sendBytes,l+=k.sendBitrate),this.remoteStats.forEach(z=>{let{audioStats:H,videoStats:$}=z;H&&(p+=H.receiveBytes,_+=H.receiveBitrate),$&&(p+=$.receiveBytes,_+=$.receiveBitrate)});let j=1;return this.trafficStats&&(j+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:j,SendBitrate:l,SendBytes:s,RecvBytes:p,RecvBitrate:_,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(s){this.localStats.set(s,void 0)}removeLocalStats(s){s?this.localStats.delete(s):this.localStats.clear()}addRemoteStats(s){this.remoteStats.set(s,{})}removeRemoteStats(s){s?this.remoteStats.delete(s):this.remoteStats.clear()}addP2PChannel(s){this.p2pChannel=s}updateTrafficStats(s){s.peer_delay=s.peer_delay.filter(l=>l.B_ppad!==void 0||l.B_ppvd!==void 0),s.peer_delay.filter(l=>this.trafficStatsPeerList.indexOf(l.peer_uid)===-1).forEach(l=>{var p;const _=(p=this.p2pChannel)===null||p===void 0?void 0:p.getRemoteMedia(l.peer_uid),b=_!=null&&_.videoSSRC?eS.measureFromSubscribeStart(this.store.clientId,_.videoSSRC):0,A=_!=null&&_.audioSSRC?eS.measureFromSubscribeStart(this.store.clientId,_.audioSSRC):0;l.B_ppad!==void 0&&l.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(l.peer_uid,l.B_ppad,l.B_ppvd,b>A?b:A),this.trafficStatsPeerList.push(l.peer_uid))}),this.trafficStats=s}updateUplinkStats(s){this.uplinkStats&&this.uplinkStats.B_fir!==s.B_fir&&_n.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(s.B_fir)),this.uplinkStats=s}static isRemoteVideoFreeze(s,l,p){if(!s)return!1;const _=!!p&&l.framesDecodeFreezeTime>p.framesDecodeFreezeTime,b=!p||l.framesDecodeCount>p.framesDecodeCount;return _||!b}static isRemoteAudioFreeze(s){return!!s&&s._isFreeze()}isLocalVideoFreeze(s){return!(!s.inputFrame||!s.sentFrame)&&s.inputFrame.frameRate>5&&s.sentFrame.frameRate<3}updateLocalStats(s){Array.from(this.localStats.entries()).forEach(l=>{let[p,_]=l;switch(p){case OE.LocalVideoTrack:case OE.LocalVideoLowTrack:{const A=_,k=HR({},UD),j=s.getStats(),z=s.getLocalMedia(p);if(j){const H=j.videoSend.find($=>$.ssrc===(z==null?void 0:z.ssrcs[0].ssrcId));if(H){const $=s.getLocalVideoSize(),ue=s.getEncoderConfig(OE.LocalVideoTrack);H.codec!=="H264"&&H.codec!=="H265"&&H.codec!=="VP8"&&H.codec!=="VP9"&&H.codec!=="AV1X"&&H.codec!=="AV1"||(k.codecType=H.codec),k.sendBytes=H.bytes,k.sendBitrate=A?8*Math.max(0,k.sendBytes-A.sendBytes):0,H.inputFrame?(k.captureFrameRate=H.inputFrame.frameRate,k.captureResolutionHeight=H.inputFrame.height,k.captureResolutionWidth=H.inputFrame.width):$&&(k.captureResolutionWidth=$.width,k.captureResolutionHeight=$.height),H.sentFrame?(k.sendFrameRate=H.sentFrame.frameRate,k.sendResolutionHeight=H.sentFrame.height,k.sendResolutionWidth=H.sentFrame.width):$&&(k.sendResolutionWidth=$.width,k.sendResolutionHeight=$.height),H.avgEncodeMs&&(k.encodeDelay=H.avgEncodeMs),ue&&ue.bitrateMax&&(k.targetSendBitrate=1e3*ue.bitrateMax),k.sendPackets=H.packets,k.sendPacketsLost=H.packetsLost,k.totalDuration=A?A.totalDuration+1:1,k.totalFreezeTime=A?A.totalFreezeTime:0,this.isLocalVideoFreeze(H)&&(k.totalFreezeTime+=1),H.scalabilityMode&&this.scalabilityMode!==H.scalabilityMode&&(_n.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(H.scalabilityMode)),this.scalabilityMode=H.scalabilityMode)}this.trafficStats&&(k.sendPacketsLost=this.trafficStats.B_pvlr4/100)}var b;this.localStats.set(p,k),((A==null?void 0:A.sendResolutionWidth)!==k.sendResolutionWidth||(A==null?void 0:A.sendResolutionHeight)!==k.sendResolutionHeight)&&((b=this.onStatsChanged)===null||b===void 0||b.call(this,"resolution",{width:k.sendResolutionWidth,height:k.sendResolutionHeight})),k&&z&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,z.track,k);break}case OE.LocalAudioTrack:{const A=_,k=HR({},MD),j=s.getStats(),z=s.getLocalMedia(p);if(j){const H=j.audioSend.find($=>$.ssrc===(z==null?void 0:z.ssrcs[0].ssrcId));if(H){if(H.codec!=="opus"&&H.codec!=="aac"&&H.codec!=="PCMU"&&H.codec!=="PCMA"&&H.codec!=="G722"||(k.codecType=H.codec),H.inputLevel)k.sendVolumeLevel=Math.round(32767*H.inputLevel);else{const $=s.getLocalAudioVolume();$&&(k.sendVolumeLevel=Math.round(32767*$))}k.sendBytes=H.bytes,k.sendPackets=H.packets,k.sendPacketsLost=H.packetsLost,k.sendBitrate=A?8*Math.max(0,k.sendBytes-A.sendBytes):0}}this.trafficStats&&(k.sendPacketsLost=this.trafficStats.B_pvlr4/100),this.localStats.set(OE.LocalAudioTrack,k),k&&z&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,z.track,k);break}}})}updateRemoteStats(s){Array.from(this.remoteStats.entries()).forEach(l=>{let[p,{videoStats:_,audioStats:b,videoPcStats:A}]=l;const k=b,j=_,z=A,H=HR({},cV),$=HR({},uV),ue=HR({},n9),{audioTrack:Ei,videoTrack:Fi,audioSSRC:Gi,videoSSRC:_o}=s.getRemoteMedia(p),_f=s.getStats(),vf=_f==null?void 0:_f.audioRecv.find(lE=>lE.ssrc===Gi),uE=_f==null?void 0:_f.videoRecv.find(lE=>lE.ssrc===_o),IE=this.trafficStats&&this.trafficStats.peer_delay.find(lE=>lE.peer_uid===p);if(vf&&(vf.codec!=="opus"&&vf.codec!=="aac"&&vf.codec!=="PCMU"&&vf.codec!=="PCMA"&&vf.codec!=="G722"||(H.codecType=vf.codec),vf.outputLevel?H.receiveLevel=Math.round(32767*vf.outputLevel):Ei&&(H.receiveLevel=Math.round(32767*Ei.getVolumeLevel())),H.receiveBytes=vf.bytes,H.receivePackets=vf.packets,H.receivePacketsLost=vf.packetsLost,H.packetLossRate=H.receivePacketsLost/(H.receivePackets+H.receivePacketsLost),H.receiveBitrate=k?8*Math.max(0,H.receiveBytes-k.receiveBytes):0,H.totalDuration=k?k.totalDuration+1:1,H.totalFreezeTime=k?k.totalFreezeTime:0,H.freezeRate=H.totalFreezeTime/H.totalDuration,H.receiveDelay=vf.jitterBufferMs,H.totalDuration>10&&PI.isRemoteAudioFreeze(Ei)&&(H.totalFreezeTime+=1)),uE){uE.codec!=="H264"&&uE.codec!=="H265"&&uE.codec!=="VP8"&&uE.codec!=="VP9"&&uE.codec!=="AV1X"&&uE.codec!=="AV1"||($.codecType=uE.codec),$.receiveBytes=uE.bytes,$.receiveBitrate=j?8*Math.max(0,$.receiveBytes-j.receiveBytes):0,$.decodeFrameRate=uE.decodeFrameRate<0?0:uE.decodeFrameRate,$.renderFrameRate=uE.decodeFrameRate<0?0:uE.decodeFrameRate,uE.outputFrame&&($.renderFrameRate=uE.outputFrame.frameRate),uE.receivedFrame?($.receiveFrameRate=uE.receivedFrame.frameRate,$.receiveResolutionHeight=uE.receivedFrame.height,$.receiveResolutionWidth=uE.receivedFrame.width):Fi&&($.receiveResolutionHeight=Fi._videoHeight||0,$.receiveResolutionWidth=Fi._videoWidth||0),uE.framesRateFirefox!==void 0&&($.receiveFrameRate=Math.round(uE.framesRateFirefox)),$.receivePackets=uE.packets,$.receivePacketsLost=uE.packetsLost,$.packetLossRate=$.receivePacketsLost/($.receivePackets+$.receivePacketsLost),$.totalDuration=j?j.totalDuration+1:1,$.totalFreezeTime=j?j.totalFreezeTime:0,$.receiveDelay=uE.jitterBufferMs||0;const lE=!!_o&&s.getRemoteVideoIsReady(_o);Fi&&lE&&PI.isRemoteVideoFreeze(Fi,uE,z)&&($.totalFreezeTime+=1),$.freezeRate=$.totalFreezeTime/$.totalDuration}IE&&(H.end2EndDelay=IE.B_ad,$.end2EndDelay=IE.B_vd,H.transportDelay=IE.B_ed,$.transportDelay=IE.B_ed,H.currentPacketLossRate=IE.B_ealr4/100,$.currentPacketLossRate=IE.B_evlr4/100,ue.uplinkNetworkQuality=IE.B_punq?IE.B_punq:0,ue.downlinkNetworkQuality=IE.B_pdnq?IE.B_pdnq:0),this.remoteStats.set(p,{audioStats:H,videoStats:$,videoPcStats:uE,networkStats:ue}),Ei&&this.exceptionMonitor.setRemoteAudioStats(Ei,H),Fi&&this.exceptionMonitor.setRemoteVideoStats(Fi,$)})}}const QS=new class extends R_{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),_t(this,"_lastHiddenTime",0),_t(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),_n.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function xF(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function VO(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?xF(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):xF(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}function FO(o){return o.match(/^[\.\:\d]+$/)?"".concat(o.replace(/[^\d]/g,"-"),".").concat(_u("TURN_DOMAIN")):(_n.info("Cannot recognized as IP address ".concat(o,". Used As Host instead")),o)}function jF(o,s){var l,p;const _=_u("GATEWAY_DOMAINS");let b=_[1]&&s.indexOf(_[1])!==-1?1:0;o.addresses=o.addresses||[];const A=o.addresses.map(j=>j.domain_prefix?{address:"".concat(j.domain_prefix,".").concat(_[b++%_.length],":").concat(j.port)}:j.ip.match(/^[\.\:\d]+$/)?{ip:j.ip,port:j.port,address:"".concat(j.ip.replace(/[^\d]/g,"-"),".").concat(_[b++%_.length],":").concat(j.port)}:(_n.info("Cannot recognized as IP address ".concat(j.ip,". Used As Host instead")),{ip:j.ip,port:j.port,address:"".concat(j.ip,":").concat(j.port)}));if((l=o.detail)!==null&&l!==void 0&&l[18]&&typeof((p=o.detail)===null||p===void 0?void 0:p[18])=="string"){const j=o.detail[18],z=j==null?void 0:j.split(";");for(let H=0;H<z.length;H++){var k;const $=HS(k=z[H]).call(k);A[H]&&$&&(A[H].ip6=$)}}return{gatewayAddrs:A,uid:o.uid,cid:o.cid,cert:o.cert,vid:o.detail&&o.detail[8],uni_lbs_ip:o.detail&&o.detail[1],res:o,csIp:o.detail&&o.detail[502]}}function $S(o){return typeof o=="number"?o:o.exact||o.ideal||o.max||o.min||0}function VF(o){const s=o._encoderConfig;if(!s)return{};const l={resolution:s.width&&s.height?"".concat($S(s.width),"x").concat($S(s.height)):void 0,maxVideoBW:s.bitrateMax,minVideoBW:s.bitrateMin};return typeof s.frameRate=="number"?(l.maxFrameRate=s.frameRate,l.minFrameRate=s.frameRate):s.frameRate&&(l.maxFrameRate=s.frameRate.max||s.frameRate.ideal||s.frameRate.exact||s.frameRate.min,l.minFrameRate=s.frameRate.min||s.frameRate.ideal||s.frameRate.exact||s.frameRate.max),l}function FF(o){return o>=0&&o<.17?1:o>=.17&&o<.36?2:o>=.36&&o<.59?3:o>=.59&&o<=1?4:o>1?5:0}function iL(o,s){let l,p,_;switch(s){case $_.CHOOSE_SERVER:l=4096,p="choose server";break;case $_.CLOUD_PROXY:l=1048576,p="proxy";break;case $_.CLOUD_PROXY_5:l=4194304,p="proxy5";break;case $_.CLOUD_PROXY_FALLBACK:l=4194310,p="proxy fallback";break;default:throw new ga(Di.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:o.detail&&o.detail[502],retry:!1})}if(o.response_body.forEach(b=>{b.buffer&&b.buffer.flag===l&&(_={code:b.buffer.code,addresses:(b.buffer.edges_services||[]).map(A=>VO(VO({},A),{},{ticket:b.buffer.cert})),server_ts:o.enter_ts,uid:b.buffer.uid,cid:b.buffer.cid,cname:b.buffer.cname,detail:VO(VO({},b.buffer.detail),o.detail),flag:b.buffer.flag,opid:o.opid,cert:b.buffer.cert})}),!_)throw new ga(Di.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(p," from multi unilbs response"),{csIp:o.detail&&o.detail[502]});return _}async function RX(o,s){return await RE.all(o.addresses.map(async l=>({address:FO(l.ip),tcpport:l.port,udpport:l.port,username:s&&_u("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?s.toString():FT.username,password:s&&_u("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await cX(s.toString()):FT.password})))}function IX(o,s){const l=s._videoWidth||s.getMediaStreamTrack(!0).getSettings().width;return l||_n.warning("cannot get original video track's width, default scale down 4 times for low stream"),l?l/$S(o.width):4}function BO(o){let{candidateType:s,relayProtocol:l,type:p,address:_,port:b,protocol:A}=o;return p==="local-candidate"?{candidateType:s,relayProtocol:l,protocol:A}:{candidateType:s,relayProtocol:l,address:_,port:b,protocol:A}}function BF(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function YR(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?BF(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):BF(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}function DI(o){return window.TextEncoder?new TextEncoder().encode(o).length:o.length}function aT(o){return new RE(s=>{window.setTimeout(s,o)})}function OX(o){const s=new ga(Di.TIMEOUT,"timeout");return new RE((l,p)=>{window.setTimeout(()=>p(s),o)})}function y_(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,s=arguments.length>1?arguments[1]:void 0;const l=Math.random().toString(16).substr(2,o).toLowerCase();return l.length===o?"".concat(s).concat(l):"".concat(s).concat(l)+y_(o-l.length,"")}function oL(){return y_(32,"").toUpperCase()}const GO=()=>{};function GF(o){return new RE((s,l)=>{let p=!1;const _=document.createElement("video");_.setAttribute("autoplay",""),_.setAttribute("muted",""),_.muted=!0,_.autoplay=!0,_.setAttribute("playsinline",""),_.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(_);const b=ET()?"canplay":"playing";_.addEventListener(b,()=>{const A=_.videoWidth,k=_.videoHeight;!A&&O_()||(p=!0,_.srcObject=null,_.remove(),s([A,k]))}),_.srcObject=new MediaStream([o]),_.play().catch(GO),setTimeout(()=>{p||(_.srcObject=null,_.remove(),s([_.videoWidth,_.videoHeight]))},4e3)})}function kI(o){return RE.all(o.map(s=>s.then(l=>{throw l},l=>l))).then(s=>{throw s},s=>s)}function cT(o,s){for(var l=arguments.length,p=new Array(l>2?l-2:0),_=2;_<l;_++)p[_-2]=arguments[_];return o.getListeners(s).length===0?RE.reject(new ga(Di.UNEXPECTED_ERROR,"can not emit promise")):new RE((b,A)=>{o.emit(s,...p,b,A)})}function C_(o,s){if(o.getListeners(s).length===0)return RE.resolve();for(var l=arguments.length,p=new Array(l>2?l-2:0),_=2;_<l;_++)p[_-2]=arguments[_];return cT(o,s,...p)}function fS(o,s){if(o.getListeners(s).length===0)return null;for(var l=arguments.length,p=new Array(l>2?l-2:0),_=2;_<l;_++)p[_-2]=arguments[_];return zR(o,s,...p)}function zR(o,s){let l=null,p=null;for(var _=arguments.length,b=new Array(_>2?_-2:0),A=2;A<_;A++)b[A-2]=arguments[A];if(o.emit(s,...b,k=>{l=k},k=>{p=k}),p!==null)throw p;if(l===null)throw new ga(Di.UNEXPECTED_ERROR,"handler is not sync");return l}function sL(o,s){const l=o.indexOf(s);l!==-1&&o.splice(l,1)}function qF(o){const s=[];return o.forEach(l=>{s.indexOf(l)===-1&&s.push(l)}),s}function AS(o){RE.resolve().then(o)}function B_(o){return JSON.parse(JSON.stringify(o))}const WF={};function h0(o,s){WF[s]||(WF[s]=!0,o())}function aL(o){const s=window.atob(o),l=new Uint8Array(new ArrayBuffer(s.length));for(let p=0;p<s.length;p+=1)l[p]=s.charCodeAt(p);return l}function qO(o){let s="";for(let l=0;l<o.length;l+=1)s+=String.fromCharCode(o[l]);return window.btoa(s)}const KF=new class{constructor(){_t(this,"fnMap",new Map)}throttleByKey(o,s,l,p){for(var _=arguments.length,b=new Array(_>4?_-4:0),A=4;A<_;A++)b[A-4]=arguments[A];if(this.fnMap.has(s)){const k=this.fnMap.get(s);if(k.threshold!==l){k.fn(...k.args),clearTimeout(k.timer);const j=window.setTimeout(()=>{const z=this.fnMap.get(s);z&&z.fn(...z.args),this.fnMap.delete(s)},l);this.fnMap.set(s,{fn:o,threshold:l,timer:j,args:b,skipFn:p})}else k.skipFn&&k.skipFn(...k.args),this.fnMap.set(s,YR(YR({},k),{},{fn:o,args:b,skipFn:p}))}else{const k=window.setTimeout(()=>{const j=this.fnMap.get(s);j&&j.fn(...j.args),this.fnMap.delete(s)},l);this.fnMap.set(s,{fn:o,threshold:l,timer:k,args:b,skipFn:p})}}},HF=KF.throttleByKey.bind(KF),p0=async o=>{let{fragementLength:s,referenceList:l,asyncMapHandler:p,allFailedhandler:_,promisesCollector:b}=o,A=0;const k=s;let j,z=0;const H=async()=>{const $=(()=>{const ue=A*k,Ei=ue+k;return l.slice(ue,Ei).map(p)})();b&&b.push(...$);try{j=await kI($)}catch(ue){if(z+=k,A++,!(z>=l.length))return void await H();_(ue)}$.forEach(ue=>ue.cancel())};return await H(),j};function YF(o){return typeof o=="object"&&o!==null&&!(o instanceof RegExp)}const AX={[SI.ACCESS_POINT]:{[rT.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[rT.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[rT.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[rT.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[rT.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[rT.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[rT.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[rT.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[rT.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[rT.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[rT.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[rT.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[rT.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[rT.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[rT.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[rT.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[rT.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[rT.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[SI.UNILBS]:{[BT.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[BT.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[BT.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[BT.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[BT.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[BT.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[BT.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[BT.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[BT.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[BT.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[BT.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[BT.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[SI.STRING_UID_ALLOCATOR]:{[a0.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[a0.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[a0.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function WO(o){const s=AX[Math.floor(o/1e4)];if(!s)return{desc:"unkonw error",retry:!1};const l=s[o%1e4];if(!l){if(Math.floor(o/1e4)===SI.ACCESS_POINT){const p=o%1e4;if(p.toString()[0]==="1")return{desc:o.toString(),retry:!1};if(p.toString()[0]==="2")return{desc:o.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return l}const wX={[LE.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[LE.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[LE.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[LE.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[LE.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[LE.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[LE.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[LE.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[LE.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[LE.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[LE.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[LE.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[LE.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[LE.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[LE.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[LE.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[LE.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[LE.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[LE.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[LE.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[LE.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[LE.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[LE.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[LE.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[LE.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[LE.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[LE.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[LE.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[LE.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[LE.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[LE.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[LE.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[LE.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[LE.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[LE.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[LE.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[LE.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[LE.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[LE.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[LE.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[LE.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[LE.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[LE.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[LE.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[LE.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[LE.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[LE.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[LE.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[LE.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[LE.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[LE.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[LE.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[LE.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[LE.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[LE.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[LE.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[LE.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[LE.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[LE.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[LE.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[LE.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[LE.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[LE.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[LE.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function f0(o){return wX[o]||{desc:"UNKNOW_ERROR_".concat(o),action:"failed"}}function zF(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}class JR extends R_{get url(){return this.websocket?this.websocket.url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(s){["tryNext","recover"].includes(s)&&this.resetReconnectCount(s),this._reconnectMode=s}get state(){return this._state}set state(s){s!==this._state&&(this._state=s,this._state==="reconnecting"?this.emit(jE.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(jE.CONNECTED):this._state==="closed"?this.emit(jE.CLOSED):this._state==="failed"&&this.emit(jE.FAILED))}resetReconnectCount(s){_n.debug("websocket reset reconnect count, reason: "+s),this.reconnectCount=0}constructor(s,l){let p=arguments.length>2&&arguments[2]!==void 0&&arguments[2],_=arguments.length>3&&arguments[3]!==void 0&&arguments[3],b=arguments.length>4?arguments[4]:void 0;super(),_t(this,"connectionID",0),_t(this,"currentURLIndex",0),_t(this,"urls",void 0),_t(this,"_reconnectMode","tryNext"),_t(this,"reconnectReason",void 0),_t(this,"_initMutex",new gT("websocket")),_t(this,"name",void 0),_t(this,"_state","closed"),_t(this,"reconnectInterrupter",void 0),_t(this,"websocket",void 0),_t(this,"retryConfig",void 0),_t(this,"reconnectCount",0),_t(this,"forceCloseTimeout",5e3),_t(this,"onlineReconnectListener",void 0),_t(this,"useCompress",void 0),_t(this,"tryDoubleDomain",!1),_t(this,"wsInflateLength",0),_t(this,"wsDeflateLength",0),_t(this,"closeEstablishingWs",()=>{}),_t(this,"store",void 0),_t(this,"joinChannelServiceRecordIndex",void 0),this.store=b,this.name=s,this.retryConfig=function(H){for(var $=1;$<arguments.length;$++){var ue=arguments[$]!=null?arguments[$]:{};$%2?zF(Object(ue),!0).forEach(function(Ei){_t(H,Ei,ue[Ei])}):Object.getOwnPropertyDescriptors?Object.defineProperties(H,Object.getOwnPropertyDescriptors(ue)):zF(Object(ue)).forEach(function(Ei){Object.defineProperty(H,Ei,Object.getOwnPropertyDescriptor(ue,Ei))})}return H}({},l),this.useCompress=p,this.tryDoubleDomain=_;const{timeout:A,timeoutFactor:k}=l,j=Math.max(300,Math.floor(3*A/5)),z=Math.max(1.2,Math.floor(8*k)/10);dT.ONLINE&&(this.retryConfig.timeout=j,this.retryConfig.timeoutFactor=z),F_.on(ER.NETWORK_STATE_CHANGE,(H,$)=>{H!==$&&(this.resetReconnectCount("network state change: ".concat($," -> ").concat(H)),H===dT.ONLINE?(this.retryConfig.timeout=j,this.retryConfig.timeoutFactor=z):(this.retryConfig.timeout=A,this.retryConfig.timeoutFactor=k))})}getConnection(){return this.websocket||void 0}init(s){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this.forceCloseTimeout=l;const p=(_,b)=>{this.urls=s;const A=this.urls[this.currentURLIndex];this.state="connecting",this.createWebSocketConnection(A).then(_).catch(b),this.once(jE.CLOSED,()=>b(new ga(Di.WS_DISCONNECT))),this.once(jE.CONNECTED,()=>_())};return this._initMutex.lock().then(_=>new RE((b,A)=>{p(b,A)}).then(()=>{_()}).catch(()=>{_()}))}close(s,l){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const p=this.websocket;l?setTimeout(()=>p.close(),500):p.close(),this.websocket=void 0}this.state=s?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(s,l){if(!this.websocket)return void _n.warning("[".concat(this.name,"] can not reconnect, no websocket"));var p;s!==void 0&&(this.reconnectMode=s),_n.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinChannelServiceRecordIndex=="number"&&((p=this.store)===null||p===void 0||p.recordJoinChannelService({status:"error",errors:[new Error(l)]},this.joinChannelServiceRecordIndex));const _=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),_&&_.bind(this.websocket)({code:9999,reason:l})}sendMessage(s){let l=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ga(Di.WS_ABORT,"websocket is not ready");try{l||(s=JSON.stringify(s)),this.websocket.send(s)}catch(p){throw new ga(Di.WS_ERR,"send websocket message error"+p.toString())}}setWsInflateData(s){this.wsDeflateLength=this.wsDeflateLength+s.originLength,this.wsInflateLength=this.wsInflateLength+s.compressedLength}getWsInflateData(){const s=this.wsInflateLength,l=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:s,wsDeflateLength:l}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(s,l){return this.connectionID+=1,this.connectionID,this.joinChannelServiceRecordIndex=void 0,new RE((p,_)=>{var b;const A=H=>{var $;($=this.store)===null||$===void 0||$.signalChannelOpen(),_n.debug("[".concat(this.name,"] websocket opened:"),H),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),p()},k=async H=>{if(_n.debug("[".concat(this.name,"] websocket close ").concat(this.websocket&&this.websocket.url,", code: ").concat(H.code,", reason: ").concat(H.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=H.reason,this.state="reconnecting");const $=fS(this,jE.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,ue=await this.reconnectWithAction($);if(this.state==="closed")return void _n.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!ue)return _(new ga(Di.WS_DISCONNECT,"websocket reconnect failed: ".concat(H.code))),void this.close(!0);p()}else _(new ga(Di.WS_DISCONNECT,"websocket close: ".concat(H.code))),this.close()},j=H=>{this.emit(jE.ON_MESSAGE,H)};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),_u("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(s=_u("GATEWAY_WSS_ADDRESS")),_n.debug("[".concat(this.name,"] start connect, url: ").concat(s));const z=(b=this.store)===null||b===void 0?void 0:b.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});this.chooseBestWebsocketConnection(s,!!l,z).then(H=>{var $;this.websocket=H,A&&A(H.url),H.onclose=k,H.onmessage=j,($=this.store)===null||$===void 0||$.recordJoinChannelService({endTs:Date.now(),status:"success"},z),this.joinChannelServiceRecordIndex=z}).catch(H=>{var $;if(($=this.store)===null||$===void 0||$.recordJoinChannelService({endTs:Date.now(),status:H instanceof ga&&H.code===Di.WS_ABORT?"aborted":"error",errors:[H]},z),this.state!=="closed"){if(H instanceof ga&&H.code===Di.WS_ERR){const ue=new ga(Di.WS_ERR,"init websocket failed! Error: ".concat(H.toString()));return _n.error("[".concat(this.name,"]").concat(ue)),void _(ue)}k&&k(H)}else _(new ga(Di.WS_DISCONNECT,"websocket is closed: ".concat(H.toString())))})})}async reconnectWithAction(s){let l=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||!this.urls||this.state==="closed")return!1;this.onlineReconnectListener||F_.networkState!==dT.OFFLINE||(this.onlineReconnectListener=F_.onlineWaiter&&F_.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let p=!0;if(this.reconnectInterrupter=()=>{p=!1},l){const A=uD(this.reconnectCount,this.retryConfig);_n.debug("[".concat(this.name,"] wait ").concat(A,"ms to reconnect websocket, mode: ").concat(s)),await RE.race([aT(A),this.onlineReconnectListener||new RE(()=>{})])}if(this.state==="closed"||!p)return!1;this.reconnectCount+=1;const _=async(A,k)=>{this.emit(jE.RECONNECT_CREATE_CONNECTION,k),await this.createWebSocketConnection(A)};try{if(s==="retry"){const A=this.urls[this.currentURLIndex];this.emit(jE.RECONNECT_WAITTING_FINISH,s),await _(A,s)}else if(s==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover",!1);_n.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex));const A=this.urls[this.currentURLIndex];this.emit(jE.RECONNECT_WAITTING_FINISH,s),await _(A,s)}else if(s==="recover"){_n.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(jE.RECONNECT_WAITTING_FINISH,s),this.urls=await cT(this,jE.REQUEST_NEW_URLS),this.currentURLIndex=0;const A=this.urls[this.currentURLIndex];await _(A,s)}return!0}catch(A){var b;return _n.error("[".concat(this.name,"] reconnect failed"),A.toString()),A!=null&&(b=A.data)!==null&&b!==void 0&&b.desc&&Array.isArray(A.data.desc)&&A.data.desc.length&&A.data.desc.includes("dynamic key expired")?(this.emit(jE.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(s,l)}}async chooseBestWebsocketConnection(s,l,p){return new RE((_,b)=>{let A=!1;const k=[];this.closeEstablishingWs=()=>{_n.debug("[choose-best-ws] close establishing websockets"),k.forEach(Gi=>{Gi.onclose=null,Gi.onopen=null,Gi.onmessage=null,Gi.close()}),b(new ga(Di.WS_ABORT,"choose best websocket aborted"))};const j=_u("GATEWAY_DOMAINS");let z;const H=s.indexOf("?h="),$=j.find(Gi=>H!==-1?s.includes(Gi,H):s.includes(Gi));_n.debug("[choose-best-ws] currentDomain: ",$,", domains: ",j);let ue=!this.tryDoubleDomain||l||!$;if(!ue&&$){var Ei;const Gi=Date.now();try{j.forEach(_o=>{const _f=H===-1?s.replace($,_o):s.substr(0,H)+s.substr(H).replace($,_o),vf=new WebSocket(_f);vf.binaryType="arraybuffer",k.push(vf),_n.debug("[choose-best-ws] ws is connecting:",vf.url)})}catch{for(_n.debug("[choose-best-ws] ws create failed, fallback to single url"),k.forEach(_f=>_f.close());k.length;)k.pop();ue=!0}(Ei=this.store)===null||Ei===void 0||Ei.recordJoinChannelService({urls:k.map(_o=>_o.url),service:"gateway"},p),k.forEach(_o=>{_o.onopen=()=>{if(A)return;const _f=Date.now()-Gi;_n.debug("[choose-best-ws] ws open cost ".concat(_f,"ms")),k.filter(vf=>vf!==_o).forEach(vf=>{_n.debug("[choose-best-ws]close backup websocket: ".concat(vf.url)),vf.close()}),A=!0,_(_o)},_o.onclose=_f=>{z=_f,!A&&(k.find(vf=>!(vf.readyState===WebSocket.CLOSED||vf.readyState===WebSocket.CLOSING))||(_n.debug("[choose-best-ws] all websocket is closed"),A=!0,b(z)))},_o.onmessage=_f=>{_n.debug("[choose-best-ws]".concat(_o.url," onmessage: ").concat(_f.data))}}),aT(this.forceCloseTimeout).then(()=>{k.forEach(_o=>{_o.readyState!==WebSocket.OPEN&&_o.close()})})}if(ue){var Fi;let Gi;_n.debug("[choose-best-ws] use single url: ",s),(Fi=this.store)===null||Fi===void 0||Fi.recordJoinChannelService({urls:[s],service:"gateway"},p);try{Gi=new WebSocket(s),k.push(Gi),Gi.binaryType="arraybuffer"}catch(_o){const _f=new ga(Di.WS_ERR,"init websocket failed! Error: ".concat(_o.toString()));return _n.error("[".concat(this.name,"]").concat(_f)),void b(_f)}Gi.onopen=()=>{_(Gi)},Gi.onclose=_o=>{b(_o)},Gi.onmessage=_o=>{_n.debug("[choose-best-ws]".concat(Gi.url," onmessage: ").concat(_o.data))},aT(this.forceCloseTimeout).then(()=>{Gi&&Gi.readyState!==WebSocket.OPEN&&Gi.close()})}}).then(_=>(this.closeEstablishingWs=void 0,_)).catch(_=>{throw this.closeEstablishingWs=void 0,_})}}class JF{constructor(s){_t(this,"input",[]),_t(this,"size",void 0),this.size=s}add(s){this.input.push(s),this.input.length>this.size&&this.input.splice(0,1)}mean(){var s;return this.input.length===0?0:aR(s=this.input).call(s,(l,p)=>l+p)/this.input.length}}class XF extends R_{get connectionState(){return this._connectionState}set connectionState(s){s!==this._connectionState&&(this._connectionState=s,s===u_.CONNECTED?this.emit(NE.WS_CONNECTED):s===u_.RECONNECTING?this.emit(NE.WS_RECONNECTING,this._websocketReconnectReason):s===u_.CLOSED&&this.emit(NE.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(s,l){super(),_t(this,"_disconnectedReason",void 0),_t(this,"_websocketReconnectReason",void 0),_t(this,"_connectionState",u_.CLOSED),_t(this,"reconnectToken",void 0),_t(this,"websocket",void 0),_t(this,"openConnectionTime",void 0),_t(this,"clientId",void 0),_t(this,"lastMsgTime",Date.now()),_t(this,"uploadCache",[]),_t(this,"uploadCacheInterval",void 0),_t(this,"rttRolling",new JF(5)),_t(this,"pingpongTimer",void 0),_t(this,"wsInflateDataTimer",void 0),_t(this,"pingpongTimeoutCount",0),_t(this,"joinResponse",void 0),_t(this,"multiIpOption",void 0),_t(this,"initError",void 0),_t(this,"spec",void 0),_t(this,"store",void 0),_t(this,"onWebsocketMessage",p=>{if(p.data instanceof ArrayBuffer)return void this.emit(NE.ON_BINARY_DATA,p.data);const _=JSON.parse(p.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(_,"_id")){const b="res-@".concat(_._id);this.emit(b,_._result,_._message)}else if(Object.prototype.hasOwnProperty.call(_,"_type")){if(this.emit(_._type,_._message),_._type===qE.ON_NOTIFICATION&&this.handleNotification(_._message),_._type===qE.ON_USER_BANNED)switch(_._message.error_code){case 14:this.close(i_.UID_BANNED);break;case 15:this.close(i_.IP_BANNED);break;case 16:this.close(i_.CHANNEL_BANNED)}if(_._type===qE.ON_USER_LICENSE_BANNED)switch(_._message.error_code){case LE.ERR_LICENSE_MISSING:this.close(i_.LICENSE_MISSING);break;case LE.ERR_LICENSE_EXPIRED:this.close(i_.LICENSE_EXPIRED);break;case LE.ERR_LICENSE_MINUTES_EXCEEDED:this.close(i_.LICENSE_MINUTES_EXCEEDED);break;case LE.ERR_LICENSE_PERIOD_INVALID:this.close(i_.LICENSE_PERIOD_INVALID);break;case LE.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(i_.LICENSE_MULTIPLE_SDK_SERVICE);break;case LE.ERR_LICENSE_ILLEGAL:this.close(i_.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=s.clientId,this.spec=s,this.store=l,this.websocket=new JR("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,l),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===u_.CONNECTED&&this.reconnect("retry",TT.OFFLINE)})}async request(s,l,p,_){const b=y_(6,""),A={_id:b,_type:s,_message:l},k=this.websocket.connectionID,j=()=>new RE((Fi,Gi)=>{if(this.connectionState===u_.CONNECTED)return Fi();const _o=()=>{this.off(NE.WS_CLOSED,_f),Fi()},_f=()=>{this.off(NE.WS_CONNECTED,_o),Gi(new ga(Di.WS_ABORT))};this.once(NE.WS_CONNECTED,_o),this.once(NE.WS_CLOSED,_f),s!==ME.PUBLISH&&s!==ME.SUBSCRIBE&&s!==ME.UNSUBSCRIBE&&s!==ME.UNPUBLISH&&s!==ME.CONTROL&&s!==ME.RESTART_ICE||this.once(NE.DISCONNECT_P2P,()=>{Gi(new ga(Di.DISCONNECT_P2P))}),s!==ME.PUBLISH&&s!==ME.RESTART_ICE||this.once(NE.ABORT_P2P_EXECUTION,()=>{Gi(new ga(Di.DISCONNECT_P2P))})});if(this.connectionState!==u_.CONNECTING&&this.connectionState!==u_.RECONNECTING||s===ME.JOIN||s===ME.REJOIN||await j(),this.websocket.sendMessage(A,!0),_)return;const z=new RE((Fi,Gi)=>{let _o=!1;const _f=(uE,IE)=>{_o=!0,Fi({isSuccess:uE==="success",message:IE||{}}),this.off(NE.WS_CLOSED,vf),this.off(NE.WS_RECONNECTING,vf),this.emit(NE.REQUEST_SUCCESS,s,l)};this.once("res-@".concat(b),_f);const vf=()=>{Gi(new ga(Di.WS_ABORT,"type: ".concat(s))),this.off(NE.WS_CLOSED,vf),this.off(NE.WS_RECONNECTING,vf),this.off("res-@".concat(b),_f)};this.once(NE.WS_CLOSED,vf),this.once(NE.WS_RECONNECTING,vf),aT(_u("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==k||_o||(_n.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(s)),this.emit(NE.REQUEST_TIMEOUT,s,l))})});let H=null;try{H=await z}catch(Fi){if(this.connectionState===u_.CLOSED||s===ME.LEAVE)throw new ga(Di.WS_ABORT);return!this.spec.forceWaitGatewayResponse||p?Fi.throw():s===ME.JOIN||s===ME.REJOIN?null:(await j(),await this.request(s,l))}if(H.isSuccess)return H.message;const $=Number(H.message.error_code||H.message.code),ue=f0($),Ei=new ga(Di.UNEXPECTED_RESPONSE,"".concat(ue.desc,": ").concat(H.message.error_str),{code:$,data:H.message});return ue.action==="success"?H.message:(_n.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(s,", error_code: ").concat($,", message: ").concat(ue.desc,", action: ").concat(ue.action)),$===LE.ERR_TOO_MANY_BROADCASTERS?((s===ME.JOIN||s===ME.REJOIN)&&(this.initError=Ei,this.close()),Ei.throw()):ue.action==="failed"?Ei.throw():ue.action==="quit"?(this.initError=Ei,this.close(),Ei.throw()):($===LE.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=H.message.option,_n.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",TT.MULTI_IP)):this.reconnect(ue.action,TT.SERVER_ERROR),s===ME.JOIN||s===ME.REJOIN?null:await this.request(s,l)))}waitMessage(s,l){return new RE(p=>{const _=b=>{(!l||l(b))&&(this.off(s,_),p(b))};this.on(s,_)})}upload(s,l){const p={_type:s,_message:l};try{this.websocket.sendMessage(p)}catch{const b=_u("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(p),this.uploadCache.length>b&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==u_.CONNECTED)return;const A=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(A._type,A._message)},_u("UPLOAD_CACHE_INTERVAL")||2e3))}}send(s,l){const p={_type:s,_message:l};this.websocket.sendMessage(p)}init(s,l){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new RE((p,_)=>{this.once(NE.WS_CONNECTED,()=>p(this.joinResponse)),this.once(NE.WS_CLOSED,()=>_(this.initError||new ga(Di.WS_ABORT))),this.connectionState=u_.CONNECTING,this.websocket.init(s).catch(_),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4),setTimeout(()=>{l&&this.openConnectionTime===void 0&&(_n.debug("[".concat(this.clientId,"] init websocket timeout while join with fallback to proxy")),_(new ga(Di.INIT_WEBSOCKET_TIMEOUT)))},_u("JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION"))})}close(s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=s||i_.LEAVE,this.connectionState=u_.CLOSED,_n.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),s===i_.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new JR("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(NE.ABORT_P2P_EXECUTION);const s=await cT(this,NE.REQUEST_JOIN_INFO),l=await this.request(ME.JOIN,s);if(!l)return this.emit(NE.REPORT_JOIN_GATEWAY,Di.TIMEOUT,this.url||""),!1;this.joinResponse=l,this.emit(NE.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=u_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ga(Di.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const s=zR(this,NE.REQUEST_REJOIN_INFO);s.token=this.reconnectToken;const l=await this.request(ME.REJOIN,s);return!!l&&(this.connectionState=u_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),l.peers&&l.peers.forEach(p=>{this.emit(qE.ON_USER_ONLINE,{uid:p.uid}),p.audio&&this.emit(qE.ON_ADD_AUDIO_STREAM,{uid:p.uid,uint_id:p.uint_id,audio:!0,ssrcId:p.audio_ssrc}),p.video&&this.emit(qE.ON_ADD_VIDEO_STREAM,{uid:p.uid,uint_id:p.uint_id,video:!0,ssrcId:p.video_ssrc}),p.audio_mute?this.emit(qE.MUTE_AUDIO,{uid:p.uid}):this.emit(qE.UNMUTE_AUDIO,{uid:p.uid}),p.video_mute?this.emit(qE.MUTE_VIDEO,{uid:p.uid}):this.emit(qE.UNMUTE_VIDEO,{uid:p.uid}),p.audio_enable_local?this.emit(qE.ENABLE_LOCAL_AUDIO,{uid:p.uid}):this.emit(qE.DISABLE_LOCAL_AUDIO,{uid:p.uid}),p.video_enable_local?this.emit(qE.ENABLE_LOCAL_VIDEO,{uid:p.uid}):this.emit(qE.DISABLE_LOCAL_VIDEO,{uid:p.uid}),p.audio||p.video||this.emit(qE.ON_REMOVE_STREAM,{uid:p.uid,uint_id:p.uint_id})}),!0)}reconnect(s,l){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(s,l)}handleNotification(s){_n.debug("[".concat(this.clientId,"] receive notification: "),s);const l=f0(s.code);if(l.action!=="success"){if(l.action!=="failed")return l.action==="quit"?(l.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(i_.UID_BANNED),void this.close()):void this.reconnect(l.action,TT.SERVER_ERROR);_n.error("[".concat(this.clientId,"] ignore error: "),l.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const s=_u("PING_PONG_TIME_OUT"),l=Date.now();this.pingpongTimeoutCount>=s&&(_n.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(l-this.lastMsgTime,"ms")),l-this.lastMsgTime>_u("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",TT.TIMEOUT):this.request(ME.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const p=Date.now()-l;this.rttRolling.add(p),_u("REPORT_STATS")&&this.send(ME.PING_BACK,{pingpongElapse:p})}).catch(p=>{})}handleWsInflateData(){const{wsInflateLength:s,wsDeflateLength:l}=this.websocket.getWsInflateData();s!==0&&l!==0&&this.upload(kT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:l,ws_inflate_length:s})}handleWebsocketEvents(){this.websocket.on(jE.RECONNECT_WAITTING_FINISH,s=>{this.emit(NE.WS_RECONNECT_WAITTING_FINISH,s)}),this.websocket.on(jE.RECONNECT_CREATE_CONNECTION,s=>{this.emit(NE.WS_RECONNECT_CREATE_CONNECTION,s)}),this.websocket.on(jE.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(jE.CLOSED,()=>{this.connectionState=u_.CLOSED}),this.websocket.on(jE.FAILED,()=>{this._disconnectedReason=i_.NETWORK_ERROR,this.connectionState=u_.CLOSED}),this.websocket.on(jE.RECONNECTING,s=>{this._websocketReconnectReason=s,this.joinResponse=void 0,this.connectionState===u_.CONNECTED?this.connectionState=u_.RECONNECTING:this.connectionState=u_.CONNECTING}),this.websocket.on(jE.WILL_RECONNECT,(s,l)=>{if(zR(this,NE.IS_P2P_DISCONNECTED)&&s==="retry")return _n.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(NE.NEED_RENEW_SESSION),this.emit(NE.DISCONNECT_P2P),l("tryNext");s!=="retry"&&(_n.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(s)),this.reconnectToken=void 0,this.emit(NE.NEED_RENEW_SESSION),this.emit(NE.DISCONNECT_P2P)),l(s)}),this.websocket.on(jE.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(s=>{_n.warning("[".concat(this.clientId,"] rejoin failed ").concat(s)),this.reconnect("tryNext",TT.SERVER_ERROR)}):this.join().catch(s=>{if(this.emit(NE.REPORT_JOIN_GATEWAY,s.message||s.code,this.url||""),s instanceof ga&&s.code===Di.UNEXPECTED_RESPONSE&&s.data.code===LE.ERR_NO_AUTHORIZED)return _n.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",TT.SERVER_ERROR);_n.error("[".concat(this.clientId,"] join gateway request failed"),s.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",TT.SERVER_ERROR):(this.initError=s,this.close())})}),this.websocket.on(jE.REQUEST_NEW_URLS,(s,l)=>{cT(this,NE.REQUEST_RECOVER,this.multiIpOption).then(s).catch(l)}),this.websocket.on(jE.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(qE.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function QF(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}class CX extends R_{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(s){["tryNext","recover"].includes(s)&&this.resetReconnectCount(s),this._reconnectMode=s}get state(){return this._state}set state(s){s!==this._state&&(this._state=s,this._state==="reconnecting"?this.emit(A_.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(A_.CONNECTED):this._state==="closed"?this.emit(A_.CLOSED):this._state==="failed"&&this.emit(A_.FAILED))}constructor(s,l,p,_){super(),_t(this,"connectionID",0),_t(this,"currentURLIndex",0),_t(this,"reconnectReason",void 0),_t(this,"_reconnectMode","tryNext"),_t(this,"_initMutex",void 0),_t(this,"_name",void 0),_t(this,"_state","closed"),_t(this,"_reconnectInterrupter",void 0),_t(this,"_url",void 0),_t(this,"_retryConfig",void 0),_t(this,"_reconnectCount",0),_t(this,"_forceCloseTimeout",5e3),_t(this,"_onlineReconnectListener",void 0),_t(this,"_closeEstablishingTransmitter",()=>{}),_t(this,"_store",void 0),_t(this,"_joinChannelServiceRecordIndex",void 0),_t(this,"_transmitter",void 0),_t(this,"_useCompress",void 0),_t(this,"_inflateLength",0),_t(this,"_deflateLength",0),this._store=_,this._name=s,this._retryConfig=function(b){for(var A=1;A<arguments.length;A++){var k=arguments[A]!=null?arguments[A]:{};A%2?QF(Object(k),!0).forEach(function(j){_t(b,j,k[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(k)):QF(Object(k)).forEach(function(j){Object.defineProperty(b,j,Object.getOwnPropertyDescriptor(k,j))})}return b}({},l),this._useCompress=p}resetReconnectCount(s){_n.debug("".concat(this._name," reset reconnect count, reason: ").concat(s)),this._reconnectCount=0}close(s,l){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const p=this._transmitter;l?setTimeout(()=>p.close(),500):p.close(),this._transmitter=void 0}this.state=s?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(s,l){if(!this._transmitter)return void _n.warning("[".concat(this._name,"] can not reconnect, no websocket"));var p;s!==void 0&&(this.reconnectMode=s),_n.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((p=this._store)===null||p===void 0||p.recordJoinChannelService({status:"error",errors:[new Error(l)]},this._joinChannelServiceRecordIndex));const _=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),_&&_.bind(this._transmitter)({code:9999,reason:l})}getInflateData(){const s=this._inflateLength,l=this._deflateLength;return this.clearInflateData(),{inflateLength:s,deflateLength:l}}setInflateData(s){this._deflateLength=this._deflateLength+s.originLength,this._inflateLength=this._inflateLength+s.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}function $F(o,s,l){if("getBigUint64"in DataView.prototype)return o.getBigUint64(s,l);const p=o.getUint32(s,l),_=o.getUint32(s+4,l),b=+!!l,A=+!l;return BigInt(p*A+_*b)<<BigInt(32)|BigInt(p*b+_*A)}function ZF(o,s,l,p){if("setBigUint64"in DataView.prototype)return o.setBigUint64(s,l,p);const _=Number(l>>BigInt(32)),b=Number(l&BigInt(4294967295));p?(o.setUint32(s+4,_,p),o.setUint32(s,b,p)):(o.setUint32(s,_,p),o.setUint32(s+4,b,p))}let nS;(function(o){o[o.Default=0]="Default",o[o.Ack=1]="Ack"})(nS||(nS={}));class NX{constructor(s,l,p){_t(this,"version",1),_t(this,"initialRTO",void 0),_t(this,"maxBatchAckCount",void 0),_t(this,"maxRTO",void 0),_t(this,"initialRTT",void 0),_t(this,"ID",void 0),_t(this,"rtt",void 0),_t(this,"packetNumber",1),_t(this,"rtoRatioMap",new Map),_t(this,"timeoutMap",new Map),_t(this,"unorderedPacketQueue",[]),_t(this,"batchAckPacketQueue",[]),_t(this,"lastOrderedPacketNumber",0),_t(this,"batchAckTimer",void 0),_t(this,"sendImpl",void 0),_t(this,"receiveImpl",void 0),this.sendImpl=s,this.receiveImpl=l,this.ID=y_(7,"transmitter-"),this.initialRTO=(p==null?void 0:p.initialRTO)!==void 0?p.initialRTO:_u("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(p==null?void 0:p.initialRTT)!==void 0?p.initialRTT:_u("TRANSMITTER_INITIAL_RTT"),this.rtt=(p==null?void 0:p.initialRTT)!==void 0?p.initialRTT:_u("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(p==null?void 0:p.maxBatchAckCount)!==void 0?p.maxBatchAckCount:_u("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(p==null?void 0:p.maxRTO)!==void 0?p.maxRTO:_u("TRANSMITTER_MAX_RTO")}packetize(s,l){return{type:nS.Default,version:this.version,packetNumber:l,payload:s}}serialize(s){switch(s.type){case nS.Default:{let l;typeof s.payload=="string"?l=new TextEncoder().encode(s.payload):l=s.payload;const p=new ArrayBuffer(l.length+15),_=new DataView(p);return _.setUint16(0,s.version),_.setUint8(2,s.type),_.setUint32(3,s.packetNumber),ZF(_,7,BigInt(s.sendTs)),new Uint8Array(_.buffer).set(l,15),p}case nS.Ack:{const l=new ArrayBuffer(16),p=new DataView(l);return p.setUint16(0,s.version),p.setUint8(2,s.type),p.setUint32(3,s.maxAckPacketNumber),p.setUint8(7,s.shift),ZF(p,8,BigInt(s.ackSendTs)),l}}}deserialize(s){const l=new DataView(s),p=l.getUint16(0),_=l.getUint8(2);switch(_){case nS.Default:{const b=l.getUint32(3),A=$F(l,7),k=s.slice(15),j=new TextDecoder().decode(k);return{version:p,type:_,packetNumber:b,sendTs:Number(A),payload:j}}case nS.Ack:{const b=l.getUint32(3),A=l.getUint8(7),k=$F(l,8);return{version:p,type:_,maxAckPacketNumber:b,shift:A,ackSendTs:Number(k)}}default:throw _n.error("[".concat(this.ID,"] Unrecognized packet type ").concat(_)),new Error("Unrecognized packet type ".concat(_))}}sendMessage(s){const l=this.packetize(s,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const p=this.calculateRTO(l),_=window.setTimeout(()=>{this.resendMessage(l)},p);this.timeoutMap.set(l.packetNumber,_),this.sendPacket(l)}onData(s){const l=this.deserialize(s);l.type===nS.Default?this.ack(l):l.type===nS.Ack&&(this.updateRTT(l,Math.round(performance.now())),this.clearRTO(l))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(s=>{let[l,p]=s;window.clearTimeout(p)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(s){const l=this.calculateRTO(s),p=window.setTimeout(()=>{this.resendMessage(s)},l);this.timeoutMap.set(s.packetNumber,p),this.sendPacket(s)}calculateRTO(s){const l=this.rtoRatioMap.get(s.packetNumber);if(l===void 0)return this.rtoRatioMap.set(s.packetNumber,1),this.initialRTO;{const p=9*this.rtt/8*l;return this.rtoRatioMap.set(s.packetNumber,l+1),p>this.maxRTO?this.maxRTO:p}}updateRTT(s,l){const p=s.ackSendTs;this.rtt=this.rtt*(7/8)+(l-p-this.rtt)/8}ack(s){if(s.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(s):(this.batchAckPacketQueue.push(s),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(s.payload);;){const l=this.unorderedPacketQueue[0];if(!l){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(l.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(s.packetNumber<=this.lastOrderedPacketNumber){const l={ackSendTs:s.sendTs,maxAckPacketNumber:s.packetNumber,shift:0,type:nS.Ack,version:this.version};this.sendPacket(l)}else if(s.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[s.packetNumber-this.lastOrderedPacketNumber-2]=s;const l={ackSendTs:s.sendTs,maxAckPacketNumber:s.packetNumber,shift:0,type:nS.Ack,version:this.version};this.sendPacket(l)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const s={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:nS.Ack,version:this.version};this.sendPacket(s),this.batchAckPacketQueue=[]}sendPacket(s){s.type===nS.Default&&(s.sendTs=Math.round(performance.now()));const l=this.serialize(s);this.sendImpl(l)}clearRTO(s){for(let l=s.maxAckPacketNumber-s.shift;l<=s.maxAckPacketNumber;l++){const p=this.timeoutMap.get(l);p!==void 0&&window.clearTimeout(p),this.timeoutMap.delete(l),this.rtoRatioMap.delete(l)}}}class t3 extends CX{constructor(s,l){super(s,l,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),_t(this,"_initMutex",void 0),_t(this,"_reconnectInterrupter",void 0),_t(this,"_url",void 0),_t(this,"_transmitter",void 0),_t(this,"_addresses",void 0),_t(this,"_reliableTransmission",void 0),this._initMutex=new gT("datachannel");const{timeout:p,timeoutFactor:_}=l,b=Math.max(300,Math.floor(3*p/5)),A=Math.max(1.2,Math.floor(8*_)/10);dT.ONLINE&&(this._retryConfig.timeout=b,this._retryConfig.timeoutFactor=A),F_.on(ER.NETWORK_STATE_CHANGE,(k,j)=>{k!==j&&(this.resetReconnectCount("network state change: ".concat(j," -> ").concat(k)),k===dT.ONLINE?(this._retryConfig.timeout=b,this._retryConfig.timeoutFactor=A):(this._retryConfig.timeout=p,this._retryConfig.timeoutFactor=_))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(s){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=l;const p=(_,b)=>{this._addresses=s,this.currentURLIndex=this._addresses.findIndex(k=>k.fingerprint||_u("FINGERPRINT"));const A=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(A).then(_).catch(b),this.once(A_.CLOSED,()=>b(new ga(Di.WS_DISCONNECT))),this.once(A_.CONNECTED,()=>_())};return this._initMutex.lock().then(_=>new RE((b,A)=>{p(b,A)}).then(()=>{_()}).catch(()=>{_()}))}sendMessage(s){let l=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new ga(Di.WS_ABORT,"datachannel is not ready");try{l||(s=JSON.stringify(s)),this._reliableTransmission.sendMessage(s)}catch(p){throw new ga(Di.WS_ERR,"send datachannel signal message error"+p.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(s){const l=JSON.stringify(s);return{compressed:l,compressedLength:l.length,origin:s}}sendMessageWithUint8Array(s){return{compressed:s,compressedLength:s.byteLength,origin:s}}createTransmitterConnection(s){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(s.ip,":").concat(s.port),new RE((l,p)=>{var _;const b=()=>{_n.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),l()},A=async H=>{var $;if(($=this._closeEstablishingTransmitter)===null||$===void 0||$.call(this),_n.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(H.code,", reason: ").concat(H.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=H.reason,this.state="reconnecting");const ue=fS(this,A_.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,Ei=await this.reconnectWithAction(ue);if(this.state==="closed")return void _n.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!Ei)return p(new ga(Di.WS_DISCONNECT,"datachannel reconnect failed: ".concat(H.code))),void this.close(!0);l()}else p(new ga(Di.WS_DISCONNECT,"datachannel close: ".concat(H.code))),this.close()},k=H=>{var $;($=this._reliableTransmission)===null||$===void 0||$.onData(H.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),_n.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(s)));const j=(_=this._store)===null||_===void 0?void 0:_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),z=Date.now();cT(this,A_.TO_CONNECT_DATACHANNEL,s).then(H=>{var $,ue;if(!H)throw new Error("transmissonInfo not exist yet");const{transmitter:Ei,close:Fi}=H;this._transmitter=Ei,($=this._store)===null||$===void 0||$.signalChannelOpen();const Gi=Date.now()-z;_n.debug("[choose dc] dc open cost ".concat(Gi,"ms")),this._reliableTransmission=new NX(_o=>{var _f;this._transmitter&&this._transmitter.readyState==="open"&&((_f=this._transmitter)===null||_f===void 0||_f.send(_o))},_o=>{typeof _o=="string"&&this.emit(A_.ON_MESSAGE,_o)}),this._closeEstablishingTransmitter=()=>{var _o;(_o=this._reliableTransmission)===null||_o===void 0||_o.close(),this._reliableTransmission=void 0,Fi()},b&&b(),Ei.onclose=A,Ei.onmessage=k,(ue=this._store)===null||ue===void 0||ue.recordJoinChannelService({endTs:Date.now(),status:"success"},j),this._joinChannelServiceRecordIndex=j}).catch(H=>{var $;if(($=this._store)===null||$===void 0||$.recordJoinChannelService({endTs:Date.now(),status:H instanceof ga&&H.code===Di.WS_ABORT?"aborted":"error",errors:[H]},j),this.state!=="closed"){if(H instanceof ga&&H.code===Di.WS_ERR){const ue=new ga(Di.WS_ERR,"init datachannel failed! Error: ".concat(H.toString()));return _n.error("[".concat(this._name,"]").concat(ue)),void p(ue)}A&&A(H)}else p(new ga(Di.WS_DISCONNECT,"datachannel is closed: ".concat(H.toString())))})})}async reconnectWithAction(s){let l=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||F_.networkState!==dT.OFFLINE||(this._onlineReconnectListener=F_.onlineWaiter&&F_.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let p=!0;if(this._reconnectInterrupter=()=>{p=!1},l){const A=uD(this._reconnectCount,this._retryConfig);_n.debug("[".concat(this._name,"] wait ").concat(A,"ms to reconnect datachannel, mode: ").concat(s)),await RE.race([aT(A),this._onlineReconnectListener||new RE(()=>{})])}if(this.state==="closed"||!p)return!1;this._reconnectCount+=1;const _=async(A,k)=>{this.emit(A_.RECONNECT_CREATE_CONNECTION,k),await this.createTransmitterConnection(A)};try{if(s==="retry"){const A=this._addresses[this.currentURLIndex];this.emit(A_.RECONNECT_WAITTING_FINISH,s),await _(A,s)}else if(s==="tryNext"){this.currentURLIndex+=1;for(let k=this.currentURLIndex;k<this._addresses.length;k++){if(this._addresses[k].fingerprint||_u("FINGERPRINT")){this.currentURLIndex=k;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return _n.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);_n.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const A=this._addresses[this.currentURLIndex];this.emit(A_.RECONNECT_WAITTING_FINISH,s),await _(A,s)}else s==="recover"&&(_n.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(A_.RECONNECT_WAITTING_FINISH,s),this.emit(A_.FAILBACK));return!0}catch(A){var b;return _n.error("[".concat(this._name,"] reconnect failed"),A.toString()),A!=null&&(b=A.data)!==null&&b!==void 0&&b.desc&&Array.isArray(A.data.desc)&&A.data.desc.length&&A.data.desc.includes("dynamic key expired")?(this.emit(A_.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(s,l)}}}class ZS extends R_{get connectionState(){return this._connectionState}set connectionState(s){s!==this._connectionState&&(this._connectionState=s,s===u_.CONNECTED?this.emit(NE.WS_CONNECTED):s===u_.RECONNECTING?this.emit(NE.WS_RECONNECTING,this._websocketReconnectReason):s===u_.CLOSED&&this.emit(NE.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(s,l){super(),_t(this,"_disconnectedReason",void 0),_t(this,"_websocketReconnectReason",void 0),_t(this,"_connectionState",u_.CLOSED),_t(this,"reconnectToken",void 0),_t(this,"websocket",void 0),_t(this,"openConnectionTime",void 0),_t(this,"clientId",void 0),_t(this,"lastMsgTime",Date.now()),_t(this,"uploadCache",[]),_t(this,"uploadCacheInterval",void 0),_t(this,"rttRolling",new JF(5)),_t(this,"pingpongTimer",void 0),_t(this,"inflateDataTimer",void 0),_t(this,"pingpongTimeoutCount",0),_t(this,"joinResponse",void 0),_t(this,"multiIpOption",void 0),_t(this,"initError",void 0),_t(this,"spec",void 0),_t(this,"store",void 0),_t(this,"onWebsocketMessage",p=>{if(p instanceof ArrayBuffer)return void this.emit(NE.ON_BINARY_DATA,p);const _=JSON.parse(p);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(_,"_id")){const b="res-@".concat(_._id);this.emit(b,_._result,_._message)}else if(Object.prototype.hasOwnProperty.call(_,"_type")&&(this.emit(_._type,_._message),_._type===qE.ON_NOTIFICATION&&this.handleNotification(_._message),_._type===qE.ON_USER_BANNED))switch(_._message.error_code){case 14:this.close(i_.UID_BANNED);break;case 15:this.close(i_.IP_BANNED);break;case 16:this.close(i_.CHANNEL_BANNED)}}),this.clientId=s.clientId,this.spec=s,this.store=l,this.websocket=new t3("gateway-".concat(this.clientId),this.spec.retryConfig,!0,l),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===u_.CONNECTED&&this.reconnect("retry",MS.OFFLINE)})}async request(s,l,p,_){const b=y_(6,""),A={_id:b,_type:s,_message:l},k=this.websocket.connectionID,j=()=>new RE((Fi,Gi)=>{if(this.connectionState===u_.CONNECTED)return Fi();const _o=()=>{this.off(NE.WS_CLOSED,_f),Fi()},_f=()=>{this.off(NE.WS_CONNECTED,_o),Gi(new ga(Di.WS_ABORT))};this.once(NE.WS_CONNECTED,_o),this.once(NE.WS_CLOSED,_f),s!==ME.PUBLISH&&s!==ME.SUBSCRIBE&&s!==ME.UNSUBSCRIBE&&s!==ME.UNPUBLISH&&s!==ME.CONTROL&&s!==ME.RESTART_ICE||this.once(NE.DISCONNECT_P2P,()=>{Gi(new ga(Di.DISCONNECT_P2P))}),s!==ME.PUBLISH&&s!==ME.RESTART_ICE||this.once(NE.ABORT_P2P_EXECUTION,()=>{Gi(new ga(Di.DISCONNECT_P2P))})});if(this.connectionState!==u_.CONNECTING&&this.connectionState!==u_.RECONNECTING||s===ME.JOIN||s===ME.REJOIN||await j(),s===ME.LEAVE&&(this.websocket.unbindDcCloseEventListener(),_=!0),this.websocket.sendMessage(A,!0,!1),_)return;const z=new RE((Fi,Gi)=>{let _o=!1;const _f=(uE,IE)=>{_o=!0,Fi({isSuccess:uE==="success",message:IE||{}}),this.off(NE.WS_CLOSED,vf),this.off(NE.WS_RECONNECTING,vf),this.emit(NE.REQUEST_SUCCESS,s,l)};this.once("res-@".concat(b),_f);const vf=()=>{Gi(new ga(Di.WS_ABORT,"type: ".concat(s))),this.off(NE.WS_CLOSED,vf),this.off(NE.WS_RECONNECTING,vf),this.off("res-@".concat(b),_f)};this.once(NE.WS_CLOSED,vf),this.once(NE.WS_RECONNECTING,vf),aT(_u("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==k||_o||(_n.warning("dc request timeout, type: ".concat(s)),this.emit(NE.REQUEST_TIMEOUT,s,l))})});let H=null;try{H=await z}catch(Fi){if(this.connectionState===u_.CLOSED||s===ME.LEAVE)throw new ga(Di.WS_ABORT);return!this.spec.forceWaitGatewayResponse||p?Fi.throw():s===ME.JOIN||s===ME.REJOIN?null:(await j(),await this.request(s,l))}if(H.isSuccess)return H.message;const $=Number(H.message.error_code||H.message.code),ue=f0($),Ei=new ga(Di.UNEXPECTED_RESPONSE,"".concat(ue.desc,": ").concat(H.message.error_str),{code:$,data:H.message});return ue.action==="success"?H.message:(_n.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(s,", error_code: ").concat($,", message: ").concat(ue.desc,", action: ").concat(ue.action)),$===LE.ERR_TOO_MANY_BROADCASTERS?((s===ME.JOIN||s===ME.REJOIN)&&(this.initError=Ei,this.close()),Ei.throw()):ue.action==="failed"?Ei.throw():ue.action==="quit"?(this.initError=Ei,this.close(),Ei.throw()):($===LE.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=H.message.option,_n.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",MS.MULTI_IP)):this.reconnect(ue.action,MS.SERVER_ERROR),s===ME.JOIN||s===ME.REJOIN?null:await this.request(s,l)))}waitMessage(s,l){return new RE(p=>{const _=b=>{(!l||l(b))&&(this.off(s,_),p(b))};this.on(s,_)})}upload(s,l){const p={_type:s,_message:l};try{this.websocket.sendMessage(p)}catch{const b=_u("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(p),this.uploadCache.length>b&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==u_.CONNECTED)return;const A=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(A._type,A._message)},_u("UPLOAD_CACHE_INTERVAL")||2e3))}}send(s,l){const p={_type:s,_message:l};this.websocket.sendMessage(p)}init(s,l){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new RE((p,_)=>{this.once(NE.WS_CONNECTED,()=>p(this.joinResponse)),this.once(NE.WS_CLOSED,()=>_(this.initError||new ga(Di.WS_ABORT))),this.connectionState=u_.CONNECTING,this.websocket.init(s).catch(_),this.websocket.once(A_.FAILBACK,()=>{this.openConnectionTime===void 0&&_(new ga(Di.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{l&&this.openConnectionTime===void 0&&(_n.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),_(new ga(Di.INIT_DATACHANNEL_TIMEOUT)))},_u("DC_JOIN_WITH_FAILBACK"))})}close(s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=s||i_.LEAVE,this.connectionState=u_.CLOSED,_n.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),s===i_.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new t3("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(NE.ABORT_P2P_EXECUTION);const s=await cT(this,NE.DATACHANNEL_CONNECTING),l=await this.request(ME.JOIN,s);if(!l)return this.emit(NE.REPORT_JOIN_GATEWAY,Di.TIMEOUT,this.url||""),!1;this.joinResponse=l,this.emit(NE.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=u_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ga(Di.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const s=zR(this,NE.REQUEST_REJOIN_INFO);s.token=this.reconnectToken;const l=await this.request(ME.REJOIN,s);return!!l&&(this.connectionState=u_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),l.peers&&l.peers.forEach(p=>{this.emit(qE.ON_USER_ONLINE,{uid:p.uid}),p.audio&&this.emit(qE.ON_ADD_AUDIO_STREAM,{uid:p.uid,uint_id:p.uint_id,audio:!0,ssrcId:p.audio_ssrc}),p.video&&this.emit(qE.ON_ADD_VIDEO_STREAM,{uid:p.uid,uint_id:p.uint_id,video:!0,ssrcId:p.video_ssrc}),p.audio_mute?this.emit(qE.MUTE_AUDIO,{uid:p.uid}):this.emit(qE.UNMUTE_AUDIO,{uid:p.uid}),p.video_mute?this.emit(qE.MUTE_VIDEO,{uid:p.uid}):this.emit(qE.UNMUTE_VIDEO,{uid:p.uid}),p.audio_enable_local?this.emit(qE.ENABLE_LOCAL_AUDIO,{uid:p.uid}):this.emit(qE.DISABLE_LOCAL_AUDIO,{uid:p.uid}),p.video_enable_local?this.emit(qE.ENABLE_LOCAL_VIDEO,{uid:p.uid}):this.emit(qE.DISABLE_LOCAL_VIDEO,{uid:p.uid}),p.audio||p.video||this.emit(qE.ON_REMOVE_STREAM,{uid:p.uid,uint_id:p.uint_id})}),!0)}reconnect(s,l){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(s,l)}handleNotification(s){_n.debug("[".concat(this.clientId,"] receive notification: "),s);const l=f0(s.code);if(l.action!=="success"){if(l.action!=="failed")return l.action==="quit"?(l.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(i_.UID_BANNED),void this.close()):void this.reconnect(l.action,MS.SERVER_ERROR);_n.error("[".concat(this.clientId,"] ignore error: "),l.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const s=_u("PING_PONG_TIME_OUT"),l=Date.now();this.pingpongTimeoutCount>=s&&(_n.warning("PINGPONG Timeout. Last Socket Message: ".concat(l-this.lastMsgTime,"ms")),l-this.lastMsgTime>_u("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",MS.TIMEOUT):this.request(ME.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const p=Date.now()-l;this.rttRolling.add(p),_u("REPORT_STATS")&&this.send(ME.PING_BACK,{pingpongElapse:p})}).catch(p=>{})}handleInflateData(){const{inflateLength:s,deflateLength:l}=this.websocket.getInflateData();s!==0&&l!==0&&this.upload(kT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:l,ws_inflate_length:s})}handleWebsocketEvents(){this.websocket.on(A_.RECONNECT_WAITTING_FINISH,s=>{this.emit(NE.WS_RECONNECT_WAITTING_FINISH,s)}),this.websocket.on(A_.RECONNECT_CREATE_CONNECTION,s=>{this.emit(NE.WS_RECONNECT_CREATE_CONNECTION,s)}),this.websocket.on(A_.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(A_.CLOSED,()=>{this.connectionState=u_.CLOSED}),this.websocket.on(A_.FAILED,()=>{this._disconnectedReason=i_.NETWORK_ERROR,this.connectionState=u_.CLOSED}),this.websocket.on(A_.RECONNECTING,s=>{this._websocketReconnectReason=s,this.joinResponse=void 0,this.connectionState===u_.CONNECTED?this.connectionState=u_.RECONNECTING:this.connectionState=u_.CONNECTING}),this.websocket.on(A_.WILL_RECONNECT,(s,l)=>{if(zR(this,NE.IS_P2P_DISCONNECTED)&&s==="retry")return _n.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(NE.NEED_RENEW_SESSION),this.emit(NE.DISCONNECT_P2P),l("tryNext");s!=="retry"&&(_n.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(s)),this.reconnectToken=void 0,this.emit(NE.NEED_RENEW_SESSION),this.emit(NE.DISCONNECT_P2P)),l(s)}),this.websocket.on(A_.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(s=>{_n.warning("[".concat(this.clientId,"] rejoin failed ").concat(s)),this.reconnect("tryNext",MS.SERVER_ERROR)}):this.join().catch(s=>{if(this.emit(NE.REPORT_JOIN_GATEWAY,s.message||s.code,this.url||""),s instanceof ga&&s.code===Di.UNEXPECTED_RESPONSE&&s.data.code===LE.ERR_NO_AUTHORIZED)return _n.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",MS.SERVER_ERROR);_n.error("[".concat(this.clientId,"] join gateway request failed"),s.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",MS.SERVER_ERROR):(this.initError=s,this.close())})}),this.websocket.on(A_.REQUEST_NEW_URLS,(s,l)=>{cT(this,NE.REQUEST_RECOVER,this.multiIpOption).then(s).catch(l)}),this.websocket.on(A_.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(qE.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(A_.TO_CONNECT_DATACHANNEL,async(s,l,p)=>cT(this,NE.DATACHANNEL_PRECONNECT,s).then(l).catch(p)),this.websocket.on(A_.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(NE.DATACHANNEL_FAILBACK)})}}function e3(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function jS(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?e3(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):e3(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}const cL=new Map;class PX extends R_{get state(){return this._state}set state(s){if(s===this._state)return;const l=this._state;this._state=s,s==="DISCONNECTED"&&this._disconnectedReason?this.emit(S_.CONNECTION_STATE_CHANGE,s,l,this._disconnectedReason):this.emit(S_.CONNECTION_STATE_CHANGE,s,l)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(s){_n.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(s)),this._joinGatewayStartTime=s}constructor(s,l){super(),_t(this,"store",void 0),_t(this,"joinInfo",void 0),_t(this,"key",void 0),_t(this,"signal",void 0),_t(this,"role",void 0),_t(this,"inChannelInfo",{joinAt:null,duration:0}),_t(this,"spec",void 0),_t(this,"_state","DISCONNECTED"),_t(this,"_statsCollector",void 0),_t(this,"_disconnectedReason",void 0),_t(this,"isSignalRecover",!1),_t(this,"hasChangeBGPAddress",!1),_t(this,"trafficStatsInterval",void 0),_t(this,"networkQualityInterval",void 0),_t(this,"_joinGatewayStartTime",0),_t(this,"_signalTimeout",!1),_t(this,"_clientRoleOptions",void 0),_t(this,"_isProactiveJoin",!1),this.store=s,this.spec=l,this.signal=this.store.useDataChannel?new ZS(jS(jS({},l),{},{retryConfig:l.websocketRetryConfig}),s):new XF(jS(jS({},l),{},{retryConfig:l.websocketRetryConfig}),s),this._statsCollector=l.statsCollector,this.role=l.role||"audience",this._clientRoleOptions=l.clientRoleOptions,this.handleSignalEvents()}async join(s,l,p){if(this.signal instanceof ZS){let j=!1;s.cloudProxyServer!=="disabled"?(_n.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(s.cloudProxyServer,")")),j=!0):"".concat(s.apResponse.cid,"_").concat(s.apResponse.cert).length>255||"".concat(s.apResponse.cid,"_").concat(s.apResponse.cert).length<22?(_n.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),j=!0):s.apResponse.addresses.some(z=>z.fingerprint)||_u("FINGERPRINT")||(_n.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),j=!0),j&&this.resetSignal()}this.store.joinGatewayStart(),s.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const _=Date.now();let b=cL.get(s.cname);if(b||(b=new Map,cL.set(s.cname,b)),this._isProactiveJoin=!0,b.has(s.uid)){const j=new ga(Di.UID_CONFLICT);throw wE.joinGateway(s.sid,{lts:_,succ:!1,ec:j.message,addr:null,uid:s.uid,cid:s.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!s.proxyServer,signalChannel:this.signal instanceof ZS?"1":"0"}),this._isProactiveJoin=!1,j}b.set(s.uid,!0),this.joinInfo=s,this.key=l;let A=0;this.joinGatewayStartTime=_;const k=s.proxyServer;try{let j;if(_n.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof ZS?"datachannel":"websocket"," join uid ").concat(A)),this.signal instanceof ZS)j=await this.signal.init(s.apResponse.addresses,p);else{const z=s.proxyServer,H=z?s.gatewayAddrs.map($=>{const ue=$.address.split(":");return"wss://".concat(z,"/ws/?h=").concat(ue[0],"&p=").concat(ue[1])}):s.gatewayAddrs.map($=>"wss://".concat($.address));j=await this.signal.init(H,p)}A=j.uid,_n.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof ZS?"datachannel":"websocket"," join uid ").concat(A," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(j){throw j&&j.code===Di.INIT_WEBSOCKET_TIMEOUT?(_n.warning("[".concat(this.store.clientId,"] User join failed"),j.toString()),j):j&&j.code===Di.INIT_DATACHANNEL_TIMEOUT?(_n.warning("[".concat(this.store.clientId,"] User join datachannel failed"),j.toString()),this.resetSignal(),j):(_n.error("[".concat(this.store.clientId,"] User join failed"),j.toString()),wE.joinGateway(s.sid,{lts:_,succ:!1,ec:j.message,addr:this.signal.url,uid:s.uid,cid:s.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!k,signalChannel:this.signal instanceof ZS?"1":"0"}),this._isProactiveJoin=!1,b.delete(s.uid),this.signal.close(),j)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),_n.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(j=>{_n.warning("[".concat(this.store.clientId,"] get traffic stats error"),j.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(S_.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(S_.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(S_.NETWORK_QUALITY,{uplinkNetworkQuality:FF(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:FF(this._statsCollector.trafficStats.B_dnq)}):this.emit(S_.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),A}async leave(){let s=arguments.length>0&&arguments[0]!==void 0&&arguments[0],l=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){l!==i_.FALLBACK&&(this.state="DISCONNECTING");try{s||this.signal.connectionState!==u_.CONNECTED||await function(p,_){return _===1/0?p:RE.race([p,OX(_)])}(this.signal.request(ME.LEAVE,void 0,!0),3e3)}catch(p){_n.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),p)}this.signal.close(l),l!==i_.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(s,l,p){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ga(Di.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const _={state:"offer",p2p_id:this.store.p2pId,ortc:l,mode:this.spec.mode,extend:_u("PUB_EXTEND"),twcc:!!_u("PUBLISH_TWCC"),rtx:!!_u("USE_PUB_RTX")};try{return(await this.signal.request(ME.PUBLISH,_,!0))._message}catch(b){if(p&&b.data&&b.data.code===LE.ERR_PUBLISH_REQUEST_INVALID)return _n.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),b.toString()),await this.tryUnpubBeforeRepub(s,l),this.publish(s,l,!1);throw b}}async unpublish(s,l){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ga(Di.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ME.UNPUBLISH,{stream_id:l,ortc:s},!0)}catch(p){_n.warning("[".concat(this.store.clientId,"] unpublish warning: "),p)}}async subscribe(s,l,p){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ga(Di.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const _={stream_id:s,stream_type:l.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!_u("SUBSCRIBE_TWCC"),rtx:!!_u("USE_SUB_RTX"),extend:_u("SUB_EXTEND"),ssrcId:l.ssrcId,svc:Array.isArray(_u("SVC"))&&_u("SVC").length!==0?_u("SVC"):void 0};try{return(await this.signal.request(ME.SUBSCRIBE,_,!0))._message}catch(b){if(p&&b.data&&b.data.code===LE.ERR_SUBSCRIBE_REQUEST_INVALID)return _n.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),b.toString()),await this.tryUnsubBeforeResub(s,l),await this.subscribe(s,l,!1);throw b}}async subscribeAll(s,l){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ga(Di.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const p={p2p_id:this.store.p2pId,users:s,dtx:!1,rtx:!!_u("USE_SUB_RTX")};try{return await this.signal.request(ME.SUBSCRIBE_STREAMS,p,!0)}catch(_){if(l&&_.data&&_.data.code===LE.ERR_SUBSCRIBE_REQUEST_INVALID)return _n.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),_.toString()),await this.tryMassUnsubBeforeResub(s),await this.subscribeAll(s,!1);throw _}}async setVideoProfile(s){const l=function(p){if(!(p.bitrateMax&&p.bitrateMin&&p.frameRate&&p.height&&p.width))return;let _=p.frameRate,b=p.width,A=p.height,k=!0;return typeof _!="number"&&(_=_.exact||_.ideal||_.max||_.min||0,_||(k=!1)),typeof b!="number"&&(b=b.exact||b.ideal||b.max||b.min||0,b||(k=!1)),typeof A!="number"&&(A=A.exact||A.ideal||A.max||A.min||0,_||(k=!1)),k?{stream_type:0,width:b,height:A,fps:_,start_bps:1e3*p.bitrateMax,min_bps:1e3*p.bitrateMin,target_bps:1e3*p.bitrateMax}:void 0}(s);if(l)return this.signal.request(ME.SET_VIDEO_PROFILE,l);_n.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(s,l){try{await this.signal.request(ME.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:s,stream_id:l},!0)}catch(p){_n.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),p)}}async massUnsubscribe(s){try{await this.signal.request(ME.UNSUBSCRIBE_STREAMS,s,!0)}catch(l){_n.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),l)}}async reconnectPC(s){const{iceParameters:l,dtlsParameters:p,rtpCapabilities:_}=s;return{gatewayEstablishParams:await this.signal.request(ME.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:l,dtlsParameters:p,rtpCapabilities:_}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ME.GATEWAY_INFO)}async renewToken(s){await this.signal.request(ME.RENEW_TOKEN,s),this.key=s.token}async setClientRole(s,l){if(l&&(this._clientRoleOptions=Object.assign({},l)),this.state!=="CONNECTED")return void(this.role=s);let p;p=s==="audience"?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0,await this.signal.request(ME.SET_CLIENT_ROLE,{role:s,level:p,client_ts:Date.now()}),this.role=s}async setRemoteVideoStreamType(s,l){await this.signal.request(ME.SWITCH_VIDEO_STREAM,{stream_id:s,stream_type:l})}async setDefaultRemoteVideoStreamType(s){await this.signal.request(ME.DEFAULT_VIDEO_STREAM,{stream_type:s})}async setStreamFallbackOption(s,l){await this.signal.request(ME.SET_FALLBACK_OPTION,{stream_id:s,fallback_type:l})}async pickSVCLayer(s,l){await this.signal.request(ME.PICK_SVC_LAYER,{stream_id:s,spatial_layer:l.spatialLayer,temporal_layer:l.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),jS({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(ME.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const s=cL.get(this.joinInfo.cname);s&&s.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const s=function(l){let p;return p=l.startsWith("dc")?l.match(/(dc\:\/\/)?([^:]+):(\d+)/):l.match(/(wss\:\/\/)?([^:]+):(\d+)/),p?{username:FT.username,password:FT.password,turnServerURL:p[2],tcpport:parseInt(p[3])+30,udpport:parseInt(p[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],s&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(jS(jS({},FT),{},{turnServerURL:s.turnServerURL,tcpport:s.tcpport,udpport:s.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const s=await this.signal.request(ME.TRAFFIC_STATS,void 0,!0);s.timestamp=Date.now(),s.peer_delay.forEach(l=>{const p=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(_=>_.peer_uid===l.peer_uid);p&&p.B_st!==l.B_st&&AS(()=>{this.emit(S_.STREAM_TYPE_CHANGE,l.peer_uid,l.B_st)})}),this._statsCollector.updateTrafficStats(s)}getJoinMessage(s){if(!this.joinInfo||!this.key)throw new ga(Di.UNEXPECTED_ERROR,"can not generate join message, no join info");const l=Object.assign({},this.joinInfo.apResponse);let p=_u("REPORT_APP_SCENARIO");if(typeof p!="string")try{p=JSON.stringify(p)}catch{p=void 0}p&&p.length>128&&(p=void 0);const _=jS({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:ZT,browser:navigator.userAgent,process_id:_u("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:l,extend:_u("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:p,attributes:{userAttributes:{enablePublishedUserList:_u("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:_u("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof _u("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?_u("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof _u("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?_u("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof _u("ENABLE_USER_LICENSE_CHECK")=="boolean"?_u("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:_u("USE_PUB_RTX")===!0||_u("USE_SUB_RTX")===!0||void 0}},join_ts:this.joinGatewayStartTime},s);return this.joinInfo.stringUid&&(_.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(_.aes_mode=this.joinInfo.aesmode,_u("ENCRYPT_AES")?(_.aes_secret=this.joinInfo.aespassword,_.aes_encrypt=!0):_.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(_.aes_salt=this.joinInfo.aessalt)),l.addresses[this.signal.websocket.currentURLIndex]&&(_.ap_response.ticket=l.addresses[this.signal.websocket.currentURLIndex].ticket,delete l.addresses),this.joinInfo.defaultVideoStream!==void 0&&(_.default_video_stream=this.joinInfo.defaultVideoStream),_}getRejoinMessage(){if(!this.joinInfo)throw new ga(Di.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(NE.WS_RECONNECT_WAITTING_FINISH,s=>{["tryNext","recover"].includes(s)&&this.joinInfo&&wE.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(NE.WS_RECONNECT_CREATE_CONNECTION,s=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(NE.WS_RECONNECTING,s=>{this.joinInfo&&wE.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s||TT.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",wE.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(NE.WS_CLOSED,s=>{let l;switch(s){case i_.LEAVE:l=TT.LEAVE;break;case i_.UID_BANNED:case i_.IP_BANNED:case i_.CHANNEL_BANNED:case i_.SERVER_ERROR:l=TT.SERVER_ERROR;break;case i_.FALLBACK:l=TT.FALLBACK;break;case i_.LICENSE_MISSING:case i_.LICENSE_EXPIRED:case i_.LICENSE_MINUTES_EXCEEDED:case i_.LICENSE_PERIOD_INVALID:case i_.LICENSE_MULTIPLE_SDK_SERVICE:case i_.LICENSE_ILLEGAL:l=s;break;default:l=TT.NETWORK_ERROR}_n.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(l||"undefined -> "+TT.NETWORK_ERROR)),this.joinInfo&&wE.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:s===i_.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:l}),this._disconnectedReason=s,s!==i_.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(NE.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&this._clientRoleOptions.level&&(_n.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),wE.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof ZS?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const s=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!s)return void _n.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(s));p_("EVENT_REPORT_DOMAIN",s[1]),p_("EVENT_REPORT_BACKUP_DOMAIN",s[1]),p_("LOG_UPLOAD_SERVER","".concat(s[1],":6444"))}}),this.signal.on(qE.ON_UPLINK_STATS,s=>{this._statsCollector.updateUplinkStats(s)}),this.signal.on(NE.REQUEST_RECOVER,(s,l,p)=>{if(!this.joinInfo)return p(new ga(Di.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));s&&(this.joinInfo.multiIP=s,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,cT(this,S_.REQUEST_NEW_GATEWAY_LIST).then(l).catch(p)}),this.signal.on(NE.REQUEST_JOIN_INFO,async s=>{var l;this.updateTurnConfigFromSignal();const{iceParameters:p,dtlsParameters:_,rtpCapabilities:b}=await cT(this,S_.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(l=this.joinInfo)===null||l===void 0?void 0:l.turnServer});s(this.getJoinMessage({ortc:{iceParameters:p,dtlsParameters:_,rtpCapabilities:b,version:"2"}}))}),this.signal.on(NE.REQUEST_REJOIN_INFO,s=>{s(this.getRejoinMessage())}),this.signal.on(NE.REPORT_JOIN_GATEWAY,(s,l)=>{this.joinInfo&&(wE.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:s,addr:l,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof ZS?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(NE.IS_P2P_DISCONNECTED,s=>{s(zR(this,S_.IS_P2P_DISCONNECTED))}),this.signal.on(NE.DISCONNECT_P2P,()=>{this.emit(S_.DISCONNECT_P2P)}),this.signal.on(NE.NEED_RENEW_SESSION,()=>{this.emit(S_.NEED_RENEW_SESSION)}),this.signal.on(NE.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(NE.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(NE.JOIN_RESPONSE,s=>{const l=this.getCurrentGatewayAddress();this.emit(S_.JOIN_RESPONSE,s,l)}),this.signal.on(NE.DATACHANNEL_PRECONNECT,async(s,l,p)=>{this.updateTurnConfigFromSignal();const _=this.getCurrentGatewayAddress();return cT(this,S_.DATACHANNEL_PRECONNECT,s,_).then(l).catch(p)}),this.signal.on(NE.DATACHANNEL_CONNECTING,async s=>{const{iceParameters:l,dtlsParameters:p,rtpCapabilities:_}=await cT(this,S_.REQUEST_DC_CONNECTION_PARAMS);s(this.getJoinMessage({ortc:{iceParameters:l,dtlsParameters:p,rtpCapabilities:_,version:"2"}}))}),this.signal.on(NE.DATACHANNEL_FAILBACK,()=>{_n.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(S_.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(s,l){try{await this.signal.request(ME.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:s,ortc:[l]},!0)}catch(p){throw _n.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),p),p}}async tryUnpubBeforeRepub(s,l){try{await this.signal.request(ME.UNPUBLISH,{stream_id:s,ortc:l},!0)}catch(p){throw _n.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),p),p}}async tryMassUnsubBeforeResub(s){const l={users:s.map(p=>({stream_id:p.stream_id,stream_type:p.stream_type}))};try{await this.signal.request(ME.UNSUBSCRIBE_STREAMS,l,!0)}catch(p){throw _n.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),p),p}}async muteLocal(s,l){const p={action:s.find(_=>_.stream_type===Y_.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:s,stream_id:l};try{await this.signal.request(ME.CONTROL,p,!0,!0)}catch(_){throw _n.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),_),_}}async unmuteLocal(s,l){const p={action:s.find(_=>_.stream_type===Y_.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:s,stream_id:l};try{await this.signal.request(ME.CONTROL,p,!0,!0)}catch(_){throw _n.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),_),_}}uploadStats(s,l){this.signal.upload(s,l)}getSignalRTT(){return this.signal.rtt}async restartICE(s){const l={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:s};try{return await this.signal.request(ME.RESTART_ICE,l,!0)}catch(p){throw _n.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),p),p}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,TT.P2P_FAILED)}getCurrentGatewayAddress(){var s;if(!_u("GATEWAY_WSS_ADDRESS"))return(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(s){await this.signal.request(ME.SET_PARAMETER,{enablePublishAudioFilter:s})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(i_.FALLBACK)),this.store.useDataChannel=!1,this.signal=new XF(jS(jS({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(S_.RESET_SIGNAL,NO.websocket)}}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var o;function s(nE){var dE=0;return function(){return dE<nE.length?{done:!1,value:nE[dE++]}:{done:!0}}}var l=typeof Object.defineProperties=="function"?Object.defineProperty:function(nE,dE,vE){return nE==Array.prototype||nE==Object.prototype||(nE[dE]=vE.value),nE},p,_=function(nE){nE=[typeof globalThis=="object"&&globalThis,nE,typeof window=="object"&&window,typeof self=="object"&&self,typeof h=="object"&&h];for(var dE=0;dE<nE.length;++dE){var vE=nE[dE];if(vE&&vE.Math==Math)return vE}throw Error("Cannot find global object")}(this);function b(nE,dE){if(dE)t:{var vE=_;nE=nE.split(".");for(var xE=0;xE<nE.length-1;xE++){var ZE=nE[xE];if(!(ZE in vE))break t;vE=vE[ZE]}(dE=dE(xE=vE[nE=nE[nE.length-1]]))!=xE&&dE!=null&&l(vE,nE,{configurable:!0,writable:!0,value:dE})}}function A(nE){return(nE={next:nE})[Symbol.iterator]=function(){return this},nE}function k(nE){var dE=typeof Symbol<"u"&&Symbol.iterator&&nE[Symbol.iterator];return dE?dE.call(nE):{next:s(nE)}}if(b("Symbol",function(nE){function dE(ZE,fE){this.A=ZE,l(this,"description",{configurable:!0,writable:!0,value:fE})}if(nE)return nE;dE.prototype.toString=function(){return this.A};var vE="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",xE=0;return function ZE(fE){if(this instanceof ZE)throw new TypeError("Symbol is not a constructor");return new dE(vE+(fE||"")+"_"+xE++,fE)}}),b("Symbol.iterator",function(nE){if(nE)return nE;nE=Symbol("Symbol.iterator");for(var dE="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),vE=0;vE<dE.length;vE++){var xE=_[dE[vE]];typeof xE=="function"&&typeof xE.prototype[nE]!="function"&&l(xE.prototype,nE,{configurable:!0,writable:!0,value:function(){return A(s(this))}})}return nE}),typeof Object.setPrototypeOf=="function")p=Object.setPrototypeOf;else{var j;t:{var z={};try{z.__proto__={a:!0},j=z.a;break t}catch{}j=!1}p=j?function(nE,dE){if(nE.__proto__=dE,nE.__proto__!==dE)throw new TypeError(nE+" is not extensible");return nE}:null}var H=p;function $(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function ue(nE){if(nE.m)throw new TypeError("Generator is already running");nE.m=!0}function Ei(nE,dE){return nE.h=3,{value:dE}}function Fi(nE){this.g=new $,this.G=nE}function Gi(nE,dE,vE,xE){try{var ZE=dE.call(nE.g.j,vE);if(!(ZE instanceof Object))throw new TypeError("Iterator result "+ZE+" is not an object");if(!ZE.done)return nE.g.m=!1,ZE;var fE=ZE.value}catch(Wt){return nE.g.j=null,nE.g.s(Wt),_o(nE)}return nE.g.j=null,xE.call(nE.g,fE),_o(nE)}function _o(nE){for(;nE.g.h;)try{var dE=nE.G(nE.g);if(dE)return nE.g.m=!1,{value:dE.value,done:!1}}catch(vE){nE.g.v=void 0,nE.g.s(vE)}if(nE.g.m=!1,nE.g.l){if(dE=nE.g.l,nE.g.l=null,dE.F)throw dE.D;return{value:dE.return,done:!0}}return{value:void 0,done:!0}}function _f(nE){this.next=function(dE){return nE.o(dE)},this.throw=function(dE){return nE.s(dE)},this.return=function(dE){return function(vE,xE){ue(vE.g);var ZE=vE.g.j;return ZE?Gi(vE,"return"in ZE?ZE.return:function(fE){return{value:fE,done:!0}},xE,vE.g.return):(vE.g.return(xE),_o(vE))}(nE,dE)},this[Symbol.iterator]=function(){return this}}function vf(nE,dE){return dE=new _f(new Fi(dE)),H&&nE.prototype&&H(dE,nE.prototype),dE}if($.prototype.o=function(nE){this.v=nE},$.prototype.s=function(nE){this.l={D:nE,F:!0},this.h=this.C||this.u},$.prototype.return=function(nE){this.l={return:nE},this.h=this.u},Fi.prototype.o=function(nE){return ue(this.g),this.g.j?Gi(this,this.g.j.next,nE,this.g.o):(this.g.o(nE),_o(this))},Fi.prototype.s=function(nE){return ue(this.g),this.g.j?Gi(this,this.g.j.throw,nE,this.g.o):(this.g.s(nE),_o(this))},b("Array.prototype.entries",function(nE){return nE||function(){return function(dE,vE){dE instanceof String&&(dE+="");var xE=0,ZE=!1,fE={next:function(){if(!ZE&&xE<dE.length){var Wt=xE++;return{value:vE(Wt,dE[Wt]),done:!1}}return ZE=!0,{done:!0,value:void 0}}};return fE[Symbol.iterator]=function(){return fE},fE}(this,function(dE,vE){return[dE,vE]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var uE=function(nE,dE){for(var vE=0;vE<nE.length;vE++)dE(nE[vE])},IE=function(nE){return nE.replace(/\r?\n|\r/g,`\r
`)},lE=function(nE,dE,vE){return dE instanceof Blob?(vE=vE!==void 0?vE+"":typeof dE.name=="string"?dE.name:"blob",dE.name===vE&&Object.prototype.toString.call(dE)!=="[object Blob]"||(dE=new File([dE],vE)),[String(nE),dE]):[String(nE),String(dE)]},hE=function(nE,dE){if(nE.length<dE)throw new TypeError(dE+" argument required, but only "+nE.length+" present.")},sE=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,mE=sE.FormData,n_=sE.XMLHttpRequest&&sE.XMLHttpRequest.prototype.send,DE=sE.Request&&sE.fetch,__=sE.navigator&&sE.navigator.sendBeacon,d_=sE.Element&&sE.Element.prototype,U_=sE.Symbol&&Symbol.toStringTag;U_&&(Blob.prototype[U_]||(Blob.prototype[U_]="Blob"),"File"in sE&&!File.prototype[U_]&&(File.prototype[U_]="File"));try{new File([],"")}catch{sE.File=function(dE,vE,xE){return dE=new Blob(dE,xE||{}),Object.defineProperties(dE,{name:{value:vE},lastModified:{value:+(xE&&xE.lastModified!==void 0?new Date(xE.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),U_&&Object.defineProperty(dE,U_,{value:"File"}),dE}}var _b=function(nE){return nE.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},k_=function(nE){this.i=[];var dE=this;nE&&uE(nE.elements,function(vE){if(vE.name&&!vE.disabled&&vE.type!=="submit"&&vE.type!=="button"&&!vE.matches("form fieldset[disabled] *"))if(vE.type==="file"){var xE=vE.files&&vE.files.length?vE.files:[new File([],"",{type:"application/octet-stream"})];uE(xE,function(ZE){dE.append(vE.name,ZE)})}else vE.type==="select-multiple"||vE.type==="select-one"?uE(vE.options,function(ZE){!ZE.disabled&&ZE.selected&&dE.append(vE.name,ZE.value)}):vE.type==="checkbox"||vE.type==="radio"?vE.checked&&dE.append(vE.name,vE.value):(xE=vE.type==="textarea"?IE(vE.value):vE.value,dE.append(vE.name,xE))})};if((o=k_.prototype).append=function(nE,dE,vE){hE(arguments,2),this.i.push(lE(nE,dE,vE))},o.delete=function(nE){hE(arguments,1);var dE=[];nE=String(nE),uE(this.i,function(vE){vE[0]!==nE&&dE.push(vE)}),this.i=dE},o.entries=function nE(){var dE,vE=this;return vf(nE,function(xE){if(xE.h==1&&(dE=0),xE.h!=3)return dE<vE.i.length?xE=Ei(xE,vE.i[dE]):(xE.h=0,xE=void 0),xE;dE++,xE.h=2})},o.forEach=function(nE,dE){hE(arguments,1);for(var vE=k(this),xE=vE.next();!xE.done;xE=vE.next()){var ZE=k(xE.value);xE=ZE.next().value,ZE=ZE.next().value,nE.call(dE,ZE,xE,this)}},o.get=function(nE){hE(arguments,1);var dE=this.i;nE=String(nE);for(var vE=0;vE<dE.length;vE++)if(dE[vE][0]===nE)return dE[vE][1];return null},o.getAll=function(nE){hE(arguments,1);var dE=[];return nE=String(nE),uE(this.i,function(vE){vE[0]===nE&&dE.push(vE[1])}),dE},o.has=function(nE){hE(arguments,1),nE=String(nE);for(var dE=0;dE<this.i.length;dE++)if(this.i[dE][0]===nE)return!0;return!1},o.keys=function nE(){var dE,vE,xE,ZE,fE=this;return vf(nE,function(Wt){if(Wt.h==1&&(dE=k(fE),vE=dE.next()),Wt.h!=3)return vE.done?void(Wt.h=0):(xE=vE.value,ZE=k(xE),Ei(Wt,ZE.next().value));vE=dE.next(),Wt.h=2})},o.set=function(nE,dE,vE){hE(arguments,2),nE=String(nE);var xE=[],ZE=lE(nE,dE,vE),fE=!0;uE(this.i,function(Wt){Wt[0]===nE?fE&&(fE=!xE.push(ZE)):xE.push(Wt)}),fE&&xE.push(ZE),this.i=xE},o.values=function nE(){var dE,vE,xE,ZE,fE=this;return vf(nE,function(Wt){if(Wt.h==1&&(dE=k(fE),vE=dE.next()),Wt.h!=3)return vE.done?void(Wt.h=0):(xE=vE.value,(ZE=k(xE)).next(),Ei(Wt,ZE.next().value));vE=dE.next(),Wt.h=2})},k_.prototype._asNative=function(){for(var nE=new mE,dE=k(this),vE=dE.next();!vE.done;vE=dE.next()){var xE=k(vE.value);vE=xE.next().value,xE=xE.next().value,nE.append(vE,xE)}return nE},k_.prototype._blob=function(){var nE="----formdata-polyfill-"+Math.random(),dE=[],vE="--"+nE+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(xE,ZE){return typeof xE=="string"?dE.push(vE+_b(IE(ZE))+`"\r
\r
`+IE(xE)+`\r
`):dE.push(vE+_b(IE(ZE))+'"; filename="'+_b(xE.name)+`"\r
Content-Type: `+(xE.type||"application/octet-stream")+`\r
\r
`,xE,`\r
`)}),dE.push("--"+nE+"--"),new Blob(dE,{type:"multipart/form-data; boundary="+nE})},k_.prototype[Symbol.iterator]=function(){return this.entries()},k_.prototype.toString=function(){return"[object FormData]"},d_&&!d_.matches&&(d_.matches=d_.matchesSelector||d_.mozMatchesSelector||d_.msMatchesSelector||d_.oMatchesSelector||d_.webkitMatchesSelector||function(nE){for(var dE=(nE=(this.document||this.ownerDocument).querySelectorAll(nE)).length;0<=--dE&&nE.item(dE)!==this;);return-1<dE}),U_&&(k_.prototype[U_]="FormData"),n_){var NT=sE.XMLHttpRequest.prototype.setRequestHeader;sE.XMLHttpRequest.prototype.setRequestHeader=function(nE,dE){NT.call(this,nE,dE),nE.toLowerCase()==="content-type"&&(this.B=!0)},sE.XMLHttpRequest.prototype.send=function(nE){nE instanceof k_?(nE=nE._blob(),this.B||this.setRequestHeader("Content-Type",nE.type),n_.call(this,nE)):n_.call(this,nE)}}DE&&(sE.fetch=function(nE,dE){return dE&&dE.body&&dE.body instanceof k_&&(dE.body=dE.body._blob()),DE.call(this,nE,dE)}),__&&(sE.navigator.sendBeacon=function(nE,dE){return dE instanceof k_&&(dE=dE._asNative()),__.call(this,nE,dE)}),sE.FormData=k_}})();const KO=()=>{const o=_u("AREAS");return o.length===0&&o.push(XE.GLOBAL),aR(o).call(o,(s,l,p)=>{const _=n3(l);return _?p===0?_:"".concat(s,",").concat(_):s},"")},n3=o=>o===XE.OVERSEA?"".concat(_g.ASIA,",").concat(_g.EUROPE,",").concat(_g.AFRICA,",").concat(_g.NORTH_AMERICA,",").concat(_g.SOUTH_AMERICA,",").concat(_g.OCEANIA):_g[o],DX=o=>{const s={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return o.map(l=>{const p=PO[l],_=Object.keys(p);_&&_.map(b=>{b!=="CODE"&&(s[b]=s[b].concat(p[b]))})}),s},HO={GLOBAL:{ASIA:[XE.CHINA,XE.JAPAN,XE.INDIA,XE.KOREA,XE.HKMC],EUROPE:[],NORTH_AMERICA:[XE.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},uL=Object.keys(HO[XE.GLOBAL]),r3=[XE.CHINA,XE.NORTH_AMERICA,XE.EUROPE,XE.ASIA,XE.JAPAN,XE.INDIA,XE.OCEANIA,XE.SOUTH_AMERICA,XE.AFRICA,XE.KOREA,XE.HKMC,XE.US],kX=function(o,s){let l=[];if(o.includes(XE.GLOBAL)){const b=[XE.GLOBAL,XE.OVERSEA],A=Object.keys(PO);if(s===XE.GLOBAL)throw new ga(Di.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(s===XE.CHINA)l=[XE.OVERSEA];else if(_=s,uL.includes(_)){const k=(p=s,HO[XE.GLOBAL][p]||[]),j=[...b,s,...k];l=A.filter(z=>!j.includes(z))}else if(function(k){let j=!1;return uL.forEach(z=>{HO[XE.GLOBAL][z].includes(k)&&(j=!0)}),j}(s)){const k=function(z){let H;return uL.forEach($=>{HO[XE.GLOBAL][$].includes(z)&&(H=$)}),H}(s),j=[...b,k,s];l=A.filter(z=>!j.includes(z))}else l=o;l=function(k){const j=[];return r3.forEach(z=>{k.includes(z)&&j.push(z)}),j.concat(k.filter(z=>!r3.includes(z)))}(l)}else l=o;var p,_;return l};function i3(o){if(!o&&_u("AREAS").includes(XE.EXTENSIONS))return _n.debug("update area from ap : reset"),void dL(q2,!0);if(!_u("AREAS").includes(XE.GLOBAL)||!o)return;let s=PO.EXTENSIONS;s&&(s={CODE:n3(XE.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(o,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(o,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(o,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(o,".agora.io"),"cds-ap-web-2-".concat(o,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(o,".agora.io"),"sua-ap-web-2-".concat(o,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(o,".agora.io"),"uap-ap-web-2-".concat(o,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(o,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(o,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(o,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(o,".agora.io")]},_n.debug("update area from ap success: ".concat(o,",config is "),s),p_("AREAS",[XE.EXTENSIONS],!0),Object.keys(s).map(l=>{l==="LOG_UPLOAD_SERVER"||l==="EVENT_REPORT_DOMAIN"||l==="EVENT_REPORT_BACKUP_DOMAIN"||l==="PROXY_SERVER_TYPE3"?p_(l,s[l][0]):p_(l,s[l])}))}function dL(o){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const l=wE.reportApiInvoke(null,{name:j_.SET_AREA,options:o,tag:T_.TRACER});try{let p=[];if(typeof o=="string"&&(p=[o]),Array.isArray(o)&&(o.forEach(b=>{if(!s9.includes(b))throw new ga(Di.INVALID_PARAMS,"invalid area code")}),p=o),Object.prototype.toString.call(o)==="[object Object]"){const{areaCode:b,excludedArea:A}=o;if(!b)throw new ga(Di.INVALID_PARAMS,"area code is needed");let k=b;typeof b=="string"&&(k=[b]),p=A?kX(k,A):k}if(!s){if(FR.AREAS){const b=new ga(Di.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return l.onError(b),void _n.warning("setArea is prohibited because of config-distribute")}if(p.includes(XE.GLOBAL)&&_u("AREAS")===XE.EXTENSIONS){const b=new ga(Di.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return l.onError(b),void _n.warning("setArea is prohibited because of ap extensions")}}p_("AREAS",p,s);const _=DX(p);Object.keys(_).map(b=>{b==="LOG_UPLOAD_SERVER"||b==="EVENT_REPORT_DOMAIN"||b==="EVENT_REPORT_BACKUP_DOMAIN"||b==="PROXY_SERVER_TYPE3"?p_(b,_[b][0]):p_(b,_[b])}),_n.debug("set area success:",p.join(","))}catch(p){throw l.onError(p),p}l.onSuccess()}function o3(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function s3(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?o3(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):o3(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}let lL=1;function LX(o,s,l,p,_){lL+=1;const b={sid:l.sid,command:"convergeAllocateEdge",uid:"666",appId:l.appId,ts:Math.floor(Date.now()/1e3),seq:lL,requestId:lL,version:ZT,cname:l.cname},A={service_name:s,json_body:JSON.stringify(b)};let k,j,z=o[0];return SS(async()=>{k=Date.now();const H=await hS(z,{data:A,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(j=Date.now()-k,H.code!==0){const Ei=new ga(Di.UNEXPECTED_RESPONSE,"live streaming ap error, code"+H.code,{retry:!0,responseTime:j});throw _n.error(Ei.toString()),Ei}const $=JSON.parse(H.json_body);if($.code!==200){const Ei=new ga(Di.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat($.code,", reason: ").concat($.reason),{code:$.code,responseTime:j});throw _n.error(Ei.toString()),Ei}if(!$.servers||$.servers.length===0){const Ei=new ga(Di.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:$.code,responseTime:j});throw _n.error(Ei.toString()),Ei}const ue=function(Ei,Fi){return{addressList:Ei.servers.map(Gi=>"wss://".concat(Gi.address.replace(/\./g,"-"),".").concat(_u("WORKER_DOMAIN"),":").concat(Gi.wss,"?serviceName=").concat(encodeURIComponent(Fi))),workerToken:Ei.workerToken,vid:Ei.vid}}($,s);return _u("LIVE_STREAMING_ADDRESS")&&(ue.addressList=_u("LIVE_STREAMING_ADDRESS")instanceof Array?_u("LIVE_STREAMING_ADDRESS"):[_u("LIVE_STREAMING_ADDRESS")]),s3(s3({},ue),{},{responseTime:j})},(H,$)=>(wE.apworkerEvent(l.sid,{success:!0,sc:200,serviceName:s,responseDetail:JSON.stringify(H.addressList),firstSuccess:$===0,responseTime:j,serverIp:o[$%o.length]}),!1),(H,$)=>(wE.apworkerEvent(l.sid,{success:!1,sc:H.data&&H.data.code||200,serviceName:s,responseTime:j,serverIp:o[$%o.length]}),!!(H.code!==Di.OPERATION_ABORTED&&H.code!==Di.UNEXPECTED_RESPONSE||H.data&&H.data.retry)&&(z=o[($+1)%o.length],!0)),_)}let hL=1;function a3(o,s,l,p){let{url:_,areaCode:b}=o;const A=Date.now();let k;const[j,z]=l3(s,b,[$_.CHOOSE_SERVER]);let H=F_.networkState;return SS(async()=>{H&&F_.networkState===dT.OFFLINE&&F_.onlineWaiter&&await RE.race([F_.onlineWaiter,aT(p&&p.maxRetryTimeout||x_.maxRetryTimeout)]),H=F_.networkState;const{data:$,headers:ue}=await hS(_,{data:j,cancelToken:l,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);k=ue.http3==="1"?1:-1,wE.reportResourceTiming(_,s.sid),u3($,_,s,A,[$_.CHOOSE_SERVER],k);const Ei=iL($,$_.CHOOSE_SERVER);return d3(Ei),jF(Ei,_)},$=>($&&wE.joinChooseServer(s.sid,{lts:A,succ:!0,csAddr:_,opid:z,serverList:$.gatewayAddrs.map(ue=>ue.address),ec:null,cid:$.cid.toString(),uid:$.uid.toString(),csIp:$.csIp,unilbsServerIds:[$_.CHOOSE_SERVER].toString(),isHttp3:k}),!1),$=>$.code!==Di.OPERATION_ABORTED&&($.code===Di.CAN_NOT_GET_GATEWAY_SERVER?$.data.retry:(wE.joinChooseServer(s.sid,{lts:A,succ:!1,csAddr:_,serverList:null,opid:z,ec:$.code,csIp:$.data&&$.data.csIp,unilbsServerIds:[$_.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:H}),isHttp3:k}),_n.warning("[".concat(s.clientId,"] Choose server network error, retry"),$),!0)),p)}function c3(o,s,l,p){let _,{url:b,areaCode:A,serviceIds:k}=o;const j=Date.now(),[z,H]=l3(s,A,k);let $;return SS(async()=>{$&&F_.networkState===dT.OFFLINE&&F_.onlineWaiter&&await RE.race([F_.onlineWaiter,aT(p&&p.maxRetryTimeout||x_.maxRetryTimeout)]),$=F_.networkState;const{data:ue,headers:Ei}=await hS(b,{data:z,cancelToken:l,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=Ei.http3==="1"?1:-1,wE.reportResourceTiming(b,s.sid),u3(ue,b,s,j,k,_);const Fi=iL(ue,$_.CHOOSE_SERVER),Gi=iL(ue,s.cloudProxyServer==="proxy5"?$_.CLOUD_PROXY_5:s.cloudProxyServer==="proxy3"||s.cloudProxyServer==="proxy4"?$_.CLOUD_PROXY:$_.CLOUD_PROXY_FALLBACK);return d3(Fi),{gatewayInfo:jF(Fi,b),proxyInfo:Gi,url:b}},ue=>(ue.gatewayInfo&&wE.joinChooseServer(s.sid,{lts:j,succ:!0,csAddr:b,serverList:ue.gatewayInfo.gatewayAddrs.map(Ei=>Ei.address),ec:null,opid:H,cid:ue.gatewayInfo.cid.toString(),uid:ue.gatewayInfo.uid.toString(),csIp:ue.gatewayInfo.csIp,unilbsServerIds:k.toString(),isHttp3:_}),ue.proxyInfo&&wE.joinWebProxyAP(s.sid,{lts:j,sucess:1,apServerAddr:b,turnServerAddrList:ue.proxyInfo.addresses.map(Ei=>Ei.ip).join(","),errorCode:null,eventType:s.cloudProxyServer,unilbsServerIds:k.toString()}),!1),ue=>ue.code!==Di.OPERATION_ABORTED&&(ue.code===Di.CAN_NOT_GET_GATEWAY_SERVER?ue.data.retry:(wE.joinWebProxyAP(s.sid,{lts:j,sucess:0,apServerAddr:b,turnServerAddrList:null,errorCode:ue.code,eventType:s.cloudProxyServer,unilbsServerIds:k.toString(),extend:JSON.stringify({networkState:$})}),_n.warning("[".concat(s.clientId,"] multi unilbs network error, retry"),ue),!0)),p)}const u3=(o,s,l,p,_,b)=>{const A=[],k=j=>{j.flag===4096?wE.joinChooseServer(l.sid,{lts:p,succ:!1,csAddr:s,opid:o.opid,serverList:null,ec:j.error.message,csIp:j.error.data&&j.error.data.csIp,unilbsServerIds:_.toString(),isHttp3:b}):j.flag!==1048576&&j.flag!==4194304&&j.flag!==4194310||wE.joinWebProxyAP(l.sid,{lts:p,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:j.error.code,eventType:l.cloudProxyServer,unilbsServerIds:_.toString()})};if(o.response_body.forEach(j=>{const z=j.buffer.code;if(j.uri===23&&z===0&&!j.buffer.edges_services)if(j.buffer.flag===4194310)_n.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),j.buffer.edges_services=[];else{const H={error:new ga(Di.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:o.detail[502]}),flag:j.buffer.flag};A.push(H),k(H)}if(z!==0){const H=WO(z),$={error:new ga(Di.CAN_NOT_GET_GATEWAY_SERVER,H.desc,{desc:H.desc,retry:H.retry,csIp:o.detail[502]}),flag:j.buffer.flag};j.buffer.flag===4194310?_n.warning($.error.toString()):A.push($),k($)}}),A.length)throw _n.warning("[".concat(l.clientId,"] multi unilbs ").concat(s," failed, ").concat(A.map(j=>"flag: ".concat(j.flag,", message: ").concat(j.error.message,", retry: ").concat(j.error.data.retry)).join(" | "))),new ga(Di.CAN_NOT_GET_GATEWAY_SERVER,A.map(j=>"flag: ".concat(j.flag,", message: ").concat(j.error.message)).join(" | "),{retry:!!A.find(j=>j.error.data.retry),csIp:o.detail[502],desc:[...new Set(A.map(j=>{var z,H;return j==null||(z=j.error)===null||z===void 0||(H=z.data)===null||H===void 0?void 0:H.desc}).filter(j=>!!j))]})},d3=o=>{var s,l,p,_;if(o.addresses&&o.addresses.length===0&&o.code===0)throw new ga(Di.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:o.detail&&o.detail[502]});if(_u("AP_AREA")&&((p=o.detail)!==null&&p!==void 0&&p[23]&&typeof((_=o.detail)===null||_===void 0?void 0:_[23])=="string"?i3(o.detail[23].toLowerCase()):i3()),(s=o.detail)!==null&&s!==void 0&&s[19]&&typeof((l=o.detail)===null||l===void 0?void 0:l[19])=="string"){const A=o.detail[19],k=A==null?void 0:A.split(";");for(let j=0;j<k.length;j++){var b;const z=HS(b=k[j]).call(b);o.addresses[j]&&k&&(o.addresses[j].fingerprint=z)}}if(_u("GATEWAY_ADDRESS")&&_u("GATEWAY_ADDRESS").length>0){_n.debug("assign gateway address to",_u("GATEWAY_ADDRESS"));const A=_u("GATEWAY_ADDRESS").map(k=>{var j,z;const H=(j=(z=o.addresses.find($=>$.ip===k.ip&&$.port===k.port))===null||z===void 0?void 0:z.fingerprint)!==null&&j!==void 0?j:"";return{ip:k.ip,port:k.port,ticket:o.addresses[0]&&o.addresses[0].ticket,fingerprint:H}});o.addresses=A}},MX=(o,s)=>{if(o.response_body&&o.response_body.length){const l=o.response_body[0];if(l.buffer.code!==0){const p=WO(l.buffer.code);throw new ga(Di.UPDATE_TICKET_FAILED,"[".concat(l.buffer.code,"]: ").concat(p.desc),{retry:p.retry})}return l.buffer.ticket}throw _n.debug("update ticket request received ap response without response body:",s),new ga(Di.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},l3=(o,s,l)=>{const p=Math.floor(Math.random()*1e12),_={appid:o.appId,client_ts:Date.now(),opid:p,sid:o.sid,request_bodies:[{uri:22,buffer:{cname:o.cname,detail:{6:o.stringUid,11:s,12:_u("USE_NEW_TOKEN")?"1":void 0,22:s},key:o.token,service_ids:l,uid:o.uid||0}}]};_.request_bodies.forEach(A=>{o.multiIP&&o.multiIP.gateway_ip&&(A.buffer.detail[5]=JSON.stringify({vocs_ip:[o.multiIP.uni_lbs_ip],vos_ip:[o.multiIP.gateway_ip]}))});const b=new FormData;return b.append("request",JSON.stringify(_)),[b,p]},UX=(o,s)=>{const l=Math.floor(Math.random()*1e12),p={appid:o.appId,client_ts:Date.now(),opid:l,sid:o.sid,request_bodies:[{uri:28,buffer:{cname:o.cname,detail:{1:"",6:o.stringUid,12:"1"},token:o.token,service_ids:s,uid:o.uid||0,edges_services:o.apResponse.addresses.map(b=>({ip:b.ip,port:b.port}))}}]},_=new FormData;return _.append("request",JSON.stringify(p)),[_,l]};let LI=0;async function pL(o,s,l,p){return{gatewayInfo:await async function(b,A,k,j){let z=null;const H=[],$=async()=>{const Ei=_u("WEBCS_DOMAIN").slice(0,_u("AJAX_REQUEST_CONCURRENT")).map(_o=>({url:b.proxyServer?"https://".concat(b.proxyServer,"/ap/?url=").concat(_o+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_o,"/api/v2/transpond/webrtc?v=2"),areaCode:KO()})),Fi=j.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:Ei.map(_o=>_o.url)}),Gi=await p0({fragementLength:_u("FRAGEMENT_LENGTH"),referenceList:Ei,asyncMapHandler:_o=>(_n.debug("[".concat(b.clientId,"] Connect to choose_server:"),_o.url),a3(_o,b,A,k)),allFailedhandler:_o=>{throw j.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_o},Fi),_o[0]},promisesCollector:H});return j.recordJoinChannelService({endTs:Date.now(),status:"success"},Fi),Gi},ue=async()=>{if(await aT(1e3),z!==null)return z;const Ei=_u("WEBCS_DOMAIN_BACKUP_LIST").map(_o=>({url:b.proxyServer?"https://".concat(b.proxyServer,"/ap/?url=").concat(_o+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_o,"/api/v2/transpond/webrtc?v=2"),areaCode:KO()})),Fi=j.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:Ei.map(_o=>_o.url)}),Gi=await p0({fragementLength:_u("FRAGEMENT_LENGTH"),referenceList:Ei,asyncMapHandler:_o=>(_n.debug("[".concat(b.clientId,"] Connect to backup choose_server:"),_o.url),a3(_o,b,A,k)),allFailedhandler:_o=>{throw j.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_o},Fi),_o[0]},promisesCollector:H});return j.recordJoinChannelService({endTs:Date.now(),status:"success"},Fi),Gi};try{return z=await kI([$(),ue()]),H.length&&H.forEach(Ei=>Ei.cancel&&typeof Ei.cancel=="function"&&Ei.cancel()),z}catch(Ei){throw Ei[0]}}(o,s,l,p)}}async function h3(o,s,l,p,_){const b=o.cloudProxyServer;if(b==="disabled"){if(!p)return;if(o.useLocalAccessPoint)return await pL(o,s,l,_);if(_u("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:z,proxyInfo:H}=await f3(o,s,l,_);return o.turnServer&&o.turnServer.mode!=="auto"||(o.turnServer={mode:"manual",servers:H.map($=>({turnServerURL:$.address,tcpport:$.tcpport||FT.tcpport,udpport:$.udpport||FT.udpport,username:$.username||FT.username,password:$.password||FT.password,forceturn:!1,security:!0}))}),{gatewayInfo:z}}return await pL(o,s,l,_)}const{proxyInfo:A,gatewayInfo:k}=await f3(o,s,l,_),j={gatewayInfo:k};return o.turnServer={mode:"manual",servers:A.map(z=>({turnServerURL:z.address,tcpport:b==="proxy3"?void 0:z.tcpport?z.tcpport:FT.tcpport,udpport:b==="proxy4"?void 0:z.udpport?z.udpport:FT.udpport,username:z.username||FT.username,password:z.password||FT.password,forceturn:b!=="proxy4",security:b==="proxy5"}))},_n.debug("[".concat(o.clientId,"] set proxy server: ").concat(o.proxyServer,", mode: ").concat(b)),j}async function p3(o,s,l,p,_){const b=_u("ACCOUNT_REGISTER").slice(0,_u("AJAX_REQUEST_CONCURRENT"));let A=[];A=s.proxyServer?b.map(j=>"https://".concat(s.proxyServer,"/ap/?url=").concat(j+"/api/v1")):b.map(j=>"https://".concat(j,"/api/v1"));const k=_==null?void 0:_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:A});try{const j=await async function(z,H,$,ue,Ei){const Fi=Date.now(),Gi={sid:$.sid,opid:10,appid:$.appId,string_uid:H};let _o=z[0];const _f=await SS(()=>hS(_o+"".concat(_o.indexOf("?")===-1?"?":"&","action=stringuid"),{data:Gi,cancelToken:ue,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(vf,uE)=>{if(vf.code===0){if(vf.uid<=0||vf.uid>=Math.pow(2,32))throw _n.error("Invalid Uint Uid ".concat(H," => ").concat(vf.uid),vf),wE.reqUserAccount(Gi.sid,{lts:Fi,success:!1,serverAddr:_o,stringUid:Gi.string_uid,uid:vf.uid,errorCode:Di.INVALID_UINT_UID_FROM_STRING_UID,extend:Gi}),new ga(Di.INVALID_UINT_UID_FROM_STRING_UID);return wE.reqUserAccount(Gi.sid,{lts:Fi,success:!0,serverAddr:_o,stringUid:Gi.string_uid,uid:vf.uid,errorCode:null,extend:Gi}),!1}const IE=WO(vf.code);return IE.retry&&(_o=z[(uE+1)%z.length]),wE.reqUserAccount(Gi.sid,{lts:Fi,success:!1,serverAddr:_o,stringUid:Gi.string_uid,uid:vf.uid,errorCode:IE.desc,extend:Gi}),IE.retry},(vf,uE)=>vf.code!==Di.OPERATION_ABORTED&&(wE.reqUserAccount(Gi.sid,{lts:Fi,success:!1,serverAddr:_o,stringUid:Gi.string_uid,uid:null,errorCode:vf.code,extend:Gi}),_o=z[(uE+1)%z.length],!0),Ei);if(_f.code!==0){const vf=WO(_f.code);throw new ga(Di.UNEXPECTED_RESPONSE,vf.desc)}return _f}(A,o,s,l,p);return _==null||_.recordJoinChannelService({status:"success",endTs:Date.now()},k),j.uid}catch(j){throw _==null||_.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[j]},k),j}}async function xX(o,s,l){const p=_u("CDS_AP").slice(0,_u("AJAX_REQUEST_CONCURRENT")).map(k=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(k+"/api/v1"):"https://".concat(k,"/api/v1?action=config")).map(k=>function(j,z,H,$){const ue=r_(),Ei={flag:64,cipher_method:0,features:{device:ue.name,system:ue.os,system_general:navigator.userAgent,vendor:z.appId,version:ZT,cname:z.cname,sid:z.sid,session_id:z.sid,detail:"",proxyServer:z.proxyServer}};return SS(()=>hS(j,{data:Ei,timeout:1e3,cancelToken:H,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,Fi=>Fi.code!==Di.OPERATION_ABORTED,$)}(k,o,s,l));let _=null,b=null,A={};try{_=await kI(p)}catch(k){if(k.code===Di.OPERATION_ABORTED)throw k;b=k}if(p.forEach(k=>k.cancel()),wE.reportApiInvoke(o.sid,{name:j_.REQUEST_CONFIG_DISTRIBUTE,options:{error:b,res:_}}).onSuccess(),_&&_.test_tags)try{A=function(k){if(!k.test_tags)return{};const j=k.test_tags,z=Object.keys(j),H={};return z.forEach($=>{var ue;const Ei=HS(ue=$.slice(4)).call(ue),Fi=JSON.parse(j[$])[1];H[Ei]=Fi}),H}(_)}catch{}return A}async function f3(o,s,l,p){const _=_u("PROXY_SERVER_TYPE3"),b=(Ei,Fi,Gi)=>{let _o=Gi||_;return Array.isArray(_o)&&(_o=Fi%2==0?_[1]:_[0]),"https://".concat(_o,"/ap/?url=").concat(Ei)};let A=null;const k=[],j=async()=>{const Ei=_u("WEBCS_DOMAIN").slice(0,_u("AJAX_REQUEST_CONCURRENT")).map((_o,_f)=>{let vf;return vf=o.cloudProxyServer==="disabled"&&o.proxyServer?b("".concat(_o,"/api/v2/transpond/webrtc?v=2"),_f,o.proxyServer):o.cloudProxyServer==="disabled"||o.cloudProxyServer==="fallback"?"https://".concat(_o,"/api/v2/transpond/webrtc?v=2"):b("".concat(_o,"/api/v2/transpond/webrtc?v=2"),_f),{url:vf,areaCode:KO(),serviceIds:[$_.CHOOSE_SERVER,o.cloudProxyServer==="proxy5"?$_.CLOUD_PROXY_5:o.cloudProxyServer==="proxy3"||o.cloudProxyServer==="proxy4"?$_.CLOUD_PROXY:$_.CLOUD_PROXY_FALLBACK]}}),Fi=p.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:Ei.map(_o=>_o.url)}),Gi=await p0({fragementLength:_u("FRAGEMENT_LENGTH"),referenceList:Ei,asyncMapHandler:_o=>(_n.debug("[".concat(o.clientId,"] Connect to choose_server:"),_o.url),c3(_o,o,s,l)),allFailedhandler:_o=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_o},Fi),_o[0]},promisesCollector:k});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},Fi),Gi},z=async()=>{if(await aT(1e3),A!==null)return A;const Ei=_u("WEBCS_DOMAIN_BACKUP_LIST").map((_o,_f)=>{let vf;return vf=o.cloudProxyServer==="disabled"&&o.proxyServer?b("".concat(_o,"/api/v2/transpond/webrtc?v=2"),_f,o.proxyServer):o.cloudProxyServer==="disabled"||o.cloudProxyServer==="fallback"?"https://".concat(_o,"/api/v2/transpond/webrtc?v=2"):b("".concat(_o,"/api/v2/transpond/webrtc?v=2"),_f),{url:vf,areaCode:KO(),serviceIds:[$_.CHOOSE_SERVER,o.cloudProxyServer==="proxy5"?$_.CLOUD_PROXY_5:o.cloudProxyServer==="proxy3"||o.cloudProxyServer==="proxy4"?$_.CLOUD_PROXY:$_.CLOUD_PROXY_FALLBACK]}}),Fi=p.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:Ei.map(_o=>_o.url)}),Gi=await p0({fragementLength:_u("FRAGEMENT_LENGTH"),referenceList:Ei,asyncMapHandler:_o=>(_n.debug("[".concat(o.clientId,"] Connect to backup choose_server:"),_o.url),c3(_o,o,s,l)),allFailedhandler:_o=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_o},Fi),_o[0]},promisesCollector:k});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},Fi),Gi};let H,$,ue;try{({gatewayInfo:H,proxyInfo:$,url:ue}=await kI([j(),z()]))}catch(Ei){throw Ei[0]}if(k.length&&k.forEach(Ei=>Ei.cancel&&typeof Ei.cancel=="function"&&Ei.cancel()),!H||!$)throw new ga(Di.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(o.apUrl=ue,o.cloudProxyServer!=="disabled"&&Array.isArray(_)&&ue){const Ei=/^https?:\/\/(.+?)(\/.*)?$/.exec(ue)[1];_.includes(Ei)&&(o.proxyServer=Ei,_n.setProxyServer(Ei),wE.setProxyServer(Ei))}return A={gatewayInfo:H,proxyInfo:await RX($,H.uid)},A}async function E3(o,s,l,p){const _=_u("UAP_AP").slice(0,_u("AJAX_REQUEST_CONCURRENT")).map(b=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(b+"/api/v1?action=uap"):"https://".concat(b,"/api/v1?action=uap"));return await LX(_,o,s,l,p)}async function jX(o,s,l){const p=_u("UAP_AP").slice(0,_u("AJAX_REQUEST_CONCURRENT")).map(_=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(_+"/api/v1?action=uap"):"https://".concat(_,"/api/v1?action=uap")).map(_=>function(b,A,k,j){const z={command:"convergeAllocateEdge",sid:A.sid,appId:A.appId,token:A.token,ts:Date.now(),version:ZT,cname:A.cname,uid:A.uid.toString(),requestId:hL,seq:hL};hL+=1;const H={service_name:"tele_channel",json_body:JSON.stringify(z)};return SS(async()=>{const $=await hS(b,{data:H,cancelToken:k,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if($.code!==0){const Ei=new ga(Di.UNEXPECTED_RESPONSE,"cross channel ap error, code"+$.code,{retry:!0});throw _n.error(Ei.toString()),Ei}const ue=JSON.parse($.json_body);if(ue.code!==200){const Ei=new ga(Di.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(ue.code,", reason: ").concat(ue.reason));throw _n.error(Ei.toString()),Ei}if(!ue.servers||ue.servers.length===0){const Ei=new ga(Di.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw _n.error(Ei.toString()),Ei}return{vid:ue.vid,workerToken:ue.workerToken,addressList:(_u("CHANNEL_MEDIA_RELAY_SERVERS")||ue.servers).map(Ei=>"wss://".concat(Ei.address.replace(/\./g,"-"),".").concat(_u("WORKER_DOMAIN"),":").concat(Ei.wss))}},void 0,$=>!!($.code!==Di.OPERATION_ABORTED&&$.code!==Di.UNEXPECTED_RESPONSE||$.data&&$.data.retry),j)}(_,o,s,l));try{const _=await kI(p);return p.forEach(b=>b.cancel()),_}catch(_){throw _[0]}}async function VX(o,s,l){let p=null;const _=[],b=async A=>{const k=_u(A?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(j=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(j+"/api/v2/transpond/webrtc?v=2"):"https://".concat(j,"/api/v2/transpond/webrtc?v=2"));return A&&(await aT(1e3),p!==null)?p:await p0({fragementLength:_u("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:j=>(_n.debug("[".concat(o.clientId,"] update ticket, Connect to ").concat(A?"backup":""," choose_server:"),j),function(z,H,$,ue){const[Ei]=UX(H,[$_.CHOOSE_SERVER]);let Fi=F_.networkState;return SS(async()=>{Fi&&F_.networkState===dT.OFFLINE&&F_.onlineWaiter&&await RE.race([F_.onlineWaiter,aT(ue&&ue.maxRetryTimeout||x_.maxRetryTimeout)]),Fi=F_.networkState;const Gi=await hS(z,{data:Ei,cancelToken:$,headers:{"Content-Type":"multipart/form-data;"}},!0);return MX(Gi,z)},()=>!1,Gi=>Gi.code!==Di.OPERATION_ABORTED&&(Gi.code===Di.UPDATE_TICKET_FAILED?Gi.data.retry:(_n.warning("[".concat(H.clientId,"] update ticket network error, retry"),Gi),!0)),ue)}(j,o,s,l)),allFailedhandler:j=>{throw j[0]},promisesCollector:_})};try{return p=await kI([b(!1),b(!0)]),_.length&&_.forEach(A=>A.cancel&&typeof A.cancel=="function"&&A.cancel()),p}catch(A){throw A[0]}}function m3(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function _3(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?m3(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):m3(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}class FX extends R_{constructor(){super(),_t(this,"configs",void 0),_t(this,"joinInfo",void 0),_t(this,"cancelToken",void 0),_t(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),_t(this,"interval",void 0),_t(this,"mutex",new gT("config-distribute")),_t(this,"mutableParamsRead",!1)}startGetConfigDistribute(s,l){this.joinInfo=s,this.cancelToken=l,this.interval&&this.stopGetConfigDistribute(),_u("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},_u("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,wE.reportApiInvoke(null,{options:void 0,name:j_.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:T_.TRACER}).onSuccess(JSON.stringify(FR))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void _n.debug("[config-distribute] get config distribute interrupted have no joininfo");let s;const l=await this.mutex.lock();try{s=await xX(this.joinInfo,this.cancelToken,this.retryConfig),_n.debug("[config-distribute] get config distribute",JSON.stringify(s)),s.limit_bitrate&&this.handleBitrateLimit(s.limit_bitrate),this.cacheGlobalParameterConfig(s),this.configs=s}catch(p){const _=new ga(Di.NETWORK_RESPONSE_ERROR,p);_n.warning("[config-distribute] ".concat(_.toString()))}finally{l()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(s){var l;(l=s)&&l.uplink&&l.id&&l.uplink.max_bitrate!==void 0&&l.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==s.id&&this.emit(d0.UPDATE_BITRATE_LIMIT,s):this.emit(d0.UPDATE_BITRATE_LIMIT,s))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&_3({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(s){var l;const p=AD(l=Object.keys(s).filter(b=>/^webrtc_ng_global_parameter/.test(b))).call(l);for(let b=0;b<p.length;b++)for(let A=p.length-1;A>b;A--){const k=p[A];if(typeof s[k].__priority=="number"){const j=s[k].__priority,z=p[A-1];if(typeof s[z].__priority=="number"){if(!(j>s[z].__priority))continue;{const H=k;p[A]=p[A-1],p[A-1]=H}}else{const H=k;p[A]=p[A-1],p[A-1]=H}}}const _={};p.forEach(b=>{const A=s[b],k=A.__expires;Object.keys(A).forEach(j=>{j==="__priority"||j==="__expires"||Object.prototype.hasOwnProperty.call(_,j)||(_[j]=_3({value:A[j]},k&&{expires:k}))})});try{const b=JSON.stringify(_),A=window.btoa(b);window.localStorage.setItem("websdk_ng_global_parameter",A),_n.debug("Caching global parameters ".concat(b))}catch(b){_n.error("Error caching global parameters:",b.message)}}}function g3(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function E0(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?g3(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):g3(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}class BX extends R_{constructor(s,l,p,_){super(),_t(this,"spec",void 0),_t(this,"token",void 0),_t(this,"websocket",void 0),_t(this,"pingpongTimer",void 0),_t(this,"reconnectMode","retry"),_t(this,"serviceMode",void 0),_t(this,"reqId",0),_t(this,"commandReqId",0),_t(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),_t(this,"handleWebSocketMessage",b=>{if(!b.data)return;const A=JSON.parse(b.data);A.requestId?this.emit("@".concat(A.requestId,"-").concat(A.sid),A):this.serviceMode===H_.INJECT?this.emit(lS.INJECT_STREAM_STATUS,A):(wE.workerEvent(this.spec.sid,{actionType:"status",serverCode:A.code,workerType:this.serviceMode===H_.TRANSCODE?1:2}),this.emit(lS.PUBLISH_STREAM_STATUS,A))}),this.spec=l,this.token=s,this.serviceMode=_,this.websocket=new JR("live-streaming",p),this.websocket.on(jE.CONNECTED,this.handleWebSocketOpen),this.websocket.on(jE.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(jE.REQUEST_NEW_URLS,(b,A)=>{cT(this,lS.REQUEST_NEW_ADDRESS).then(b).catch(A)}),this.websocket.on(jE.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(s){return this.websocket.init(s)}async request(s,l,p,_){this.reqId+=1,s==="request"&&(this.commandReqId+=1);const b=this.commandReqId,A=this.reqId;if(!A||!this.websocket)throw new ga(Di.UNEXPECTED_ERROR);const k=E0({command:s,sdkVersion:ZT==="4.18.2"?"0.0.1":ZT,seq:A,requestId:A,allocate:p,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},l);if(this.websocket.state==="closed")throw new ga(Di.WS_DISCONNECT);const j=()=>new RE((ue,Ei)=>{this.websocket.once(jE.CLOSED,()=>Ei(new ga(Di.WS_ABORT))),this.websocket.once(jE.CONNECTED,ue)});this.websocket.state!=="connected"&&await j(),k.clientRequest&&(k.clientRequest.workerToken=this.token);const z=new RE((ue,Ei)=>{const Fi=()=>{Ei(new ga(Di.WS_ABORT))};this.websocket.once(jE.RECONNECTING,Fi),this.websocket.once(jE.CLOSED,Fi),this.once("@".concat(A,"-").concat(this.spec.sid),Gi=>{ue(Gi)})});_&&wE.workerEvent(this.spec.sid,E0(E0({},_),{},{requestId:b,actionType:"request",payload:JSON.stringify(l.clientRequest),serverCode:0,code:0}));const H=Date.now();this.websocket.sendMessage(k);let $=null;try{$=await z}catch(ue){if(this.websocket.state==="closed")throw ue;return await j(),await this.request(s,l,p)}return _&&wE.workerEvent(this.spec.sid,E0(E0({},_),{},{requestId:b,actionType:"response",payload:JSON.stringify($.serverResponse),serverCode:$.code,success:$.code===200,responseTime:Date.now()-H})),$.code!==200&&this.handleResponseError($),$}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const s=ZT==="4.18.2"?"0.0.1":ZT;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:s,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(s){switch(s.code){case D_.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void _n.warning("live stream response already exists stream");case D_.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case D_.LIVE_STREAM_RESPONSE_BAD_STREAM:case D_.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new ga(Di.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:s.code}).throw();case D_.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(s.serverResponse.command==="UnpublishStream"||s.serverResponse.command==="UninjectStream")return;throw new ga(Di.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case D_.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new ga(Di.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:s.code}).throw();case D_.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const l=new ga(Di.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(lS.WARNING,l,s.serverResponse.url)}case D_.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const l=new ga(Di.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(lS.WARNING,l,s.serverResponse.url)}case D_.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new ga(Di.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case D_.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new ga(Di.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:s.code}).throw();case D_.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const l=new ga(Di.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(lS.WARNING,l,s.serverResponse.url)}case D_.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new ga(Di.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:s.code}).throw();case D_.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new ga(Di.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case D_.LIVE_STREAM_RESPONSE_WORKER_LOST:case D_.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(s.serverResponse.command==="UnpublishStream"||s.serverResponse.command==="UninjectStream")return;throw new ga(Di.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case D_.ERROR_FAIL_SEND_MESSAGE:if(s.serverResponse.command==="UnpublishStream"||s.serverResponse.command==="UninjectStream")return;if(s.serverResponse.command==="UpdateTranscoding"||s.serverResponse.command==="ControlStream")return new ga(Di.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:s.code}).throw();throw new ga(Di.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case D_.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case D_.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case D_.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case D_.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new ga(Di.LIVE_STREAMING_CDN_ERROR,"",{code:s.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(GO)},6e3)}}function v3(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function ST(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?v3(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):v3(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}class GX extends R_{constructor(s){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:x_,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:x_;super(),_t(this,"onLiveStreamWarning",void 0),_t(this,"onLiveStreamError",void 0),_t(this,"onInjectStatusChange",void 0),_t(this,"spec",void 0),_t(this,"retryTimeout",1e4),_t(this,"connection",void 0),_t(this,"httpRetryConfig",void 0),_t(this,"wsRetryConfig",void 0),_t(this,"streamingTasks",new Map),_t(this,"isStartingStreamingTask",!1),_t(this,"taskMutex",new gT("live-streaming")),_t(this,"cancelToken",VT.CancelToken.source()),_t(this,"transcodingConfig",void 0),_t(this,"injectConfig",ST({},o9)),_t(this,"injectLoopTimes",0),_t(this,"uapResponse",void 0),_t(this,"lastTaskId",1),_t(this,"statusError",new Map),this.spec=s,this.httpRetryConfig=p,this.wsRetryConfig=l}async setTranscodingConfig(s){const l=ST(ST({},i9),s);l.videoCodecProfile!==66&&l.videoCodecProfile!==77&&l.videoCodecProfile!==100&&(_n.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(l.videoCodecProfile," -> 100")),l.videoCodecProfile=100),l.transcodingUsers||(l.transcodingUsers=l.userConfigs),l.transcodingUsers&&(l.transcodingUsers=l.transcodingUsers.map(A=>ST(ST(ST({},r9),A),{},{zOrder:A.zOrder?A.zOrder+1:1}))),function(A){b_(A.width)||E_(A.width,"config.width",0,1e4),b_(A.height)||E_(A.height,"config.height",0,1e4),b_(A.videoBitrate)||E_(A.videoBitrate,"config.videoBitrate",1,1e6),b_(A.videoFrameRate)||E_(A.videoFrameRate,"config.videoFrameRate"),b_(A.lowLatency)||TI(A.lowLatency,"config.lowLatency"),b_(A.audioSampleRate)||Eg(A.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),b_(A.audioBitrate)||E_(A.audioBitrate,"config.audioBitrate",1,128),b_(A.audioChannels)||Eg(A.audioChannels,"config.audioChannels",[1,2,3,4,5]),b_(A.videoGop)||E_(A.videoGop,"config.videoGop"),b_(A.videoCodecProfile)||Eg(A.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),b_(A.userCount)||E_(A.userCount,"config.userCount",0,17),b_(A.backgroundColor)||E_(A.backgroundColor,"config.backgroundColor",0,16777215),b_(A.userConfigExtraInfo)||eT(A.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),A.transcodingUsers&&!b_(A.transcodingUsers)&&(JS(A.transcodingUsers,"config.transcodingUsers"),A.transcodingUsers.forEach((k,j)=>{ND(k.uid),b_(k.x)||E_(k.x,"transcodingUser[".concat(j,"].x"),0,1e4),b_(k.y)||E_(k.y,"transcodingUser[".concat(j,"].y"),0,1e4),b_(k.width)||E_(k.width,"transcodingUser[".concat(j,"].width"),0,1e4),b_(k.height)||E_(k.height,"transcodingUser[".concat(j,"].height"),0,1e4),b_(k.zOrder)||E_(k.zOrder-1,"transcodingUser[".concat(j,"].zOrder"),0,100),b_(k.alpha)||E_(k.alpha,"transcodingUser[".concat(j,"].alpha"),0,1,!1)})),b_(A.watermark)||VD(A.watermark,"watermark"),b_(A.backgroundImage)||VD(A.backgroundImage,"backgroundImage"),A.images&&!b_(A.images)&&(JS(A.images,"config.images"),A.images.forEach((k,j)=>{VD(k,"images[".concat(j,"]"))}))}(l);const p=[];l.images&&p.push(...l.images.map(A=>ST(ST(ST({},xD),A),{},{zOrder:255}))),l.backgroundImage&&(p.push(ST(ST(ST({},xD),l.backgroundImage),{},{zOrder:0})),delete l.backgroundImage),l.watermark&&(p.push(ST(ST(ST({},xD),l.watermark),{},{zOrder:255})),delete l.watermark),l.images=p,l.transcodingUsers&&(l.userConfigs=l.transcodingUsers.map(A=>ST({},A)),l.userCount=l.transcodingUsers.length,delete l.transcodingUsers);const _=(l.userConfigs||[]).map(A=>typeof A.uid=="number"?RE.resolve(A.uid):p3(A.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await RE.all(_)).forEach((A,k)=>{l.userConfigs&&l.userConfigs[k]&&(l.userConfigs[k].uid=A)}),this.transcodingConfig=l,this.connection)try{var b;const A=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(US(b=this.streamingTasks).call(b)).map(k=>k.taskId).join("#")});_n.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(A.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(A){if(!A.data||!A.data.retry)throw A;A.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(k=>{_n.warning("[".concat(this.spec.clientId,"] live streaming receive error"),A.toString(),"try to republish",k.url),this.startLiveStreamingTask(k.url,k.mode,A).then(()=>{_n.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(k.url," success"))}).catch(j=>{_n.error("[".concat(this.spec.clientId,"] live streaming republish failed"),k.url,j.toString()),this.onLiveStreamError&&this.onLiveStreamError(k.url,j)})})}}setInjectStreamConfig(s,l){this.injectConfig=Object.assign({},this.injectConfig,s),this.injectLoopTimes=l}async startLiveStreamingTask(s,l,p){var _;if(Array.from(US(_=this.streamingTasks).call(_)).find(j=>j.mode===H_.INJECT)&&l===H_.INJECT)return new ga(Di.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&l===H_.TRANSCODE)throw new ga(Di.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let b={command:"PublishStream",ts:Date.now(),url:s,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};_n.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(s,", mode: ").concat(l));const A=await this.taskMutex.lock();if(!this.connection&&p)return void A();if(this.streamingTasks.get(s)&&!p)return A(),new ga(Di.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(l))}catch(j){throw A(),j}switch(l){case H_.TRANSCODE:b.transcodingConfig=ST({},this.transcodingConfig);break;case H_.RAW:break;case H_.INJECT:b={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:s,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(b.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const k=this.lastTaskId++;try{const j=new RE((H,$)=>{aT(this.retryTimeout).then(()=>{if(p)return $(p);const ue=this.statusError.get(s);return ue?(this.statusError.delete(s),$(ue)):void 0})}),z=await RE.race([this.connection.request("request",{clientRequest:b},!0,{url:s,command:"PublishStream",workerType:l===H_.TRANSCODE?1:2,requestByUser:!p,tid:k.toString()}),j]);this.isStartingStreamingTask=!1,_n.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(z.code)),this.streamingTasks.set(s,{clientRequest:b,mode:l,url:s,taskId:k}),A()}catch(j){if(A(),this.isStartingStreamingTask=!1,!j.data||!j.data.retry||p)throw j;return j.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(s,l,j)):await this.startLiveStreamingTask(s,l,j)}}stopLiveStreamingTask(s){return new RE((l,p)=>{const _=this.streamingTasks.get(s);if(!_||!this.connection)return new ga(Di.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const b=_.mode;_.abortTask=()=>{_n.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(s),l()},this.connection.request("request",{clientRequest:{command:b===H_.INJECT?"UninjectStream":"UnpublishStream",url:_.url}},!1,{url:s,command:"UnPublishStream",workerType:b===H_.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(A=>{_n.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(A.code)),this.streamingTasks.delete(s),this.streamingTasks.size===0&&b!==H_.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),l(),b===H_.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(hR.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,s)}).catch(p)})}async controlInjectStream(s,l,p,_){const b=this.streamingTasks.get(s);if(!b||!this.connection||b.mode!==H_.INJECT)throw new ga(Di.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:s,control:l,audioVolume:p,position:_}})).serverResponse}resetAllTask(){var s;const l=Array.from(US(s=this.streamingTasks).call(s));this.terminate();for(const p of l)this.startLiveStreamingTask(p.url,p.mode).catch(_=>{this.onLiveStreamError&&this.onLiveStreamError(p.url,_)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=VT.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(s){if(this.connection)throw new ga(Di.UNEXPECTED_ERROR,"live streaming connection has already connected");const l=await cT(this,RI.REQUEST_WORKER_MANAGER_LIST,s);return this.uapResponse=l,this.connection=new BX(l.workerToken,this.spec,this.wsRetryConfig,s),this.connection.on(lS.WARNING,(p,_)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(_,p)),this.connection.on(lS.PUBLISH_STREAM_STATUS,p=>this.handlePublishStreamServer(p)),this.connection.on(lS.INJECT_STREAM_STATUS,p=>this.handleInjectStreamServerStatus(p)),this.connection.on(lS.REQUEST_NEW_ADDRESS,(p,_)=>{if(!this.connection)return _(new ga(Di.UNEXPECTED_ERROR,"can not get new live streaming address list"));cT(this,RI.REQUEST_WORKER_MANAGER_LIST,s).then(b=>{this.uapResponse=b,p(b.addressList)}).catch(_)}),await this.connection.init(l.addressList),this.connection}handlePublishStreamServer(s){const l=s.serverStatus&&s.serverStatus.url||"empty_url",p=this.streamingTasks.get(l),_=s.reason;switch(s.code){case D_.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case D_.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case D_.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case D_.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const A=new ga(Di.LIVE_STREAMING_CDN_ERROR,"",{code:s.code});if(p)return _n.error(A.toString()),this.onLiveStreamError&&this.onLiveStreamError(l,A);if(!this.isStartingStreamingTask)return;this.statusError.set(l,A)}case D_.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const A=new ga(Di.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,_);return this.onLiveStreamWarning&&this.onLiveStreamWarning(l,A)}case D_.LIVE_STREAM_RESPONSE_WORKER_LOST:case D_.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var b;if(!this.connection)return;this.connection.tryNextAddress();const A=Array.from(US(b=this.streamingTasks).call(b));for(const k of A)k.abortTask?k.abortTask():(_n.warning("[".concat(this.spec.clientId,"] publish stream status code"),s.code,"try to republish",k.url),this.startLiveStreamingTask(k.url,k.mode,new ga(Di.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:s.code})).then(()=>{_n.debug("[".concat(this.spec.clientId,"] republish live stream success"),k.url)}).catch(j=>{_n.error(j.toString()),this.onLiveStreamError&&this.onLiveStreamError(k.url,j)}));return}}}handleInjectStreamServerStatus(s){const l=Number(s.uid),p=s.serverStatus&&s.serverStatus.url;switch(s.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(hR.INJECT_STREAM_STATUS_START_SUCCESS,l,p));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(hR.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,l,p),void this.streamingTasks.delete(p);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(hR.INJECT_STREAM_STATUS_START_UNAUTHORIZED,l,p),void this.streamingTasks.delete(p);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(hR.INJECT_STREAM_STATUS_BROKEN,l,p),void this.streamingTasks.delete(p);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(hR.INJECT_STREAM_STATUS_START_TIMEOUT,l,p),void this.streamingTasks.delete(p);default:return void _n.debug("inject stream server status",s)}}hasUrl(s){return this.streamingTasks.has(s)}}class y3{constructor(){_t(this,"destChannelMediaInfos",new Map),_t(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(s){lV(s),this.srcChannelMediaInfo=s}addDestChannelInfo(s){lV(s),this.destChannelMediaInfos.set(s.channelName,s)}removeDestChannelInfo(s){CD(s),this.destChannelMediaInfos.delete(s)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function b3(o){if(!(o instanceof y3))return new ga(Di.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const s=o.getSrcChannelMediaInfo(),l=o.getDestChannelMediaInfo();if(!s)return new ga(Di.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(l.size===0)return new ga(Di.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class qX extends R_{constructor(s,l,p){super(),_t(this,"ws",void 0),_t(this,"requestId",1),_t(this,"heartBeatTimer",void 0),_t(this,"joinInfo",void 0),_t(this,"clientId",void 0),_t(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),_t(this,"onClose",_=>{this.emit("close"),this.dispose()}),_t(this,"onMessage",_=>{const b=JSON.parse(_.data);if(!b||b.command!=="serverResponse"||!b.requestId)return b&&b.command==="serverStatus"&&b.serverStatus&&b.serverStatus.command?(this.emit("status",b.serverStatus),void this.emit(b.serverStatus.command,b.serverStatus)):void 0;this.emit("req_".concat(b.requestId),b)}),this.joinInfo=s,this.clientId=l,this.ws=new JR("cross-channel-".concat(this.clientId),p),this.ws.on(jE.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(jE.CONNECTED,this.onOpen),this.ws.on(jE.ON_MESSAGE,this.onMessage),this.ws.on(jE.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(s){const l=this.requestId++;return s.requestId=l,s.seq=l,this.ws.sendMessage(s),l}waitStatus(s){return new RE((l,p)=>{const _=window.setTimeout(()=>{p(new ga(Di.TIMEOUT,"wait status timeout, status: ".concat(s)))},5e3);this.once(s,b=>{window.clearTimeout(_),b.state&&b.state!==0?p(new ga(Di.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(s))):l(void 0)}),this.once("dispose",()=>{window.clearTimeout(_),p(new ga(Di.WS_ABORT))})})}async request(s){if(this.ws.state==="closed")throw new ga(Di.WS_DISCONNECT);const l=()=>new RE((A,k)=>{this.ws.once(jE.CLOSED,()=>k(new ga(Di.WS_ABORT))),this.ws.once(jE.CONNECTED,A)});this.ws.state!=="connected"&&await l();const p=this.sendMessage(s),_=new RE((A,k)=>{const j=()=>{k(new ga(Di.WS_ABORT))};this.ws.once(jE.RECONNECTING,j),this.ws.once(jE.CLOSED,j),this.once("req_".concat(p),A),aT(3e3).then(()=>{this.removeAllListeners("req_".concat(p)),this.ws.off(jE.RECONNECTING,j),this.ws.off(jE.CLOSED,j),k(new ga(Di.TIMEOUT,"cross channel ws request timeout"))})}),b=await _;if(!b||b.code!==200)throw new ga(Di.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(b)));return b}async connect(s){this.ws.removeAllListeners(jE.REQUEST_NEW_URLS),this.ws.on(jE.REQUEST_NEW_URLS,l=>{l(s)}),await this.ws.init(s)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(s){const l=this.requestId++;return s.requestId=l,this.ws.sendMessage(s),l}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class WX extends R_{set state(s){s!==this._state&&(s!==_T.RELAY_STATE_FAILURE&&(this.errorCode=pR.RELAY_OK),this.emit("state",s,this.errorCode),this._state=s)}get state(){return this._state}constructor(s,l,p,_,b){super(),_t(this,"joinInfo",void 0),_t(this,"sid",void 0),_t(this,"clientId",void 0),_t(this,"cancelToken",VT.CancelToken.source()),_t(this,"workerToken",void 0),_t(this,"requestId",0),_t(this,"signal",void 0),_t(this,"prevChannelMediaConfig",void 0),_t(this,"httpRetryConfig",void 0),_t(this,"_resolution",void 0),_t(this,"_state",_T.RELAY_STATE_IDLE),_t(this,"errorCode",pR.RELAY_OK),_t(this,"onStatus",A=>{_n.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(A))),A&&A.command&&(A.command==="onAudioPacketReceived"&&this.emit("event",RS.PACKET_RECEIVED_AUDIO_FROM_SRC),A.command==="onVideoPacketReceived"&&this.emit("event",RS.PACKET_RECEIVED_VIDEO_FROM_SRC),A.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=pR.SRC_TOKEN_EXPIRED,this.state=_T.RELAY_STATE_FAILURE),A.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=pR.DEST_TOKEN_EXPIRED,this.state=_T.RELAY_STATE_FAILURE))}),_t(this,"onReconnect",async()=>{_n.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",RS.NETWORK_DISCONNECTED),this.state=_T.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(A=>{this.state!==_T.RELAY_STATE_IDLE&&(_n.error("auto restart channel media relay failed",A.toString()),this.errorCode=pR.SERVER_CONNECTION_LOST,this.state=_T.RELAY_STATE_FAILURE)})}),this.joinInfo=s,this.clientId=l,this.sid=oL(),this.signal=new qX(this.joinInfo,this.clientId,p),this.httpRetryConfig=_,this._resolution=b}async startChannelMediaRelay(s){if(this.state!==_T.RELAY_STATE_IDLE)throw new ga(Di.INVALID_OPERATION);this.state=_T.RELAY_STATE_CONNECTING,await this.connect(),_n.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(s)}catch(l){throw l.data&&l.data.serverResponse&&l.data.serverResponse.command==="SetSourceChannel"?new ga(Di.CROSS_CHANNEL_FAILED_JOIN_SRC):l.data&&l.data.serverResponse&&l.serverResponse.command==="SetDestChannelStatus"?new ga(Di.CROSS_CHANNEL_FAILED_JOIN_DEST):l.data&&l.data.serverResponse&&l.serverResponse.command==="StartPacketTransfer"?new ga(Di.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):l}this.prevChannelMediaConfig=s}async updateChannelMediaRelay(s){if(this.state!==_T.RELAY_STATE_RUNNING)throw new ga(Di.INVALID_OPERATION);await this.sendUpdateMessage(s),this.prevChannelMediaConfig=s}async setVideoProfile(s){if(this._resolution=s,this.state!==_T.RELAY_STATE_RUNNING)throw new ga(Di.INVALID_OPERATION);const l=this.genMessage(iT.SetVideoProfile);await this.signal.request(l),_n.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),_n.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=_T.RELAY_STATE_IDLE,this.dispose()}dispose(){_n.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=VT.CancelToken.source(),this.state=_T.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const s=await jX(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=s.workerToken,await this.signal.connect(s.addressList),this.emit("event",RS.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(s){const l=this.genMessage(iT.StopPacketTransfer);await this.signal.request(l),await this.signal.waitStatus("Normal Quit"),_n.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const p=this.genMessage(iT.SetSdkProfile,s);await this.signal.request(p),_n.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const _=this.genMessage(iT.SetSourceChannel,s);await this.signal.request(_),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",RS.PACKET_JOINED_SRC_CHANNEL),_n.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const b=this.genMessage(iT.SetSourceUserId,s);await this.signal.request(b),_n.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const A=this.genMessage(iT.SetDestChannel,s);await this.signal.request(A),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",RS.PACKET_JOINED_DEST_CHANNEL),_n.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const k=this.genMessage(iT.StartPacketTransfer,s);await this.signal.request(k),this.emit("event",RS.PACKET_SENT_TO_DEST_CHANNEL),this.state=_T.RELAY_STATE_RUNNING,_n.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(s){const l=this.genMessage(iT.UpdateDestChannel,s);await this.signal.request(l),this.emit("event",RS.PACKET_UPDATE_DEST_CHANNEL),_n.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const s=this.genMessage(iT.StopPacketTransfer);await this.signal.request(s),_n.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(s,l){const p=[],_=[],b=[];this.requestId+=1;const A={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:ZT,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};A.sdkVersion==="4.18.2"&&(A.sdkVersion="0.0.1");let k=null,j=null;switch(s){case iT.SetSdkProfile:return A.clientRequest={command:"SetSdkProfile",type:"multi_channel"},A;case iT.SetSourceChannel:if(j=l&&l.getSrcChannelMediaInfo(),!j)throw new ga(Di.UNEXPECTED_ERROR,"can not find source config");return A.clientRequest={command:"SetSourceChannel",uid:"0",channelName:j.channelName,token:j.token||this.joinInfo.appId},A;case iT.SetSourceUserId:if(j=l&&l.getSrcChannelMediaInfo(),!j)throw new ga(Di.UNEXPECTED_ERROR,"can not find source config");return A.clientRequest={command:"SetSourceUserId",uid:j.uid+""},A;case iT.SetDestChannel:if(k=l&&l.getDestChannelMediaInfo(),!k)throw new ga(Di.UNEXPECTED_ERROR,"can not find dest config");return k.forEach(z=>{p.push(z.channelName),_.push(z.uid+""),b.push(z.token||this.joinInfo.appId)}),A.clientRequest={command:"SetDestChannel",channelName:p,uid:_,token:b},A;case iT.StartPacketTransfer:return A.clientRequest={command:"StartPacketTransfer"},A;case iT.Reconnect:return A.clientRequest={command:"Reconnect"},A;case iT.StopPacketTransfer:return A.clientRequest={command:"StopPacketTransfer"},A;case iT.UpdateDestChannel:if(k=l&&l.getDestChannelMediaInfo(),!k)throw new ga(Di.UNEXPECTED_ERROR,"can not find dest config");return k.forEach(z=>{p.push(z.channelName),_.push(z.uid+""),b.push(z.token||this.joinInfo.appId)}),A.clientRequest={command:"UpdateDestChannel",channelName:p,uid:_,token:b},A;case iT.SetVideoProfile:A.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return A}}const fL=o=>{const s=document.createElement("canvas");return s.width=2,s.height=2,new RE((l,p)=>{s.toBlob(async _=>{if(s.remove(),_){const b=await T3(_);l({buffer:b,width:s.width,height:s.height})}else p(new ga(Di.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},o,1)})},T3=async o=>{const s=await o.arrayBuffer();return new Uint8Array(s)};function S3(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function R3(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?S3(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):S3(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}class EL{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(s){s!==this._videoElementStatus&&(_n.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(s)),this._videoElementStatus=s)}constructor(s){_t(this,"trackId",void 0),_t(this,"config",void 0),_t(this,"onFirstVideoFrameDecoded",void 0),_t(this,"freezeTimeCounterList",[]),_t(this,"renderFreezeAccTime",0),_t(this,"isKeepLastFrame",!1),_t(this,"timeUpdatedCount",0),_t(this,"freezeTime",0),_t(this,"playbackTime",0),_t(this,"lastTimeUpdatedTime",0),_t(this,"autoplayFailed",!1),_t(this,"videoTrack",void 0),_t(this,"videoElement",void 0),_t(this,"cacheVideoElement",void 0),_t(this,"videoElementCheckInterval",void 0),_t(this,"_videoElementStatus",nT.NONE),_t(this,"isGettingVideoDimensions",!1),_t(this,"startGetVideoDimensions",()=>{const l=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return _n.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(l,500)};!this.isGettingVideoDimensions&&l()}),_t(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&o_.curState==="running"&&(_n.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(r2())),c2()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),_t(this,"handleVideoEvents",l=>{switch(l.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=nT.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=nT.CANPLAY;break;case"stalled":this.videoElementStatus=nT.STALLED;break;case"suspend":this.videoElementStatus=nT.SUSPEND;break;case"pause":this.videoElementStatus=nT.PAUSED,ET()||LS()||fT()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(_n.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=nT.WAITING;break;case"abort":this.videoElementStatus=nT.ABORT;break;case"ended":this.videoElementStatus=nT.ENDED;break;case"emptied":this.videoElementStatus=nT.EMPTIED;break;case"error":{this.videoElementStatus=nT.ERROR;const p=this.videoElement.error;p&&_n.error("[".concat(this.trackId,"] media error, code: ").concat(p.code,", message: ").concat(p.message));break}case"timeupdate":{const p=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=p);const _=p-this.lastTimeUpdatedTime,b=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=p,QS.lastVisibleTime<QS.lastHiddenTime||b<QS.lastHiddenTime||b<QS.lastVisibleTime)return;for(_>_u("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=_),this.playbackTime+=_;this.playbackTime>=6e3;){this.playbackTime-=6e3;const A=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(A),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),_t(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(_n.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(r2())),c2()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=s.trackId,this.config=s,s.element instanceof HTMLVideoElement?this.videoElement=s.element:this.videoElement=document.createElement("video"),o_.on(Z_.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),o_.on(Z_.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var s;return(s=this.videoElement.parentElement)!==null&&s!==void 0?s:void 0}updateConfig(s){this.config=s,this.trackId=s.trackId,s.element!==this.videoElement&&(this.destroy(),this.videoElement=s.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(s){this.videoTrack!==s&&(this.videoTrack=s,this.initVideoElement())}play(s){const l=this.videoElement.play();l&&l.catch&&l.catch(_=>{s&&wE.autoplayFailed(s,"video",_.message,this.trackId),_.name==="NotAllowedError"?(_n.warning("detected video element autoplay failed",_),this.autoplayFailed=!0,this.handleAutoPlayFailed()):_n.warning("[".concat(this.trackId,"] play warning: "),_)});const p=r_();if((p.name==="Safari"&&Number(p.version)===15||fI())&&l&&l.then&&l.catch){const _=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};l.then(_).catch(_)}}getCurrentFrame(){const s=document.createElement("canvas");s.width=this.videoElement.videoWidth,s.height=this.videoElement.videoHeight;const l=s.getContext("2d");if(!l)return _n.error("create canvas context failed!"),new ImageData(2,2);l.drawImage(this.videoElement,0,0,s.width,s.height);const p=l.getImageData(0,0,s.width,s.height);return s.remove(),p}async getCurrentFrameToUint8Array(s){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const p=document.createElement("canvas");p.width=this.videoElement.videoWidth,p.height=this.videoElement.videoHeight;const _=p.getContext("2d");return _?(_.drawImage(this.videoElement,0,0,p.width,p.height),new RE((b,A)=>{p.toBlob(async k=>{if(p.remove(),k){const j=await T3(k);b({buffer:j,width:p.width,height:p.height})}else A(new ga(Di.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},s,l<0?.1:l>1?1:l)})):await fL(s)}destroy(){o_.off(Z_.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),o_.off(Z_.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=nT.INIT,!this.videoElementCheckInterval&&(I3.forEach(b=>{this.videoElement.addEventListener(b,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(b){return b!==document.body&&document.body.contains(b)})(this.videoElement)||(this.videoElementStatus=nT.DESTROYED)},1e3),_u("ENABLE_VIDEO_FRAME_CALLBACK"))){var s,l;let b;const A=(k,j)=>{if(this.videoElementStatus===nT.PLAYING){if(b){const $=j.presentationTime-b.presentationTime;$>_u("VIDEO_FREEZE_DURATION")&&QS.lastVisibleTime>=QS.lastHiddenTime&&b.timestamp>QS.lastVisibleTime&&b.timestamp>QS.lastHiddenTime&&(this.renderFreezeAccTime+=$)}b=R3(R3({},j),{},{timestamp:k})}var z,H;_u("ENABLE_VIDEO_FRAME_CALLBACK")&&((z=(H=this.videoElement).requestVideoFrameCallback)===null||z===void 0||z.call(H,A))};(s=(l=this.videoElement).requestVideoFrameCallback)===null||s===void 0||s.call(l,A)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),_O()&&(this.videoElement.poster="noposter");const p=r_();p.name==="Safari"&&Number(p.version)===15||fI()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,O_()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,O_()&&this.videoElement.load());const _=this.videoElement.play();_!==void 0&&_.catch(b=>{_n.debug("[".concat(this.trackId,"] playback interrupted"),b.toString())})}resetVideoElement(){I3.forEach(s=>{this.videoElement&&this.videoElement.removeEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=nT.NONE}handleAutoPlayFailed(){const s=l=>{l.preventDefault(),this.videoElement.play().then(()=>{_n.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(p=>{_n.error(p)}),this.autoplayFailed=!1,r0()?document.body.removeEventListener("click",s,!0):(document.body.removeEventListener("touchstart",s,!0),document.body.removeEventListener("mousedown",s,!0))};r0()?document.body.addEventListener("click",s,!0):(document.body.addEventListener("touchstart",s,!0),document.body.addEventListener("mousedown",s,!0)),wV()}}const I3=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class O3 extends EL{constructor(s){super(s),_t(this,"container",void 0),_t(this,"slot",void 0),this.slot=s.element,this.updateConfig(s)}updateConfig(s){this.config=s,this.trackId=s.trackId;const l=s.element;l!==this.slot&&(this.destroy(),this.slot=l),this.createElements()}updateVideoTrack(s){this.videoTrack!==s&&(this.videoTrack=s,this.createElements())}play(s){var l;(l=this.container)!==null&&l!==void 0&&l.contains(this.videoElement)&&super.play(s)}getCurrentFrame(){var s;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(s){var l;let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(l=this.container)!==null&&l!==void 0&&l.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(s,p):await fL(s)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",_u("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var s;!this.container||(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var s;if((s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function YO(o){const s={};o.facingMode&&(s.facingMode=o.facingMode),o.cameraId&&(s.deviceId={exact:o.cameraId});const l=VR(o.encoderConfig);return s.width=l.width,s.height=l.height,!d2()&&l.frameRate&&(s.frameRate=l.frameRate),r_().name===c_.EDGE&&typeof s.frameRate=="object"&&(s.frameRate.max=60),O_()&&(s.frameRate={ideal:30,max:30}),s}function KX(o){const s={};o.screenSourceType&&(s.mediaSource=o.screenSourceType),o.extensionId&&jP()&&(s.extensionId=o.extensionId);const{displaySurface:l,selfBrowserSurface:p,surfaceSwitching:_,systemAudio:b}=o;(VP(107)||i2(107)||o2(93))&&(l&&(Eg(l,"displaySurface",["browser","window","monitor"]),s.displaySurface=l),p?(Eg(p,"selfBrowserSurface",["exclude","include"]),s.selfBrowserSurface=p):s.selfBrowserSurface="include",_&&(Eg(_,"surfaceSwitching",["exclude","include"]),s.surfaceSwitching=_)),(VP(105)||i2(105)||o2(91))&&b&&(Eg(b,"systemAudio",["exclude","include"]),s.systemAudio=b),o.electronScreenSourceId&&(s.sourceId=o.electronScreenSourceId);const A=o.encoderConfig?yD(o.encoderConfig):null;return s.mandatory={chromeMediaSource:"desktop",maxWidth:A?A.width:void 0,maxHeight:A?A.height:void 0},A&&(A.frameRate&&(typeof A.frameRate=="number"?(s.mandatory.maxFrameRate=A.frameRate,s.mandatory.minFrameRate=A.frameRate):(s.mandatory.maxFrameRate=A.frameRate.max||A.frameRate.ideal||A.frameRate.exact||void 0,s.mandatory.minFrameRate=A.frameRate.min||A.frameRate.ideal||A.frameRate.exact||void 0),s.frameRate=A.frameRate),A.width&&(s.width=A.width),A.height&&(s.height=A.height)),s}function A3(o){const s={};if(d2()||(o.AGC!==void 0&&(s.autoGainControl=o.AGC),o.AEC!==void 0&&(s.echoCancellation=o.AEC),o.ANS!==void 0&&(s.noiseSuppression=o.ANS,jP()&&o.ANS&&(s.googHighpassFilter=o.ANS))),o.encoderConfig){const l=CO(o.encoderConfig);s.channelCount=l.stereo?2:1,s.sampleRate=l.sampleRate,s.sampleSize=l.sampleSize}return o.microphoneId&&(s.deviceId={exact:o.microphoneId}),_O()&&(s.sampleRate=void 0),s}var MI,zO;(function(o){o.COVERED="COVERED",o.POSITION="POSITION",o.SIZE="SIZE",o.STYLE="STYLE"})(MI||(MI={})),function(o){o.UNMOUNTED="UNMOUNTED",o.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(zO||(zO={}));var w3,C3,N3,P3,D3,k3,L3,M3,U3,x3,j3,V3,F3,B3,G3,q3,W3,K3,H3,Y3,z3,J3,X3,Q3,HE,$3,Z3,_B,tG,eG,nG,rG,iG,rS,oG=new class{constructor(){_t(this,"_clientSize",null),_t(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),_t(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),_t(this,"getStyle",o=>window.getComputedStyle(o,null)),_t(this,"checkCssVisibleProperty",o=>{let s=!0;const l=this.getStyle(o),{display:p,visibility:_,opacity:b,filter:A}=l;return(p==="none"||["hidden","collapse"].includes(_)||Number(b)<.1)&&(s=!1),s?(A&&A.split(" ").filter(k=>{const j=k.split("(")[0];return["brightness","blur","opacity"].includes(j)}).map(k=>{const[j,z]=k.split(/\(|\)/);return[j,Number(z.match(/^[0-9\.]+/))]}).forEach(k=>{const[j,z]=k;switch(j){case"brightness":(z<.1||z>3)&&(s=!1);break;case"blur":z>3&&(s=!1);break;case"opacity":z<.1&&(s=!1)}}),s):!1}),_t(this,"checkPropertyUpToAllParentNodes",(o,s)=>{let l=!0,p=!0;const _=A=>s(A);let b=o;for(;b&&p;)_(b)||(l=!1,p=!1),b=b.parentElement,b||(p=!1);return l}),_t(this,"checkActualCssVisibleIncludeInherit",o=>this.checkPropertyUpToAllParentNodes(o,this.checkCssVisibleProperty)),_t(this,"getSizeAboutClient",o=>{const{width:s,height:l,left:p,right:_,top:b,bottom:A}=o.getBoundingClientRect(),k=this.getClientWidth(),j=this.getClientHeight();return{width:s,height:l,left:p,right:_,top:b,bottom:A,clientWidth:k,clientHeight:j,clientMin:Math.min(k,j)}}),_t(this,"checkActualSize",()=>{const{width:o,height:s,clientMin:l}=this._clientSize;return this.checkSizeIsVisible(o,s,l)}),_t(this,"elementFromPoint",(o,s)=>document.elementFromPoint?document.elementFromPoint(o,s):null),_t(this,"checkCoverForAPoint",(o,s,l)=>{const p=this.elementFromPoint(o,s);return p!==null&&p!==l}),_t(this,"getPointPositionList",()=>{const{width:o,height:s,left:l,top:p}=this._clientSize,_=o/6,b=s/6,A=[],k=10**6;for(let j=0;j<5;j++)for(let z=0;z<5;z++){const H=(l*k+(j===0?.1:j===4?(_*j*k-1e5)/k:_*j)*k)/k,$=(p*k+(z===0?.1:z===4?(b*z*k-1e5)/k:b*z)*k)/k;A.push({x:H,y:$})}return[...A]}),_t(this,"checkElementCover",o=>this.getPointPositionList().map(s=>this.checkCoverForAPoint(s.x,s.y,o)).filter(s=>!!s).length>6),_t(this,"checkSizeIsVisible",(o,s,l)=>(o>50||l/o<=10)&&(s>50||l/s<=10)),_t(this,"checkSizeOfPartInClient",()=>{const{left:o,right:s,top:l,bottom:p,clientHeight:_,clientWidth:b,clientMin:A}=this._clientSize;let k,j,z,H;if(o<0)k=0;else{if(!(o<b))return!1;k=o}if(s<0)return!1;if(j=s<b?s:b,l<0)z=0;else{if(!(l<_))return!1;z=l}if(p<0)return!1;H=p<_?p:_;const $=j-k,ue=H-z;return this.checkSizeIsVisible($,ue,A)}),_t(this,"returnHiddenResult",o=>(this._clientSize=null,{visible:!1,reason:o})),_t(this,"checkOneElementVisible",o=>{if(o instanceof HTMLElement){if(this.checkElementIsMountedOnDom(o)){if(this.checkActualCssVisibleIncludeInherit(o)){if(this._clientSize=this.getSizeAboutClient(o),this.checkElementCover(o))return this.returnHiddenResult(MI.COVERED);{const s=this.checkActualSize(),l=this.checkSizeOfPartInClient();return s&&!l?this.returnHiddenResult(MI.POSITION):s?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(MI.SIZE)}}return this.returnHiddenResult(MI.STYLE)}return this.returnHiddenResult(zO.UNMOUNTED)}return this.returnHiddenResult(zO.INVALID_HTML_ELEMENT)}),_t(this,"checkElementIsMountedOnDom",o=>this.checkPropertyUpToAllParentNodes(o,s=>s.nodeName.toUpperCase()!=="HTML"?s.parentElement!==null:!!document.documentElement))}};function sG(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function m0(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?sG(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):sG(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}let G_=(w3=kE({argsMap:(o,s,l)=>[o.getTrackId(),typeof s=="string"?s:s instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",l]}),C3=w_(),N3=kE({argsMap:o=>[o.getTrackId()]}),P3=AI("LocalVideoTrack","_enabledMutex"),D3=kE({argsMap:(o,s)=>[o.getTrackId(),s]}),k3=w_(),L3=AI("LocalVideoTrack","_enabledMutex"),M3=kE({argsMap:(o,s)=>[o.getTrackId(),s]}),U3=w_(),x3=kE({argsMap:(o,s)=>[o.getTrackId(),s]}),j3=w_(),V3=w_(),F3=kE({argsMap:(o,s,l)=>[o.getTrackId(),s,l]}),B3=w_(),G3=w_(),q3=w_(),W3=w_(),K3=w_(),H3=w_(),Y3=w_(),z3=kE({argsMap:(o,s)=>[o.getTrackId(),s.name]}),J3=kE({argsMap:o=>[o.getTrackId()]}),X3=kE({argsMap:o=>[o.getTrackId()]}),Q3=kE({argsMap:(o,s,l)=>[o.getTrackId(),s.label,l]}),oE((HE=class z6 extends QD{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==nT.PLAYING)}get processorContext(){return this._processorContext}set processorContext(s){this._processorContext=s}get __className__(){return"LocalVideoTrack"}constructor(s,l,p,_,b,A){if(super(s,b),_t(this,"trackMediaType","video"),_t(this,"_player",void 0),_t(this,"_videoVisibleTimer",null),_t(this,"_previousVideoVisibleStatus",void 0),_t(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),_t(this,"_encoderConfig",void 0),_t(this,"_scalabiltyMode",{numSpatialLayers:1,numTemporalLayers:1}),_t(this,"_optimizationMode",void 0),_t(this,"_videoHeight",void 0),_t(this,"_videoWidth",void 0),_t(this,"_forceBitrateLimit",void 0),_t(this,"_enabled",!0),_t(this,"processorDestination",void 0),_t(this,"_processorContext",void 0),fT()){const{width:k,height:j}=s.getSettings();this._videoWidth=k,this._videoHeight=j}else this.updateMediaStreamTrackResolution();this._encoderConfig=l,this._scalabiltyMode=p,this._optimizationMode=_,this._hints=A||[],this._hints.indexOf(J_.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile(),l&&this._hints.indexOf(J_.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(l),this.processorContext=new HV(this.getTrackId(),"local"),this.processorDestination=new KV(this.processorContext),this.bindProcessorDestinationEvents()}play(s){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof s=="string"){const _=document.getElementById(s);_?s=_:(_n.warning("[".concat(this.getTrackId(),'] can not find "#').concat(s,'" element, use document.body')),s=document.body)}_n.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(s instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(l));const p=m0(m0(m0({},this._getDefaultPlayerConfig()),l),{},{trackId:this.getTrackId(),element:s});this._player?this._player.updateConfig(p):(s instanceof HTMLVideoElement?this._player=new EL(p):this._player=new O3(p),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const _=this.getVideoElementVisibleStatus();this.safeEmit(fR.VIDEO_ELEMENT_VISIBLE_STATUS,_)}catch{}},_u("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,_n.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(s,l){if(!l){if(s===this._enabled)return;this.stateCheck("enabled",s)}if(_n.info("[".concat(this.getTrackId(),"] start setEnabled"),s),!s){this._originMediaStreamTrack.enabled=!1;try{await C_(this,UE.NEED_DISABLE_TRACK,this)}catch(p){throw _n.error("[".concat(this.getTrackId(),"] setEnabled to false error"),p.toString()),p}return l||(this._enabled=!1),void _n.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await C_(this,UE.NEED_ENABLE_TRACK,this)}catch(p){throw _n.error("[".concat(this.getTrackId(),"] setEnabled to true error"),p.toString()),p}_n.info("[".concat(this.getTrackId(),"] setEnabled to true success")),l||(this._enabled=!0)}async setMuted(s){s!==this._muted&&(this.stateCheck("muted",s),this._muted=s,this._originMediaStreamTrack.enabled=!s,_n.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(s)),s?await C_(this,UE.NEED_MUTE_TRACK,this):await C_(this,UE.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(s,l){if(!this._enabled)throw new ga(Di.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(s=VR(s),this._forceBitrateLimit&&(s.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:s.bitrateMax,s.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:s.bitrateMin),s.width||s.height||s.frameRate){const p=YO({encoderConfig:s});(fT()||ET()||LS())&&(p.deviceId=void 0),_n.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(s),JSON.stringify(p));try{await this._originMediaStreamTrack.applyConstraints(p),this.updateMediaStreamTrackResolution()}catch(_){const b=new ga(Di.UNEXPECTED_ERROR,_.toString());throw _n.error("[".concat(this.getTrackId(),"] applyConstraints error"),b.toString()),b}}this._encoderConfig=s,this._hints.indexOf(J_.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await C_(this,UE.NEED_UPDATE_VIDEO_ENCODER,this)}catch(p){return p.throw()}}getStats(){return h0(()=>{_n.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),fS(this,UE.GET_STATS)||m0({},UD)}async setBeautyEffect(s){_n.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(s){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(s,l):await fL(s)}clone(s,l,p,_){const b=this._mediaStreamTrack.clone();return new z6(b,s,l,p,_)}async setBitrateLimit(s){if(_n.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(s))),s){this._forceBitrateLimit=s,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<s.max_bitrate?this._encoderConfig.bitrateMax:s.max_bitrate:this._encoderConfig.bitrateMax=s.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=s.min_bitrate);try{await C_(this,UE.NEED_UPDATE_VIDEO_ENCODER,this)}catch(l){return l.throw()}}}async setOptimizationMode(s){if(s!=="motion"&&s!=="detail"&&s!=="balanced")return void _n.error(Di.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const l=this._optimizationMode;try{this._optimizationMode=s,await C_(this,UE.SET_OPTIMIZATION_MODE,this)}catch(p){throw this._optimizationMode=l,_n.error("[".concat(this.getTrackId(),"] set optimization mode failed"),p.toString()),p}_n.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(s,")"))}setScalabiltyMode(s){if(s.numSpatialLayers===1&&s.numTemporalLayers!==1)return _n.error(Di.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=s,_n.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(s,")"))}updateMediaStreamTrackResolution(){GF(this._originMediaStreamTrack).then(s=>{let[l,p]=s;this._videoHeight=p,this._videoWidth=l}).catch(GO)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:s,height:l,frameRate:p}=this.getMediaStreamTrackSettings();if(!s||!l||!p)return;const[_,b]=function(A,k,j){const z=_u("BITRATE_ADAPTER_TYPE");let H;const $=200*Math.pow(j/15,.6)*Math.pow(A*k/640/360,.75),ue=$;if(z==="STANDARD_BITRATE")H=4*$;else{if(z!=="COMPATIABLE_BITRATE")return;H=2*$}return[Math.floor(H),Math.floor(ue)]}(s,l,p)||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=b,this._encoderConfig.bitrateMax=_,_n.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(s,", h: ").concat(l,", fps: ").concat(p,"] => [brMax: ").concat(_,", brMin: ").concat(b,"]")))}getVideoElementVisibleStatus(){try{var s,l;const p=this==null||(s=this._player)===null||s===void 0?void 0:s.getContainerElement(),_={track:this,element:this==null||(l=this._player)===null||l===void 0?void 0:l.getVideoElement(),slot:p==null?void 0:p.parentElement},{element:b,slot:A}=_;if(this.isPlaying&&b instanceof HTMLVideoElement&&A instanceof HTMLElement){const k=oG.checkOneElementVisible(b),j=Object.assign({},k);if(j.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=j.visible;const z=wE.reportApiInvoke(null,{tag:T_.TRACER,name:j_.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});j.visible?z.onSuccess("Video is visible"):z.onSuccess("Invisible because of ".concat(j.reason))}return j}return}catch(p){throw new ga(Di.GET_VIDEO_ELEMENT_VISIBLE_ERROR,p.message)}}async renewMediaStreamTrack(s){}pipe(s){if(this.processor===s)return s;if(s._source)throw new ga(Di.INVALID_OPERATION,"Processor ".concat(s.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=s,this.processor._source=this,s.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),s}unpipe(){if(!this.processor)return;const s=this.processor;this.processor._source=void 0,this.processor=void 0,s.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}async replaceTrack(s,l){if(!(s instanceof MediaStreamTrack))throw new ga(Di.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(s.kind!=="video")throw new ga(Di.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(s,l,!0),this.updateMediaStreamTrackResolution()}bindProcessorDestinationEvents(){this.processorDestination.on(oT.ON_TRACK,async s=>{s?s!==this._mediaStreamTrack&&(this._mediaStreamTrack=s,this._updatePlayerSource(),await C_(this,UE.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await C_(this,UE.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(oT.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(AT.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(AT.REQUEST_CONSTRAINTS)}}).prototype,"play",[w3,C3],Object.getOwnPropertyDescriptor(HE.prototype,"play"),HE.prototype),oE(HE.prototype,"stop",[N3],Object.getOwnPropertyDescriptor(HE.prototype,"stop"),HE.prototype),oE(HE.prototype,"setEnabled",[P3,D3,k3],Object.getOwnPropertyDescriptor(HE.prototype,"setEnabled"),HE.prototype),oE(HE.prototype,"setMuted",[L3,M3,U3],Object.getOwnPropertyDescriptor(HE.prototype,"setMuted"),HE.prototype),oE(HE.prototype,"setEncoderConfiguration",[x3,j3],Object.getOwnPropertyDescriptor(HE.prototype,"setEncoderConfiguration"),HE.prototype),oE(HE.prototype,"getStats",[V3],Object.getOwnPropertyDescriptor(HE.prototype,"getStats"),HE.prototype),oE(HE.prototype,"setBeautyEffect",[F3,B3],Object.getOwnPropertyDescriptor(HE.prototype,"setBeautyEffect"),HE.prototype),oE(HE.prototype,"getCurrentFrameData",[G3],Object.getOwnPropertyDescriptor(HE.prototype,"getCurrentFrameData"),HE.prototype),oE(HE.prototype,"getCurrentFrameImage",[q3],Object.getOwnPropertyDescriptor(HE.prototype,"getCurrentFrameImage"),HE.prototype),oE(HE.prototype,"setBitrateLimit",[W3],Object.getOwnPropertyDescriptor(HE.prototype,"setBitrateLimit"),HE.prototype),oE(HE.prototype,"setOptimizationMode",[K3],Object.getOwnPropertyDescriptor(HE.prototype,"setOptimizationMode"),HE.prototype),oE(HE.prototype,"setScalabiltyMode",[H3],Object.getOwnPropertyDescriptor(HE.prototype,"setScalabiltyMode"),HE.prototype),oE(HE.prototype,"updateMediaStreamTrackResolution",[Y3],Object.getOwnPropertyDescriptor(HE.prototype,"updateMediaStreamTrackResolution"),HE.prototype),oE(HE.prototype,"pipe",[z3],Object.getOwnPropertyDescriptor(HE.prototype,"pipe"),HE.prototype),oE(HE.prototype,"unpipe",[J3],Object.getOwnPropertyDescriptor(HE.prototype,"unpipe"),HE.prototype),oE(HE.prototype,"close",[X3],Object.getOwnPropertyDescriptor(HE.prototype,"close"),HE.prototype),oE(HE.prototype,"replaceTrack",[Q3],Object.getOwnPropertyDescriptor(HE.prototype,"replaceTrack"),HE.prototype),HE),aG=($3=kE({argsMap:(o,s)=>[o.getTrackId(),s]}),Z3=w_(),_B=AI("CameraVideoTrack","_enabledMutex"),tG=kE({argsMap:(o,s)=>[o.getTrackId(),s]}),eG=w_(),nG=kE({argsMap:(o,s)=>[o.getTrackId(),s]}),rG=w_(),iG=kE({argsMap:o=>[o.getTrackId()]}),oE((rS=class extends G_{get __className__(){return"CameraVideoTrack"}constructor(o,s,l,p,_,b){super(o,VR(s.encoderConfig),p,_,b),_t(this,"_config",void 0),_t(this,"_originalConstraints",void 0),_t(this,"_constraints",void 0),_t(this,"_enabled",!0),_t(this,"_deviceName","default"),_t(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(fI()||FP())&&!function(){const A=r_();if(A.os!==tT.IOS||!A.osVersion)return!1;const k=A.osVersion.split(".");return Number(k[0])===15&&Number(k[1])>=2}()&&u2()&&this._enabled&&!this._isClosed&&(_n.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=l,this._constraints=l,this._deviceName=o.label,this._encoderConfig=VR(this._config.encoderConfig),o_.on(Z_.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),o_.on(Z_.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(o){if(_n.info("[".concat(this.getTrackId(),"] set device to ").concat(o)),this._enabled)try{const s=await YT.getDeviceById(o),l={};l.video=m0({},this._constraints),l.video.deviceId={exact:o},l.video.facingMode=void 0,this._originMediaStreamTrack.stop();let p=null;try{p=await pS(l,this.getTrackId())}catch(_){throw _n.error("[".concat(this.getTrackId(),"] setDevice failed"),_.toString()),p=await pS({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(p.getVideoTracks()[0],!1),_}await this._updateOriginMediaStreamTrack(p.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=o,this._constraints.deviceId={exact:o}}catch(s){throw _n.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await YT.getDeviceById(o);this._deviceName=s.label,this._config.cameraId=o,this._constraints.deviceId={exact:o}}catch(s){throw _n.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}_n.info("[".concat(this.getTrackId(),"] setDevice success"))}async setEnabled(o,s){if(!s){if(o===this._enabled)return;this.stateCheck("enabled",o)}if(_n.info("[".concat(this.getTrackId(),"] start setEnabled"),o),o){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const l=await pS({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(l.getVideoTracks()[0],!1)}await C_(this,UE.NEED_ENABLE_TRACK,this)}catch(l){throw _n.error("[".concat(this.getTrackId(),"] setEnabled true error"),l.toString()),l}this.updateMediaStreamTrackResolution(),_n.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await C_(this,UE.NEED_DISABLE_TRACK,this)}catch(l){throw _n.error("[".concat(this.getTrackId(),"] setEnabled to false error"),l.toString()),l}_n.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(o,s){if(!this._enabled)throw new ga(Di.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");o=VR(o),this._forceBitrateLimit&&(o.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:o.bitrateMax,o.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:o.bitrateMin);const l=B_(this._config);l.encoderConfig=o;const p=YO(l);(fT()||ET()||LS())&&(p.deviceId=void 0),_n.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(o),JSON.stringify(p));try{await this._originMediaStreamTrack.applyConstraints(p),this.updateMediaStreamTrackResolution()}catch(_){const b=new ga(Di.UNEXPECTED_ERROR,_.toString());throw _n.error("[".concat(this.getTrackId(),"] applyConstraints error"),b.toString()),b}this._config=l,this._constraints=p,this._originalConstraints=p,this._encoderConfig=o,this._hints.indexOf(J_.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await C_(this,UE.NEED_UPDATE_VIDEO_ENCODER,this)}catch(_){return _.throw()}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ET()||LS())&&this._enabled&&!this._isClosed&&o_.duringInterruption){const o=async()=>{o_.off(Z_.IOS_INTERRUPTION_END,o),this._enabled&&!this._isClosed&&(_n.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};o_.on(Z_.IOS_INTERRUPTION_END,o)}else _n.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(fR.TRACK_ENDED)}async renewMediaStreamTrack(o){const s=o||this._constraints,l=YT.searchDeviceIdByName(this._deviceName);if(l&&!s.deviceId&&(s.deviceId={exact:l}),this._enabled){const p=await pS({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(p.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),o_.off(Z_.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),o_.off(Z_.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}bindProcessorContextEvents(){this.processorContext.on(AT.REQUEST_UPDATE_CONSTRAINTS,async(o,s,l)=>{try{const p=Object.assign({},this._originalConstraints,...o);await this.renewMediaStreamTrack(p),s()}catch(p){l(p)}}),this.processorContext.on(AT.REQUEST_CONSTRAINTS,async o=>{o(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[$3,Z3],Object.getOwnPropertyDescriptor(rS.prototype,"setDevice"),rS.prototype),oE(rS.prototype,"setEnabled",[_B,tG,eG],Object.getOwnPropertyDescriptor(rS.prototype,"setEnabled"),rS.prototype),oE(rS.prototype,"setEncoderConfiguration",[nG,rG],Object.getOwnPropertyDescriptor(rS.prototype,"setEncoderConfiguration"),rS.prototype),oE(rS.prototype,"close",[iG],Object.getOwnPropertyDescriptor(rS.prototype,"close"),rS.prototype),rS);class mL{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}constructor(s,l){_t(this,"uid",void 0),_t(this,"_uintid",void 0),_t(this,"_trust_in_room_",!0),_t(this,"_trust_audio_enabled_state_",!0),_t(this,"_trust_video_enabled_state_",!0),_t(this,"_trust_audio_mute_state_",!0),_t(this,"_trust_video_mute_state_",!0),_t(this,"_audio_muted_",!1),_t(this,"_video_muted_",!1),_t(this,"_audio_enabled_",!0),_t(this,"_video_enabled_",!0),_t(this,"_audio_added_",!1),_t(this,"_video_added_",!1),_t(this,"_trust_video_stream_added_state_",!0),_t(this,"_trust_audio_stream_added_state_",!0),_t(this,"_audioTrack",void 0),_t(this,"_videoTrack",void 0),_t(this,"_audioSSRC",void 0),_t(this,"_videoSSRC",void 0),_t(this,"_audioOrtc",void 0),_t(this,"_videoOrtc",void 0),_t(this,"_cname",void 0),_t(this,"_rtxSsrcId",void 0),this.uid=s,this._uintid=l}}var HX=TU,YX=uI,zX=iO;yT({target:"Promise",stat:!0},{try:function(o){var s=YX.f(this),l=zX(o);return(l.error?s.reject:s.resolve)(l.value),s.promise}});var _L=HX,JX=yT,XX=_a,QX=f,$X=l0,ZX=uS,tQ=iR,eQ=oR,cG=SD,nQ=_V,rQ=SV,iQ=eI,uG=Mb("isConcatSpreadable"),dG=9007199254740991,lG="Maximum allowed index exceeded",hG=XX.TypeError,oQ=iQ>=51||!QX(function(){var o=[];return o[uG]=!1,o.concat()[0]!==o}),sQ=rQ("concat"),aQ=function(o){if(!ZX(o))return!1;var s=o[uG];return s!==void 0?!!s:$X(o)};JX({target:"Array",proto:!0,forced:!oQ||!sQ},{concat:function(o){var s,l,p,_,b,A=tQ(this),k=nQ(A,0),j=0;for(s=-1,p=arguments.length;s<p;s++)if(aQ(b=s===-1?A:arguments[s])){if(j+(_=eQ(b))>dG)throw hG(lG);for(l=0;l<_;l++,j++)l in b&&cG(k,j,b[l])}else{if(j>=dG)throw hG(lG);cG(k,j++,b)}return k.length=j,k}});var pG={},cQ=PE,uQ=nR,fG=F0.f,dQ=K2,EG=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];pG.f=function(o){return EG&&cQ(o)=="Window"?function(s){try{return fG(s)}catch{return dQ(EG)}}(o):fG(uQ(o))};var _0={},lQ=Mb;_0.f=lQ;var mG=rR,hQ=DT,pQ=_0,fQ=yS.f,_y=function(o){var s=mG.Symbol||(mG.Symbol={});hQ(s,o)||fQ(s,o,{value:pQ.f(o)})},UI=yT,gL=_a,EQ=PS,mQ=rE,g0=Qm,_Q=_r,xI=gE,XR=EN,vL=f,uT=DT,gQ=l0,vQ=aE,yQ=uS,bQ=_e,yL=mN,bL=bS,TQ=iR,JO=nR,TL=L0,_G=oI,SL=cE,v0=W0,gG=xN,SQ=F0,vG=pG,RL=MN,yG=yE,bG=yS,RQ=UN,TG=tE,IQ=eP,IL=tO,y0=k0.exports,SG=B0,RG=TN,IG=Mb,OQ=_0,AQ=_y,wQ=QI,OG=Z0,XO=vV.forEach,zT=V0("hidden"),QO="Symbol",AG=IG("toPrimitive"),CQ=OG.set,wG=OG.getterFor(QO),wS=Object.prototype,gR=gL.Symbol,QR=gR&&gR.prototype,CG=gL.TypeError,OL=gL.QObject,b0=EQ("JSON","stringify"),NG=yG.f,vR=bG.f,PG=vG.f,NQ=TG.f,DG=_Q([].push),tR=y0("symbols"),T0=y0("op-symbols"),AL=y0("string-to-symbol-registry"),wL=y0("symbol-to-string-registry"),PQ=y0("wks"),CL=!OL||!OL.prototype||!OL.prototype.findChild,NL=xI&&vL(function(){return v0(vR({},"a",{get:function(){return vR(this,"a",{value:7}).a}})).a!=7})?function(o,s,l){var p=NG(wS,s);p&&delete wS[s],vR(o,s,l),p&&o!==wS&&vR(wS,s,p)}:vR,PL=function(o,s){var l=tR[o]=v0(QR);return CQ(l,{type:QO,tag:o,description:s}),xI||(l.description=s),l},$O=function(o,s,l){o===wS&&$O(T0,s,l),bL(o);var p=TL(s);return bL(l),uT(tR,p)?(l.enumerable?(uT(o,zT)&&o[zT][p]&&(o[zT][p]=!1),l=v0(l,{enumerable:SL(0,!1)})):(uT(o,zT)||vR(o,zT,SL(1,{})),o[zT][p]=!0),NL(o,p,l)):vR(o,p,l)},DL=function(o,s){bL(o);var l=JO(s),p=gG(l).concat(kL(l));return XO(p,function(_){xI&&!g0(kG,l,_)||$O(o,_,l[_])}),o},kG=function(o){var s=TL(o),l=g0(NQ,this,s);return!(this===wS&&uT(tR,s)&&!uT(T0,s))&&(!(l||!uT(this,s)||!uT(tR,s)||uT(this,zT)&&this[zT][s])||l)},LG=function(o,s){var l=JO(o),p=TL(s);if(l!==wS||!uT(tR,p)||uT(T0,p)){var _=NG(l,p);return!_||!uT(tR,p)||uT(l,zT)&&l[zT][p]||(_.enumerable=!0),_}},MG=function(o){var s=PG(JO(o)),l=[];return XO(s,function(p){uT(tR,p)||uT(SG,p)||DG(l,p)}),l},kL=function(o){var s=o===wS,l=PG(s?T0:JO(o)),p=[];return XO(l,function(_){!uT(tR,_)||s&&!uT(wS,_)||DG(p,tR[_])}),p};if(XR||(IL(QR=(gR=function(){if(bQ(QR,this))throw CG("Symbol is not a constructor");var o=arguments.length&&arguments[0]!==void 0?_G(arguments[0]):void 0,s=RG(o),l=function(p){this===wS&&g0(l,T0,p),uT(this,zT)&&uT(this[zT],s)&&(this[zT][s]=!1),NL(this,s,SL(1,p))};return xI&&CL&&NL(wS,s,{configurable:!0,set:l}),PL(s,o)}).prototype,"toString",function(){return wG(this).tag}),IL(gR,"withoutSetter",function(o){return PL(RG(o),o)}),TG.f=kG,bG.f=$O,RQ.f=DL,yG.f=LG,SQ.f=vG.f=MG,RL.f=kL,OQ.f=function(o){return PL(IG(o),o)},xI&&vR(QR,"description",{configurable:!0,get:function(){return wG(this).description}})),UI({global:!0,wrap:!0,forced:!XR,sham:!XR},{Symbol:gR}),XO(gG(PQ),function(o){AQ(o)}),UI({target:QO,stat:!0,forced:!XR},{for:function(o){var s=_G(o);if(uT(AL,s))return AL[s];var l=gR(s);return AL[s]=l,wL[l]=s,l},keyFor:function(o){if(!yL(o))throw CG(o+" is not a symbol");if(uT(wL,o))return wL[o]},useSetter:function(){CL=!0},useSimple:function(){CL=!1}}),UI({target:"Object",stat:!0,forced:!XR,sham:!xI},{create:function(o,s){return s===void 0?v0(o):DL(v0(o),s)},defineProperty:$O,defineProperties:DL,getOwnPropertyDescriptor:LG}),UI({target:"Object",stat:!0,forced:!XR},{getOwnPropertyNames:MG,getOwnPropertySymbols:kL}),UI({target:"Object",stat:!0,forced:vL(function(){RL.f(1)})},{getOwnPropertySymbols:function(o){return RL.f(TQ(o))}}),b0&&UI({target:"JSON",stat:!0,forced:!XR||vL(function(){var o=gR();return b0([o])!="[null]"||b0({a:o})!="{}"||b0(Object(o))!="{}"})},{stringify:function(o,s,l){var p=IQ(arguments),_=s;if((yQ(s)||o!==void 0)&&!yL(o))return gQ(s)||(s=function(b,A){if(vQ(_)&&(A=g0(_,this,b,A)),!yL(A))return A}),p[1]=s,mQ(b0,null,p)}}),!QR[AG]){var DQ=QR.valueOf;IL(QR,AG,function(o){return g0(DQ,this)})}wQ(gR,QO),SG[zT]=!0,_y("asyncIterator"),_y("hasInstance"),_y("isConcatSpreadable"),_y("iterator"),_y("match"),_y("matchAll"),_y("replace"),_y("search"),_y("species"),_y("split"),_y("toPrimitive"),_y("toStringTag"),_y("unscopables"),QI(_a.JSON,"JSON",!0);var kQ=rR.Symbol;_y("asyncDispose"),_y("dispose"),_y("matcher"),_y("metadata"),_y("observable"),_y("patternMatch"),_y("replaceAll");var UG=kQ,xG=_0.f("asyncIterator"),LQ=xG;function jG(o){this.wrapped=o}function S0(o){var s,l;function p(b,A){try{var k=o[b](A),j=k.value,z=j instanceof jG;_L.resolve(z?j.wrapped:j).then(function(H){z?p(b==="return"?"return":"next",H):_(k.done?"return":"normal",H)},function(H){p("throw",H)})}catch(H){_("throw",H)}}function _(b,A){switch(b){case"return":s.resolve({value:A,done:!0});break;case"throw":s.reject(A);break;default:s.resolve({value:A,done:!1})}(s=s.next)?p(s.key,s.arg):l=null}this._invoke=function(b,A){return new _L(function(k,j){var z={key:b,arg:A,resolve:k,reject:j,next:null};l?l=l.next=z:(s=l=z,p(b,A))})},typeof o.return!="function"&&(this.return=void 0)}function ES(o){return function(){return new S0(o.apply(this,arguments))}}function YE(o){return new jG(o)}S0.prototype[typeof UG=="function"&&LQ||"@@asyncIterator"]=function(){return this},S0.prototype.next=function(o){return this._invoke("next",o)},S0.prototype.throw=function(o){return this._invoke("throw",o)},S0.prototype.return=function(o){return this._invoke("return",o)};var MQ=_0.f("iterator");function ZO(o,s){var l={},p=!1;function _(b,A){return p=!0,A=new _L(function(k){k(o[b](A))}),{done:!1,value:s(A)}}return l[UG!==void 0&&MQ||"@@iterator"]=function(){return this},l.next=function(b){return p?(p=!1,b):_("next",b)},typeof o.throw=="function"&&(l.throw=function(b){if(p)throw p=!1,b;return _("throw",b)}),typeof o.return=="function"&&(l.return=function(b){return p?(p=!1,b):_("return",b)}),l}var VG=xG,q_={exports:{}};function FG(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function BG(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?FG(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):FG(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}function LL(o,s,l,p,_,b,A){let k=[],j=[],z=[],H=[],$=!1,ue=!1;if(q_.exports.parse(o).mediaDescriptions.forEach(Ei=>{A&&A!==Ei.attributes.direction||(Ei.media.mediaType!=="video"||$||(j=Ei.attributes.payloads,H=Ei.attributes.extmaps,$=!0),Ei.media.mediaType!=="audio"||ue||(k=Ei.attributes.payloads,z=Ei.attributes.extmaps,ue=!0))}),!H||j.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!z||k.length===0)throw new Error("Cannot get audio capabilities from SDP.");return j.forEach(Ei=>{var Fi;(Fi=Ei.rtpMap)!==null&&Fi!==void 0&&Fi.clockRate&&(Ei.rtpMap.clockRate=parseInt(Ei.rtpMap.clockRate))}),k.forEach(Ei=>{var Fi;(Fi=Ei.rtpMap)!==null&&Fi!==void 0&&Fi.clockRate&&(Ei.rtpMap.clockRate=parseInt(Ei.rtpMap.clockRate))}),s&&(k=k.filter(Ei=>{var Fi;return((Fi=Ei.rtpMap)===null||Fi===void 0?void 0:Fi.encodingName.toLowerCase())!=="rtx"}),j=j.filter(Ei=>{var Fi;return((Fi=Ei.rtpMap)===null||Fi===void 0?void 0:Fi.encodingName.toLowerCase())!=="rtx"})),l&&(j=j.filter(Ei=>{var Fi;return!/(red)|(ulpfec)|(flexfec)/i.test(((Fi=Ei.rtpMap)===null||Fi===void 0?void 0:Fi.encodingName)||"")})),p&&(k=k.filter(Ei=>{var Fi;return!/(red)|(ulpfec)|(flexfec)/i.test(((Fi=Ei.rtpMap)===null||Fi===void 0?void 0:Fi.encodingName)||"")})),_&&(_==null?void 0:_.length)>0&&(k=k.filter(Ei=>{var Fi;return _.includes(((Fi=Ei.rtpMap)===null||Fi===void 0?void 0:Fi.encodingName.toLowerCase())||"")})),b&&(b==null?void 0:b.length)>0&&(j=j.filter(Ei=>{var Fi;return b.includes(((Fi=Ei.rtpMap)===null||Fi===void 0?void 0:Fi.encodingName.toLowerCase())||"")})),{audioCodecs:k,videoCodecs:j,audioExtensions:z,videoExtensions:H}}function $R(o){const s=q_.exports.parse(o);let l,p;for(const _ of s.mediaDescriptions){if(!l){const b=_.attributes.iceUfrag,A=_.attributes.icePwd;if(!b||!A)throw new Error("Cannot get iceUfrag or icePwd from SDP.");l={iceUfrag:b,icePwd:A}}if(!p){const b=_.attributes.fingerprints;b.length>0&&(p={fingerprints:b})}}if(!p&&s.attributes.fingerprints.length>0&&(p={fingerprints:s.attributes.fingerprints}),!p||!l)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:l,dtlsParameters:p}}function GG(o,s){const l=[],p=o.attributes.ssrcGroups.filter(A=>A.semantic==="FID"),_=o.attributes.ssrcGroups.find(A=>A.semantic==="SIM"),b=o.attributes.ssrcs;if(_)_.ssrcIds.forEach(A=>{var k;const j=(k=p.find(z=>z.ssrcIds[0]===A))===null||k===void 0?void 0:k.ssrcIds[1];l.push({ssrcId:A,rtx:s?j:void 0})});else if(p.length>0){const A=p[0].ssrcIds[0],k=p[0].ssrcIds[1];l.push({ssrcId:A,rtx:s?k:void 0})}else{if(b.length===0)throw new Error("No ssrcs found on local media description.");l.push({ssrcId:b[0].ssrcId})}return l}function qG(o,s){const{cname:l}=o;let p;s&&s.ip&&typeof s.port=="number"?(p=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:s.ip,port:s.port.toString(),type:"host",extension:{}}],_n.debug("Using remote candidate from AP ".concat(s.ip,":").concat(s.port)),s.ip6&&(p.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:s.ip6,port:s.port.toString(),type:"host",extension:{}}),_n.debug("Using IPV6 remote candidate from AP ".concat(s.ip6,":").concat(s.port)))):p=o.iceParameters.candidates.map(k=>({foundation:k.foundation,componentId:"1",transport:k.protocol,priority:k.priority.toString(),connectionAddress:k.ip,port:k.port.toString(),type:k.type,extension:{}}));const _={fingerprints:o.dtlsParameters.fingerprints.map(k=>({hashFunction:k.algorithm,fingerprint:k.fingerprint}))},b={iceUfrag:o.iceParameters.iceUfrag,icePwd:o.iceParameters.icePwd};let A;switch(o.dtlsParameters.role){case"server":A="passive";break;case"client":A="active";break;case"auto":A="actpass"}return{dtlsParameters:_,iceParameters:b,candidates:p,rtpCapabilities:xL(o.rtpCapabilities),setup:A,cname:l}}function iS(o,s,l){const p=[],_=[];return o.forEach(b=>{let{ssrcId:A,rtx:k}=b;const j=y_(8,"track-"),z={ssrcId:A,attributes:BG({label:j,mslabel:l=l||y_(10,""),msid:"".concat(l," ").concat(j)},s&&{cname:s})};if(p.push(z),k!==void 0){const H={ssrcId:k,attributes:BG({label:j,mslabel:l,msid:"".concat(l," ").concat(j)},s&&{cname:s})};p.push(H),_.push({semantic:"FID",ssrcIds:[A,k]})}}),o.length>1&&_.push({semantic:"SIM",ssrcIds:o.map(b=>{let{ssrcId:A}=b;return A})}),{ssrcs:p,ssrcGroups:_}}function jI(o,s){s instanceof sT&&o.attributes.payloads.forEach(l=>{var p;const _=(p=l.rtpMap)===null||p===void 0?void 0:p.encodingName.toLowerCase();if(!_||["opus","pcmu","pcma","g722"].indexOf(_)===-1)return;l.fmtp||(l.fmtp={parameters:{}}),l.fmtp.parameters.minptime="10",l.fmtp.parameters.useinbandfec="1";const b=s._encoderConfig;b&&_!=="pcmu"&&_!=="pcma"&&_!=="g722"&&(b.bitrate&&!O_()&&(l.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*b.bitrate))),b.sampleRate&&(l.fmtp.parameters.maxplaybackrate="".concat(b.sampleRate),l.fmtp.parameters["sprop-maxcapturerate"]="".concat(b.sampleRate)),b.stereo&&(l.fmtp.parameters.stereo="1",l.fmtp.parameters["sprop-stereo"]="1"))})}function ML(o){const s=o.attributes.unrecognized.findIndex(l=>l.attField==="x-google-flag"&&l.attValue==="conference");s!==-1&&o.attributes.unrecognized.splice(s,1)}function UL(o,s){if(!(s instanceof G_&&s._encoderConfig&&s._hints.indexOf(J_.SCREEN_TRACK)===-1))return;const l=s._encoderConfig;L_().supportMinBitrate&&l.bitrateMin&&o.attributes.payloads.forEach(p=>{var _;["h264","h265","vp8","vp9","av1"].includes(((_=p.rtpMap)===null||_===void 0?void 0:_.encodingName.toLowerCase())||"")&&(p.fmtp||(p.fmtp={parameters:{}}),p.fmtp.parameters["x-google-min-bitrate"]="".concat(l.bitrateMin))}),L_().supportMinBitrate&&!s._hints.includes(J_.LOW_STREAM)&&l.bitrateMax&&o.attributes.payloads.forEach(p=>{var _;["h264","h265","vp8","vp9","av1"].includes(((_=p.rtpMap)===null||_===void 0?void 0:_.encodingName.toLowerCase())||"")&&(p.fmtp||(p.fmtp={parameters:{}}),p.fmtp.parameters["x-google-start-bitrate"]="".concat(_u("X_GOOGLE_START_BITRATE")||Math.floor(l.bitrateMax)))})}function WG(o){if(o.media.mediaType!=="video")return;const s=r_();if(s.name!==c_.SAFARI&&s.os!==tT.IOS)return;const l=o.attributes.extmaps.findIndex(p=>/video-orientation/g.test(p.extensionName));l!==-1&&o.attributes.extmaps.splice(l,1)}function _A(o,s,l){if(!s)return;let p,_;if(o.media.mediaType==="video"?(p=l.videoExtensions,_=l.videoCodecs):(p=l.audioExtensions,_=l.audioCodecs),s.twcc===!0){const b=p.find(A=>A.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");b&&(o.attributes.extmaps.find(A=>A.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||o.attributes.extmaps.push({entry:b.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(A,k){return k.filter(j=>!!A.find(z=>z.payloadType===j.payloadType&&!!z.rtcpFeedbacks.find(H=>H.type==="transport-cc")))}(_,o.attributes.payloads).forEach(A=>{A.rtcpFeedbacks.find(k=>k.type==="transport-cc")||A.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(s.twcc===!1){const b=o.attributes.extmaps.findIndex(A=>A.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");b!==-1&&o.attributes.extmaps.splice(b,1),o.attributes.payloads.forEach(A=>{const k=A.rtcpFeedbacks.findIndex(j=>j.type==="transport-cc");k!==-1&&A.rtcpFeedbacks.splice(k,1)})}if(s.remb===!0){const b=p.find(A=>A.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");b&&(o.attributes.extmaps.find(A=>A.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||o.attributes.extmaps.push({entry:b.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(A,k){return k.filter(j=>!!A.find(z=>z.payloadType===j.payloadType&&!!z.rtcpFeedbacks.find(H=>H.type==="goog-remb")))}(_,o.attributes.payloads).forEach(A=>{A.rtcpFeedbacks.find(k=>k.type==="goog-remb")||A.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(s.remb===!1){const b=o.attributes.extmaps.findIndex(A=>A.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");b!==-1&&o.attributes.extmaps.splice(b,1),o.attributes.payloads.forEach(A=>{const k=A.rtcpFeedbacks.findIndex(j=>j.type==="goog-remb");k!==-1&&A.rtcpFeedbacks.splice(k,1)})}}function KG(o,s,l){if(O_()||o.media.mediaType!=="video"||!(s instanceof G_)||l!=="vp9"&&l!=="vp8"||l==="vp8"&&!_u("SIMULCAST")||s._scalabiltyMode===void 0||s._scalabiltyMode.numSpatialLayers<=1)return;const p=l==="vp8"?2:s._scalabiltyMode.numSpatialLayers,_=o.attributes.ssrcs[0],b=o.attributes.ssrcGroups.find(k=>k.semantic==="FID"&&k.ssrcIds[0]===_.ssrcId),A={semantic:"SIM",ssrcIds:[_.ssrcId]};for(let k=1;k<p;k++)o.attributes.ssrcs.push({ssrcId:_.ssrcId+k,attributes:B_(_.attributes)}),A.ssrcIds.push(_.ssrcId+k),b&&(o.attributes.ssrcs.push({ssrcId:b.ssrcIds[1]+k,attributes:B_(_.attributes)}),o.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[_.ssrcId+k,b.ssrcIds[1]+k]}));o.attributes.ssrcGroups.unshift(A)}async function HG(o,s,l,p,_){const b=new RTCPeerConnection;b.addTransceiver("video",{direction:"sendonly"}),b.addTransceiver("audio",{direction:"sendonly"}),b.addTransceiver("video",{direction:"recvonly"}),b.addTransceiver("audio",{direction:"recvonly"});const A=(await b.createOffer()).sdp,k=LL(A,o,s,l,p,_,"sendonly"),j=LL(A,o,s,l,p,_,"recvonly"),z={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},H={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(_w(k,j,"videoExtensions",z,H,$),_w(k,j,"videoCodecs",z,H,$),_w(k,j,"audioExtensions",z,H,$),_w(k,j,"audioCodecs",z,H,$),_u("RAISE_H264_BASELINE_PRIORITY")){const ue=$.videoCodecs.findIndex(Ei=>{var Fi,Gi;return((Fi=Ei.rtpMap)===null||Fi===void 0?void 0:Fi.encodingName.toLocaleLowerCase())==="h264"&&((Gi=Ei.fmtp)===null||Gi===void 0?void 0:Gi.parameters["profile-level-id"])==="42001f"});if(ue!==-1){const Ei=$.videoCodecs.findIndex(Fi=>{var Gi;return((Gi=Fi.rtpMap)===null||Gi===void 0?void 0:Gi.encodingName.toLocaleLowerCase())==="h264"});if(Ei<ue){_n.debug("raising H264 baseline profile priority");const Fi=$.videoCodecs[ue];$.videoCodecs.splice(ue,1),$.videoCodecs.splice(Ei,0,Fi)}Ei!==-1&&(H.videoCodecs=H.videoCodecs.filter(Fi=>{var Gi,_o;return!(((Gi=Fi.rtpMap)===null||Gi===void 0?void 0:Gi.encodingName.toLocaleLowerCase())==="h264"&&((_o=Fi.fmtp)===null||_o===void 0?void 0:_o.parameters["profile-level-id"])!=="42001f")})),Ei!==-1&&_u("FILTER_SEND_H264_BASELINE")&&(z.videoCodecs=z.videoCodecs.filter(Fi=>{var Gi,_o;return!(((Gi=Fi.rtpMap)===null||Gi===void 0?void 0:Gi.encodingName.toLocaleLowerCase())==="h264"&&((_o=Fi.fmtp)===null||_o===void 0?void 0:_o.parameters["profile-level-id"])!=="42001f")}))}}try{b.close()}catch{}return{send:z,recv:H,sendrecv:$}}function _w(o,s,l,p,_,b){if(l==="videoExtensions"||l==="audioExtensions"){const A=[];return o[l].forEach(k=>{s[l].some((j,z)=>{if(k.entry===j.entry&&k.extensionName===j.extensionName)return A.push(z),!0})?b[l].push(k):p[l].push(k)}),void s[l].forEach((k,j)=>{A.indexOf(j)===-1&&_[l].push(k)})}if(l==="videoCodecs"||l==="audioCodecs"){const A=[];return o[l].forEach(k=>{s[l].some((j,z)=>{if(k.payloadType===j.payloadType&&JSON.stringify(k)===JSON.stringify(j))return A.push(z),!0})?b[l].push(k):p[l].push(k)}),void s[l].forEach((k,j)=>{A.indexOf(j)===-1&&_[l].push(k)})}}function xL(o){const{send:s,recv:l,sendrecv:p}=o;if(!p){if(!s||!l)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:s,recv:l}}let _,b;return s?(_={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_.audioCodecs=[...s.audioCodecs,...p.audioCodecs],_.videoCodecs=[...s.videoCodecs,...p.videoCodecs],_.audioExtensions=[...s.audioExtensions,...p.audioExtensions],_.videoExtensions=[...s.videoExtensions,...p.videoExtensions]):_=p,l?(b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},b.audioCodecs=[...l.audioCodecs,...p.audioCodecs],b.videoCodecs=[...l.videoCodecs,...p.videoCodecs],b.audioExtensions=[...l.audioExtensions,...p.audioExtensions],b.videoExtensions=[...l.videoExtensions,...p.videoExtensions]):b=p,{send:_,recv:b}}function yR(o){o.media.mediaType==="audio"&&o.attributes.payloads.filter(s=>{var l;return((l=s.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())==="opus"}).forEach(s=>{s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1"})}function YG(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function zG(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?YG(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):YG(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}(function(o,s){o.exports=(()=>{var l={8:(b,A,k)=>{k.r(A),k.d(A,{Parser:()=>__,Printer:()=>NT,parse:()=>xE,print:()=>ZE});const j=`
`,z="".concat("\r").concat(j),H=" ";let $;function ue(fE){return fE>="0"&&fE<="9"}function Ei(fE){return fE>="!"&&fE<="~"}function Fi(fE){return Ei(fE)||fE>="Â"&&fE<="Ã¿"}function Gi(fE){return fE==="!"||fE>="#"&&fE<="'"||fE>="*"&&fE<="+"||fE>="-"&&fE<="."||fE>="0"&&fE<="9"||fE>="A"&&fE<="Z"||fE>="^"&&fE<="~"}function _o(fE){return fE>="1"&&fE<="9"}function _f(fE){return fE>="A"&&fE<="Z"||fE>="a"&&fE<="z"}function vf(fE){return fE==="d"||fE==="h"||fE==="m"||fE==="s"}function uE(fE){return fE>""&&fE<"	"||fE>"\v"&&fE<"\f"||fE>""&&fE<"Ã¿"}function IE(fE){return _f(fE)||ue(fE)||fE==="+"||fE==="/"}function lE(fE){return ue(fE)||_f(fE)||fE==="+"||fE==="/"||fE==="-"||fE==="_"}function hE(fE){return _f(fE)||ue(fE)||fE==="+"||fE==="/"}function sE(fE,Wt){var _s=Object.keys(fE);if(Object.getOwnPropertySymbols){var _c=Object.getOwnPropertySymbols(fE);Wt&&(_c=_c.filter(function(iE){return Object.getOwnPropertyDescriptor(fE,iE).enumerable})),_s.push.apply(_s,_c)}return _s}function mE(fE){for(var Wt=1;Wt<arguments.length;Wt++){var _s=arguments[Wt]!=null?arguments[Wt]:{};Wt%2?sE(Object(_s),!0).forEach(function(_c){n_(fE,_c,_s[_c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(fE,Object.getOwnPropertyDescriptors(_s)):sE(Object(_s)).forEach(function(_c){Object.defineProperty(fE,_c,Object.getOwnPropertyDescriptor(_s,_c))})}return fE}function n_(fE,Wt,_s){return Wt in fE?Object.defineProperty(fE,Wt,{value:_s,enumerable:!0,configurable:!0,writable:!0}):fE[Wt]=_s,fE}(function(fE){fE.VERSION="v",fE.ORIGIN="o",fE.SESSION_NAME="s",fE.INFORMATION="i",fE.URI="u",fE.EMAIL="e",fE.PHONE="p",fE.CONNECTION="c",fE.BANDWIDTH="b",fE.TIME="t",fE.REPEAT="r",fE.ZONE_ADJUSTMENTS="z",fE.KEY="k",fE.ATTRIBUTE="a",fE.MEDIA="m"})($||($={}));class DE{consumeText(Wt,_s){let _c=_s;for(;_c<Wt.length;){const iE=Wt[_c];if(iE==="\0"||iE==="\r"||iE===j)break;_c+=1}if(_c-_s==0)throw new Error("Invalid text, at ".concat(Wt));return _c}consumeUnicastAddress(Wt,_s,_c){return this.consumeTill(Wt,_s,H)}consumeOneOrMore(Wt,_s,_c){let iE=_s;for(;_c(Wt[iE]);)iE++;if(iE-_s==0)throw new Error("Invalid rule at ".concat(_s,"."));return iE}consumeSpace(Wt,_s){if(Wt[_s]===H)return _s+1;throw new Error("Invalid space at ".concat(_s,"."))}consumeIP4Address(Wt,_s){let _c=_s;for(let iE=0;iE<4;iE++)if(_c=this.consumeDecimalUChar(Wt,_c),iE!==3){if(Wt[_c]!==".")throw new Error("Invalid IP4 address.");_c++}return _c}consumeDecimalUChar(Wt,_s){let _c=_s;for(let VE=0;VE<3&&ue(Wt[_c]);VE++,_c++);if(_c-_s==0)throw new Error("Invalid decimal uchar.");const iE=parseInt(Wt.slice(_s,_c));if(iE>=0&&iE<=255)return _c;throw new Error("Invalid decimal uchar")}consumeIP6Address(Wt,_s){let _c=this.consumeHexpart(Wt,_s);return Wt[_c]===":"&&(_c+=1,_c=this.consumeIP4Address(Wt,_c)),_c}consumeHexpart(Wt,_s){let _c=_s;if(Wt[_c]===":"&&Wt[_c+1]===":"){_c+=2;try{_c=this.consumeHexseq(Wt,_c)}catch{}return _c}if(_c=this.consumeHexseq(Wt,_c),Wt[_c]===":"&&Wt[_c+1]===":"){_c+=2;try{_c=this.consumeHexseq(Wt,_c)}catch{}return _c}return _c}consumeHexseq(Wt,_s){let _c=_s;for(;_c=this.consumeHex4(Wt,_c),Wt[_c]===":"&&Wt[_c+1]!==":";)_c+=1;return _c}consumeHex4(Wt,_s){let _c=0;for(;_c<4;_c++)if(!((iE=Wt[_s+_c])>="0"&&iE<="9"||iE>="a"&&iE<="f"||iE>="A"&&iE<="F")){if(_c===0)throw new Error("Invalid hex 4");break}var iE;return _s+_c}consumeFQDN(Wt,_s){let _c=_s;for(;ue(Wt[_c])||_f(Wt[_c])||Wt[_c]==="-"||Wt[_c]===".";)_c+=1;if(_c-_s<4)throw new Error("Invalid FQDN");return _c}consumeExtnAddr(Wt,_s){return this.consumeOneOrMore(Wt,_s,Fi)}consumeMulticastAddress(Wt,_s,_c){switch(_c){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(Wt,_s);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(Wt,_s);default:try{return this.consumeFQDN(Wt,_s)}catch{return this.consumeExtnAddr(Wt,_s)}}}consumeIP6MulticastAddress(Wt,_s){const _c=this.consumeHexpart(Wt,_s);return Wt[_c]==="/"?this.consumeInteger(Wt,_c+1):_c}consumeIP4MulticastAddress(Wt,_s){let _c=_s+3;const iE=Wt.slice(_s,_c),VE=parseInt(iE);if(VE<224||VE>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let g_=0;g_<3;g_++){if(Wt[_c]!==".")throw new Error("Invalid IP4 multicast address.");_c+=1,_c=this.consumeDecimalUChar(Wt,_c)}return Wt[_c]==="/"&&(_c+=1),_c=this.consumeTTL(Wt,_c),Wt[_c]==="/"&&(_c=this.consumeInteger(Wt,_c)),_c}consumeInteger(Wt,_s){if(!_o(Wt[_s]))throw new Error("Invalid integer.");for(_s+=1;ue(Wt[_s]);)_s+=1;return _s}consumeTTL(Wt,_s){if(Wt[_s]==="0")return _s+1;if(!_o(Wt[_s]))throw new Error("Invalid TTL.");_s+=1;for(let _c=0;_c<2&&ue(Wt[_s]);_c++)_s+=1;return _s}consumeToken(Wt,_s){return this.consumeOneOrMore(Wt,_s,Gi)}consumeTime(Wt,_s){let _c=_s;if(Wt[_c]==="0")return _c+1;for(_o(Wt[_c])&&(_c+=1);ue(Wt[_c]);)_c++;if(_c-_s<10)throw new Error("Invalid time");return _c}consumeAddress(Wt,_s){return this.consumeTill(Wt,_s,H)}consumeTypedTime(Wt,_s){let _c=_s;return _c=this.consumeOneOrMore(Wt,_c,ue),vf(Wt[_c])?_c+1:_c}consumeRepeatInterval(Wt,_s){if(!_o(Wt[_s]))throw new Error("Invalid repeat interval");for(_s+=1;ue(Wt[_s]);)_s+=1;return vf(Wt[_s])&&(_s+=1),_s}consumePort(Wt,_s){return this.consumeOneOrMore(Wt,_s,ue)}consume(Wt,_s,_c){for(let iE=0;iE<_c.length;iE++){if(_s+iE>=Wt.length)throw new Error("consume exceeding value length");if(Wt[_s+iE]!==_c[iE])throw new Error("consume ".concat(_c," failed at ").concat(iE))}return _s+_c.length}consumeTill(Wt,_s,_c){let iE=_s;for(;iE<Wt.length&&(typeof _c!="string"||Wt[iE]!==_c)&&(typeof _c!="function"||!_c(Wt[iE]));)iE++;return iE}}class __ extends DE{constructor(){super(),n_(this,"records",[]),n_(this,"currentLine",0)}parse(Wt){const _s=this.probeEOL(Wt);this.records=Wt.split(_s).filter(RT=>!!RT.trim()).map(this.parseLine),this.currentLine=0;const _c=this.parseVersion(),iE=this.parseOrigin(),VE=this.parseSessionName(),g_=this.parseInformation(),Lb=this.parseUri(),vS=this.parseEmail(),OR=this.parsePhone(),cS=this.parseConnection(),AR=this.parseBandWidth(),WI=this.parseTimeFields(),N_=this.parseKey(),W_=this.parseSessionAttribute(),f_=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:_c,origin:iE,sessionName:VE,information:g_,uri:Lb,emails:vS,phones:OR,connection:cS,bandwidths:AR,timeFields:WI,key:N_,attributes:W_,mediaDescriptions:f_}}getCurrentRecord(){const Wt=this.records[this.currentLine];if(!Wt)throw new Error("Record doesn't exit.");return Wt}probeEOL(Wt){for(let _s=0;_s<Wt.length;_s++)if(Wt[_s]===j)return Wt[_s-1]==="\r"?z:j;throw new Error("Invalid newline character.")}parseLine(Wt,_s){if(Wt.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const _c=Wt[0];if(Wt[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:_c,value:Wt.slice(2),line:_s,cur:0}}parseSessionAttribute(){const Wt=new U_;for(;this.currentLine<this.records.length;){const _s=this.getCurrentRecord();if(_s.type!==$.ATTRIBUTE)break;const _c={attField:this.extractOneOrMore(_s,iE=>Gi(iE)&&iE!==":"),_cur:0};_s.value[_s.cur]===":"&&(_s.cur+=1,_c.attValue=this.extractOneOrMore(_s,uE)),Wt.parse(_c),this.currentLine++}return Wt.digest()}parseMediaAttributes(Wt){const _s=new _b(Wt);for(;this.currentLine<this.records.length;){const _c=this.getCurrentRecord();if(_c.type!==$.ATTRIBUTE)break;const iE={attField:this.extractOneOrMore(_c,VE=>Gi(VE)&&VE!==":"),_cur:0};_c.value[_c.cur]===":"&&(_c.cur+=1,iE.attValue=this.extractOneOrMore(_c,uE)),_s.parse(iE),this.currentLine++}return _s.digest()}parseKey(){const Wt=this.getCurrentRecord();if(Wt.type===$.KEY){if(Wt.value==="prompt"||Wt.value==="clear:"||Wt.value==="base64:"||Wt.value==="uri:")return Wt.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const Wt=this.getCurrentRecord();if(Wt.type===$.ZONE_ADJUSTMENTS){const _s=[];for(;;)try{const _c=this.extract(Wt,this.consumeTime);this.consumeSpaceForRecord(Wt);let iE=!1;Wt.value[Wt.cur]==="-"&&(iE=!0,Wt.cur+=1);const VE=this.extract(Wt,this.consumeTypedTime);_s.push({time:_c,typedTime:VE,back:iE})}catch{break}if(_s.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,_s}return[]}parseRepeat(){const Wt=[];for(;;){const _s=this.getCurrentRecord();if(_s.type!==$.REPEAT)break;{const _c=this.extract(_s,this.consumeRepeatInterval),iE=this.parseTypedTime(_s);Wt.push({repeatInterval:_c,typedTimes:iE}),this.currentLine++}}return Wt}parseTypedTime(Wt){const _s=[];for(;;)try{this.consumeSpaceForRecord(Wt),_s.push(this.extract(Wt,this.consumeTypedTime))}catch{break}if(_s.length===0)throw new Error("Invalid typed time.");return _s}parseTime(){const Wt=this.getCurrentRecord(),_s=this.extract(Wt,this.consumeTime);this.consumeSpaceForRecord(Wt);const _c=this.extract(Wt,this.consumeTime);return this.currentLine++,{startTime:_s,stopTime:_c}}parseBandWidth(){const Wt=[];for(;this.currentLine<this.records.length;){const _s=this.getCurrentRecord();if(_s.type!==$.BANDWIDTH)break;{const _c=this.extractOneOrMore(_s,Gi);if(_s.value[_s.cur]!==":")throw new Error("Invalid bandwidth field.");_s.cur++;const iE=this.extractOneOrMore(_s,ue);Wt.push({bwtype:_c,bandwidth:iE}),this.currentLine++}}return Wt}parseVersion(){const Wt=this.getCurrentRecord();if(Wt.type!==$.VERSION)throw new Error("first sdp record must be version");const _s=Wt.value.slice(0,this.consumeOneOrMore(Wt.value,0,ue));if(_s.length!==Wt.value.length)throw new Error('invalid proto version, "v='.concat(Wt.value,'"'));return this.currentLine++,_s}parseOrigin(){const Wt=this.getCurrentRecord();if(Wt.type!==$.ORIGIN)throw new Error("second line of sdp must be origin");const _s=this.extractOneOrMore(Wt,Fi);this.consumeSpaceForRecord(Wt);const _c=this.extractOneOrMore(Wt,ue);this.consumeSpaceForRecord(Wt);const iE=this.extractOneOrMore(Wt,ue);this.consumeSpaceForRecord(Wt);const VE=this.extractOneOrMore(Wt,Gi);this.consumeSpaceForRecord(Wt);const g_=this.extractOneOrMore(Wt,Gi);this.consumeSpaceForRecord(Wt);const Lb=this.extract(Wt,this.consumeUnicastAddress);return this.currentLine++,{username:_s,sessId:_c,sessVersion:iE,nettype:VE,addrtype:g_,unicastAddress:Lb}}parseSessionName(){const Wt=this.getCurrentRecord();if(Wt.type===$.SESSION_NAME){const _s=this.extract(Wt,this.consumeText);return this.currentLine++,_s}}parseInformation(){const Wt=this.getCurrentRecord();if(Wt.type!==$.INFORMATION)return;const _s=this.extract(Wt,this.consumeText);return this.currentLine++,_s}parseUri(){const Wt=this.getCurrentRecord();if(Wt.type===$.URI)return this.currentLine++,Wt.value}parseEmail(){const Wt=[];for(;;){const _s=this.getCurrentRecord();if(_s.type!==$.EMAIL)break;Wt.push(_s.value),this.currentLine++}return Wt}parsePhone(){const Wt=[];for(;;){const _s=this.getCurrentRecord();if(_s.type!==$.PHONE)break;Wt.push(_s.value),this.currentLine++}return Wt}parseConnection(){const Wt=this.getCurrentRecord();if(Wt.type===$.CONNECTION){const _s=this.extractOneOrMore(Wt,Gi);this.consumeSpaceForRecord(Wt);const _c=this.extractOneOrMore(Wt,Gi);this.consumeSpaceForRecord(Wt);const iE=this.extract(Wt,this.consumeAddress);return this.currentLine++,{nettype:_s,addrtype:_c,address:iE}}}parseMedia(){const Wt=this.getCurrentRecord(),_s=this.extract(Wt,this.consumeToken);this.consumeSpaceForRecord(Wt);let _c=this.extract(Wt,this.consumePort);Wt.value[Wt.cur]==="/"&&(Wt.cur+=1,_c+=this.extract(Wt,this.consumeInteger)),this.consumeSpaceForRecord(Wt);const iE=[];for(iE.push(this.extract(Wt,this.consumeToken));Wt.value[Wt.cur]==="/";)Wt.cur+=1,iE.push(this.extract(Wt,this.consumeToken));if(iE.length===0)throw new Error("Invalid proto");const VE=this.parseFmt(Wt);return this.currentLine++,{mediaType:_s,port:_c,protos:iE,fmts:VE}}parseTimeFields(){const Wt=[];for(;this.getCurrentRecord().type===$.TIME;){const _s=this.parseTime(),_c=this.parseRepeat(),iE=this.parseZone();Wt.push({time:_s,repeats:_c,zones:iE})}return Wt}parseMediaDescription(){const Wt=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===$.MEDIA;){const _s=this.parseMedia(),_c=this.parseInformation(),iE=this.parseConnections(),VE=this.parseBandWidth(),g_=this.parseKey(),Lb=this.parseMediaAttributes(_s);Wt.push({media:_s,information:_c,connections:iE,bandwidths:VE,key:g_,attributes:Lb})}return Wt}parseConnections(){const Wt=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===$.CONNECTION;)Wt.push(this.parseConnection());return Wt}parseFmt(Wt){const _s=[];for(;;)try{this.consumeSpaceForRecord(Wt),_s.push(this.extract(Wt,this.consumeToken))}catch{break}if(_s.length===0)throw new Error("Invalid fmts");return _s}extract(Wt,_s,..._c){const iE=_s.call(this,Wt.value,Wt.cur,..._c),VE=Wt.value.slice(Wt.cur,iE);return Wt.cur=iE,VE}extractOneOrMore(Wt,_s){const _c=this.consumeOneOrMore(Wt.value,Wt.cur,_s),iE=Wt.value.slice(Wt.cur,_c);return Wt.cur=_c,iE}consumeSpaceForRecord(Wt){if(Wt.value[Wt.cur]!==H)throw new Error("Invalid space at ".concat(Wt.cur,"."));Wt.cur+=1}}class d_ extends DE{constructor(...Wt){super(...Wt),n_(this,"attributes",void 0),n_(this,"digested",!1)}extractOneOrMore(Wt,_s,_c){const iE=this.consumeOneOrMore(Wt.attValue,Wt._cur,_s),VE=Wt.attValue.slice(Wt._cur,iE),[g_,Lb]=_c||[];if(typeof g_=="number"&&VE.length<g_)throw new Error("error in length, should be more or equal than ".concat(g_," characters."));if(typeof Lb=="number"&&VE.length>Lb)throw new Error("error in length, should be less or equal than ".concat(Lb," characters."));return Wt._cur=iE,VE}consumeAttributeSpace(Wt){if(Wt.attValue[Wt._cur]!==H)throw new Error("Invalid space at ".concat(Wt._cur,"."));Wt._cur+=1}extract(Wt,_s,..._c){if(!Wt.attValue)throw new Error("Nothing to extract from attValue.");const iE=_s.call(this,Wt.attValue,Wt._cur,..._c),VE=Wt.attValue.slice(Wt._cur,iE);return Wt._cur=iE,VE}atEnd(Wt){if(!Wt.attValue)throw new Error;return Wt._cur>=Wt.attValue.length}peekChar(Wt){if(!Wt.attValue)throw new Error;return Wt.attValue[Wt._cur]}peek(Wt,_s){if(!Wt.attValue)throw new Error;for(let _c=0;_c<_s.length;_c++)if(_s[_c]!==Wt.attValue[Wt._cur+_c])return!1;return!0}parseIceUfrag(Wt){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(Wt,IE,[4,256])}parseIcePwd(Wt){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(Wt,IE,[22,256])}parseIceOptions(Wt){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const _s=[];for(;!this.atEnd(Wt);){_s.push(this.extractOneOrMore(Wt,IE));try{this.consumeAttributeSpace(Wt)}catch(_c){if(this.atEnd(Wt))break;throw _c}}this.attributes.iceOptions=_s}parseFingerprint(Wt){const _s=this.extract(Wt,this.consumeToken);this.consumeAttributeSpace(Wt);const _c=this.extract(Wt,this.consumeTill);this.attributes.fingerprints.push({hashFunction:_s,fingerprint:_c})}parseExtmap(Wt){const _s=this.extractOneOrMore(Wt,ue);let _c;this.peekChar(Wt)==="/"&&(this.extract(Wt,this.consume,"/"),_c=this.extract(Wt,this.consumeToken)),this.consumeAttributeSpace(Wt);const iE=this.extract(Wt,this.consumeTill,H),VE=mE(mE({entry:parseInt(_s,10)},_c&&{direction:_c}),{},{extensionName:iE});this.peekChar(Wt)===H&&(this.consumeAttributeSpace(Wt),VE.extensionAttributes=this.extract(Wt,this.consumeTill)),this.attributes.extmaps.push(VE)}parseSetup(Wt){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const _s=this.extract(Wt,this.consumeTill);if(_s!=="active"&&_s!=="passive"&&_s!=="actpass"&&_s!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=_s}}class U_ extends d_{constructor(...Wt){super(...Wt),n_(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(Wt){if(this.digested)throw new Error("already digested");try{switch(Wt.attField){case"group":this.parseGroup(Wt);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(Wt);break;case"ice-pwd":this.parseIcePwd(Wt);break;case"ice-options":this.parseIceOptions(Wt);break;case"fingerprint":this.parseFingerprint(Wt);break;case"setup":this.parseSetup(Wt);break;case"tls-id":this.parseTlsId(Wt);break;case"identity":this.parseIdentity(Wt);break;case"extmap":this.parseExtmap(Wt);break;case"msid-semantic":this.parseMsidSemantic(Wt);break;default:Wt.ignored=!0,this.attributes.unrecognized.push(Wt)}}catch(_s){throw console.error("parsing session attribute ".concat(Wt.attField,' error, "a=').concat(Wt.attField,":").concat(Wt.attValue,'"')),_s}if(!Wt.ignored&&Wt.attValue&&!this.atEnd(Wt))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(Wt){const _s=this.extract(Wt,this.consumeToken),_c=[];for(;!this.atEnd(Wt)&&this.peekChar(Wt)===H;)this.consumeAttributeSpace(Wt),_c.push(this.extract(Wt,this.consumeToken));this.attributes.groups.push({semantic:_s,identificationTag:_c})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(Wt){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(Wt,lE)}parseIdentity(Wt){const _s=this.extractOneOrMore(Wt,hE),_c=[];for(;!this.atEnd(Wt)&&this.peekChar(Wt)===H;){this.consumeAttributeSpace(Wt);const iE=this.extract(Wt,this.consumeToken);this.extract(Wt,this.consume,"=");const VE=this.extractOneOrMore(Wt,g_=>g_!==H&&uE(g_));_c.push({name:iE,value:VE})}this.attributes.identities.push({assertionValue:_s,extensions:_c})}parseMsidSemantic(Wt){this.peekChar(Wt)===H&&this.consumeAttributeSpace(Wt);const _s={semantic:this.extract(Wt,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(Wt)}catch{break}if(this.peekChar(Wt)==="*"){this.extract(Wt,this.consume,"*"),_s.applyForAll=!0;break}{const _c=this.extract(Wt,this.consumeTill,H);_s.identifierList.push(_c)}}this.attributes.msidSemantic=_s}}class _b extends d_{constructor(Wt){super(),n_(this,"attributes",void 0),Wt.protos.indexOf("RTP")!==-1||Wt.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(Wt){if(this.digested)throw new Error("already digested");try{switch(Wt.attField){case"extmap":this.parseExtmap(Wt);break;case"setup":this.parseSetup(Wt);break;case"ice-ufrag":this.parseIceUfrag(Wt);break;case"ice-pwd":this.parseIcePwd(Wt);break;case"ice-options":this.parseIceOptions(Wt);break;case"candidate":this.parseCandidate(Wt);break;case"remote-candidate":this.parseRemoteCandidate(Wt);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(Wt);break;case"rtpmap":this.parseRtpmap(Wt);break;case"ptime":this.parsePtime(Wt);break;case"maxptime":this.parseMaxPtime(Wt);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(Wt);break;case"ssrc":this.parseSSRC(Wt);break;case"fmtp":this.parseFmtp(Wt);break;case"rtcp-fb":this.parseRtcpFb(Wt);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(Wt);break;case"mid":this.parseMid(Wt);break;case"msid":this.parseMsid(Wt);break;case"imageattr":this.parseImageAttr(Wt);break;case"rid":this.parseRid(Wt);break;case"simulcast":this.parseSimulcast(Wt);break;case"sctp-port":this.parseSctpPort(Wt);break;case"max-message-size":this.parseMaxMessageSize(Wt);break;case"ssrc-group":this.parseSSRCGroup(Wt);break;default:Wt.ignored=!0,this.attributes.unrecognized.push(Wt)}}catch(_s){throw console.error("parsing media attribute ".concat(Wt.attField,' error, "a=').concat(Wt.attField,":").concat(Wt.attValue,'"')),_s}if(!Wt.ignored&&Wt.attValue&&!this.atEnd(Wt))throw new Error("attribute parsing error")}parseCandidate(Wt){const _s=this.extractOneOrMore(Wt,IE,[1,32]);this.consumeAttributeSpace(Wt);const _c=this.extractOneOrMore(Wt,ue,[1,5]);this.consumeAttributeSpace(Wt);const iE=this.extract(Wt,this.consumeToken);this.consumeAttributeSpace(Wt);const VE=this.extractOneOrMore(Wt,ue,[1,10]);this.consumeAttributeSpace(Wt);const g_=this.extract(Wt,this.consumeAddress);this.consumeAttributeSpace(Wt);const Lb=this.extract(Wt,this.consumePort);this.consumeAttributeSpace(Wt),this.extract(Wt,this.consume,"typ"),this.consumeAttributeSpace(Wt);const vS={foundation:_s,componentId:_c,transport:iE,priority:VE,connectionAddress:g_,port:Lb,type:this.extract(Wt,this.consumeToken),extension:{}};for(this.peek(Wt," raddr")&&(this.extract(Wt,this.consume," raddr"),this.consumeAttributeSpace(Wt),vS.relAddr=this.extract(Wt,this.consumeAddress)),this.peek(Wt," rport")&&(this.extract(Wt,this.consume," rport"),this.consumeAttributeSpace(Wt),vS.relPort=this.extract(Wt,this.consumePort));this.peekChar(Wt)===H;){this.consumeAttributeSpace(Wt);const OR=this.extract(Wt,this.consumeToken);this.consumeAttributeSpace(Wt),vS.extension[OR]=this.extractOneOrMore(Wt,Ei)}this.attributes.candidates.push(vS)}parseRemoteCandidate(Wt){const _s=[];for(;;){const _c=this.extractOneOrMore(Wt,ue,[1,5]);this.consumeAttributeSpace(Wt);const iE=this.extract(Wt,this.consumeAddress);this.consumeAttributeSpace(Wt);const VE=this.extract(Wt,this.consumePort);_s.push({componentId:_c,connectionAddress:iE,port:VE});try{this.consumeAttributeSpace(Wt)}catch{break}}this.attributes.remoteCandidatesList.push(_s)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(Wt){const _s=this.extract(Wt,this.consumeToken);this.consumeAttributeSpace(Wt);const _c=this.extract(Wt,this.consumeTill,"/");this.extract(Wt,this.consume,"/");const iE={encodingName:_c,clockRate:this.extractOneOrMore(Wt,ue)};this.atEnd(Wt)||this.peekChar(Wt)!=="/"||(this.extract(Wt,this.consume,"/"),iE.encodingParameters=parseInt(this.extract(Wt,this.consumeTill),10));const VE=this.attributes.payloads.find(g_=>g_.payloadType===parseInt(_s,10));VE?VE.rtpMap=iE:this.attributes.payloads.push({payloadType:parseInt(_s,10),rtpMap:iE,rtcpFeedbacks:[]})}parsePtime(Wt){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(Wt,this.consumeTill)}parseMaxPtime(Wt){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(Wt,this.consumeTill)}parseDirection(Wt){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=Wt.attField}parseSSRC(Wt){const _s=this.extractOneOrMore(Wt,ue);this.consumeAttributeSpace(Wt);const _c=this.extract(Wt,this.consumeTill,":");let iE;this.peekChar(Wt)===":"&&(this.extract(Wt,this.consume,":"),iE=this.extract(Wt,this.consumeTill));const VE=this.attributes.ssrcs.find(g_=>g_.ssrcId===parseInt(_s,10));VE?VE.attributes[_c]=iE:this.attributes.ssrcs.push({ssrcId:parseInt(_s,10),attributes:{[_c]:iE}})}parseFmtp(Wt){const _s=this.extract(Wt,this.consumeTill,H);this.consumeAttributeSpace(Wt);const _c=this.extract(Wt,this.consumeTill),iE={};_c.split(";").forEach(g_=>{let[Lb,vS]=g_.split("=");Lb=Lb.trim();const OR=typeof vS=="string"?vS.trim():null;typeof Lb=="string"&&Lb.length>0&&(iE[Lb]=OR)});const VE=this.attributes.payloads.find(g_=>g_.payloadType===parseInt(_s,10));VE?VE.fmtp={parameters:iE}:this.attributes.payloads.push({payloadType:parseInt(_s,10),rtcpFeedbacks:[],fmtp:{parameters:iE}})}parseFmtParameters(Wt){const _s={},_c=this.extract(Wt,this.consumeTill,"=");Wt._cur++;const iE=this.extract(Wt,this.consumeTill,";");for(_s[_c]=iE;Wt.attValue[Wt._cur]===";";){const VE=this.extract(Wt,this.consumeTill,"=");Wt._cur++;const g_=this.extract(Wt,this.consumeTill,";");_s[VE]=g_}return _s}parseRtcpFb(Wt){let _s="";_s=this.peekChar(Wt)==="*"?this.extract(Wt,this.consume,"*"):this.extract(Wt,this.consumeTill,H),this.consumeAttributeSpace(Wt);const _c=this.extract(Wt,this.consumeTill,H);let iE;switch(_c){case"trr-int":iE={type:_c,interval:this.extract(Wt,this.consumeTill)};break;case"ack":case"nack":default:{const VE={type:_c};this.peekChar(Wt)===H&&(this.consumeAttributeSpace(Wt),VE.parameter=this.extract(Wt,this.consumeToken),this.peekChar(Wt)===H&&(VE.additional=this.extract(Wt,this.consumeTill))),iE=VE}}if(_s==="*")this.attributes.rtcpFeedbackWildcards.push(iE);else{const VE=this.attributes.payloads.find(g_=>g_.payloadType===parseInt(_s,10));VE?VE.rtcpFeedbacks.push(iE):this.attributes.payloads.push({payloadType:parseInt(_s,10),rtcpFeedbacks:[iE]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(Wt){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const _s={port:this.extract(Wt,this.consumePort)};this.peekChar(Wt)===H&&(this.consumeAttributeSpace(Wt),_s.netType=this.extractOneOrMore(Wt,Gi),this.consumeAttributeSpace(Wt),_s.addressType=this.extractOneOrMore(Wt,Gi),this.consumeAttributeSpace(Wt),_s.address=this.extract(Wt,this.consumeAddress)),this.attributes.rtcp=_s}parseMsid(Wt){const _s={id:this.extractOneOrMore(Wt,Gi,[1,64])};this.peekChar(Wt)===H&&(this.consumeAttributeSpace(Wt),_s.appdata=this.extractOneOrMore(Wt,Gi,[1,64])),this.attributes.msids.push(_s)}parseImageAttr(Wt){this.attributes.imageattr.push(Wt.attValue)}parseRid(Wt){const _s=this.extractOneOrMore(Wt,iE=>_f(iE)||ue(iE)||iE==="_"||iE==="-");this.consumeAttributeSpace(Wt);const _c={id:_s,direction:this.extract(Wt,this.consumeToken),params:[]};if(this.peekChar(Wt)===H){if(this.consumeAttributeSpace(Wt),this.peek(Wt,"pt=")){this.extract(Wt,this.consume,"pt=");const iE=[];for(;;){const VE=this.extract(Wt,this.consumeToken);iE.push(VE);try{this.extract(Wt,this.consume,",")}catch{break}}_c.payloads=iE,this.peekChar(Wt)===H&&this.extract(Wt,this.consume,H)}for(;;){const iE=this.extract(Wt,this.consumeToken);switch(iE){case"depend":{const VE={type:iE,rids:this.extract(Wt,this.consume,"=").split(",")};_c.params.push(VE);break}case"max-width":case"height-width":case"max-fps":case"max-fs":case"max-br":case"max-pps":case"max-bpp":default:{const VE={type:iE};this.peekChar(Wt)==="="&&(this.extract(Wt,this.consume,"="),VE.val=this.extract(Wt,this.consumeTill,";")),_c.params.push(VE)}}try{this.extract(Wt,this.consume,";")}catch{break}}}this.attributes.rids.push(_c)}parseSimulcast(Wt){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=Wt.attValue,this.extract(Wt,this.consumeTill)}parseSctpPort(Wt){this.attributes.sctpPort=this.extractOneOrMore(Wt,ue,[1,5])}parseMaxMessageSize(Wt){this.attributes.maxMessageSize=this.extractOneOrMore(Wt,ue,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(Wt){this.attributes.mid=this.extract(Wt,this.consumeToken)}parseSSRCGroup(Wt){const _s=this.extract(Wt,this.consumeToken),_c=[];for(;;)try{this.consumeAttributeSpace(Wt);const iE=this.extract(Wt,this.consumeInteger);_c.push(parseInt(iE,10))}catch{break}this.attributes.ssrcGroups.push({semantic:_s,ssrcIds:_c})}}function k_(fE,Wt,_s){return Wt in fE?Object.defineProperty(fE,Wt,{value:_s,enumerable:!0,configurable:!0,writable:!0}):fE[Wt]=_s,fE}class NT{constructor(){k_(this,"eol",z)}print(Wt,_s){let _c="";return _s&&(this.eol=_s),_c+=this.printVersion(Wt.version),_c+=this.printOrigin(Wt.origin),_c+=this.printSessionName(Wt.sessionName),_c+=this.printInformation(Wt.information),_c+=this.printUri(Wt.uri),_c+=this.printEmail(Wt.emails),_c+=this.printPhone(Wt.phones),_c+=this.printConnection(Wt.connection),_c+=this.printBandwidth(Wt.bandwidths),_c+=this.printTimeFields(Wt.timeFields),_c+=this.printKey(Wt.key),_c+=this.printSessionAttributes(Wt.attributes),_c+=this.printMediaDescription(Wt.mediaDescriptions),_c}printVersion(Wt){return"v=".concat(Wt).concat(this.eol)}printOrigin(Wt){return"o=".concat(Wt.username," ").concat(Wt.sessId," ").concat(Wt.sessVersion," ").concat(Wt.nettype," ").concat(Wt.addrtype," ").concat(Wt.unicastAddress).concat(this.eol)}printSessionName(Wt){return Wt?"s=".concat(Wt).concat(this.eol):""}printInformation(Wt){return Wt?"i=".concat(Wt).concat(this.eol):""}printUri(Wt){return Wt?"u=".concat(Wt).concat(this.eol):""}printEmail(Wt){let _s="";for(const _c of Wt)_s+="e=".concat(_c).concat(this.eol);return _s}printPhone(Wt){let _s="";for(const _c of Wt)_s+="e=".concat(_c).concat(this.eol);return _s}printConnection(Wt){return Wt?"c=".concat(Wt.nettype," ").concat(Wt.addrtype," ").concat(Wt.address).concat(this.eol):""}printBandwidth(Wt){let _s="";for(const _c of Wt)_s+="b=".concat(_c.bwtype,":").concat(_c.bandwidth).concat(this.eol);return _s}printTimeFields(Wt){let _s="";for(const _c of Wt){_s+="t=".concat(_c.time.startTime," ").concat(_c.time.startTime).concat(this.eol);for(const iE of _c.repeats)_s+="r=".concat(iE.repeatInterval," ").concat(iE.typedTimes.join(" ")).concat(this.eol);_c.zoneAdjustments&&(_s+="z=",_s+="z=".concat(_c.zoneAdjustments.map(iE=>"".concat(iE.time," ").concat(iE.back?"-":""," ").concat(iE.typedTime)).join(" ")).concat(this.eol),_s+=this.eol)}return _s}printKey(Wt){return Wt?"k=".concat(Wt).concat(this.eol):""}printAttributes(Wt){let _s="";for(const _c of Wt)_s+="a=".concat(_c.attField).concat(_c.attValue?":".concat(_c.attValue):"").concat(this.eol);return _s}printMediaDescription(Wt){let _s="";for(const _c of Wt)_s+=this.printMedia(_c.media),_s+=this.printInformation(_c.information),_s+=this.printConnections(_c.connections),_s+=this.printBandwidth(_c.bandwidths),_s+=this.printKey(_c.key),_s+=this.printMediaAttributes(_c);return _s}printConnections(Wt){let _s="";for(const _c of Wt)_s+=this.printConnection(_c);return _s}printMedia(Wt){return"m=".concat(Wt.mediaType," ").concat(Wt.port," ").concat(Wt.protos.join("/")," ").concat(Wt.fmts.join(" ")).concat(this.eol)}printSessionAttributes(Wt){return new dE(this.eol).print(Wt)}printMediaAttributes(Wt){return new vE(this.eol).print(Wt)}}class nE{constructor(Wt){k_(this,"eol",void 0),this.eol=Wt}printIceUfrag(Wt){return Wt===void 0?"":"a=ice-ufrag:".concat(Wt).concat(this.eol)}printIcePwd(Wt){return Wt===void 0?"":"a=ice-pwd:".concat(Wt).concat(this.eol)}printIceOptions(Wt){return Wt===void 0?"":"a=ice-options:".concat(Wt.join(H)).concat(this.eol)}printFingerprints(Wt){return Wt.length>0?Wt.map(_s=>"a=fingerprint:".concat(_s.hashFunction).concat(H).concat(_s.fingerprint)).join(this.eol)+this.eol:""}printExtmap(Wt){return Wt.map(_s=>"a=extmap:".concat(_s.entry).concat(_s.direction?"/".concat(_s.direction):"").concat(H).concat(_s.extensionName).concat(_s.extensionAttributes?"".concat(H).concat(_s.extensionAttributes):"").concat(this.eol)).join("")}printSetup(Wt){return Wt===void 0?"":"a=setup:".concat(Wt).concat(this.eol)}printUnrecognized(Wt){return Wt.map(_s=>"a=".concat(_s.attField).concat(_s.attValue?":".concat(_s.attValue):"").concat(this.eol)).join("")}}class dE extends nE{print(Wt){let _s="";return _s+=this.printGroups(Wt.groups),_s+=this.printMsidSemantic(Wt.msidSemantic),_s+=this.printIceLite(Wt.iceLite),_s+=this.printIceUfrag(Wt.iceUfrag),_s+=this.printIcePwd(Wt.icePwd),_s+=this.printIceOptions(Wt.iceOptions),_s+=this.printFingerprints(Wt.fingerprints),_s+=this.printSetup(Wt.setup),_s+=this.printTlsId(Wt.tlsId),_s+=this.printIdentity(Wt.identities),_s+=this.printExtmap(Wt.extmaps),_s+=this.printUnrecognized(Wt.unrecognized),_s}printGroups(Wt){let _s="";return Wt.length>0&&(_s+=Wt.map(_c=>"a=group:".concat(_c.semantic).concat(_c.identificationTag.map(iE=>"".concat(H).concat(iE)).join("")).concat(this.eol)).join("")),_s}printIceLite(Wt){return Wt===void 0?"":"a=ice-lite"+this.eol}printTlsId(Wt){return Wt?"a=tls-id:".concat(Wt).concat(this.eol):""}printIdentity(Wt){return Wt.length===0?"":Wt.map(_s=>"a=identity:".concat(_s.assertionValue).concat(_s.extensions.map(_c=>"".concat(H).concat(_c.name).concat(_c.value?"=".concat(_c.value):"")))).join(this.eol)+this.eol}printMsidSemantic(Wt){if(!Wt)return"";let _s="a=msid-semantic:".concat(Wt.semantic);return Wt.applyForAll?_s+="".concat(H,"*"):Wt.identifierList.length>0&&(_s+=Wt.identifierList.map(_c=>"".concat(H).concat(_c))),_s+this.eol}}class vE extends nE{print(Wt){const _s=Wt.attributes;let _c="";return _c+=this.printRTCP(_s.rtcp),_c+=this.printIceUfrag(_s.iceUfrag),_c+=this.printIcePwd(_s.icePwd),_c+=this.printIceOptions(_s.iceOptions),_c+=this.printCandidates(_s.candidates),_c+=this.printRemoteCandidatesList(_s.remoteCandidatesList),_c+=this.printEndOfCandidates(_s.endOfCandidates),_c+=this.printFingerprints(_s.fingerprints),_c+=this.printSetup(_s.setup),_c+=this.printMid(_s.mid),_c+=this.printExtmap(_s.extmaps),_c+=this.printRTPRelated(_s),_c+=this.printPtime(_s.ptime),_c+=this.printMaxPtime(_s.maxPtime),_c+=this.printDirection(_s.direction),_c+=this.printSSRCGroups(_s.ssrcGroups),_c+=this.printSSRC(_s.ssrcs),_c+=this.printRTCPMux(_s.rtcpMux),_c+=this.printRTCPMuxOnly(_s.rtcpMuxOnly),_c+=this.printRTCPRsize(_s.rtcpRsize),_c+=this.printMSId(_s.msids),_c+=this.printImageattr(_s.imageattr),_c+=this.printRid(_s.rids),_c+=this.printSimulcast(_s.simulcast),_c+=this.printSCTPPort(_s.sctpPort),_c+=this.printMaxMessageSize(_s.maxMessageSize),_c+=this.printUnrecognized(_s.unrecognized),_c}printCandidates(Wt){return Wt.map(_s=>"a=candidate:".concat(_s.foundation).concat(H).concat(_s.componentId).concat(H).concat(_s.transport).concat(H).concat(_s.priority).concat(H).concat(_s.connectionAddress).concat(H).concat(_s.port).concat(H,"typ").concat(H).concat(_s.type).concat(_s.relAddr?"".concat(H,"raddr").concat(H).concat(_s.relAddr):"").concat(_s.relPort?"".concat(H,"rport").concat(H).concat(_s.relPort):"").concat(Object.keys(_s.extension).map(_c=>"".concat(H).concat(_c).concat(H).concat(_s.extension[_c])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(Wt){return Wt.map(_s=>"a=remote-candidates:".concat(_s.join(H)).concat(this.eol)).join("")}printEndOfCandidates(Wt){return Wt===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(Wt){if(!Wt.payloads)return"";const _s=Wt.payloads;let _c="";_c+=Wt.rtcpFeedbackWildcards.map(iE=>this.printRTCPFeedback("*",iE)).join("");for(const iE of _s)_c+=this.printRtpMap(iE.payloadType,iE.rtpMap),_c+=this.printFmtp(iE.payloadType,iE.fmtp),_c+=iE.rtcpFeedbacks.map(VE=>this.printRTCPFeedback(iE.payloadType,VE)).join("");return _c}printFmtp(Wt,_s){if(!_s)return"";const _c=Object.keys(_s.parameters);return _c.length===1&&_s.parameters[_c[0]]===null?"a=fmtp:".concat(Wt).concat(H).concat(_c[0]).concat(this.eol):"a=fmtp:".concat(Wt).concat(H).concat(Object.keys(_s.parameters).map(iE=>"".concat(iE,"=").concat(_s.parameters[iE])).join(";")).concat(this.eol)}printRtpMap(Wt,_s){return _s?"a=rtpmap:".concat(Wt).concat(H).concat(_s.encodingName,"/").concat(_s.clockRate).concat(_s.encodingParameters?"/".concat(_s.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(Wt,_s){let _c="a=rtcp-fb:".concat(Wt).concat(H),iE=_s;switch(iE.type){case"trr-int":_c+="ttr-int".concat(H).concat(iE.interval);break;case"ack":case"nack":default:iE=iE,_c+="".concat(iE.type),iE.parameter&&(_c+="".concat(H).concat(iE.parameter),iE.additional&&(_c+="".concat(H).concat(iE.additional)))}return _c+this.eol}printPtime(Wt){return Wt===void 0?"":"a=ptime:".concat(Wt).concat(this.eol)}printMaxPtime(Wt){return Wt===void 0?"":"a=maxptime:".concat(Wt).concat(this.eol)}printDirection(Wt){return Wt===void 0?"":"a=".concat(Wt).concat(this.eol)}printSSRC(Wt){return Wt.map(_s=>Object.keys(_s.attributes).map(_c=>"a=ssrc:".concat(_s.ssrcId.toString(10)).concat(H).concat(_c).concat(_s.attributes[_c]?":".concat(_s.attributes[_c]):"").concat(this.eol)).join("")).join("")}printRTCPMux(Wt){return Wt===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(Wt){return Wt===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(Wt){return Wt===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(Wt){if(Wt===void 0)return"";let _s="a=rtcp:".concat(Wt.port);return Wt.netType&&(_s+="".concat(H).concat(Wt.netType)),Wt.addressType&&(_s+="".concat(H).concat(Wt.addressType)),Wt.address&&(_s+="".concat(H).concat(Wt.address)),_s+this.eol}printMSId(Wt){return Wt.map(_s=>"a=msid:".concat(_s.id).concat(_s.appdata?"".concat(H).concat(_s.appdata):"").concat(this.eol)).join("")}printImageattr(Wt){return Wt.map(_s=>"a=imageattr:".concat(_s).concat(this.eol)).join("")}printRid(Wt){return Wt.map(_s=>{let _c="a=rid:".concat(_s.id).concat(H).concat(_s.direction);return _s.payloads&&(_c+="".concat(H,"pt=").concat(_s.payloads.join(","))),_s.params.length>0&&(_c+="".concat(H).concat(_s.params.map(iE=>iE.type==="depend"?"depend=".concat(iE.rids.join(",")):"".concat(iE.type,"=").concat(iE.val)).join(";"))),_c+this.eol}).join("")}printSimulcast(Wt){return Wt===void 0?"":"a=simulcast:".concat(Wt).concat(this.eol)}printSCTPPort(Wt){return Wt===void 0?"":"a=sctp-port:".concat(Wt).concat(this.eol)}printMaxMessageSize(Wt){return Wt===void 0?"":"a=max-message-size:".concat(Wt).concat(this.eol)}printMid(Wt){return Wt===void 0?"":"a=mid:".concat(Wt).concat(this.eol)}printSSRCGroups(Wt){return Wt.map(_s=>"a=ssrc-group:".concat(_s.semantic).concat(_s.ssrcIds.map(_c=>"".concat(H).concat(_c.toString(10))).join("")).concat(this.eol)).join("")}}function xE(fE){return new __().parse(fE)}function ZE(fE,Wt){return new NT().print(fE,Wt)}}},p={};function _(b){if(p[b])return p[b].exports;var A=p[b]={exports:{}};return l[b](A,A.exports,_),A.exports}return _.d=(b,A)=>{for(var k in A)_.o(A,k)&&!_.o(b,k)&&Object.defineProperty(b,k,{enumerable:!0,get:A[k]})},_.o=(b,A)=>Object.prototype.hasOwnProperty.call(b,A),_.r=b=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(b,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(b,"__esModule",{value:!0})},_(8)})()})(q_);class UQ{constructor(s){_t(this,"sessionDesc",void 0),_t(this,"localCapabilities",void 0),_t(this,"rtpCapabilities",void 0),_t(this,"candidates",void 0),_t(this,"iceParameters",void 0),_t(this,"dtlsParameters",void 0),_t(this,"setup",void 0),_t(this,"currentMidIndex",void 0),_t(this,"cname",void 0),s=B_(s);const{remoteIceParameters:l,remoteDtlsParameters:p,candidates:_,remoteRTPCapabilities:b,remoteSetup:A,localCapabilities:k,sdkCodec:j,cname:z}=s,H=q_.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=b,this.candidates=_,this.iceParameters=l,this.dtlsParameters=p,this.setup=A,this.localCapabilities=k,this.cname=z;for(let $=0;$<H.mediaDescriptions.length;$++){const ue=H.mediaDescriptions[$];ue.attributes.iceUfrag=l.iceUfrag,ue.attributes.icePwd=l.icePwd,ue.attributes.fingerprints=p.fingerprints,ue.attributes.candidates=_,ue.attributes.setup=A,ue.media.mediaType==="video"&&(ue.media.fmts=b.videoCodecs.map(Ei=>Ei.payloadType.toString(10)),ue.attributes.payloads=b.videoCodecs,ue.attributes.extmaps=b.videoExtensions),ue.media.mediaType==="audio"&&(ue.media.fmts=b.audioCodecs.map(Ei=>Ei.payloadType.toString(10)),ue.attributes.payloads=b.audioCodecs,ue.attributes.extmaps=b.audioExtensions),H.mediaDescriptions[$]=this.mungMediaDesc(ue)}this.sessionDesc=H,this.currentMidIndex=H.mediaDescriptions.length-1}toString(){return q_.exports.print(this.sessionDesc)}send(s,l,p){const{ssrcs:_,ssrcGroups:b}=iS(l,this.cname),A=this.sessionDesc.mediaDescriptions.find(z=>s===FE.VIDEO?z.media.mediaType==="video":z.media.mediaType==="audio"),k=_[0].attributes.label,j=_[0].attributes.mslabel;return A.attributes.ssrcs=A.attributes.ssrcs.concat(_),A.attributes.ssrcGroups=A.attributes.ssrcGroups.concat(b),{id:k,mslabel:j}}batchSend(s){return s.map(l=>{let{kind:p,ssrcMsg:_}=l;return this.send(p,_,void 0)})}stopSending(s){this.sessionDesc.mediaDescriptions.forEach(l=>{const p=[],_=[],b=[];l.attributes.ssrcs.forEach(A=>{s.includes(A.attributes.label||"")?b.push(A):p.push(A)}),l.attributes.ssrcGroups.forEach(A=>{b.map(k=>k.ssrcId).includes(A.ssrcIds[0])||_.push(A)}),l.attributes.ssrcs=p,l.attributes.ssrcGroups=_})}mute(s){const l=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===s);if(!l)throw new Error("mediaDescription not found with ".concat(s," in remote SDP when calling RemoteSDP.mute."));l.attributes.direction="inactive"}unmute(s){const l=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===s);if(!l)throw new Error("mediaDescription not found with ".concat(s," in remote SDP when calling RemoteSDP.unmute."));l.attributes.direction="sendonly"}receive(s,l,p){s.forEach((_,b)=>{const A=_._mediaStreamTrack,k=this.sessionDesc.mediaDescriptions.findIndex(z=>z.attributes.mid===A.kind),j=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[k],_);this.sessionDesc.mediaDescriptions[k]=j})}stopReceiving(s){}updateCandidates(s){s===_v.TCP?this.candidates.forEach(l=>{this.candidates.findIndex(p=>p.transport==="tcp"&&p.connectionAddress===l.connectionAddress&&p.port===l.port)===-1&&this.candidates.push(zG(zG({},l),{},{foundation:"tcpcandidate",priority:Number(l.priority)-1+"",transport:"tcp",port:Number(l.port)+90+""}))}):this.candidates=this.candidates.filter(l=>l.transport!=="tcp");for(const l of this.sessionDesc.mediaDescriptions)l.attributes.candidates=this.candidates}restartICE(s){s=B_(s),this.iceParameters=s,this.sessionDesc.mediaDescriptions.forEach(l=>{l.attributes.iceUfrag=s.iceUfrag,l.attributes.icePwd=s.icePwd})}predictReceivingMids(s){const l=[];for(let p=0;p<s;p++)l.push((this.currentMidIndex+p+1).toString(10));return l}mungRecvMediaDsec(s,l){const p=B_(s);return jI(p,l),UL(p,l),p}updateRecvMedia(s,l){const p=this.sessionDesc.mediaDescriptions.findIndex(_=>_.attributes.mid===s);if(p!==-1){const _=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],l);this.sessionDesc.mediaDescriptions[p]=_}}bumpMid(s){this.currentMidIndex+=s}updateTrackLabel(s,l,p){const _=this.sessionDesc.mediaDescriptions.find(A=>s===FE.VIDEO?A.attributes.mid==="video":A.attributes.mid==="audio");if(_){const A=_.attributes.ssrcs.find(k=>k.attributes.label===l);var b;A&&(A.attributes.label=p,(b=A.attributes.msid)===null||b===void 0||b.replace(l,p))}}mungMediaDesc(s){const l=B_(s);return ML(l),function(p){const _=p.attributes.extmaps.find(b=>b.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");_&&p.attributes.extmaps.splice(p.attributes.extmaps.indexOf(_),1),p.attributes.payloads.forEach(b=>{const A=b.rtcpFeedbacks.findIndex(k=>k.type==="transport-cc");A!==-1&&b.rtcpFeedbacks.splice(A,1)})}(l),l}getSSRC(s){for(const l of this.sessionDesc.mediaDescriptions)for(const p of l.attributes.ssrcs)if(p.attributes.label===s)return[p]}}function mS(o){if(Array.isArray(o))return o.map(l=>l);if(!JG(o))return o;const s={};for(const l in o)JG(o[l])||Array.isArray(o[l])?s[l]=mS(o[l]):s[l]=o[l];return s}function JG(o){return!(typeof o!="object"||Array.isArray(o)||!o)}function xQ(){const o=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return o&&o[0]?Number(o[0].split("/")[1]):null}function jQ(o){return window.RTCStatsReport?o.getStats()instanceof RE:!1}class jL{constructor(s){_t(this,"input",[]),_t(this,"size",void 0),this.size=s}add(s){this.input.push(s),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const bR={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},R0={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:bR,remoteCandidate:bR}},XG={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},QG={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,qpSumPerFrame:0},$G={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},ZG={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function t4(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function e4(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?t4(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):t4(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}class VL{constructor(s,l){_t(this,"onFirstVideoReceived",void 0),_t(this,"onFirstVideoDecoded",void 0),_t(this,"onFirstAudioReceived",void 0),_t(this,"onFirstVideoDecodedTimeout",void 0),_t(this,"onFirstAudioDecoded",void 0),_t(this,"onSelectedLocalCandidateChanged",void 0),_t(this,"onSelectedRemoteCandidateChanged",void 0),_t(this,"videoIsReady",!1),_t(this,"videoIsReady2",{}),_t(this,"pc",void 0),_t(this,"options",void 0),_t(this,"intervalTimer",void 0),_t(this,"stats",mS(R0)),_t(this,"isFirstVideoReceived",{}),_t(this,"isFirstVideoDecoded",{}),_t(this,"isFirstAudioReceived",{}),_t(this,"isFirstAudioDecoded",{}),_t(this,"isFirstVideoDecodedTimeout",{}),_t(this,"lossRateWindowStats",[]),this.pc=s,this.options=l,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new RE(s=>{s({local:e4({},bR),remote:e4({},bR)})})}setVideoIsReady(s){this.videoIsReady=s}setVideoIsReady2(s,l){this.videoIsReady2[s]=l}getVideoIsReady(s){return this.videoIsReady2[s]||!1}setIsFirstAudioDecoded(s){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(s){this.lossRateWindowStats.push(s),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const l=this.lossRateWindowStats.length,p=["videoSend","audioSend","videoRecv","audioRecv"];let _=0,b=0,A=0,k=0;for(const j of p)s[j].forEach((z,H)=>{if(!this.lossRateWindowStats[l-1][j][H]||!this.lossRateWindowStats[0][j][H])return;const $=this.lossRateWindowStats[l-1][j][H].packets-this.lossRateWindowStats[0][j][H].packets,ue=this.lossRateWindowStats[l-1][j][H].packetsLost-this.lossRateWindowStats[0][j][H].packetsLost;j==="videoSend"||j==="audioSend"?(_+=$,A+=ue):(b+=$,k+=ue),Number.isNaN($)||Number.isNaN($)?z.packetLostRate=0:z.packetLostRate=$<=0||ue<=0?0:ue/($+ue)});s.sendPacketLossRate=_<=0||A<=0?0:A/(_+A),s.recvPacketLossRate=b<=0||k<=0?0:k/(b+k)}}function n4(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function VQ(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?n4(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):n4(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}class FQ extends VL{constructor(){super(...arguments),_t(this,"_stats",R0),_t(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const s=await this._getStats(),l=this.statsResponsesToObjects(s);this._stats=mS(R0);const p=l.filter(b=>b.type==="ssrc");this.processSSRCStats(p);const _=l.find(b=>b.type==="VideoBwe");_&&this.processBandwidthStats(_),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(s){this._stats.bitrate={actualEncoded:Number(s.googActualEncBitrate),targetEncoded:Number(s.googTargetEncBitrate),retransmit:Number(s.googRetransmitBitrate),transmit:Number(s.googTransmitBitrate)},this._stats.sendBandwidth=Number(s.googAvailableSendBandwidth)}processSSRCStats(s){s.forEach(l=>{const p=l.id.includes("send");switch("".concat(l.mediaType,"_").concat(p?"send":"recv")){case"video_send":{const _=mS(QG);_.codec=l.googCodecName,_.adaptionChangeReason="none",l.googCpuLimitedResolution&&(_.adaptionChangeReason="cpu"),l.googBandwidthLimitedResolution&&(_.adaptionChangeReason="bandwidth"),_.avgEncodeMs=Number(l.googAvgEncodeMs),_.inputFrame={width:Number(l.googFrameWidthInput)||Number(l.googFrameWidthSent),height:Number(l.googFrameHeightInput)||Number(l.googFrameHeightSent),frameRate:Number(l.googFrameRateInput)},_.sentFrame={width:Number(l.googFrameWidthSent),height:Number(l.googFrameHeightSent),frameRate:Number(l.googFrameRateInput)},_.firsCount=Number(l.googFirReceived),_.nacksCount=Number(l.googNacksReceived),_.plisCount=Number(l.googPlisReceived),_.frameCount=Number(l.framesEncoded),_.bytes=Number(l.bytesSent),_.packets=Number(l.packetsSent),_.packetsLost=Number(l.packetsLost),_.ssrc=Number(l.ssrc),_.rttMs=Number(l.googRtt||0),this._stats.videoSend.push(_),this._stats.rtt=_.rttMs;break}case"video_recv":{const _=mS(XG),b=this.lastDecodeVideoReceiverStats.get(Number(l.ssrc));if(_.codec=l.googCodecName,_.targetDelayMs=Number(l.googTargetDelayMs),_.renderDelayMs=Number(l.googRenderDelayMs),_.currentDelayMs=Number(l.googCurrentDelayMs),_.minPlayoutDelayMs=Number(l.googMinPlayoutDelayMs),_.decodeMs=Number(l.googDecodeMs),_.maxDecodeMs=Number(l.googMaxDecodeMs),_.receivedFrame={width:Number(l.googFrameWidthReceived),height:Number(l.googFrameHeightReceived),frameRate:Number(l.googFrameRateReceived)},_.decodedFrame={width:Number(l.googFrameWidthReceived),height:Number(l.googFrameHeightReceived),frameRate:Number(l.googFrameRateDecoded)},_.decodeFrameRate=Number(l.googFrameRateDecoded),_.outputFrame={width:Number(l.googFrameWidthReceived),height:Number(l.googFrameHeightReceived),frameRate:Number(l.googFrameRateOutput)},_.jitterBufferMs=Number(l.googJitterBufferMs),_.firsCount=Number(l.googFirsSent),_.nacksCount=Number(l.googNacksSent),_.plisCount=Number(l.googPlisSent),_.framesDecodeCount=Number(l.framesDecoded),_.bytes=Number(l.bytesReceived),_.packets=Number(l.packetsReceived),_.packetsLost=Number(l.packetsLost),_.ssrc=Number(l.ssrc),_.packets>0&&!this.isFirstVideoReceived[_.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(_.ssrc),this.isFirstVideoReceived[_.ssrc]=!0),_.framesDecodeCount>0&&!this.isFirstVideoDecoded[_.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(_.ssrc,_.decodedFrame.width,_.decodedFrame.height),this.isFirstVideoDecoded[_.ssrc]=!0),b){const A=b.stats,k=Date.now()-b.lts;_.framesDecodeFreezeTime=A.framesDecodeFreezeTime,_.framesDecodeInterval=A.framesDecodeInterval,_.framesDecodeCount>A.framesDecodeCount&&this.isFirstVideoDecoded[_.ssrc]?(b.lts=Date.now(),_.framesDecodeInterval=k,_.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(l.ssrc,10))?_.framesDecodeFreezeTime+=_.framesDecodeInterval:this.setVideoIsReady2(parseInt(l.ssrc,10),!0))):_.framesDecodeCount<b.stats.framesDecodeCount&&(_.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(_.ssrc,{stats:VQ({},_),lts:Date.now()}),this._stats.videoRecv.push(_);break}case"audio_recv":{const _=mS(ZG);_.codec=l.googCodecName,_.outputLevel=Math.abs(Number(l.audioOutputLevel))/32767,_.decodingCNG=Number(l.googDecodingCNG),_.decodingCTN=Number(l.googDecodingCTN),_.decodingCTSG=Number(l.googDecodingCTSG),_.decodingNormal=Number(l.googDecodingNormal),_.decodingPLC=Number(l.googDecodingPLC),_.decodingPLCCNG=Number(l.googDecodingPLCCNG),_.expandRate=Number(l.googExpandRate),_.accelerateRate=Number(l.googAccelerateRate),_.preemptiveExpandRate=Number(l.googPreemptiveExpandRate),_.secondaryDecodedRate=Number(l.googSecondaryDecodedRate),_.speechExpandRate=Number(l.googSpeechExpandRate),_.preferredJitterBufferMs=Number(l.googPreferredJitterBufferMs),_.jitterBufferMs=Number(l.googJitterBufferMs),_.jitterMs=Number(l.googJitterReceived),_.bytes=Number(l.bytesReceived),_.packets=Number(l.packetsReceived),_.packetsLost=Number(l.packetsLost),_.ssrc=Number(l.ssrc),_.receivedFrames=Number(l.googDecodingCTN)||Number(l.packetsReceived),_.droppedFrames=Number(l.googDecodingPLC)+Number(l.googDecodingPLCCNG)||Number(l.packetsLost),_.receivedFrames>0&&!this.isFirstAudioReceived[_.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(_.ssrc),this.isFirstAudioReceived[_.ssrc]=!0),_.decodingNormal>0&&!this.isFirstAudioDecoded[_.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(_.ssrc),this.isFirstAudioDecoded[_.ssrc]=!0),this._stats.audioRecv.push(_);break}case"audio_send":{const _=mS($G);_.codec=l.googCodecName,_.inputLevel=Math.abs(Number(l.audioInputLevel))/32767,_.aecReturnLoss=Number(l.googEchoCancellationReturnLoss||0),_.aecReturnLossEnhancement=Number(l.googEchoCancellationReturnLossEnhancement||0),_.residualEchoLikelihood=Number(l.googResidualEchoLikelihood||0),_.residualEchoLikelihoodRecentMax=Number(l.googResidualEchoLikelihoodRecentMax||0),_.bytes=Number(l.bytesSent),_.packets=Number(l.packetsSent),_.packetsLost=Number(l.packetsLost),_.ssrc=Number(l.ssrc),_.rttMs=Number(l.googRtt||0),this._stats.rtt=_.rttMs,this._stats.audioSend.push(_);break}}})}_getStats(){return new RE((s,l)=>{this.pc.getStats(s,l)})}statsResponsesToObjects(s){const l=[];return s.result().forEach(p=>{const _={id:p.id,timestamp:p.timestamp.valueOf().toString(),type:p.type};p.names().forEach(b=>{_[b]=p.stat(b)}),l.push(_)}),l}}function r4(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function ZR(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?r4(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):r4(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}class i4 extends VL{constructor(){super(...arguments),_t(this,"_stats",R0),_t(this,"report",void 0),_t(this,"lastDecodeVideoReceiverStats",new Map),_t(this,"lastVideoFramesRecv",new Map),_t(this,"lastVideoFramesSent",new Map),_t(this,"lastVideoFramesDecode",new Map),_t(this,"lastVideoJBDelay",new Map),_t(this,"lastAudioJBDelay",new Map),_t(this,"mediaBytesSent",new Map),_t(this,"mediaBytesRetransmit",new Map),_t(this,"mediaBytesTargetEncode",new Map),_t(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=mS(R0),this.report.forEach(s=>{switch(s.type){case xT.OUTBOUND:s.mediaType==="audio"?this.processAudioOutboundStats(s):s.mediaType==="video"&&this.processVideoOutboundStats(s);break;case xT.INBOUND:s.mediaType==="audio"?this.processAudioInboundStats(s):s.mediaType==="video"&&this.processVideoInboundStats(s);break;case xT.TRANSPORT:{const l=this.report.get(s.selectedCandidatePairId);l&&this.processCandidatePairStats(l);break}case xT.CANDIDATE_PAIR:s.selected&&this.processCandidatePairStats(s)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const s=await this.pc.getStats(),l={local:ZR({},bR),remote:ZR({},bR)};return s.forEach(p=>{let _;if(p.type===xT.TRANSPORT&&(_=s.get(p.selectedCandidatePairId)),p.type===xT.CANDIDATE_PAIR&&p.selected&&(_=p),_){const b=(A,k)=>{A.type=k.type,A.id=k.id,k.address&&(A.address=k.address),k.candidateType&&(A.candidateType=k.candidateType),k.port&&(A.port=k.port),k.priority&&(A.priority=k.priority),k.protocol&&(A.protocol=k.protocol),k.relayProtocol&&(A.relayProtocol=k.relayProtocol)};if(_.localCandidateId){const A=s.get(_.localCandidateId);A&&b(l.local,A)}if(_.remoteCandidateId){const A=s.get(_.remoteCandidateId);A&&b(l.remote,A)}}}),l}processCandidatePairStats(s){if(this._stats.sendBandwidth=s.availableOutgoingBitrate||0,s.currentRoundTripTime&&(this._stats.rtt=1e3*s.currentRoundTripTime),this._stats.videoSend.forEach(l=>{s.currentRoundTripTime&&(l.rttMs=1e3*s.currentRoundTripTime)}),this._stats.audioSend.forEach(l=>{s.currentRoundTripTime&&(l.rttMs=1e3*s.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=s.id,s.localCandidateId){const l=this.report.get(s.localCandidateId);l&&this.processCandidateStats(l)}if(s.remoteCandidateId){const l=this.report.get(s.remoteCandidateId);l&&this.processCandidateStats(l)}}processCandidateStats(s){let l;s.type===xT.LOCAL_CANDIDATE&&(l=this._stats.selectedCandidatePair.localCandidate),s.type===xT.REMOTE_CANDIDATE&&(l=this._stats.selectedCandidatePair.remoteCandidate),l&&(l.type=s.type,l.id=s.id,s.address&&(l.address=s.address),s.candidateType&&(l.candidateType=s.candidateType),s.port&&(l.port=s.port),s.priority&&(l.priority=s.priority),s.protocol&&(l.protocol=s.protocol),s.relayProtocol&&(l.relayProtocol=s.relayProtocol),s.type===xT.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==l.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ZR({},l),ZR({},this.stats.selectedCandidatePair.localCandidate)),s.type===xT.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==l.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ZR({},l),ZR({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(s){let l=this._stats.audioRecv.find(p=>p.ssrc===s.ssrc);l||(l=mS(ZG),this._stats.audioRecv.push(l)),l.ssrc=s.ssrc,l.packets=s.packetsReceived,l.packetsLost=s.packetsLost,l.bytes=s.bytesReceived,l.jitterMs=1e3*s.jitter,this.processAudioTrackReceiverStats(s,s.trackId,l),s.codecId&&(l.codec=this.getCodecFromCodecStats(s.codecId)),l.receivedFrames||(l.receivedFrames=s.packetsReceived),l.droppedFrames||(l.droppedFrames=s.packetsLost),l.receivedFrames>0&&!this.isFirstAudioReceived[l.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(l.ssrc),this.isFirstAudioReceived[l.ssrc]=!0),l.outputLevel&&l.outputLevel>0&&!this.isFirstAudioDecoded[l.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(l.ssrc),this.isFirstAudioDecoded[l.ssrc]=!0),typeof s.concealedSamples=="number"&&(l.concealedSamples=s.concealedSamples)}processVideoInboundStats(s){let l=this._stats.videoRecv.find(A=>A.ssrc===s.ssrc);l||(l=mS(XG),this._stats.videoRecv.push(l)),l.ssrc=s.ssrc,l.packets=s.packetsReceived,l.packetsLost=s.packetsLost,l.bytes=s.bytesReceived,l.firsCount=s.firCount,l.nacksCount=s.nackCount,l.plisCount=s.pliCount,l.framesDecodeCount=s.framesDecoded,l.totalInterFrameDelay=s.totalInterFrameDelay,l.totalSquaredInterFrameDelay=s.totalSquaredInterFrameDelay;const p=this.lastDecodeVideoReceiverStats.get(l.ssrc),_=this.lastVideoFramesDecode.get(l.ssrc),b=Date.now();if(l.framesDecodeCount>0&&!this.isFirstVideoDecoded[l.ssrc]){const A=l.decodedFrame?l.decodedFrame.width:0,k=l.decodedFrame?l.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(l.ssrc,A,k),this.isFirstVideoDecoded[l.ssrc]=!0}if(p){const A=p.stats,k=b-p.lts;l.framesDecodeFreezeTime=A.framesDecodeFreezeTime,l.framesDecodeInterval=A.framesDecodeInterval,!this.isFirstVideoDecoded[l.ssrc]&&k>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[l.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(l.ssrc),this.isFirstVideoDecodedTimeout[l.ssrc]=!0),l.framesDecodeCount>A.framesDecodeCount&&this.isFirstVideoDecoded[l.ssrc]?(p.lts=Date.now(),l.framesDecodeInterval=k,l.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(s.ssrc))?l.framesDecodeFreezeTime+=l.framesDecodeInterval:this.setVideoIsReady2(parseInt(s.ssrc,10),!0))):l.framesDecodeCount<A.framesDecodeCount&&(l.framesDecodeInterval=0),s.framesDecoded&&s.qpSum&&(p.stats.framesDecodeCount>s.framesDecoded?l.qpSumPerFrame=s.qpSum/s.framesDecoded:l.qpSumPerFrame=(s.qpSum-p.qpSum)/(s.framesDecoded-p.stats.framesDecodeCount))}_&&b-_.lts>=800?(l.decodeFrameRate=Math.round((l.framesDecodeCount-_.count)/((b-_.lts)/1e3)),this.lastVideoFramesDecode.set(l.ssrc,{count:l.framesDecodeCount,lts:b,rate:l.decodeFrameRate})):_?l.decodeFrameRate=_.rate:this.lastVideoFramesDecode.set(l.ssrc,{count:l.framesDecodeCount,lts:b,rate:0}),s.totalDecodeTime&&(l.decodeMs=1e3*s.totalDecodeTime),this.processVideoTrackReceiverStats(s,s.trackId,l),s.codecId&&(l.codec=this.getCodecFromCodecStats(s.codecId)),s.framerateMean&&(l.framesRateFirefox=s.framerateMean),l.packets>0&&!this.isFirstVideoReceived[l.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(l.ssrc),this.isFirstVideoReceived[l.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(l.ssrc,{stats:ZR({},l),lts:p?p.lts:Date.now(),qpSum:s.qpSum})}processVideoOutboundStats(s){let l=this._stats.videoSend.find(_=>_.ssrc===s.ssrc);l||(l=mS(QG),this._stats.videoSend.push(l));const p=this.mediaBytesSent.get(s.ssrc);if(p)p.add(s.bytesSent);else{const _=new jL(10);_.add(s.bytesSent),this.mediaBytesSent.set(s.ssrc,_)}if(s.retransmittedBytesSent!==void 0){const _=this.mediaBytesRetransmit.get(s.ssrc);if(_)_.add(s.retransmittedBytesSent);else{const b=new jL(10);b.add(s.retransmittedBytesSent),this.mediaBytesRetransmit.set(s.ssrc,b)}}if(s.totalEncodedBytesTarget){const _=this.mediaBytesTargetEncode.get(s.ssrc);if(_)_.add(s.totalEncodedBytesTarget);else{const b=new jL(10);b.add(s.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(s.ssrc,b)}}if(l.ssrc=s.ssrc,l.bytes=s.bytesSent,l.packets=s.packetsSent,l.firsCount=s.firCount,l.nacksCount=s.nackCount,l.plisCount=s.pliCount,l.frameCount=s.framesEncoded,l.adaptionChangeReason=s.qualityLimitationReason,l.scalabilityMode=s.scalabilityMode,s.totalEncodeTime&&s.framesEncoded){const _=this.lastEncoderMs.get(s.ssrc);if(!_||_.lastFrameCount>s.framesEncoded)l.avgEncodeMs=1e3*s.totalEncodeTime/s.framesEncoded;else{const b=s.framesEncoded-_.lastFrameCount,A=s.totalEncodeTime-_.lastEncoderTime;l.avgEncodeMs=1e3*A/b}}if(s.framesEncoded&&s.qpSum){const _=this.lastEncoderMs.get(s.ssrc);!_||_.lastFrameCount>s.framesEncoded?l.qpSumPerFrame=s.qpSum/s.framesEncoded:l.qpSumPerFrame=(s.qpSum-_.lastQpSum)/(s.framesEncoded-_.lastFrameCount)}if(this.lastEncoderMs.set(s.ssrc,{lastFrameCount:s.framesEncoded,lastEncoderTime:s.totalEncodeTime,lastQpSum:s.qpSum,lts:Date.now()}),s.codecId&&(l.codec=this.getCodecFromCodecStats(s.codecId)),s.mediaSourceId&&this.processVideoMediaSource(s.mediaSourceId,l),this.processVideoTrackSenderStats(s,s.trackId,l),s.remoteId)this.processRemoteInboundStats(s.remoteId,l);else{const _=this.findRemoteStatsId(s.ssrc,xT.REMOTE_INBOUND);_&&this.processRemoteInboundStats(_,l)}}processAudioOutboundStats(s){let l=this._stats.audioSend.find(p=>p.ssrc===s.ssrc);if(l||(l=mS($G),this._stats.audioSend.push(l)),l.ssrc=s.ssrc,l.packets=s.packetsSent,l.bytes=s.bytesSent,s.mediaSourceId&&this.processAudioMediaSource(s.mediaSourceId,l),s.codecId&&(l.codec=this.getCodecFromCodecStats(s.codecId)),this.processAudioTrackSenderStats(s,s.trackId,l),s.remoteId)this.processRemoteInboundStats(s.remoteId,l);else{const p=this.findRemoteStatsId(s.ssrc,xT.REMOTE_INBOUND);p&&this.processRemoteInboundStats(p,l)}}findRemoteStatsId(s,l){var p;const _=Array.from(US(p=this.report).call(p)).find(b=>b.type===l&&b.ssrc===s);return _?_.id:null}processVideoMediaSource(s,l){const p=this.report.get(s);p&&p.width&&p.height&&p.framesPerSecond&&(l.inputFrame={width:p.width,height:p.height,frameRate:p.framesPerSecond})}processAudioMediaSource(s,l){const p=this.report.get(s);p&&(l.inputLevel=p.audioLevel)}processVideoTrackSenderStats(s,l,p){var _,b,A;const k=l?this.report.get(l):void 0,j=(_=k==null?void 0:k.framesSent)!==null&&_!==void 0?_:s.framesSent;let z=(b=k==null?void 0:k.frameWidth)!==null&&b!==void 0?b:s.frameWidth,H=(A=k==null?void 0:k.frameHeight)!==null&&A!==void 0?A:s.frameHeight;if(typeof j!="number")return;typeof z=="number"&&typeof H=="number"||(z=0,H=0);let $=0;const ue=Date.now(),Ei=this.lastVideoFramesSent.get(p.ssrc);Ei&&ue-Ei.lts>=800?($=Math.round((j-Ei.count)/((ue-Ei.lts)/1e3)),this.lastVideoFramesSent.set(p.ssrc,{count:j,lts:ue,rate:$})):Ei?$=Ei.rate:this.lastVideoFramesSent.set(p.ssrc,{count:j,lts:ue,rate:0}),p.sentFrame={width:z,height:H,frameRate:Math.max(0,$)}}processVideoTrackReceiverStats(s,l,p){var _,b,A,k,j;const z=l?this.report.get(l):void 0,H=(_=z==null?void 0:z.framesReceived)!==null&&_!==void 0?_:s.framesReceived,$=(b=z==null?void 0:z.frameWidth)!==null&&b!==void 0?b:s.frameWidth,ue=(A=z==null?void 0:z.frameHeight)!==null&&A!==void 0?A:s.frameHeight,Ei=(k=z==null?void 0:z.jitterBufferDelay)!==null&&k!==void 0?k:s.jitterBufferDelay,Fi=(j=z==null?void 0:z.jitterBufferEmittedCount)!==null&&j!==void 0?j:s.jitterBufferEmittedCount;if(typeof H=="number"){const Gi=this.lastVideoFramesRecv.get(p.ssrc),_o=Date.now();p.framesReceivedCount=H;let _f=0;Gi&&_o-Gi.lts>=800?(_f=Math.round((H-Gi.count)/((_o-Gi.lts)/1e3)),this.lastVideoFramesRecv.set(p.ssrc,{count:H,lts:_o,rate:_f})):Gi?_f=Gi.rate:this.lastVideoFramesRecv.set(p.ssrc,{count:H,lts:_o,rate:0}),p.receivedFrame={width:$||0,height:ue||0,frameRate:_f||0},p.decodedFrame={width:$||0,height:ue||0,frameRate:p.decodeFrameRate||0},p.outputFrame={width:$||0,height:ue||0,frameRate:p.decodeFrameRate||0}}if(Ei&&Fi){let Gi=this.lastVideoJBDelay.get(p.ssrc);this.lastVideoJBDelay.set(p.ssrc,{jitterBufferDelay:Ei,jitterBufferEmittedCount:Fi}),Gi||(Gi={jitterBufferDelay:0,jitterBufferEmittedCount:0});const _o=1e3*(Ei-Gi.jitterBufferDelay)/(Fi-Gi.jitterBufferEmittedCount);p.jitterBufferMs=_o,p.currentDelayMs=Math.round(_o)}}processAudioTrackSenderStats(s,l,p){var _,b,A,k;const j=l?this.report.get(l):void 0,z=(_=(b=j==null?void 0:j.echoReturnLoss)!==null&&b!==void 0?b:s.echoReturnLoss)!==null&&_!==void 0?_:0,H=(A=(k=j==null?void 0:j.echoReturnLossEnhancement)!==null&&k!==void 0?k:s.echoReturnLossEnhancement)!==null&&A!==void 0?A:0;p.aecReturnLoss=z,p.aecReturnLossEnhancement=H}processAudioTrackReceiverStats(s,l,p){var _,b,A,k,j,z,H;const $=l?this.report.get(l):void 0,ue=(_=$==null?void 0:$.removedSamplesForAcceleration)!==null&&_!==void 0?_:s.removedSamplesForAcceleration,Ei=(b=$==null?void 0:$.totalSamplesReceived)!==null&&b!==void 0?b:s.totalSamplesReceived,Fi=(A=$==null?void 0:$.jitterBufferDelay)!==null&&A!==void 0?A:s.jitterBufferDelay,Gi=(k=$==null?void 0:$.jitterBufferEmittedCount)!==null&&k!==void 0?k:s.jitterBufferEmittedCount,_o=(j=$==null?void 0:$.audioLevel)!==null&&j!==void 0?j:s==null?void 0:s.audioLevel,_f=(z=$==null?void 0:$.totalSamplesDuration)!==null&&z!==void 0?z:s==null?void 0:s.totalSamplesDuration,vf=(H=$==null?void 0:$.concealedSamples)!==null&&H!==void 0?H:s.concealedSamples;if(ue&&Ei&&(p.accelerateRate=ue/Ei),Fi&&Gi){let IE=this.lastAudioJBDelay.get(p.ssrc);this.lastAudioJBDelay.set(p.ssrc,{jitterBufferDelay:Fi,jitterBufferEmittedCount:Gi}),IE||(IE={jitterBufferDelay:0,jitterBufferEmittedCount:0});const lE=1e3*(Fi-IE.jitterBufferDelay)/(Gi-IE.jitterBufferEmittedCount);p.jitterBufferMs=Math.round(lE)}p.outputLevel=_o;let uE=1920;_f&&Ei&&(uE=Ei/_f/50,p.receivedFrames=Math.round(Ei/uE)),vf&&(p.droppedFrames=Math.round(vf/uE))}processRemoteInboundStats(s,l){const p=this.report.get(s);p&&(l.packetsLost=p.packetsLost,p.roundTripTime&&(l.rttMs=1e3*p.roundTripTime))}getCodecFromCodecStats(s){const l=this.report.get(s);if(!l)return"";const p=l.mimeType.match(/\/(.*)$/);return p&&p[1]?p[1]:""}updateSendBitrate(){let s=0,l=null,p=null;this.mediaBytesSent.forEach(b=>{s+=b.diffMean()}),this.mediaBytesRetransmit.forEach(b=>{l=l===null?b.diffMean():l+b.diffMean()}),this.mediaBytesTargetEncode.forEach(b=>{p=p===null?b.diffMean():p+b.diffMean()});const _=l!==null?s-l:s;this._stats.bitrate={actualEncoded:8*_/(this.options.updateInterval/1e3),transmit:8*s/(this.options.updateInterval/1e3)},l!==null&&(this._stats.bitrate.retransmit=8*l/(this.options.updateInterval/1e3)),p!==null&&(this._stats.bitrate.targetEncoded=8*p/(this.options.updateInterval/1e3))}}class BQ extends VL{updateStats(){return RE.resolve()}}function FL(o){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,_=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const b=xQ();return b?b<76?new FQ(o,{updateInterval:s,lossRateInterval:l,freezeRateLimit:p,firstVideoDecodedTimeout:_}):new i4(o,{updateInterval:s,lossRateInterval:l,freezeRateLimit:p,firstVideoDecodedTimeout:_}):jQ(o)?new i4(o,{updateInterval:s,lossRateInterval:l,freezeRateLimit:p,firstVideoDecodedTimeout:_}):new BQ(o,{updateInterval:s,lossRateInterval:l,freezeRateLimit:p,firstVideoDecodedTimeout:_})}var l_;function o4(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function s4(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?o4(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):o4(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}let I0=(oE((l_=class C0 extends DO{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(s,l){super(s,l),_t(this,"store",void 0),_t(this,"peerConnection",void 0),_t(this,"remoteSDP",void 0),_t(this,"initialOffer",void 0),_t(this,"statsFilter",void 0),_t(this,"useRTX",!1),_t(this,"localCapabilities",void 0),_t(this,"localCandidateCount",0),_t(this,"allCandidatesReceived",!1),_t(this,"establishPromise",void 0),_t(this,"mutex",new gT("P2PConnection-mutex")),this.store=l,this.peerConnection=new RTCPeerConnection(C0.resolvePCConfiguration(s),{optional:[{googDscp:!0}]}),this.statsFilter=FL(this.peerConnection,_u("STATS_UPDATE_INTERVAL"),void 0,O_()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const s=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const l=$R(s.sdp),p=LL(s.sdp,!this.useRTX,_u("FILTER_VIDEO_FEC"),_u("FILTER_AUDIO_FEC"),["opus"]);return this.localCapabilities=p,this.initialOffer=s,s4(s4({},l),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:p},offerSDP:s.sdp})}catch(s){throw new ga(Di.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(s,l,p,_,b,A){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new UQ({remoteIceParameters:s,remoteDtlsParameters:l,candidates:p,remoteRTPCapabilities:_.send,remoteSetup:b,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:A});const k=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:k})}catch(k){throw new ga(Di.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(k.toString()))}}send(s,l){var p=this;return ES(function*(){const _=yield YE(p.mutex.lock());try{if(!p.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const b=s.map(ue=>p.peerConnection.addTrack(ue._mediaStreamTrack)),A=yield YE(p.peerConnection.createOffer()),k=q_.exports.parse(A.sdp),j=s.map(ue=>{const Ei=ue._mediaStreamTrack,Fi=k.mediaDescriptions.find(Gi=>Gi.attributes.mid===Ei.kind);if(!Fi)throw new Error("Cannot extract ssrc from mediaDescription.");return function(Gi,_o,_f){const vf=Gi.attributes.ssrcs.filter(IE=>IE.attributes.label===_o),uE=Gi.attributes.ssrcGroups;if(vf.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(uE&&vf.length>1){const IE=uE.find(lE=>lE.ssrcIds.indexOf(vf[0].ssrcId)!==-1);return IE?[{ssrcId:IE.ssrcIds[0],rtx:_f?IE.ssrcIds[1]:void 0}]:[{ssrcId:vf[0].ssrcId}]}return[{ssrcId:vf[0].ssrcId}]}(Fi,Ei.id,p.useRTX)});let z;try{z=yield j}catch(ue){throw b.forEach(Ei=>{fT()&&Ei.replaceTrack(null),p.peerConnection.removeTrack(Ei)}),ue}const H=p.mungSendOfferSDP(A.sdp,s);p.remoteSDP.receive(s,l,z);const $=p.remoteSDP.toString();return yield YE(p.peerConnection.setLocalDescription({type:"offer",sdp:H})),yield YE(p.applySendEncodings(b,s)),yield YE(p.peerConnection.setRemoteDescription({type:"answer",sdp:$})),s.map((ue,Ei)=>{const Fi=ue._mediaStreamTrack.id;return{localSSRC:j[Ei],id:Fi}})}catch(b){throw new ga(Di.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(b.toString()))}finally{_()}})()}async stopSending(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const l=this.peerConnection.getSenders().filter(b=>{var A;return s.indexOf(((A=b.track)===null||A===void 0?void 0:A.id)||"")!==-1});if(l.length!==s.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");l.map(b=>{fT()&&b.replaceTrack(null),this.peerConnection.removeTrack(b)});const p=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(p),this.remoteSDP.stopReceiving(s);const _=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:_})}catch(l){throw new ga(Di.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(l.toString()))}}async receive(s,l,p,_){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(s," before remoteSDP created."));const{id:b,mslabel:A}=this.remoteSDP.send(s,l,_),k=new RE((H,$)=>{const ue=setTimeout(()=>{$(new Error("Cannot receive track, id: ".concat(b)))},1e4),Ei=Fi=>{const Gi=r_();if((Gi.name==="Safari"&&Number(Gi.version)===11||ET())&&Fi.track.id!==b&&Fi.streams[0].id===A){var _o;const _f=Fi.streams[0].getTracks()[0];return(_o=this.remoteSDP)===null||_o===void 0||_o.updateTrackLabel(s,b,Fi.track.id),this.peerConnection.removeEventListener("track",Ei),clearTimeout(ue),void H(_f)}if(Fi.track.id===b)return this.peerConnection.removeEventListener("track",Ei),clearTimeout(ue),void H(Fi.track)};this.peerConnection.addEventListener("track",Ei)}),j=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:j});const z=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(z),{track:await k,id:b}}catch(b){throw new ga(Di.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(b.toString()))}}async stopReceiving(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(s);const l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const p=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(p)}catch(l){throw new ga(Di.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(l.toString()))}}async muteRemote(s){}async unmuteRemote(s){}async muteLocal(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const l=this.peerConnection.getSenders().filter(p=>{var _;return s.indexOf(((_=p.track)===null||_===void 0?void 0:_.id)||"")!==-1});if(l.length!==s.length)throw new Error("sender' length doesn't match mids' length.");l.map(p=>{if(fT()&&p.track)p.track.enabled=!1;else{const _=p.getParameters();_.encodings.forEach(b=>b.active=!1),p.setParameters(_)}})}catch(l){throw new ga(Di.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(l.toString()))}}async unmuteLocal(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const l=this.peerConnection.getSenders().filter(b=>{var A;return s.indexOf(((A=b.track)===null||A===void 0?void 0:A.id)||"")!==-1});if(l.length!==s.length)throw new Error("Senders' length doesn't match mids' length.");l.map(async b=>{if(fT()&&b.track)b.track.enabled=!0;else{const A=b.getParameters();A.encodings.forEach(k=>k.active=!0),await b.setParameters(A)}});const p=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(p);const _=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:_})}catch(l){throw new ga(Di.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(l.toString()))}}restartICE(s){var l=this;return ES(function*(){const p=yield YE(l.mutex.lock("From P2PConnection.restartICE"));try{if(!l.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(L_().supportPCSetConfiguration){const j=l.peerConnection.getConfiguration(),z=s===_v.RELAY?"relay":"all";j.iceTransportPolicy!==z&&(_n.debug("[".concat(l.store.clientId,"] restartICE change iceTransportPolicy from [").concat(j.iceTransportPolicy,"] to [").concat(z,"]")),j.iceTransportPolicy=z,l.peerConnection.setConfiguration(j))}else if(s===_v.RELAY)return;s!==_v.RELAY&&l.remoteSDP.updateCandidates(s);const _=yield YE(l.peerConnection.createOffer({iceRestart:!0}));if(!_.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const b=$R(_.sdp),{remoteIceParameters:A}=yield b.iceParameters;l.remoteSDP.restartICE(A);const k=l.remoteSDP.toString();yield YE(l.peerConnection.setLocalDescription(_)),yield YE(l.peerConnection.setRemoteDescription({type:"answer",sdp:k}))}catch(_){_n.warning("[".concat(l.store.clientId,"] restart ICE failed, abort operation"),_)}finally{p()}})()}close(){var s;this.peerConnection.close(),(s=this.onConnectionStateChange)===null||s===void 0||s.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(s){return this.statsFilter.getVideoIsReady(s)}async updateEncoderConfig(s,l){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const p=await this.peerConnection.createOffer(),_=this.mungSendOfferSDP(p.sdp,[l]);this.remoteSDP.updateRecvMedia(l._mediaStreamTrack.kind,l);const b=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:_}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(p){throw new ga(Di.EXCHANGE_SDP_FAILED,p.toString())}}async updateSendParameters(s,l){const p=this.peerConnection.getSenders().filter(_=>{var b;return((b=_.track)===null||b===void 0?void 0:b.id)===s});p.length===1&&await this.applySendEncodings(p,[l])}setStatsRemoteVideoIsReady(s,l){this.statsFilter.setVideoIsReady2(s,l)}async replaceTrack(s,l){const p=this.peerConnection.getSenders().find(_=>{var b;return((b=_.track)===null||b===void 0?void 0:b.id)===l});p&&await p.replaceTrack(s._mediaStreamTrack)}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var s;(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var s;(s=this.onConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=s=>{s.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,_n.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,_n.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},_u("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(s){const l={iceServers:[],sdpSemantics:"plan-b"};return s.iceServers?l.iceServers=s.iceServers:s.turnServer&&s.turnServer.mode!=="off"&&(c0(s.turnServer.servers)?l.iceServers=s.turnServer.servers:(l.iceServers&&l.iceServers.push(...C0.turnServerConfigToIceServers(s.turnServer.servers)),_u("USE_TURN_SERVER_OF_GATEWAY")&&l.iceServers&&s.turnServer.serversFromGateway&&l.iceServers.push(...C0.turnServerConfigToIceServers(s.turnServer.serversFromGateway)),s.turnServer.servers.concat(s.turnServer.serversFromGateway||[]).forEach(p=>{p.forceturn&&(l.iceTransportPolicy="relay")}))),l}static turnServerConfigToIceServers(s){const l=[];return s.forEach(p=>{p.security?p.tcpport&&l.push({username:p.username,credential:p.password,credentialType:"password",urls:"turns:".concat(p.turnServerURL,":").concat(p.tcpport,"?transport=tcp")}):(p.udpport&&l.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.udpport,"?transport=udp")}),p.tcpport&&l.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.tcpport,"?transport=tcp")}))}),l}async applySendEncodings(s,l){try{if(!L_().supportSetRtpSenderParameters||s.length!==l.length)return;for(let _=0;_<s.length;_++){var p;const b=s[_],A=l[_];if(!A)continue;const k={},j={};if(A instanceof G_)switch(A._optimizationMode){case"motion":k.degradationPreference="maintain-framerate";break;case"detail":k.degradationPreference="maintain-resolution";break;default:k.degradationPreference="balanced"}if(_u("DSCP_TYPE")&&xR()){const $=_u("DSCP_TYPE");["very-low","low","medium","high"].includes($)&&(j.networkPriority=$)}const z=b.getParameters(),H=(p=z.encodings)===null||p===void 0?void 0:p[0];H&&Object.assign(H,j),Object.assign(z,k),await b.setParameters(z)}}catch{_n.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(s,l){const p=q_.exports.parse(s);return l.forEach((_,b)=>{const A=_._mediaStreamTrack,k=p.mediaDescriptions.find(j=>j.attributes.mid===A.kind);k&&jI(k,_)}),q_.exports.print(p)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=s=>{var l;(l=this.onFirstAudioReceived)===null||l===void 0||l.call(this,s)},this.statsFilter.onFirstVideoReceived=s=>{var l;(l=this.onFirstVideoReceived)===null||l===void 0||l.call(this,s)},this.statsFilter.onFirstAudioDecoded=s=>{var l;(l=this.onFirstAudioDecoded)===null||l===void 0||l.call(this,s)},this.statsFilter.onFirstVideoDecoded=(s,l,p)=>{var _;(_=this.onFirstVideoDecoded)===null||_===void 0||_.call(this,s,l,p)},this.statsFilter.onSelectedLocalCandidateChanged=(s,l)=>{var p;(p=this.onSelectedLocalCandidateChanged)===null||p===void 0||p.call(this,s,l)},this.statsFilter.onSelectedRemoteCandidateChanged=(s,l)=>{var p;(p=this.onSelectedRemoteCandidateChanged)===null||p===void 0||p.call(this,s,l)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const l=this.remoteSDP.batchSend(s).map((b,A)=>{let{id:k,mslabel:j}=b;const{kind:z}=s[A];return new RE((H,$)=>{const ue=setTimeout(()=>{$(new Error("Cannot receive track, id: ".concat(k)))},1e4),Ei=Fi=>{const Gi=r_();if(Gi.name==="Safari"&&Number(Gi.version)===11&&Fi.track.id!==k&&Fi.streams[0].id===j){var _o;const _f=Fi.streams[0].getTracks()[0];return(_o=this.remoteSDP)===null||_o===void 0||_o.updateTrackLabel(z,k,Fi.track.id),this.peerConnection.removeEventListener("track",Ei),clearTimeout(ue),void H({track:_f,id:k})}if(Fi.track.id===k)return this.peerConnection.removeEventListener("track",Ei),clearTimeout(ue),void H({track:Fi.track,id:k})};this.peerConnection.addEventListener("track",Ei)})}),p=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:p});const _=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(_),await RE.all(l)}catch(l){throw new ga(Di.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async getRemoteSSRC(s){if(!this.remoteSDP)return;const l=this.remoteSDP.getSSRC(s);return l==null?void 0:l[0].ssrcId}setConfiguration(s){if(L_().supportPCSetConfiguration){const l=C0.resolvePCConfiguration(s);this.peerConnection.setConfiguration(l)}}}).prototype,"connect",[oS],Object.getOwnPropertyDescriptor(l_.prototype,"connect"),l_.prototype),oE(l_.prototype,"stopSending",[oS],Object.getOwnPropertyDescriptor(l_.prototype,"stopSending"),l_.prototype),oE(l_.prototype,"receive",[oS],Object.getOwnPropertyDescriptor(l_.prototype,"receive"),l_.prototype),oE(l_.prototype,"stopReceiving",[oS],Object.getOwnPropertyDescriptor(l_.prototype,"stopReceiving"),l_.prototype),oE(l_.prototype,"muteRemote",[oS],Object.getOwnPropertyDescriptor(l_.prototype,"muteRemote"),l_.prototype),oE(l_.prototype,"unmuteRemote",[oS],Object.getOwnPropertyDescriptor(l_.prototype,"unmuteRemote"),l_.prototype),oE(l_.prototype,"muteLocal",[oS],Object.getOwnPropertyDescriptor(l_.prototype,"muteLocal"),l_.prototype),oE(l_.prototype,"unmuteLocal",[oS],Object.getOwnPropertyDescriptor(l_.prototype,"unmuteLocal"),l_.prototype),oE(l_.prototype,"close",[oS],Object.getOwnPropertyDescriptor(l_.prototype,"close"),l_.prototype),oE(l_.prototype,"updateEncoderConfig",[oS],Object.getOwnPropertyDescriptor(l_.prototype,"updateEncoderConfig"),l_.prototype),oE(l_.prototype,"updateSendParameters",[oS],Object.getOwnPropertyDescriptor(l_.prototype,"updateSendParameters"),l_.prototype),oE(l_.prototype,"replaceTrack",[oS],Object.getOwnPropertyDescriptor(l_.prototype,"replaceTrack"),l_.prototype),oE(l_.prototype,"getRemoteSSRC",[oS],Object.getOwnPropertyDescriptor(l_.prototype,"getRemoteSSRC"),l_.prototype),l_);function oS(o,s,l){const p=o[s];if(typeof p!="function")throw new Error("Cannot use mutex on object property.");return l.value=async function(){const _=this.mutex,b=await _.lock("Locking from P2PConnection.".concat(s));try{for(var A=arguments.length,k=new Array(A),j=0;j<A;j++)k[j]=arguments[j];return await p.apply(this,k)}finally{b()}},l}function a4(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function c4(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?a4(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):a4(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}const _C="9",u4=4e4;class GQ{get localCapabilities(){return B_(this._localCapabilities)}get rtpCapabilities(){return B_(this._rtpCapabilities)}get candidates(){return B_(this._candidates)}get iceParameters(){return B_(this._iceParameters)}get dtlsParameters(){return B_(this._dtlsParameters)}constructor(s){_t(this,"sessionDesc",void 0),_t(this,"_localCapabilities",void 0),_t(this,"_rtpCapabilities",void 0),_t(this,"_candidates",void 0),_t(this,"_iceParameters",void 0),_t(this,"_dtlsParameters",void 0),_t(this,"setup",void 0),_t(this,"currentMidIndex",void 0),_t(this,"cname",void 0),_t(this,"firefoxSsrcMidMap",new Map),s=B_(s);const{remoteIceParameters:l,remoteDtlsParameters:p,candidates:_,remoteRTPCapabilities:b,remoteSetup:A,localCapabilities:k,cname:j}=s,z=q_.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=b,this._candidates=_,this._iceParameters=l,this._dtlsParameters=p,this._localCapabilities=k,this.setup=A,this.cname=j;const H=this.rtpCapabilities.send;for(const $ of z.mediaDescriptions){if($.attributes.iceUfrag=l.iceUfrag,$.attributes.icePwd=l.icePwd,$.attributes.fingerprints=p.fingerprints,$.attributes.candidates=_,$.attributes.setup=A,$.media.mediaType==="video"&&($.media.fmts=H.videoCodecs.map(ue=>ue.payloadType.toString(10)),$.attributes.payloads=H.videoCodecs,$.attributes.extmaps=H.videoExtensions,_u("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:ue,ssrcGroups:Ei}=iS([{ssrcId:u4,rtx:_u("USE_SUB_RTX")?40001:void 0}],this.cname);$.attributes.ssrcs=ue,$.attributes.ssrcGroups=Ei}if($.media.mediaType==="audio"&&($.media.fmts=H.audioCodecs.map(ue=>ue.payloadType.toString(10)),$.attributes.payloads=H.audioCodecs,$.attributes.extmaps=H.audioExtensions,yR($),_u("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:ue,ssrcGroups:Ei}=iS([{ssrcId:2e4}],this.cname);$.attributes.ssrcs=ue,$.attributes.ssrcGroups=Ei}}this.sessionDesc=z,this.currentMidIndex=z.mediaDescriptions.length-1}preloadRemoteMedia(){const s=_u("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const l=this.candidates,p=this.dtlsParameters,_=this.iceParameters,b=this.rtpCapabilities.send;for(let A=1;A<s;A++){const k=2*A+2e4,j=2*A+u4,{ssrcs:z,ssrcGroups:H}=iS([{ssrcId:k}],this.cname),{ssrcs:$,ssrcGroups:ue}=iS([{ssrcId:j,rtx:_u("USE_SUB_RTX")?j+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:_C,protos:["UDP","TLS","RTP","SAVPF"],fmts:b.videoCodecs.map(Ei=>Ei.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:_.iceUfrag,icePwd:_.icePwd,unrecognized:[],candidates:l,extmaps:b.videoExtensions,fingerprints:p.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:$,ssrcGroups:ue,rtcpFeedbackWildcards:[],payloads:b.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*A)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:_C,protos:["UDP","TLS","RTP","SAVPF"],fmts:b.audioCodecs.map(Ei=>Ei.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:_.iceUfrag,icePwd:_.icePwd,unrecognized:[],candidates:l,extmaps:b.audioExtensions,fingerprints:p.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:z,ssrcGroups:H,rtcpFeedbackWildcards:[],payloads:b.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*A+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return q_.exports.print(this.sessionDesc)}send(s,l,p,_){const{ssrcs:b,ssrcGroups:A}=iS(l,this.cname,_u("SYNC_GROUP")?p:void 0),k=this.findPreloadMediaDesc(b);if(k){if(O_()&&this.firefoxSsrcMidMap.set(b[0].ssrcId,k.attributes.mid),_&&(_.twcc||_.remb)){const j=this.sessionDesc.mediaDescriptions.indexOf(k);return this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(k,_),{mid:k.attributes.mid,needExchangeSDP:!0}}return{mid:k.attributes.mid,needExchangeSDP:!1}}{const j=this.findAvailableMediaIndex(s,b);let z;return j===-1||j===1&&(fT()||s2())||j===0&&_u("USE_SUB_RTX")||a2()?(z=this.createOrRecycleSendMedia(s,b,A,"sendonly",_),this.updateBundleMids()):(z=B_(this.sessionDesc.mediaDescriptions[j]),z.attributes.direction="sendonly",z.attributes.ssrcs=b,z.attributes.ssrcGroups=A,this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(z,_)),O_()&&this.firefoxSsrcMidMap.set(b[0].ssrcId,z.attributes.mid),{mid:z.attributes.mid,needExchangeSDP:!0}}}batchSend(s){const l=s.map(b=>{let{kind:A,ssrcMsg:k,mslabel:j}=b;return this.send(A,k,j)}),p=[];let _=!1;return l.forEach(b=>{let{mid:A,needExchangeSDP:k}=b;k&&(_=!0),p.push(A)}),{mids:p,needExchangeSDP:_}}stopSending(s){const l=this.sessionDesc.mediaDescriptions.filter(p=>p.attributes.mid&&s.indexOf(p.attributes.mid)!==-1);if(l.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");l.forEach(p=>{p.attributes.mid==="0"||O_()||a2()?p.attributes.ssrcs=[]:(p.attributes.ssrcs=[],p.attributes.direction="inactive",p.media.port="0")}),this.updateBundleMids()}mute(s){const l=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===s);if(!l)throw new Error("mediaDescription not found with ".concat(s," in remote SDP when calling RemoteSDP.mute."));l.attributes.direction="inactive"}unmute(s){const l=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===s);if(!l)throw new Error("mediaDescription not found with ".concat(s," in remote SDP when calling RemoteSDP.unmute."));l.attributes.direction="sendonly"}muteRemote(s){const l=this.sessionDesc.mediaDescriptions.filter(p=>s.includes(p.attributes.mid||""));if(l.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");l.forEach(p=>{p.attributes.direction="inactive"})}unmuteRemote(s){const l=this.sessionDesc.mediaDescriptions.filter(p=>s.includes(p.attributes.mid||""));if(l.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");l.forEach(p=>{p.attributes.direction="recvonly"})}receive(s,l,p,_){s.forEach((b,A)=>{this.createOrRecycleRecvMedia(b,[],"recvonly",l,p,_[A])}),this.updateBundleMids()}stopReceiving(s){const l=this.sessionDesc.mediaDescriptions.filter(p=>s.indexOf(p.attributes.mid)!==-1);if(l.length!==s.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");l.forEach(p=>{p.media.port="0",p.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(s){s===_v.TCP?this._candidates.forEach(l=>{this._candidates.findIndex(p=>p.transport==="tcp"&&p.connectionAddress===l.connectionAddress&&p.port===l.port)===-1&&this._candidates.push(c4(c4({},l),{},{foundation:"tcpcandidate",priority:Number(l.priority)-1+"",transport:"tcp",port:Number(l.port)+90+""}))}):this._candidates=this._candidates.filter(l=>l.transport!=="tcp");for(const l of this.sessionDesc.mediaDescriptions)l.attributes.candidates=this.candidates}restartICE(s){s=B_(s),this._iceParameters=s,this.sessionDesc.mediaDescriptions.forEach(l=>{l.attributes.iceUfrag=s.iceUfrag,l.attributes.icePwd=s.icePwd})}predictReceivingMids(s){const l=[];for(let p=0;p<s;p++)l.push((this.currentMidIndex+p+1).toString(10));return l}findAvailableMediaIndex(s,l){return this.sessionDesc.mediaDescriptions.findIndex(p=>{const _=p.media.mediaType===s&&p.media.port!=="0"&&(p.attributes.direction==="sendonly"||p.attributes.direction==="sendrecv")&&p.attributes.ssrcs.length===0;if(O_()){if(_){const b=this.firefoxSsrcMidMap.get(l[0].ssrcId);return!(b||p.attributes.mid!=="0"&&p.attributes.mid!=="1")||!(!b||b!==p.attributes.mid)}return!1}return _})}createOrRecycleRecvMedia(s,l,p,_,b,A){const k=s._mediaStreamTrack.kind,j=this.rtpCapabilities.recv,z=this.localCapabilities.send;let H=[];if(k===FE.VIDEO){var $,ue;if(_u("H264_PROFILE_LEVEL_ID")&&_==="h264"&&(H=j.videoCodecs.filter(_f=>{var vf,uE;return(((vf=_f.rtpMap)===null||vf===void 0?void 0:vf.encodingName.toLowerCase())||"").includes(_)&&(_f==null||(uE=_f.fmtp)===null||uE===void 0?void 0:uE.parameters["profile-level-id"])===_u("H264_PROFILE_LEVEL_ID")})),!H||(($=H)===null||$===void 0?void 0:$.length)===0){const _f=z.videoCodecs.filter(vf=>{var uE;return(((uE=vf.rtpMap)===null||uE===void 0?void 0:uE.encodingName.toLowerCase())||"").includes(_)});_f.length!==0&&(H=j.videoCodecs.filter(vf=>_f.some(uE=>uE.payloadType===vf.payloadType)))}if(_u("USE_PUB_RTX")){const _f=H.map(uE=>uE.payloadType.toString()),vf=j.videoCodecs.filter(uE=>{var IE,lE;return((IE=uE.rtpMap)===null||IE===void 0?void 0:IE.encodingName)==="rtx"&&_f.includes(((lE=uE.fmtp)===null||lE===void 0?void 0:lE.parameters.apt)||"")});H=[...H,...vf]}H.length===0&&(_n.warning("codec ".concat(_," not included in rtpCapabilities, fallback to default payloads: ").concat((ue=j.videoCodecs[0].rtpMap)===null||ue===void 0?void 0:ue.encodingName)),H=j.videoCodecs)}else H=j.audioCodecs.filter(_f=>{var vf;return(((vf=_f.rtpMap)===null||vf===void 0?void 0:vf.encodingName.toLowerCase())||"").includes(b)}),H.length===0&&(_n.warning("codec ".concat(b," not included in rtpCapabilities, fallback to opus")),H=j.audioCodecs.filter(_f=>{var vf;return(((vf=_f.rtpMap)===null||vf===void 0?void 0:vf.encodingName.toLowerCase())||"").includes("opus")}));const Ei=k===FE.VIDEO?j.videoExtensions:j.audioExtensions;this.currentMidIndex+=1;const Fi="".concat(this.currentMidIndex);let Gi={media:{mediaType:k,port:_C,protos:["UDP","TLS","RTP","SAVPF"],fmts:H.map(_f=>_f.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Ei,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:H,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:p,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Fi)}};Gi=this.mungRecvMediaDsec(Gi,s,A);const _o=this.findFirstClosedMedia(k);if(_o){const _f=this.sessionDesc.mediaDescriptions.indexOf(_o);this.sessionDesc.mediaDescriptions[_f]=Gi}else this.sessionDesc.mediaDescriptions.push(Gi);return Gi}createOrRecycleSendMedia(s,l,p,_,b){const A=this.rtpCapabilities.send,k=s===FE.VIDEO?A.videoCodecs:A.audioCodecs,j=s===FE.VIDEO?A.videoExtensions:A.audioExtensions;this.currentMidIndex+=1;const z="".concat(this.currentMidIndex);let H={media:{mediaType:s,port:_C,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.map(ue=>ue.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:j,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:k,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:_,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(z)}};H=this.mungSendMediaDesc(H,b);const $=this.findFirstClosedMedia(s);if($){const ue=this.sessionDesc.mediaDescriptions.indexOf($);this.sessionDesc.mediaDescriptions[ue]=H}else this.sessionDesc.mediaDescriptions.push(H);return H}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(s=>s.media.port!=="0").map(s=>s.attributes.mid)}mungRecvMediaDsec(s,l,p){const _=B_(s);return ML(_),jI(_,l),UL(_,l),WG(_),_A(_,p,this.localCapabilities.send),_}mungSendMediaDesc(s,l){const p=B_(s);return _A(p,l,this.localCapabilities.recv),yR(p),p}updateRecvMedia(s,l){const p=this.sessionDesc.mediaDescriptions.findIndex(_=>_.attributes.mid===s);if(p!==-1){const _=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],l);this.sessionDesc.mediaDescriptions[p]=_}}bumpMid(s){this.currentMidIndex+=s}findFirstClosedMedia(s){return this.sessionDesc.mediaDescriptions.find(l=>O_()?l.media.port==="0"&&l.media.mediaType===s:l.media.port==="0")}findPreloadMediaDesc(s){return this.sessionDesc.mediaDescriptions.find(l=>{var p,_;return((p=l.attributes)===null||p===void 0||(_=p.ssrcs[0])===null||_===void 0?void 0:_.ssrcId)===s[0].ssrcId})}getSSRC(s){var l;return(l=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===s))===null||l===void 0?void 0:l.attributes.ssrcs}}var h_;function d4(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function VI(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?d4(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):d4(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}let eR=(oE((h_=class N0 extends DO{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var s,l,p;return(s=(l=this.peerConnection.getReceivers()[0])===null||l===void 0||(p=l.transport)===null||p===void 0?void 0:p.state)!==null&&s!==void 0?s:null}constructor(s,l){super(s,l),_t(this,"store",void 0),_t(this,"peerConnection",void 0),_t(this,"remoteSDP",void 0),_t(this,"initialOffer",void 0),_t(this,"transportEventReceiver",void 0),_t(this,"statsFilter",void 0),_t(this,"localCapabilities",void 0),_t(this,"localCandidateCount",0),_t(this,"allCandidatesReceived",!1),_t(this,"selectedCandidatePairTimer",void 0),_t(this,"establishPromise",void 0),_t(this,"mutex",new gT("P2PConnection-mutex")),this.store=l,this.peerConnection=new RTCPeerConnection(N0.resolvePCConfiguration(s),{optional:[{googDscp:!0}]}),this.statsFilter=FL(this.peerConnection,_u("STATS_UPDATE_INTERVAL"),void 0,O_()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const l=$R(s.sdp),p=await HG(!_u("USE_PUB_RTX")&&!_u("USE_SUB_RTX"),_u("FILTER_VIDEO_FEC"),_u("FILTER_AUDIO_FEC"));return this.localCapabilities=xL(p),this.initialOffer=s,VI(VI({},l),{},{rtpCapabilities:p,offerSDP:s.sdp})}catch(s){throw new ga(Di.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(s,l,p,_,b,A){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new GQ({remoteIceParameters:s,remoteDtlsParameters:l,candidates:p,remoteRTPCapabilities:_,remoteSetup:b,localCapabilities:this.localCapabilities,cname:A});const k=this.remoteSDP.toString(),j=q_.exports.parse(this.initialOffer.sdp),z=j.mediaDescriptions.find(Ei=>Ei.media.mediaType==="audio");z&&yR(z);const H=q_.exports.print(j),$=this.logSDPExchange(H||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:H}),$==null||$(k),await this.peerConnection.setRemoteDescription({type:"answer",sdp:k});const ue=this.peerConnection.getTransceivers()[0];if(ue!=null&&ue.receiver&&this.tryBindTransportEvents(ue.receiver),_u("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const Ei=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:Ei});const Fi=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(Fi)}}catch(k){throw new ga(Di.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(k.toString()))}}send(s,l,p){var _=this;return ES(function*(){const b=yield YE(_.mutex.lock("From P2PConnection.send"));try{if(!_.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const A=[];s.forEach(Gi=>{const _o=_.peerConnection.addTransceiver(Gi._mediaStreamTrack,{direction:"sendonly"});A.push(_o),Gi._updateRtpTransceiver(_o)}),O_()&&_u("SIMULCAST")===!0&&(yield YE(_.applySimulcastForFirefox(A,s)));const k=yield YE(_.peerConnection.createOffer()),j=_.remoteSDP.predictReceivingMids(s.length),z=_.mungSendOfferSDP(k.sdp,s,j),H=q_.exports.parse(z),$=j.map(Gi=>{const _o=H.mediaDescriptions.find(_f=>_f.attributes.mid===Gi);if(!_o)throw new Error("Cannot extract ssrc from mediaDescription.");return GG(_o,_u("USE_PUB_RTX"))});let ue;try{ue=yield $}catch(Gi){ue=[],_.remoteSDP.receive(s,l,p,ue);const _o=_.remoteSDP.toString();throw yield YE(_.peerConnection.setLocalDescription({type:"offer",sdp:z})),yield YE(_.peerConnection.setRemoteDescription({type:"answer",sdp:_o})),yield YE(_.stopSending(j,!0)),Gi}_.remoteSDP.receive(s,l,p,ue);const Ei=_.remoteSDP.toString(),Fi=_.logSDPExchange(z,"offer","local","send");return yield YE(_.peerConnection.setLocalDescription({type:"offer",sdp:z})),yield YE(_.applySimulcastEncodings(A,s)),yield YE(_.applySendEncodings(A,s)),Fi==null||Fi(Ei),yield YE(_.peerConnection.setRemoteDescription({type:"answer",sdp:Ei})),A.map((Gi,_o)=>{const _f=j[_o];return{localSSRC:$[_o],id:_f,transceiver:Gi}})}catch(A){throw A instanceof ga?A:new ga(Di.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(A.toString()))}finally{b()}})()}async stopSending(s,l){const p=l?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const _=this.peerConnection.getTransceivers().filter(j=>s.indexOf(j.mid)!==-1);if(_.length!==s.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");_.map(j=>{var z;j.direction="inactive",(z=j.stop)===null||z===void 0||z.call(j)});const b=await this.peerConnection.createOffer(),A=this.logSDPExchange(b.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(b),this.remoteSDP.stopReceiving(s);const k=this.remoteSDP.toString();A==null||A(k),await this.peerConnection.setRemoteDescription({type:"answer",sdp:k})}catch(_){throw new ga(Di.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(_.toString()))}finally{p&&p()}}async receive(s,l,p,_){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(s," before remoteSDP created."));const{mid:b,needExchangeSDP:A}=this.remoteSDP.send(s,l,p,_);if(A){const j=this.remoteSDP.toString(),z=this.logSDPExchange(j,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:j});const H=await this.peerConnection.createAnswer(),$=this.mungReceiveAnswerSDP(H.sdp,b,s);z==null||z($||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:$}),_n.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(s," by exchanging SDP."))}else _n.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(s," no need to exchange SDP."));const k=this.peerConnection.getTransceivers().find(j=>j.mid===b);if(!k)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:k.receiver.track,id:b,transceiver:k}}catch(b){throw new ga(Di.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(b.toString()))}}async batchReceive(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:l,needExchangeSDP:p}=this.remoteSDP.batchSend(s);if(p){const _=this.remoteSDP.toString(),b=this.logSDPExchange(_,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const A=await this.peerConnection.createAnswer();b==null||b(A.sdp||""),await this.peerConnection.setLocalDescription(A),_n.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else _n.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return l.map(_=>{const b=this.peerConnection.getTransceivers().find(A=>A.mid===_);if(!b)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:b.receiver.track,id:_,transceiver:b}})}catch(l){throw new ga(Di.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(s);const l=this.remoteSDP.toString(),p=this.logSDPExchange(l,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const _=await this.peerConnection.createAnswer();p==null||p(_.sdp||""),await this.peerConnection.setLocalDescription(_)}catch(l){throw new ga(Di.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(l.toString()))}}async muteRemote(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(s," before remote SDP created."));this.remoteSDP.mute(s);const l=this.remoteSDP.toString(),p=this.logSDPExchange(l,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const _=await this.peerConnection.createAnswer();p==null||p(_.sdp||""),await this.peerConnection.setLocalDescription(_)}catch(l){throw new ga(Di.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(l.toString()))}}async unmuteRemote(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(s," before remote SDP created."));this.remoteSDP.unmute(s);const l=this.remoteSDP.toString(),p=this.logSDPExchange(l,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const _=await this.peerConnection.createAnswer();p==null||p(_.sdp||""),await this.peerConnection.setLocalDescription(_)}catch(l){throw new ga(Di.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(l.toString()))}}async muteLocal(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const l=this.peerConnection.getTransceivers().filter(A=>A.mid&&s.indexOf(A.mid)!==-1);if(l.length!==s.length)throw new Error("Transceivers' length doesn't match mids' length.");l.map(A=>{A.direction="inactive"});const p=await this.peerConnection.createOffer(),_=this.logSDPExchange(p.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(p),this.remoteSDP.muteRemote(s);const b=this.remoteSDP.toString();_==null||_(b),await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(l){throw new ga(Di.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(l.toString()))}}async unmuteLocal(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const l=this.peerConnection.getTransceivers().filter(A=>A.mid&&s.indexOf(A.mid)!==-1);if(l.length!==s.length)throw new Error("Transceivers' length doesn't match mids' length.");l.map(async(A,k)=>{A.direction="sendonly"});const p=await this.peerConnection.createOffer(),_=this.logSDPExchange(p.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(p),this.remoteSDP.unmuteRemote(s);const b=this.remoteSDP.toString();_==null||_(b),await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(l){throw new ga(Di.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(l.toString()))}}restartICE(s){var l=this;return ES(function*(){const p=yield YE(l.mutex.lock("From P2PConnection.restartICE"));try{if(!l.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(L_().supportPCSetConfiguration){const z=l.peerConnection.getConfiguration(),H=s===_v.RELAY?"relay":"all";z.iceTransportPolicy!==H&&(_n.debug("[".concat(l.store.clientId,"] restartICE change iceTransportPolicy from [").concat(z.iceTransportPolicy,"] to [").concat(H,"]")),z.iceTransportPolicy=H,l.peerConnection.setConfiguration(z))}else if(s===_v.RELAY)return;s!==_v.RELAY&&l.remoteSDP.updateCandidates(s);const _=yield YE(l.peerConnection.createOffer({iceRestart:!0}));if(!_.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const b=$R(_.sdp),{remoteIceParameters:A}=yield b.iceParameters;l.remoteSDP.restartICE(A);const k=l.remoteSDP.toString(),j=l.logSDPExchange(_.sdp||"","offer","local","restartICE");l.store.descriptionStart(),yield YE(l.peerConnection.setLocalDescription(_)),j==null||j(k),yield YE(l.peerConnection.setRemoteDescription({type:"answer",sdp:k}))}catch(_){_n.warning("[".concat(l.store.clientId,"] restart ICE failed, abort operation"),_)}finally{p()}})()}close(){var s;this.peerConnection.close(),(s=this.onConnectionStateChange)===null||s===void 0||s.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(s){return this.statsFilter.getVideoIsReady(s)}async updateEncoderConfig(s,l){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const p=await this.peerConnection.createOffer(),_=this.mungSendOfferSDP(p.sdp,[l],[s]);this.remoteSDP.updateRecvMedia(s,l);const b=this.remoteSDP.toString(),A=this.logSDPExchange(_,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:_}),A==null||A(b),await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(p){throw new ga(Di.EXCHANGE_SDP_FAILED,p.toString())}}async updateSendParameters(s,l){const p=this.peerConnection.getTransceivers().filter(_=>_.mid===s);p.length===1&&(this.isVP8Simulcast(l)?O_()||await this.applySimulcastEncodings(p,[l]):await this.applySendEncodings(p,[l]))}setStatsRemoteVideoIsReady(s,l){this.statsFilter.setVideoIsReady2(s,l)}async replaceTrack(s,l){const p=this.peerConnection.getTransceivers().find(_=>_.mid===l);p&&await p.sender.replaceTrack(s._mediaStreamTrack)}async getSelectedCandidatePair(){const s=this.peerConnection.getReceivers();if(s.length>0&&s[0].transport&&s[0].transport.iceTransport&&s[0].transport.iceTransport.getSelectedCandidatePair&&s[0].transport.iceTransport.getSelectedCandidatePair()){const l=s[0].transport.iceTransport,{local:p,remote:_}=l.getSelectedCandidatePair();return{local:VI(VI({},bR),{},{candidateType:p.type,protocol:p.protocol,address:p.address,port:p.port}),remote:VI(VI({},bR),{},{candidateType:_.type,protocol:_.protocol,address:_.address,port:_.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var s;(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var s;(s=this.onConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=s=>{s.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,_n.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,_n.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},_u("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(s){const l={iceServers:[]};return s.iceServers?l.iceServers=s.iceServers:s.turnServer&&s.turnServer.mode!=="off"&&(c0(s.turnServer.servers)?l.iceServers=s.turnServer.servers:(l.iceServers&&l.iceServers.push(...N0.turnServerConfigToIceServers(s.turnServer.servers)),_u("USE_TURN_SERVER_OF_GATEWAY")&&l.iceServers&&s.turnServer.serversFromGateway&&l.iceServers.push(...N0.turnServerConfigToIceServers(s.turnServer.serversFromGateway)),_u("FORCE_TURN_TCP")?l.iceTransportPolicy="relay":s.turnServer.servers.concat(s.turnServer.serversFromGateway||[]).forEach(p=>{p.forceturn&&(l.iceTransportPolicy="relay")}))),_u("ENABLE_ENCODED_TRANSFORM")&&L_().supportWebRTCEncodedTransform&&(l.encodedInsertableStreams=!0),l}static turnServerConfigToIceServers(s){const l=[];return s.forEach(p=>{p.security?p.tcpport&&l.push({username:p.username,credential:p.password,credentialType:"password",urls:"turns:".concat(FO(p.turnServerURL),":").concat(p.tcpport,"?transport=tcp")}):(p.udpport&&!_u("FORCE_TURN_TCP")&&l.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.udpport,"?transport=udp")}),p.tcpport&&l.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.tcpport,"?transport=tcp")}))}),l}tryBindTransportEvents(s){const l=s.transport;if(l){this.transportEventReceiver=s,l.onstatechange=()=>{var _;l!=null&&l.state&&((_=this.onDTLSTransportStateChange)===null||_===void 0||_.call(this,l.state))},l.onerror=_=>{var b;(b=this.onDTLSTransportError)===null||b===void 0||b.call(this,"error"in _?_.error:_)};const p=l.iceTransport;p&&(p.onstatechange=()=>{const _=l==null?void 0:l.iceTransport.state;var b;_&&((b=this.onICETransportStateChange)===null||b===void 0||b.call(this,_))},p.getSelectedCandidatePair&&(p.onselectedcandidatepairchange=()=>{if(p.getSelectedCandidatePair()){const{local:_,remote:b}=p.getSelectedCandidatePair();_n.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:_.type,protocol:_.protocol}),", remote ").concat(JSON.stringify({candidateType:b.type,protocol:b.protocol,address:b.address,port:b.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async applySendEncodings(s,l){try{if(!L_().supportSetRtpSenderParameters||s.length!==l.length)return;for(let z=0;z<s.length;z++){const H=s[z],$=l[z];if($&&$ instanceof G_){var p,_;if(this.isVP8Simulcast($))continue;const ue={},Ei={};switch($._optimizationMode){case"motion":ue.degradationPreference="maintain-framerate";break;case"detail":ue.degradationPreference="maintain-resolution";break;default:ue.degradationPreference="balanced"}var b,A,k,j;if((p=$._encoderConfig)!==null&&p!==void 0&&p.bitrateMax&&(Ei.maxBitrate=1e3*((b=$._encoderConfig)===null||b===void 0?void 0:b.bitrateMax)),$._hints.includes(J_.LOW_STREAM)&&((A=$._encoderConfig)!==null&&A!==void 0&&A.frameRate&&(Ei.maxFramerate=$S($._encoderConfig.frameRate)),(k=$._encoderConfig)!==null&&k!==void 0&&k.scaleResolutionDownBy&&((j=$._encoderConfig)===null||j===void 0?void 0:j.scaleResolutionDownBy)>1&&(Ei.scaleResolutionDownBy=$._encoderConfig.scaleResolutionDownBy)),_u("DSCP_TYPE")&&xR()){const _o=_u("DSCP_TYPE");["very-low","low","medium","high"].includes(_o)&&(Ei.networkPriority=_o)}const Fi=H.sender.getParameters(),Gi=(_=Fi.encodings)===null||_===void 0?void 0:_[0];O_()&&!Gi&&(ue.encodings=[Ei]),Gi&&Object.assign(Gi,Ei),Object.assign(Fi,ue),await H.sender.setParameters(Fi)}}}catch{_n.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(s,l,p){const _=q_.exports.parse(s);return l.forEach((b,A)=>{const k=p[A],j=_.mediaDescriptions.find(z=>z.attributes.mid===k);j&&(jI(j,b),KG(j,b,this.store.codec))}),q_.exports.print(_)}mungReceiveAnswerSDP(s,l,p){const _=q_.exports.parse(s),b=_.mediaDescriptions.find(A=>A.attributes.mid===l);return b&&p===FE.AUDIO&&b.media.mediaType==="audio"&&yR(b),q_.exports.print(_)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=s=>{var l;(l=this.onFirstAudioReceived)===null||l===void 0||l.call(this,s)},this.statsFilter.onFirstVideoReceived=s=>{var l;(l=this.onFirstVideoReceived)===null||l===void 0||l.call(this,s)},this.statsFilter.onFirstAudioDecoded=s=>{var l;(l=this.onFirstAudioDecoded)===null||l===void 0||l.call(this,s)},this.statsFilter.onFirstVideoDecoded=(s,l,p)=>{var _;(_=this.onFirstVideoDecoded)===null||_===void 0||_.call(this,s,l,p)},this.statsFilter.onSelectedLocalCandidateChanged=(s,l)=>{var p;(p=this.onSelectedLocalCandidateChanged)===null||p===void 0||p.call(this,s,l)},this.statsFilter.onSelectedRemoteCandidateChanged=(s,l)=>{var p;(p=this.onSelectedRemoteCandidateChanged)===null||p===void 0||p.call(this,s,l)},this.statsFilter.onFirstVideoDecodedTimeout=s=>{var l;(l=this.onFirstVideoDecodedTimeout)===null||l===void 0||l.call(this,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(s,l){if(s.length===l.length)for(let k=0;k<s.length;k++){var p,_,b,A;const j=s[k],z=l[k];if(z instanceof G_&&!z._hints.includes(J_.LOW_STREAM)&&(p=z._encoderConfig)!==null&&p!==void 0&&p.bitrateMax&&((_=z._encoderConfig)===null||_===void 0?void 0:_.bitrateMax)>200&&(b=z._scalabiltyMode)!==null&&b!==void 0&&b.numSpatialLayers&&((A=z._scalabiltyMode)===null||A===void 0?void 0:A.numSpatialLayers)>1&&this.store.codec==="vp8"){const H={},$={high:1e3*(z._encoderConfig.bitrateMax-50),medium:5e4};H.encodings=[{rid:"m",active:!0,maxBitrate:$.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:$.high}];const ue=j.sender.getParameters();await j.sender.setParameters(Object.assign(ue,H))}}}async applySimulcastEncodings(s,l){if(!O_()&&s.length===l.length)for(let p=0;p<s.length;p++){const _=l[p];if(_ instanceof G_&&this.isVP8Simulcast(_)){const b=s[p],A={},k={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};A.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:k.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:k.medium,scaleResolutionDownBy:4}];const j=b.sender.getParameters();await b.sender.setParameters(Object.assign(j,A))}}}isVP8Simulcast(s){var l,p,_,b;return!!(s instanceof G_&&_u("SIMULCAST")&&this.store.codec==="vp8"&&!s._hints.includes(J_.LOW_STREAM)&&(l=s._encoderConfig)!==null&&l!==void 0&&l.bitrateMax&&((p=s._encoderConfig)===null||p===void 0?void 0:p.bitrateMax)>200&&(_=s._scalabiltyMode)!==null&&_!==void 0&&_.numSpatialLayers&&((b=s._scalabiltyMode)===null||b===void 0?void 0:b.numSpatialLayers)>1)}logSDPExchange(s,l,p,_){if(_u("SDP_LOGGING"))return _n.upload("[".concat(this.store.clientId,"] exchanging ").concat(p," ").concat(l," SDP during P2PConnection.").concat(_,`
`),s),l==="offer"?b=>{this.logSDPExchange(b,"answer",p==="local"?"remote":"local",_)}:void 0}async getRemoteSSRC(s){if(!this.remoteSDP)return;const l=this.remoteSDP.getSSRC(s);return l==null?void 0:l[0].ssrcId}setConfiguration(s){if(L_().supportPCSetConfiguration){const l=N0.resolvePCConfiguration(s);this.peerConnection.setConfiguration(l)}}}).prototype,"connect",[sS],Object.getOwnPropertyDescriptor(h_.prototype,"connect"),h_.prototype),oE(h_.prototype,"receive",[sS],Object.getOwnPropertyDescriptor(h_.prototype,"receive"),h_.prototype),oE(h_.prototype,"batchReceive",[sS],Object.getOwnPropertyDescriptor(h_.prototype,"batchReceive"),h_.prototype),oE(h_.prototype,"stopReceiving",[sS],Object.getOwnPropertyDescriptor(h_.prototype,"stopReceiving"),h_.prototype),oE(h_.prototype,"muteRemote",[sS],Object.getOwnPropertyDescriptor(h_.prototype,"muteRemote"),h_.prototype),oE(h_.prototype,"unmuteRemote",[sS],Object.getOwnPropertyDescriptor(h_.prototype,"unmuteRemote"),h_.prototype),oE(h_.prototype,"muteLocal",[sS],Object.getOwnPropertyDescriptor(h_.prototype,"muteLocal"),h_.prototype),oE(h_.prototype,"unmuteLocal",[sS],Object.getOwnPropertyDescriptor(h_.prototype,"unmuteLocal"),h_.prototype),oE(h_.prototype,"close",[sS],Object.getOwnPropertyDescriptor(h_.prototype,"close"),h_.prototype),oE(h_.prototype,"updateEncoderConfig",[sS],Object.getOwnPropertyDescriptor(h_.prototype,"updateEncoderConfig"),h_.prototype),oE(h_.prototype,"updateSendParameters",[sS],Object.getOwnPropertyDescriptor(h_.prototype,"updateSendParameters"),h_.prototype),oE(h_.prototype,"replaceTrack",[sS],Object.getOwnPropertyDescriptor(h_.prototype,"replaceTrack"),h_.prototype),oE(h_.prototype,"getRemoteSSRC",[sS],Object.getOwnPropertyDescriptor(h_.prototype,"getRemoteSSRC"),h_.prototype),h_);function sS(o,s,l){const p=o[s];if(typeof p!="function")throw new Error("Cannot use mutex on object property.");return l.value=async function(){const _=this.mutex,b=await _.lock("From P2PConnection.".concat(s));try{for(var A=arguments.length,k=new Array(A),j=0;j<A;j++)k[j]=arguments[j];return await p.apply(this,k)}finally{b()}},l}function l4(o,s){let l=document.createElement("video"),p=document.createElement("canvas");l.setAttribute("style","display:none"),p.setAttribute("style","display:none"),l.setAttribute("muted",""),l.muted=!0,l.setAttribute("autoplay",""),l.autoplay=!0,l.setAttribute("playsinline",""),p.width=$S(s.width),p.height=$S(s.height);const _=$S(s.framerate||15);document.body.append(l),document.body.append(p);let b=o._mediaStreamTrack;l.srcObject=new MediaStream([b]),l.play();const A=p.getContext("2d");if(!A)throw new ga(Di.UNEXPECTED_ERROR,"can not get canvas context");const k=L_(),j=p.captureStream(k.supportRequestFrame?0:_).getVideoTracks()[0],z=MV(()=>(()=>{if(l.paused&&l.play(),l.videoHeight>2&&l.videoWidth>2){const $=l.videoWidth,ue=l.videoHeight/$,Ei=p.width*ue;Math.abs(Ei-p.height)>=2&&(_n.debug("adjust low stream resolution","".concat(p.width,"x").concat(p.height," -> ").concat(p.width,"x").concat(Ei)),p.height=Ei)}A.drawImage(l,0,0,p.width,p.height),j.requestFrame&&j.requestFrame(),b!==o._mediaStreamTrack&&(b=o._mediaStreamTrack,l.srcObject=new MediaStream([b]))})(),_),H=j.stop;return j.stop=()=>{H.call(j),z(),l&&(l.remove(),l=null),p&&(p.width=0,p.remove(),p=null),_n.debug("clean low stream renderer")},j}var h4,p4,f4,E4,aS,m4,_4,g4,v4,y4,b4,pT;function T4(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function tN(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?T4(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):T4(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}class S4 extends PV{getUserId(){return this._userId}constructor(s,l,p,_){super(s,"track-".concat(s.kind,"-").concat(l,"-").concat(_.clientId,"_").concat(y_(5,""))),_t(this,"_userId",void 0),_t(this,"_uintId",void 0),_t(this,"_isDestroyed",!1),_t(this,"store",void 0),_t(this,"processor",void 0),_t(this,"processorContext",void 0),this._userId=l,this._uintId=p,this.store=_}_updateOriginMediaStreamTrack(s){this._originMediaStreamTrack=s,this._mediaStreamTrack=s,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,_n.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let eN=(h4=kE({argsMap:(o,s,l)=>[o.getTrackId(),typeof s=="string"?s:s instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",l]}),p4=kE({argsMap:o=>[o.getTrackId()]}),f4=kE({argsMap:(o,s)=>[o.getTrackId(),s.name]}),E4=kE({argsMap:o=>[o.getTrackId()]}),oE((aS=class extends S4{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==nT.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(o,s,l,p){super(o,s,l,p),_t(this,"_videoVisibleTimer",null),_t(this,"_previousVideoVisibleStatus",void 0),_t(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),_t(this,"trackMediaType","video"),_t(this,"_videoWidth",void 0),_t(this,"_videoHeight",void 0),_t(this,"_player",void 0),_t(this,"processorDestination",void 0),_t(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new HV(this.getTrackId(),"remote"),this.processorDestination=new KV(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return h0(()=>{_n.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),fS(this,UE.GET_STATS)||tN({},uV)}play(o){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof o=="string"){const p=document.getElementById(o);p?o=p:(_n.warning("[".concat(this.getTrackId(),'] can not find "#').concat(o,'" element, use document.body')),o=document.body)}_n.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(o instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const l=tN(tN({fit:"cover"},s),{},{trackId:this.getTrackId(),element:o});this._player?this._player.updateConfig(l):(o instanceof HTMLVideoElement?this._player=new EL(l):this._player=new O3(l),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(OI.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const p=this.getVideoElementVisibleStatus();this.safeEmit(OI.VIDEO_ELEMENT_VISIBLE_STATUS,p)}catch{}},_u("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,_n.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){GF(this._originMediaStreamTrack).then(o=>{let[s,l]=o;this._videoHeight=l,this._videoWidth=s}).catch(GO)}_updatePlayerSource(){_n.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var o,s;const l=this==null||(o=this._player)===null||o===void 0?void 0:o.getContainerElement(),p={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:l==null?void 0:l.parentElement},{element:_,slot:b}=p;if(this.isPlaying&&_ instanceof HTMLVideoElement&&b instanceof HTMLElement){const A=oG.checkOneElementVisible(_),k=Object.assign({},A);if(k.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=k.visible;const j=wE.reportApiInvoke(null,{tag:T_.TRACER,name:j_.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});k.visible?j.onSuccess("Video is visible"):j.onSuccess("Invisible because of ".concat(k.reason))}return k}return}catch(l){throw new ga(Di.GET_VIDEO_ELEMENT_VISIBLE_ERROR,l.message)}}pipe(o){if(this.processor===o)return o;if(o._source)throw new ga(Di.INVALID_OPERATION,"Processor ".concat(o.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=o,this.processor._source=this,o.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),o}unpipe(){if(!this.processor)return;const o=this.processor;this.processor._source=void 0,this.processor=void 0,o.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(oT.ON_TRACK,async o=>{o?o!==this._mediaStreamTrack&&(this._mediaStreamTrack=o,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(oT.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}).prototype,"play",[h4],Object.getOwnPropertyDescriptor(aS.prototype,"play"),aS.prototype),oE(aS.prototype,"stop",[p4],Object.getOwnPropertyDescriptor(aS.prototype,"stop"),aS.prototype),oE(aS.prototype,"pipe",[f4],Object.getOwnPropertyDescriptor(aS.prototype,"pipe"),aS.prototype),oE(aS.prototype,"unpipe",[E4],Object.getOwnPropertyDescriptor(aS.prototype,"unpipe"),aS.prototype),aS),nN=(m4=kE({argsMap:(o,s)=>[o.getTrackId(),s],throttleTime:300}),_4=kE({argsMap:(o,s)=>[o.getTrackId(),s]}),g4=kE({argsMap:o=>[o.getTrackId()]}),v4=kE({argsMap:o=>[o.getTrackId()]}),y4=kE({argsMap:(o,s)=>[o.getTrackId(),s.name]}),b4=kE({argsMap:o=>[o.getTrackId()]}),oE((pT=class extends S4{get isPlaying(){return this._useAudioElement?MT.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(o,s,l,p){super(o,s,l,p),_t(this,"trackMediaType","audio"),_t(this,"_source",void 0),_t(this,"_useAudioElement",!0),_t(this,"_volume",100),_t(this,"processorContext",void 0),_t(this,"processorDestination",void 0),_t(this,"_played",!1),_t(this,"_bypassWebAudio",!1),_u("DISABLE_WEBAUDIO")?(this._source=new eL,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new ZD(o,!0),_u("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(OT.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(OI.FIRST_FRAME_DECODED)}),this.processorContext=new zV(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new YV(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(OT.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(o){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!o)return this._source.removeAllListeners(OT.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(s),this._source.removeAllListeners(OT.ON_AUDIO_BUFFER),this._source.on(OT.ON_AUDIO_BUFFER,l=>o(l))}setVolume(o){this._volume=o,this._useAudioElement?MT.setVolume(this.getTrackId(),o):this._source.setVolume(o/100)}async setPlaybackDevice(o){if(!this._useAudioElement)throw new ga(Di.NOT_SUPPORTED,"your browser does not support setting the audio output device");await MT.setSinkID(this.getTrackId(),o)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return h0(()=>{_n.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),fS(this,UE.GET_STATS)||tN({},cV)}play(){_n.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(_n.debug("[".concat(this.getTrackId(),"] use audio element to play")),MT.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){_n.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?MT.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let o=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];_n.debug("[".concat(this.getTrackId(),"] update player source track")),o&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&MT.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(o){if(this._bypassWebAudio)throw new ga(Di.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===o)return o;if(o._source)throw new ga(Di.INVALID_OPERATION,"Processor ".concat(o.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=o,this.processor._source=this,o.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),o}unpipe(){var o;if(this._bypassWebAudio)throw new ga(Di.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const s=this.processor;(o=this._source.processSourceNode)===null||o===void 0||o.disconnect(),this.processor._source=!1,this.processor=void 0,s.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(oT.ON_TRACK,async o=>{o?o!==this._mediaStreamTrack&&(this._mediaStreamTrack=o,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(o)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(oT.ON_NODE,o=>{this._source.processedNode=o;const s=!o;this._useAudioElement!==s&&(this._played?(this.stop(),this._useAudioElement=s,this.play()):this._useAudioElement=s)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(oT.ON_TRACK),this.processorDestination.removeAllListeners(oT.ON_NODE)}}).prototype,"setVolume",[m4],Object.getOwnPropertyDescriptor(pT.prototype,"setVolume"),pT.prototype),oE(pT.prototype,"setPlaybackDevice",[_4],Object.getOwnPropertyDescriptor(pT.prototype,"setPlaybackDevice"),pT.prototype),oE(pT.prototype,"play",[g4],Object.getOwnPropertyDescriptor(pT.prototype,"play"),pT.prototype),oE(pT.prototype,"stop",[v4],Object.getOwnPropertyDescriptor(pT.prototype,"stop"),pT.prototype),oE(pT.prototype,"pipe",[y4],Object.getOwnPropertyDescriptor(pT.prototype,"pipe"),pT.prototype),oE(pT.prototype,"unpipe",[b4],Object.getOwnPropertyDescriptor(pT.prototype,"unpipe"),pT.prototype),pT);function R4(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function I4(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?R4(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):R4(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}class qQ extends R_{constructor(){super(),_t(this,"uplinkStatsUploadInterval",void 0),_t(this,"uplinkRelatedStatsUploadInterval",void 0),_t(this,"uplinkDenoiserStatsUploadInterval",void 0),_t(this,"transportStatsUploadInterval",void 0),_t(this,"uplinkExtensionStatsUploadInterval",void 0),_t(this,"downlinkExtensionStatsUploadInterval",void 0),_t(this,"extensionUsageStatsUploadInterval",void 0),_t(this,"downlinkStatsUploadInterval",void 0),_t(this,"downlinkRelatedStatsUploadInterval",void 0),_t(this,"lastStats",void 0),_t(this,"uploadUnplinkStarted",!1),_t(this,"uploadDownlinkStarted",!1),_t(this,"uploadTransportStarted",!1),_t(this,"uploadExtensionUsageStarted",!1),_t(this,"requestStats",void 0),_t(this,"requestLocalMedia",void 0),_t(this,"requestRemoteMedia",void 0),_t(this,"requestAllTracks",void 0),_t(this,"requestVideoIsReady",void 0),_t(this,"requestUpload",void 0)}startUploadTransportStats(){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var s;const l=(s=this.requestStats)===null||s===void 0?void 0:s.call(this);l&&this.uploadTransportStats(l)},1e3))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const s=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(async()=>{var l,p,_;const b=Date.now(),A={connectionInterval:_u("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:b};let k=[];const j=((l=this.requestAllTracks)===null||l===void 0?void 0:l.call(this))||[];for(const ue of j)!ue.muted&&ue.enabled&&(k=k.concat(await ue.getProcessorUsage()));const z=((p=this.requestRemoteMedia)===null||p===void 0?void 0:p.call(this))||[];for(const[ue,Ei]of z)Ei.has(FE.VIDEO)&&ue.videoTrack&&(k=k.concat(await ue.videoTrack.getProcessorUsage())),Ei.has(FE.AUDIO)&&ue.audioTrack&&(k=k.concat(await ue.audioTrack.getProcessorUsage()));if(k.length===0)return;A.details=function(ue,Ei){const Fi={};for(const{id:vf,value:uE,level:IE,direction:lE}of ue){var Gi;const hE=(Gi=Ei.get(vf))!==null&&Gi!==void 0?Gi:0,sE=uE===2?hE+_u("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:hE;var _o,_f;Ei.set(vf,sE),Fi[vf]?(uE===2&&(Fi[vf].value=uE),IE>Fi[vf].level&&(Fi[vf].level=IE),lE==="remote"&&(Fi[vf].remoteUidCount+=1),Fi[vf].totalTs=(_o=Ei.get(vf))!==null&&_o!==void 0?_o:0):Fi[vf]={value:uE,level:IE,remoteUidCount:lE==="local"?0:1,totalTs:(_f=Ei.get(vf))!==null&&_f!==void 0?_f:0}}return Object.keys(Fi).map(vf=>{const{level:uE,value:IE,totalTs:lE}=Fi[vf];return{id:vf,level:uE,value:IE,totalTs:lE}})}(k,s);const H=Date.now(),$=H>b?H:b+1;(_=this.requestUpload)===null||_===void 0||_.call(this,kT.EXTENSION_USAGE_STATS,{usageStats:A,sendTs:$})},_u("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var s;const l=(s=this.requestStats)===null||s===void 0?void 0:s.call(this);l&&(this.uploadUplinkStats(l),this.lastStats=l)},3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var s;const l=(s=this.requestStats)===null||s===void 0?void 0:s.call(this);l&&this.uploadRelatedUplinkStats(l,this.lastStats),this.lastStats=l},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var s;const l=(s=this.requestAllTracks)===null||s===void 0?void 0:s.call(this);l&&this.uploadDenoiserStats(l)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var s;const l=(s=this.requestAllTracks)===null||s===void 0?void 0:s.call(this);l&&this.uploadExtensionStats(l)},2e3))}uploadTransportStats(s){AS(()=>{var l;(l=this.requestUpload)===null||l===void 0||l.call(this,kT.TRANSPORT_STATS,function(p){const _={connectionType:100,googRtt:p.rtt};if(p.selectedCandidatePair.localCandidate.candidateType==="relay"){const b=p.selectedCandidatePair.localCandidate.relayProtocol;b==="udp"&&(_.connectionType=101),b==="tcp"&&(_.connectionType=103),b==="tls"&&(_.connectionType=104)}return _}(s))})}uploadUplinkStats(s){var l;(((l=this.requestLocalMedia)===null||l===void 0?void 0:l.call(this))||[]).forEach(p=>{let[_,{track:b,ssrcs:A}]=p;switch(_){case OE.LocalVideoLowTrack:case OE.LocalVideoTrack:{const k=function(H,$,ue){var Ei;const Fi=$.videoSend.find(_o=>_o.ssrc===H);if(!Fi)return null;const Gi={id:y_(10,""),timestamp:new Date($.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:Fi.ssrc.toString()};switch(Gi.A_vstd=ue._originMediaStreamTrack&&!ue._originMediaStreamTrack.enabled||ue._mediaStreamTrack&&!ue._mediaStreamTrack.enabled?"1":"0",Fi.sentFrame&&(Gi.A_fhs=Fi.sentFrame.height.toString(),Gi.A_frs=Fi.sentFrame.frameRate.toString(),Gi.A_fws=Fi.sentFrame.width.toString()),Fi.adaptionChangeReason){case"none":Gi.A_ac="0";break;case"cpu":Gi.A_ac="1";break;case"bandwidth":Gi.A_ac="2";break;case"other":Gi.A_ac="3"}return Gi.A_lvps=PD[ue._player?ue._player.videoElementStatus:"uninit"].toString(),Gi.A_nr=(Ei=Fi.nacksCount)===null||Ei===void 0?void 0:Ei.toString(),Fi.avgEncodeMs&&(Gi.A_aem=Fi.avgEncodeMs.toFixed(0).toString()),Gi}(A[0].ssrcId,s,b),j=_===OE.LocalVideoTrack?function(H,$,ue){var Ei,Fi,Gi,_o,_f,vf,uE,IE;const lE=$.videoSend.find(DE=>DE.ssrc===H);if(!lE)return null;const hE={id:y_(10,""),timestamp:new Date($.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:lE.ssrc.toString()},sE=(Ei=(Fi=(Gi=lE.inputFrame)===null||Gi===void 0?void 0:Gi.height)!==null&&Fi!==void 0?Fi:ue==null?void 0:ue._videoHeight)!==null&&Ei!==void 0?Ei:0,mE=(_o=(_f=(vf=lE.inputFrame)===null||vf===void 0?void 0:vf.width)!==null&&_f!==void 0?_f:ue==null?void 0:ue._videoWidth)!==null&&_o!==void 0?_o:0,n_=(uE=(IE=lE.inputFrame)===null||IE===void 0?void 0:IE.frameRate)!==null&&uE!==void 0?uE:0;return sE&&(hE.A_fhi=sE+""),mE&&(hE.A_fwi=mE+""),n_&&(hE.A_fri=n_+""),hE}(A[0].ssrcId,s,b):null;k&&AS(()=>{var H;return(H=this.requestUpload)===null||H===void 0?void 0:H.call(this,kT.PUBLISH_STATS,{stream_type:_===OE.LocalVideoLowTrack?"low":"high",stats:I4(I4({},k),j)})});const z=function(H){const $={id:"bweforvideo",timestamp:new Date(H.timestamp).toISOString(),type:"VideoBwe"};return H.bitrate.retransmit&&($.A_rb=H.bitrate.retransmit.toString()),H.bitrate.targetEncoded&&($.A_teb=H.bitrate.targetEncoded.toString()),$.A_aeb=H.bitrate.actualEncoded.toString(),$.A_tb=H.bitrate.transmit.toString(),H.sendBandwidth!==void 0&&($.A_asb=H.sendBandwidth.toString()),$}(s);z&&setTimeout(()=>{var H;return(H=this.requestUpload)===null||H===void 0?void 0:H.call(this,kT.PUBLISH_STATS,{stream_type:_===OE.LocalVideoLowTrack?"low":"high",stats:z})},1e3);break}case OE.LocalAudioTrack:{const k=function(j,z,H){const $=z.audioSend.find(Ei=>Ei.ssrc===j);if(!$)return null;const ue={id:y_(10,""),timestamp:new Date(z.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:$.ssrc.toString()};return ue.A_astd=H._originMediaStreamTrack&&!H._originMediaStreamTrack.enabled||H._mediaStreamTrack&&!H._mediaStreamTrack.enabled?"1":"0",$.inputLevel?ue.A_ail=Math.round(100*$.inputLevel).toString():ue.A_ail=Math.round(100*H._source.getAccurateVolumeLevel()).toString(),ue.A_apil=Math.round(100*H._source.getAccurateVolumeLevel()).toString(),$.aecReturnLoss&&(ue.A_ecrl=Math.round($.aecReturnLoss).toString()),$.aecReturnLossEnhancement&&(ue.A_ecrle=Math.round($.aecReturnLossEnhancement).toString()),ue}(A[0].ssrcId,s,b);k&&AS(()=>{var j;return(j=this.requestUpload)===null||j===void 0?void 0:j.call(this,kT.PUBLISH_STATS,{stream_type:"high",stats:k})});break}}})}uploadRelatedUplinkStats(s,l){var p;(((p=this.requestLocalMedia)===null||p===void 0?void 0:p.call(this))||[]).filter(_=>{let[b]=_;return b===OE.LocalVideoLowTrack||b===OE.LocalVideoTrack}).forEach(_=>{let[b,{ssrcs:A}]=_;const k=function(j,z){const H=z.videoSend.find($=>$.ssrc===j);return H?{mediaType:"video",isVideoMute:!1,frameRateInput:H.inputFrame&&H.inputFrame.frameRate.toString(),frameRateSent:H.sentFrame&&H.sentFrame.frameRate.toString(),googRtt:H.rttMs.toString(),qpSumPerFrame:Math.floor(H.qpSumPerFrame).toString()}:null}(A[0].ssrcId,s);k&&AS(()=>{var j;(j=this.requestUpload)===null||j===void 0||j.call(this,kT.PUBLISH_RELATED_STATS,{stream_type:b===OE.LocalVideoLowTrack?"low":"high",stats:k})})})}uploadDenoiserStats(s){for(let b=0;b<s.length;b++){const A=s[b];if(A instanceof jO){var l,p,_;const k=(l=(p=A._external).getDenoiserStats)===null||l===void 0?void 0:l.call(p);return void(k&&((_=this.requestUpload)===null||_===void 0||_.call(this,kT.DENOISER_STATS,k)))}}}uploadExtensionStats(s){for(let l=0;l<s.length;l++)s[l].getProcessorStats().forEach(p=>{var _;(_=this.requestUpload)===null||_===void 0||_.call(this,p.type,p.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let s;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let l=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var p;const _=(p=this.requestStats)===null||p===void 0?void 0:p.call(this);_&&(this.uploadDownlinkStats(_,l,s),s=_),l=!l},3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var p;const _=(p=this.requestStats)===null||p===void 0?void 0:p.call(this);_&&(this.uploadRelatedDownlinkStats(_,this.lastStats),this.lastStats=_)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var p;const _=(p=this.requestRemoteMedia)===null||p===void 0?void 0:p.call(this);_&&this.uploadDownlinkExtensionStats(_)},2e3)}uploadDownlinkStats(s,l,p){var _;(((_=this.requestRemoteMedia)===null||_===void 0?void 0:_.call(this))||[]).forEach(b=>{let[A,k]=b;if(k.has(FE.VIDEO)&&A.videoTrack){const j=A.videoTrack?function(z,H,$,ue,Ei){const Fi=H.videoRecv.find(vf=>vf.ssrc===z);if(!Fi)return null;const Gi={id:y_(10,""),timestamp:new Date(H.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:Fi.ssrc.toString()};var _o,_f;if(Gi.bytesReceived=Fi.bytes.toString(),Gi.packetsLost=Fi.packetsLost.toString(),Gi.packetsReceived=Fi.packets.toString(),Fi.framesRateFirefox&&(Gi.A_frr=Fi.framesRateFirefox.toString()),Fi.receivedFrame?(Gi.A_frr=Fi.receivedFrame.frameRate.toString(),Gi.A_fhr=Fi.receivedFrame.height.toString(),Gi.A_fwr=Fi.receivedFrame.width.toString()):(Gi.A_fhr=(_o=ue._videoHeight)===null||_o===void 0?void 0:_o.toString(),Gi.A_fwr=(_f=ue._videoWidth)===null||_f===void 0?void 0:_f.toString()),Gi.A_frd=Fi.decodeFrameRate.toString(),Fi.outputFrame&&(Gi.A_fro=Fi.outputFrame.frameRate.toString()),Fi.jitterBufferMs!==void 0&&(Gi.A_jbm=Math.floor(Fi.jitterBufferMs).toString()),Fi.currentDelayMs!==void 0&&(Gi.A_cdm=Math.floor(Fi.currentDelayMs).toString()),Gi.A_fs=Fi.firsCount.toString(),Gi.A_ns=Fi.nacksCount.toString(),Gi.A_ps=Fi.plisCount.toString(),ue&&(Gi.A_vrtd=ue._originMediaStreamTrack.enabled&&ue._mediaStreamTrack.enabled?"0":"1"),ue._player&&ue._player.freezeTimeCounterList.length>0&&(Gi.A_vrft=Math.round(ue._player.freezeTimeCounterList.splice(0,1)[0]).toString()),Ei&&ue._player&&QS.visibility==="visible"){const vf=Math.min(6e3,ue._player.renderFreezeAccTime);Gi.A_vrrft=Math.round(vf).toString(),ue._player.renderFreezeAccTime=Math.max(0,ue._player.renderFreezeAccTime-vf)}if(Gi.A_rvps=PD[ue._player?ue._player.videoElementStatus:"uninit"].toString(),$){const vf=$.videoRecv.find(uE=>uE.ssrc===z);if(vf&&Fi.totalInterFrameDelay!==void 0&&Fi.totalSquaredInterFrameDelay!==void 0&&vf.totalInterFrameDelay!==void 0&&vf.totalSquaredInterFrameDelay!==void 0){const uE=Fi.totalInterFrameDelay-vf.totalInterFrameDelay,IE=Fi.totalSquaredInterFrameDelay-vf.totalSquaredInterFrameDelay,lE=Fi.framesDecodeCount-vf.framesDecodeCount,hE=uE/lE*1e3,sE=Math.round(1e3*Math.sqrt((IE-Math.pow(uE,2)/lE)/lE));!isNaN(sE)&&hE+sE>Math.max(3*hE,hE+150)&&(Gi.A_ifdsd=sE.toString())}}return Gi}(A._videoSSRC,s,p,A.videoTrack,l):void 0;j&&AS(()=>{var z;return(z=this.requestUpload)===null||z===void 0?void 0:z.call(this,kT.SUBSCRIBE_STATS,{stream_id:A.uid,stats:j})})}if(k.has(FE.AUDIO)&&A.audioTrack){const j=A.audioTrack?function(z,H,$,ue){const Ei=H.audioRecv.find(Gi=>Gi.ssrc===z);if(!Ei)return null;const Fi={id:y_(10,""),timestamp:new Date(H.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:Ei.ssrc.toString()};if(Fi.bytesReceived=Ei.bytes.toString(),Fi.packetsLost=Ei.packetsLost.toString(),Fi.packetsReceived=Ei.packets.toString(),Ei.outputLevel?Fi.A_aol=Math.round(100*Ei.outputLevel).toString():Fi.A_aol=Math.round(100*ue._source.getAccurateVolumeLevel()).toString(),Fi.A_apol=Math.round(100*ue._source.getAccurateVolumeLevel()).toString(),ue&&(Fi.A_artd=ue._originMediaStreamTrack.enabled&&ue._mediaStreamTrack.enabled?"0":"1"),Fi.A_jr=Ei.jitterMs.toString(),Fi.A_jbm=Math.floor(Ei.jitterBufferMs).toString(),Fi.A_cdm=Math.floor(Ei.jitterBufferMs).toString(),Fi.A_raps=PD[MT.getPlayerState(ue.getTrackId())].toString(),$){const Gi=$.audioRecv.find(_o=>_o.ssrc===z);if(Gi){const _o=Ei.concealedSamples-Gi.concealedSamples;_o>0&&(Fi.A_cs=Math.round(_o).toString())}}return Fi}(A._audioSSRC,s,p,A.audioTrack):void 0;j&&AS(()=>{var z;return(z=this.requestUpload)===null||z===void 0?void 0:z.call(this,kT.SUBSCRIBE_STATS,{stream_id:A.uid,stats:j})})}})}uploadRelatedDownlinkStats(s,l){var p;(((p=this.requestRemoteMedia)===null||p===void 0?void 0:p.call(this))||[]).forEach(_=>{let[b,A]=_;if(A.has(FE.VIDEO)&&b.videoTrack){var k;const j=(b._videoSSRC&&((k=this.requestVideoIsReady)===null||k===void 0?void 0:k.call(this,b._videoSSRC))||!1)===!0,z=function(H,$,ue,Ei,Fi,Gi){const _o=ue.videoRecv.find(IE=>IE.ssrc===H),_f=Fi?Fi.videoRecv.find(IE=>IE.ssrc===H):void 0;if(!_o)return null;const vf=PI.isRemoteVideoFreeze(Gi,_o,_f)&&$,uE={mediaType:"video",isVideoMute:!1,peerId:Ei,frameRateReceived:_o.receivedFrame&&_o.receivedFrame.frameRate.toString(),frameRateDecoded:_o.decodedFrame&&_o.decodedFrame.frameRate.toString(),isFreeze:vf,bytesReceived:_o.bytes.toString(),packetsReceived:_o.packets.toString(),packetsLost:_o.packetsLost.toString(),qpSumPerFrame:Math.floor(_o.qpSumPerFrame).toString()};return _o.framesRateFirefox&&(uE.frameRateDecoded=_o.framesRateFirefox.toString(),uE.frameRateReceived=_o.framesRateFirefox.toString()),uE}(b._videoSSRC,j,s,b.uid,l,b.videoTrack);z&&AS(()=>{var H;(H=this.requestUpload)===null||H===void 0||H.call(this,kT.SUBSCRIBE_RELATED_STATS,{stream_id:b.uid,stats:z})})}if(A.has(FE.AUDIO)&&b.audioTrack){const j=function(z,H,$,ue){const Ei=H.audioRecv.find(Gi=>Gi.ssrc===z);if(!Ei)return null;const Fi=PI.isRemoteAudioFreeze(ue);return{mediaType:"audio",isAudioMute:!1,peerId:$,googJitterReceived:Ei.jitterMs.toString(),isFreeze:Fi,bytesReceived:Ei.bytes.toString(),packetsReceived:Ei.packets.toString(),packetsLost:Ei.packetsLost.toString(),frameReceived:Ei.receivedFrames.toString(),frameDropped:Ei.droppedFrames.toString()}}(b._audioSSRC,s,b.uid,b.audioTrack);j&&AS(()=>{var z;(z=this.requestUpload)===null||z===void 0||z.call(this,kT.SUBSCRIBE_RELATED_STATS,{stream_id:b.uid,stats:j})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(s){s.forEach(l=>{let[p,_]=l;_.has(FE.VIDEO)&&p.videoTrack&&p.videoTrack.getProcessorStats().forEach(b=>{var A;(A=this.requestUpload)===null||A===void 0||A.call(this,b.type,b.stats)}),_.has(FE.AUDIO)&&p.audioTrack&&p.audioTrack.getProcessorStats().forEach(b=>{var A;(A=this.requestUpload)===null||A===void 0||A.call(this,b.type,b.stats)})})}}function O4(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function A4(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?O4(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):O4(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}const w4=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,rN="9",BL=2e4,GL=4e4;class WQ{get localCapabilities(){return B_(this._localCapabilities)}get rtpCapabilities(){return B_(this._rtpCapabilities)}get candidates(){return B_(this._candidates)}get iceParameters(){return B_(this._iceParameters)}get dtlsParameters(){return B_(this._dtlsParameters)}constructor(s){_t(this,"sessionDesc",void 0),_t(this,"_localCapabilities",void 0),_t(this,"_rtpCapabilities",void 0),_t(this,"_candidates",void 0),_t(this,"_iceParameters",void 0),_t(this,"_dtlsParameters",void 0),_t(this,"setup",void 0),_t(this,"currentMidIndex",void 0),_t(this,"cname",void 0),_t(this,"firefoxSsrcMidMap",new Map),s=B_(s);const{remoteIceParameters:l,remoteDtlsParameters:p,candidates:_,remoteRTPCapabilities:b,remoteSetup:A,localCapabilities:k,cname:j}=s,z=q_.exports.parse(w4);this._rtpCapabilities=b,this._candidates=_,this._iceParameters=l,this._dtlsParameters=p,this._localCapabilities=k,this.setup=A,this.cname=j;const H=this.rtpCapabilities.send;for(const $ of z.mediaDescriptions){if($.attributes.iceUfrag=l.iceUfrag,$.attributes.icePwd=l.icePwd,$.attributes.fingerprints=p.fingerprints,$.attributes.candidates=_,$.attributes.setup=A,$.media.mediaType==="application"&&($.attributes.sctpPort="5000"),$.media.mediaType==="video"&&($.media.fmts=H.videoCodecs.map(ue=>ue.payloadType.toString(10)),$.attributes.payloads=H.videoCodecs,$.attributes.extmaps=H.videoExtensions,_u("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:ue,ssrcGroups:Ei}=iS([{ssrcId:GL,rtx:_u("USE_SUB_RTX")?40001:void 0}],this.cname);$.attributes.ssrcs=ue,$.attributes.ssrcGroups=Ei}if($.media.mediaType==="audio"&&($.media.fmts=H.audioCodecs.map(ue=>ue.payloadType.toString(10)),$.attributes.payloads=H.audioCodecs,$.attributes.extmaps=H.audioExtensions,yR($),_u("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:ue,ssrcGroups:Ei}=iS([{ssrcId:BL}],this.cname);$.attributes.ssrcs=ue,$.attributes.ssrcGroups=Ei}}this.sessionDesc=z,this.currentMidIndex=z.mediaDescriptions.length-1}updateRemoteRTPCapabilities(s){const l=q_.exports.parse(w4);this._rtpCapabilities=s;const p=this.rtpCapabilities.send;for(const _ of l.mediaDescriptions){if(_.attributes.iceUfrag=this._iceParameters.iceUfrag,_.attributes.icePwd=this._iceParameters.icePwd,_.attributes.fingerprints=this._dtlsParameters.fingerprints,_.attributes.candidates=this._candidates,_.attributes.setup=this.setup,_.media.mediaType==="application"&&(_.attributes.sctpPort="5000"),_.media.mediaType==="video"&&(_.media.fmts=p.videoCodecs.map(b=>b.payloadType.toString(10)),_.attributes.payloads=p.videoCodecs,_.attributes.extmaps=p.videoExtensions,_u("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:b,ssrcGroups:A}=iS([{ssrcId:GL,rtx:_u("USE_SUB_RTX")?40001:void 0}],this.cname);_.attributes.ssrcs=b,_.attributes.ssrcGroups=A}if(_.media.mediaType==="audio"&&(_.media.fmts=p.audioCodecs.map(b=>b.payloadType.toString(10)),_.attributes.payloads=p.audioCodecs,_.attributes.extmaps=p.audioExtensions,_u("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:b,ssrcGroups:A}=iS([{ssrcId:BL}],this.cname);_.attributes.ssrcs=b,_.attributes.ssrcGroups=A}}this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}preloadRemoteMedia(s){this.rtpCapabilities;const l=this.candidates,p=this.dtlsParameters,_=this.iceParameters,b=this.rtpCapabilities.send;for(let A=1;A<s;A++){const k=2*A+BL,j=2*A+GL,{ssrcs:z,ssrcGroups:H}=iS([{ssrcId:k}],this.cname),{ssrcs:$,ssrcGroups:ue}=iS([{ssrcId:j,rtx:_u("USE_SUB_RTX")?j+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:rN,protos:["UDP","TLS","RTP","SAVPF"],fmts:b.videoCodecs.map(Ei=>Ei.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:_.iceUfrag,icePwd:_.icePwd,unrecognized:[],candidates:l,extmaps:b.videoExtensions,fingerprints:p.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:$,ssrcGroups:ue,rtcpFeedbackWildcards:[],payloads:b.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*A-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:rN,protos:["UDP","TLS","RTP","SAVPF"],fmts:b.audioCodecs.map(Ei=>Ei.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:_.iceUfrag,icePwd:_.icePwd,unrecognized:[],candidates:l,extmaps:b.audioExtensions,fingerprints:p.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:z,ssrcGroups:H,rtcpFeedbackWildcards:[],payloads:b.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*A)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return q_.exports.print(this.sessionDesc)}send(s,l,p,_){const{ssrcs:b,ssrcGroups:A}=iS(l,this.cname,_u("SYNC_GROUP")?p:void 0),k=this.findPreloadMediaDesc(b);if(k){if(O_()&&this.firefoxSsrcMidMap.set(b[0].ssrcId,k.attributes.mid),_&&(_.twcc||_.remb)){const j=this.sessionDesc.mediaDescriptions.indexOf(k);return this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(k,_),{mid:k.attributes.mid,needExchangeSDP:!0}}return{mid:k.attributes.mid,needExchangeSDP:!1}}{const j=this.findAvailableMediaIndex(s,b);let z;return j===-1||fT()||ET()||s2()||j===0&&_u("USE_SUB_RTX")?(z=this.createOrRecycleSendMedia(s,b,A,"sendonly",_),this.updateBundleMids()):(z=B_(this.sessionDesc.mediaDescriptions[j]),z.attributes.direction="sendonly",z.attributes.ssrcs=b,z.attributes.ssrcGroups=A,this.sessionDesc.mediaDescriptions[j]=this.mungSendMediaDesc(z,_)),O_()&&this.firefoxSsrcMidMap.set(b[0].ssrcId,z.attributes.mid),{mid:z.attributes.mid,needExchangeSDP:!0}}}batchSend(s){const l=s.map(b=>{let{kind:A,ssrcMsg:k,mslabel:j}=b;return this.send(A,k,j)}),p=[];let _=!1;return l.forEach(b=>{let{mid:A,needExchangeSDP:k}=b;k&&(_=!0),p.push(A)}),{mids:p,needExchangeSDP:_}}stopSending(s){const l=this.sessionDesc.mediaDescriptions.filter(p=>p.attributes.mid&&s.indexOf(p.attributes.mid)!==-1);if(l.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");l.forEach(p=>{p.attributes.mid==="0"||O_()||fT()||ET()?p.attributes.ssrcs=[]:(p.attributes.ssrcs=[],p.attributes.direction="inactive",p.media.port="0")}),this.updateBundleMids()}mute(s){const l=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===s);if(!l)throw new Error("mediaDescription not found with ".concat(s," in remote SDP when calling RemoteSDP.mute."));l.attributes.direction="inactive"}unmute(s){const l=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===s);if(!l)throw new Error("mediaDescription not found with ".concat(s," in remote SDP when calling RemoteSDP.unmute."));l.attributes.direction="sendonly"}muteRemote(s){const l=this.sessionDesc.mediaDescriptions.filter(p=>s.includes(p.attributes.mid||""));if(l.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");l.forEach(p=>{p.attributes.direction="inactive"})}unmuteRemote(s){const l=this.sessionDesc.mediaDescriptions.filter(p=>s.includes(p.attributes.mid||""));if(l.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");l.forEach(p=>{p.attributes.direction="recvonly"})}receive(s,l,p,_){s.forEach((b,A)=>{this.createOrRecycleRecvMedia(b,[],"recvonly",l,p,_[A])}),this.updateBundleMids()}stopReceiving(s){const l=this.sessionDesc.mediaDescriptions.filter(p=>s.indexOf(p.attributes.mid)!==-1);if(l.length!==s.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");l.forEach(p=>{p.media.port="0",p.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(s){s===_v.TCP?this._candidates.forEach(l=>{this._candidates.findIndex(p=>p.transport==="tcp"&&p.connectionAddress===l.connectionAddress&&p.port===l.port)===-1&&this._candidates.push(A4(A4({},l),{},{foundation:"tcpcandidate",priority:Number(l.priority)-1+"",transport:"tcp",port:Number(l.port)+90+""}))}):this._candidates=this._candidates.filter(l=>l.transport!=="tcp");for(const l of this.sessionDesc.mediaDescriptions)l.attributes.candidates=this.candidates}restartICE(s){s=B_(s),this._iceParameters=s,this.sessionDesc.mediaDescriptions.forEach(l=>{l.attributes.iceUfrag=s.iceUfrag,l.attributes.icePwd=s.icePwd})}predictReceivingMids(s){const l=[];for(let p=0;p<s;p++)l.push((this.currentMidIndex+p+1).toString(10));return l}findAvailableMediaIndex(s,l){return this.sessionDesc.mediaDescriptions.findIndex(p=>{const _=p.media.mediaType===s&&p.media.port!=="0"&&(p.attributes.direction==="sendonly"||p.attributes.direction==="sendrecv")&&p.attributes.ssrcs.length===0;if(O_()){if(_){const b=this.firefoxSsrcMidMap.get(l[0].ssrcId);return!(b||p.attributes.mid!=="0"&&p.attributes.mid!=="1")||!(!b||b!==p.attributes.mid)}return!1}return _})}createOrRecycleRecvMedia(s,l,p,_,b,A){const k=s._mediaStreamTrack.kind,j=this.rtpCapabilities.recv,z=this.localCapabilities.send;let H=[];if(k===FE.VIDEO){var $,ue;if(_u("H264_PROFILE_LEVEL_ID")&&_==="h264"&&(H=j.videoCodecs.filter(_f=>{var vf,uE;return(((vf=_f.rtpMap)===null||vf===void 0?void 0:vf.encodingName.toLowerCase())||"").includes(_)&&(_f==null||(uE=_f.fmtp)===null||uE===void 0?void 0:uE.parameters["profile-level-id"])===_u("H264_PROFILE_LEVEL_ID")})),!H||(($=H)===null||$===void 0?void 0:$.length)===0){const _f=z.videoCodecs.filter(vf=>{var uE;return(((uE=vf.rtpMap)===null||uE===void 0?void 0:uE.encodingName.toLowerCase())||"").includes(_)});_f.length!==0&&(H=j.videoCodecs.filter(vf=>_f.some(uE=>uE.payloadType===vf.payloadType)))}if(_u("USE_PUB_RTX")){const _f=H.map(uE=>uE.payloadType.toString()),vf=j.videoCodecs.filter(uE=>{var IE,lE;return((IE=uE.rtpMap)===null||IE===void 0?void 0:IE.encodingName)==="rtx"&&_f.includes(((lE=uE.fmtp)===null||lE===void 0?void 0:lE.parameters.apt)||"")});H=[...H,...vf]}H.length===0&&(_n.warning("codec ".concat(_," not included in rtpCapabilities, fallback to default payloads: ").concat((ue=j.videoCodecs[0].rtpMap)===null||ue===void 0?void 0:ue.encodingName)),H=j.videoCodecs)}else H=j.audioCodecs.filter(_f=>{var vf;return(((vf=_f.rtpMap)===null||vf===void 0?void 0:vf.encodingName.toLowerCase())||"").includes(b)}),H.length===0&&(_n.warning("codec ".concat(b," not included in rtpCapabilities, fallback to opus")),H=j.audioCodecs.filter(_f=>{var vf;return(((vf=_f.rtpMap)===null||vf===void 0?void 0:vf.encodingName.toLowerCase())||"").includes("opus")}));const Ei=k===FE.VIDEO?j.videoExtensions:j.audioExtensions;this.currentMidIndex+=1;const Fi="".concat(this.currentMidIndex);let Gi={media:{mediaType:k,port:rN,protos:["UDP","TLS","RTP","SAVPF"],fmts:H.map(_f=>_f.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Ei,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:H,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:p,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Fi)}};Gi=this.mungRecvMediaDsec(Gi,s,A);const _o=this.findFirstClosedMedia(k);if(_o){const _f=this.sessionDesc.mediaDescriptions.indexOf(_o);this.sessionDesc.mediaDescriptions[_f]=Gi}else this.sessionDesc.mediaDescriptions.push(Gi);return Gi}createOrRecycleSendMedia(s,l,p,_,b){const A=this.rtpCapabilities.send,k=s===FE.VIDEO?A.videoCodecs:A.audioCodecs,j=s===FE.VIDEO?A.videoExtensions:A.audioExtensions;this.currentMidIndex+=1;const z="".concat(this.currentMidIndex);let H={media:{mediaType:s,port:rN,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.map(ue=>ue.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:j,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:k,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:_,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(z)}};H=this.mungSendMediaDesc(H,b);const $=this.findFirstClosedMedia(s);if($){const ue=this.sessionDesc.mediaDescriptions.indexOf($);this.sessionDesc.mediaDescriptions[ue]=H}else this.sessionDesc.mediaDescriptions.push(H);return H}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(s=>s.media.port!=="0").map(s=>s.attributes.mid)}mungRecvMediaDsec(s,l,p){const _=B_(s);return ML(_),jI(_,l),UL(_,l),WG(_),_A(_,p,this.localCapabilities.send),_}mungSendMediaDesc(s,l){const p=B_(s);return _A(p,l,this.localCapabilities.recv),yR(p),p}updateRecvMedia(s,l){const p=this.sessionDesc.mediaDescriptions.findIndex(_=>_.attributes.mid===s);if(p!==-1){const _=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],l);this.sessionDesc.mediaDescriptions[p]=_}}bumpMid(s){this.currentMidIndex+=s}findFirstClosedMedia(s){return this.sessionDesc.mediaDescriptions.find(l=>O_()?l.media.port==="0"&&l.media.mediaType===s:l.media.port==="0")}findPreloadMediaDesc(s){return this.sessionDesc.mediaDescriptions.find(l=>{var p,_;return((p=l.attributes)===null||p===void 0||(_=p.ssrcs[0])===null||_===void 0?void 0:_.ssrcId)===s[0].ssrcId})}getSSRC(s){var l;return(l=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===s))===null||l===void 0?void 0:l.attributes.ssrcs}}var a_;function C4(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function iN(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?C4(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):C4(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}let KQ=(oE((a_=class dN extends DO{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(s,l,p){super(s,l),_t(this,"store",void 0),_t(this,"peerConnection",void 0),_t(this,"remoteSDP",void 0),_t(this,"initialOffer",void 0),_t(this,"transportEventReceiver",void 0),_t(this,"statsFilter",void 0),_t(this,"localCapabilities",void 0),_t(this,"localCandidateCount",0),_t(this,"allCandidatesReceived",!1),_t(this,"establishPromise",void 0),_t(this,"mutex",new gT("NVExtentionsConnection-mutex")),_t(this,"rtcMedia",void 0),this.store=l,this.peerConnection=p,this.statsFilter=FL(this.peerConnection,_u("STATS_UPDATE_INTERVAL"),void 0,O_()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(s){try{const l=await this.peerConnection.createOffer();if(!l.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const p=$R(l.sdp),_=await HG(!_u("USE_PUB_RTX")&&!_u("USE_SUB_RTX"),_u("FILTER_VIDEO_FEC"),_u("FILTER_AUDIO_FEC"));return this.localCapabilities=_,this.initialOffer=l,iN(iN({},p),{},{rtpCapabilities:_,offerSDP:l.sdp})}catch(l){throw new ga(Di.GET_LOCAL_CONNECTION_PARAMS_FAILED,l.toString())}}async connect(s,l,p,_,b,A){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new WQ({remoteIceParameters:s,remoteDtlsParameters:l,candidates:p,remoteRTPCapabilities:_,remoteSetup:b,localCapabilities:xL(this.localCapabilities),cname:A});const k=this.remoteSDP.toString(),j=q_.exports.parse(this.initialOffer.sdp),z=j.mediaDescriptions.find(ue=>ue.media.mediaType==="audio");z&&yR(z);const H=q_.exports.print(j),$=this.logSDPExchange(H||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:H}),$==null||$(k),await this.peerConnection.setRemoteDescription({type:"answer",sdp:k})}catch(k){throw new ga(Di.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(k.toString()))}}async updateRemoteConnect(s){var l,p,_;(l=this.remoteSDP)===null||l===void 0||l.updateRemoteRTPCapabilities(s),(p=this.remoteSDP)===null||p===void 0||p.preloadRemoteMedia(2);const b=(_=this.remoteSDP)===null||_===void 0?void 0:_.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:b});const A=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(A),_n.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(s,l,p){var _=this;return ES(function*(){const b=yield YE(_.mutex.lock("From NVExtentionsConnection.send"));try{if(!_.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const A=[];s.forEach(Gi=>{const _o=_.peerConnection.addTransceiver(Gi._mediaStreamTrack,{direction:"sendonly"});A.push(_o)}),O_()&&_u("SIMULCAST")===!0&&(yield YE(_.applySimulcastForFirefox(A,s)));const k=yield YE(_.peerConnection.createOffer()),j=_.remoteSDP.predictReceivingMids(s.length),z=_.mungSendOfferSDP(k.sdp,s,j),H=q_.exports.parse(z),$=j.map(Gi=>{const _o=H.mediaDescriptions.find(_f=>_f.attributes.mid===Gi);if(!_o)throw new Error("Cannot extract ssrc from mediaDescription.");return GG(_o,_u("USE_PUB_RTX"))});let ue;try{ue=yield $}catch(Gi){ue=[],_.remoteSDP.receive(s,l,p,ue);const _o=_.remoteSDP.toString();throw yield YE(_.peerConnection.setLocalDescription({type:"offer",sdp:z})),yield YE(_.peerConnection.setRemoteDescription({type:"answer",sdp:_o})),yield YE(_.stopSending(j,!0)),Gi}_.remoteSDP.receive(s,l,p,ue);const Ei=_.remoteSDP.toString(),Fi=_.logSDPExchange(z,"offer","local","send");return yield YE(_.peerConnection.setLocalDescription({type:"offer",sdp:z})),yield YE(_.applySimulcastEncodings(A,s)),yield YE(_.applySendEncodings(A,s)),Fi==null||Fi(Ei),yield YE(_.peerConnection.setRemoteDescription({type:"answer",sdp:Ei})),A.map((Gi,_o)=>{const _f=j[_o];return{localSSRC:$[_o],id:_f,transceiver:Gi}})}catch(A){throw A instanceof ga?A:new ga(Di.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(A.toString()))}finally{b()}})()}async stopSending(s,l){const p=l?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const _=this.peerConnection.getTransceivers().filter(j=>s.indexOf(j.mid)!==-1);if(_.length!==s.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");_.map(j=>{var z;j.direction="inactive",(z=j.stop)===null||z===void 0||z.call(j)});const b=await this.peerConnection.createOffer(),A=this.logSDPExchange(b.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(b),this.remoteSDP.stopReceiving(s);const k=this.remoteSDP.toString();A==null||A(k),await this.peerConnection.setRemoteDescription({type:"answer",sdp:k})}catch(_){throw new ga(Di.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(_.toString()))}finally{p&&p()}}async receive(s,l,p,_){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(s," before remoteSDP created."));const{mid:b,needExchangeSDP:A}=this.remoteSDP.send(s,l,p,_);if(A){const j=this.remoteSDP.toString(),z=this.logSDPExchange(j,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:j});const H=await this.peerConnection.createAnswer(),$=this.mungReceiveAnswerSDP(H.sdp,b,s);z==null||z($||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:$}),_n.debug("[NVExtentionsConnection] receive ".concat(s," by exchanging SDP."))}else _n.debug("[NVExtentionsConnection] receive ".concat(s," no need to exchange SDP."));const k=this.peerConnection.getTransceivers().find(j=>j.mid===b);if(!k)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:k.receiver.track,id:b}}catch(b){throw new ga(Di.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(b.toString()))}}async batchReceive(s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:l,needExchangeSDP:p}=this.remoteSDP.batchSend(s);if(p){const _=this.remoteSDP.toString(),b=this.logSDPExchange(_,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const A=await this.peerConnection.createAnswer();b==null||b(A.sdp||""),await this.peerConnection.setLocalDescription(A),_n.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else _n.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return l.map(_=>{const b=this.peerConnection.getTransceivers().find(A=>A.mid===_);if(!b)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:b.receiver.track,id:_}})}catch(l){throw new ga(Di.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(s);const l=this.remoteSDP.toString(),p=this.logSDPExchange(l,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const _=await this.peerConnection.createAnswer();p==null||p(_.sdp||""),await this.peerConnection.setLocalDescription(_)}catch(l){throw new ga(Di.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(l.toString()))}}async muteRemote(s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(s," before remote SDP created."));this.remoteSDP.mute(s);const l=this.remoteSDP.toString(),p=this.logSDPExchange(l,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const _=await this.peerConnection.createAnswer();p==null||p(_.sdp||""),await this.peerConnection.setLocalDescription(_)}catch(l){throw new ga(Di.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(l.toString()))}}async unmuteRemote(s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(s," before remote SDP created."));this.remoteSDP.unmute(s);const l=this.remoteSDP.toString(),p=this.logSDPExchange(l,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});const _=await this.peerConnection.createAnswer();p==null||p(_.sdp||""),await this.peerConnection.setLocalDescription(_)}catch(l){throw new ga(Di.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(l.toString()))}}async muteLocal(s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const l=this.peerConnection.getTransceivers().filter(A=>A.mid&&s.indexOf(A.mid)!==-1);if(l.length!==s.length)throw new Error("Transceivers' length doesn't match mids' length.");l.map(A=>{A.direction="inactive"});const p=await this.peerConnection.createOffer(),_=this.logSDPExchange(p.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(p),this.remoteSDP.muteRemote(s);const b=this.remoteSDP.toString();_==null||_(b),await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(l){throw new ga(Di.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(l.toString()))}}async unmuteLocal(s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const l=this.peerConnection.getTransceivers().filter(A=>A.mid&&s.indexOf(A.mid)!==-1);if(l.length!==s.length)throw new Error("Transceivers' length doesn't match mids' length.");l.map(async(A,k)=>{A.direction="sendonly"});const p=await this.peerConnection.createOffer(),_=this.logSDPExchange(p.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(p),this.remoteSDP.unmuteRemote(s);const b=this.remoteSDP.toString();_==null||_(b),await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(l){throw new ga(Di.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(l.toString()))}}restartICE(s){var l=this;return ES(function*(){const p=yield YE(l.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!l.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(L_().supportPCSetConfiguration){const z=l.peerConnection.getConfiguration(),H=s===_v.RELAY?"relay":"all";z.iceTransportPolicy!==H&&(_n.debug("restartICE change iceTransportPolicy from [".concat(z.iceTransportPolicy,"] to [").concat(H,"]")),z.iceTransportPolicy=H,l.peerConnection.setConfiguration(z))}else if(s===_v.RELAY)return;s!==_v.RELAY&&l.remoteSDP.updateCandidates(s);const _=yield YE(l.peerConnection.createOffer({iceRestart:!0}));if(!_.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const b=$R(_.sdp),{remoteIceParameters:A}=yield b.iceParameters;l.remoteSDP.restartICE(A);const k=l.remoteSDP.toString(),j=l.logSDPExchange(_.sdp||"","offer","local","restartICE");yield YE(l.peerConnection.setLocalDescription(_)),j==null||j(k),yield YE(l.peerConnection.setRemoteDescription({type:"answer",sdp:k}))}catch(_){_n.warning("restart ICE failed, abort operation",_)}finally{p()}})()}close(){var s;(s=this.onConnectionStateChange)===null||s===void 0||s.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(s){return this.statsFilter.getVideoIsReady(s)}async updateEncoderConfig(s,l){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const p=await this.peerConnection.createOffer(),_=this.mungSendOfferSDP(p.sdp,[l],[s]);this.remoteSDP.updateRecvMedia(s,l);const b=this.remoteSDP.toString(),A=this.logSDPExchange(_,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:_}),A==null||A(b),await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(p){throw new ga(Di.EXCHANGE_SDP_FAILED,p.toString())}}async updateSendParameters(s,l){const p=this.peerConnection.getTransceivers().filter(_=>_.mid===s);p.length===1&&(this.isVP8Simulcast(l)?O_()||await this.applySimulcastEncodings(p,[l]):await this.applySendEncodings(p,[l]))}setStatsRemoteVideoIsReady(s,l){this.statsFilter.setVideoIsReady2(s,l)}async replaceTrack(s,l){const p=this.peerConnection.getTransceivers().find(_=>_.mid===l);p&&await p.sender.replaceTrack(s._mediaStreamTrack)}getP2PConnectionParams(){var s;if((s=this.peerConnection.currentLocalDescription)===null||s===void 0||!s.sdp||!this.localCapabilities)throw new Error;return iN(iN({},$R(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var s;(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var s;(s=this.onConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=s=>{s.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,_n.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,_n.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},_u("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(s){const l={iceServers:[]};return s.iceServers?l.iceServers=s.iceServers:s.turnServer&&s.turnServer.mode!=="off"&&(c0(s.turnServer.servers)?l.iceServers=s.turnServer.servers:(l.iceServers&&l.iceServers.push(...dN.turnServerConfigToIceServers(s.turnServer.servers)),_u("USE_TURN_SERVER_OF_GATEWAY")&&l.iceServers&&s.turnServer.serversFromGateway&&l.iceServers.push(...dN.turnServerConfigToIceServers(s.turnServer.serversFromGateway)),_u("FORCE_TURN_TCP")?l.iceTransportPolicy="relay":s.turnServer.servers.concat(s.turnServer.serversFromGateway||[]).forEach(p=>{p.forceturn&&(l.iceTransportPolicy="relay")}))),l}static turnServerConfigToIceServers(s){const l=[];return s.forEach(p=>{p.security?p.tcpport&&l.push({username:p.username,credential:p.password,credentialType:"password",urls:"turns:".concat(FO(p.turnServerURL),":").concat(p.tcpport,"?transport=tcp")}):(p.udpport&&!_u("FORCE_TURN_TCP")&&l.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.udpport,"?transport=udp")}),p.tcpport&&l.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.tcpport,"?transport=tcp")}))}),l}async applySendEncodings(s,l){try{if(!L_().supportSetRtpSenderParameters||s.length!==l.length)return;for(let z=0;z<s.length;z++){const H=s[z],$=l[z];if($&&$ instanceof G_){var p,_;if(this.isVP8Simulcast($))continue;const ue={},Ei={};switch($._optimizationMode){case"motion":ue.degradationPreference="maintain-framerate";break;case"detail":ue.degradationPreference="maintain-resolution";break;default:ue.degradationPreference="balanced"}var b,A,k,j;if((p=$._encoderConfig)!==null&&p!==void 0&&p.bitrateMax&&(Ei.maxBitrate=1e3*((b=$._encoderConfig)===null||b===void 0?void 0:b.bitrateMax)),$._hints.includes(J_.LOW_STREAM)&&((A=$._encoderConfig)!==null&&A!==void 0&&A.frameRate&&(Ei.maxFramerate=$S($._encoderConfig.frameRate)),(k=$._encoderConfig)!==null&&k!==void 0&&k.scaleResolutionDownBy&&((j=$._encoderConfig)===null||j===void 0?void 0:j.scaleResolutionDownBy)>1&&(Ei.scaleResolutionDownBy=$._encoderConfig.scaleResolutionDownBy)),_u("DSCP_TYPE")&&xR()){const _o=_u("DSCP_TYPE");["very-low","low","medium","high"].includes(_o)&&(Ei.networkPriority=_o)}const Fi=H.sender.getParameters(),Gi=(_=Fi.encodings)===null||_===void 0?void 0:_[0];O_()&&!Gi&&(ue.encodings=[Ei]),Gi&&Object.assign(Gi,Ei),Object.assign(Fi,ue),await H.sender.setParameters(Fi)}}}catch{_n.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(s,l,p){const _=q_.exports.parse(s);return l.forEach((b,A)=>{const k=p[A],j=_.mediaDescriptions.find(z=>z.attributes.mid===k);j&&(jI(j,b),KG(j,b,this.store.codec))}),q_.exports.print(_)}mungReceiveAnswerSDP(s,l,p){const _=q_.exports.parse(s),b=_.mediaDescriptions.find(A=>A.attributes.mid===l);return b&&p===FE.AUDIO&&b.media.mediaType==="audio"&&yR(b),q_.exports.print(_)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=s=>{var l;(l=this.onFirstAudioReceived)===null||l===void 0||l.call(this,s)},this.statsFilter.onFirstVideoReceived=s=>{var l;(l=this.onFirstVideoReceived)===null||l===void 0||l.call(this,s)},this.statsFilter.onFirstAudioDecoded=s=>{var l;(l=this.onFirstAudioDecoded)===null||l===void 0||l.call(this,s)},this.statsFilter.onFirstVideoDecoded=(s,l,p)=>{var _;(_=this.onFirstVideoDecoded)===null||_===void 0||_.call(this,s,l,p)},this.statsFilter.onSelectedLocalCandidateChanged=(s,l)=>{var p;(p=this.onSelectedLocalCandidateChanged)===null||p===void 0||p.call(this,s,l)},this.statsFilter.onSelectedRemoteCandidateChanged=(s,l)=>{var p;(p=this.onSelectedRemoteCandidateChanged)===null||p===void 0||p.call(this,s,l)},this.statsFilter.onFirstVideoDecodedTimeout=s=>{var l;(l=this.onFirstVideoDecodedTimeout)===null||l===void 0||l.call(this,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(s,l){if(s.length===l.length)for(let k=0;k<s.length;k++){var p,_,b,A;const j=s[k],z=l[k];if(z instanceof G_&&!z._hints.includes(J_.LOW_STREAM)&&(p=z._encoderConfig)!==null&&p!==void 0&&p.bitrateMax&&((_=z._encoderConfig)===null||_===void 0?void 0:_.bitrateMax)>200&&(b=z._scalabiltyMode)!==null&&b!==void 0&&b.numSpatialLayers&&((A=z._scalabiltyMode)===null||A===void 0?void 0:A.numSpatialLayers)>1&&this.store.codec==="vp8"){const H={},$={high:1e3*(z._encoderConfig.bitrateMax-50),medium:5e4};H.encodings=[{rid:"m",active:!0,maxBitrate:$.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:$.high}];const ue=j.sender.getParameters();await j.sender.setParameters(Object.assign(ue,H))}}}async applySimulcastEncodings(s,l){if(!O_()&&s.length===l.length)for(let p=0;p<s.length;p++){const _=l[p];if(_ instanceof G_&&this.isVP8Simulcast(_)){const b=s[p],A={},k={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};A.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:k.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:k.medium,scaleResolutionDownBy:4}];const j=b.sender.getParameters();await b.sender.setParameters(Object.assign(j,A))}}}isVP8Simulcast(s){var l,p,_,b;return!!(s instanceof G_&&_u("SIMULCAST")&&this.store.codec==="vp8"&&!s._hints.includes(J_.LOW_STREAM)&&(l=s._encoderConfig)!==null&&l!==void 0&&l.bitrateMax&&((p=s._encoderConfig)===null||p===void 0?void 0:p.bitrateMax)>200&&(_=s._scalabiltyMode)!==null&&_!==void 0&&_.numSpatialLayers&&((b=s._scalabiltyMode)===null||b===void 0?void 0:b.numSpatialLayers)>1)}logSDPExchange(s,l,p,_){if(_u("SDP_LOGGING"))return _n.upload("exchanging ".concat(p," ").concat(l," SDP during NVExtentionsConnection.").concat(_,`
`),s),l==="offer"?b=>{this.logSDPExchange(b,"answer",p==="local"?"remote":"local",_)}:void 0}async getRemoteSSRC(s){if(!this.remoteSDP)return;const l=this.remoteSDP.getSSRC(s);return l==null?void 0:l[0].ssrcId}setConfiguration(s){if(L_().supportPCSetConfiguration){const l=dN.resolvePCConfiguration(s);this.peerConnection.setConfiguration(l)}}}).prototype,"connect",[JT],Object.getOwnPropertyDescriptor(a_.prototype,"connect"),a_.prototype),oE(a_.prototype,"updateRemoteConnect",[JT],Object.getOwnPropertyDescriptor(a_.prototype,"updateRemoteConnect"),a_.prototype),oE(a_.prototype,"receive",[JT],Object.getOwnPropertyDescriptor(a_.prototype,"receive"),a_.prototype),oE(a_.prototype,"batchReceive",[JT],Object.getOwnPropertyDescriptor(a_.prototype,"batchReceive"),a_.prototype),oE(a_.prototype,"stopReceiving",[JT],Object.getOwnPropertyDescriptor(a_.prototype,"stopReceiving"),a_.prototype),oE(a_.prototype,"muteRemote",[JT],Object.getOwnPropertyDescriptor(a_.prototype,"muteRemote"),a_.prototype),oE(a_.prototype,"unmuteRemote",[JT],Object.getOwnPropertyDescriptor(a_.prototype,"unmuteRemote"),a_.prototype),oE(a_.prototype,"muteLocal",[JT],Object.getOwnPropertyDescriptor(a_.prototype,"muteLocal"),a_.prototype),oE(a_.prototype,"unmuteLocal",[JT],Object.getOwnPropertyDescriptor(a_.prototype,"unmuteLocal"),a_.prototype),oE(a_.prototype,"close",[JT],Object.getOwnPropertyDescriptor(a_.prototype,"close"),a_.prototype),oE(a_.prototype,"updateEncoderConfig",[JT],Object.getOwnPropertyDescriptor(a_.prototype,"updateEncoderConfig"),a_.prototype),oE(a_.prototype,"updateSendParameters",[JT],Object.getOwnPropertyDescriptor(a_.prototype,"updateSendParameters"),a_.prototype),oE(a_.prototype,"replaceTrack",[JT],Object.getOwnPropertyDescriptor(a_.prototype,"replaceTrack"),a_.prototype),oE(a_.prototype,"getRemoteSSRC",[JT],Object.getOwnPropertyDescriptor(a_.prototype,"getRemoteSSRC"),a_.prototype),a_);function JT(o,s,l){const p=o[s];if(typeof p!="function")throw new Error("Cannot use mutex on object property.");return l.value=async function(){const _=this.mutex,b=await _.lock("From NVExtentionsConnection.".concat(s));try{for(var A=arguments.length,k=new Array(A),j=0;j<A;j++)k[j]=arguments[j];return await p.apply(this,k)}finally{b()}},l}var m_;function N4(o){var s,l,p,_=2;for(typeof Symbol<"u"&&(l=VG,p=Symbol.iterator);_--;){if(l&&(s=o[l])!=null)return s.call(o);if(p&&(s=o[p])!=null)return new qL(s.call(o));l="@@asyncIterator",p="@@iterator"}throw new TypeError("Object is not async iterable")}function qL(o){function s(l){if(Object(l)!==l)return RE.reject(new TypeError(l+" is not an object."));var p=l.done;return RE.resolve(l.value).then(function(_){return{value:_,done:p}})}return(qL=function(l){this.s=l,this.n=l.next}).prototype={s:null,n:null,next:function(){return s(this.n.apply(this.s,arguments))},return:function(l){var p=this.s.return;return p===void 0?RE.resolve({value:l,done:!0}):s(p.apply(this.s,arguments))},throw:function(l){var p=this.s.return;return p===void 0?RE.reject(l):s(p.apply(this.s,arguments))}},new qL(o)}let TR=(oE((m_=class lN extends DO{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(s,l){super(s,l),_t(this,"store",void 0),_t(this,"peerConnection",void 0),_t(this,"cname",void 0),_t(this,"mutex",new gT("DataChannelConnection-mutex")),_t(this,"dataChannel",void 0),_t(this,"_p2pConnection",void 0),_t(this,"establishPromise",void 0),_t(this,"_nvMedia",void 0),this.store=l,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(lN.resolvePCConfiguration(s),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new KQ(s,l,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var s;const l=(s=this._nvMedia)===null||s===void 0?void 0:s.getLocalRtpCapabilities();return await this._p2pConnection.establish(l)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(s,l,p,_,b,A){return this.cname=A,await this._p2pConnection.connect(s,l,p,_,b,A),await new RE((k,j)=>{const z=setTimeout(()=>{this.closeSignal(),j(new ga(Di.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(p))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(z),void k()},this.dataChannel.onerror=H=>{this.closeSignal(),j(H)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}send(s,l,p){var _=this;return ES(function*(){const b=yield YE(_.mutex.lock("From DataChannelConnection.send"));try{return yield*ZO(N4(_._p2pConnection.send(s,l,p)),YE)}finally{b()}})()}async stopSending(s,l){return this._p2pConnection.stopSending(s,l)}async receive(s,l,p,_){return this._nvMedia?(_n.debug("[DataChannelConnection] receive ".concat(s," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(s,l,this.cname)):(_n.debug("[DataChannelConnection] receive ".concat(s," by WebRTC.")),await this._p2pConnection.receive(s,l,p,_))}async batchReceive(s){return[...await this._p2pConnection.batchReceive(s)]}async stopReceiving(s){return await this._p2pConnection.stopReceiving(s)}async muteRemote(s){return await this._p2pConnection.muteRemote(s)}async unmuteRemote(s){return await this._p2pConnection.unmuteRemote(s)}async muteLocal(s){return await this._p2pConnection.muteLocal(s)}async unmuteLocal(s){return await this._p2pConnection.unmuteLocal(s)}restartICE(s){var l=this;return ES(function*(){return yield*ZO(N4(l._p2pConnection.restartICE(s)),YE)})()}close(){var s;(s=this._nvMedia)===null||s===void 0||s.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(s){return this._p2pConnection.getRemoteVideoIsReady(s)}updateRemoteConnect(s){var l;(l=this._nvMedia)===null||l===void 0||l.setRemoteRtpCapabilities(s),this._p2pConnection.updateRemoteConnect(s)}async updateEncoderConfig(s,l){return await this._p2pConnection.updateEncoderConfig(s,l)}async updateSendParameters(s,l){return await this._p2pConnection.updateSendParameters(s,l)}setStatsRemoteVideoIsReady(s,l){this._p2pConnection.setStatsRemoteVideoIsReady(s,l)}async replaceTrack(s,l){return await this._p2pConnection.replaceTrack(s,l)}async getRemoteSSRC(s){return this._p2pConnection.getRemoteSSRC(s)}logSDPExchange(s,l,p,_){if(_u("SDP_LOGGING"))return _n.upload("exchanging ".concat(p," ").concat(l," SDP during DataChannelConnection.").concat(_,`
`),s),l==="offer"?b=>{this.logSDPExchange(b,"answer",p==="local"?"remote":"local",_)}:void 0}static resolvePCConfiguration(s){const l={iceServers:[]};return s.iceServers?l.iceServers=s.iceServers:s.turnServer&&s.turnServer.mode!=="off"&&(c0(s.turnServer.servers)?l.iceServers=s.turnServer.servers:(l.iceServers&&l.iceServers.push(...lN.turnServerConfigToIceServers(s.turnServer.servers)),_u("USE_TURN_SERVER_OF_GATEWAY")&&l.iceServers&&s.turnServer.serversFromGateway&&l.iceServers.push(...lN.turnServerConfigToIceServers(s.turnServer.serversFromGateway)),_u("FORCE_TURN_TCP")?l.iceTransportPolicy="relay":s.turnServer.servers.concat(s.turnServer.serversFromGateway||[]).forEach(p=>{p.forceturn&&(l.iceTransportPolicy="relay")}))),l}static turnServerConfigToIceServers(s){const l=[];return s.forEach(p=>{p.security?p.tcpport&&l.push({username:p.username,credential:p.password,credentialType:"password",urls:"turns:".concat(FO(p.turnServerURL),":").concat(p.tcpport,"?transport=tcp")}):(p.udpport&&!_u("FORCE_TURN_TCP")&&l.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.udpport,"?transport=udp")}),p.tcpport&&l.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.tcpport,"?transport=tcp")}))}),l}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=s=>{var l;return(l=this.onICEConnectionStateChange)===null||l===void 0?void 0:l.call(this,s)},this._p2pConnection.onConnectionStateChange=s=>{var l;return(l=this.onConnectionStateChange)===null||l===void 0?void 0:l.call(this,s)},this._p2pConnection.onDTLSTransportStateChange=s=>{var l;return(l=this.onDTLSTransportStateChange)===null||l===void 0?void 0:l.call(this,s)},this._p2pConnection.onDTLSTransportError=s=>{var l;return(l=this.onDTLSTransportError)===null||l===void 0?void 0:l.call(this,s)},this._p2pConnection.onICETransportStateChange=s=>{var l;return(l=this.onICETransportStateChange)===null||l===void 0?void 0:l.call(this,s)},this._p2pConnection.onFirstAudioReceived=s=>{var l;return(l=this.onFirstAudioReceived)===null||l===void 0?void 0:l.call(this,s)},this._p2pConnection.onFirstVideoReceived=s=>{var l;return(l=this.onFirstVideoReceived)===null||l===void 0?void 0:l.call(this,s)},this._p2pConnection.onFirstAudioDecoded=s=>{var l;return(l=this.onFirstAudioDecoded)===null||l===void 0?void 0:l.call(this,s)},this._p2pConnection.onFirstVideoDecoded=(s,l,p)=>{var _;return(_=this.onFirstVideoDecoded)===null||_===void 0?void 0:_.call(this,s,l,p)},this._p2pConnection.onFirstVideoDecodedTimeout=s=>{var l;return(l=this.onFirstVideoDecodedTimeout)===null||l===void 0?void 0:l.call(this,s)},this._p2pConnection.onSelectedLocalCandidateChanged=(s,l)=>{var p;return(p=this.onSelectedLocalCandidateChanged)===null||p===void 0?void 0:p.call(this,s,l)},this._p2pConnection.onSelectedRemoteCandidateChanged=(s,l)=>{var p;return(p=this.onSelectedRemoteCandidateChanged)===null||p===void 0?void 0:p.call(this,s,l)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(s){s.onConnectionStateChange=void 0,s.onICEConnectionStateChange=void 0,s.onICETransportStateChange=void 0,s.onDTLSTransportStateChange=void 0,s.onDTLSTransportError=void 0,s.onFirstAudioDecoded=void 0,s.onFirstAudioReceived=void 0,s.onFirstVideoDecoded=void 0,s.onFirstVideoReceived=void 0,s.onSelectedLocalCandidateChanged=void 0,s.onSelectedRemoteCandidateChanged=void 0,s.onFirstVideoDecodedTimeout=void 0}setConfiguration(s){this._p2pConnection.setConfiguration(s)}}).prototype,"connect",[_S],Object.getOwnPropertyDescriptor(m_.prototype,"connect"),m_.prototype),oE(m_.prototype,"receive",[_S],Object.getOwnPropertyDescriptor(m_.prototype,"receive"),m_.prototype),oE(m_.prototype,"stopReceiving",[_S],Object.getOwnPropertyDescriptor(m_.prototype,"stopReceiving"),m_.prototype),oE(m_.prototype,"muteRemote",[_S],Object.getOwnPropertyDescriptor(m_.prototype,"muteRemote"),m_.prototype),oE(m_.prototype,"unmuteRemote",[_S],Object.getOwnPropertyDescriptor(m_.prototype,"unmuteRemote"),m_.prototype),oE(m_.prototype,"muteLocal",[_S],Object.getOwnPropertyDescriptor(m_.prototype,"muteLocal"),m_.prototype),oE(m_.prototype,"unmuteLocal",[_S],Object.getOwnPropertyDescriptor(m_.prototype,"unmuteLocal"),m_.prototype),oE(m_.prototype,"close",[_S],Object.getOwnPropertyDescriptor(m_.prototype,"close"),m_.prototype),oE(m_.prototype,"updateEncoderConfig",[_S],Object.getOwnPropertyDescriptor(m_.prototype,"updateEncoderConfig"),m_.prototype),oE(m_.prototype,"updateSendParameters",[_S],Object.getOwnPropertyDescriptor(m_.prototype,"updateSendParameters"),m_.prototype),oE(m_.prototype,"replaceTrack",[_S],Object.getOwnPropertyDescriptor(m_.prototype,"replaceTrack"),m_.prototype),oE(m_.prototype,"getRemoteSSRC",[_S],Object.getOwnPropertyDescriptor(m_.prototype,"getRemoteSSRC"),m_.prototype),m_);function _S(o,s,l){const p=o[s];if(typeof p!="function")throw new Error("Cannot use mutex on object property.");return l.value=async function(){const _=this.mutex,b=await _.lock("From DataChannelConnection.".concat(s));try{for(var A=arguments.length,k=new Array(A),j=0;j<A;j++)k[j]=arguments[j];return await p.apply(this,k)}finally{b()}},l}var _m;function P4(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function SR(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?P4(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):P4(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}function D4(o){var s,l,p,_=2;for(typeof Symbol<"u"&&(l=VG,p=Symbol.iterator);_--;){if(l&&(s=o[l])!=null)return s.call(o);if(p&&(s=o[p])!=null)return new WL(s.call(o));l="@@asyncIterator",p="@@iterator"}throw new TypeError("Object is not async iterable")}function WL(o){function s(l){if(Object(l)!==l)return RE.reject(new TypeError(l+" is not an object."));var p=l.done;return RE.resolve(l.value).then(function(_){return{value:_,done:p}})}return(WL=function(l){this.s=l,this.n=l.next}).prototype={s:null,n:null,next:function(){return s(this.n.apply(this.s,arguments))},return:function(l){var p=this.s.return;return p===void 0?RE.resolve({value:l,done:!0}):s(p.apply(this.s,arguments))},throw:function(l){var p=this.s.return;return p===void 0?RE.reject(l):s(p.apply(this.s,arguments))}},new WL(o)}let HQ=(oE((_m=class extends R_{get state(){return this._state}set state(o){const s=this._state;this._state=o,this.emit(QE.StateChange,s,this._state)}constructor(o,s){super(),_t(this,"store",void 0),_t(this,"statsUploader",void 0),_t(this,"connection",void 0),_t(this,"localTrackMap",new Map),_t(this,"remoteUserMap",new Map),_t(this,"pendingLocalTracks",[]),_t(this,"pendingRemoteTracks",[]),_t(this,"statsCollector",void 0),_t(this,"isPlanB",!1),_t(this,"shouldForwardP2PCreation",void 0),_t(this,"iceFailedCount",0),_t(this,"dtlsFailedCount",0),_t(this,"mutex",new gT("P2PChannel-mutex")),_t(this,"_state",X_.Disconnected),_t(this,"_pcStatsUploadType",_u("NEW_ICE_RESTART")?IS.FIRST_CONNECTION:IS.OLD_FIRST_CONNECTION),_t(this,"_isInRestartIce",!1),_t(this,"_isStartRestartIce",!1),_t(this,"_restartStates",["disconnected","failed"]),_t(this,"_restartTimer",void 0),_t(this,"_isFirstConnected",!0),_t(this,"handleMuteLocalTrack",async(l,p,_)=>{const b=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==X_.Connected)return void _(new ga(Di.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const A=this.filterTobeMutedTracks(l);if(A.length===0)return void p();const k=A.find(z=>z[0]==="videoLowTrack");k&&k[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(A.map(z=>{let[,{id:H}]=z;return H}));const j=this.createMuteMessage(A);await C_(this,QE.RequestMuteLocal,j),p()}catch(A){_(A)}finally{b()}}),_t(this,"handleUnmuteLocalTrack",async(l,p,_)=>{const b=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==X_.Connected)return void _(new ga(Di.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const A=this.filterTobeUnmutedTracks(l);if(A.length===0)return void p();const k=A.find(z=>z[0]==="videoLowTrack");if(k){const z=k[1];if(z.track._originMediaStreamTrack.stop(),L_().supportDualStreamEncoding){const H=l._mediaStreamTrack.clone();z.track._mediaStreamTrack=H,z.track._originMediaStreamTrack=H}else{const H=l4(l,zR(this,QE.RequestLowStreamParameter));z.track._mediaStreamTrack=H,z.track._originMediaStreamTrack=H}await new RE((H,$)=>{this.handleReplaceTrack(z.track,H,$,!0)})}await this.connection.unmuteLocal(A.map(z=>{let[,{id:H}]=z;return H}));const j=this.createUnmuteMessage(A);await C_(this,QE.RequestUnmuteLocal,j),p()}catch(A){_(A)}finally{b()}}),_t(this,"handleUpdateVideoEncoder",async(l,p,_)=>{const b=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const A=this.localTrackMap.get(OE.LocalVideoTrack);if(!this.connection||!A||A.track!==l||this.state!==X_.Connected)return void p();const{id:k,track:j}=A;await this.connection.updateSendParameters(k,j),await this.connection.updateEncoderConfig(k,j),this.emit(QE.UpdateVideoEncoder,j),p()}catch(A){_(A)}finally{b()}}),_t(this,"handleSetOptimizationMode",async(l,p,_)=>{const b=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const A=this.localTrackMap.get(OE.LocalVideoTrack);if(!this.connection||!A||A.track!==l||this.state!==X_.Connected)return;const{id:k,track:j}=A;await this.connection.updateSendParameters(k,j),p()}catch(A){_(A)}finally{b()}}),_t(this,"handleReplaceTrack",async(l,p,_,b)=>{let A;_n.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(l.getTrackId(),"]")),typeof b=="boolean"&&b||(A=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var k;const z=Array.from(this.localTrackMap.entries()).find(H=>{let[,{track:$}]=H;return l===$});if(!this.connection||!z||this.state!==X_.Connected)return void p();if(await((k=this.connection)===null||k===void 0?void 0:k.replaceTrack(l,z[1].id)),this.isPlanB){const H=z[1];H.id=l._mediaStreamTrack.id,this.localTrackMap.set(z[0],H)}if(z[0]===OE.LocalVideoTrack&&L_().supportDualStreamEncoding){const H=this.localTrackMap.get(OE.LocalVideoLowTrack);if(H){const $=l._mediaStreamTrack.clone();H.track._originMediaStreamTrack.stop(),H.track._mediaStreamTrack=$,H.track._originMediaStreamTrack=$,await new RE((ue,Ei)=>{this.handleReplaceTrack(H.track,ue,Ei,!0)})}}p()}catch(z){_(z)}finally{var j;(j=A)===null||j===void 0||j()}}),_t(this,"handleGetLocalVideoStats",l=>{l(this.statsCollector.getLocalVideoTrackStats())}),_t(this,"handleGetLocalAudioStats",l=>{l(this.statsCollector.getLocalAudioTrackStats())}),_t(this,"handleGetRemoteVideoStats",l=>this.statsCollector.getRemoteVideoTrackStats(l.uid)[l.uid]),_t(this,"handleGetRemoteAudioStats",l=>this.statsCollector.getRemoteAudioTrackStats(l.uid)[l.uid]),this.store=o,this.statsCollector=s,this.statsCollector.addP2PChannel(this),this.statsUploader=new qQ,this.bindStatsUploaderEvents(),this.isPlanB=!L_().supportUnifiedPlan||_u("CHROME_FORCE_PLAN_B")&&xR(),this.shouldForwardP2PCreation=_u("FORWARD_P2P_CREATION")&&L_().supportPCSetConfiguration,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new TR({},this.store):this.isPlanB?new I0({},this.store):new eR({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(o,s){var l;this.state=X_.New;const p=this.shouldForwardP2PCreation&&((l=this.connection)===null||l===void 0?void 0:l.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!p||(p&&this.connection&&(_n.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new TR(o,this.store):this.isPlanB?new I0(o,this.store):new eR(o,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new ga(Di.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=_u("NEW_ICE_RESTART")?IS.FIRST_CONNECTION:IS.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(o),this.connection.establishPromise}async connect(o,s,l,p,_,b){if(!this.connection)throw new ga(Di.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof TR?this.connection.updateRemoteConnect(p):(this.store.peerConnectionStart(),await this.connection.connect(o,s,l,p,_,b),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=X_.Connected)}async preConnect(o,s,l,p,_,b){if(!this.connection)throw new ga(Di.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const A=await this.connection.connect(o,s,l,p,_,b);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=X_.Connected,A}getEstablishParams(){if(this.connection instanceof TR)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publish(o,s,l){var p=this;return ES(function*(){const _=yield YE(p.mutex.lock("From P2PChannel.publish"));try{if(!p.connection||p.state!==X_.Connected){if(p.state===X_.Disconnected)throw new ga(Di.UNEXPECTED_ERROR,"PeerConnection already disconnected.");p.throwIfTrackTypeNotMatch(o);const A=o.filter(k=>p.pendingLocalTracks.indexOf(k)===-1);return void(p.pendingLocalTracks=p.pendingLocalTracks.concat(A))}p.store.pubId=p.store.pubId+1,eS.markPublishStart(p.store.clientId,p.store.pubId);const b=p.filterTobePublishedTracks(o,s,l);if(b.length===0)return void(yield YE(p.tryToUnmuteAudio(o)));yield*ZO(D4(p.doPublish(p.connection,b)),YE)}finally{_()}})()}doPublish(o,s){var l=this;return ES(function*(){s.forEach(z=>{let{track:H,type:$}=z;const ue=Date.now();l.store.publish(H.getTrackId(),$===OE.LocalAudioTrack?"audio":"video",ue)}),l.bindLocalTrackEvents(s);const p=yield YE(o.send(s.map(z=>{let{track:H}=z;return H}),l.store.codec,l.store.audioCodec)),_=(yield YE(p.next())).value,b=l.createGatewayPublishMessage(s,_);let A;try{A=yield b}catch(z){throw p.throw(z),(z==null?void 0:z.code)===Di.WS_ABORT&&s.forEach(H=>{let{track:$}=H;l.pendingLocalTracks.indexOf($)===-1&&l.pendingLocalTracks.push($)}),l.unbindLocalTrackEvents(s),z}const k=l.mapPubResToRemoteConfig(b,A),j=(yield YE(p.next(k))).value;s.forEach(z=>{let{type:H}=z;l.statsCollector.addLocalStats(H)}),l.assignLocalTracks(s,j),l.statsUploader.startUploadUplinkStats(),s.forEach(z=>{let{track:H,type:$}=z;const ue=Date.now();l.store.publish(H.getTrackId(),$===OE.LocalAudioTrack?"audio":"video",void 0,ue)})})()}publishLowStream(o){var s=this;return ES(function*(){if(!s.connection||s.state!==X_.Connected)return;const l=yield YE(s.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const _=s.localTrackMap.get(OE.LocalVideoTrack);if(!_)throw new ga(Di.UNEXPECTED_ERROR,"Could not find high stream");if(s.localTrackMap.has(OE.LocalVideoLowTrack))throw new ga(Di.UNEXPECTED_ERROR,"[".concat(s.store.clientId,"] Can't publish low stream when stream already publish"));const b=[{track:s.getLowVideoTrack(_.track,o),type:OE.LocalVideoLowTrack}];if(yield*ZO(D4(s.doPublish(s.connection,b)),YE),_.track.muted||!_.track.enabled){var p;const A=(p=s.localTrackMap.get(OE.LocalVideoLowTrack))===null||p===void 0?void 0:p.id;A!==void 0&&(yield YE(s.connection.muteLocal([A])))}}finally{l()}})()}async republish(){this.pendingLocalTracks.length>0&&(_n.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await cT(this,QE.RequestRePublish,this.pendingLocalTracks),this.emit(QE.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async reSubscribe(o){for(let s=this.pendingRemoteTracks.length-1;s>=0;s--){const{user:l,kind:p}=this.pendingRemoteTracks[s];(p!==FE.AUDIO||l._audio_added_&&l._audioSSRC)&&(p!==FE.VIDEO||l._video_added_&&l._videoSSRC)||this.pendingRemoteTracks.splice(s,1)}if(o)await cT(this,QE.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:s,kind:l}of this.pendingRemoteTracks)await this.subscribe(s,l,l===FE.VIDEO?s._videoSSRC:s._audioSSRC);this.pendingRemoteTracks.forEach(s=>{let{user:l}=s;this.emit(QE.MediaReconnectEnd,l.uid)}),this.pendingRemoteTracks=[]}async unpublish(o){if(!this.connection||this.state!==X_.Connected)return void o.forEach(p=>{const _=this.pendingLocalTracks.indexOf(p);_!==-1&&this.pendingLocalTracks.splice(_,1)});const s=this.filterTobeUnpublishedTracks(o);if(s.length===0)return;const l=s.find(p=>p[0]==="videoLowTrack");return l&&l[1].track.close(),this.doUnpublish(this.connection,s)}async unpublishLowStream(){if(!this.connection||this.state!==X_.Connected)return;const o=this.localTrackMap.get(OE.LocalVideoLowTrack);if(!o)return;o.track.close();const s=[[OE.LocalVideoLowTrack,o]];return this.doUnpublish(this.connection,s)}async doUnpublish(o,s){const l=this.createGatewayUnpublishMessage(s);return await o.stopSending(s.map(p=>{let[,{id:_}]=p;return _})),this.withdrawLocalTracks(s),this.unbindLocalTrackEvents(s.map(p=>{let[_,{track:b}]=p;return{type:_,track:b}})),s.forEach(p=>{let[_]=p;this.statsCollector.removeLocalStats(_)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats(),l}async subscribe(o,s,l,p,_){var b;if(!this.connection||this.state!==X_.Connected)throw new ga(Di.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((b=this.remoteUserMap.get(o))!==null&&b!==void 0&&b.has(s))return;let A,k,j;if(_){const $=_.find(Ei=>{let{stream_type:Fi}=Ei;return Fi===s});if(!$)throw new ga(Di.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(s," for user: ").concat(o.uid," because subscribe answer from gateway does not contain stream_type: ").concat(s,"."));const ue=await this.connection.receive(s,$.ssrcs,String(o._uintid),$.attributes);this.connection instanceof eR&&(j=ue.transceiver),A=ue.track,k=ue.id}else{const $=await this.connection.receive(s,[{ssrcId:l,rtx:p}],String(o._uintid),void 0);this.connection instanceof eR&&(j=$.transceiver),A=$.track,k=$.id}s===FE.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack(A):(o._audioTrack=new nN(A,o.uid,o._uintid,this.store),_n.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),j&&o._audioTrack._updateRtpTransceiver(j),this.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack(A):(o._videoTrack=new eN(A,o.uid,o._uintid,this.store),_n.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),j&&o._videoTrack._updateRtpTransceiver(j),this.bindRemoteTrackEvents(o,o._videoTrack));const z=this.remoteUserMap.get(o);z?z.set(s,k):this.remoteUserMap.set(o,new Map([[s,k]])),this.statsCollector.addRemoteStats(o.uid),this.statsUploader.startUploadDownlinkStats();const H=this.pendingRemoteTracks.findIndex($=>{let{user:ue,kind:Ei}=$;return ue.uid===o.uid&&s===Ei});H!==-1&&(this.pendingRemoteTracks.splice(H,1),this.emit(QE.MediaReconnectEnd,o.uid))}async massSubscribe(o){return this.massSubscribeNoLock(o)}async massSubscribeNoLock(o){if(!this.connection||this.state!==X_.Connected)throw new ga(Di.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");o=o.filter(l=>{var p;let{user:_,mediaType:b}=l;return!((p=this.remoteUserMap.get(_))!==null&&p!==void 0&&p.has(b))});const s=await this.connection.batchReceive(o.map(l=>{let{user:p,mediaType:_,ssrcId:b,rtxSsrcId:A}=l;return{kind:_,ssrcMsg:[{ssrcId:b,rtx:A}],mslabel:String(p._uintid)}}));o.forEach((l,p)=>{let{user:_,mediaType:b}=l;const{track:A,id:k,transceiver:j}=s[p];b===FE.AUDIO?(_._audioTrack?_._audioTrack._updateOriginMediaStreamTrack(A):(_._audioTrack=new nN(A,_.uid,_._uintid,this.store),_n.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(_._audioTrack.getTrackId()))),j&&_._audioTrack._updateRtpTransceiver(j),this.bindRemoteTrackEvents(_,_._audioTrack)):(_._videoTrack?_._videoTrack._updateOriginMediaStreamTrack(A):(_._videoTrack=new eN(A,_.uid,_._uintid,this.store),_n.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(_._videoTrack.getTrackId()))),j&&_._videoTrack._updateRtpTransceiver(j),this.bindRemoteTrackEvents(_,_._videoTrack));const z=this.remoteUserMap.get(_);z?z.set(b,k):this.remoteUserMap.set(_,new Map([[b,k]])),this.statsCollector.addRemoteStats(_.uid),this.statsUploader.startUploadDownlinkStats();const H=this.pendingRemoteTracks.findIndex($=>{let{user:ue,kind:Ei}=$;return ue.uid===_.uid&&b===Ei});H!==-1&&(this.pendingRemoteTracks.splice(H,1),this.emit(QE.MediaReconnectEnd,_.uid))})}async unsubscribe(o,s,l){const p=this.pendingRemoteTracks.filter(A=>{let{user:k,kind:j}=A;return s!==void 0?k.uid===o.uid&&s===j:k.uid===o.uid});if(p.forEach(A=>{const k=this.pendingRemoteTracks.indexOf(A);this.pendingRemoteTracks.splice(k,1)}),this.connection&&this.state===X_.Connected||l||p.forEach(A=>{let{kind:k}=A;var j;if(k===FE.AUDIO)(j=o._audioTrack)===null||j===void 0||j._destroy(),o._audioTrack=void 0;else if(k===FE.VIDEO){var z;(z=o._videoTrack)===null||z===void 0||z._destroy(),o._videoTrack=void 0}}),!this.connection||this.state!==X_.Connected)return;const _=this.filterTobeUnSubscribedTracks(o,s);if(_.length===0)return;await this.connection.stopReceiving(_.map(A=>{let[,{id:k}]=A;return k}));const b=this.createUnsubscribeMessage(_);return this.withdrawRemoteTracks(_),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),_.forEach(A=>{let[k,{kind:j}]=A;var z,H;if(j===FE.VIDEO&&k._videoSSRC&&((z=this.connection)===null||z===void 0||z.setStatsRemoteVideoIsReady(k._videoSSRC,!1)),j===FE.VIDEO)this.unbindRemoteTrackEvents(k._videoTrack),l||((H=k._videoTrack)===null||H===void 0||H._destroy(),k._videoTrack=void 0);else if(j===FE.AUDIO){var $;this.unbindRemoteTrackEvents(k._audioTrack),!l&&(($=k._audioTrack)===null||$===void 0||$._destroy(),k._audioTrack=void 0)}}),b}async massUnsubscribe(o){return this.massUnsubscribeNoLock(o)}async massUnsubscribeNoLock(o){let s=[];for(const{user:_,mediaType:b}of o){const A=this.pendingRemoteTracks.filter(k=>{let{user:j,kind:z}=k;return b!==void 0?j.uid===_.uid&&b===z:j.uid===_.uid});A.forEach(k=>{const j=this.pendingRemoteTracks.indexOf(k);this.pendingRemoteTracks.splice(j,1)}),s=s.concat(A)}if(!this.connection||this.state!==X_.Connected)return void s.forEach(_=>{let{user:b,kind:A}=_;var k;if(A===FE.AUDIO)(k=b._audioTrack)===null||k===void 0||k._destroy(),b._audioTrack=void 0;else if(A===FE.VIDEO){var j;(j=b._videoTrack)===null||j===void 0||j._destroy(),b._videoTrack=void 0}});const l=aR(o).call(o,(_,b)=>{let{user:A,mediaType:k}=b;const j=this.filterTobeUnSubscribedTracks(A,k);return _.concat(j)},[]);if(l.length===0)return;await this.connection.stopReceiving(l.map(_=>{let[,{id:b}]=_;return b}));const p=this.createUnsubscribeAllMessage(l);return this.withdrawRemoteTracks(l),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),l.forEach(_=>{let[b,{kind:A}]=_;var k,j;if(A===FE.VIDEO&&b._videoSSRC&&((k=this.connection)===null||k===void 0||k.setStatsRemoteVideoIsReady(b._videoSSRC,!1)),A===FE.VIDEO)this.unbindRemoteTrackEvents(b._videoTrack),(j=b._videoTrack)===null||j===void 0||j._destroy(),b._videoTrack=void 0;else if(A===FE.AUDIO){var z;this.unbindRemoteTrackEvents(b._audioTrack),(z=b._audioTrack)===null||z===void 0||z._destroy(),b._audioTrack=void 0}}),p}async muteRemote(o,s){if(!this.connection)return;const l=this.remoteUserMap.get(o);if(!l)return void _n.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(o.uid,"."));if(!l.get(s))return void _n.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(o.uid," media type ").concat(s,"."));const p=s===FE.VIDEO?o._videoSSRC:o._audioSSRC;p!==void 0&&this.connection.setStatsRemoteVideoIsReady(p,!1)}async unmuteRemote(o,s){return this.unmuteRemoteNoLock(o,s)}async unmuteRemoteNoLock(o,s){if(!this.connection)return;const l=this.remoteUserMap.get(o);if(!l)return void _n.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(o.uid,"."));l.get(s)||_n.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(o.uid," media type ").concat(s,"."))}getAllTracks(o){const s=this.localTrackMap.get(OE.LocalAudioTrack);if((s==null?void 0:s.track)instanceof wT){const l=s.track;return Array.from(this.localTrackMap.entries()).filter(p=>{let[_]=p;return _!==OE.LocalAudioTrack}).filter(p=>{let[_]=p;return!(o&&_===OE.LocalVideoLowTrack)}).map(p=>{let[,{track:_}]=p;return _}).concat(l.trackList)}return Array.from(this.localTrackMap.entries()).filter(l=>{let[p]=l;return!(o&&p===OE.LocalVideoLowTrack)}).map(l=>{let[,{track:p}]=l;return p})}reportPublishEvent(o,s,l,p,_){if(o){const A=this.localTrackMap.get(OE.LocalAudioTrack),k=p?this.localTrackMap.get(OE.LocalVideoLowTrack):this.localTrackMap.get(OE.LocalVideoTrack);wE.publish(this.store.sessionId,{eventElapse:eS.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:o,ec:s,audioName:A==null?void 0:A.track.getTrackLabel(),videoName:k==null?void 0:k.track.getTrackLabel(),screenshare:(k==null?void 0:k.track._hints.indexOf(J_.SCREEN_TRACK))!==-1,audio:!!A,video:!!k,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:_})}else{var b;l||(l=[]);const A=l.find(j=>j instanceof sT),k=p?(b=this.localTrackMap.get(OE.LocalVideoTrack))===null||b===void 0?void 0:b.track:l.find(j=>j instanceof G_);wE.publish(this.store.sessionId,{eventElapse:eS.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:o,ec:s,audioName:A==null?void 0:A.getTrackLabel(),videoName:k==null?void 0:k.getTrackLabel(),screenshare:(k==null?void 0:k._hints.indexOf(J_.SCREEN_TRACK))!==-1,audio:!!A,video:!!k,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:_})}}reportSubscribeEvent(o,s,l,p){const _=p===FE.VIDEO?l._videoSSRC:l._audioSSRC;_&&wE.subscribe(this.store.sessionId,{succ:o,ec:s,video:p===FE.VIDEO,audio:p===FE.AUDIO,peerid:l.uid,subscribeRequestid:p===FE.VIDEO?l._videoSSRC:l._audioSSRC,p2pid:this.store.p2pId,eventElapse:eS.measureFromSubscribeStart(this.store.clientId,_)})}reset(){_n.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new gT("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new TR({},this.store):this.isPlanB?new I0({},this.store):new eR({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const o=this.localTrackMap.get(OE.LocalAudioTrack);if((o==null?void 0:o.track)instanceof wT){if(o.track.trackList.length>0){const s=o.track;o.track.trackList.forEach(l=>{s.removeAudioTrack(l)})}o.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=X_.Disconnected}getStats(){var o;return(o=this.connection)===null||o===void 0?void 0:o.getStats()}getRemoteVideoIsReady(o){var s;return((s=this.connection)===null||s===void 0?void 0:s.getRemoteVideoIsReady(o))||!1}getLocalAudioVolume(){const o=this.localTrackMap.get(OE.LocalAudioTrack);if(o)return o.track.getVolumeLevel()}getLocalVideoSize(){const o=this.localTrackMap.get(OE.LocalVideoTrack);if(o)return{width:o.track._videoWidth||0,height:o.track._videoHeight||0}}getEncoderConfig(o){const s=this.localTrackMap.get(o);return s&&s.track instanceof G_||s&&s.track instanceof sT?s.track._encoderConfig:void 0}getLocalMedia(o){return this.localTrackMap.get(o)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(o,s){if(!o)return this.remoteUserMap.size>0;const l=this.remoteUserMap.get(o);return!!l&&(!s||l.has(s))}async hasRemoteMediaWithLock(o,s){if(!o)return this.remoteUserMap.size>0;const l=this.remoteUserMap.get(o);return!!l&&(!s||l.has(s))}getRemoteMedia(o){var s;const l=Array.from(WR(s=this.remoteUserMap).call(s)).find(p=>p.uid===o);return l?{audioTrack:l.audioTrack,audioSSRC:l._audioSSRC,videoTrack:l.videoTrack,videoSSRC:l._videoSSRC}:{}}getAudioLevels(){let o=Array.from(this.remoteUserMap.entries()).map(l=>{let[p]=l;return{uid:p.uid,level:p.audioTrack?100*p.audioTrack._source.getAccurateVolumeLevel():0}});const s=this.localTrackMap.get(OE.LocalAudioTrack);return s&&o.push({level:100*s.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),o=AD(o).call(o,(l,p)=>l.level-p.level),o}async disconnectForReconnect(){this.connection&&(_n.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=X_.Reconnecting,_u("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(o=>{let[s]=o;var l;s._videoTrack&&s._videoTrack._player&&((l=s._videoTrack._player.getVideoElement())===null||l===void 0||l.pause(),s._videoTrack._player.isKeepLastFrame=!0,s._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new TR({},this.store):this.isPlanB?new I0({},this.store):new eR({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(o=>{let[s,{track:l}]=o;switch(s){case OE.LocalVideoTrack:l._hints.includes(J_.LOW_STREAM)?l.close():this.pendingLocalTracks.push(l);break;case OE.LocalAudioTrack:l instanceof wT?this.pendingLocalTracks=this.pendingLocalTracks.concat(l.trackList):this.pendingLocalTracks.push(l);break;case OE.LocalVideoLowTrack:}}),this.emit(QE.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(o=>{let[s,l]=o;Array.from(WR(l).call(l)).forEach(p=>{this.setPendingRemoteMedia(s,p)}),this.emit(QE.MediaReconnectStart,s.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),_n.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(o,s){for(const l of this.pendingRemoteTracks){const{user:p,kind:_}=l;if((o instanceof mL?o.uid:o)===p.uid&&s===_)return!0}return!1}setPendingRemoteMedia(o,s){this.hasPendingRemoteMedia(o,s)||this.pendingRemoteTracks.push({user:o,kind:s})}restartICE(o){var s=this;return ES(function*(){if(!s.connection||s.state!==X_.Connected||s.connection instanceof TR)return;const l=yield YE(s.mutex.lock("From P2PChannel.restartICE"));let p;try{p=yield YE(s.connection.restartICE(o));const b=yield YE(p.next());if(b.done)return;const A=b.value,k=yield A;switch(s.reportPCDisconnectedOrFailed(o),o){case _v.TCP:s._pcStatsUploadType=IS.TCP_RESTART;break;case _v.RELAY:s._pcStatsUploadType=IS.RELAY_RESTART;break;default:s._pcStatsUploadType=IS.OLD_RESTART}s._isInRestartIce=!0,p.next(k)}catch(b){var _;(_=p)===null||_===void 0||_.throw(b)}finally{l()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const o=this.connection.getStats(),s=this.localTrackMap.get(OE.LocalVideoTrack),l=this.localTrackMap.get(OE.LocalAudioTrack),p=o.videoSend.find(Ei=>Ei.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId)),_=o.audioSend.find(Ei=>Ei.ssrc===(l==null?void 0:l.ssrcs[0].ssrcId));if(!p||!_)return 1;const b=fS(this,QE.NeedSignalRTT),A=p?p.rttMs:void 0,k=_?_.rttMs:void 0,j=A&&k?(A+k)/2:A||k,z=(j&&b?(j+b)/2:j||b)||0,H=100*o.sendPacketLossRate*.7/50+.3*z/1500,$=H<.17?1:H<.36?2:H<.59?3:H<.1?4:5,ue=s==null?void 0:s.track;if(ue&&ue._encoderConfig&&ue._hints.indexOf(J_.SCREEN_TRACK)===-1){const Ei=ue._encoderConfig.bitrateMax,Fi=o.bitrate.actualEncoded;if(Ei&&Fi){const Gi=(1e3*Ei-Fi)/(1e3*Ei);return T7[Gi<.15?0:Gi<.3?1:Gi<.45?2:Gi<.6?3:4][$]}}return $}getDownlinkNetworkQuality(){if(!this.connection)return 0;const o=this.connection.getStats();let s=0;return Array.from(this.remoteUserMap.entries()).forEach(l=>{let[p]=l;const _=p._audioSSRC,b=p._videoSSRC,A=o.audioRecv.find(Fi=>Fi.ssrc===_),k=o.videoRecv.find(Fi=>Fi.ssrc===b);if(!A&&!k)return void(s+=1);const j=fS(this,QE.NeedSignalRTT),z=o.rtt,H=(z&&j?(z+j)/2:z||j)||0,$=A?A.jitterMs:void 0,ue=o.recvPacketLossRate;let Ei=.7*ue*100/50+.3*H/1500;$&&(Ei=.6*ue*100/50+.2*H/1500+.2*$/400),s+=Ei<.1?1:Ei<.17?2:Ei<.36?3:Ei<.59?4:5}),this.remoteUserMap.size>0?Math.round(s/this.remoteUserMap.size):s}async muteLocalTrack(o){return new RE((s,l)=>{this.handleMuteLocalTrack(o,s,l)})}filterTobePublishedTracks(o,s,l){const p=[],_=L_(),b=this.getAllTracks();o=qF(o=o.filter(j=>b.indexOf(j)===-1));let A=!1,k=!1;for(const j of o){if(j instanceof G_&&(this.localTrackMap.has(OE.LocalVideoTrack)||A?new ga(Di.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(p.push({track:j,type:OE.LocalVideoTrack}),A=!0),s)){const z=this.getLowVideoTrack(j,l);p.push({track:z,type:OE.LocalVideoLowTrack})}if(j instanceof sT){const z=this.localTrackMap.get(OE.LocalAudioTrack);if(z){if(!(z.track instanceof wT))throw new ga(Di.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(j._bypassWebAudio)throw new ga(Di.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");z.track.addAudioTrack(j),this.bindLocalAudioTrackEvents(j,!0)}else if(k){const H=p.find($=>{let{type:ue}=$;return ue===OE.LocalAudioTrack});if(!(H.track instanceof wT))throw new ga(Di.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(j._bypassWebAudio)throw new ga(Di.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");H.track.addAudioTrack(j)}else{if(!_.webAudioMediaStreamDest||j instanceof wT||j._bypassWebAudio)p.push({track:j,type:OE.LocalAudioTrack});else{const H=new wT;H.addAudioTrack(j),p.push({track:H,type:OE.LocalAudioTrack})}k=!0}}}return p}filterTobeUnpublishedTracks(o){const s=[],l=this.getAllTracks();o=qF(o=o.filter(p=>l.indexOf(p)!==-1));for(const p of o){if(p instanceof sT){const _=this.localTrackMap.get(OE.LocalAudioTrack);if(!_)continue;_.track instanceof wT?(_.track.removeAudioTrack(p),this.unbindLocalAudioTrackEvents(p),_.track.trackList.length===0&&(s.push([OE.LocalAudioTrack,_]),_.track.close())):s.push([OE.LocalAudioTrack,_])}if(p instanceof G_){const _=this.localTrackMap.get(OE.LocalVideoTrack);if(!_)continue;s.push([OE.LocalVideoTrack,_]);const b=this.localTrackMap.get(OE.LocalVideoLowTrack);b&&s.push([OE.LocalVideoLowTrack,b])}}return s}bindLocalTrackEvents(o){o.forEach(s=>{let{track:l,type:p}=s;switch(p){case OE.LocalVideoTrack:l.addListener(UE.GET_STATS,this.handleGetLocalVideoStats),l.addListener(UE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),l.addListener(UE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),l.addListener(UE.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),l.addListener(UE.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),l.addListener(UE.NEED_REPLACE_TRACK,this.handleReplaceTrack),l.addListener(UE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),l.addListener(UE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case OE.LocalAudioTrack:this.bindLocalAudioTrackEvents(l);break;case OE.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(o,s){o instanceof wT?o.trackList.forEach(l=>{l.addListener(UE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),l.addListener(UE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),l.addListener(UE.GET_STATS,this.handleGetLocalAudioStats),l.addListener(UE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),l.addListener(UE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(o.addListener(UE.GET_STATS,this.handleGetLocalAudioStats),o.addListener(UE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.addListener(UE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.addListener(UE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.addListener(UE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),s||o.addListener(UE.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(o){o||(o=Array.from(this.localTrackMap.entries()).map(s=>{let[l,{track:p}]=s;return{track:p,type:l}})),o.forEach(s=>{let{track:l,type:p}=s;switch(p){case OE.LocalVideoTrack:l.off(UE.GET_STATS,this.handleGetLocalVideoStats),l.off(UE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),l.off(UE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),l.off(UE.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),l.off(UE.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),l.off(UE.NEED_REPLACE_TRACK,this.handleReplaceTrack),l.off(UE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),l.off(UE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case OE.LocalAudioTrack:this.unbindLocalAudioTrackEvents(l);break;case OE.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(o){o instanceof wT?o.trackList.forEach(s=>{s.off(UE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(UE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(UE.GET_STATS,this.handleGetLocalAudioStats),s.off(UE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(UE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(o.off(UE.GET_STATS,this.handleGetLocalAudioStats),o.off(UE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.off(UE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.off(UE.NEED_REPLACE_TRACK,this.handleReplaceTrack),o.off(UE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.off(UE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(o,s){s instanceof eN&&s.addListener(UE.GET_STATS,l=>{l(this.handleGetRemoteVideoStats(o))}),s instanceof nN&&s.addListener(UE.GET_STATS,l=>{l(this.handleGetRemoteAudioStats(o))})}unbindRemoteTrackEvents(o){o&&o.removeAllListeners(UE.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(o=>{let[s,l]=o;l.has(FE.AUDIO)&&this.unbindRemoteTrackEvents(s._audioTrack),l.has(FE.VIDEO)&&this.unbindRemoteTrackEvents(s._videoTrack)})}createGatewayPublishMessage(o,s){return o.map((l,p)=>{let _,b,{track:A,type:k}=l;switch(k){case OE.LocalAudioTrack:_=Y_.Audio,b={dtx:A instanceof jO&&A._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case OE.LocalVideoTrack:_=A._hints.includes(J_.SCREEN_TRACK)?Y_.Screen:Y_.High,b=SR(SR({},VF(A)),{},{codec:this.store.codec});break;case OE.LocalVideoLowTrack:_=Y_.Low,b=SR(SR({},VF(A)),{},{codec:this.store.codec})}return{stream_type:_,attributes:b,ssrcs:s[p]}})}createGatewayUnpublishMessage(o){return o.map(s=>{let l,[p,{track:_,ssrcs:b,id:A}]=s;switch(p){case OE.LocalVideoTrack:l=_._hints.includes(J_.SCREEN_TRACK)?Y_.Screen:Y_.High;break;case OE.LocalAudioTrack:l=Y_.Audio;break;case OE.LocalVideoLowTrack:l=Y_.Low}return{stream_type:l,ssrcs:b,mid:A}})}assignLocalTracks(o,s){o.forEach((l,p)=>{let{track:_,type:b}=l;this.localTrackMap.set(b,{track:_,id:s[p].id,ssrcs:s[p].localSSRC})})}withdrawLocalTracks(o){o.forEach(s=>{let[l]=s;this.localTrackMap.delete(l)})}bindConnectionEvents(o){o.onConnectionStateChange=async s=>{if(_n.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(s,")")),this.emit(QE.PeerConnectionStateChange,s),s!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),s==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),_u("NEW_ICE_RESTART")){if(this._restartStates.includes(s)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const l=b=>{(o.iceConnectionState==="disconnected"||o.iceConnectionState==="checking"||o.iceConnectionState==="failed")&&(_n.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(b)),fS(this,QE.QueryClientConnectionState)==="CONNECTED"&&this.emit(QE.RequestRestartICE,b))},p=()=>{o.iceConnectionState!=="disconnected"&&o.iceConnectionState!=="checking"&&o.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),_n.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(QE.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},_=_u("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(_u("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&L_().supportPCSetConfiguration)l(_v.RELAY),this._restartTimer=window.setTimeout(p,_);else if(O_())l(_v.UDP),this._restartTimer=window.setTimeout(p,4e3);else{if(l(_v.TCP),L_().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{l(_v.RELAY),this._restartTimer=window.setTimeout(p,_)},_));this._restartTimer=window.setTimeout(p,_)}},800))}}else{if(s==="disconnected"&&o.iceConnectionState==="disconnected")return setTimeout(()=>{o.iceConnectionState==="disconnected"&&_u("ICE_RESTART")&&fS(this,QE.QueryClientConnectionState)==="CONNECTED"&&this.emit(QE.RequestRestartICE)},800),void setTimeout(()=>{o.peerConnectionState==="disconnected"&&(_n.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(QE.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);s==="failed"&&(_n.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(QE.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},o.onICEConnectionStateChange=s=>{s!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),_n.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(s,")")),wE.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:s,tag:T_.TRACER}).onSuccess(),this.emit(QE.IceConnectionStateChange,s)},o.onICETransportStateChange=s=>{_n.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(s,")"))},o.onDTLSTransportStateChange=s=>{_n.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(s,")"))},o.onDTLSTransportError=s=>{_n.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(s,")"))},o.onFirstAudioDecoded=s=>{var l;const p=Array.from(WR(l=this.remoteUserMap).call(l)).find(b=>b._audioSSRC===s);var _;p&&(this.store.subscribe(p.uid,"audio",void 0,void 0,void 0,Date.now()),(_=p.audioTrack)===null||_===void 0||_.emit(OI.FIRST_FRAME_DECODED),wE.firstRemoteFrame(this.store.sessionId,Fg.FIRST_AUDIO_DECODE,I_.FIRST_AUDIO_DECODE,{peer:p._uintid,subscribeElapse:eS.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId}))},o.onFirstAudioReceived=s=>{var l;const p=Array.from(WR(l=this.remoteUserMap).call(l)).find(_=>_._audioSSRC===s);p&&wE.firstRemoteFrame(this.store.sessionId,Fg.FIRST_AUDIO_RECEIVED,I_.FIRST_AUDIO_RECEIVED,{peer:p._uintid,subscribeElapse:eS.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId})},o.onFirstVideoDecoded=(s,l,p)=>{this.reportVideoFirstFrameDecoded(s,l,p)},o.onFirstVideoReceived=s=>{var l;const p=Array.from(WR(l=this.remoteUserMap).call(l)).find(_=>_._videoSSRC===s);p&&wE.firstRemoteFrame(this.store.sessionId,Fg.FIRST_VIDEO_RECEIVED,I_.FIRST_VIDEO_RECEIVED,{peer:p._uintid,subscribeElapse:eS.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId})},o.onSelectedLocalCandidateChanged=(s,l)=>{const p=s.candidateType==="relay",_=l.candidateType==="relay";l.candidateType!=="unknown"&&p===_||this.emit(QE.ConnectionTypeChange,p),_n.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(BO(l))," -> ").concat(JSON.stringify(BO(s)),")"))},o.onSelectedRemoteCandidateChanged=(s,l)=>{_n.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(BO(l))," -> ").concat(JSON.stringify(BO(s)),")"))},o.onFirstVideoDecodedTimeout=s=>{this.reportVideoFirstFrameDecoded(s,void 0,void 0,!0)}}unbindConnectionEvents(o){o.onConnectionStateChange=void 0,o.onICEConnectionStateChange=void 0,o.onICETransportStateChange=void 0,o.onDTLSTransportStateChange=void 0,o.onDTLSTransportError=void 0,o.onFirstAudioDecoded=void 0,o.onFirstAudioReceived=void 0,o.onFirstVideoDecoded=void 0,o.onFirstVideoReceived=void 0,o.onSelectedLocalCandidateChanged=void 0,o.onSelectedRemoteCandidateChanged=void 0,o.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(o){const s=[];if(this.getAllTracks().indexOf(o)===-1)return s;const l=this.localTrackMap.get(OE.LocalAudioTrack);if(o instanceof sT&&(l==null?void 0:l.track)instanceof wT)return l.track.isActive||s.push([OE.LocalAudioTrack,l]),s;const p=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:b}]=_;return o===b});if(p&&(s.push(p),p[0]===OE.LocalVideoTrack)){const _=this.localTrackMap.get(OE.LocalVideoLowTrack);_&&s.push([OE.LocalVideoLowTrack,_])}return s}filterTobeUnmutedTracks(o){const s=[],l=this.localTrackMap.get(OE.LocalAudioTrack);if(o instanceof sT&&(l==null?void 0:l.track)instanceof wT)return l.track.isActive&&s.push([OE.LocalAudioTrack,l]),s;const p=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:b}]=_;return o===b});if(p)if(p[0]===OE.LocalVideoTrack){s.push(p);const _=this.localTrackMap.get(OE.LocalVideoLowTrack);_&&s.push([OE.LocalVideoLowTrack,_])}else s.push(p);return s}createMuteMessage(o){return o.map(s=>{let l,[p,{track:_,ssrcs:b,id:A}]=s;switch(p){case OE.LocalAudioTrack:l=Y_.Audio;break;case OE.LocalVideoTrack:l=_._hints.includes(J_.SCREEN_TRACK)?Y_.Screen:Y_.High;break;case OE.LocalVideoLowTrack:l=Y_.Low}return{stream_type:l,ssrcs:b,mid:A}})}createUnmuteMessage(o){return o.map(s=>{let l,[p,{track:_,ssrcs:b,id:A}]=s;switch(p){case OE.LocalAudioTrack:l=Y_.Audio;break;case OE.LocalVideoTrack:l=_._hints.includes(J_.SCREEN_TRACK)?Y_.Screen:Y_.High;break;case OE.LocalVideoLowTrack:l=Y_.Low}return{stream_type:l,ssrcs:b,mid:A}})}filterTobeUnSubscribedTracks(o,s){const l=[],p=this.remoteUserMap.get(o);if(!p)return l;if(s){const _=p.get(s);if(!_)return l;l.push([o,{kind:s,id:_}])}else Array.from(p.entries()).forEach(_=>{let[b,A]=_;l.push([o,{kind:b,id:A}])});return l}createUnsubscribeMessage(o){const s=[];return o.forEach(l=>{let[p,{kind:_,id:b}]=l;switch(_){case FE.VIDEO:return void(p._videoSSRC&&s.push({stream_type:FE.VIDEO,ssrcId:p._videoSSRC}));case FE.AUDIO:return void(p._audioSSRC&&s.push({stream_type:FE.AUDIO,ssrcId:p._audioSSRC}))}}),s}createUnsubscribeAllMessage(o){const s=new Map;return o.forEach(l=>{let[p,{kind:_}]=l;if(s.has(p)){let b=s.get(p);_===FE.VIDEO?b|=V_.Video:b|=V_.Audio,s.set(p,b)}else _===FE.VIDEO?s.set(p,V_.Video):s.set(p,V_.Audio)}),{users:Array.from(s.entries()).map(l=>{let[p,_]=l;return{stream_id:p.uid,stream_type:_}})}}withdrawRemoteTracks(o){o.forEach(s=>{let[l,{kind:p}]=s;const _=this.remoteUserMap.get(l);_&&(_.delete(p),Array.from(_.entries()).length===0&&this.remoteUserMap.delete(l))})}async updateBitrateLimit(o){const s=this.localTrackMap.get(OE.LocalVideoTrack),l=this.localTrackMap.get(OE.LocalVideoLowTrack);s&&await s.track.setBitrateLimit(o.uplink),l&&o.low_stream_uplink&&await l.track.setBitrateLimit({max_bitrate:o.low_stream_uplink.bitrate,min_bitrate:o.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(o,s){return o.map((l,p)=>{var _;let{stream_type:b}=l;return(_=s.find(A=>{let{stream_type:k}=A;return b===k}))===null||_===void 0?void 0:_.attributes})}async tryToUnmuteAudio(o){for(let l=0;l<o.length;l++)if(o[l]instanceof sT){var s;const p=this.filterTobeUnmutedTracks(o[l]);if(p.length===0)continue;await((s=this.connection)===null||s===void 0?void 0:s.unmuteLocal(p.map(b=>{let[,{id:A}]=b;return A})));const _=this.createUnmuteMessage(p);return void await C_(this,QE.RequestUnmuteLocal,_)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=o=>{var s;return!((s=this.connection)===null||s===void 0||!s.getRemoteVideoIsReady(o))},this.statsUploader.requestUpload=(o,s)=>this.emit(QE.RequestUploadStats,o,s),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await aT(uD(this.dtlsFailedCount,x_)),this.emit(QE.RequestReconnect)}async reconnectP2P(){const o=Array.from(this.localTrackMap.entries()),s=this.createGatewayUnpublishMessage(o);Array.from(this.remoteUserMap.entries()),s.length>0&&await cT(this,QE.RequestUnpublishForReconnectPC,s),this.disconnectForReconnect(),this.emit(QE.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(OE.LocalVideoTrack)||this.pendingLocalTracks.some(o=>o instanceof G_)}throwIfTrackTypeNotMatch(o){if(o.filter(s=>s instanceof G_).length>1)throw new ga(Di.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(o.filter(s=>s instanceof sT).length>1&&(o.some(s=>s instanceof sT&&s._bypassWebAudio)||!L_().webAudioMediaStreamDest))throw new ga(Di.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const s of o){if(s instanceof G_&&this.pendingLocalTracks.some(l=>l instanceof G_))throw new ga(Di.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(s instanceof sT&&this.pendingLocalTracks.some(l=>l instanceof sT)&&(!L_().webAudioMediaStreamDest||s._bypassWebAudio||this.pendingLocalTracks.some(l=>l instanceof sT&&l._bypassWebAudio)))throw new ga(Di.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(o,s){const l=L_().supportDualStreamEncoding,p=SR(SR({},{width:160,height:120,framerate:15,bitrate:50}),s);let _;_=l?o._mediaStreamTrack.clone():l4(o,p);const b=y_(8,"track-low-"),A=new G_(_,SR(SR({},l&&{scaleResolutionDownBy:IX(p,o)}),{},{frameRate:p.framerate,bitrateMax:p.bitrate,bitrateMin:p.bitrate}),void 0,void 0,b);return A.on(u0.TRANSCEIVER_UPDATED,k=>{o._updateRtpTransceiver(k,II.LOW_STREAM)}),A._hints.push(J_.LOW_STREAM),o.addListener(UE.NEED_CLOSE,()=>{A.close()}),A}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(o,s,l){let p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof eR){var _,b,A,k;const j=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:z,dtlsTransportState:H,peerConnectionState:$}=this.connection,{local:ue,remote:Ei}=await this.connection.getSelectedCandidatePair();wE.pcStats(this.store.sessionId,{startTime:j,eventElapse:o-j||0,iceconnectionsate:z,dtlsstate:H,connectionstate:$,intSucc:s?1:2,error:p,selectedLocalCandidateProtocol:(_=ue==null?void 0:ue.protocol)!==null&&_!==void 0?_:"",selectedLocalCandidateType:(b=ue.candidateType)!==null&&b!==void 0?b:"",selectedLocalCandidateAddress:"".concat(ue.address,":").concat(ue.port),selectedRemoteCandidateProtocol:(A=Ei.protocol)!==null&&A!==void 0?A:"",selectedRemoteCandidateType:(k=Ei.candidateType)!==null&&k!==void 0?k:"",selectedRemoteCandidateAddress:"".concat(Ei.address,":").concat(Ei.port),restartCnt:l})}}reportVideoFirstFrameDecoded(o,s,l,p){var _;const b=Array.from(WR(_=this.remoteUserMap).call(_)).find(A=>A._videoSSRC===o);if(b){p||this.store.subscribe(b.uid,"video",void 0,void 0,void 0,void 0,Date.now());const A=this.store.keyMetrics,k=A.subscribe.find(j=>j.userId===b.uid&&j.type==="video");wE.firstRemoteVideoDecode(this.store.sessionId,Fg.FIRST_VIDEO_DECODE,I_.FIRST_VIDEO_DECODE,{peer:b._uintid,videowidth:s,videoheight:l,subscribeElapse:eS.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId,apEnd:A.requestAPEnd||0,apStart:A.requestAPStart||0,joinGwEnd:A.joinGatewayEnd||0,joinGwStart:A.joinGatewayStart||0,pcEnd:A.peerConnectionEnd||0,pcStart:A.peerConnectionStart||0,subscriberEnd:(k==null?void 0:k.subscribeEnd)||0,subscriberStart:(k==null?void 0:k.subscribeStart)||0,videoAddNotify:(k==null?void 0:k.streamAdded)||0,state:p?1:0})}}async remoteMediaSsrcChanged(o,s,l){if(!this.connection)return!1;const p=this.remoteUserMap.get(o);if(!p)return!1;const _=p.get(s);if(!_)return!1;const b=await this.connection.getRemoteSSRC(_);return b!==void 0&&b!==l}resetConnection(o){_n.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(o)),this.state===X_.Connected?(_n.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=o===NO.datachannel?new TR({},this.store):this.isPlanB?new I0({},this.store):new eR({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(o=>{let[s,{track:l}]=o;s===OE.LocalVideoLowTrack?l._updateRtpTransceiver(void 0,II.LOW_STREAM):l._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(o){this.connection&&this.connection instanceof eR&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===IS.TCP_RESTART&&o===_v.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,IS.DISCONNECTED_OR_FAILED)))}}).prototype,"startP2PConnection",[UT],Object.getOwnPropertyDescriptor(_m.prototype,"startP2PConnection"),_m.prototype),oE(_m.prototype,"connect",[UT],Object.getOwnPropertyDescriptor(_m.prototype,"connect"),_m.prototype),oE(_m.prototype,"preConnect",[UT],Object.getOwnPropertyDescriptor(_m.prototype,"preConnect"),_m.prototype),oE(_m.prototype,"unpublish",[UT],Object.getOwnPropertyDescriptor(_m.prototype,"unpublish"),_m.prototype),oE(_m.prototype,"unpublishLowStream",[UT],Object.getOwnPropertyDescriptor(_m.prototype,"unpublishLowStream"),_m.prototype),oE(_m.prototype,"subscribe",[UT],Object.getOwnPropertyDescriptor(_m.prototype,"subscribe"),_m.prototype),oE(_m.prototype,"massSubscribe",[UT],Object.getOwnPropertyDescriptor(_m.prototype,"massSubscribe"),_m.prototype),oE(_m.prototype,"unsubscribe",[UT],Object.getOwnPropertyDescriptor(_m.prototype,"unsubscribe"),_m.prototype),oE(_m.prototype,"massUnsubscribe",[UT],Object.getOwnPropertyDescriptor(_m.prototype,"massUnsubscribe"),_m.prototype),oE(_m.prototype,"muteRemote",[UT],Object.getOwnPropertyDescriptor(_m.prototype,"muteRemote"),_m.prototype),oE(_m.prototype,"unmuteRemote",[UT],Object.getOwnPropertyDescriptor(_m.prototype,"unmuteRemote"),_m.prototype),oE(_m.prototype,"hasRemoteMediaWithLock",[UT],Object.getOwnPropertyDescriptor(_m.prototype,"hasRemoteMediaWithLock"),_m.prototype),oE(_m.prototype,"disconnectForReconnect",[UT],Object.getOwnPropertyDescriptor(_m.prototype,"disconnectForReconnect"),_m.prototype),oE(_m.prototype,"updateBitrateLimit",[UT],Object.getOwnPropertyDescriptor(_m.prototype,"updateBitrateLimit"),_m.prototype),oE(_m.prototype,"remoteMediaSsrcChanged",[UT],Object.getOwnPropertyDescriptor(_m.prototype,"remoteMediaSsrcChanged"),_m.prototype),_m);function UT(o,s,l){const p=o[s];if(typeof p!="function")throw new Error("Cannot use mutex on object property.");return l.value=async function(){const _=this.mutex,b=await _.lock("From P2PChannel.".concat(s));try{for(var A=arguments.length,k=new Array(A),j=0;j<A;j++)k[j]=arguments[j];return await p.apply(this,k)}finally{b()}},l}function k4(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function CE(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?k4(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):k4(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}var WE;(function(o){o.SET_SESSION_ID="SET_SESSION_ID",o.SET_P2P_ID="SET_P2P_id",o.SET_DC_ID="SET_DC_id",o.SET_UID="SET_UID",o.SET_PUB_ID="SET_PUB_ID",o.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",o.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",o.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",o.AVOID_JOIN_START="AVOID_JOIN_START",o.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",o.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",o.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",o.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",o.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",o.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",o.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",o.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",o.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",o.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",o.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",o.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",o.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",o.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",o.RESET_KEY_METRICS="RESET_KEY_METRICS",o.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL"})(WE||(WE={}));class YQ{constructor(s,l,p,_){_t(this,"state",void 0),this.state={codec:s,audioCodec:l,mode:p,clientId:_,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1}}dispatch(s){this.state=function(l,p){switch(p.type){case WE.SET_SESSION_ID:return CE(CE({},l),{},{sessionId:p.sessionId});case WE.SET_P2P_ID:return CE(CE({},l),{},{p2pId:p.p2pId});case WE.SET_UID:return CE(CE({},l),{},{uid:p.uid});case WE.SET_PUB_ID:return CE(CE({},l),{},{pubId:p.pubId});case WE.KEY_METRIC_CLIENT_CREATED:return CE(CE({},l),{},{keyMetrics:CE(CE({},l.keyMetrics),{},{clientCreated:p.metric})});case WE.KEY_METRIC_JOIN_START:return CE(CE({},l),{},{keyMetrics:CE(CE({},l.keyMetrics),{},{joinStart:p.metric})});case WE.AVOID_JOIN_START:return CE(CE({},l),{},{avoidJoinStart:p.avoidJoinStart});case WE.KEY_METRIC_JOIN_END:return CE(CE({},l),{},{keyMetrics:CE(CE({},l.keyMetrics),{},{joinEnd:p.metric})});case WE.KEY_METRIC_REQUEST_AP_START:return CE(CE({},l),{},{keyMetrics:CE(CE({},l.keyMetrics),{},{requestAPStart:p.metric})});case WE.KEY_METRIC_REQUEST_AP_END:return CE(CE({},l),{},{keyMetrics:CE(CE({},l.keyMetrics),{},{requestAPEnd:p.metric})});case WE.KEY_METRIC_JOIN_GATEWAY_START:return CE(CE({},l),{},{keyMetrics:CE(CE({},l.keyMetrics),{},{joinGatewayStart:p.metric})});case WE.KEY_METRIC_JOIN_GATEWAY_END:return CE(CE({},l),{},{keyMetrics:CE(CE({},l.keyMetrics),{},{joinGatewayEnd:p.metric})});case WE.KEY_METRIC_PEER_CONNECTION_START:return CE(CE({},l),{},{keyMetrics:CE(CE({},l.keyMetrics),{},{peerConnectionStart:p.metric})});case WE.KEY_METRIC_PEER_CONNECTION_END:return CE(CE({},l),{},{keyMetrics:CE(CE({},l.keyMetrics),{},{peerConnectionEnd:p.metric})});case WE.KEY_METRIC_DESCRIPTION_START:return CE(CE({},l),{},{keyMetrics:CE(CE({},l.keyMetrics),{},{descriptionStart:p.metric})});case WE.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return CE(CE({},l),{},{keyMetrics:CE(CE({},l.keyMetrics),{},{signalChannelOpen:p.metric})});case WE.KEY_METRIC_ICE_CONNECTION_END:return CE(CE({},l),{},{keyMetrics:CE(CE({},l.keyMetrics),{},{iceConnectionEnd:p.metric})});case WE.KEY_METRIC_PUBLISH:{const _=l.keyMetrics.publish,b=_.findIndex(A=>A.trackId===p.metric.trackId);return b!==-1?(_[b]=CE(CE({},_[b]),p.metric),CE(CE({},l),{},{keyMetrics:CE(CE({},l.keyMetrics),{},{publish:[..._]})})):CE(CE({},l),{},{keyMetrics:CE(CE({},l.keyMetrics),{},{publish:[...l.keyMetrics.publish,p.metric]})})}case WE.KEY_METRIC_SUBSCRIBE:{const _=l.keyMetrics.subscribe,b=_.findIndex(A=>A.userId===p.metric.userId&&A.type===p.metric.type);return b!==-1?(_[b]=CE(CE({},_[b]),p.metric),CE(CE({},l),{},{keyMetrics:CE(CE({},l.keyMetrics),{},{subscribe:[..._]})})):CE(CE({},l),{},{keyMetrics:CE(CE({},l.keyMetrics),{},{subscribe:[...l.keyMetrics.subscribe,p.metric]})})}case WE.SET_CLOUD_PROXY_SERVER_MODE:return l.cloudProxyServerMode=p.mode,l;case WE.RECORD_JOIN_CHANNEL_SERVICE:return typeof p.index!="number"?l.joinChannelServiceRecords=[...l.joinChannelServiceRecords,p.record]:(l.joinChannelServiceRecords[p.index]=CE(CE({},l.joinChannelServiceRecords[p.index]),p.record),l.joinChannelServiceRecords=[...l.joinChannelServiceRecords]),l;case WE.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return l.joinChannelServiceRecords=[],l;case WE.RESET_KEY_METRICS:return l.keyMetrics={publish:[],subscribe:[]},l;case WE.SET_USE_DATACHANNEL:return CE(CE({},l),{},{useDataChannel:p.val});default:return l}}(this.state,s)}set sessionId(s){this.dispatch({type:WE.SET_SESSION_ID,sessionId:s})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(s){this.dispatch({type:WE.SET_P2P_ID,p2pId:s})}get p2pId(){return this.state.p2pId}set dcId(s){this.dispatch({type:WE.SET_DC_ID,dcId:s})}get dcId(){return this.state.dcId}set uid(s){this.dispatch({type:WE.SET_UID,uid:s})}get uid(){return this.state.uid}set pubId(s){this.dispatch({type:WE.SET_PUB_ID,pubId:s})}get pubId(){return this.state.pubId}set cloudProxyServerMode(s){this.dispatch({type:WE.SET_CLOUD_PROXY_SERVER_MODE,mode:s})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(s){this.dispatch({type:WE.SET_USE_DATACHANNEL,val:s})}get useDataChannel(){return this.state.useDataChannel}clientCreated(){this.dispatch({type:WE.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:WE.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:WE.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:WE.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:WE.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:WE.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:WE.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:WE.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:WE.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:WE.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:WE.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:WE.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(s,l,p,_){this.dispatch({type:WE.KEY_METRIC_PUBLISH,metric:CE(CE({trackId:s,type:l},p&&{publishStart:p}),_&&{publishEnd:_})})}subscribe(s,l,p,_,b,A,k){this.dispatch({type:WE.KEY_METRIC_SUBSCRIBE,metric:CE(CE(CE(CE(CE({userId:s,type:l},p&&{subscribeStart:p}),_&&{subscribeEnd:_}),b&&{firstFrame:b}),A&&{streamAdded:A}),k&&{firstDecoded:k})})}massSubscribe(s,l,p,_){s.forEach(b=>{this.dispatch({type:WE.KEY_METRIC_SUBSCRIBE,metric:CE(CE(CE({userId:b.userId,type:b.type},l&&{subscribeStart:l}),p&&{subscribeEnd:p}),_&&{firstFrame:_})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(s,l){s.service==="gateway"&&Array.isArray(s.urls)&&(s.urls=s.urls.map(p=>p.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof l!="number"?(this.dispatch({type:WE.RECORD_JOIN_CHANNEL_SERVICE,record:CE(CE({},s),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(l<0||l>=this.state.joinChannelServiceRecords.length||this.dispatch({type:WE.RECORD_JOIN_CHANNEL_SERVICE,record:s,index:l}),l)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:WE.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:WE.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(s){this.dispatch({type:WE.AVOID_JOIN_START,avoidJoinStart:s})}}let oN;const zQ=()=>(oN||oN||(oN=(window.location.protocol.split(":")[0]||"").toUpperCase(),oN))==="HTTPS",L4=()=>window.isSecureContext!==void 0;function JQ(o){let s=x4();return function(l,p){let _=l.appId;_!==void 0&&(e_(p,10),VS(p,_));let b=l.cid;b!==void 0&&(e_(p,16),e_(p,b));let A=l.cname;A!==void 0&&(e_(p,26),VS(p,A));let k=l.deviceId;k!==void 0&&(e_(p,34),VS(p,k));let j=l.elapse;j!==void 0&&(e_(p,40),RR(p,j));let z=l.fileSize;z!==void 0&&(e_(p,48),RR(p,FI(z)));let H=l.height;H!==void 0&&(e_(p,56),RR(p,FI(H)));let $=l.jpg;$!==void 0&&(e_(p,66),e_(p,$.length),function(NT,nE){let dE=BI(NT,nE.length);NT.bytes.set(nE,dE)}(p,$));let ue=l.networkType;ue!==void 0&&(e_(p,72),RR(p,FI(ue)));let Ei=l.osType;Ei!==void 0&&(e_(p,80),RR(p,FI(Ei)));let Fi=l.requestId;Fi!==void 0&&(e_(p,90),VS(p,Fi));let Gi=l.sdkVersion;Gi!==void 0&&(e_(p,98),VS(p,Gi));let _o=l.sequence;_o!==void 0&&(e_(p,104),RR(p,FI(_o)));let _f=l.sid;_f!==void 0&&(e_(p,114),VS(p,_f));let vf=l.timestamp;vf!==void 0&&(e_(p,120),RR(p,vf));let uE=l.uid;uE!==void 0&&(e_(p,128),e_(p,uE));let IE=l.vid;IE!==void 0&&(e_(p,136),e_(p,IE));let lE=l.width;lE!==void 0&&(e_(p,144),RR(p,FI(lE)));let hE=l.service;hE!==void 0&&(e_(p,152),e_(p,hE));let sE=l.callbackData;sE!==void 0&&(e_(p,162),VS(p,sE));let mE=l.jpgEncryption;mE!==void 0&&(e_(p,168),e_(p,mE));let n_=l.requestType;n_!==void 0&&(e_(p,176),e_(p,n_));let DE=l.scorePorn;DE!==void 0&&(e_(p,185),JL(p,DE));let __=l.scoreSexy;__!==void 0&&(e_(p,193),JL(p,__));let d_=l.scoreNeutral;d_!==void 0&&(e_(p,201),JL(p,d_));let U_=l.scene;U_!==void 0&&(e_(p,208),e_(p,U_));let _b=l.ossFilePrefix;_b!==void 0&&(e_(p,218),VS(p,_b));let k_=l.serviceVendor;if(k_!==void 0)for(let NT of k_){e_(p,226);let nE=x4();$Q(NT,nE),e_(p,nE.limit),n$(p,nE),e$(nE)}}(o,s),function(l){let p=l.bytes,_=l.limit;return p.length===_?p:p.subarray(0,_)}(s)}function XQ(o){return function(l){let p={};t:for(;!j4(l);){let _=FS(l);switch(_>>>3){case 0:break t;case 1:p.code=FS(l);break;case 2:p.msg=V4(l,FS(l));break;case 3:{let b=ZQ(l);p.data=QQ(l),l.limit=b;break}default:M4(l,7&_)}}return p}({bytes:s=o,offset:0,limit:s.length});var s}function QQ(o){let s={};t:for(;!j4(o);){let l=FS(o);switch(l>>>3){case 0:break t;case 1:s.requestId=V4(o,FS(o));break;case 2:s.requestType=FS(o)>>>0;break;case 3:s.scorePorn=zL(o);break;case 4:s.scoreSexy=zL(o);break;case 5:s.scoreNeutral=zL(o);break;case 6:s.requestScene=FS(o)>>>0;break;case 7:s.scene=FS(o)>>>0;break;default:M4(o,7&l)}}return s}function $Q(o,s){let l=o.service;l!==void 0&&(e_(s,8),e_(s,l));let p=o.vendor;p!==void 0&&(e_(s,16),e_(s,p));let _=o.token;_!==void 0&&(e_(s,26),VS(s,_));let b=o.callbackUrl;b!==void 0&&(e_(s,34),VS(s,b))}function ZQ(o){let s=FS(o),l=o.limit;return o.limit=o.offset+s,l}function M4(o,s){switch(s){case 0:for(;128&F4(o););break;case 2:HL(o,FS(o));break;case 5:HL(o,4);break;case 1:HL(o,8);break;default:throw new Error("Unimplemented type: "+s)}}let t$=new Float32Array(1);new Uint8Array(t$.buffer);let KL=new Float64Array(1),CT=new Uint8Array(KL.buffer);function FI(o){return{low:o|=0,high:o>>31,unsigned:o>=0}}let U4=[];function x4(){const o=U4.pop();return o?(o.offset=o.limit=0,o):{bytes:new Uint8Array(64),offset:0,limit:0}}function e$(o){U4.push(o)}function HL(o,s){if(o.offset+s>o.limit)throw new Error("Skip past limit");o.offset+=s}function j4(o){return o.offset>=o.limit}function BI(o,s){let l=o.bytes,p=o.offset,_=o.limit,b=p+s;if(b>l.length){let A=new Uint8Array(2*b);A.set(l),o.bytes=A}return o.offset=b,b>_&&(o.limit=b),p}function YL(o,s){let l=o.offset;if(l+s>o.limit)throw new Error("Read past limit");return o.offset+=s,l}function V4(o,s){let l=YL(o,s),p=String.fromCharCode,_=o.bytes,b="ï¿½",A="";for(let k=0;k<s;k++){let j,z,H,$,ue=_[k+l];128&ue?(224&ue)==192?k+1>=s?A+=b:(j=_[k+l+1],(192&j)!=128?A+=b:($=(31&ue)<<6|63&j,$<128?A+=b:(A+=p($),k++))):(240&ue)==224?k+2>=s?A+=b:(j=_[k+l+1],z=_[k+l+2],(49344&(j|z<<8))!=32896?A+=b:($=(15&ue)<<12|(63&j)<<6|63&z,$<2048||$>=55296&&$<=57343?A+=b:(A+=p($),k+=2))):(248&ue)==240?k+3>=s?A+=b:(j=_[k+l+1],z=_[k+l+2],H=_[k+l+3],(12632256&(j|z<<8|H<<16))!=8421504?A+=b:($=(7&ue)<<18|(63&j)<<12|(63&z)<<6|63&H,$<65536||$>1114111?A+=b:($-=65536,A+=p(55296+($>>10),56320+(1023&$)),k+=3))):A+=b:A+=p(ue)}return A}function VS(o,s){let l=s.length,p=0;for(let A=0;A<l;A++){let k=s.charCodeAt(A);k>=55296&&k<=56319&&A+1<l&&(k=(k<<10)+s.charCodeAt(++A)-56613888),p+=k<128?1:k<2048?2:k<65536?3:4}e_(o,p);let _=BI(o,p),b=o.bytes;for(let A=0;A<l;A++){let k=s.charCodeAt(A);k>=55296&&k<=56319&&A+1<l&&(k=(k<<10)+s.charCodeAt(++A)-56613888),k<128?b[_++]=k:(k<2048?b[_++]=k>>6&31|192:(k<65536?b[_++]=k>>12&15|224:(b[_++]=k>>18&7|240,b[_++]=k>>12&63|128),b[_++]=k>>6&63|128),b[_++]=63&k|128)}}function n$(o,s){let l=BI(o,s.limit),p=o.bytes,_=s.bytes;for(let b=0,A=s.limit;b<A;b++)p[b+l]=_[b]}function F4(o){return o.bytes[YL(o,1)]}function B4(o,s){let l=BI(o,1);o.bytes[l]=s}function zL(o){let s=YL(o,8),l=o.bytes;return CT[0]=l[s++],CT[1]=l[s++],CT[2]=l[s++],CT[3]=l[s++],CT[4]=l[s++],CT[5]=l[s++],CT[6]=l[s++],CT[7]=l[s++],KL[0]}function JL(o,s){let l=BI(o,8),p=o.bytes;KL[0]=s,p[l++]=CT[0],p[l++]=CT[1],p[l++]=CT[2],p[l++]=CT[3],p[l++]=CT[4],p[l++]=CT[5],p[l++]=CT[6],p[l++]=CT[7]}function FS(o){let s,l=0,p=0;do s=F4(o),l<32&&(p|=(127&s)<<l),l+=7;while(128&s);return p}function e_(o,s){for(s>>>=0;s>=128;)B4(o,127&s|128),s>>>=7;B4(o,s)}function RR(o,s){let l=s.low>>>0,p=(s.low>>>28|s.high<<4)>>>0,_=s.high>>>24,b=_===0?p===0?l<16384?l<128?1:2:l<1<<21?3:4:p<16384?p<128?5:6:p<1<<21?7:8:_<128?9:10,A=BI(o,b),k=o.bytes;switch(b){case 10:k[A+9]=_>>>7&1;case 9:k[A+8]=b!==9?128|_:127&_;case 8:k[A+7]=b!==8?p>>>21|128:p>>>21&127;case 7:k[A+6]=b!==7?p>>>14|128:p>>>14&127;case 6:k[A+5]=b!==6?p>>>7|128:p>>>7&127;case 5:k[A+4]=b!==5?128|p:127&p;case 4:k[A+3]=b!==4?l>>>21|128:l>>>21&127;case 3:k[A+2]=b!==3?l>>>14|128:l>>>14&127;case 2:k[A+1]=b!==2?l>>>7|128:l>>>7&127;case 1:k[A]=b!==1?128|l:127&l}}const r$=async(o,s,l)=>{const p=function(A){const k=[];for(let j=0;j<A.length;j+=2)k.push(parseInt(A.slice(j,j+2),16));return Uint8Array.from(k)}(function(A){const k="0123456789abcdef";function j(n_){let DE,__="";for(DE=0;DE<=3;DE++)__+=k.charAt(n_>>8*DE+4&15)+k.charAt(n_>>8*DE&15);return __}function z(n_,DE){const __=(65535&n_)+(65535&DE);return(n_>>16)+(DE>>16)+(__>>16)<<16|65535&__}function H(n_,DE,__,d_,U_,_b){return z(function(k_,NT){return k_<<NT|k_>>>32-NT}(z(z(DE,n_),z(d_,_b)),U_),__)}function $(n_,DE,__,d_,U_,_b,k_){return H(DE&__|~DE&d_,n_,DE,U_,_b,k_)}function ue(n_,DE,__,d_,U_,_b,k_){return H(DE&d_|__&~d_,n_,DE,U_,_b,k_)}function Ei(n_,DE,__,d_,U_,_b,k_){return H(DE^__^d_,n_,DE,U_,_b,k_)}function Fi(n_,DE,__,d_,U_,_b,k_){return H(__^(DE|~d_),n_,DE,U_,_b,k_)}const Gi=function(n_){let DE;const __=1+(n_.length+8>>6),d_=new Array(16*__);for(DE=0;DE<16*__;DE++)d_[DE]=0;for(DE=0;DE<n_.length;DE++)d_[DE>>2]|=n_.charCodeAt(DE)<<DE%4*8;return d_[DE>>2]|=128<<DE%4*8,d_[16*__-2]=8*n_.length,d_}(A);let _o,_f,vf,uE,IE,lE=1732584193,hE=-271733879,sE=-1732584194,mE=271733878;for(_o=0;_o<Gi.length;_o+=16)_f=lE,vf=hE,uE=sE,IE=mE,lE=$(lE,hE,sE,mE,Gi[_o+0],7,-680876936),mE=$(mE,lE,hE,sE,Gi[_o+1],12,-389564586),sE=$(sE,mE,lE,hE,Gi[_o+2],17,606105819),hE=$(hE,sE,mE,lE,Gi[_o+3],22,-1044525330),lE=$(lE,hE,sE,mE,Gi[_o+4],7,-176418897),mE=$(mE,lE,hE,sE,Gi[_o+5],12,1200080426),sE=$(sE,mE,lE,hE,Gi[_o+6],17,-1473231341),hE=$(hE,sE,mE,lE,Gi[_o+7],22,-45705983),lE=$(lE,hE,sE,mE,Gi[_o+8],7,1770035416),mE=$(mE,lE,hE,sE,Gi[_o+9],12,-1958414417),sE=$(sE,mE,lE,hE,Gi[_o+10],17,-42063),hE=$(hE,sE,mE,lE,Gi[_o+11],22,-1990404162),lE=$(lE,hE,sE,mE,Gi[_o+12],7,1804603682),mE=$(mE,lE,hE,sE,Gi[_o+13],12,-40341101),sE=$(sE,mE,lE,hE,Gi[_o+14],17,-1502002290),hE=$(hE,sE,mE,lE,Gi[_o+15],22,1236535329),lE=ue(lE,hE,sE,mE,Gi[_o+1],5,-165796510),mE=ue(mE,lE,hE,sE,Gi[_o+6],9,-1069501632),sE=ue(sE,mE,lE,hE,Gi[_o+11],14,643717713),hE=ue(hE,sE,mE,lE,Gi[_o+0],20,-373897302),lE=ue(lE,hE,sE,mE,Gi[_o+5],5,-701558691),mE=ue(mE,lE,hE,sE,Gi[_o+10],9,38016083),sE=ue(sE,mE,lE,hE,Gi[_o+15],14,-660478335),hE=ue(hE,sE,mE,lE,Gi[_o+4],20,-405537848),lE=ue(lE,hE,sE,mE,Gi[_o+9],5,568446438),mE=ue(mE,lE,hE,sE,Gi[_o+14],9,-1019803690),sE=ue(sE,mE,lE,hE,Gi[_o+3],14,-187363961),hE=ue(hE,sE,mE,lE,Gi[_o+8],20,1163531501),lE=ue(lE,hE,sE,mE,Gi[_o+13],5,-1444681467),mE=ue(mE,lE,hE,sE,Gi[_o+2],9,-51403784),sE=ue(sE,mE,lE,hE,Gi[_o+7],14,1735328473),hE=ue(hE,sE,mE,lE,Gi[_o+12],20,-1926607734),lE=Ei(lE,hE,sE,mE,Gi[_o+5],4,-378558),mE=Ei(mE,lE,hE,sE,Gi[_o+8],11,-2022574463),sE=Ei(sE,mE,lE,hE,Gi[_o+11],16,1839030562),hE=Ei(hE,sE,mE,lE,Gi[_o+14],23,-35309556),lE=Ei(lE,hE,sE,mE,Gi[_o+1],4,-1530992060),mE=Ei(mE,lE,hE,sE,Gi[_o+4],11,1272893353),sE=Ei(sE,mE,lE,hE,Gi[_o+7],16,-155497632),hE=Ei(hE,sE,mE,lE,Gi[_o+10],23,-1094730640),lE=Ei(lE,hE,sE,mE,Gi[_o+13],4,681279174),mE=Ei(mE,lE,hE,sE,Gi[_o+0],11,-358537222),sE=Ei(sE,mE,lE,hE,Gi[_o+3],16,-722521979),hE=Ei(hE,sE,mE,lE,Gi[_o+6],23,76029189),lE=Ei(lE,hE,sE,mE,Gi[_o+9],4,-640364487),mE=Ei(mE,lE,hE,sE,Gi[_o+12],11,-421815835),sE=Ei(sE,mE,lE,hE,Gi[_o+15],16,530742520),hE=Ei(hE,sE,mE,lE,Gi[_o+2],23,-995338651),lE=Fi(lE,hE,sE,mE,Gi[_o+0],6,-198630844),mE=Fi(mE,lE,hE,sE,Gi[_o+7],10,1126891415),sE=Fi(sE,mE,lE,hE,Gi[_o+14],15,-1416354905),hE=Fi(hE,sE,mE,lE,Gi[_o+5],21,-57434055),lE=Fi(lE,hE,sE,mE,Gi[_o+12],6,1700485571),mE=Fi(mE,lE,hE,sE,Gi[_o+3],10,-1894986606),sE=Fi(sE,mE,lE,hE,Gi[_o+10],15,-1051523),hE=Fi(hE,sE,mE,lE,Gi[_o+1],21,-2054922799),lE=Fi(lE,hE,sE,mE,Gi[_o+8],6,1873313359),mE=Fi(mE,lE,hE,sE,Gi[_o+15],10,-30611744),sE=Fi(sE,mE,lE,hE,Gi[_o+6],15,-1560198380),hE=Fi(hE,sE,mE,lE,Gi[_o+13],21,1309151649),lE=Fi(lE,hE,sE,mE,Gi[_o+4],6,-145523070),mE=Fi(mE,lE,hE,sE,Gi[_o+11],10,-1120210379),sE=Fi(sE,mE,lE,hE,Gi[_o+2],15,718787259),hE=Fi(hE,sE,mE,lE,Gi[_o+9],21,-343485551),lE=z(lE,_f),hE=z(hE,vf),sE=z(sE,uE),mE=z(mE,IE);return j(lE)+j(hE)+j(sE)+j(mE)}(""+s+l)).slice(0,16),_=p.slice(0,12),b=await window.crypto.subtle.importKey("raw",p,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:_},b,o))},G4=async(o,s,l)=>await r$(o.buffer,s,l);function q4(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}const i$=new Map([["moderation",1],["supervise",2]]);class sN extends R_{get connectionState(){return this._connectionState}set connectionState(s){if(this._connectionState===s)return;const l=this._connectionState;this._connectionState=s,this.emit(z_.CONNECTION_STATE_CHANGE,l,s)}get inspectType(){return this._inspectType}set inspectType(s){var l;this._inspectMode=aR(l=s.map(p=>i$.get(p)||0)).call(l,(p,_)=>p+_),this._inspectType=s}get quality(){return this._quality}set quality(s){this._quality=s>1?1:s<.1?.1:s,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(s){super(),_t(this,"name","AgoraRTCVideoContentInspect"),_t(this,"_connectionState",GT.CONNECTING),_t(this,"_innerConnectionState",void 0),_t(this,"sequence",0),_t(this,"inspectStartTime",void 0),_t(this,"workerManagerConnection",void 0),_t(this,"workerConnection",void 0),_t(this,"workerMessageLengthLimit",void 0),_t(this,"inspectIntervalMinimum",void 0),_t(this,"qualityRatio",void 0),_t(this,"_connectInfo",void 0),_t(this,"_cancelTokenSource",VT.CancelToken.source()),_t(this,"_retryConfig",void 0),_t(this,"wmSequence",0),_t(this,"inspectInterval",void 0),_t(this,"inspectTimer",null),_t(this,"ossFilePrefix",void 0),_t(this,"extraInfo",void 0),_t(this,"_inspectType",void 0),_t(this,"_inspectMode",void 0),_t(this,"_quality",1),_t(this,"qualityTimer",null),_t(this,"_inspectId",void 0),_t(this,"_needWorkUrlOnly",!1),_t(this,"inspectImage",()=>{if(this.connectionState!==GT.CONNECTED)throw new ga(Di.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===GT.CONNECTED?this.requestToInspectImage():_n.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=y_(5,"inspect-"),this.workerMessageLengthLimit=_u("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=_u("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=_u("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=s.interval,this.ossFilePrefix=s.ossFilePrefix,this.extraInfo=s.extraInfo,this.inspectType=s.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new JR("worker-manager-"+this._inspectId,x_),this.on(z_.STATE_CHANGE,(l,p)=>{this._innerConnectionState=l,_n.debug("[".concat(this._inspectId,"] Inspect operation :").concat(qT[l]," ").concat(p||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new JR("worker-"+this._inspectId,x_),this.handleWorkerEvents()}async init(s,l){this.emit(z_.STATE_CHANGE,qT.CONNECT_AP),this._connectInfo=s;const p=this._cancelTokenSource.token;return this._retryConfig=l,new RE((_,b)=>{this.on(z_.CONNECTION_STATE_CHANGE,(A,k)=>{k===GT.CONNECTED&&_()}),this.requestAP(s,p,l).then(A=>{this.connectWorkerManager(A)}).catch(A=>{b(A)})})}async requestAP(s,l,p){const _=_u("WEBCS_DOMAIN").map(k=>"https://".concat(k,"/api/v1")),b=await function(k,j,z,H){let{appId:$,areaCode:ue,cname:Ei,sid:Fi,token:Gi,uid:_o}=j;LI++;const _f="image_moderation_api",vf={service_name:_f,json_body:JSON.stringify({appId:$,areaCode:ue,cname:Ei,command:"allocateEdge",requestId:LI,seq:LI,sid:Fi,token:Gi,ts:Date.now(),uid:_o+""})};let uE,IE,lE=k[0];return SS(async()=>{uE=Date.now();const hE=await hS(lE,{data:vf,cancelToken:z,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(IE=Date.now()-uE,hE.code!==0){const DE=new ga(Di.UNEXPECTED_RESPONSE,"image inspect ap error, code"+hE.code,{retry:!0,responseTime:IE});throw _n.error(DE.toString()),DE}const sE=JSON.parse(hE.json_body);if(sE.code!==200){const DE=new ga(Di.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(sE.code,", reason: ").concat(sE.reason),{code:sE.code,responseTime:IE});throw _n.error(DE.toString()),DE}if(!sE.servers||!Array.isArray(sE.servers)||sE.servers.length===0){const DE=new ga(Di.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:sE.code,responseTime:IE});throw _n.error(DE.toString()),DE}const mE=_u("VIDEO_INSPECT_WORKER_MANAGER_HOST"),n_=_u("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:sE.servers.map(DE=>{let{address:__,wss:d_}=DE;if(__&&d_)return"wss://".concat(__.replace(/\./g,"-"),".").concat(mE,":").concat(n_||d_)}).filter(DE=>!!DE),workerToken:sE.workerToken,vid:sE.vid,responseTime:IE}},(hE,sE)=>(wE.apworkerEvent(Fi,{success:!0,sc:200,serviceName:_f,responseDetail:JSON.stringify(hE.addressList),firstSuccess:sE===0,responseTime:IE,serverIp:k[sE%k.length]}),!1),(hE,sE)=>(wE.apworkerEvent(Fi,{success:!1,sc:hE.data&&hE.data.code||200,serviceName:_f,responseTime:IE,serverIp:k[sE%k.length]}),!!(hE.code!==Di.OPERATION_ABORTED&&hE.code!==Di.UNEXPECTED_RESPONSE||hE.data&&hE.data.retry)&&(lE=k[(sE+1)%k.length],!0)),H)}(_,s,l,p);this.emit(z_.STATE_CHANGE,qT.AP_CONNECTED);const{addressList:A}=b;return this.wmSequence++,A}async connectWorkerManager(s){let l=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=l,this.emit(z_.STATE_CHANGE,qT.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(s,1e4)}async connectWorker(s){await this.workerConnection.init([s])}handleWorkerManagerEvents(){this.workerManagerConnection.on(jE.CONNECTED,async()=>{this.emit(z_.STATE_CHANGE,qT.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.18.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(jE.CLOSED,()=>{this._innerConnectionState<qT.GET_WORKER_MANAGER_RESPONSE&&_n.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(jE.FAILED,()=>{this._innerConnectionState<qT.GET_WORKER_MANAGER_RESPONSE&&_n.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(jE.RECONNECTING,()=>{this._innerConnectionState<qT.GET_WORKER_MANAGER_RESPONSE&&_n.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(jE.ON_MESSAGE,async s=>{this.emit(z_.STATE_CHANGE,qT.GET_WORKER_MANAGER_RESPONSE);const l=this.workerManagerConnection.url;this.workerManagerConnection.close();const p=JSON.parse(s.data);if(p.code!==200)throw _n.error("[".concat(this._inspectId,"] Unexpected code ").concat(p.code," from worker manager")),new ga(Di.UNEXPECTED_RESPONSE,"response code of worker is unexpected",p);if(!(p.serverResponse&&p.serverResponse.portWss&&l))throw _n.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(p))),new ga(Di.UNEXPECTED_RESPONSE,"response content of worker is unexpected",p);{const _=_u("VIDEO_INSPECT_WORKER_PORT")||p.serverResponse.portWss,b=l.replace(/:\d+\/?$/,":".concat(_));this.emit(z_.STATE_CHANGE,qT.CONNECT_WORKER,b),this._needWorkUrlOnly?this.emit(z_.REQUEST_NEW_WORKER_URL,b):await this.connectWorker(b)}}),this.workerManagerConnection.on(jE.WILL_RECONNECT,(s,l)=>{l(s)}),this.workerManagerConnection.on(jE.REQUEST_NEW_URLS,(s,l)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(s).catch(l)})}handleWorkerEvents(){this.workerConnection.on(jE.CONNECTED,async()=>{this.emit(z_.STATE_CHANGE,qT.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=GT.CONNECTED}),this.workerConnection.on(jE.ON_MESSAGE,async s=>{if(s.data instanceof ArrayBuffer){const p=XQ(new Uint8Array(s.data));if(_u("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&_n.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(p)),p.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(z_.INSPECT_RESULT,void 0,void 0);if(p.data&&p.data.scorePorn&&p.data.scoreSexy&&p.data.scoreNeutral){var l;const _={porn:p.data.scorePorn,sexy:p.data.scoreSexy,neutral:p.data.scoreNeutral},b=aR(l=Object.keys(_)).call(l,(k,j)=>_[k]>_[j]?k:j,"porn"),A=Object.keys(_).find(k=>k===b);this.emit(z_.INSPECT_RESULT,A)}else this.emit(z_.INSPECT_RESULT,void 0,new ga(Di.UNEXPECTED_RESPONSE,p.code+"","There is an unexpected data on message"))}else this.emit(z_.INSPECT_RESULT,void 0,new ga(Di.UNEXPECTED_RESPONSE,p.code+"",p.msg))}else _n.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(z_.INSPECT_RESULT,void 0,new ga(Di.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(jE.CLOSED,()=>{this.connectionState=GT.CLOSED}),this.workerConnection.on(jE.FAILED,()=>{this.connectionState=GT.CLOSED}),this.workerConnection.on(jE.RECONNECTING,()=>{this.connectionState=this.connectionState===GT.CONNECTED?GT.RECONNECTING:GT.CONNECTING}),this.workerConnection.on(jE.WILL_RECONNECT,(s,l)=>{s==="recover"&&l(s),l("tryNext")}),this.workerConnection.on(jE.REQUEST_NEW_URLS,(s,l)=>{this.workerManagerConnection.close(),this.once(z_.REQUEST_NEW_WORKER_URL,p=>{s([p])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(p=>{this.connectWorkerManager(p,!0)}).catch(p=>{l(p)})})}static intToLong(s){return{low:s|=0,high:s>>31,unsigned:s>=0}}async requestToInspectImage(){this.sequence++;const s=fS(this,z_.CLIENT_LOCAL_VIDEO_TRACK),l={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(s){if(!s.isPlaying)return void this.emit(z_.INSPECT_RESULT,void 0,new ga(Di.INVALID_OPERATION,"Only the track being played can be inspected"));const p=await this.generateRequestData(s,l);this.workerConnection.sendMessage(p,!0,!0)}else this.emit(z_.INSPECT_RESULT,void 0,new ga(Di.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(s,l){let{appId:p,cname:_,cid:b,vid:A,sid:k,uid:j}=l;const z=Date.now(),H=await s.getCurrentFrameImage("image/jpeg",this.quality),$=await G4(H,p,_),ue=this.sequence+"-"+b+"-"+j+"-"+z+"-"+y_(12,""),Ei={appId:p,cid:b,cname:_,deviceId:"",elapse:sN.intToLong(Number(z-this.inspectStartTime)),fileSize:$.byteLength,jpgEncryption:2,height:H.height,width:H.width,jpg:$,networkType:6,osType:7,requestId:ue,sdkVersion:"4.18.2",sequence:this.sequence,sid:k,timestamp:sN.intToLong(z),uid:j,vid:A,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete Ei.callbackData,this.ossFilePrefix===void 0&&delete Ei.ossFilePrefix;const Fi=JQ(Ei);if(Fi.byteLength<this.workerMessageLengthLimit){if(_u("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const Gi=function(_o){for(var _f=1;_f<arguments.length;_f++){var vf=arguments[_f]!=null?arguments[_f]:{};_f%2?q4(Object(vf),!0).forEach(function(uE){_t(_o,uE,vf[uE])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_o,Object.getOwnPropertyDescriptors(vf)):q4(Object(vf)).forEach(function(uE){Object.defineProperty(_o,uE,Object.getOwnPropertyDescriptor(vf,uE))})}return _o}({},Ei);delete Gi.jpg,_n.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(Gi))}return Fi}{const Gi=this.quality*this.qualityRatio;return this.quality=Gi,await this.generateRequestData(s,{appId:p,cname:_,cid:b,vid:A,sid:k,uid:j})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=VT.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=GT.CLOSED,this.emit(z_.STATE_CHANGE,qT.CLOSED)}}function o$(o){let s=function(){const l=c$.pop();return l?(l.offset=l.limit=0,l):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(l,p){let _=l.appId;_!==void 0&&(M_(p,10),tI(p,_));let b=l.cid;b!==void 0&&(M_(p,16),M_(p,b));let A=l.cname;A!==void 0&&(M_(p,26),tI(p,A));let k=l.deviceId;k!==void 0&&(M_(p,34),tI(p,k));let j=l.elapse;j!==void 0&&(M_(p,40),IR(p,j));let z=l.fileSize;z!==void 0&&(M_(p,48),IR(p,GI(z)));let H=l.height;H!==void 0&&(M_(p,56),IR(p,GI(H)));let $=l.jpg;$!==void 0&&(M_(p,66),M_(p,$.length),K4(p,$));let ue=l.networkType;ue!==void 0&&(M_(p,72),IR(p,GI(ue)));let Ei=l.osType;Ei!==void 0&&(M_(p,80),IR(p,GI(Ei)));let Fi=l.requestId;Fi!==void 0&&(M_(p,90),tI(p,Fi));let Gi=l.sdkVersion;Gi!==void 0&&(M_(p,98),tI(p,Gi));let _o=l.sequence;_o!==void 0&&(M_(p,104),IR(p,GI(_o)));let _f=l.sid;_f!==void 0&&(M_(p,114),tI(p,_f));let vf=l.timestamp;vf!==void 0&&(M_(p,120),IR(p,vf));let uE=l.uid;uE!==void 0&&(M_(p,128),M_(p,uE));let IE=l.vid;IE!==void 0&&(M_(p,136),M_(p,IE));let lE=l.width;lE!==void 0&&(M_(p,144),IR(p,GI(lE)));let hE=l.service;hE!==void 0&&(M_(p,152),M_(p,hE));let sE=l.callbackData;sE!==void 0&&(M_(p,162),M_(p,sE.length),K4(p,sE));let mE=l.ticket;mE!==void 0&&(M_(p,170),tI(p,mE))}(o,s),function(l){let p=l.bytes,_=l.limit;return p.length===_?p:p.subarray(0,_)}(s)}function s$(o){return function(l){let p={};t:for(;!u$(l);){let _=O0(l);switch(_>>>3){case 0:break t;case 1:p.code=O0(l);break;case 2:p.msg=H4(l,O0(l));break;case 3:p.requestId=H4(l,O0(l));break;case 4:p.timestamp=d$(l,!1);break;default:a$(l,7&_)}}return p}({bytes:s=o,offset:0,limit:s.length});var s}function a$(o,s){switch(s){case 0:for(;128&gS(o););break;case 2:XL(o,O0(o));break;case 5:XL(o,4);break;case 1:XL(o,8);break;default:throw new Error("Unimplemented type: "+s)}}function GI(o){return{low:o|=0,high:o>>31,unsigned:o>=0}}let c$=[];function XL(o,s){if(o.offset+s>o.limit)throw new Error("Skip past limit");o.offset+=s}function u$(o){return o.offset>=o.limit}function aN(o,s){let l=o.bytes,p=o.offset,_=o.limit,b=p+s;if(b>l.length){let A=new Uint8Array(2*b);A.set(l),o.bytes=A}return o.offset=b,b>_&&(o.limit=b),p}function W4(o,s){let l=o.offset;if(l+s>o.limit)throw new Error("Read past limit");return o.offset+=s,l}function K4(o,s){let l=aN(o,s.length);o.bytes.set(s,l)}function H4(o,s){let l=W4(o,s),p=String.fromCharCode,_=o.bytes,b="ï¿½",A="";for(let k=0;k<s;k++){let j,z,H,$,ue=_[k+l];128&ue?(224&ue)==192?k+1>=s?A+=b:(j=_[k+l+1],(192&j)!=128?A+=b:($=(31&ue)<<6|63&j,$<128?A+=b:(A+=p($),k++))):(240&ue)==224?k+2>=s?A+=b:(j=_[k+l+1],z=_[k+l+2],(49344&(j|z<<8))!=32896?A+=b:($=(15&ue)<<12|(63&j)<<6|63&z,$<2048||$>=55296&&$<=57343?A+=b:(A+=p($),k+=2))):(248&ue)==240?k+3>=s?A+=b:(j=_[k+l+1],z=_[k+l+2],H=_[k+l+3],(12632256&(j|z<<8|H<<16))!=8421504?A+=b:($=(7&ue)<<18|(63&j)<<12|(63&z)<<6|63&H,$<65536||$>1114111?A+=b:($-=65536,A+=p(55296+($>>10),56320+(1023&$)),k+=3))):A+=b:A+=p(ue)}return A}function tI(o,s){let l=s.length,p=0;for(let A=0;A<l;A++){let k=s.charCodeAt(A);k>=55296&&k<=56319&&A+1<l&&(k=(k<<10)+s.charCodeAt(++A)-56613888),p+=k<128?1:k<2048?2:k<65536?3:4}M_(o,p);let _=aN(o,p),b=o.bytes;for(let A=0;A<l;A++){let k=s.charCodeAt(A);k>=55296&&k<=56319&&A+1<l&&(k=(k<<10)+s.charCodeAt(++A)-56613888),k<128?b[_++]=k:(k<2048?b[_++]=k>>6&31|192:(k<65536?b[_++]=k>>12&15|224:(b[_++]=k>>18&7|240,b[_++]=k>>12&63|128),b[_++]=k>>6&63|128),b[_++]=63&k|128)}}function gS(o){return o.bytes[W4(o,1)]}function Y4(o,s){let l=aN(o,1);o.bytes[l]=s}function O0(o){let s,l=0,p=0;do s=gS(o),l<32&&(p|=(127&s)<<l),l+=7;while(128&s);return p}function M_(o,s){for(s>>>=0;s>=128;)Y4(o,127&s|128),s>>>=7;Y4(o,s)}function d$(o,s){let l,p=0,_=0,b=0;return l=gS(o),p=127&l,128&l&&(l=gS(o),p|=(127&l)<<7,128&l&&(l=gS(o),p|=(127&l)<<14,128&l&&(l=gS(o),p|=(127&l)<<21,128&l&&(l=gS(o),_=127&l,128&l&&(l=gS(o),_|=(127&l)<<7,128&l&&(l=gS(o),_|=(127&l)<<14,128&l&&(l=gS(o),_|=(127&l)<<21,128&l&&(l=gS(o),b=127&l,128&l&&(l=gS(o),b|=(127&l)<<7))))))))),{low:p|_<<28,high:_>>>4|b<<24,unsigned:s}}function IR(o,s){let l=s.low>>>0,p=(s.low>>>28|s.high<<4)>>>0,_=s.high>>>24,b=_===0?p===0?l<16384?l<128?1:2:l<1<<21?3:4:p<16384?p<128?5:6:p<1<<21?7:8:_<128?9:10,A=aN(o,b),k=o.bytes;switch(b){case 10:k[A+9]=_>>>7&1;case 9:k[A+8]=b!==9?128|_:127&_;case 8:k[A+7]=b!==8?p>>>21|128:p>>>21&127;case 7:k[A+6]=b!==7?p>>>14|128:p>>>14&127;case 6:k[A+5]=b!==6?p>>>7|128:p>>>7&127;case 5:k[A+4]=b!==5?128|p:127&p;case 4:k[A+3]=b!==4?l>>>21|128:l>>>21&127;case 3:k[A+2]=b!==3?l>>>14|128:l>>>14&127;case 2:k[A+1]=b!==2?l>>>7|128:l>>>7&127;case 1:k[A]=b!==1?128|l:127&l}}const z4={},J4={},X4=4294967296,Q4=18446744073709552e3,$4=Q4/2,QL=_q(0,!0),Z4=_q(0),l$=qI(0,-2147483648,!1),h$=qI(-1,2147483647,!1),p$=qI(-1,-1,!0);function _q(o,s){let l,p,_;return s?(_=0<=(o>>>=0)&&o<256)&&(p=J4[o],p)?p:(l=qI(o,0,!0),_&&(J4[o]=l),l):(_=-128<=(o|=0)&&o<128)&&(p=z4[o],p)?p:(l=qI(o,o<0?-1:0,!1),_&&(z4[o]=l),l)}function qI(o,s,l){return{low:0|o,high:0|s,unsigned:!!l}}function f$(o,s){if(isNaN(o))return s?QL:Z4;if(s){if(o<0)return QL;if(o>=Q4)return p$}else{if(o<=-$4)return l$;if(o+1>=$4)return h$}return o<0?s?QL:Z4:qI(o%X4|0,o/X4|0,s)}function t6(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}class $L extends R_{get connectionState(){return this._connectionState}set connectionState(s){if(this._connectionState===s)return;const l=this._connectionState;this._connectionState=s,this.emit(tS.CONNECTION_STATE_CHANGE,s,l)}get quality(){return this._quality}set quality(s){this._quality=s>1?1:s<.1?.1:s,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(s){var l;super(),_t(this,"name","AgoraRTCImageModeration"),_t(this,"_connectionState",LT.CONNECTING),_t(this,"_sequence",0),_t(this,"_moderationStartTime",void 0),_t(this,"_workerConnection",void 0),_t(this,"_workerMessageLengthLimit",void 0),_t(this,"_qualityRatio",void 0),_t(this,"_connectInfo",void 0),_t(this,"_cancelTokenSource",VT.CancelToken.source()),_t(this,"_retryConfig",void 0),_t(this,"_moderationInterval",void 0),_t(this,"_moderationTimer",null),_t(this,"_moderationMode",1),_t(this,"_quality",1),_t(this,"_qualityTimer",null),_t(this,"_ticket",void 0),_t(this,"_moderationIntervalMinimum",void 0),_t(this,"_uploadFailedNum",0),_t(this,"_uploadNum",0),_t(this,"_uploadTimer",null),_t(this,"_moderationId",void 0),_t(this,"inspectImage",()=>{if(this.connectionState!==LT.CONNECTED)throw new ga(Di.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===LT.CONNECTED?this.requestToInspectImage():_n.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=y_(5,"image-moderation-"),this._workerMessageLengthLimit=_u("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=_u("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(l=s.interval)!==null&&l!==void 0?l:1e3,this._qualityRatio=_u("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new JR("worker-"+this._moderationId,x_),this.on(tS.STATE_CHANGE,(p,_)=>{_n.debug("[".concat(this._moderationId,"] Moderation operation :").concat(mR[p]," ").concat(_||""))}),this.handleWorkerEvents()}async init(s,l){this.emit(tS.STATE_CHANGE,mR.CONNECT_AP),this._connectInfo=s;const p=this._cancelTokenSource.token;return this._retryConfig=l,new RE((_,b)=>{this.on(tS.CONNECTION_STATE_CHANGE,(A,k)=>{A===LT.CONNECTED&&_()}),this.requestAP(s,p,l).then(A=>{this.connectWorker(A)}).catch(A=>{b(A)})})}updateConfig(s){var l;this._moderationInterval=(l=s.interval)!==null&&l!==void 0?l:1e3,_n.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(s))),this.connectionState===LT.CONNECTED&&this.inspectImage()}async requestAP(s,l,p){const _=_u("WEBCS_DOMAIN").map(j=>"https://".concat(j,"/api/v1")),b=await function(j,z,H,$){let{appId:ue,areaCode:Ei,cname:Fi,sid:Gi,token:_o,uid:_f}=z;LI++;const vf="moderation_plugin",uE={service_name:vf,json_body:JSON.stringify({appId:ue,areaCode:Ei,cname:Fi,command:"allocateEdge",requestId:LI,seq:LI,sid:Gi,appToken:_o,ts:Date.now(),uid:_f+""})};let IE,lE,hE=j[0];return SS(async()=>{IE=Date.now();const sE=await hS(hE,{data:uE,cancelToken:H,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(lE=Date.now()-IE,sE.code!==0){const DE=new ga(Di.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+sE.code,{retry:!0,responseTime:lE});throw _n.error(DE.toString()),DE}const mE=JSON.parse(sE.json_body);if(mE.code!==200){const DE=new ga(Di.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(mE.code,", reason: ").concat(mE.reason),{code:mE.code,responseTime:lE});throw _n.error(DE.toString()),DE}if(!mE.servers||!Array.isArray(mE.servers)||mE.servers.length===0){const DE=new ga(Di.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:mE.code,responseTime:lE});throw _n.error(DE.toString()),DE}if(!mE.servers.some(DE=>!!DE.wss)){const DE=new ga(Di.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:mE.code,responseTime:lE});throw _n.error(DE.toString()),DE}const n_=_u("IMAGE_MODERATION_WORKER_HOST");return{addressList:mE.servers.map(DE=>{let{address:__,wss:d_}=DE;if(__&&d_)return"wss://".concat(__.replace(/\./g,"-"),".").concat(n_,":").concat(d_,"/moderation")}).filter(DE=>!!DE),workerToken:mE.workerToken,vid:mE.vid,ticket:mE.appTicket,responseTime:lE}},(sE,mE)=>(wE.apworkerEvent(Gi,{success:!0,sc:200,serviceName:vf,responseDetail:JSON.stringify(sE.addressList),firstSuccess:mE===0,responseTime:lE,serverIp:j[mE%j.length]}),!1),(sE,mE)=>(wE.apworkerEvent(Gi,{success:!1,sc:sE.data&&sE.data.code||200,serviceName:vf,responseTime:lE,serverIp:j[mE%j.length]}),!!(sE.code!==Di.OPERATION_ABORTED&&sE.code!==Di.UNEXPECTED_RESPONSE||sE.data&&sE.data.retry)&&(hE=j[(mE+1)%j.length],!0)),$)}(_,s,l,p);this.emit(tS.STATE_CHANGE,mR.AP_CONNECTED);const{addressList:A,ticket:k}=b;return this._ticket=k,A}async connectWorker(s){this.emit(tS.STATE_CHANGE,mR.CONNECT_WORKER),await this._workerConnection.init(s,1e4)}handleWorkerEvents(){this._workerConnection.on(jE.CONNECTED,async()=>{this.emit(tS.STATE_CHANGE,mR.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=LT.CONNECTED}),this._workerConnection.on(jE.CLOSED,()=>{this.connectionState=LT.CLOSED}),this._workerConnection.on(jE.FAILED,()=>{this.connectionState=LT.CLOSED}),this._workerConnection.on(jE.RECONNECTING,()=>{this.connectionState=this.connectionState===LT.CONNECTED?LT.RECONNECTING:LT.CONNECTING}),this._workerConnection.on(jE.ON_MESSAGE,async s=>{if(s.data instanceof ArrayBuffer){const l=s$(new Uint8Array(s.data));_u("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&_n.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(l)),this._uploadNum++,l.code===void 0||l.code===0||(this._uploadFailedNum++,_n.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(l.code,", msg is ").concat(l.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{wE.reportApiInvoke(this._connectInfo.sid||null,{name:j_.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,l.code],tag:T_.TRACER}).onError(new ga(Di.IMAGE_MODERATION_UPLOAD_FAILED,l.msg)),this._uploadTimer=null},_u("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else _n.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(jE.WILL_RECONNECT,(s,l)=>{s==="recover"&&l(s),l("tryNext")}),this._workerConnection.on(jE.REQUEST_NEW_URLS,(s,l)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(s).catch(l)})}static intToLong(s){return{low:s|=0,high:s>>31,unsigned:s>=0}}async requestToInspectImage(){const s=fS(this,tS.CLIENT_LOCAL_VIDEO_TRACK),l={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(s){if(!s.isPlaying)return void(_u("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&_n.debug("Only the track being played can be inspected"));this._sequence++;const p=await this.generateRequestData(s,l);this._workerConnection.sendMessage(p,!0,!0)}else _u("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&_n.debug("Only the track being published can be inspected")}async generateRequestData(s,l){let{appId:p,cname:_,cid:b,vid:A,sid:k,uid:j}=l;const z=Date.now(),H=await s.getCurrentFrameImage("image/jpeg",this.quality),$=await G4(H,p,_),ue=this._sequence+"-"+b+"-"+j+"-"+z+"-"+y_(12,""),Ei={appId:p,cid:b,cname:_,deviceId:"",elapse:$L.intToLong(Number(z-this._moderationStartTime)),fileSize:H.buffer.byteLength,height:H.height,width:H.width,jpg:$,networkType:6,osType:7,requestId:ue,sdkVersion:"4.18.2",sequence:this._sequence,sid:k,timestamp:f$(z),uid:j,vid:A,service:this._moderationMode,ticket:this._ticket},Fi=o$(Ei);if(Fi.byteLength<this._workerMessageLengthLimit){if(_u("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const Gi=function(_o){for(var _f=1;_f<arguments.length;_f++){var vf=arguments[_f]!=null?arguments[_f]:{};_f%2?t6(Object(vf),!0).forEach(function(uE){_t(_o,uE,vf[uE])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_o,Object.getOwnPropertyDescriptors(vf)):t6(Object(vf)).forEach(function(uE){Object.defineProperty(_o,uE,Object.getOwnPropertyDescriptor(vf,uE))})}return _o}({},Ei);delete Gi.jpg,_n.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(Gi))}return Fi}{const Gi=this.quality*this._qualityRatio;return this.quality=Gi,await this.generateRequestData(s,{appId:p,cname:_,cid:b,vid:A,sid:k,uid:j})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=VT.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=LT.CLOSED,this.emit(tS.STATE_CHANGE,mR.CLOSED)}}var e6,n6,r6,i6,o6,s6,a6,c6,u6,d6,l6,h6,p6,f6,E6,m6,_6,g6,v6,y6,b6,T6,S6,R6,I6,O6,A6,w6,C6,N6,P6,D6,k6,L6,M6,U6,x6,j6,V6,_E;function F6(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function A0(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?F6(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):F6(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}let E$=(e6=kE(),n6=kE({argsMap:(o,s)=>(Array.isArray(s)||(s=[s]),s.map(l=>l?Object(l).toString():"null"))}),r6=kE({argsMap:(o,s)=>(s||(s=[]),Array.isArray(s)||(s=[s]),s.map(l=>l.getTrackId()))}),i6=kE({argsMap:(o,s,l)=>[s.uid,l]}),o6=kE({argsMap:(o,s)=>s.map(l=>{let{user:p,mediaType:_}=l;return[p==null?void 0:p.uid,_]})}),s6=kE({argsMap:(o,s,l)=>[s.uid,l]}),a6=kE({argsMap:(o,s)=>s.map(l=>{let{user:p,mediaType:_}=l;return{uid:p==null?void 0:p.uid,mediaType:_}})}),c6=kE(),u6=kE(),d6=kE(),l6=kE(),h6=kE(),p6=kE(),f6=kE(),E6=kE(),m6=kE(),_6=kE(),g6=kE(),v6=kE(),y6=kE(),b6=kE(),T6=kE({argsMap:(o,s)=>[s]}),S6=kE(),R6=kE(),I6=kE(),O6=kE(),A6=kE(),w6=kE(),C6=kE(),N6=kE(),P6=kE(),D6=kE(),k6=kE({argsMap:(o,s)=>(Array.isArray(s)||(s=[s]),[JSON.stringify(s)])}),L6=kE(),M6=kE(),U6=kE(),x6=kE(),j6=kE({reportResult:!0}),V6=kE(),oE((_E=class extends R_{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get mode(){return this._config.mode}get role(){var o;return((o=this._config)===null||o===void 0?void 0:o.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(o){let s;if(super(),_t(this,"store",void 0),_t(this,"_uid",void 0),_t(this,"_channelName",void 0),_t(this,"_uintUid",void 0),_t(this,"_users",[]),_t(this,"_config",void 0),_t(this,"_clientId",void 0),_t(this,"_appId",void 0),_t(this,"_sessionId",null),_t(this,"_key",void 0),_t(this,"_joinInfo",void 0),_t(this,"_gateway",void 0),_t(this,"_statsCollector",void 0),_t(this,"_configDistribute",void 0),_t(this,"_leaveMutex",new gT("client-leave")),_t(this,"_publishMutex",new gT("client-publish")),_t(this,"_renewTokenMutex",new gT("client-renewtoken")),_t(this,"_subscribeMutex",new gT("client-subscribe")),_t(this,"_encryptionMode","none"),_t(this,"_encryptionSecret",null),_t(this,"_encryptionSalt",null),_t(this,"_proxyServer",void 0),_t(this,"_turnServer",{servers:[],mode:"auto"}),_t(this,"_cloudProxyServerMode","disabled"),_t(this,"_isDualStreamEnabled",!1),_t(this,"_defaultStreamFallbackType",void 0),_t(this,"_lowStreamParameter",void 0),_t(this,"_streamFallbackTypeCacheMap",new Map),_t(this,"_remoteStreamTypeCacheMap",new Map),_t(this,"_axiosCancelSource",VT.CancelToken.source()),_t(this,"_audioVolumeIndicationInterval",void 0),_t(this,"_networkQualityInterval",void 0),_t(this,"_userOfflineTimeout",void 0),_t(this,"_streamRemovedTimeout",void 0),_t(this,"_injectStreamingClient",void 0),_t(this,"_liveTranscodeStreamingClient",void 0),_t(this,"_liveRawStreamingClient",void 0),_t(this,"_channelMediaRelayClient",void 0),_t(this,"_networkQualitySensitivity","normal"),_t(this,"_p2pChannel",void 0),_t(this,"_useLocalAccessPoint",!1),_t(this,"_setLocalAPVersion",void 0),_t(this,"_joinAndNotLeaveYet",!1),_t(this,"_numberOfJoinCount",0),_t(this,"_remoteDefaultVideoStreamType",void 0),_t(this,"_inspect",void 0),_t(this,"_moderation",void 0),_t(this,"_license",void 0),_t(this,"_handleLocalTrackEnable",(l,p,_)=>{this.publish(l,!1).then(p).catch(_)}),_t(this,"_handleLocalTrackDisable",(l,p,_)=>{this.unpublish(l).then(p).catch(_)}),_t(this,"_handleUserOnline",l=>{if(_u("BLOCK_LOCAL_CLIENT")&&GR(l.uid,this.channelName))return void _n.debug("[".concat(l.uid,"] will be ignored in local"));this.isStringUID&&typeof l.uid!="string"&&_n.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const p=this._users.find(_=>_.uid===l.uid);if(p)p._trust_in_room_=!0;else{const _=new mL(l.uid,l.uint_id||l.uid);this._users.push(_),_n.debug("[".concat(this._clientId,"] user online"),l.uid),this.safeEmit(KE.USER_JOINED,_)}}),_t(this,"_handleUserOffline",l=>{if(_u("BLOCK_LOCAL_CLIENT")&&GR(l.uid,this.channelName))return;const p=this._users.find(_=>_.uid===l.uid);p&&(this._handleRemoveStream(l),sL(this._users,p),this._remoteStreamTypeCacheMap.delete(p.uid),this._streamFallbackTypeCacheMap.delete(p.uid),_n.debug("[".concat(this._clientId,"] user offline"),l.uid,"reason:",l.reason),this.safeEmit(KE.USER_LEAVED,p,l.reason))}),_t(this,"_handleAddAudioOrVideoStream",(l,p,_,b,A,k,j)=>{if(_u("BLOCK_LOCAL_CLIENT")&&GR(p,this.channelName))return;const z=this._users.find($=>$.uid===p);if(!z)return void _n.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));_n.debug("[".concat(this._clientId,"] stream added with uid ").concat(p,", type ").concat(l)),this.store.subscribe(z.uid,l,void 0,void 0,void 0,Date.now());const H=l==="audio"?z.hasAudio:z.hasVideo;z._uintid||(z._uintid=A||p),l==="audio"?z._trust_audio_stream_added_state_=!0:z._trust_video_stream_added_state_=!0,l==="audio"?(z._audio_added_=!0,_!==void 0&&(z._audioSSRC=_),b!==void 0&&(z._cname=b),k&&(z._audioOrtc=k)):(z._video_added_=!0,_!==void 0&&(z._videoSSRC=_),b!==void 0&&(z._cname=b),j!==void 0&&(z._rtxSsrcId=j),k&&(z._videoOrtc=k)),(l==="audio"?z.hasAudio:z.hasVideo)&&!H&&(_n.info("[".concat(this._clientId,"] remote user ").concat(z.uid," published ").concat(l)),this.safeEmit(KE.USER_PUBLISHED,z,l)),l==="video"?wE.onGatewayStream(this._sessionId,Fg.ON_ADD_VIDEO_STREAM,I_.ON_ADD_VIDEO_STREAM,{peer:A||p}):wE.onGatewayStream(this._sessionId,Fg.ON_ADD_AUDIO_STREAM,I_.ON_ADD_AUDIO_STREAM,{peer:A||p}),this._p2pChannel.remoteMediaSsrcChanged(z,l,_).then($=>{if($)return _n.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(z.uid," after rejoin because SSRC id changed.")),this._p2pChannel.unsubscribe(z,l,!0).then(()=>this._subscribe(z,l,!0).catch(ue=>{_n.error("[".concat(this._clientId,"] resubscribe error"),ue.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(z,l)&&(_n.debug("[".concat(this._clientId,"] resubscribe ").concat(l," for user ").concat(z.uid," after reconnect.")),this._subscribe(z,l,!0).catch($=>{_n.error("[".concat(this._clientId,"] resubscribe error"),$.toString())}))}),_t(this,"_handleRemoveStream",l=>{if(_u("BLOCK_LOCAL_CLIENT")&&GR(l.uid,this.channelName))return;const p=this._users.find(b=>b.uid===l.uid);if(!p)return void _n.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));_n.debug("[".concat(this._clientId,"] stream removed with uid ").concat(l.uid));let _=()=>{};p.hasAudio&&p.hasVideo?_=()=>{_n.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished audio track")),this.safeEmit(KE.USER_UNPUBLISHED,p,"audio"),_n.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished video track")),this.safeEmit(KE.USER_UNPUBLISHED,p,"video")}:p.hasVideo?_=()=>{_n.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished video track")),this.safeEmit(KE.USER_UNPUBLISHED,p,"video")}:p.hasAudio&&(_=()=>{_n.info("[".concat(this._clientId,"] remote user ").concat(p.uid," unpublished audio track")),this.safeEmit(KE.USER_UNPUBLISHED,p,"audio")}),p._trust_audio_stream_added_state_=!0,p._trust_video_stream_added_state_=!0,p._audio_added_=!1,p._video_added_=!1,this._p2pChannel.unsubscribe(p).then(b=>{if(b)return this._gateway.unsubscribe(b,p.uid)}),p._audioSSRC=void 0,p._videoSSRC=void 0,p._audioOrtc=void 0,p._videoOrtc=void 0,p._rtxSsrcId=void 0,wE.onGatewayStream(this._sessionId,Fg.ON_REMOVE_STREAM,I_.ON_REMOVE_STREAM,{peer:l.uint_id||l.uid}),_()}),_t(this,"_handleSetStreamLocalEnable",(l,p,_)=>{if(_u("BLOCK_LOCAL_CLIENT")&&GR(p,this.channelName))return;const b=this._users.find(j=>j.uid===p);if(!b)return void _n.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));_n.debug("[".concat(this._clientId,"] local ").concat(l," ").concat(_?"enabled":"disabled"," with uid ").concat(p));const A=l==="audio"?b.hasAudio:b.hasVideo;if(l==="audio"){b._trust_audio_enabled_state_=!0;const j=b._audio_enabled_;if(b._audio_enabled_=_,b._audio_enabled_===j)return;{const z=b._audio_enabled_?"enable-local-audio":"disable-local-audio";_n.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(p,", msg: ").concat(z)),this.safeEmit(KE.USER_INFO_UPDATED,p,z)}}else{b._trust_video_enabled_state_=!0;const j=b._video_enabled_;if(b._video_enabled_=_,b._video_enabled_===j)return;{const z=b._video_enabled_?"enable-local-video":"disable-local-video";_n.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(p,", msg: ").concat(z)),this.safeEmit(KE.USER_INFO_UPDATED,p,z)}}const k=l==="audio"?b.hasAudio:b.hasVideo;return A!==k?!A&&k?(_n.info("[".concat(this._clientId,"] remote user ").concat(p," published ").concat(l)),void this.safeEmit(KE.USER_PUBLISHED,b,l)):(l==="video"&&b._videoTrack&&b._videoTrack._destroy(),l==="audio"&&b._audioTrack,this._p2pChannel.muteRemote(b,l),_n.info("[".concat(this._clientId,"] remote user ").concat(p," unpublished ").concat(l)),void this.safeEmit(KE.USER_UNPUBLISHED,b,l)):void 0}),_t(this,"_handleMuteStream",(l,p,_)=>{if(_u("BLOCK_LOCAL_CLIENT")&&GR(l,this.channelName))return;_n.debug("[".concat(this._clientId,"] receive mute message"),l,p,_);const b=this._users.find(j=>j.uid===l);if(!b)return void _n.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(l));const A=p==="audio"?b.hasAudio:b.hasVideo;if(p==="audio"){b._trust_audio_mute_state_=!0;const j=b._audio_muted_;if(b._audio_muted_=_,b._audio_muted_===j)return;{const z=b._audio_muted_?"mute-audio":"unmute-audio";_n.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(z)),this.safeEmit(KE.USER_INFO_UPDATED,l,z)}}else{b._trust_video_mute_state_=!0;const j=b._video_muted_;if(b._video_muted_=_,b._video_muted_===j)return;{const z=b._video_muted_?"mute-video":"unmute-video";_n.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(l,", msg: ").concat(z)),this.safeEmit(KE.USER_INFO_UPDATED,l,z)}}const k=p==="audio"?b.hasAudio:b.hasVideo;if(A!==k){if(!A&&k)return(p==="audio"?b._audioSSRC:b._videoSSRC)?(_n.info("[".concat(this._clientId,"] remote user ").concat(l," published ").concat(p)),void this.safeEmit(KE.USER_PUBLISHED,b,p)):void _n.warning("[".concat(this._clientId,"] remote user ").concat(l," receive ").concat(p," unmute message  before add stream message, ").concat(p," SSRC doesn't exist yet."));p==="video"&&b._videoTrack&&b._videoTrack._destroy(),p==="audio"&&b._audioTrack,this._p2pChannel.muteRemote(b,p),_n.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished ").concat(p)),this.safeEmit(KE.USER_UNPUBLISHED,b,p)}}),_t(this,"_handleP2PLost",async l=>{_n.debug("[".concat(this._clientId,"] receive p2p lost"),l),parseInt(l.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():_n.warning("[".concat(this._clientId,"] P2PLost stream not found"),l)}),_t(this,"_handleTokenWillExpire",()=>{_n.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(KE.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),_t(this,"_handleBeforeUnload",l=>{l.type==="beforeunload"&&l.returnValue!==void 0&&l.returnValue!==""||(this.leave(),_n.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),_t(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(KE.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const l={downlinkNetworkQuality:0,uplinkNetworkQuality:0};l.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),l.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(KE.NETWORK_QUALITY,l)}),this._config=o,this._clientId=y_(5,"client-"),this.store=new YQ(o.codec,o.audioCodec,o.mode,this._clientId),this.store.clientCreated(),o.proxyServer&&this.setProxyServer(o.proxyServer,!0),o.turnServer&&this.setTurnServer(o.turnServer,!0),_n.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(ZT," build: ").concat(_D,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),o.clientRoleOptions)try{aV(o.clientRoleOptions),s=Object.assign({},o.clientRoleOptions)}catch(l){_n.warning("[".concat(this._clientId,"] ").concat(l.toString()))}this._statsCollector=new PI(this.store),this._statsCollector.onStatsException=(l,p,_)=>{_n.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(l,", msg: ").concat(p,", uid: ").concat(_)),this.safeEmit(KE.EXCEPTION,{code:l,msg:p,uid:_})},this._statsCollector.onUploadPublishDuration=(l,p,_,b)=>{const A=this._users.find(k=>k.uid===l);A&&wE.peerPublishStatus(this._sessionId,{subscribeElapse:b,audioPublishDuration:p,videoPublishDuration:_,peer:A._uintid})},this.store.useDataChannel=L_().supportDataChannel&&_u("SIGNAL_CHANNEL"),this._gateway=new PX(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:o.websocketRetryConfig||x_,httpRetryConfig:o.httpRetryConfig||x_,forceWaitGatewayResponse:o.forceWaitGatewayResponse===void 0||o.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:o.role,clientRoleOptions:s}),this._configDistribute=new FX,this._p2pChannel=new HQ(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async join(o,s,l,p,_){const b=++this._numberOfJoinCount;this.store.joinStart(),p&&(this.store.uid=p);const A=zQ(),k=L4()?window.isSecureContext:"Browser Not Support";if(!L4()&&!A||!window.isSecureContext){const Ei="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";_n.warning(Ei)}const j=oL();this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),_n.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const z=wE.reportApiInvoke(j,{name:j_.JOIN,options:[o,s,l,p],states:{isHttps:A,isSecureContext:k},tag:T_.TRACER});wE.setAppId(o);try{if(!l&&l!==null)throw new ga(Di.INVALID_PARAMS,"Invalid token: ".concat(l,". If you don not use token, set it to null"));l&&eT(l,"token",1,2047),eT(o,"appid",1,2047),CD(s),p&&ND(p),_&&eT(_,"optionalInfo",1,2047)}catch(Ei){throw z.onError(Ei),Ei}if(_n.info("[".concat(this._clientId,"] start join channel ").concat(s,", join number: ").concat(b)),this._leaveMutex.isLocked&&(_n.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),_n.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const Ei=new ga(Di.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw z.onError(Ei),Ei}this._sessionId||(this._sessionId=j,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const H=A0({clientId:this._clientId,appId:o,sid:this._sessionId,cname:s,uid:typeof p!="string"?p:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:l||o,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:_,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(H.setLocalAPVersion=this._setLocalAPVersion),typeof p=="string"&&(H.stringUid=p,this._uintUid?(H.uid=this._uintUid,this._uintUid=void 0):H.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(H.aesmode=this._encryptionMode,H.aespassword=await(async Ei=>{const Fi=aL(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),Gi=await window.crypto.subtle.importKey("spki",Fi,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),_o=XD(Ei),_f=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Gi,_o);return qO(new Uint8Array(_f))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new ga(Di.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(H.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:s,appId:o});const $=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&$===this._sessionId&&wE.joinChannelTimeout(this._sessionId,5)},5e3);try{let Ei;const Fi=H.cloudProxyServer;if(["proxy3","proxy4","proxy5"].includes(Fi)){const vf=_u("PROXY_SERVER_TYPE3");Array.isArray(vf)?H.proxyServer=vf[0]:H.proxyServer=vf}if(wE.setProxyServer(H.proxyServer),_n.setProxyServer(H.proxyServer),this.store.requestAPStart(),H.stringUid&&!H.uid){const vf=await p3(H.stringUid,H,this._axiosCancelSource.token,this._config.httpRetryConfig||x_,this.store);_n.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(H.stringUid," => ").concat(vf)),H.uid=vf,Ei=await h3(H,this._axiosCancelSource.token,this._config.httpRetryConfig||x_,!0,this.store)}else Ei=await h3(H,this._axiosCancelSource.token,this._config.httpRetryConfig||x_,!0,this.store);if(!this._joinAndNotLeaveYet)throw new ga(Di.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(H,this._axiosCancelSource.token),this._configDistribute.on(d0.UPDATE_BITRATE_LIMIT,vf=>{this._p2pChannel.updateBitrateLimit(vf)})},0),this._key=l||o;const Gi=Ei.gatewayInfo;this._joinInfo=A0(A0({},H),{},{cid:Gi.cid,uid:H.uid?H.uid:Gi.uid,vid:Gi.vid,apResponse:Gi.res,uni_lbs_ip:Gi.uni_lbs_ip,gatewayAddrs:Gi.gatewayAddrs});const _o=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new ga(Di.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));z.onSuccess(_o),this._appId=o,this._channelName=H.cname,this._uid=_o,this.store.uid=_o,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(fT()?"beforeunload":"pagehide",this._handleBeforeUnload)},0);const _f=H.stringUid?"string uid: ".concat(H.stringUid,",uid: ").concat(H.uid):"uid: ".concat(this._uid);return _n.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(s,",").concat(_f)),setTimeout(()=>{_n.startUpload()},5e3),this.store.joinEnd(),ue=this,BR.includes(ue)||BR.push(ue),_o}catch(Ei){const Fi=Array.isArray(Ei)?Ei[0]:Ei;throw Fi&&Fi.code===Di.OPERATION_ABORTED?_n.warning("[".concat(this._clientId,"] join number: ").concat(b,", Joining channel failed, rollback"),Fi):_n.error("[".concat(this._clientId,"] join number: ").concat(b,", Joining channel failed, rollback"),Fi),Fi.code!==Di.OPERATION_ABORTED&&this._numberOfJoinCount===b&&(this._gateway.state="DISCONNECTED",this._reset()),z.onError(Fi),Fi}var ue}_joinGateway(){if(!this._joinInfo||!this._key)throw new ga(Di.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!_u("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(o=>o).catch(o=>{if(o.code===Di.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,i_.FALLBACK),o;if(o.code===Di.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,i_.FALLBACK),o;throw o}).then(o=>{if(o instanceof ga){if(o.code===Di.INIT_WEBSOCKET_TIMEOUT){if(_n.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new ga(Di.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const s=_u("PROXY_SERVER_TYPE3");if(Array.isArray(s))if(this._joinInfo.apUrl){const p=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),_=p.slice(p.length-2).join(".");s.forEach(b=>{this._joinInfo&&b.includes(_)&&(this._joinInfo.proxyServer=b)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=s[0])}else this._joinInfo.proxyServer=s[0];else this._joinInfo.proxyServer=s;const l=_u("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return l&&l[1]&&l[1]!=="443"&&_n.setProxyServer(this._joinInfo.proxyServer),_u("STATS_COLLECTOR_PORT").toString()!=="443"&&wE.setProxyServer(this._joinInfo.proxyServer),wE.reportApiInvoke(this._sessionId,{name:j_.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:T_.TRACER}).onSuccess(),this.safeEmit(KE.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),_u("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(p=>{"forceturn"in p&&(p.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(_n.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new ga(Di.INVALID_OPERATION);return wE.reportApiInvoke(this._sessionId,{name:j_.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:T_.TRACER}).onSuccess(),this._joinGateway()}return o}).then(o=>o)}async leave(){_n.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(fT()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(s){const l=BR.indexOf(s);l!==-1&&BR.splice(l,1)}(this);const o=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return _n.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void o();await this._gateway.leave(this.connectionState!=="CONNECTED"),_n.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),o()}async publish(o){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(Array.isArray(o)||(o=[o]),o.length===0)throw new ga(Di.INVALID_PARAMS,"track list is empty");if(this._gateway.role==="audience")throw new ga(Di.INVALID_OPERATION,"audience can not publish stream");for(const p of o){if(!(p instanceof QD))throw new ga(Di.INVALID_PARAMS,"parameter is not local track");if(!p._enabled&&s)throw new ga(Di.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(p.getTrackId()))}_n.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(o.map(p=>"".concat(p.getTrackId()," "))));const l=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),s&&o.forEach(p=>{const _=this._configDistribute.getBitrateLimit();p instanceof G_&&_&&p.setBitrateLimit(_.uplink)});try{await this._publishHighStream(o),_n.info("[".concat(this._clientId,"] Publish success, id ").concat(o.map(p=>"".concat(p.getTrackId()," "))))}catch(p){throw _n.error("[".concat(this._clientId,"] publish error"),p.toString()),p}finally{l()}}async unpublish(o){if(!this._joinInfo||this._uid===void 0)throw new ga(Di.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");o?Array.isArray(o)||(o=[o]):o=this._p2pChannel.getAllTracks(!0),_n.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(o.map(l=>"".concat(l.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{const l=await this._p2pChannel.unpublish(o);l&&await this._gateway.unpublish(l,this._uid),_n.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(o.map(p=>"".concat(p.getTrackId()))))}catch(l){throw _n.error("[".concat(this._clientId,"] unpublish error"),l.toString()),l}finally{s&&s()}}async subscribe(o,s){return this._subscribe(o,s)}async _subscribe(o,s,l){if(Eg(s,"mediaType",["audio","video"]),!this._joinInfo)throw new ga(Di.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ga(Di.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(j=>j===o)){const j=new ga(Di.INVALID_REMOTE_USER,"user is not in the channel");throw _n.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid,", this user is not in the channel")),j}if(!o.hasAudio&&!o.hasVideo){const j=new ga(Di.INVALID_REMOTE_USER,"user is not published");throw _n.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid,", user is not published")),j}if(!(l||(s!=="audio"||o.hasAudio&&o._audioSSRC!==void 0)&&(s!=="video"||o.hasVideo&&o._videoSSRC!==void 0))){const j=new ga(Di.REMOTE_USER_IS_NOT_PUBLISHED);throw _n.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid," with mediaType ").concat(s,", remote track is not published")),j}const p=s==="audio"?o._audioSSRC:o._videoSSRC,_=s==="audio"?o._audioOrtc:o._videoOrtc,b=s==="video"?o._rtxSsrcId:void 0,A={stream_type:s==="audio"?FE.AUDIO:FE.VIDEO,ssrcId:p},k=await this._subscribeMutex.lock();_n.info("[".concat(this._clientId,"] subscribe user ").concat(o.uid,", mediaType: ").concat(s));try{if(await this._p2pChannel.hasRemoteMediaWithLock(o,s))await this._p2pChannel.unmuteRemote(o,s);else try{eS.markSubscribeStart(this.store.clientId,p),this.store.subscribe(o.uid,s,Date.now()),await this._p2pChannel.subscribe(o,s,p,b,_);try{await this._gateway.subscribe(o.uid,A,!0)}catch(z){if((z==null?void 0:z.code)!==Di.WS_ABORT)throw await this._p2pChannel.unsubscribe(o,s),z;await this._p2pChannel.unsubscribe(o,s,!0),this._p2pChannel.setPendingRemoteMedia(o,s)}this.store.subscribe(o.uid,s,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,o,s)}catch(z){throw this._p2pChannel.reportSubscribeEvent(!1,z==null?void 0:z.code,o,s),z}_n.info("[".concat(this._clientId,"] subscribe success user ").concat(o.uid,", mediaType: ").concat(s)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(o.uid,this._defaultStreamFallbackType).catch(z=>{_n.warning("[".concat(this._clientId,"] auto set fallback failed"),z)});const j=s==="audio"?o._audioTrack:o._videoTrack;if(!j)throw new ga(Di.UNEXPECTED_ERROR,"can not find remote track in user object");return j}catch(j){throw _n.error("[".concat(this._clientId,"] subscribe user ").concat(o.uid," error"),j),j}finally{k()}}async massSubscribe(o){if(JS(o,"subscribeList"),!this._joinInfo)throw new ga(Di.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ga(Di.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const s=Date.now(),l=new Map,p=await this._subscribeMutex.lock();_n.info("[".concat(this._clientId,"]start massSubscribe user ").concat(o.map(k=>{let{user:j,mediaType:z}=k;return"user: ".concat(j==null?void 0:j.uid,", mediaType: ").concat(z)}).join("; ")));const _=(o=[...o]).map(k=>{let{user:j,mediaType:z}=k;return{user:j,mediaType:z}}),b=await this._p2pChannel.globalLock();try{var A;for(let j=o.length-1;j>=0;j--){const z=o[j],{user:H,mediaType:$}=z;if(Eg($,"mediaType",["audio","video"]),!H){const Fi=new ga(Di.INVALID_PARAMS,"user property does not exist in subscribeList item");throw _n.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),Fi}if(!this._users.find(Fi=>Fi===H)){const Fi=new ga(Di.INVALID_REMOTE_USER,"user is not in the channel");_n.error("[".concat(this._clientId,"] can not massSubscribe ").concat(H.uid,", this user is not in the channel")),_[j].error=Fi,o.splice(j,1);continue}if($==="audio"&&(!H.hasAudio||H._audioSSRC===void 0)||$==="video"&&(!H.hasVideo||H._videoSSRC===void 0)){const Fi=new ga(Di.REMOTE_USER_IS_NOT_PUBLISHED);_n.error("[".concat(this._clientId,"] can not subscribe ").concat(H.uid," with mediaType ").concat($,", remote user is not published")),_[j].error=Fi,o.splice(j,1);continue}const ue=V_.Video|V_.LwoVideo,Ei=l.get(H);if(Ei){if($==="video"?Ei&ue:Ei&V_.Audio){o.splice(j,1),_n.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(H.uid,", mediaType:").concat($," twice"));continue}l.set(H,Ei|($==="video"?ue:V_.Audio))}else l.set(H,$==="video"?ue:V_.Audio)}for(let j=o.length-1;j>=0;j--){const z=o[j],{user:H,mediaType:$}=z,ue=V_.Video|V_.LwoVideo;if(this._p2pChannel.hasRemoteMedia(H,$)){await this._p2pChannel.unmuteRemoteNoLock(H,$);const Ei=l.get(H);l.set(H,$==="video"?Ei^ue:Ei^V_.Audio),o.splice(j,1)}}this.store.massSubscribe(o.map(j=>({userId:j.user.uid,type:j.mediaType})),s);const k=aR(A=Array.from(l.entries())).call(A,(j,z)=>{let[H,$]=z;if($===0)return j;const ue={stream_id:H.uid,stream_type:$};return $&V_.Audio&&(ue.audio_ssrc=H._audioSSRC),$&V_.Video&&(ue.video_ssrc=H._videoSSRC),j.push(ue),j},[]);try{o.length>0&&await this._p2pChannel.massSubscribeNoLock(o.map(z=>{let{user:H,mediaType:$}=z;return{user:H,mediaType:$,ssrcId:$===FE.VIDEO?H._videoSSRC:H._audioSSRC,rtxSsrcId:$===FE.VIDEO?H._rtxSsrcId:void 0}}));const j=new Map;if(k.length>0){const z=await this._gateway.subscribeAll(k,!0);((z==null?void 0:z.users)||[]).forEach(H=>{let{stream_id:$,video_error_code:ue,audio_error_code:Ei,error_code:Fi}=H;(ue||Ei||Fi)&&j.set($,{video_error_code:ue,audio_error_code:Ei,error_code:Fi})})}if(Array.from(j.entries()).length>0){const z=Array.from(j.entries()).map(H=>{let $,[ue,Ei]=H;return Ei.error_code||Ei.video_error_code&&Ei.audio_error_code?$=void 0:Ei.video_error_code?$=FE.VIDEO:Ei.audio_error_code&&($=FE.AUDIO),{user:this.remoteUsers.find(Fi=>Fi.uid===ue),mediaType:$}});await this._p2pChannel.massUnsubscribeNoLock(z)}for(const z of _){const H=j.get(z.user.uid);if(H){const $=H.error_code||z.mediaType==="audio"&&H.audio_error_code||z.mediaType==="video"&&H.video_error_code;if($){const ue=f0($);_n.error("user:".concat(z.user.uid," mediaType:").concat(z.mediaType," has massSubscribe error ").concat(ue.desc)),z.error=new ga(Di.SUBSCRIBE_FAILED,"code ".concat($,": ").concat(ue.desc))}}z.error||(z.mediaType==="video"?z.track=z.user.videoTrack:z.track=z.user.audioTrack)}return this.store.massSubscribe(_.filter(z=>!z.error).map(z=>({userId:z.user.uid,type:z.mediaType})),void 0,Date.now()),_.forEach(z=>{var H;wE.subscribe(this.store.sessionId,{succ:!!z.error,ec:((H=z.error)===null||H===void 0?void 0:H.code)||null,video:z.mediaType===FE.VIDEO,audio:z.mediaType===FE.AUDIO,peerid:z.user.uid,subscribeRequestid:z.mediaType===FE.VIDEO?z.user._videoSSRC:z.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-s)},!0)}),_n.info("[".concat(this._clientId,"] massSubscribe success ").concat(o.map(z=>{let{user:H,mediaType:$}=z;return"user: ".concat(H==null?void 0:H.uid,", mediaType: ").concat($)}).join("; "))),_}catch(j){throw await this._p2pChannel.massUnsubscribeNoLock(o),j}}finally{b(),p()}}async unsubscribe(o,s){if(s&&Eg(s,"mediaType",["audio","video"]),!this._joinInfo)throw new ga(Di.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(p=>p===o)){const p=new ga(Di.INVALID_REMOTE_USER,"user is not in the channel");throw _n.error("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),p}_n.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(o.uid,", mediaType: ").concat(s));const l=await this._subscribeMutex.lock();try{const p=await this._p2pChannel.unsubscribe(o,s);p&&await this._gateway.unsubscribe(p,o.uid),_n.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(o.uid,", mediaType: ").concat(s))}catch(p){if(p.code===Di.DISCONNECT_P2P)return void _n.warning("disconnecting p2p, abort unsubscribe request.");throw _n.error("[".concat(this._clientId,"] unsubscribe user ").concat(o.uid," error"),p.toString()),p}finally{l()}}async massUnsubscribe(o){if(JS(o,"unsubscribeList"),!this._joinInfo)throw new ga(Di.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");_n.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(o.map(l=>{let{user:p,mediaType:_}=l;return"user: ".concat(p==null?void 0:p.uid,", mediaType: ").concat(_,";")}).join())),o=[...o];const s=new Map;for(let l=o.length-1;l>=0;l--){const{user:p,mediaType:_}=o[l];if(!p){const A=new ga(Di.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw _n.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),A}if(Eg(_,"mediaType",["video","audio",void 0]),!this._users.find(A=>A===p)){_n.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(p.uid,", user is not in the channel")),o.splice(l,1);continue}const b=V_.Video|V_.LwoVideo;if(s.has(p)){const A=s.get(p);let k;switch(_){case"video":k=A&b;break;case"audio":k=A&V_.Audio;break;default:k=A&(V_.Audio|b)}if(k){_n.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(p.uid,",mediaType:").concat(_," twice.")),o.splice(l,1);continue}_?_==="audio"?s.set(p,A|V_.Audio):_==="video"&&s.set(p,A|b):s.set(p,A|V_.Audio|b)}else _?_==="audio"?s.set(p,V_.Audio):_==="video"&&s.set(p,b):s.set(p,V_.Audio|b)}try{const l=await this._p2pChannel.massUnsubscribe(o);l&&await this._gateway.massUnsubscribe(l),_n.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(o.map(p=>{let{user:_,mediaType:b}=p;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(b,";")}).join()))}catch(l){if(l.code===Di.DISCONNECT_P2P)return void _n.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw _n.error("[".concat(this._clientId,"] massUnsubscribe error"),l.toString()),l}}setLowStreamParameter(o){(function(l){if(!l)throw new ga(Di.INVALID_PARAMS);b_(l.width)||wD(l.width,"streamParameter.width"),b_(l.height)||wD(l.height,"streamParameter.height"),b_(l.framerate)||wD(l.framerate,"streamParameter.framerate"),b_(l.bitrate)||E_(l.bitrate,"streamParameter.bitrate")})(o),(!o.width&&o.height||o.width&&!o.height)&&_n.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),_n.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(o));const s=this._configDistribute.getLowStreamConfigDistribute();s&&s.bitrate&&o.bitrate&&s.bitrate<o.bitrate&&(o.bitrate=s.bitrate),this._lowStreamParameter=o}async enableDualStream(){if(!L_().supportDualStream)throw wE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new ga(Di.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new ga(Di.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(o){throw wE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),o}this._isDualStreamEnabled=!0,wE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),_n.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new ga(Di.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(OE.LocalVideoLowTrack))try{const o=await this._p2pChannel.unpublishLowStream();o&&await this._gateway.unpublish(o,this._joinInfo.stringUid||this._joinInfo.uid)}catch(o){throw wE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),o}this._isDualStreamEnabled=!1,wE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),_n.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(o,s){if(function(l){Eg(l,"role",["audience","host"])}(o),s&&aV(s),this.mode==="rtc")throw _n.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new ga(Di.INVALID_OPERATION,"rtc mode can not use setClientRole");if(s&&s.level&&o==="host")throw new ga(Di.INVALID_OPERATION,"host mode can not set audience latency level");if(o==="audience"&&this._p2pChannel.hasLocalMedia())throw new ga(Di.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(o,s),this._config.role=o,_n.info("[".concat(this._clientId,"] set client role to ").concat(o,", level: ").concat(s&&s.level))}setProxyServer(o,s){if(eT(o,"proxyServer"),!s){if(this.connectionState!=="DISCONNECTED")throw new ga(Di.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ga(Di.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=o,wE.setProxyServer(this._proxyServer),_n.setProxyServer(this._proxyServer),_n.info("[".concat(this._clientId,"] Set proxy server ").concat(s?"by initialize call":""," success."))}setTurnServer(o,s){if(Array.isArray(o)||(o=[o]),!s){if(this.connectionState!=="DISCONNECTED")throw new ga(Di.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ga(Di.INVALID_OPERATION,"You have already set the proxy")}if(c0(o))return this._turnServer={servers:o,mode:"original-manual"},void _n.info("[".concat(this._clientId,"] Set original turnserver ").concat(s?"by initialize call":""," success: ").concat(o.map(l=>l.urls).join(","),"."));o.forEach(l=>sV(l)),this._turnServer={servers:o,mode:"manual"},_n.info("[".concat(this._clientId,"] Set turnserver ").concat(s?"by initialize call":""," success."))}setLicense(o){if(this.connectionState!=="DISCONNECTED")throw new ga(Di.INVALID_OPERATION,"you should set license before join channel");if(eT(o,"license",32,32),!/^[A-Za-z\d]+$/.test(o))throw new ga(Di.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=o,_n.info("[".concat(this._clientId,"] set license success"),o)}startProxyServer(o){if(this.connectionState!=="DISCONNECTED")throw new ga(Di.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new ga(Di.INVALID_OPERATION,"You have already set the proxy");const s=[3,4,5];let l;switch(o===void 0&&(o=3),o){case 1:case 2:throw new ga(Di.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:l="proxy3";break;case 4:l="proxy4";break;case 5:l="proxy5";break;default:throw new ga(Di.INVALID_PARAMS,"proxy server mode must be ".concat(s.join("|")))}this._cloudProxyServerMode=l,this.store.cloudProxyServerMode=l,_n.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new ga(Di.INVALID_OPERATION,"Stop proxy server after leave channel");wE.setProxyServer(),_n.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",_n.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(o){if(!o.accessPoints)throw new ga(Di.INVALID_PARAMS,"accessPoints is required.");JS(o.accessPoints.serverList,"accessPoints.serverList"),eT(o.accessPoints.domain,"accessPoints.domain");const s=(ue,Ei)=>{E_(ue,Ei,0,65535,!0)};let l=443;if(o.accessPoints.port&&(s(o.accessPoints.port,"accessPoints.port"),l=o.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ga(Di.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");_u("CLOSE_AFB_FOR_LOCAL_AP")&&(p_("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),p_("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const p=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,_=o.accessPoints.domain,b=o.accessPoints.serverList.map(ue=>p.test(ue)?"".concat(ue.replace(/\./g,"-"),".").concat(_):ue),A=b.map(ue=>"".concat(ue,":").concat(l));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,p_("WEBCS_DOMAIN",A),p_("WEBCS_DOMAIN_BACKUP_LIST",A),p_("GATEWAY_DOMAINS",[_]),o.report&&o.report.hostname&&Array.isArray(o.report.hostname)&&o.report.hostname.length?(JS(o.report.hostname,"report.hostname"),p_("EVENT_REPORT_DOMAIN",o.report.hostname[0]),p_("EVENT_REPORT_BACKUP_DOMAIN",o.report.hostname[1]||o.report.hostname[0])):(p_("EVENT_REPORT_DOMAIN",b[0]),p_("EVENT_REPORT_BACKUP_DOMAIN",b[1]||b[0]));let k=6443;o.report&&o.report.port&&(s(o.report.port,"report.port"),k=o.report.port),p_("STATS_COLLECTOR_PORT",k),o.report?p_("ENABLE_EVENT_REPORT",!0):p_("ENABLE_EVENT_REPORT",!1);let j="";o.log&&o.log.hostname&&Array.isArray(o.log.hostname)&&o.log.hostname.length?(JS(o.log.hostname,"log.hostname"),j=o.log.hostname[0]):j=b[0];let z=6444;o.log&&o.log.port&&(s(o.log.port,"log.port"),z=o.log.port),p_("LOG_UPLOAD_SERVER","".concat(j,":").concat(z));let H=[];o.cds&&o.cds.hostname&&Array.isArray(o.cds.hostname)&&o.cds.hostname.length?(JS(o.cds.hostname,"cds.hostname"),H=o.cds.hostname):H=b;let $=443;o.cds&&o.cds.port&&(s(o.cds.port,"cds.port"),$=o.cds.port),p_("CDS_AP",H.map(ue=>"".concat(ue,":").concat($))),o.cds?p_("ENABLE_CONFIG_DISTRIBUTE",!0):p_("ENABLE_CONFIG_DISTRIBUTE",!1),_n.info("set local access point v2 success")}setLocalAccessPoints(o,s){if(JS(o,"serverList"),eT(s,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ga(Di.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const l=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;o=o.map(p=>l.test(p)?"".concat(p.replace(/\./g,"-"),".").concat(s):p),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,p_("WEBCS_DOMAIN",o),p_("WEBCS_DOMAIN_BACKUP_LIST",o),p_("GATEWAY_DOMAINS",[s]),p_("EVENT_REPORT_DOMAIN",o[0]),p_("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]),p_("LOG_UPLOAD_SERVER","".concat(o[0],":6444")),_n.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(o){if(Eg(o,"streamType",[0,1]),this._remoteDefaultVideoStreamType=o,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(o),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(s){throw _n.error("[".concat(this._clientId,"] set default remote video stream type error"),s.toString()),s}else _n.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(o))}async setRemoteVideoStreamType(o,s){Eg(s,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(o,s),setTimeout(()=>{const l=this._users.find(p=>p.uid===o);l&&l.videoTrack&&l.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(l){throw _n.error("[".concat(this._clientId,"] set remote video stream type error"),l.toString()),l}_n.info("[".concat(this._clientId,"] set remote ").concat(o," video stream type to ").concat(s)),this._remoteStreamTypeCacheMap.set(o,s)}async setStreamFallbackOption(o,s){Eg(s,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(o,s)}catch(l){throw _n.error("[".concat(this._clientId,"] set stream fallback option"),l.toString()),l}_n.info("[".concat(this._clientId,"] set remote ").concat(o," stream fallback type to ").concat(s)),this._streamFallbackTypeCacheMap.set(o,s)}setEncryptionConfig(o,s,l){if(function(p){Eg(p,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(o),eT(s,"secret"),["aes-128-gcm2","aes-256-gcm2"].includes(o)){if(!l||!(l instanceof Uint8Array&&l.length===32))throw new ga(Di.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(l)throw new ga(Di.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(s)||_n.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=o,this._encryptionSecret=s,l&&(this._encryptionSalt=qO(l))}async renewToken(o){if(eT(o,"token",1,2047),!this._key||!this._joinInfo)throw new ga(Di.INVALID_OPERATION,"renewToken should not be called before user join");const s=this._key;this._key=o,this._joinInfo&&(this._joinInfo.token=o);const l=await this._renewTokenMutex.lock();try{if(_u("USE_NEW_TOKEN")){_n.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const p=await VX(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||x_);_n.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:o,ticket:p})}else _n.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:o});_n.debug("[".concat(this._clientId,"] renewToken success"))}catch(p){throw this._key=s,this._joinInfo.token=s,_n.error("[".concat(this._clientId,"] renewToken failed"),p.toString()),p}finally{l()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?_n.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const o=this._p2pChannel.getAudioLevels();this.safeEmit(KE.VOLUME_INDICATOR,o)},_u("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const o=this._statsCollector.getRTCStats(),s=this._gateway.getInChannelInfo();return o.Duration=Math.round(s.duration/1e3),o}async startLiveStreaming(o,s){if(!s){if(this.codec!=="h264")throw new ga(Di.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new ga(Di.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(o)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(o))throw new ga(Di.LIVE_STREAMING_TASK_CONFLICT);const l=s?H_.TRANSCODE:H_.RAW;return this._createLiveStreamingClient(l).startLiveStreamingTask(o,l)}setLiveTranscoding(o){return this._createLiveStreamingClient(H_.TRANSCODE).setTranscodingConfig(o)}async stopLiveStreaming(o){const s=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(l=>l&&l.hasUrl(o));if(!s.length)throw new ga(Di.INVALID_PARAMS,"can not find live streaming url to stop");await RE.all(s.map(l=>l&&l.stopLiveStreamingTask(o)))}async addInjectStreamUrl(o,s){if(!this._joinInfo)throw new ga(Di.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const l=this._createLiveStreamingClient(H_.INJECT);l.setInjectStreamConfig(s,0),await l.startLiveStreamingTask(o,H_.INJECT)}async removeInjectStreamUrl(){var o;const s=this._createLiveStreamingClient(H_.INJECT),l=Array.from(US(o=s.streamingTasks).call(o)).find(p=>p.mode===H_.INJECT);if(!this._joinInfo||!l)throw new ga(Di.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await s.stopLiveStreamingTask(l.url)}async startChannelMediaRelay(o){b3(o),await this._createChannelMediaRelayClient().startChannelMediaRelay(o)}async updateChannelMediaRelay(o){b3(o),await this._createChannelMediaRelayClient().updateChannelMediaRelay(o)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendStreamMessage(o){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new ga(Di.INVALID_OPERATION,"can not send data stream, not joined");if(typeof o=="string"&&(o=new TextEncoder().encode(o)),new Blob([o]).size>1024)throw new ga(Di.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(ME.DATA_STREAM,{payload:qO(o)},!s)}sendMetadata(o){if(!this._joinInfo)throw new ga(Di.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([o]).size>1024)throw new ga(Di.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ME.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:qO(o)})}async sendCustomReportMessage(o){if(Array.isArray(o)||(o=[o]),o.forEach(Z7),!this._joinInfo)throw new ga(Di.INVALID_OPERATION,"can not send custom report, not joined");await wE.sendCustomReportMessage(this._joinInfo.sid,o)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(o,s){Eg(s.spatialLayer,"spatialLayer",[0,1,2,3]),Eg(s.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(o,s)}catch(l){throw _n.error("[".concat(this._clientId,"] pick SVC layer failed"),l.toString()),l}}_reset(){if(_n.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=VT.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._users.forEach(o=>{o._audioTrack&&o._audioTrack._destroy(),o._videoTrack&&o._videoTrack._destroy()}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new gT("client-publish"),this._subscribeMutex=new gT("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(o,s){const l=o||oL();o?_n.debug("[".concat(this._clientId,"] new Session ").concat(l)):_n.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(l)),this._sessionId=l,this.store.sessionId=l,s?wE.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:s.channel,appid:s.appId,mode:this.mode}):this._joinInfo?wE.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&wE.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=l),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=l)}async _publishHighStream(o){if(!this._joinInfo||this._uid===void 0)throw new ga(Di.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ga(Di.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&_u("FORCE_TURN")&&!_u("TURN_ENABLE_TCP")&&!_u("TURN_ENABLE_UDP"))throw new ga(Di.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");_n.debug("[".concat(this._clientId,"] publish high stream"));try{const l=await this._p2pChannel.publish(o,this._isDualStreamEnabled,this._lowStreamParameter),p=(await l.next()).value;if(p){var s;let _;try{_=await this._gateway.publish(this._uid,p,!0)}catch(b){if(b.code!==Di.DISCONNECT_P2P)throw l.throw(b),b}await l.next(((s=_)===null||s===void 0?void 0:s.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const _ of o)_ instanceof G_&&_._encoderConfig&&this._gateway.setVideoProfile(_._encoderConfig),!_.muted&&_.enabled||await this._p2pChannel.muteLocalTrack(_)}catch(l){if(this._p2pChannel.reportPublishEvent(!1,l==null?void 0:l.code,o),(l==null?void 0:l.code)===Di.WS_ABORT)return;throw l}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new ga(Di.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ga(Di.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));_n.debug("[".concat(this._clientId,"] publish low stream"));const o=this._configDistribute.getLowStreamConfigDistribute();o&&o.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&o.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=o.bitrate));try{const l=await this._p2pChannel.publishLowStream(this._lowStreamParameter),p=(await l.next()).value;if(p){var s;let _;try{_=await this._gateway.publish(this._uid,p,!0)}catch(b){if(b.code!==Di.DISCONNECT_P2P)throw l.throw(b),b}l.next(((s=_)===null||s===void 0?void 0:s.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(l){if(this._p2pChannel.reportPublishEvent(!1,l==null?void 0:l.code,void 0,!0),(l==null?void 0:l.code)===Di.WS_ABORT)return;throw l}}_createLiveStreamingClient(o){if(!this._joinInfo||!this._appId)return new ga(Di.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=()=>new GX(this._joinInfo,this._config.websocketRetryConfig||x_,this._config.httpRetryConfig||x_),l=p=>{p.onLiveStreamError=(_,b)=>{wE.reportApiInvoke(this._sessionId,{name:j_.ON_LIVE_STREAM_ERROR,options:[_,b],tag:T_.TRACER}).onSuccess(),this.safeEmit(KE.LIVE_STREAMING_ERROR,_,b)},p.onLiveStreamWarning=(_,b)=>{wE.reportApiInvoke(this._sessionId,{name:j_.ON_LIVE_STREAM_WARNING,options:[_,b],tag:T_.TRACER}).onSuccess(),this.safeEmit(KE.LIVE_STREAMING_WARNING,_,b)},p.on(RI.REQUEST_WORKER_MANAGER_LIST,(_,b,A)=>{if(!this._joinInfo)return A(new ga(Di.INVALID_OPERATION,"can not find join info to get worker manager"));E3(_,this._joinInfo,this._axiosCancelSource.token,x_).then(b).catch(A)})};switch(o){case H_.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=s(),l(this._liveRawStreamingClient)),this._liveRawStreamingClient;case H_.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=s(),l(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case H_.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=s(),this._injectStreamingClient.on(RI.REQUEST_WORKER_MANAGER_LIST,(p,_,b)=>{if(!this._joinInfo)return b(new ga(Di.INVALID_OPERATION,"can not find join info to get worker manager"));E3(p,this._joinInfo,this._axiosCancelSource.token,x_).then(_).catch(b)}),this._injectStreamingClient.onInjectStatusChange=(p,_,b)=>{this.emit(KE.INJECT_STREAM_STATUS,p,_,b)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new ga(Di.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:o,sendResolutionHeight:s}=this.getLocalVideoStats(),l={width:o,height:s};this._channelMediaRelayClient=new WX(this._joinInfo,this._clientId,this._config.websocketRetryConfig||x_,this._config.httpRetryConfig||x_,l),this._channelMediaRelayClient.on("state",p=>{p===_T.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(KE.CHANNEL_MEDIA_RELAY_STATE,p)}),this._channelMediaRelayClient.on("event",p=>{this.safeEmit(KE.CHANNEL_MEDIA_RELAY_EVENT,p)}),this._statsCollector.onStatsChanged=(p,_)=>{var b;p==="resolution"&&((b=this._channelMediaRelayClient)===null||b===void 0||b.setVideoProfile(_))}}return this._channelMediaRelayClient}_handleGatewayEvents(){this._gateway.on(S_.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(S_.CONNECTION_STATE_CHANGE,(o,s,l)=>{var p;if(l===i_.FALLBACK)return;const _=()=>{this.safeEmit(KE.CONNECTION_STATE_CHANGE,o,s,l)};if(wE.reportApiInvoke(this._sessionId||((p=this._gateway.joinInfo)===null||p===void 0?void 0:p.sid)||null,{name:j_.CONNECTION_STATE_CHANGE,options:[o,s,l],tag:T_.TRACER}).onSuccess(JSON.stringify({cur:o,prev:s,reason:l})),_n.info("[".concat(this._clientId,"] connection state change: ").concat(s," -> ").concat(o)),o==="DISCONNECTED")return this._reset(),void _();if(o==="RECONNECTING")this._users.forEach(A=>{A._trust_in_room_=!1,A._trust_audio_enabled_state_=!1,A._trust_video_enabled_state_=!1,A._trust_audio_mute_state_=!1,A._trust_video_mute_state_=!1,A._trust_audio_stream_added_state_=!1,A._trust_video_stream_added_state_=!1,A._audioSSRC=void 0,A._videoSSRC=void 0,A._videoOrtc=void 0,A._audioOrtc=void 0,A._cname=void 0,A._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(o==="CONNECTED"){var b;this._streamFallbackTypeCacheMap.forEach((A,k)=>{this._gateway.setStreamFallbackOption(k,A).catch(j=>{_n.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),j)})}),this._remoteStreamTypeCacheMap.forEach((A,k)=>{this._gateway.setRemoteVideoStreamType(k,A).catch(j=>{_n.warning("[".concat(this._clientId,"] auto set remote stream type failed"),j)})}),this._remoteDefaultVideoStreamType!==void 0&&((b=this._joinInfo)===null||b===void 0?void 0:b.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{_n.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(A=>{_n.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(A))}),this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(A=>!A._trust_in_room_).forEach(A=>{_n.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(A.uid)),this._handleUserOffline({uid:A.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(A=>{A._trust_audio_mute_state_||(_n.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(A.uid)),this._handleMuteStream(A.uid,"audio",!1)),A._trust_video_mute_state_||(_n.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(A.uid)),this._handleMuteStream(A.uid,"video",!1)),A._trust_audio_enabled_state_||(_n.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(A.uid)),this._handleSetStreamLocalEnable("audio",A.uid,!0)),A._trust_video_enabled_state_||(_n.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(A.uid)),this._handleSetStreamLocalEnable("video",A.uid,!0)),A._trust_video_stream_added_state_||(_n.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(A.uid)),this._handleResetAddStream(A,"video")),A._trust_audio_stream_added_state_||(_n.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(A.uid)),this._handleResetAddStream(A,"audio")),A._video_added_||A._audio_added_||(_n.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(A.uid)),this._handleRemoveStream({uid:A.uid,uint_id:A._uintid}))}))},1e3)}_()}),this._gateway.on(S_.REQUEST_NEW_GATEWAY_LIST,(o,s)=>{if(!this._joinInfo)return s(new ga(Di.UNEXPECTED_ERROR,"can not recover, no join info"));pL(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||x_,this.store).then(l=>{this._joinInfo&&(this._joinInfo.apResponse=l.gatewayInfo.res,this._joinInfo.gatewayAddrs=l.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=l.gatewayInfo.uni_lbs_ip),o(l.gatewayInfo.gatewayAddrs.map(p=>{if(this._joinInfo&&this._joinInfo.proxyServer){const _=p.address.split(":");return"wss://".concat(this._joinInfo.proxyServer,"/ws/?h=").concat(_[0],"&p=").concat(_[1])}return"wss://".concat(p.address)}))}).catch(s)}),this._gateway.on(S_.NETWORK_QUALITY,o=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(KE.NETWORK_QUALITY,o)}),this._gateway.on(S_.STREAM_TYPE_CHANGE,(o,s)=>{this.safeEmit(KE.STREAM_TYPE_CHANGED,o,s),wE.reportApiInvoke(this._sessionId,{name:j_.STREAM_TYPE_CHANGE,options:[o,s],tag:T_.TRACER}).onSuccess(JSON.stringify({uid:o,streamType:s}))}),this._gateway.on(S_.IS_P2P_DISCONNECTED,o=>{this._p2pChannel.isP2PDisconnected()?o(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?o(!1):o(!0)}),this._gateway.on(S_.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(S_.REQUEST_P2P_CONNECTION_PARAMS,async(o,s,l)=>{try{s(await this._p2pChannel.startP2PConnection(o))}catch(p){l(p)}}),this._gateway.on(S_.JOIN_RESPONSE,(o,s)=>{const{dtlsParameters:l,iceParameters:p,candidates:_,rtpCapabilities:b,setup:A,cname:k}=qG(o.ortc,s);this._p2pChannel.connect(p,l,_,b,A,k)}),this._gateway.on(S_.REQUEST_DC_CONNECTION_PARAMS,o=>{o(this._p2pChannel.getEstablishParams())}),this._gateway.on(S_.RESET_SIGNAL,o=>{this._p2pChannel.resetConnection(o),this._handleGatewaySignalEvents()}),this._gateway.on(S_.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(S_.DATACHANNEL_PRECONNECT,async(o,s,l,p)=>{var _,b,A,k,j,z;await this._p2pChannel.startP2PConnection({turnServer:(_=this._joinInfo)===null||_===void 0?void 0:_.turnServer},!0);const H=function($,ue){let Ei;return ue&&ue.ip&&typeof ue.port=="number"?(Ei=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:ue.ip,port:ue.port.toString(),type:"host",extension:{}}],_n.debug("Using remote candidate from AP ".concat(ue.ip,":").concat(ue.port)),ue.ip6&&(Ei.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:ue.ip6,port:ue.port.toString(),type:"host",extension:{}}),_n.debug("Using IPV6 remote candidate from AP ".concat(ue.ip6,":").concat(ue.port)))):Ei=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:$.ip,port:$.port.toString(),type:"host",extension:{}}],Ei}(o,s);return this._p2pChannel.preConnect({iceUfrag:"".concat((b=this._joinInfo)===null||b===void 0?void 0:b.apResponse.cid,"_").concat((A=this._joinInfo)===null||A===void 0?void 0:A.apResponse.cert),icePwd:"".concat((k=this._joinInfo)===null||k===void 0?void 0:k.apResponse.cid,"_").concat((j=this._joinInfo)===null||j===void 0?void 0:j.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(z=_u("FINGERPRINT"))!==null&&z!==void 0?z:o.fingerprint}]},H,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(l).catch(p)})}_handleGatewaySignalEvents(){this._gateway.signal.on(qE.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(qE.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(qE.ON_ADD_AUDIO_STREAM,o=>this._handleAddAudioOrVideoStream("audio",o.uid,o.ssrcId,o.cname,o.uint_id,o.ortc)),this._gateway.signal.on(qE.ON_ADD_VIDEO_STREAM,o=>this._handleAddAudioOrVideoStream("video",o.uid,o.ssrcId,o.cname,o.uint_id,o.ortc,o.rtxSsrcId)),this._gateway.signal.on(qE.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(qE.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(qE.MUTE_AUDIO,o=>this._handleMuteStream(o.uid,"audio",!0)),this._gateway.signal.on(qE.UNMUTE_AUDIO,o=>this._handleMuteStream(o.uid,"audio",!1)),this._gateway.signal.on(qE.MUTE_VIDEO,o=>this._handleMuteStream(o.uid,"video",!0)),this._gateway.signal.on(qE.UNMUTE_VIDEO,o=>this._handleMuteStream(o.uid,"video",!1)),this._gateway.signal.on(qE.RECEIVE_METADATA,o=>{const s=aL(o.metadata);this.safeEmit(KE.RECEIVE_METADATA,o.uid,s)}),this._gateway.signal.on(qE.ON_DATA_STREAM,o=>{o.seq&&delete o.seq,o.payload=aL(o.payload),this.safeEmit(KE.STREAM_MESSAGE,o.uid,o.payload),this.onStreamMessage&&this.onStreamMessage(o)}),this._gateway.signal.on(qE.ON_CRYPT_ERROR,()=>{h0(()=>{_n.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(KE.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(qE.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(qE.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{_n.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0),this.safeEmit(KE.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(qE.ON_STREAM_FALLBACK_UPDATE,o=>{_n.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(o.stream_id,", attr: ").concat(o.stream_type)),this.safeEmit(KE.STREAM_FALLBACK,o.stream_id,o.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(qE.ON_PUBLISH_STREAM,o=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:o.proxy})),_n.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(o))))}),this._gateway.signal.on(qE.ENABLE_LOCAL_VIDEO,o=>{this._handleSetStreamLocalEnable("video",o.uid,!0)}),this._gateway.signal.on(qE.DISABLE_LOCAL_VIDEO,o=>{this._handleSetStreamLocalEnable("video",o.uid,!1)}),this._gateway.signal.on(NE.REQUEST_TIMEOUT,(o,s)=>{if(this._joinInfo)switch(o){case ME.PUBLISH:{if(!s)return;const A=(s=s).ortc;if(A){var l,p,_,b;const k=A.some(H=>{let{stream_type:$}=H;return $===Y_.Audio}),j=A.some(H=>{let{stream_type:$}=H;return $!==Y_.Audio}),z=A.some(H=>{let{stream_type:$}=H;return $===Y_.Screen||$===Y_.ScreenLow});s.state==="offer"&&wE.publish(this._joinInfo.sid,{eventElapse:eS.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:Di.TIMEOUT,audio:k,video:j,p2pid:s.p2p_id,publishRequestid:this.store.pubId,screenshare:z,audioName:k?(l=A.find(H=>{let{stream_type:$}=H;return $===Y_.Audio}))===null||l===void 0||(p=l.ssrcs[0])===null||p===void 0?void 0:p.ssrcId.toString():void 0,videoName:j?(_=A.find(H=>{let{stream_type:$}=H;return $!==Y_.Audio}))===null||_===void 0||(b=_.ssrcs[0])===null||b===void 0?void 0:b.ssrcId.toString():void 0})}break}case ME.SUBSCRIBE:(s=s)&&wE.subscribe(this._joinInfo.sid,{succ:!1,ec:Di.TIMEOUT,audio:s.stream_type===FE.AUDIO,video:s.stream_type===FE.VIDEO,peerid:s.stream_id,subscribeRequestid:s.ssrcId,p2pid:this.store.p2pId,eventElapse:eS.measureFromSubscribeStart(this.store.clientId,s.ssrcId)})}}),this._gateway.signal.on(qE.ON_P2P_OK,o=>{this.uid,this._uid}),this._gateway.signal.on(qE.ON_PUBLISHED_USER_LIST,o=>{if(o==null||!o.users)return;_u("BLOCK_LOCAL_CLIENT")&&(o.users=o.users.filter(p=>!GR(p.audio_ssrc,this.channelName)));const s=[],l=[];for(const p of o.users){let _=this._users.find(z=>z.uid===p.stream_id);_?_._trust_in_room_=!0:(_=new mL(p.stream_id,p.stream_id),this._users.push(_),this.getListeners(KE.PUBLISHED_USER_LIST).length===0&&(_n.debug("[".concat(this._clientId,"] user online"),p.stream_id),this.safeEmit(KE.USER_JOINED,_)));const b=V_.Audio&p.stream_type,A=(V_.Video|V_.LwoVideo)&p.stream_type,k=b&&_.hasAudio,j=A&&_.hasVideo;A&&(_._trust_video_stream_added_state_=!0,_._video_added_=!0,_._videoSSRC=p.video_ssrc,_._rtxSsrcId=p.video_rtx),b&&(_._trust_audio_stream_added_state_=!0,_._audio_added_=!0,_._audioSSRC=p.audio_ssrc),b&&!k&&this.getListeners(KE.PUBLISHED_USER_LIST).length===0&&(_n.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published audio")),this.safeEmit(KE.USER_PUBLISHED,_,"audio")),A&&!j&&this.getListeners(KE.PUBLISHED_USER_LIST).length===0&&(_n.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published video")),this.safeEmit(KE.USER_PUBLISHED,_,"video")),(b&&!k||A&&!j)&&s.push(_),A&&this._p2pChannel.hasPendingRemoteMedia(_,"video")&&l.push({user:_,mediaType:"video"}),b&&this._p2pChannel.hasPendingRemoteMedia(_,"audio")&&l.push({user:_,mediaType:"audio"})}l.length>0&&(_n.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(l.map(p=>"user: ".concat(p.user.uid,", mediaType: ").concat(p.mediaType)).join("; ")," ")),this.massSubscribe(l).catch(p=>{_n.error("[".concat(this._clientId,"] mass resubscribe error"),p.toString())})),this.getListeners(KE.PUBLISHED_USER_LIST).length>0?(_n.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(s.map(p=>p.uid).join(", "))),this.safeEmit(KE.PUBLISHED_USER_LIST,s)):_n.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(s.map(p=>p.uid).join(", ")))})}_handleP2PChannelEvents(){this._p2pChannel.on(QE.RequestMuteLocal,async(o,s,l)=>{if(this._joinInfo)try{await this._gateway.muteLocal(o,this._joinInfo.stringUid||this._joinInfo.uid),s()}catch(p){p.code===Di.DISCONNECT_P2P?s():l(p)}else s()}),this._p2pChannel.on(QE.RequestUnmuteLocal,async(o,s,l)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(o,this._joinInfo.stringUid||this._joinInfo.uid),s()}catch(p){p.code===Di.DISCONNECT_P2P?s():l(p)}else s()}),this._p2pChannel.on(QE.RequestRePublish,(o,s,l)=>{this.publish(o,!1).then(s).catch(l)}),this._p2pChannel.on(QE.RequestReSubscribe,async(o,s,l)=>{try{for(const{user:p,kind:_}of o)_===FE.VIDEO?await this.subscribe(p,"video"):await this.subscribe(p,"audio");s()}catch(p){l(p)}}),this._p2pChannel.on(QE.RequestUploadStats,(o,s)=>{this._gateway.uploadStats(o,s)}),this._p2pChannel.on(QE.MediaReconnectStart,o=>{this.safeEmit(KE.MEDIA_RECONNECT_START,o)}),this._p2pChannel.on(QE.MediaReconnectEnd,o=>{this.safeEmit(KE.MEDIA_RECONNECT_END,o)}),this._p2pChannel.on(QE.NeedSignalRTT,o=>{o(this._gateway.getSignalRTT())}),this._p2pChannel.on(QE.RequestRestartICE,async o=>{const s=await this._p2pChannel.restartICE(o),l=await s.next();if(l.done)return;const p=l.value;let _;try{_=await this._gateway.restartICE({iceParameters:p})}catch(A){return void s.throw(A)}const{iceParameters:b}=function(A){const k=A.iceParameters;return{iceParameters:{iceUfrag:k.iceUfrag,icePwd:k.icePwd}}}(_);await s.next({remoteIceParameters:b})}),this._p2pChannel.on(QE.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(QE.RequestReconnectPC,async()=>{var o;const{iceParameters:s,dtlsParameters:l,rtpCapabilities:p}=await this._p2pChannel.startP2PConnection({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer}),{gatewayEstablishParams:_,gatewayAddress:b}=await this._gateway.reconnectPC({iceParameters:s,dtlsParameters:l,rtpCapabilities:p}),{dtlsParameters:A,iceParameters:k,candidates:j,rtpCapabilities:z,setup:H,cname:$}=qG(_,b);await this._p2pChannel.connect(k,A,j,z,H,$),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(QE.RequestUnpublishForReconnectPC,async(o,s,l)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(o,this._uid),s()):l()}),this._p2pChannel.on(QE.P2PLost,()=>{this.safeEmit(KE.P2P_LOST,this.store.uid)}),this._p2pChannel.on(QE.UpdateVideoEncoder,o=>{o._encoderConfig&&this._gateway.setVideoProfile(o._encoderConfig)}),this._p2pChannel.on(QE.ConnectionTypeChange,o=>{this.safeEmit(KE.IS_USING_CLOUD_PROXY,o)}),this._p2pChannel.on(QE.RequestLowStreamParameter,o=>{o(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(QE.QueryClientConnectionState,o=>{o(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(o){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new ga(Di.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new ga(Di.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!o)throw new ga(Di.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!o.inspectType||!Array.isArray(o.inspectType))throw new ga(Di.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const s=[...new Set(o.inspectType)];s.forEach(l=>{if(!["supervise","moderation"].includes(l))throw new ga(Di.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(l," is not a valid inspect type."))}),o.inspectType=s}if(o&&o.extraInfo&&o.extraInfo.length>1024)throw new ga(Di.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const s=new sN(o);this._inspect=s,this.handleVideoInspectEvents(this._inspect),await s.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},x_)}catch(s){throw Array.isArray(s)?s[0]:s}}async disableContentInspect(){if(!this._inspect)throw new ga(Di.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}async setImageModeration(o,s){if(TI(o,"enabled"),o){if(!s)throw new ga(Di.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(E_(s.interval,"interval",1e3,1/0),this.connectionState!=="CONNECTED"||!this._joinInfo)throw new ga(Di.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(s);const l=new $L(s);this._moderation=l,this.handleImageModerationEvents(this._moderation),await l.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},x_)}catch(l){throw Array.isArray(l)?l[0]:l}}else{if(!this._moderation)throw new ga(Di.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(l){throw Array.isArray(l)?l[0]:l}}}handleImageModerationEvents(o){o.on(tS.CONNECTION_STATE_CHANGE,(s,l)=>{switch(this.emit(KE.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,s,l),s){case LT.CONNECTED:if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new ga(Di.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");o.inspectImage()}}),o.on(tS.CLIENT_LOCAL_VIDEO_TRACK,s=>{s(this.localTracks.filter(l=>l.trackMediaType==="video")[0])})}handleVideoInspectEvents(o){o.on(z_.CONNECTION_STATE_CHANGE,(s,l)=>{switch(this.emit(KE.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,s,l),l){case GT.CONNECTED:if(this.connectionState!=="CONNECTED")return void this.emit(KE.CONTENT_INSPECT_ERROR,new ga(Di.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));o.inspectImage()}}),o.on(z_.INSPECT_RESULT,(s,l)=>{var p;if((l==null?void 0:l.code)===Di.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return _n.debug("Stop inspect content because that has left channel"),this==null||(p=this._inspect)===null||p===void 0||p.close(),void(this._inspect=void 0);this.emit(KE.CONTENT_INSPECT_RESULT,s,l)}),o.on(z_.CLIENT_LOCAL_VIDEO_TRACK,s=>{s(this.localTracks.filter(l=>l.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return _n.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(o){TI(o,"enabled"),p_("ENABLE_PUBLISH_AUDIO_FILTER",o),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(o)}_handleResetAddStream(o,s){switch(s){case"audio":o._audio_added_=!1,o._trust_audio_stream_added_state_=!0;break;case"video":o._video_added_=!1,o._trust_video_stream_added_state_=!0}}}).prototype,"leave",[e6],Object.getOwnPropertyDescriptor(_E.prototype,"leave"),_E.prototype),oE(_E.prototype,"publish",[n6],Object.getOwnPropertyDescriptor(_E.prototype,"publish"),_E.prototype),oE(_E.prototype,"unpublish",[r6],Object.getOwnPropertyDescriptor(_E.prototype,"unpublish"),_E.prototype),oE(_E.prototype,"subscribe",[i6],Object.getOwnPropertyDescriptor(_E.prototype,"subscribe"),_E.prototype),oE(_E.prototype,"massSubscribe",[o6],Object.getOwnPropertyDescriptor(_E.prototype,"massSubscribe"),_E.prototype),oE(_E.prototype,"unsubscribe",[s6],Object.getOwnPropertyDescriptor(_E.prototype,"unsubscribe"),_E.prototype),oE(_E.prototype,"massUnsubscribe",[a6],Object.getOwnPropertyDescriptor(_E.prototype,"massUnsubscribe"),_E.prototype),oE(_E.prototype,"setLowStreamParameter",[c6],Object.getOwnPropertyDescriptor(_E.prototype,"setLowStreamParameter"),_E.prototype),oE(_E.prototype,"enableDualStream",[u6],Object.getOwnPropertyDescriptor(_E.prototype,"enableDualStream"),_E.prototype),oE(_E.prototype,"disableDualStream",[d6],Object.getOwnPropertyDescriptor(_E.prototype,"disableDualStream"),_E.prototype),oE(_E.prototype,"setClientRole",[l6],Object.getOwnPropertyDescriptor(_E.prototype,"setClientRole"),_E.prototype),oE(_E.prototype,"setProxyServer",[h6],Object.getOwnPropertyDescriptor(_E.prototype,"setProxyServer"),_E.prototype),oE(_E.prototype,"setTurnServer",[p6],Object.getOwnPropertyDescriptor(_E.prototype,"setTurnServer"),_E.prototype),oE(_E.prototype,"setLicense",[f6],Object.getOwnPropertyDescriptor(_E.prototype,"setLicense"),_E.prototype),oE(_E.prototype,"startProxyServer",[E6],Object.getOwnPropertyDescriptor(_E.prototype,"startProxyServer"),_E.prototype),oE(_E.prototype,"stopProxyServer",[m6],Object.getOwnPropertyDescriptor(_E.prototype,"stopProxyServer"),_E.prototype),oE(_E.prototype,"setLocalAccessPointsV2",[_6],Object.getOwnPropertyDescriptor(_E.prototype,"setLocalAccessPointsV2"),_E.prototype),oE(_E.prototype,"setLocalAccessPoints",[g6],Object.getOwnPropertyDescriptor(_E.prototype,"setLocalAccessPoints"),_E.prototype),oE(_E.prototype,"setRemoteDefaultVideoStreamType",[v6],Object.getOwnPropertyDescriptor(_E.prototype,"setRemoteDefaultVideoStreamType"),_E.prototype),oE(_E.prototype,"setRemoteVideoStreamType",[y6],Object.getOwnPropertyDescriptor(_E.prototype,"setRemoteVideoStreamType"),_E.prototype),oE(_E.prototype,"setStreamFallbackOption",[b6],Object.getOwnPropertyDescriptor(_E.prototype,"setStreamFallbackOption"),_E.prototype),oE(_E.prototype,"setEncryptionConfig",[T6],Object.getOwnPropertyDescriptor(_E.prototype,"setEncryptionConfig"),_E.prototype),oE(_E.prototype,"renewToken",[S6],Object.getOwnPropertyDescriptor(_E.prototype,"renewToken"),_E.prototype),oE(_E.prototype,"enableAudioVolumeIndicator",[R6],Object.getOwnPropertyDescriptor(_E.prototype,"enableAudioVolumeIndicator"),_E.prototype),oE(_E.prototype,"startLiveStreaming",[I6],Object.getOwnPropertyDescriptor(_E.prototype,"startLiveStreaming"),_E.prototype),oE(_E.prototype,"setLiveTranscoding",[O6],Object.getOwnPropertyDescriptor(_E.prototype,"setLiveTranscoding"),_E.prototype),oE(_E.prototype,"stopLiveStreaming",[A6],Object.getOwnPropertyDescriptor(_E.prototype,"stopLiveStreaming"),_E.prototype),oE(_E.prototype,"addInjectStreamUrl",[w6],Object.getOwnPropertyDescriptor(_E.prototype,"addInjectStreamUrl"),_E.prototype),oE(_E.prototype,"removeInjectStreamUrl",[C6],Object.getOwnPropertyDescriptor(_E.prototype,"removeInjectStreamUrl"),_E.prototype),oE(_E.prototype,"startChannelMediaRelay",[N6],Object.getOwnPropertyDescriptor(_E.prototype,"startChannelMediaRelay"),_E.prototype),oE(_E.prototype,"updateChannelMediaRelay",[P6],Object.getOwnPropertyDescriptor(_E.prototype,"updateChannelMediaRelay"),_E.prototype),oE(_E.prototype,"stopChannelMediaRelay",[D6],Object.getOwnPropertyDescriptor(_E.prototype,"stopChannelMediaRelay"),_E.prototype),oE(_E.prototype,"sendCustomReportMessage",[k6],Object.getOwnPropertyDescriptor(_E.prototype,"sendCustomReportMessage"),_E.prototype),oE(_E.prototype,"pickSVCLayer",[L6],Object.getOwnPropertyDescriptor(_E.prototype,"pickSVCLayer"),_E.prototype),oE(_E.prototype,"enableContentInspect",[M6],Object.getOwnPropertyDescriptor(_E.prototype,"enableContentInspect"),_E.prototype),oE(_E.prototype,"disableContentInspect",[U6],Object.getOwnPropertyDescriptor(_E.prototype,"disableContentInspect"),_E.prototype),oE(_E.prototype,"setImageModeration",[x6],Object.getOwnPropertyDescriptor(_E.prototype,"setImageModeration"),_E.prototype),oE(_E.prototype,"getJoinChannelServiceRecords",[j6],Object.getOwnPropertyDescriptor(_E.prototype,"getJoinChannelServiceRecords"),_E.prototype),oE(_E.prototype,"setPublishAudioFilterEnabled",[V6],Object.getOwnPropertyDescriptor(_E.prototype,"setPublishAudioFilterEnabled"),_E.prototype),_E);class m$ extends xV{set currentState(s){s!==this._currentState&&(this._currentState=s,this.safeEmit(OT.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(s){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),_t(this,"audioBuffer",void 0),_t(this,"sourceNode",void 0),_t(this,"startPlayTime",0),_t(this,"startPlayOffset",0),_t(this,"pausePlayTime",0),_t(this,"options",void 0),_t(this,"currentLoopCount",0),_t(this,"currentPlaybackSpeed",100),_t(this,"_currentState","stopped"),this.audioBuffer=s,this.options=l,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(s){this.currentState==="stopped"?(this.options=s,this.startPlayOffset=this.options.startPlayTime||0):_n.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(s){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=s,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=s))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}setAudioBufferPlaybackSpeed(s){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=s/100),this.currentPlaybackSpeed=s}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const s=this.context.createBufferSource();return s.buffer=this.audioBuffer,s.loop=!!this.options.loop,s.connect(this.outputNode),s.playbackRate.value=this.currentPlaybackSpeed/100,s}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const B6=new Map;async function _$(o,s){let l=null;if(typeof o=="string"){const _=B6.get(o);if(_)return _n.debug("use cached audio resource: ",o),_;try{l=(await SS(()=>VT.get(o,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(b){throw new ga(Di.FETCH_AUDIO_FILE_FAILED,b.toString())}}else l=await new RE((b,A)=>{const k=new FileReader;k.onload=j=>{j.target?b(j.target.result):A(new ga(Di.READ_LOCAL_AUDIO_FILE_ERROR))},k.onerror=()=>{A(new ga(Di.READ_LOCAL_AUDIO_FILE_ERROR))},k.readAsArrayBuffer(o)});const p=await function(_){const b=wI();return new RE((A,k)=>{b.decodeAudioData(_,j=>{A(j)},j=>{k(new ga(Di.DECODE_AUDIO_FILE_FAILED,j.toString()))})})}(l);return typeof o=="string"&&s&&B6.set(o,p),p}function G6(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function cN(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?G6(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):G6(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}function ZL(o,s,l,p){l.optimizationMode&&(p&&p.width&&p.height?(l.encoderConfig=cN(cN({},p),{},{bitrateMin:p.bitrateMin,bitrateMax:p.bitrateMax}),l.optimizationMode!=="motion"&&l.optimizationMode!=="detail"||(s.contentHint=l.optimizationMode,s.contentHint===l.optimizationMode?_n.debug("[".concat(o,"] set content hint to"),l.optimizationMode):_n.debug("[".concat(o,"] set content hint failed")))):_n.warning("[".concat(o,"] can not apply optimization mode bitrate config, no encoderConfig")))}const g$=r_().name;function v$(o,s,l,p){let _,b=0,A=null;return new RE((k,j)=>{setTimeout(()=>{_&&(_(),k(b))},s),_=MV(()=>{(function(){b>p&&_&&(_(),k(b));const z=l.getContext("2d");if(!z){const ue=new ga(Di.UNEXPECTED_ERROR,"can not get canvas 2d context.");return _n.error(ue.toString()),void j(ue)}z.drawImage(o,0,0,160,120);const H=z.getImageData(0,0,l.width,l.height),$=Math.floor(H.data.length/3);if(A){for(let ue=0;ue<$;ue+=3)if(H.data[ue]!==A[ue])return b+=1,void(A=H.data);A=H.data}else A=H.data})()},30)})}class w0{constructor(s,l){_t(this,"id",0),_t(this,"element",void 0),_t(this,"peerPair",void 0),_t(this,"context",void 0),_t(this,"audioPlayerElement",void 0),_t(this,"audioTrack",void 0),w0.count+=1,this.id=w0.count,this.element=s,this.context=l}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=s=>{const l=document.createElement("audio");l.srcObject=new MediaStream([s.track]),l.play(),this.audioPlayerElement=l}}async switchSdp(){if(!this.peerPair)return;const s=async(p,_)=>{const b=_==="offer"?await p.createOffer():await p.createAnswer();return await p.setLocalDescription(b),p.iceGatheringState==="complete"?p.localDescription:new RE(A=>{p.onicegatheringstatechange=()=>{p.iceGatheringState==="complete"&&A(p.localDescription)}})},l=async(p,_)=>await p.setRemoteDescription(_);try{const p=await s(this.peerPair[0],"offer");await l(this.peerPair[1],p);const _=await s(this.peerPair[1],"answer");await l(this.peerPair[0],_)}catch(p){throw new ga(Di.LOCAL_AEC_ERROR,p.toString()).print()}}async getTracksFromMediaElement(s){if(this.audioTrack)return this.audioTrack;let l;try{s instanceof HTMLVideoElement&&(s.captureStream?s.captureStream():s.mozCaptureStream()),l=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(s).connect(l)}catch(_){throw new ga(Di.LOCAL_AEC_ERROR,_.toString()).print()}if(!l)throw new ga(Di.LOCAL_AEC_ERROR,"no dest node when local aec").print();const p=l.stream.getAudioTracks()[0];return this.audioTrack=p,p}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const s=this.element,l=await this.getTracksFromMediaElement(s);this.peerPair&&this.peerPair[0].addTrack(l),await this.switchSdp()}close(){_n.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(s=>{s.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var q6,uN;_t(w0,"count",0);const y$=window.AudioContext||window.webkitAudioContext,b$=new(q6=kE({report:wE}),oE((uN=class{constructor(){_t(this,"units",[]),_t(this,"context",void 0)}processExternalMediaAEC(o){if(!this._doesEnvironmentNeedAEC())return _n.debug("the system does not need to process local aec"),-1;this.context||(this.context=new y$);let s=this.units.find(l=>l&&l.getElement()===o);return s||(s=new w0(o,this.context),this.units.push(s)),s.startEchoCancellation(),_n.debug("start processing local audio echo cancellation, id is",s.id),s.id}_doesEnvironmentNeedAEC(){return r_().name!==c_.SAFARI}}).prototype,"processExternalMediaAEC",[q6],Object.getOwnPropertyDescriptor(uN.prototype,"processExternalMediaAEC"),uN.prototype),uN);function W6(o,s){var l=Object.keys(o);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(o);s&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(o,_).enumerable})),l.push.apply(l,p)}return l}function K6(o){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?arguments[s]:{};s%2?W6(Object(l),!0).forEach(function(p){_t(o,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(l)):W6(Object(l)).forEach(function(p){Object.defineProperty(o,p,Object.getOwnPropertyDescriptor(l,p))})}return o}const t1=window||document;function H6(o){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!t1)return;const l=Q_._cspEventHandlerPointer;if(l&&s)return void console.error(l,s);const p=_=>{if(!(_&&_.blockedURI&&(Q_.onSecurityPolicyViolation||Q_.getListeners(OS.SECURITY_POLICY_VIOLATION).length>0)))return;const b=_.blockedURI;_u("CSP_DETECTED_HOSTNAME_LIST").some(A=>b.includes(A))&&(Q_.onSecurityPolicyViolation&&typeof Q_.onSecurityPolicyViolation=="function"&&Q_.onSecurityPolicyViolation(_),Q_.getListeners(OS.SECURITY_POLICY_VIOLATION).length>0&&Q_.safeEmit(OS.SECURITY_POLICY_VIOLATION,_))};l&&t1.removeEventListener("securitypolicyviolation",l),(s||o&&typeof o=="function"||Q_.getListeners(OS.SECURITY_POLICY_VIOLATION).length>0)&&t1.addEventListener("securitypolicyviolation",p),Q_._cspEventHandlerPointer=p}p_("PROCESS_ID","process-".concat(y_(8,""),"-").concat(y_(4,""),"-").concat(y_(4,""),"-").concat(y_(4,""),"-").concat(y_(12,""))),function(){const o=r_();lT.getDisplayMedia=function(s){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),lT.getStreamFromExtension=o.name===c_.CHROME&&Number(o.version)>34,lT.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const s=new RTCPeerConnection;let l=!1;try{s.addTransceiver("audio"),l=!0}catch{}return s.close(),l}(),lT.supportMinBitrate=o.name===c_.CHROME||o.name===c_.EDGE,lT.supportSetRtpSenderParameters=function(){const s=r_();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!xR()||!(!fT()&&!mO())||s.name===c_.FIREFOX&&Number(s.version)>=64}(),o.name===c_.SAFARI&&(Number(o.version)>=14?lT.supportDualStream=!0:lT.supportDualStream=!1),lT.webAudioMediaStreamDest=function(){const s=r_();return!(s.name===c_.SAFARI&&Number(s.version)<12)}(),lT.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),lT.supportWebGL=typeof WebGLRenderingContext<"u",lT.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,xR()||(lT.webAudioWithAEC=!0),lT.supportShareAudio=function(){const s=r_();return(s.os===tT.WIN_10||s.os===tT.WIN_81||s.os===tT.WIN_7||s.os===tT.LINUX||s.os===tT.MAC_OS)&&s.name===c_.CHROME&&Number(s.version)>=74}(),lT.supportDualStreamEncoding=function(){const s=r_();return _u("DISABLE_WEBAUDIO")?!0:s.name==="Safari"&&Number(s.version)>=14||!!(s.name==="Chrome"&&/Windows/i.test(s.os||"")&&Number(s.version)>=100&&_u("CHROME_DUAL_STREAM_USE_ENCODING"))}(),lT.supportDataChannel=function(){return!!(VP(76)||function(s){const l=r_();return!(l.name!==c_.FIREFOX||!l.osVersion)&&Number(l.version)>=s}(68)||function(s){const l=r_();return!(l.name!==c_.SAFARI||!l.osVersion)&&Number(l.version)>=s}(14))}(),lT.supportPCSetConfiguration=function(){const s=window.RTCPeerConnection;return!O_()&&!!s&&s.prototype.setConfiguration instanceof Function}(),lT.supportWebRTCEncodedTransform=function(){const s=r_();return s.name==="Chrome"&&Number(s.version)>=86}(),_n.info("browser compatibility",JSON.stringify(lT),JSON.stringify(o))}(),function(){let o;try{o=window.localStorage.getItem("websdk_ng_global_parameter")}catch(s){return void _n.error("Error loading sdk config",s.message)}if(o)try{const s=JSON.parse(window.atob(o)),l=Date.now();_n.debug("Loading global parameters from cache",s),Object.keys(s).forEach(p=>{if(Object.prototype.hasOwnProperty.call(IT,p)){const{value:_,expires:b}=s[p];if(b&&b<=l)return;FR[p]=_,IT[p]=_}})}catch(s){_n.error("Error loading mutableParamsCache: ".concat(o),s.message)}}(),Array.isArray(FR.AREAS)&&FR.AREAS.length>0&&dL(FR.AREAS,!0);const Q_=function(o){const s=new R_,l=o,p={getListeners:s.getListeners.bind(s),on:(_,b)=>(function(A,k){A===OS.SECURITY_POLICY_VIOLATION&&H6(k,!0)}(_,b),s.on.bind(s)(_,b)),addListener:s.addListener.bind(s),once:s.once.bind(s),off:s.off.bind(s),removeAllListeners:s.removeAllListeners.bind(s),emit:s.emit.bind(s),safeEmit:s.safeEmit.bind(s)};return K6(K6({},l),p)}({__CLIENT_LIST__:BR,__TRACK_LIST__:s0,VERSION:ZT,BUILD:_D,setParameter:(o,s,l)=>{_n.debug("setParameter key:".concat(o,", value:").concat(JSON.stringify(s))),p_(o,s,l)},getParameter:_u,getSupportedCodec:async function(){let o={audio:[],video:[]};try{let s=new RTCPeerConnection;s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const l=(await s.createOffer()).sdp;if(!l)return o;s.close(),s=null,o=function(p){const _={video:[],audio:[]};return p.match(/ VP8/i)&&_.video.push("VP8"),p.match(/ VP9/i)&&_.video.push("VP9"),p.match(/ AV1/i)&&_.video.push("AV1"),p.match(/ H264/i)&&_.video.push("H264"),p.match(/ H265/i)&&_.video.push("H265"),p.match(/ opus/i)&&_.audio.push("OPUS"),p.match(/ PCMU/i)&&_.audio.push("PCMU"),p.match(/ PCMA/i)&&_.audio.push("PCMA"),p.match(/ G722/i)&&_.audio.push("G722"),_}(l)}catch(s){throw new ga(Di.CREATE_OFFER_FAILED,s.toString&&s.toString()).print()}return o},checkSystemRequirements:function(){const o=wE.reportApiInvoke(null,{name:j_.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:T_.TRACER});let s=!1;try{const b=window.RTCPeerConnection,A=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,k=window.WebSocket;s=!!(b&&A&&k)}catch(b){return _n.error("check system requirement failed: ",b),!1}let l=!1;const p=r_();p.name===c_.CHROME&&Number(p.version)>=58&&(!OJ()||IJ())&&(l=!0),p.name===c_.FIREFOX&&Number(p.version)>=56&&(l=!0),p.name===c_.OPERA&&Number(p.version)>=45&&(l=!0),p.name===c_.SAFARI&&Number(p.version)>=11&&(l=!0),(u2()||r_().name===c_.QQ)&&(l=!0),_n.debug("checkSystemRequirements, api:",s,"browser",l);const _=s&&l;return o.onSuccess(_),_},getDevices:function(o){return YT.enumerateDevices(!0,!0,o)},getMicrophones:function(o){return YT.getRecordingDevices(o)},getCameras:function(o){return YT.getCamerasDevices(o)},getElectronScreenSources:VV,getPlaybackDevices:function(o){return YT.getSpeakers(o)},createClient:function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=wE.reportApiInvoke(null,{name:j_.CREATE_CLIENT,options:[o],tag:T_.TRACER});try{e9(o)}catch(l){throw s.onError(l),l}return o.audioCodec===void 0&&(o.audioCodec="opus"),s.onSuccess(),new E$(A0(A0({forceWaitGatewayResponse:!0},o),{},{role:o.mode==="rtc"?"host":o.role||"audience"}))},createCameraVideoTrack:async function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s=wE.reportApiInvoke(null,{tag:T_.TRACER,name:j_.CREATE_CAM_VIDEO_TRACK,options:[cN({},o)]}),l=YO(o),p=y_(8,"track-cam-");let _=null;_n.info("start create camera video track with config",JSON.stringify(o),"trackId",p);try{_=(await pS({video:l},p)).getVideoTracks()[0]||null}catch(A){throw s.onError(A),A}if(!_){const A=new ga(Di.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(A),A.throw()}o.optimizationMode&&ZL(p,_,o,VR(o.encoderConfig));const b=new aG(_,o,l,o.scalabiltyMode?wO(o.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},o.optimizationMode,p);return s.onSuccess(b.getTrackId()),_n.info("create camera video success, trackId:",p),b},createCustomVideoTrack:function(o){const s=wE.reportApiInvoke(null,{tag:T_.TRACER,name:j_.CREATE_CUSTOM_VIDEO_TRACK,options:[o]}),l=new G_(o.mediaStreamTrack,{width:o.width,height:o.height,frameRate:o.frameRate,bitrateMax:o.bitrateMax,bitrateMin:o.bitrateMin},o.scalabiltyMode?wO(o.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},o.optimizationMode,y_(8,"track-cus-"),[J_.CUSTOM_TRACK]);return s.onSuccess(l.getTrackId()),_n.info("create custom video track success with config",o,"trackId",l.getTrackId()),l},createScreenVideoTrack:async function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const l=wE.reportApiInvoke(null,{tag:T_.TRACER,name:j_.CREATE_SCREEN_VIDEO_TRACK,options:[cN({},o),s]});o.encoderConfig?typeof o.encoderConfig=="string"||o.encoderConfig.width&&o.encoderConfig.height||(o.encoderConfig.width={max:1920},o.encoderConfig.height={max:1080}):o.encoderConfig="1080p_2";const p=KX(o),_=y_(8,"track-scr-v-");let b=null,A=null;const k=L_();if(!k.supportShareAudio&&s==="enable"){const H=new ga(Di.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return l.onError(H),H.throw()}_n.info("start create screen video track with config",o,"withAudio",s,"trackId",_);try{const H=await pS({screen:p,screenAudio:s==="auto"?k.supportShareAudio:s==="enable"},_);b=H.getVideoTracks()[0]||null,A=H.getAudioTracks()[0]||null}catch(H){throw l.onError(H),H}if(!b){const H=new ga(Di.UNEXPECTED_ERROR,"can not find track in media stream");return l.onError(H),H.throw()}if(!A&&s==="enable"){b&&b.stop();const H=new ga(Di.SHARE_AUDIO_NOT_ALLOWED);return l.onError(H),H.throw()}o.optimizationMode||(o.optimizationMode="detail"),o.optimizationMode&&(ZL(_,b,o,o.encoderConfig&&yD(o.encoderConfig)),o.encoderConfig&&typeof o.encoderConfig!="string"&&(o.encoderConfig.bitrateMin=o.encoderConfig.bitrateMax));const j=new G_(b,o.encoderConfig?yD(o.encoderConfig):{},o.scalabiltyMode?wO(o.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},o.optimizationMode,_,[J_.SCREEN_TRACK]);if(!A)return l.onSuccess(j.getTrackId()),_n.info("create screen video track success","video:",j.getTrackId()),j;const z=new sT(A,void 0,y_(8,"track-scr-a-"),!1,!0);return l.onSuccess([j.getTrackId(),z.getTrackId()]),_n.info("create screen video track success","video:",j.getTrackId(),"audio:",z.getTrackId()),[j,z]},createMicrophoneAndCameraTracks:async function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const l=wE.reportApiInvoke(null,{tag:T_.TRACER,name:j_.CREATE_MIC_AND_CAM_TRACKS,options:[o,s]}),p=YO(s),_=A3(o),b=y_(8,"track-mic-"),A=y_(8,"track-cam-");let k=null,j=null;_n.info("start create camera video track(".concat(A,") and microphone audio track(").concat(b,") with config, audio: ").concat(JSON.stringify(o),", video: ").concat(JSON.stringify(s)));try{const $=await pS({audio:_,video:p},"".concat(b,"-").concat(A));k=$.getAudioTracks()[0],j=$.getVideoTracks()[0]}catch($){throw l.onError($),$}if(!k||!j){const $=new ga(Di.UNEXPECTED_ERROR,"can not find tracks in media stream");return l.onError($),$.throw()}s.optimizationMode&&ZL(A,j,s,VR(s.encoderConfig));const z=new jO(k,o,_,b),H=new aG(j,s,p,s.scalabiltyMode?wO(s.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},s.optimizationMode,A);return l.onSuccess([z.getTrackId(),H.getTrackId()]),_n.info("create camera video track(".concat(A,") and microphone audio track(").concat(b,") success")),[z,H]},createMicrophoneAudioTrack:async function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s=wE.reportApiInvoke(null,{tag:T_.TRACER,name:j_.CREATE_MIC_AUDIO_TRACK,options:[o]}),l=A3(o),p=y_(8,"track-mic-");let _=null;_n.info("start create microphone audio track with config",JSON.stringify(o),"trackId",p);try{_=(await pS({audio:l},p)).getAudioTracks()[0]||null}catch(A){throw s.onError(A),A}if(!_){const A=new ga(Di.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(A),A.throw()}const b=new jO(_,o,l,p);return s.onSuccess(b.getTrackId()),_n.info("create microphone audio track success, trackId:",p),b},createCustomAudioTrack:function(o){const s=wE.reportApiInvoke(null,{tag:T_.TRACER,name:j_.CREATE_CUSTOM_AUDIO_TRACK,options:[o]}),l=new sT(o.mediaStreamTrack,o.encoderConfig?CO(o.encoderConfig):{},y_(8,"track-cus-"),!1,!0);return _n.info("create custom audio track success with config",o,"trackId",l.getTrackId()),s.onSuccess(l.getTrackId()),l},createBufferSourceAudioTrack:async function(o){const s=wE.reportApiInvoke(null,{tag:T_.TRACER,name:j_.CREATE_BUFFER_AUDIO_TRACK,options:[o]});if(_u("DISABLE_WEBAUDIO"))throw new ga(Di.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const l=y_(8,"track-buf-");_n.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",l);const p=o.source;if(!(o.source instanceof AudioBuffer))try{o.source=await _$(o.source,o.cacheOnlineFile)}catch(A){return s.onError(A),A.throw()}const _=new m$(o.source),b=new TX(p,_,o.encoderConfig?CO(o.encoderConfig):{},l);return _n.info("create buffer source audio track success, trackId:",l),s.onSuccess(b.getTrackId()),b},setAppType:function(o){if(_n.debug("setAppType: ".concat(o)),!(Number.isInteger(o)&&o>=0))throw _n.debug("Invalid appType"),new ga(Di.INVALID_PARAMS,"invalid app type",o);p_("APP_TYPE",Math.floor(o))},setLogLevel:function(o){_n.setLogLevel(o)},enableLogUpload:function(){_u("USE_NEW_LOG")?p_("UPLOAD_LOG",!0):_n.enableLogUpload()},disableLogUpload:function(){_u("USE_NEW_LOG")?p_("UPLOAD_LOG",!1):_n.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new y3},checkAudioTrackIsActive:async function(o){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const l=wE.reportApiInvoke(null,{tag:T_.TRACER,name:j_.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[s]});if(!(o instanceof sT||o instanceof nN)){const j=new ga(Di.INVALID_TRACK,"the parameter is not a audio track");return l.onError(j),j.throw()}s&&s<1e3&&(s=1e3);const p=o instanceof sT?o.getTrackLabel():"remote_track",_=o.getVolumeLevel();let b=_,A=_;const k=Date.now();return new RE(j=>{const z=setInterval(()=>{const H=o.getVolumeLevel();b=H>b?H:b,A=H<A?H:A;const $=b-A>1e-4,ue=Date.now()-k;if($||ue>s){clearInterval(z);const Ei=$,Fi={duration:ue,deviceLabel:p,maxVolumeLevel:b,result:Ei};_n.info("[track-".concat(o.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(Fi))),l.onSuccess(Fi),j(Ei)}},200)})},checkVideoTrackIsActive:async function(o){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const l=wE.reportApiInvoke(null,{tag:T_.TRACER,name:j_.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[s]});if(!(o instanceof G_||o instanceof eN)){const ue=new ga(Di.INVALID_TRACK,"the parameter is not a video track");return l.onError(ue),ue.throw()}const p=4;s&&s<1e3&&(s=1e3);const _=o instanceof G_?o.getTrackLabel():"remote_track",b=o.getMediaStreamTrack(!0),A=document.createElement("video");A.style.width="1px",A.style.height="1px",A.setAttribute("muted",""),A.muted=!0,A.setAttribute("playsinline",""),A.controls=!1,(fT()||mO())&&(A.style.opacity="0.01",A.style.position="fixed",A.style.left="0",A.style.top="0",document.body.appendChild(A)),A.srcObject=new MediaStream([b]),A.play();const k=document.createElement("canvas");k.width=160,k.height=120;let j=0,z=0;try{const ue=Date.now();j=await v$(A,s,k,p),z=Date.now()-ue}catch(ue){throw l.onError(ue),ue}g$===c_.SAFARI&&(A.pause(),A.remove()),A.srcObject=null;const H=j>p,$={duration:z,changedPicNum:j,deviceLabel:_,result:H};return _n.info("[track-".concat(o.getTrackId(),"] check video track active completed. ").concat(JSON.stringify($))),l.onSuccess($),H},setArea:dL,audioElementPlayCenter:MT,processExternalMediaAEC:function(o){b$.processExternalMediaAEC(o)},registerExtensions:function(o){o.forEach(s=>{const l=s;l.__registered__=!0,l.logger.hookLog=_n.extLog,l.reporter.hookApiInvoke=wE.extApiInvoke,l.parameters&&Object.keys(l.parameters).forEach(p=>{l.parameters[p]=_u(p)})})},ChannelMediaRelayError:pR,ChannelMediaRelayEvent:RS,ChannelMediaRelayState:_T,RemoteStreamFallbackType:BD,RemoteStreamType:FD,ConnectionDisconnectedReason:i_,AudienceLatencyLevelType:LD,AREAS:XE});return Object.defineProperties(Q_,{onAudioAutoplayFailed:{get:()=>KT.onAudioAutoplayFailed,set:o=>{KT.onAudioAutoplayFailed=o}},onAutoplayFailed:{get:()=>KT.onAutoplayFailed,set:o=>{KT.onAutoplayFailed=o}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Q_._onSecurityPolicyViolation,set(o){Q_._onSecurityPolicyViolation=o,H6(o)}}}),YT.on(XS.CAMERA_DEVICE_CHANGED,o=>{_n.info("camera device changed",JSON.stringify(o)),Q_.onCameraChanged&&Q_.onCameraChanged(o),Q_.safeEmit(OS.CAMERA_CHANGED,o)}),YT.on(XS.RECORDING_DEVICE_CHANGED,o=>{_n.info("microphone device changed",JSON.stringify(o)),Q_.onMicrophoneChanged&&Q_.onMicrophoneChanged(o),Q_.safeEmit(OS.MICROPHONE_CHANGED,o)}),YT.on(XS.PLAYOUT_DEVICE_CHANGED,o=>{_n.debug("playout device changed",JSON.stringify(o)),Q_.onPlaybackDeviceChanged&&Q_.onPlaybackDeviceChanged(o),Q_.safeEmit(OS.PLAYBACK_DEVICE_CHANGED,o)}),MT.onAutoplayFailed=()=>{_n.info("detect audio element autoplay failed"),KT.onAudioAutoplayFailed&&KT.onAudioAutoplayFailed()},o_.on("autoplay-failed",()=>{_n.info("detect webaudio autoplay failed"),KT.onAudioAutoplayFailed&&KT.onAudioAutoplayFailed(),Q_.safeEmit(OS.AUTOPLAY_FAILED)}),window&&(window.__ARTC__=Q_),Q_})})(AgoraRTC_NProduction);var AgoraRTC_NProductionExports=AgoraRTC_NProduction.exports;const AgoraRTC__default=getDefaultExportFromCjs(AgoraRTC_NProductionExports);function _objectWithoutPropertiesLoose(r,e){if(r==null)return{};var d={},h=Object.keys(r),f,g;for(g=0;g<h.length;g++)f=h[g],!(e.indexOf(f)>=0)&&(d[f]=r[f]);return d}var AgoraRTCErrorCode;(function(r){r.UNEXPECTED_ERROR="UNEXPECTED_ERROR",r.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",r.TIMEOUT="TIMEOUT",r.INVALID_PARAMS="INVALID_PARAMS",r.NOT_SUPPORTED="NOT_SUPPORTED",r.INVALID_OPERATION="INVALID_OPERATION",r.OPERATION_ABORTED="OPERATION_ABORTED",r.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",r.NETWORK_ERROR="NETWORK_ERROR",r.NETWORK_TIMEOUT="NETWORK_TIMEOUT",r.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",r.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",r.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",r.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",r.ELECTRON_IS_NULL="ELECTRON_IS_NULL",r.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",r.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",r.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",r.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",r.TRACK_IS_DISABLED="TRACK_IS_DISABLED",r.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",r.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",r.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",r.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",r.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",r.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",r.UID_CONFLICT="UID_CONFLICT",r.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",r.INVALID_TRACK="INVALID_TRACK",r.SENDER_NOT_FOUND="SENDER_NOT_FOUND",r.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",r.SET_ANSWER_FAILED="SET_ANSWER_FAILED",r.ICE_FAILED="ICE_FAILED",r.PC_CLOSED="PC_CLOSED",r.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",r.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",r.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",r.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",r.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",r.INVALID_REMOTE_USER="INVALID_REMOTE_USER",r.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",r.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",r.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",r.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",r.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",r.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",r.WS_ABORT="WS_ABORT",r.WS_DISCONNECT="WS_DISCONNECT",r.WS_ERR="WS_ERR",r.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",r.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",r.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",r.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",r.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",r.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",r.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",r.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",r.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",r.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",r.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",r.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",r.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",r.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",r.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",r.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",r.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",r.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"})(AgoraRTCErrorCode||(AgoraRTCErrorCode={}));var createClient$1=function(e){var d;function h(){return d||(d=AgoraRTC__default.createClient(e)),d}return function(){return h()}};function createMicrophoneAndCameraTracks(r,e){var d=function(){try{return Promise.resolve(AgoraRTC__default.createMicrophoneAndCameraTracks(r,e)).then(function(g){return h=g,h})}catch(g){return Promise.reject(g)}},h=null;return function(){var g=reactExports.useState(!1),C=g[0],P=g[1],x=reactExports.useState(null),B=x[0],Vt=x[1],_r=reactExports.useRef(h);return reactExports.useEffect(function(){return _r.current===null?d().then(function(_e){_r.current=_e,P(!0)},function(_e){Vt(_e)}):P(!0),function(){h=null}},[]),{ready:C,tracks:_r.current,error:B}}}var AgoraVideoPlayer=function(e){var d=reactExports.useRef(null),h=e.videoTrack,f=e.config,g=_objectWithoutPropertiesLoose(e,["videoTrack","config"]);return reactExports.useLayoutEffect(function(){return d.current!==null&&h.play(d.current,f),function(){h.stop()}},[h]),React.createElement("div",Object.assign({},g,{ref:d}))},agoraRtmSdk={exports:{}};/*
 @preserve
 AgoraRTM Web SDK 1.4.3-203 - commit: v1.4.3-17-g1e27aa38
 Copyright (C) 2018-2021 Agora Lab.
 This file is licensed under the AGORA, INC. SDK LICENSE AGREEMENT
 A copy of this license may be found at https://www.agora.io/en/sdk-license-agreement/
*/agoraRtmSdk.exports;(function(module,exports){(function(r,e){module.exports=e()})(commonjsGlobal,function(){function be(r,e){var d=Object.keys(r);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(r);e&&(h=h.filter(function(f){return Object.getOwnPropertyDescriptor(r,f).enumerable})),d.push.apply(d,h)}return d}function ua(r){for(var e=1;e<arguments.length;e++){var d=arguments[e]!=null?arguments[e]:{};e%2?be(Object(d),!0).forEach(function(h){m(r,h,d[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(d)):be(Object(d)).forEach(function(h){Object.defineProperty(r,h,Object.getOwnPropertyDescriptor(d,h))})}return r}function X(r){return(X=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(r)}function sl(r,e,d,h,f,g,C){try{var P=r[g](C),x=P.value}catch(B){return void d(B)}P.done?e(x):Promise.resolve(x).then(h,f)}function J(r){return function(){var e=this,d=arguments;return new Promise(function(h,f){function g(x){sl(P,h,f,g,C,"next",x)}function C(x){sl(P,h,f,g,C,"throw",x)}var P=r.apply(e,d);g(void 0)})}}function W(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function tl(r,e){for(var d=0;d<e.length;d++){var h=e[d];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(r,h.key,h)}}function Ha(r,e,d){return e&&tl(r.prototype,e),d&&tl(r,d),r}function m(r,e,d){return e in r?Object.defineProperty(r,e,{value:d,enumerable:!0,configurable:!0,writable:!0}):r[e]=d,r}function la(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),e&&df(r,e)}function wd(r){return(wd=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(r)}function df(r,e){return(df=Object.setPrototypeOf||function(d,h){return d.__proto__=h,d})(r,e)}function ul(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Sh(r,e,d){return(Sh=ul()?Reflect.construct:function(h,f,g){var C=[null];return C.push.apply(C,f),h=new(Function.bind.apply(h,C)),g&&df(h,g.prototype),h}).apply(null,arguments)}function ef(r){var e=typeof Map=="function"?new Map:void 0;return(ef=function(d){function h(){return Sh(d,arguments,wd(this).constructor)}if(d===null||Function.toString.call(d).indexOf("[native code]")===-1)return d;if(typeof d!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(d))return e.get(d);e.set(d,h)}return h.prototype=Object.create(d.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),df(h,d)})(r)}function ff(r,e){if(r==null)return{};if(r==null)var d={};else{d={};var h,f=Object.keys(r);for(h=0;h<f.length;h++){var g=f[h];0<=e.indexOf(g)||(d[g]=r[g])}}if(Object.getOwnPropertySymbols)for(h=Object.getOwnPropertySymbols(r),g=0;g<h.length;g++)f=h[g],0<=e.indexOf(f)||Object.prototype.propertyIsEnumerable.call(r,f)&&(d[f]=r[f]);return d}function n(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function ma(r){var e=ul();return function(){var d=wd(r);if(e){var h=wd(this).constructor;d=Reflect.construct(d,arguments,h)}else d=d.apply(this,arguments);return d=!d||typeof d!="object"&&typeof d!="function"?n(this):d}}function Th(r,e,d){return(Th=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(h,f,g){for(;!Object.prototype.hasOwnProperty.call(h,f)&&(h=wd(h))!==null;);if(h)return(f=Object.getOwnPropertyDescriptor(h,f)).get?f.get.call(g):f.value})(r,e,d||r)}function ra(r,e){var d=Array.isArray(r)?r:void 0;if(!d)if((d=r&&(typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"]))==null)d=void 0;else{var h,f=[],g=!0,C=!1;try{for(d=d.call(r);!(g=(h=d.next()).done)&&(f.push(h.value),!e||f.length!==e);g=!0);}catch(x){C=!0;var P=x}finally{try{g||d.return==null||d.return()}finally{if(C)throw P}}d=f}if(!(r=d||vl(r,e)))throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return r}function G(r){var e=Array.isArray(r)?Uh(r):void 0;if(e||(e=typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null?Array.from(r):void 0),!(r=e||vl(r)))throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return r}function vl(r,e){if(r){if(typeof r=="string")return Uh(r,e);var d=Object.prototype.toString.call(r).slice(8,-1);if(d==="Object"&&r.constructor&&(d=r.constructor.name),d==="Map"||d==="Set")return Array.from(r);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return Uh(r,e)}}function Uh(r,e){(e==null||e>r.length)&&(e=r.length);for(var d=0,h=Array(e);d<e;d++)h[d]=r[d];return h}function fa(r,e,d,h,f){var g={};return Object.keys(h).forEach(function(C){g[C]=h[C]}),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=d.slice().reverse().reduce(function(C,P){return P(r,e,C)||C},g),f&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(f):void 0,g.initializer=void 0),g.initializer===void 0&&(Object.defineProperty(r,e,g),g=null),g}function $a(r){var e={exports:{}};return r(e,e.exports),e.exports}function wl(r,e){var d,h=3>arguments.length?r:arguments[2];return va(r)===h?r[e]:(d=Fb.f(r,e))?Q(d,"value")?d.value:d.get===void 0?void 0:d.get.call(h):ha(d=Vb(r))?wl(d,e,h):void 0}function rs(r){var e=r.charCodeAt(0)<<24,d=0|ss(~e),h=0,f=0|r.length,g="";if(5>d&&f>=d){for(e=e<<d>>>24+d,h=1;h<d;h=h+1|0)e=e<<6|63&r.charCodeAt(h);65535>=e?g+=xd(e):1114111>=e?g+=xd(55296+((e=e-65536|0)>>10)|0,56320+(1023&e)|0):h=0}for(;h<f;h=h+1|0)g+="ï¿½";return g}function xl(){}function ts(r){var e=0|r.charCodeAt(0);if(55296<=e&&56319>=e){var d=0|r.charCodeAt(1);if(!(d==d&&56320<=d&&57343>=d))return xd(239,191,189);if(65535<(e=(e-55296<<10)+d-56320+65536|0))return xd(240|e>>>18,128|e>>>12&63,128|e>>>6&63,128|63&e)}return 127>=e?r:2047>=e?xd(192|e>>>6,128|63&e):xd(224|e>>>12,128|e>>>6&63,128|63&e)}function yl(){}function ea(){ea.init.call(this)}function ng(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+X(r))}function zl(r,e,d,h){ng(d);var f=r._events;if(f===void 0)f=r._events=Object.create(null),r._eventsCount=0;else{f.newListener!==void 0&&(r.emit("newListener",e,d.listener?d.listener:d),f=r._events);var g=f[e]}return g===void 0?(f[e]=d,++r._eventsCount):(typeof g=="function"?g=f[e]=h?[d,g]:[g,d]:h?g.unshift(d):g.push(d),0<(d=r._maxListeners===void 0?ea.defaultMaxListeners:r._maxListeners)&&g.length>d&&!g.warned&&(g.warned=!0,(d=Error("Possible EventEmitter memory leak detected. "+g.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",d.emitter=r,d.type=e,d.count=g.length,console&&console.warn&&console.warn(d))),r}function us(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Al(r,e,d){return r={fired:!1,wrapFn:void 0,target:r,type:e,listener:d},(e=us.bind(r)).listener=d,r.wrapFn=e}function Bl(r,e,d){if((r=r._events)===void 0)return[];if((e=r[e])===void 0)return[];if(typeof e=="function")return d?[e.listener||e]:[e];if(d)for(d=Array(e.length),r=0;r<d.length;++r)d[r]=e[r].listener||e[r];else d=Cl(e,e.length);return d}function Dl(r){var e=this._events;if(e!==void 0){if(typeof(r=e[r])=="function")return 1;if(r!==void 0)return r.length}return 0}function Cl(r,e){for(var d=Array(e),h=0;h<e;++h)d[h]=r[h];return d}function vs(r,e,d){typeof r.on=="function"&&El(r,"error",e,d)}function El(r,e,d,h){if(typeof r.on=="function")h.once?r.once(e,d):r.on(e,d);else{if(typeof r.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+X(r));r.addEventListener(e,function f(g){h.once&&r.removeEventListener(e,f),d(g)})}}function ws(r){return r?G(r):xs(function(){return[]},function(e,d){return e.push(d),e})}function Fl(r,e){var d,h,f,g;return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:d=Gl(r)([Hl,Hl,function(P,x){return x}])[2],h=0;case 2:if(!(h<e.length)){C.next=17;break}if(f=e[h],!((g=d(Vh,f))instanceof og)){C.next=11;break}if((g=Wh(g.deref()))===Vh){C.next=10;break}return C.next=10,g;case 10:return C.abrupt("return");case 11:if(g===Vh){C.next=14;break}return C.next=14,g;case 14:h++,C.next=2;break;case 17:case"end":return C.stop()}},ys)}function pg(r,e){return e!=null&&typeof e[Symbol.iterator]=="function"?Fl(pg(r),e):function(d){var h=d[2];return zs(d,function(f,g){return h(f,r(g))})}}function Ac(r){return Object.prototype.toString.call(r).slice(8,-1)}function yd(r){return Ac(r)==="Object"&&r.constructor===Object&&Object.getPrototypeOf(r)===Object.prototype}function Il(r){var e;return(e=Ac(r)==="Boolean"||Ac(r)==="Null"||Ac(r)==="Undefined")||(e=Ac(r)==="Number"&&!isNaN(r)),e||Ac(r)==="String"||Ac(r)==="Symbol"}function zd(r){var e=-1,d=r==null?0:r.length;for(this.clear();++e<d;){var h=r[e];this.set(h[0],h[1])}}function ce(r){var e=-1,d=r==null?0:r.length;for(this.clear();++e<d;){var h=r[e];this.set(h[0],h[1])}}function de(r){var e=-1,d=r==null?0:r.length;for(this.clear();++e<d;){var h=r[e];this.set(h[0],h[1])}}function gf(r){var e=-1,d=r==null?0:r.length;for(this.__data__=new qg;++e<d;)this.add(r[e])}function ee(r){this.size=(this.__data__=new rg(r)).size}function fe(r,e,d,h,f,g){var C,P=1&e,x=2&e,B=4&e;if(d&&(C=f?d(r,h,f,g):d(r)),C!==void 0)return C;if(!lb(r))return r;if(h=Va(r)){if(C=As(r),!P)return Xh(r,C)}else{var Vt=hf(r),_r=Vt=="[object Function]"||Vt=="[object GeneratorFunction]";if(jf(r))return Jl(r,P);if(Vt=="[object Object]"||Vt=="[object Arguments]"||_r&&!f){if(C=x||_r?{}:Kl(r),!P)return x?Bs(r,Cs(C,r)):Ds(r,Es(C,r))}else{if(!wa[Vt])return f?r:{};C=Fs(r,Vt,P)}}if(g||(g=new ge),f=g.get(r))return f;g.set(r,C),Gs(r)?r.forEach(function(_i){C.add(fe(_i,e,d,_i,r,g))}):Hs(r)&&r.forEach(function(_i,_a){C.set(_a,fe(_i,e,d,_a,r,g))}),x=B?x?Ll:Yh:x?kf:Ad;var _e=h?void 0:x(r);return Is(_e||r,function(_i,_a){_e&&(_i=r[_a=_i]),Ml(C,_a,fe(_i,e,d,_a,r,g))}),C}function Zh(r,e){if(typeof r!="function"||e!=null&&typeof e!="function")throw new TypeError("Expected a function");var d=function h(){var f=arguments,g=e?e.apply(this,f):f[0],C=h.cache;return C.has(g)?C.get(g):(f=r.apply(this,f),h.cache=C.set(g,f)||C,f)};return d.cache=new(Zh.Cache||qg),d}function Nl(r){if(typeof r=="string")return r;if(Va(r))return he(r,Nl)+"";if(ie(r))return Ol?Ol.call(r):"";var e=r+"";return e=="0"&&1/r==-Js?"-0":e}function $h(r,e,d,h,f){var g=-1,C=r.length;for(d||(d=Ks),f||(f=[]);++g<C;){var P=r[g];0<e&&d(P)?1<e?$h(P,e-1,d,h,f):ai(f,P):h||(f[f.length]=P)}return f}function je(r,e,d,h,f){if(r===e)e=!0;else if(r==null||e==null||!gc(r)&&!gc(e))e=r!=r&&e!=e;else t:{var g=Va(r),C=Va(e),P=g?"[object Array]":hf(r),x=C?"[object Array]":hf(e),B=(P=P=="[object Arguments]"?"[object Object]":P)=="[object Object]";if(C=(x=x=="[object Arguments]"?"[object Object]":x)=="[object Object]",(x=P==x)&&jf(r)){if(!jf(e)){e=!1;break t}g=!0,B=!1}if(x&&!B)f||(f=new ge),e=g||bi(r)?Pl(r,e,d,h,je,f):Ls(r,e,P,d,h,je,f);else{if(!(1&d)&&(g=B&&Ql.call(r,"__wrapped__"),P=C&&Ql.call(e,"__wrapped__"),g||P)){r=g?r.value():r,e=P?e.value():e,f||(f=new ge),e=je(r,e,d,h,f);break t}if(x)e:if(f||(f=new ge),g=1&d,P=Yh(r),C=P.length,x=Yh(e).length,C==x||g){for(x=C;x--;){var Vt=P[x];if(!(g?Vt in e:Ms.call(e,Vt))){e=!1;break e}}if(B=f.get(r),Vt=f.get(e),B&&Vt)e=B==e&&Vt==r;else{B=!0,f.set(r,e),f.set(e,r);for(var _r=g;++x<C;){var _e=r[Vt=P[x]],_i=e[Vt];if(h)var _a=g?h(_i,_e,Vt,e,r,f):h(_e,_i,Vt,r,e,f);if(_a===void 0?_e!==_i&&!je(_e,_i,d,h,f):!_a){B=!1;break}_r||(_r=Vt=="constructor")}B&&!_r&&(d=r.constructor)!=(h=e.constructor)&&"constructor"in r&&"constructor"in e&&!(typeof d=="function"&&d instanceof d&&typeof h=="function"&&h instanceof h)&&(B=!1),f.delete(r),f.delete(e),e=B}}else e=!1;else e=!1}}return e}function xa(r,e,d){this.low=0|r,this.high=0|e,this.unsigned=!!d}function mb(r){return(r&&r.__isLong__)===!0}function Bd(r,e){var d;if(e){if((e=0<=(r>>>=0)&&256>r)&&(d=Rl[r]))return d;d=ya(r,0>(0|r)?-1:0,!0),e&&(Rl[r]=d)}else{if((e=-128<=(r|=0)&&128>r)&&(d=Sl[r]))return d;d=ya(r,0>r?-1:0,!1),e&&(Sl[r]=d)}return d}function Gb(r,e){if(isNaN(r))return e?Cd:Hb;if(e){if(0>r)return Cd;if(r>=Tl)return Ul}else{if(r<=-Vl)return nb;if(r+1>=Vl)return Wl}return 0>r?Gb(-r,e).neg():ya(r%ke|0,r/ke|0,e)}function ya(r,e,d){return new xa(r,e,d)}function ci(r,e,d){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return Hb;if(typeof e=="number"?(d=e,e=!1):e=!!e,2>(d=d||10)||36<d)throw RangeError("radix");var h;if(0<(h=r.indexOf("-")))throw Error("interior hyphen");if(h===0)return ci(r.substring(1),e,d).neg();h=Gb(sg(d,8));for(var f=Hb,g=0;g<r.length;g+=8){var C=Math.min(8,r.length-g),P=parseInt(r.substring(g,g+C),d);8>C?(C=Gb(sg(d,C)),f=f.mul(C).add(Gb(P))):f=(f=f.mul(h)).add(Gb(P))}return f.unsigned=e,f}function Wb(r,e){return typeof r=="number"?Gb(r,e):typeof r=="string"?ci(r,e):ya(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}function O(r,e){function d(){this.constructor=r}di(r,e),r.prototype=e===null?Object.create(e):(d.prototype=e.prototype,new d)}function le(r){return typeof r=="function"}function me(r){setTimeout(function(){throw r},0)}function ei(r){return r!==null&&X(r)==="object"}function Xl(r){return r.reduce(function(e,d){return e.concat(d instanceof lf?d.errors:d)},[])}function fi(r){for(;r;){var e=r.destination,d=r.isStopped;if(r.closed||d)return!1;r=e&&e instanceof ia?e:null}return!0}function Yc(r){return r}function gi(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Yl(r)}function Yl(r){return r.length===0?Yc:r.length===1?r[0]:function(e){return r.reduce(function(d,h){return h(d)},e)}}function Zl(r){if(r||(r=Ib.Promise||Promise),!r)throw Error("no Promise impl found");return r}function $l(){return function(r){return r.lift(new Ns(r))}}function mf(r){return r?Os(r):vb}function Os(r){return new Y(function(e){return r.schedule(function(){return e.complete()})})}function Zc(r){return r&&typeof r.schedule=="function"}function hi(r,e){return new Y(function(d){var h=new Oa,f=0;return h.add(e.schedule(function(){f===r.length?d.complete():(d.next(r[f++]),d.closed||h.add(this.schedule()))})),h})}function nf(r,e){return e?hi(r,e):new Y(am(r))}function bb(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Zc(e=r[r.length-1])?(r.pop(),hi(r,e)):nf(r)}function Z(r,e){return new Y(e?function(d){return e.schedule(Ps,0,{error:r,subscriber:d})}:function(d){return d.error(r)})}function Ps(r){r.subscriber.error(r.error)}function Qs(r,e){return e===void 0&&(e=0),function(d){return d.lift(new Rs(r,e))}}function bm(r){return r in ii&&(delete ii[r],!0)}function hc(){}function ba(r,e){return function(d){if(typeof r!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return d.lift(new Ss(r,e))}}function cm(r,e,d){if(e){if(!Zc(e))return function(){for(var h=[],f=0;f<arguments.length;f++)h[f]=arguments[f];return cm(r,d).apply(void 0,h).pipe(ba(function(g){return Jb(g)?e.apply(void 0,g):e(g)}))};d=e}return function(){for(var h=[],f=0;f<arguments.length;f++)h[f]=arguments[f];var g,C=this,P={context:C,subject:g,callbackFunc:r,scheduler:d};return new Y(function(x){if(d)return d.schedule(Ts,0,{args:h,subscriber:x,params:P});if(!g){g=new of;try{r.apply(C,h.concat([function(){for(var B=[],Vt=0;Vt<arguments.length;Vt++)B[Vt]=arguments[Vt];g.next(1>=B.length?B[0]:B),g.complete()}]))}catch(B){fi(g)?g.error(B):console.warn(B)}}return g.subscribe(x)})}}function Ts(r){var e=this,d=r.args,h=r.subscriber,f=r.params;r=f.callbackFunc;var g=f.context,C=f.scheduler,P=f.subject;if(!P){P=f.subject=new of,f=function(){for(var x=[],B=0;B<arguments.length;B++)x[B]=arguments[B];e.add(C.schedule(Us,0,{value:1>=x.length?x[0]:x,subject:P}))};try{r.apply(g,d.concat([f]))}catch(x){P.error(x)}}this.add(P.subscribe(h))}function Us(r){var e=r.subject;e.next(r.value),e.complete()}function dm(r,e,d){if(e){if(!Zc(e))return function(){for(var h=[],f=0;f<arguments.length;f++)h[f]=arguments[f];return dm(r,d).apply(void 0,h).pipe(ba(function(g){return Jb(g)?e.apply(void 0,g):e(g)}))};d=e}return function(){for(var h=[],f=0;f<arguments.length;f++)h[f]=arguments[f];var g={subject:void 0,args:h,callbackFunc:r,scheduler:d,context:this};return new Y(function(C){var P=g.context,x=g.subject;if(d)return d.schedule(Vs,0,{params:g,subscriber:C,context:P});if(!x){x=g.subject=new of;try{r.apply(P,h.concat([function(){for(var B=[],Vt=0;Vt<arguments.length;Vt++)B[Vt]=arguments[Vt];(Vt=B.shift())?x.error(Vt):(x.next(1>=B.length?B[0]:B),x.complete())}]))}catch(B){fi(x)?x.error(B):console.warn(B)}}return x.subscribe(C)})}}function Vs(r){var e=this,d=r.params,h=r.subscriber;r=r.context;var f=d.callbackFunc,g=d.args,C=d.scheduler,P=d.subject;if(!P){P=d.subject=new of,d=function(){for(var x=[],B=0;B<arguments.length;B++)x[B]=arguments[B];(B=x.shift())?e.add(C.schedule(em,0,{err:B,subject:P})):e.add(C.schedule(Ws,0,{value:1>=x.length?x[0]:x,subject:P}))};try{f.apply(r,g.concat([d]))}catch(x){this.add(C.schedule(em,0,{err:x,subject:P}))}}this.add(P.subscribe(h))}function Ws(r){var e=r.subject;e.next(r.value),e.complete()}function em(r){r.subject.error(r.err)}function fm(r){return!!r&&typeof r.subscribe!="function"&&typeof r.then=="function"}function ji(r,e,d,h,f){if(f===void 0&&(f=new Xs(r,d,h)),!f.closed)return e instanceof Y?e.subscribe(f):pf(e)(f)}function Ys(r,e){return new Y(function(d){var h=new Oa;return h.add(e.schedule(function(){var f=r[ne]();h.add(f.subscribe({next:function(g){h.add(e.schedule(function(){return d.next(g)}))},error:function(g){h.add(e.schedule(function(){return d.error(g)}))},complete:function(){h.add(e.schedule(function(){return d.complete()}))}}))})),h})}function Zs(r,e){return new Y(function(d){var h=new Oa;return h.add(e.schedule(function(){return r.then(function(f){h.add(e.schedule(function(){d.next(f),h.add(e.schedule(function(){return d.complete()}))}))},function(f){h.add(e.schedule(function(){return d.error(f)}))})})),h})}function $s(r,e){if(!r)throw Error("Iterable cannot be null");return new Y(function(d){var h,f=new Oa;return f.add(function(){h&&typeof h.return=="function"&&h.return()}),f.add(e.schedule(function(){h=r[$c](),f.add(e.schedule(function(){if(!d.closed){try{var g=h.next(),C=g.value,P=g.done}catch(x){return void d.error(x)}P?d.complete():(d.next(C),this.schedule())}}))})),f})}function gm(r,e){if(r!=null){if(r&&typeof r[ne]=="function")return Ys(r,e);if(fm(r))return Zs(r,e);if(hm(r))return hi(r,e);if(r&&typeof r[$c]=="function"||typeof r=="string")return $s(r,e)}throw new TypeError((r!==null&&X(r)||r)+" is not observable")}function Kb(r,e){return e?gm(r,e):r instanceof Y?r:new Y(pf(r))}function ic(r,e){if(!e.closed){if(r instanceof Y)return r.subscribe(e);try{var d=pf(r)(e)}catch(h){e.error(h)}return d}}function cb(r,e,d){return d===void 0&&(d=Number.POSITIVE_INFINITY),typeof e=="function"?function(h){return h.pipe(cb(function(f,g){return Kb(r(f,g)).pipe(ba(function(C,P){return e(f,C,g,P)}))},d))}:(typeof e=="number"&&(d=e),function(h){return h.lift(new at(r,d))})}function tg(r){return r===void 0&&(r=Number.POSITIVE_INFINITY),cb(Yc,r)}function im(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return tg(1)(bb.apply(void 0,r))}function ad(r){return new Y(function(e){try{var d=r()}catch(h){return void e.error(h)}return(d?Kb(d):mf()).subscribe(e)})}function jm(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if(r.length===1){var d=r[0];if(Jb(d))return ug(d,null);if(ei(d)&&Object.getPrototypeOf(d)===Object.prototype)return ug((r=Object.keys(d)).map(function(f){return d[f]}),r)}if(typeof r[r.length-1]=="function"){var h=r.pop();return ug(r=r.length===1&&Jb(r[0])?r[0]:r,null).pipe(ba(function(f){return h.apply(void 0,f)}))}return ug(r,null)}function ug(r,e){return new Y(function(d){var h=r.length;if(h===0)d.complete();else for(var f=Array(h),g=0,C=0,P=function(B){var Vt=Kb(r[B]),_r=!1;d.add(Vt.subscribe({next:function(_e){_r||(_r=!0,C++),f[B]=_e},error:function(_e){return d.error(_e)},complete:function(){++g!==h&&_r||(C===h&&d.next(e?e.reduce(function(_e,_i,_a){return _e[_i]=f[_a],_e},{}):f),d.complete())}}))},x=0;x<h;x++)P(x)})}function gb(r,e,d,h){return le(d)&&(h=d,d=void 0),h?gb(r,e,d).pipe(ba(function(f){return Jb(f)?h.apply(void 0,f):h(f)})):new Y(function(f){km(r,e,function(g){1<arguments.length?f.next(Array.prototype.slice.call(arguments)):f.next(g)},f,d)})}function km(r,e,d,h,f){if(r&&typeof r.addEventListener=="function"&&typeof r.removeEventListener=="function"){r.addEventListener(e,d,f);var g=function(){return r.removeEventListener(e,d,f)}}else if(r&&typeof r.on=="function"&&typeof r.off=="function")r.on(e,d),g=function(){return r.off(e,d)};else if(r&&typeof r.addListener=="function"&&typeof r.removeListener=="function")r.addListener(e,d),g=function(){return r.removeListener(e,d)};else{if(!r||!r.length)throw new TypeError("Invalid event target");for(var C=0,P=r.length;C<P;C++)km(r[C],e,d,h,f)}h.add(g)}function lm(r,e,d){return d?lm(r,e).pipe(ba(function(h){return Jb(h)?d.apply(void 0,h):d(h)})):new Y(function(h){var f=function(){for(var C=[],P=0;P<arguments.length;P++)C[P]=arguments[P];return h.next(C.length===1?C[0]:C)};try{var g=r(f)}catch(C){return void h.error(C)}if(le(e))return function(){return e(f,g)}})}function bt(r){var e=r.subscriber,d=r.condition;if(!e.closed){if(r.needIterate)try{r.state=r.iterate(r.state)}catch(g){return void e.error(g)}else r.needIterate=!0;if(d){var h=void 0;try{h=d(r.state)}catch(g){return void e.error(g)}if(!h)return void e.complete();if(e.closed)return}try{var f=r.resultSelector(r.state)}catch(g){return void e.error(g)}if(!e.closed&&(e.next(f),!e.closed))return this.schedule(r)}}function ki(r){return!Jb(r)&&0<=r-parseFloat(r)+1}function mm(r,e){return r===void 0&&(r=0),e===void 0&&(e=bd),(!ki(r)||0>r)&&(r=0),e&&typeof e.schedule=="function"||(e=bd),new Y(function(d){return d.add(e.schedule(ct,r,{subscriber:d,counter:0,period:r})),d})}function ct(r){var e=r.subscriber,d=r.counter;r=r.period,e.next(d),this.schedule({subscriber:e,counter:d+1,period:r},r)}function Xb(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];e=Number.POSITIVE_INFINITY;var d=null,h=r[r.length-1];return Zc(h)?(d=r.pop(),1<r.length&&typeof r[r.length-1]=="number"&&(e=r.pop())):typeof h=="number"&&(e=r.pop()),d===null&&r.length===1&&r[0]instanceof Y?r[0]:tg(e)(nf(r,d))}function li(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if(r.length===0)return vb;var d=r[0],h=r.slice(1);return r.length===1&&Jb(d)?li.apply(void 0,d):new Y(function(f){var g=function(){return f.add(li.apply(void 0,h).subscribe(f))};return Kb(d).subscribe({next:function(C){f.next(C)},error:g,complete:g})})}function dt(r){var e=r.keys,d=r.index,h=r.subscriber,f=r.subscription;if(r=r.obj,!h.closed)if(d<e.length){var g=e[d];h.next([g,r[g]]),f.add(this.schedule({keys:e,index:d+1,subscriber:h,subscription:f,obj:r}))}else h.complete()}function et(r,e){function d(){return!d.pred.apply(d.thisArg,arguments)}return d.pred=r,d.thisArg=e,d}function wb(r,e){return function(d){return d.lift(new ft(r,e))}}function Ca(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if(r.length===1){if(!Jb(r[0]))return r[0];r=r[0]}return nf(r,void 0).lift(new gt)}function ht(r){var e=r.start,d=r.index,h=r.subscriber;d>=r.count?h.complete():(h.next(e),h.closed||(r.index=d+1,r.start=e+1,this.schedule(r)))}function Bc(r,e,d){r===void 0&&(r=0);var h=-1;return ki(e)?h=1>Number(e)?1:Number(e):Zc(e)&&(d=e),Zc(d)||(d=bd),new Y(function(f){var g=ki(r)?r:+r-d.now();return d.schedule(it,g,{index:0,period:h,subscriber:f})})}function it(r){var e=r.index,d=r.period,h=r.subscriber;if(h.next(e),!h.closed){if(d===-1)return h.complete();r.index=e+1,this.schedule(r,d)}}function mi(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return typeof(e=r[r.length-1])=="function"&&r.pop(),nf(r,void 0).lift(new jt(e))}function Ga(r){return function(e){var d=new kt(r);return e=e.lift(d),d.caught=e}}function ni(r,e){return cb(r,e,1)}function nm(r){return r===void 0&&(r=null),function(e){return e.lift(new lt(r))}}function cd(r,e){e===void 0&&(e=bd);var d=r instanceof Date&&!isNaN(+r)?+r-e.now():Math.abs(r);return function(h){return h.lift(new mt(d,e))}}function om(r,e){return function(d){return d.lift(new nt(r,e))}}function Dd(r){return r===void 0&&(r=ot),function(e){return e.lift(new pt(r))}}function ot(){return new vg}function Ka(r){return function(e){return r===0?mf():e.lift(new qt(r))}}function pm(r,e){return e?function(d){return d.pipe(pm(function(h,f){return Kb(r(h,f)).pipe(ba(function(g,C){return e(h,g,f,C)}))}))}:function(d){return d.lift(new rt(r))}}function wg(r){return function(e){return e.lift(new st(r))}}function aa(r,e){var d=2<=arguments.length;return function(h){return h.pipe(r?wb(function(f,g){return r(f,g,h)}):Yc,Ka(1),d?nm(e):Dd(function(){return new vg}))}}function tt(){return function(r){return r.lift(new ut)}}function qm(r){return function(e){return r===0?mf():e.lift(new vt(r))}}function qf(r){return function(e){return e.lift(new wt(r))}}function xg(r,e){var d=!1;return 2<=arguments.length&&(d=!0),function(h){return h.lift(new xt(r,e,d))}}function rm(r,e){return 2<=arguments.length?function(d){return gi(xg(r,e),qm(1),nm(e))(d)}:function(d){return gi(xg(function(h,f,g){return r(h,f,g+1)}),qm(1))(d)}}function yt(r,e){return function(d){var h=typeof r=="function"?r:function(){return r};if(typeof e=="function")return d.lift(new zt(h,e));var f=Object.create(d,At);return f.source=d,f.subjectFactory=h,f}}function oe(r){return function(e){return e.lift(new Bt(r,e))}}function Ct(){return new Pa}function pe(){return function(r){return $l()(yt(Ct)(r))}}function sm(r,e,d){var h=r&&X(r)==="object"?r:{bufferSize:r,windowTime:e,refCount:!1,scheduler:d};return function(f){return f.lift(Dt(h))}}function Dt(r){var e,d,h=r.bufferSize,f=h===void 0?Number.POSITIVE_INFINITY:h,g=(h=r.windowTime)===void 0?Number.POSITIVE_INFINITY:h,C=r.refCount,P=r.scheduler,x=0,B=!1,Vt=!1;return function(_r){if(x++,!e||B){B=!1;var _e=(e=new qe(f,g,P)).subscribe(this);d=_r.subscribe({next:function(_i){e.next(_i)},error:function(_i){B=!0,e.error(_i)},complete:function(){Vt=!0,d=void 0,e.complete()}}),Vt&&(d=void 0)}else _e=e.subscribe(this);this.add(function(){x--,_e.unsubscribe(),_e=void 0,d&&!Vt&&C&&x===0&&(d.unsubscribe(),e=d=void 0)})}}function Cc(r,e){return typeof e=="function"?function(d){return d.pipe(Cc(function(h,f){return Kb(r(h,f)).pipe(ba(function(g,C){return e(h,g,f,C)}))}))}:function(d){return d.lift(new Et(r))}}function ob(r){return function(e){return e.lift(new Ft(r))}}function Gt(r,e){return e===void 0&&(e=!1),function(d){return d.lift(new Ht(r,e))}}function ca(r,e,d){return function(h){return h.lift(new It(r,e,d))}}function Jt(r,e,d){return e===void 0&&(e=bd),d===void 0&&(d=Kt),function(h){return h.lift(new Lt(r,e,d.leading,d.trailing))}}function Mt(r){r.subscriber.clearThrottle()}function Nt(r,e,d){return d===void 0&&(d=bd),function(h){var f=r instanceof Date&&!isNaN(+r),g=f?+r-d.now():Math.abs(r);return h.lift(new Ot(g,f,e,d))}}function hb(r,e){return e===void 0&&(e=bd),Nt(r,Z(new pb),e)}function Pt(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return function(d){var h;return typeof r[r.length-1]=="function"&&(h=r.pop()),d.lift(new Qt(r,h))}}function tm(r,e,d,h,f){r!==e&&um(e,function(g,C){if(f||(f=new ge),lb(g)){g=f;var P=oi(r,C),x=oi(e,C),B=g.get(x);if(B)pi(r,C,B);else{var Vt=(B=h?h(P,x,C+"",r,e,g):void 0)===void 0;if(Vt){var _r=Va(x),_e=!_r&&jf(x),_i=!_r&&!_e&&bi(x);B=x,_r||_e||_i?Va(P)?B=P:gc(P)&&Ed(P)?B=Xh(P):_e?(Vt=!1,B=Jl(x,!0)):_i?(Vt=!1,B=vm(x,!0)):B=[]:wm(x)||rf(x)?(B=P,rf(P)?B=re(P,kf(P)):lb(P)&&!qi(P)||(B=Kl(x))):Vt=!1}Vt&&(g.set(x,B),tm(B,x,d,h,g),g.delete(x)),pi(r,C,B)}}else(P=h?h(oi(r,C),g,C+"",r,e,f):void 0)===void 0&&(P=g),pi(r,C,P)},kf)}function Rt(r){var e=1,d=ri;(1>=arguments.length?0:arguments.length-1)==1?typeof(1>=arguments.length?void 0:arguments[1])=="number"?e=1>=arguments.length?void 0:arguments[1]:d=1>=arguments.length?void 0:arguments[1]:(1>=arguments.length?0:arguments.length-1)==2&&(e=1>=arguments.length?void 0:arguments[1],d=2>=arguments.length?void 0:arguments[2]);var h=e||1;return function(f){return f.pipe(xg(function(g,C){var P=d.now(),x=P-r;if((g=g.filter(function(_r){return _r.until>x})).length>=h){var B=g[g.length-1],Vt=g[0].until+r*Math.floor(g.length/h);g.push({delay:B.until<P?Vt-P:Vt-B.until,until:Vt,value:C})}else g.push({delay:0,until:P,value:C});return g},[]),ba(function(g){return g[g.length-1]}),ni(function(g){var C=bb(g.value);return g.delay?C.pipe(cd(g.delay,d)):C}))}}function St(r,e){var d=(e=e===void 0?{protocols:xm,makeWebSocket:ym}:e).protocols,h=d===void 0?xm:d,f=(e=e.makeWebSocket)===void 0?ym:e;return new Y(function(g){var C,P=new Pa,x=f(r,h),B=!1,Vt=!1,_r=function(_e){if(C)throw B=!0,_e=Error("Web socket message factory function called more than once"),g.error(_e),_e;return C=_e.subscribe(function(_i){x.send(_i)}),P};return x.onopen=function(){Vt?(B=!0,x.close()):g.next(_r)},x.onmessage=function(_e){P.next(_e.data)},x.onerror=function(_e){B=!0,g.error(Error(_e.message))},x.onclose=function(_e){B||(B=!0,Vt?(g.complete(),P.complete()):g.error(Error(_e.code===1e3?"Normal closure":_e.reason)))},function(){Vt=!0,C&&C.unsubscribe(),B||(B=!0,x.close())}})}function yg(){this._listeners={}}function zm(r){return typeof Float32Array<"u"?function(){function e(x,B,Vt){g[0]=x,B[Vt]=C[0],B[Vt+1]=C[1],B[Vt+2]=C[2],B[Vt+3]=C[3]}function d(x,B,Vt){g[0]=x,B[Vt]=C[3],B[Vt+1]=C[2],B[Vt+2]=C[1],B[Vt+3]=C[0]}function h(x,B){return C[0]=x[B],C[1]=x[B+1],C[2]=x[B+2],C[3]=x[B+3],g[0]}function f(x,B){return C[3]=x[B],C[2]=x[B+1],C[1]=x[B+2],C[0]=x[B+3],g[0]}var g=new Float32Array([-0]),C=new Uint8Array(g.buffer),P=C[3]===128;r.writeFloatLE=P?e:d,r.writeFloatBE=P?d:e,r.readFloatLE=P?h:f,r.readFloatBE=P?f:h}():function(){function e(h,f,g,C){var P=0>f?1:0;if(P&&(f=-f),f===0)h(0<1/f?0:2147483648,g,C);else if(isNaN(f))h(2143289344,g,C);else if(34028234663852886e22<f)h((P<<31|2139095040)>>>0,g,C);else if(11754943508222875e-54>f)h((P<<31|Math.round(f/1401298464324817e-60))>>>0,g,C);else{var x=Math.floor(Math.log(f)/Math.LN2);h((P<<31|x+127<<23|8388607&Math.round(f*Math.pow(2,-x)*8388608))>>>0,g,C)}}function d(h,f,g){return g=h(f,g),h=2*(g>>31)+1,f=g>>>23&255,g&=8388607,f===255?g?NaN:1/0*h:f===0?1401298464324817e-60*h*g:h*Math.pow(2,f-150)*(g+8388608)}r.writeFloatLE=e.bind(null,Am),r.writeFloatBE=e.bind(null,Bm),r.readFloatLE=d.bind(null,Cm),r.readFloatBE=d.bind(null,Dm)}(),typeof Float64Array<"u"?function(){function e(x,B,Vt){g[0]=x,B[Vt]=C[0],B[Vt+1]=C[1],B[Vt+2]=C[2],B[Vt+3]=C[3],B[Vt+4]=C[4],B[Vt+5]=C[5],B[Vt+6]=C[6],B[Vt+7]=C[7]}function d(x,B,Vt){g[0]=x,B[Vt]=C[7],B[Vt+1]=C[6],B[Vt+2]=C[5],B[Vt+3]=C[4],B[Vt+4]=C[3],B[Vt+5]=C[2],B[Vt+6]=C[1],B[Vt+7]=C[0]}function h(x,B){return C[0]=x[B],C[1]=x[B+1],C[2]=x[B+2],C[3]=x[B+3],C[4]=x[B+4],C[5]=x[B+5],C[6]=x[B+6],C[7]=x[B+7],g[0]}function f(x,B){return C[7]=x[B],C[6]=x[B+1],C[5]=x[B+2],C[4]=x[B+3],C[3]=x[B+4],C[2]=x[B+5],C[1]=x[B+6],C[0]=x[B+7],g[0]}var g=new Float64Array([-0]),C=new Uint8Array(g.buffer),P=C[7]===128;r.writeDoubleLE=P?e:d,r.writeDoubleBE=P?d:e,r.readDoubleLE=P?h:f,r.readDoubleBE=P?f:h}():function(){function e(h,f,g,C,P,x){var B=0>C?1:0;if(B&&(C=-C),C===0)h(0,P,x+f),h(0<1/C?0:2147483648,P,x+g);else if(isNaN(C))h(0,P,x+f),h(2146959360,P,x+g);else if(17976931348623157e292<C)h(0,P,x+f),h((B<<31|2146435072)>>>0,P,x+g);else if(22250738585072014e-324>C)h((C/=5e-324)>>>0,P,x+f),h((B<<31|C/4294967296)>>>0,P,x+g);else{var Vt=Math.floor(Math.log(C)/Math.LN2);Vt===1024&&(Vt=1023),h(4503599627370496*(C*=Math.pow(2,-Vt))>>>0,P,x+f),h((B<<31|Vt+1023<<20|1048576*C&1048575)>>>0,P,x+g)}}function d(h,f,g,C,P){return f=h(C,P+f),C=h(C,P+g),h=2*(C>>31)+1,f=4294967296*(1048575&C)+f,(g=C>>>20&2047)===2047?f?NaN:1/0*h:g===0?5e-324*h*f:h*Math.pow(2,g-1075)*(f+4503599627370496)}r.writeDoubleLE=e.bind(null,Am,0,4),r.writeDoubleBE=e.bind(null,Bm,4,0),r.readDoubleLE=d.bind(null,Cm,0,4),r.readDoubleBE=d.bind(null,Dm,4,0)}(),r}function Am(r,e,d){e[d]=255&r,e[d+1]=r>>>8&255,e[d+2]=r>>>16&255,e[d+3]=r>>>24}function Bm(r,e,d){e[d]=r>>>24,e[d+1]=r>>>16&255,e[d+2]=r>>>8&255,e[d+3]=255&r}function Cm(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0}function Dm(r,e){return(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}function Wa(r,e){this.lo=r>>>0,this.hi=e>>>0}function sf(r,e,d){this.fn=r,this.len=e,this.next=void 0,this.val=d}function si(){}function Tt(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function ja(){this.len=0,this.tail=this.head=new sf(si,0,0),this.states=null}function ti(r,e,d){e[d]=255&r}function ui(r,e){this.len=r,this.next=void 0,this.val=e}function vi(r,e,d){for(;r.hi;)e[d++]=127&r.lo|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;127<r.lo;)e[d++]=127&r.lo|128,r.lo>>>=7;e[d++]=r.lo}function wi(r,e,d){e[d]=255&r,e[d+1]=r>>>8&255,e[d+2]=r>>>16&255,e[d+3]=r>>>24}function jc(){xi.call(this)}function Ut(r,e,d){40>r.length?V.utf8.write(r,e,d):e.utf8Write?e.utf8Write(r,d):e.write(r,d)}function Yb(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function La(r){this.buf=r,this.pos=0,this.len=r.length}function yi(){var r=new Em(0,0),e=0;if(!(4<this.len-this.pos)){for(;3>e;++e){if(this.pos>=this.len)throw Yb(this);if(r.lo=(r.lo|(127&this.buf[this.pos])<<7*e)>>>0,128>this.buf[this.pos++])return r}return r.lo=(r.lo|(127&this.buf[this.pos++])<<7*e)>>>0,r}for(;4>e;++e)if(r.lo=(r.lo|(127&this.buf[this.pos])<<7*e)>>>0,128>this.buf[this.pos++])return r;if(r.lo=(r.lo|(127&this.buf[this.pos])<<28)>>>0,r.hi=(r.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return r;if(e=0,4<this.len-this.pos){for(;5>e;++e)if(r.hi=(r.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,128>this.buf[this.pos++])return r}else for(;5>e;++e){if(this.pos>=this.len)throw Yb(this);if(r.hi=(r.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,128>this.buf[this.pos++])return r}throw Error("invalid varint encoding")}function zg(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}function Fm(){if(this.pos+8>this.len)throw Yb(this,8);return new Em(zg(this.buf,this.pos+=4),zg(this.buf,this.pos+=4))}function Fd(r){zi.call(this,r)}function tf(r,e,d){if(typeof r!="function")throw TypeError("rpcImpl must be a function");V.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=!!e,this.responseDelimited=!!d}function za(r){return typeof r=="string"&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(r)&&r!=="null"}function Gm(r){try{var e=r.split(".").map(function(h){return Number(h)})}catch{return!1}if(e.length!==4||e[0]===0)return!1;for(r=0;r<e.length;r++){var d=e[r];if(!Number.isInteger(d)||0>d||255<d)return!1}return!0}function Hm(r,e){if(!Array.isArray(e)||e.length===0||32<e.length||e.some(function(d){return d.length===0||32<d.length}))throw new I("arguments is not valid",Ja);if(!za(r))throw new I("ID is invalid",Ja)}function uf(r){var e=r.attributes,d=r.attrSizeMap,h=r.maxAttrsCount,f=r.maxAttrValueSize;if(r=r.maxTotalSize,!yd(e))throw new I("attributes must be an object",Ja);if(Object.keys(e).length>h)throw new ib("Exceed the limit of ".concat(h," attributes"),se);if(Object.keys(e).length===0)throw new I("The attributes is an empty object",Ja);var g=0,C=0;for(e=Object.entries(e);C<e.length;C++){var P=ra(e[C],2),x=P[1];P=new Blob([P[0]]).size;var B=new Blob([x]).size;if(P===0||32<P)throw new I("Invalid attribute key",Ja);if(B>f)throw new ib("Invalid attribute value, over the limit of ".concat(f," bytes"),se);if(typeof x!="string"||x.length===0)throw new I("Invalid attribute value",Ja);g+=P,g+=B}if(g>r)throw new ib("The attributes size overflow",se);if(d!==void 0){if(Object.keys(d).length>h)throw new ib("Exceed the limit of ".concat(h," attributes"),se);for(g=h=0,d=Object.entries(d);g<d.length;g++){if(C=(e=ra(d[g],2))[1],(e=new Blob([e[0]]).size)===0)throw new I("Invalid attribute key",Ja);if(C>f)throw new ib("Invalid attribute value, over the limit of ".concat(f," bytes"),se);h+=e,h+=C}if(h>r)throw new ib("The attributes size overflow",se)}}function Ag(r,e){return Math.floor(Math.random()*(Math.floor(e)-Math.ceil(r)+1))+r}function Bg(){var r=Ag(0,4294967295),e=Ag(1,4294967295);return new U(r,e,!0)}function Xa(r){return r.toString().padEnd(32,"0")}function Im(r,e){return new TypeError("Unexpected ".concat(r,": ").concat(e))}function Jm(r,e){return r=r.split(".").map(function(d){return Number(d)}),e=e.split(".").map(function(d){return Number(d)}),Math.sqrt(1e3*Math.pow(r[0]-e[0],2)+100*Math.pow(r[1]-e[1],2)+10*Math.pow(r[2]-e[2],2)+1*Math.pow(r[3]-e[3],2))}function Km(r){return r.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?r.toNumber():r.toString()}function Ai(r,e){e="".concat(r).concat(e||"");var d=Lm.get(e)||1;return Lm.set(e,d+1),"".concat(r).concat(d)}function Mm(r,e){var d=typeof e=="number"?e:e!==void 0&&typeof e!="string"?e.code:void 0;return e=typeof e!="number"&&typeof e!="string"&&e!==void 0&&e.serverCode!==void 0?e.serverCode:void 0,d="".concat(d!==void 0?" Error Code ".concat(d):"").concat(e!==void 0?", server Code ".concat(e):""),r=typeof r=="string"&&r?Cg(r):Array.isArray(r)&&typeof r[0]=="string"&&r[0]?Cg(Nm.apply(void 0,[r[0]].concat(G(r.slice(1))))):"","".concat(d===""?"":"".concat(d," - ")).concat(r)}function Om(r){return Bi.apply(this,arguments)}function Bi(){return(Bi=J(w.mark(function r(e){return w.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",new Promise(function(h){setTimeout(function(){h()},e)}));case 1:case"end":return d.stop()}},r)}))).apply(this,arguments)}function Pm(r){return r instanceof Blob||Object.prototype.toString.call(r)==="[object Blob]"}function Dg(r){var e=255&r,d=r>>8&255,h=r>>16&255;return"".concat(r>>24&255,".").concat(h,".").concat(d,".").concat(e)}function te(r,e,d){return Ci.apply(this,arguments)}function Ci(){return(Ci=J(w.mark(function r(e,d,h){var f,g,C,P,x,B,Vt,_r,_e,_i,_a,kc,_d,_l,_h,rE,aE,yE,gE,bE,GE,Qm,tE,EE,pE,TE;return w.wrap(function(_p){for(;;)switch(_p.prev=_p.next){case 0:if(f=d.body,g=d.headers,C=g===void 0?{}:g,P=d.timeout,x=P===void 0?1e4:P,B=d.signal,Vt=d.withCredentials,_r=Vt!==void 0&&Vt,_e=(h||{}).useBinaryResponse,_i=_e!==void 0&&_e,(_a=new XMLHttpRequest).open("POST",e,!0),_a.responseType=_i?"arraybuffer":"text",_a.withCredentials=_r,_a.timeout=x,kc=f instanceof FormData,_d=f instanceof Uint8Array,!(1<(_l=Object.keys(C).filter(function(eE){return eE.toLowerCase()==="content-type"})).length)){_p.next=14;break}throw new RangeError("multiple content-type");case 14:_l.length===0&&(_d?C["Content-Type"]="application/octet-stream":kc||(C["Content-Type"]="application/json"));case 15:if("setRequestHeader"in _a){_p.next=46;break}return _a.abort(),_p.next=19,fetch(e,{body:kc||_d?f:JSON.stringify(f),cache:"no-cache",credentials:_r?"include":"same-origin",headers:C,method:"POST",mode:"cors",referrer:"no-referrer",signal:B});case 19:if(_h=_p.sent,!(200<=(rE=_h.status)&&300>rE||rE===304)){_p.next=31;break}if(!_i){_p.next=27;break}return _p.next=25,_h.arrayBuffer();case 25:return aE=_p.sent,_p.abrupt("return",{status:rE,responseData:aE});case 27:return _p.next=29,_h.text();case 29:return yE=_p.sent,_p.abrupt("return",{status:rE,responseText:yE});case 31:return gE=new da(["Post XHR failure, status %d",rE]),_p.prev=32,_p.next=35,_h.text();case 35:throw bE=_p.sent,gE.statusCode=rE,gE.message=bE||"Request failed, status ".concat(rE),gE;case 41:throw _p.prev=41,_p.t0=_p.catch(32),gE.statusCode=rE,gE.message="Request failed, status ".concat(rE),gE;case 46:if(Object.keys(C).length!==0)for(GE=0,Qm=Object.entries(C);GE<Qm.length;GE++)tE=ra(Qm[GE],2),EE=tE[0],pE=tE[1],_a.setRequestHeader(EE,pE);return B!==void 0&&(TE=function eE(){_a.abort(),B.removeEventListener("abort",eE)},B.addEventListener("abort",TE)),kc||_d?_a.send(f):_a.send(JSON.stringify(f)),_p.abrupt("return",new Promise(function(eE,cE){_a.onload=function(){var SE=_a.status;if(200<=SE&&300>SE||SE===304)eE(_i?{status:SE,responseData:_a.response}:{status:SE,responseText:_a.responseText});else{var AE=new da(["Post XHR failure, status %d",SE]);AE.statusCode=SE,AE.message=_a.response||"Request failed, status ".concat(_a.status),cE(AE)}},_a.ontimeout=function(SE){cE(new db(["XHR request timed out after %d ms",x],{originalError:SE}))},_a.onerror=function(){var SE=new da(["Post XHR failure, status %d",_a.status]);SE.statusCode=_a.status,SE.message=_a.response||"Request failed, status ".concat(_a.status),cE(SE)},_a.onabort=function(){try{cE(new DOMException("The request aborted.","AbortError"))}catch{var SE=Error("The request aborted.");SE.name="AbortError",cE(SE)}}}));case 50:case"end":return _p.stop()}},r,null,[[32,41]])}))).apply(this,arguments)}function Rm(r){return Hi.apply(this,arguments)}function Hi(){return(Hi=J(w.mark(function r(e){var d;return w.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return(d=new Image).src=e,h.abrupt("return",new Promise(function(f,g){d.onload=function(){f({width:d.width,height:d.height})},d.onerror=g}));case 3:case"end":return h.stop()}},r)}))).apply(this,arguments)}function Xt(r,e){return Ii.apply(this,arguments)}function Ii(){return(Ii=J(w.mark(function r(e,d){var h,f,g,C,P,x,B,Vt,_r,_e;return w.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:if(h=e.thumbnailHeight,f=h===void 0?0:h,g=e.thumbnailWidth,C=g===void 0?0:g,P=e.width,x=P===void 0?0:P,B=e.height,Vt=B===void 0?0:B,_r=e.thumbnail,_e=[],typeof f=="number"&&typeof C=="number"&&typeof x=="number"&&typeof Vt=="number"){_i.next=5;break}throw new I("Invalid message params",wf);case 5:return 0>=x&&0>=Vt&&_e.push(Rm(Sm(d)).then(function(_a){x=_a.width,Vt=_a.height})),0>=C&&0>=f&&_r!==void 0&&_e.push(Ji(_r).then(function(){var _a=J(w.mark(function kc(_d){var _l;return w.wrap(function(_h){for(;;)switch(_h.prev=_h.next){case 0:return _h.next=2,Rm(Sm(_d));case 2:_l=_h.sent,C=_l.width,f=_l.height;case 5:case"end":return _h.stop()}},kc)}));return function(kc){return _a.apply(this,arguments)}}())),_i.next=9,Promise.all(_e).catch(function(){});case 9:return _i.abrupt("return",{width:x,height:Vt,thumbnailWidth:C,thumbnailHeight:f});case 10:case"end":return _i.stop()}},r)}))).apply(this,arguments)}function Tm(r,e){if(!yd(r))throw new I("message object is not a plain object",e);if(r.messageType===void 0)if(r.rawMessage instanceof Uint8Array){if(r.messageType="RAW",r.text!==void 0)throw new I("Raw messages cannot have text property. Use description instead",e)}else{if(typeof r.text!="string")throw new I("messageType is undefined",e);if(r.messageType="TEXT",r.rawMessage!==void 0)throw new I("Text messages cannot have rawMessage property",e)}}function Gg(r){return Ki.apply(this,arguments)}function Ki(){return(Ki=J(w.mark(function r(e){var d,h,f,g,C,P,x,B,Vt,_r,_e,_i,_a,kc,_d,_l,_h,rE,aE,yE,gE;return w.wrap(function(bE){for(;;)switch(bE.prev=bE.next){case 0:if(d=e.message,h=e.peerId,f=e.toPeer,g=e.session,C=e.errorCodes,P=e.diff,x=e.logger,B=e.options,g!==void 0){bE.next=3;break}throw new K("The client is not logged in. Cannot do the operation",C.NOT_LOGGED_IN);case 3:if(Vt=!1,d.messageType!=="TEXT"||!d.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!f){bE.next=11;break}if(_r=d.text.split("_"),_e=ra(_r,3),_i=_e[0],_a=_e[1],_e[2]!==void 0&&za(_a)&&_i==="AgoraRTMLegacyEndcallCompatibleMessagePrefix"){bE.next=10;break}throw new I("Message is not valid",ve);case 10:Vt=!0;case 11:if(kc=Date.now(),_d=g.messageSentTimes.length-1,!((_l=g.messageSentTimes[_d])&&_l+3e3<kc)){bE.next=18;break}g.messageSentTimes=[kc],bE.next=29;break;case 18:_h=_d;case 19:if(!(0<=_h)){bE.next=28;break}if(!(g.messageSentTimes[_h]+3e3<kc)){bE.next=23;break}return g.messageSentTimes=g.messageSentTimes.slice(_h+1,_d+1),bE.abrupt("break",28);case 23:if(!(180<=_d-_h+1)){bE.next=25;break}throw new ib("Message sent failed, exceeded the 180 message in 3 seconds",C.TOO_OFTEN);case 25:_h--,bE.next=19;break;case 28:g.messageSentTimes.push(kc);case 29:bE.t0=d.messageType,bE.next=bE.t0==="TEXT"?32:bE.t0==="RAW"?37:bE.t0==="FILE"||bE.t0==="IMAGE"?39:40;break;case 32:if(!Vt){bE.next=36;break}return rE=d.text.split("_"),aE=ra(rE,3),yE=aE[1],gE=aE[2],x.info("[rtm-API] EndCall message send api is called"),bE.abrupt("return",g.sendInvitationMessage({peerId:h,type:"CallCancel",extra:gE,channelId:yE,callId:"0"}));case 36:return bE.abrupt("return",g.sendTextMessage(d.text,h,f,B,1e4-P));case 37:return d.description===void 0&&(d.description=""),bE.abrupt("return",g.sendRawMessage(d.rawMessage,d.description,h,f,B,1e4-P));case 39:return bE.abrupt("return",g.sendMediaMessage(d.messageType,d,h,f,B,1e4-P));case 40:throw new I("Invalid message type",ve);case 41:case"end":return bE.stop()}},r)}))).apply(this,arguments)}function Yt(r){var e=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],d=r.replace(/(https?:\/\/)?(www.)?/i,"");return e||(d=d.split(".").slice(r.length-2).join(".")),d.indexOf("/")!==-1?d.split("/")[0]:d}function oa(r){if(typeof r!="string")return"[Sensitive Info]";var e=Math.floor(.7*r.length),d=r.length;return Um(r,e,d,"*".repeat(d-e))}function Vm(r,e,d){function h(f){if(r===void 0)return r;if(Il(f))return f;if(Array.isArray(f))return f.map(h);var g={},C=0;for(f=Hg(f);C<f.length;C++){var P=ra(f[C],2),x=P[0];if(typeof(P=P[1])=="string"&&d.includes(x)){g[x]=typeof P=="string"?oa(P):"[Sensitive Info]";break}e.includes(x)?g[x]="[Hidden Info]":g[x]=P==null?P:d.includes(x)?"[Sensitive Info]":h(P)}return g}return Array.isArray(r)?r.map(h):h(r)}function Wm(r){return Object.getOwnPropertyNames(r).forEach(function(e){X(e=r[e])=="object"&&e!==null&&Wm(e)}),Object.freeze(r)}function pa(r){return new TextDecoder("utf-8").decode(r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength))}function Ig(r){return new TextEncoder().encode(r).length}function Xm(){for(var r=0,e=arguments.length,d=Array(e),h=0;h<e;h++)d[h]=arguments[h];for(e=0;e<d.length;e++)r+=d[e].length;for(r=new Uint8Array(r),h=e=0;h<d.length;h++){var f=d[h];r.set(f,e),e+=f.length}return r}function we(r,e,d){var h=r.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(r=h==null?void 0:h[1],h=h==null?void 0:h[2]){var f;for(h=h.substr(1).split("&"),f=0;f<h.length;f++)if(h[f].split("=")[0]==e){h[f]=e+"="+encodeURIComponent(d);break}return f==h.length&&h.push(e+"="+encodeURIComponent(d)),r+"?"+h.join("&")}return r+"?"+e+"="+encodeURIComponent(d)}function Ji(r){return new Promise(function(e,d){var h=new FileReader;h.onloadend=function(){var f=h.result||new ArrayBuffer(0);e(f)},h.onerror=d,h.readAsArrayBuffer(r)})}function Zt(r,e){r=r=[r],typeof(e=e||{})=="string"&&(e={type:e});try{var d=new Blob(r,e)}catch(f){if(f.name!=="TypeError")throw f;d=new(typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder);for(var h=0;h<r.length;h+=1)d.append(r[h]);d=d.getBlob(e.type)}return d}function Um(r,e,d,h){return typeof r!="string"?"[Sensitive Info]":r.substring(0,e)+h+r.substring(d)}function Ym(r){var e=[];return function d(h){if(h===null||X(h)!=="object")return h;if(e.indexOf(h)!==-1)return"[Circular]";if(e.push(h),typeof h.toJSON=="function")try{var f=d(h.toJSON());return e.pop(),f}catch(g){return"[Throws: "+(g?g.message:"?")+"]"}return Array.isArray(h)?(f=h.map(d),e.pop(),f):(f=Object.keys(h).reduce(function(g,C){t:{if($t.call(h,C))try{var P=h[C];break t}catch(x){P="[Throws: "+(x?x.message:"?")+"]";break t}P=h[C]}return g[C]=d(P),g},{}),e.pop(),f)}(r)}function au(r){if(!(100<(r=String(r)).length)&&(r=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r))){var e=parseFloat(r[1]);switch((r[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*e;case"weeks":case"week":case"w":return 6048e5*e;case"days":case"day":case"d":return 864e5*e;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*e;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*e;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e}}}function Jg(r,e,d,h){return Math.round(r/d)+" "+h+(e>=1.5*d?"s":"")}function bu(r){var e=r.areas,d=r.excludedArea;if(e.length===1&&e[0]===F.GLOBAL&&d===F.CHINA)return xe([F.OVERSEA]);if(e.includes(F.GLOBAL)){if(r=xf(Kg).filter(function(g){return g!==F.GLOBAL&&g!==F.OVERSEA}),d in yf){e=yf[d];var h=[].concat(G(e??[]),[d]);return xe(r.filter(function(g){return!h.includes(g)}))}if(Zm(d)){var f=cu(d);return xe(r.filter(function(g){return g!==d&&g!==f}))}}if(Zm(d)||d in yf)return xe(e);throw new I("Invalid excludedArea area config")}function Ma(r,e,d){d===void 0&&(d=Object.getOwnPropertyDescriptor(r,e));var h=d.value;return d.value=function(){for(var f=this,g=arguments.length,C=Array(g),P=0;P<g;P++)C[P]=arguments[P];this.invokeTracker.apply(this,["%s: ".concat(0<C.length?"%s with args: ".concat(C.map(function(){return"%o"})):"%s"),this.name,e].concat(G(C.map(ye))));try{var x=h.apply(this,C)}catch(Vt){throw this.logError.apply(this,["".concat(Vt.code!==void 0?"Error Code ".concat(Vt.code,": "):"","%s failed").concat(0<C.length?" with args: ".concat(C.map(function(){return"%o"})):""),e].concat(G(C.map(ye)))),Vt.originalError&&this.logError(Vt.originalError),this.errorTracker(Vt),Vt}var B=Date.now();return J(w.mark(function Vt(){var _r,_e;return w.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:return _i.prev=0,_i.next=3,x;case 3:_r=_i.sent,_i.next=12;break;case 6:return _i.prev=6,_i.t0=_i.catch(0),f.logError.apply(f,["".concat(_i.t0.code!==void 0?"Error Code ".concat(_i.t0.code,": "):"","%s failed").concat(0<C.length?" with args: ".concat(C.map(function(){return"%o"})):""),e].concat(G(C.map(ye)))),_i.t0.originalError&&f.logError(_i.t0.originalError),f.errorTracker(_i.t0),_i.abrupt("return");case 12:_r!==x?_r===void 0?f.resultTracker("%s promise resolves after %dms",e,Date.now()-B):f.resultTracker("%s promise resolves after %dms, result is %o",e,Date.now()-B,ye(_r)):Ac(_r)!=="Object"||yd(_r)?f.resultTracker("%s result is %o",e,ye(_r)):f.resultTracker("%s result is %s",e,_r.name||((_e=_r.constructor)===null||_e===void 0?void 0:_e.name));case 13:case"end":return _i.stop()}},Vt,null,[[0,6]])}))(),x},d}function Nb(r,e,d){d===void 0&&(d=Object.getOwnPropertyDescriptor(r,e));var h=d.value;return d.value=function(){for(var f=this,g=arguments.length,C=Array(g),P=0;P<g;P++)C[P]=arguments[P];this.invokeTracker.apply(this,["%s: ".concat(0<C.length?"%s with args: ".concat(C.map(function(){return"%o"})):"%s"),this.name,e].concat(C));try{var x=h.apply(this,C)}catch(Vt){throw this.logError.apply(this,["".concat(Vt.code!==void 0?"Error Code ".concat(Vt.code,": "):"","%s failed").concat(0<C.length?" with args: ".concat(C.map(function(){return"%o"})):""),e].concat(C)),Vt.originalError&&this.logError(Vt.originalError),this.errorTracker(Vt),Vt}var B=Date.now();return J(w.mark(function Vt(){var _r,_e;return w.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:return _i.prev=0,_i.next=3,x;case 3:_r=_i.sent,_i.next=12;break;case 6:return _i.prev=6,_i.t0=_i.catch(0),f.logError.apply(f,["".concat(_i.t0.code!==void 0?"Error Code ".concat(_i.t0.code,": "):"","%s failed").concat(0<C.length?" with args: ".concat(C.map(function(){return"%o"})):""),e].concat(C)),_i.t0.originalError&&f.logError(_i.t0.originalError),f.errorTracker(_i.t0),_i.abrupt("return");case 12:_r!==x?_r===void 0?f.resultTracker("%s promise resolves after %dms",e,Date.now()-B):f.resultTracker("%s promise resolves after %dms, result is %o",e,Date.now()-B,_r):Ac(_r)!=="Object"||yd(_r)?f.resultTracker("%s result is %o",e,_r):f.resultTracker("%s result is %s",e,_r.name||((_e=_r.constructor)===null||_e===void 0?void 0:_e.name));case 13:case"end":return _i.stop()}},Vt,null,[[0,6]])}))(),x},d}function du(r,e){var d="".concat(r,"Uri");if(typeof(d=Li[d])!="number"||d===0)throw new TypeError("Got Unknown URI Name");return e=new(r=$m[r])(e),e=r.encode(e).finish(),new eu({uri:d,data:e})}function an(r,e){return"".concat(r.split(".").join("-"),".edge.").concat(e?"sd-rtn.com":"agora.io")}function eb(r,e,d){return Mi.apply(this,arguments)}function Mi(){return(Mi=J(w.mark(function r(e,d,h){var f,g;return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:C.next=2;break;case 2:return f=fu[e].encode(d).finish(),g=function(){var P=J(w.mark(function x(B){var Vt,_r,_e,_i=arguments;return w.wrap(function(_a){for(;;)switch(_a.prev=_a.next){case 0:if(!(3<(_r=1<_i.length&&_i[1]!==void 0?_i[1]:0))){_a.next=3;break}return _a.abrupt("return");case 3:return _e=we(_e=h?"https://".concat((Vt=M==null?void 0:M.PROXY_NGINX[0])!==null&&Vt!==void 0?Vt:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(B,"&p=6443&d=events/proto-raw"):"https://".concat(B,":6443/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),_e=we(_e,"id",gu[e].toString()),_a.next=8,te(_e,{body:f,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch(function(kc){return g(B,_r+1)});case 8:case"end":return _a.stop()}},x)}));return function(x){return P.apply(this,arguments)}}(),C.prev=4,C.next=7,g((M==null?void 0:M.EVENT_REPORT_DOMAIN[0])||"webcollector-rtm.agora.io");case 7:C.next=13;break;case 9:return C.prev=9,C.t0=C.catch(4),C.next=13,g(M&&bn(1<(M==null?void 0:M.EVENT_REPORT_DOMAIN.length)?M==null?void 0:M.EVENT_REPORT_DOMAIN.slice(1):M==null?void 0:M.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 13:case"end":return C.stop()}},r,null,[[4,9]])}))).apply(this,arguments)}function fb(r){return r===void 0?U.fromNumber(0):U.fromNumber(Date.now()-r)}function hu(r){return btoa(String.fromCharCode.apply({},r.replace(/\r|\n/g,"").replace(/([\dA-Fa-f]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ").map(function(e){return parseInt(e,16)}))).replace(/={1,2}$/,"")}function Lg(r,e){return U.fromValue(r).eq(e)}function Mg(r,e){var d=e===void 0?r.val:e,h=r.isBoolean;e=r.isNumber;var f=r.oneof,g=r.len;if([h,e,f].filter(function(C){return!C}).length!==2)throw new TypeError("invalid field type");if(d!==void 0&&(r=!1,f!==void 0&&(f=Ni(f),iu(f,Lg).length===f.length&&ju(f,function(C){return Lg(d,C)})!==void 0&&(r=!0)),h=h!==void 0&&(d===0||d===1)&&g===1,e=e!==void 0&&d.toString(2).length<=g,!(r||h||e)))throw Error("invalid field value")}function cn(r){return function(){var e=r();if(!e)throw new K("Client is not logged in. Cannot do the operation");return e}}var Ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{},Ng=function(r){return r&&r.Math==Math&&r},y=Ng(typeof globalThis=="object"&&globalThis)||Ng(typeof window=="object"&&window)||Ng(typeof self=="object"&&self)||Ng(typeof Ya=="object"&&Ya)||function(){return this}()||Function("return this")(),R=function(r){try{return!!r()}catch{return!0}},ka=!R(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),dn={}.propertyIsEnumerable,en=Object.getOwnPropertyDescriptor,zf=en&&!dn.call({1:2},1)?function(r){return!!(r=en(this,r))&&r.enumerable}:dn,dd=function(r,e){return{enumerable:!(1&r),configurable:!(2&r),writable:!(4&r),value:e}},ku={}.toString,Zb=function(r){return ku.call(r).slice(8,-1)},lu="".split,Af=R(function(){return!Object("z").propertyIsEnumerable(0)})?function(r){return Zb(r)=="String"?lu.call(r,""):Object(r)}:Object,jb=function(r){if(r==null)throw TypeError("Can't call method on "+r);return r},qb=function(r){return Af(jb(r))},ha=function(r){return typeof r=="object"?r!==null:typeof r=="function"},lc=function(r,e){if(!ha(r))return r;var d,h;if(e&&typeof(d=r.toString)=="function"&&!ha(h=d.call(r))||typeof(d=r.valueOf)=="function"&&!ha(h=d.call(r))||!e&&typeof(d=r.toString)=="function"&&!ha(h=d.call(r)))return h;throw TypeError("Can't convert object to primitive value")},Qa=function(r){return Object(jb(r))},mu={}.hasOwnProperty,Q=function(r,e){return mu.call(Qa(r),e)},ze=y.document,Og=ha(ze)&&ha(ze.createElement),fn=!ka&&!R(function(){return Object.defineProperty(Og?ze.createElement("div"):{},"a",{get:function(){return 7}}).a!=7}),gn=Object.getOwnPropertyDescriptor,Fb={f:ka?gn:function(r,e){if(r=qb(r),e=lc(e,!0),fn)try{return gn(r,e)}catch{}if(Q(r,e))return dd(!zf.call(r,e),r[e])}},va=function(r){if(!ha(r))throw TypeError(String(r)+" is not an object");return r},hn=Object.defineProperty,Ra={f:ka?hn:function(r,e,d){if(va(r),e=lc(e,!0),va(d),fn)try{return hn(r,e,d)}catch{}if("get"in d||"set"in d)throw TypeError("Accessors not supported");return"value"in d&&(r[e]=d.value),r}},Na=ka?function(r,e,d){return Ra.f(r,e,dd(1,d))}:function(r,e,d){return r[e]=d,r},Oi=function(r,e){try{Na(y,r,e)}catch{y[r]=e}return e},ed=y["__core-js_shared__"]||Oi("__core-js_shared__",{}),nu=Function.toString;typeof ed.inspectSource!="function"&&(ed.inspectSource=function(r){return nu.call(r)});var Pi=ed.inspectSource,jn=y.WeakMap,ou=typeof jn=="function"&&/native code/.test(Pi(jn)),fd=$a(function(r){(r.exports=function(e,d){return ed[e]||(ed[e]=d!==void 0?d:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"})}),pu=0,qu=Math.random(),Ae=function(r){return"Symbol("+String(r===void 0?"":r)+")_"+(++pu+qu).toString(36)},kn=fd("keys"),Pg=function(r){return kn[r]||(kn[r]=Ae(r))},Be={},ru=y.WeakMap;if(ou||ed.state)var Gd=ed.state||(ed.state=new ru),su=Gd.get,ln=Gd.has,tu=Gd.set,Qi=function(r,e){if(ln.call(Gd,r))throw new TypeError("Object already initialized");return e.facade=r,tu.call(Gd,r,e),e},Qg=function(r){return su.call(Gd,r)||{}},Ri=function(r){return ln.call(Gd,r)};else{var Ce=Pg("state");Be[Ce]=!0,Qi=function(r,e){if(Q(r,Ce))throw new TypeError("Object already initialized");return e.facade=r,Na(r,Ce,e),e},Qg=function(r){return Q(r,Ce)?r[Ce]:{}},Ri=function(r){return Q(r,Ce)}}var Za={set:Qi,get:Qg,has:Ri,enforce:function(r){return Ri(r)?Qg(r):Qi(r,{})},getterFor:function(r){return function(e){var d;if(!ha(e)||(d=Qg(e)).type!==r)throw TypeError("Incompatible receiver, "+r+" required");return d}}},Ta=$a(function(r){var e=Za.get,d=Za.enforce,h=String(String).split("String");(r.exports=function(f,g,C,P){var x=!!P&&!!P.unsafe,B=!!P&&!!P.enumerable;if(P=!!P&&!!P.noTargetGet,typeof C=="function"){typeof g!="string"||Q(C,"name")||Na(C,"name",g);var Vt=d(C);Vt.source||(Vt.source=h.join(typeof g=="string"?g:""))}f===y?B?f[g]=C:Oi(g,C):(x?!P&&f[g]&&(B=!0):delete f[g],B?f[g]=C:Na(f,g,C))})(Function.prototype,"toString",function(){return typeof this=="function"&&e(this).source||Pi(this)})}),mn=function(r){return typeof r=="function"?r:void 0},mc=function(r,e){return 2>arguments.length?mn(y[r])||mn(y[r]):y[r]&&y[r][e]||y[r]&&y[r][e]},uu=Math.ceil,vu=Math.floor,$b=function(r){return isNaN(r=+r)?0:(0<r?vu:uu)(r)},wu=Math.min,ta=function(r){return 0<r?wu($b(r),9007199254740991):0},xu=Math.max,yu=Math.min,xb=function(r,e){return 0>(r=$b(r))?xu(r+e,0):yu(r,e)},nn=function(r){return function(e,d,h){e=qb(e);var f=ta(e.length);if(h=xb(h,f),r&&d!=d){for(;f>h;)if((d=e[h++])!=d)return!0}else for(;f>h;h++)if((r||h in e)&&e[h]===d)return r||h||0;return!r&&-1}},on=nn(!0),Si=nn(!1),pn=function(r,e){r=qb(r);var d,h=0,f=[];for(d in r)!Q(Be,d)&&Q(r,d)&&f.push(d);for(;e.length>h;)Q(r,d=e[h++])&&(~Si(f,d)||f.push(d));return f},Rg="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),zu=Rg.concat("length","prototype"),Hd={f:Object.getOwnPropertyNames||function(r){return pn(r,zu)}},Bf={f:Object.getOwnPropertySymbols},qn=mc("Reflect","ownKeys")||function(r){var e=Hd.f(va(r)),d=Bf.f;return d?e.concat(d(r)):e},rn=function(r,e){for(var d=qn(e),h=Ra.f,f=Fb.f,g=0;g<d.length;g++){var C=d[g];Q(r,C)||h(r,C,f(e,C))}},Au=/#|\.prototype\./,nc=function(r,e){return(r=Bu[Cu(r)])==Du||r!=Eu&&(typeof e=="function"?R(e):!!e)},Cu=nc.normalize=function(r){return String(r).replace(Au,".").toLowerCase()},Bu=nc.data={},Eu=nc.NATIVE="N",Du=nc.POLYFILL="P",Fu=Fb.f,N=function(r,e){var d,h,f,g=r.target,C=r.global,P=r.stat;if(h=C?y:P?y[g]||Oi(g,{}):(y[g]||{}).prototype)for(f in e){var x=e[f],B=r.noTargetGet?(d=Fu(h,f))&&d.value:h[f];if(!(d=nc(C?f:g+(P?".":"#")+f,r.forced))&&B!==void 0){if(typeof x==typeof B)continue;rn(x,B)}(r.sham||B&&B.sham)&&Na(x,"sham",!0);try{Ta(h,f,x,r)}catch{}}},yb=function(r){if(typeof r!="function")throw TypeError(String(r)+" is not a function");return r},Id=function(r,e,d){if(yb(r),e===void 0)return r;switch(d){case 0:return function(){return r.call(e)};case 1:return function(h){return r.call(e,h)};case 2:return function(h,f){return r.call(e,h,f)};case 3:return function(h,f,g){return r.call(e,h,f,g)}}return function(){return r.apply(e,arguments)}},gd=Array.isArray||function(r){return Zb(r)=="Array"},De=mc("navigator","userAgent")||"",sn=y.process,tn=sn&&sn.versions,un=tn&&tn.v8;if(un)var hd=un.split("."),Ti=4>hd[0]?1:hd[0]+hd[1];else De&&(hd=De.match(/Edge\/(\d+)/),(!hd||74<=hd[1])&&(hd=De.match(/Chrome\/(\d+)/))&&(Ti=hd[1]));var id=Ti&&+Ti,oc=!!Object.getOwnPropertySymbols&&!R(function(){return!String(Symbol())||!Symbol.sham&&id&&41>id}),vn=oc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Cf=fd("wks"),Df=y.Symbol,Gu=vn?Df:Df&&Df.withoutSetter||Ae,qa=function(r){return Q(Cf,r)&&(oc||typeof Cf[r]=="string")||(oc&&Q(Df,r)?Cf[r]=Df[r]:Cf[r]=Gu("Symbol."+r)),Cf[r]},Hu=qa("species"),Sg=function(r,e){if(gd(r)){var d=r.constructor;typeof d!="function"||d!==Array&&!gd(d.prototype)?ha(d)&&(d=d[Hu])===null&&(d=void 0):d=void 0}return new(d===void 0?Array:d)(e===0?0:e)},wn=[].push,jd=function(r){var e=r==1,d=r==2,h=r==3,f=r==4,g=r==6,C=r==7,P=r==5||g;return function(x,B,Vt,_r){var _e=Qa(x),_i=Af(_e);B=Id(B,Vt,3),Vt=ta(_i.length);var _a,kc=0;for(_r=_r||Sg,x=e?_r(x,Vt):d||C?_r(x,0):void 0;Vt>kc;kc++)if((P||kc in _i)&&(_a=B(_r=_i[kc],kc,_e),r))if(e)x[kc]=_a;else if(_a)switch(r){case 3:return!0;case 5:return _r;case 6:return kc;case 2:wn.call(x,_r)}else switch(r){case 4:return!1;case 7:wn.call(x,_r)}return g?-1:h||f?f:x}},Jd=jd(0),xn=jd(1),yn=jd(2),Iu=jd(3),Ju=jd(4),zn=jd(5),An=jd(6),Ku=qa("species"),Ef=function(r){return 51<=id||!R(function(){var e=[];return(e.constructor={})[Ku]=function(){return{foo:1}},e[r](Boolean).foo!==1})},Lu=Ef("filter");N({target:"Array",proto:!0,forced:!Lu},{filter:function(r){return yn(this,r,1<arguments.length?arguments[1]:void 0)}});var Dc=Object.keys||function(r){return pn(r,Rg)},Mu=R(function(){Dc(1)});N({target:"Object",stat:!0,forced:Mu},{keys:function(r){return Dc(Qa(r))}});var Ee=function(r,e){var d=[][r];return!!d&&R(function(){d.call(null,e||function(){throw 1},1)})},Nu=[].join,Ou=Af!=Object,Pu=Ee("join",",");N({target:"Array",proto:!0,forced:Ou||!Pu},{join:function(r){return Nu.call(qb(this),r===void 0?",":r)}});var Qu=Ef("map");N({target:"Array",proto:!0,forced:!Qu},{map:function(r){return xn(this,r,1<arguments.length?arguments[1]:void 0)}});var Ui=function(r){var e=r.return;if(e!==void 0)return va(e.call(r)).value},Fe={},Ru=qa("iterator"),Su=Array.prototype,Vi=function(r){return r!==void 0&&(Fe.Array===r||Su[Ru]===r)},Ge=function(r,e,d){(e=lc(e))in r?Ra.f(r,e,dd(0,d)):r[e]=d},Tu=qa("toStringTag"),Bn={};Bn[Tu]="z";var Wi=String(Bn)==="[object z]",Uu=qa("toStringTag"),Vu=Zb(function(){return arguments}())=="Arguments",Ff=Wi?Zb:function(r){var e;if(r===void 0)var d="Undefined";else{if(r===null)var h="Null";else{t:{var f=r=Object(r);try{h=f[Uu];break t}catch{}h=void 0}h=typeof(d=h)=="string"?d:Vu?Zb(r):(e=Zb(r))=="Object"&&typeof r.callee=="function"?"Arguments":e}d=h}return d},Wu=qa("iterator"),Xi=function(r){if(r!=null)return r[Wu]||r["@@iterator"]||Fe[Ff(r)]},Cn=qa("iterator"),Dn=!1;try{var Xu=0,En={next:function(){return{done:!!Xu++}},return:function(){Dn=!0}};En[Cn]=function(){return this},Array.from(En,function(){throw 2})}catch(r){}var Tg=function(r,e){if(!e&&!Dn)return!1;var d=!1;try{(e={})[Cn]=function(){return{next:function(){return{done:d=!0}}}},r(e)}catch{}return d},Yu=!Tg(function(r){Array.from(r)});N({target:"Array",stat:!0,forced:Yu},{from:function(r){var e,d=Qa(r),h=typeof this=="function"?this:Array,f=arguments.length,g=1<f?arguments[1]:void 0,C=g!==void 0,P=Xi(d),x=0;if(C&&(g=Id(g,2<f?arguments[2]:void 0,2)),P==null||h==Array&&Vi(P)){var B=ta(d.length);for(h=new h(B);B>x;x++)P=C?g(d[x],x):d[x],Ge(h,x,P)}else for(f=(d=P.call(d)).next,h=new h;!(e=f.call(d)).done;x++){if(C){P=d;var Vt=g;e=[e.value,x];try{B=Vt(va(e)[0],e[1])}catch(_r){throw Ui(P),_r}}else B=e.value;Ge(h,x,P=B)}return h.length=x,h}});var Fn=function(r){return function(e,d){e=String(jb(e)),d=$b(d);var h,f=e.length;if(0>d||d>=f)return r?"":void 0;var g=e.charCodeAt(d);return 55296>g||56319<g||d+1===f||56320>(h=e.charCodeAt(d+1))||57343<h?r?e.charAt(d):g:r?e.slice(d,d+2):h-56320+(g-55296<<10)+65536}},Gn=Fn(!0),Hn=!R(function(){function r(){}return r.prototype.constructor=null,Object.getPrototypeOf(new r)!==r.prototype}),In=Pg("IE_PROTO"),Zu=Object.prototype,Vb=Hn?Object.getPrototypeOf:function(r){return r=Qa(r),Q(r,In)?r[In]:typeof r.constructor=="function"&&r instanceof r.constructor?r.constructor.prototype:r instanceof Object?Zu:null},Yi=qa("iterator"),Jn=!1,$u=function(){return this},Kd;if([].keys){var Kn=[].keys();if("next"in Kn){var Ln=Vb(Vb(Kn));Ln!==Object.prototype&&(Kd=Ln)}else Jn=!0}(Kd==null||R(function(){var r={};return Kd[Yi].call(r)!==r}))&&(Kd={}),Q(Kd,Yi)||Na(Kd,Yi,$u);var Ug=Kd,Vg=Jn,av=ka?Object.defineProperties:function(r,e){va(r);for(var d,h=Dc(e),f=h.length,g=0;f>g;)Ra.f(r,d=h[g++],e[d]);return r},Zi=mc("document","documentElement"),Mn=Pg("IE_PROTO"),$i=function(){},aj,Wg=function(){try{aj=document.domain&&new ActiveXObject("htmlfile")}catch{}if(aj){var r=aj;r.write("<script><\/script>"),r.close(),r=r.parentWindow.Object}else(r=Og?ze.createElement("iframe"):{}).style.display="none",Zi.appendChild(r),r.src="javascript:",(r=r.contentWindow.document).open(),r.write("<script>document.F=Object<\/script>"),r.close(),r=r.F;for(Wg=r,r=Rg.length;r--;)delete Wg.prototype[Rg[r]];return Wg()};Be[Mn]=!0;var ac=Object.create||function(r,e){if(r!==null){$i.prototype=va(r);var d=new $i;$i.prototype=null,d[Mn]=r}else d=Wg();return e===void 0?d:av(d,e)},bv=Ra.f,Nn=qa("toStringTag"),Ec=function(r,e,d){r&&!Q(r=d?r:r.prototype,Nn)&&bv(r,Nn,{configurable:!0,value:e})},cv=function(){return this},dv=function(r,e,d){return e+=" Iterator",r.prototype=ac(Ug,{next:dd(1,d)}),Ec(r,e,!1),Fe[e]=cv,r},Ua=Object.setPrototypeOf||("__proto__"in{}?function(){var r=!1,e={};try{var d=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;d.call(e,[]),r=e instanceof Array}catch{}return function(h,f){if(va(h),!ha(f)&&f!==null)throw TypeError("Can't set "+String(f)+" as a prototype");return r?d.call(h,f):h.__proto__=f,h}}():void 0),Gf=qa("iterator"),ev=function(){return this},bj=function(r,e,d,h,f,g,C){dv(d,e,h),h=function(kc){if(kc===f&&_e)return _e;if(!Vg&&kc in Vt)return Vt[kc];switch(kc){case"keys":case"values":case"entries":return function(){return new d(this,kc)}}return function(){return new d(this)}};var P,x=e+" Iterator",B=!1,Vt=r.prototype,_r=Vt[Gf]||Vt["@@iterator"]||f&&Vt[f],_e=!Vg&&_r||h(f),_i=e=="Array"&&Vt.entries||_r;if(_i&&(r=Vb(_i.call(new r)),Ug!==Object.prototype&&r.next&&(Vb(r)!==Ug&&(Ua?Ua(r,Ug):typeof r[Gf]!="function"&&Na(r,Gf,ev)),Ec(r,x,!0))),f=="values"&&_r&&_r.name!=="values"&&(B=!0,_e=function(){return _r.call(this)}),Vt[Gf]!==_e&&Na(Vt,Gf,_e),Fe[e]=_e,f){var _a={values:h("values"),keys:g?_e:h("keys"),entries:h("entries")};if(C)for(P in _a)!Vg&&!B&&P in Vt||Ta(Vt,P,_a[P]);else N({target:e,proto:!0,forced:Vg||B},_a)}return _a},fv=Za.set,gv=Za.getterFor("String Iterator");bj(String,"String",function(r){fv(this,{type:"String Iterator",string:String(r),index:0})},function(){var r=gv(this),e=r.string,d=r.index;return d>=e.length?{value:void 0,done:!0}:(e=Gn(e,d),r.index+=e.length,{value:e,done:!1})});var cj=qa("unscopables"),dj=Array.prototype;dj[cj]==null&&Ra.f(dj,cj,{configurable:!0,value:ac(null)});var Ld=function(r){dj[cj][r]=!0},On=!0;"find"in[]&&Array(1).find(function(){On=!1}),N({target:"Array",proto:!0,forced:On},{find:function(r){return zn(this,r,1<arguments.length?arguments[1]:void 0)}}),Ld("find");var Pn=function(r){var e=String(jb(this)),d="";if(0>(r=$b(r))||1/0==r)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(e+=e))1&r&&(d+=e);return d};N({target:"String",proto:!0},{repeat:Pn}),N({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),N({target:"Number",stat:!0},{isNaN:function(r){return r!=r}}),y.Number.isNaN;var hv=Wi?{}.toString:function(){return"[object "+Ff(this)+"]"};Wi||Ta(Object.prototype,"toString",hv,{unsafe:!0});var Fc=y.Promise,Hf=function(r,e,d){for(var h in e)Ta(r,h,e[h],d);return r},Qn=qa("species"),If=function(r){r=mc(r);var e=Ra.f;ka&&r&&!r[Qn]&&e(r,Qn,{configurable:!0,get:function(){return this}})},Gc=function(r,e,d){if(!(r instanceof e))throw TypeError("Incorrect "+(d?d+" ":"")+"invocation");return r},Jf=function(r,e){this.stopped=r,this.result=e},Xg=function(r,e,d){var h,f=!(!d||!d.AS_ENTRIES),g=!(!d||!d.IS_ITERATOR),C=!(!d||!d.INTERRUPTED),P=Id(e,d&&d.that,1+f+C),x=function(Vt){return B&&Ui(B),new Jf(!0,Vt)};if(e=function(Vt){return f?(va(Vt),C?P(Vt[0],Vt[1],x):P(Vt[0],Vt[1])):C?P(Vt,x):P(Vt)},g)var B=r;else{if(typeof(g=Xi(r))!="function")throw TypeError("Target is not iterable");if(Vi(g)){for(g=0,d=ta(r.length);d>g;g++)if((h=e(r[g]))&&h instanceof Jf)return h;return new Jf(!1)}B=g.call(r)}for(r=B.next;!(g=r.call(B)).done;){try{h=e(g.value)}catch(Vt){throw Ui(B),Vt}if(typeof h=="object"&&h&&h instanceof Jf)return h}return new Jf(!1)},iv=qa("species"),kd=function(r,e){var d;return(r=va(r).constructor)===void 0||(d=va(r)[iv])==null?e:yb(d)},Rn=/(?:iphone|ipod|ipad).*applewebkit/i.test(De),Hc=Zb(y.process)=="process",Yg=y.location,ej=y.setImmediate,Sn=y.clearImmediate,jv=y.process,Tn=y.MessageChannel,fj=y.Dispatch,gj=0,Kf={},hj=function(r){if(Kf.hasOwnProperty(r)){var e=Kf[r];delete Kf[r],e()}},ij=function(r){return function(){hj(r)}},Un=function(r){hj(r.data)},Vn=function(r){y.postMessage(r+"",Yg.protocol+"//"+Yg.host)};if(!ej||!Sn)if(ej=function(r){for(var e=[],d=1;arguments.length>d;)e.push(arguments[d++]);return Kf[++gj]=function(){(typeof r=="function"?r:Function(r)).apply(void 0,e)},Lf(gj),gj},Sn=function(r){delete Kf[r]},Hc)var Lf=function(r){jv.nextTick(ij(r))};else if(fj&&fj.now)Lf=function(r){fj.now(ij(r))};else if(Tn&&!Rn){var Wn=new Tn,Xn=Wn.port2;Wn.port1.onmessage=Un,Lf=Id(Xn.postMessage,Xn,1)}else y.addEventListener&&typeof postMessage=="function"&&!y.importScripts&&Yg&&Yg.protocol!=="file:"&&!R(Vn)?(Lf=Vn,y.addEventListener("message",Un,!1)):Lf="onreadystatechange"in(Og?ze.createElement("script"):{})?function(r){Zi.appendChild(Og?ze.createElement("script"):{}).onreadystatechange=function(){Zi.removeChild(this),hj(r)}}:function(r){setTimeout(ij(r),0)};var jj=ej,kv=/web0s(?!.*chrome)/i.test(De),lv=Fb.f,Yn=y.MutationObserver||y.WebKitMutationObserver,Zn=y.document,$n=y.process,Zg=y.Promise,ao=lv(y,"queueMicrotask"),bo=ao&&ao.value,Md,Mf;if(!bo){var ah=function(){var r;for(Hc&&(r=$n.domain)&&r.exit();Md;){var e=Md.fn;Md=Md.next;try{e()}catch(d){throw Md?$g():Mf=void 0,d}}Mf=void 0,r&&r.enter()};if(Rn||Hc||kv||!Yn||!Zn)if(Zg&&Zg.resolve){var kj=Zg.resolve(void 0);kj.constructor=Zg;var mv=kj.then,$g=function(){mv.call(kj,ah)}}else $g=Hc?function(){$n.nextTick(ah)}:function(){jj.call(y,ah)};else{var co=!0,eo=Zn.createTextNode("");new Yn(ah).observe(eo,{characterData:!0}),$g=function(){eo.data=co=!co}}}var fo=bo||function(r){r={fn:r,next:void 0},Mf&&(Mf.next=r),Md||(Md=r,$g()),Mf=r},nv=function(r){var e,d;this.promise=new r(function(h,f){if(e!==void 0||d!==void 0)throw TypeError("Bad Promise constructor");e=h,d=f}),this.resolve=yb(e),this.reject=yb(d)},lj={f:function(r){return new nv(r)}},mj=function(r,e){return va(r),ha(e)&&e.constructor===r?e:((0,(r=lj.f(r)).resolve)(e),r.promise)},ov=function(r,e){var d=y.console;d&&d.error&&(arguments.length===1?d.error(r):d.error(r,e))},nj=function(r){try{return{error:!1,value:r()}}catch(e){return{error:!0,value:e}}},pv=typeof window=="object",qv=qa("species"),go=Za.get,rv=Za.set,sv=Za.getterFor("Promise"),Nd=Fc&&Fc.prototype,zb=Fc,bh=Nd,ho=y.TypeError,oj=y.document,pj=y.process,He=lj.f,tv=He,uv=!!(oj&&oj.createEvent&&y.dispatchEvent),io=typeof PromiseRejectionEvent=="function",jo=!1,Nf=nc("Promise",function(){var r=Pi(zb)!==String(zb);if(!r&&id===66)return!0;if(51<=id&&/native code/.test(zb))return!1;var e=new zb(function(h){h(1)}),d=function(h){h(function(){},function(){})};return(e.constructor={})[qv]=d,!(jo=e.then(function(){})instanceof d)||!r&&pv&&!io}),vv=Nf||!Tg(function(r){zb.all(r).catch(function(){})}),ko=function(r){var e;return!(!ha(r)||typeof(e=r.then)!="function")&&e},qj=function(r,e){if(!r.notified){r.notified=!0;var d=r.reactions;fo(function(){for(var h=r.value,f=r.state==1,g=0;d.length>g;){var C,P=d[g++],x=f?P.ok:P.fail,B=P.resolve,Vt=P.reject,_r=P.domain;try{if(x){if(f||(r.rejection===2&&wv(r),r.rejection=1),x===!0)var _e=h;else if(_r&&_r.enter(),_e=x(h),_r){_r.exit();var _i=!0}_e===P.promise?Vt(ho("Promise-chain cycle")):(C=ko(_e))?C.call(_e,B,Vt):B(_e)}else Vt(h)}catch(_a){_r&&!_i&&_r.exit(),Vt(_a)}}r.reactions=[],r.notified=!1,e&&!r.rejection&&xv(r)})}},lo=function(r,e,d){var h;if(uv){var f=oj.createEvent("Event");f.promise=e,f.reason=d,f.initEvent(r,!1,!0),y.dispatchEvent(f)}else f={promise:e,reason:d};!io&&(h=y["on"+r])?h(f):r==="unhandledrejection"&&ov("Unhandled promise rejection",d)},xv=function(r){jj.call(y,function(){var e=r.facade,d=r.value;if(r.rejection!==1&&!r.parent){var h=nj(function(){Hc?pj.emit("unhandledRejection",d,e):lo("unhandledrejection",e,d)});if(r.rejection=Hc||r.rejection!==1&&!r.parent?2:1,h.error)throw h.value}})},wv=function(r){jj.call(y,function(){var e=r.facade;Hc?pj.emit("rejectionHandled",e):lo("rejectionhandled",e,r.value)})},Ie=function(r,e,d){return function(h){r(e,h,d)}},Je=function(r,e,d){r.done||(r.done=!0,d&&(r=d),r.value=e,r.state=2,qj(r,!0))},rj=function(r,e,d){if(!r.done){r.done=!0,d&&(r=d);try{if(r.facade===e)throw ho("Promise can't be resolved itself");var h=ko(e);h?fo(function(){var f={done:!1};try{h.call(e,Ie(rj,f,r),Ie(Je,f,r))}catch(g){Je(f,g,r)}}):(r.value=e,r.state=1,qj(r,!1))}catch(f){Je({done:!1},f,r)}}};if(Nf){zb=function(r){Gc(this,zb,"Promise"),yb(r),sj.call(this);var e=go(this);try{r(Ie(rj,e),Ie(Je,e))}catch(d){Je(e,d)}},bh=zb.prototype;var sj=function(r){rv(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};sj.prototype=Hf(bh,{then:function(r,e){var d=sv(this),h=He(kd(this,zb));return h.ok=typeof r!="function"||r,h.fail=typeof e=="function"&&e,h.domain=Hc?pj.domain:void 0,d.parent=!0,d.reactions.push(h),d.state!=0&&qj(d,!1),h.promise},catch:function(r){return this.then(void 0,r)}});var yv=function(){var r=new sj,e=go(r);this.promise=r,this.resolve=Ie(rj,e),this.reject=Ie(Je,e)};if(lj.f=He=function(r){return r===zb||r===zv?new yv(r):tv(r)},typeof Fc=="function"&&Nd!==Object.prototype){var Av=Nd.then;jo||(Ta(Nd,"then",function(r,e){var d=this;return new zb(function(h,f){Av.call(d,h,f)}).then(r,e)},{unsafe:!0}),Ta(Nd,"catch",bh.catch,{unsafe:!0}));try{delete Nd.constructor}catch{}Ua&&Ua(Nd,bh)}}N({global:!0,wrap:!0,forced:Nf},{Promise:zb}),Ec(zb,"Promise",!1),If("Promise");var zv=mc("Promise");N({target:"Promise",stat:!0,forced:Nf},{reject:function(r){var e=He(this);return e.reject.call(void 0,r),e.promise}}),N({target:"Promise",stat:!0,forced:Nf},{resolve:function(r){return mj(this,r)}}),N({target:"Promise",stat:!0,forced:vv},{all:function(r){var e=this,d=He(e),h=d.resolve,f=d.reject,g=nj(function(){var C=yb(e.resolve),P=[],x=0,B=1;Xg(r,function(Vt){var _r=x++,_e=!1;P.push(void 0),B++,C.call(e,Vt).then(function(_i){_e||(_e=!0,P[_r]=_i,--B||h(P))},f)}),--B||h(P)});return g.error&&f(g.value),d.promise},race:function(r){var e=this,d=He(e),h=d.reject,f=nj(function(){var g=yb(e.resolve);Xg(r,function(C){g.call(e,C).then(d.resolve,h)})});return f.error&&h(f.value),d.promise}});var mo=[].indexOf,no=!!mo&&0>1/[1].indexOf(1,-0),Bv=Ee("indexOf");N({target:"Array",proto:!0,forced:no||!Bv},{indexOf:function(r){return no?mo.apply(this,arguments)||0:Si(this,r,1<arguments.length?arguments[1]:void 0)}});var tj=function(){var r=va(this),e="";return r.global&&(e+="g"),r.ignoreCase&&(e+="i"),r.multiline&&(e+="m"),r.dotAll&&(e+="s"),r.unicode&&(e+="u"),r.sticky&&(e+="y"),e},pc=R(function(){var r=RegExp("a","y");return r.lastIndex=2,r.exec("abcd")!=null}),Cv=R(function(){var r=RegExp("^r","gy");return r.lastIndex=2,r.exec("str")!=null}),ch=RegExp.prototype.exec,Dv=fd("native-string-replace",String.prototype.replace),oo=ch,uj=(c=/a/,a=/b*/g,ch.call(c,"a"),ch.call(a,"a"),c.lastIndex!==0||a.lastIndex!==0),po=pc||Cv,vj=/()??/.exec("")[1]!==void 0,c,a;(uj||vj||po)&&(oo=function(r){var e,d=po&&this.sticky,h=tj.call(this),f=this.source,g=0,C=r;if(d){(h=h.replace("y","")).indexOf("g")===-1&&(h+="g"),C=String(r).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&r[this.lastIndex-1]!==`
`)&&(f="(?: "+f+")",C=" "+C,g++);var P=new RegExp("^(?:"+f+")",h)}if(vj&&(P=new RegExp("^"+f+"$(?!\\s)",h)),uj)var x=this.lastIndex;var B=ch.call(d?P:this,C);return d?B?(B.input=B.input.slice(g),B[0]=B[0].slice(g),B.index=this.lastIndex,this.lastIndex+=B[0].length):this.lastIndex=0:uj&&B&&(this.lastIndex=this.global?B.index+B[0].length:x),vj&&B&&1<B.length&&Dv.call(B[0],P,function(){for(e=1;e<arguments.length-2;e++)arguments[e]===void 0&&(B[e]=void 0)}),B});var Of=oo;N({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Ev=qa("species"),wj=RegExp.prototype,Fv=!R(function(){var r=/./;return r.exec=function(){var e=[];return e.groups={a:"7"},e},"".replace(r,"$<a>")!=="7"}),qo="a".replace(/./,"$0")==="$0",ro=qa("replace"),so=!!/./[ro]&&/./[ro]("a","$0")==="",Gv=!R(function(){var r=/(?:)/,e=r.exec;return r.exec=function(){return e.apply(this,arguments)},(r="ab".split(r)).length!==2||r[0]!=="a"||r[1]!=="b"}),dh=function(r,e,d,h){var f=qa(r),g=!R(function(){var B={};return B[f]=function(){return 7},""[r](B)!=7}),C=g&&!R(function(){var B=!1,Vt=/a/;return r==="split"&&((Vt={constructor:{}}).constructor[Ev]=function(){return Vt},Vt.flags="",Vt[f]=/./[f]),Vt.exec=function(){return B=!0,null},Vt[f](""),!B});if(!g||!C||r==="replace"&&(!Fv||!qo||so)||r==="split"&&!Gv){var P=/./[f],x=(d=d(f,""[r],function(B,Vt,_r,_e,_i){var _a=Vt.exec;return _a===Of||_a===wj.exec?g&&!_i?{done:!0,value:P.call(Vt,_r,_e)}:{done:!0,value:B.call(_r,Vt,_e)}:{done:!1}},{REPLACE_KEEPS_$0:qo,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:so}))[1];Ta(String.prototype,r,d[0]),Ta(wj,f,e==2?function(B,Vt){return x.call(B,this,Vt)}:function(B){return x.call(B,this)})}h&&Na(wj[f],"sham",!0)},xj=function(r,e,d){return e+(d?Gn(r,e).length:1)},Hv=Math.floor,Iv="".replace,Jv=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Kv=/\$([$&'`]|\d{1,2})/g,Lv=function(r,e,d,h,f,g){var C=d+r.length,P=h.length,x=Kv;return f!==void 0&&(f=Qa(f),x=Jv),Iv.call(g,x,function(B,Vt){switch(Vt.charAt(0)){case"$":return"$";case"&":return r;case"`":return e.slice(0,d);case"'":return e.slice(C);case"<":B=f[Vt.slice(1,-1)];break;default:var _r=+Vt;if(_r===0)return B;if(_r>P)return(_r=Hv(_r/10))===0?B:_r<=P?h[_r-1]===void 0?Vt.charAt(1):h[_r-1]+Vt.charAt(1):B;B=h[_r-1]}return B===void 0?"":B})},Ke=function(r,e){var d=r.exec;if(typeof d=="function"){if(typeof(r=d.call(r,e))!="object")throw TypeError("RegExp exec method returned something other than an Object or null");return r}if(Zb(r)!=="RegExp")throw TypeError("RegExp#exec called on incompatible receiver");return Of.call(r,e)},Mv=Math.max,Nv=Math.min,Ov=function(r){return r===void 0?r:String(r)};dh("replace",2,function(r,e,d,h){var f=h.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,g=h.REPLACE_KEEPS_$0,C=f?"$":"$0";return[function(P,x){var B=jb(this),Vt=P==null?void 0:P[r];return Vt!==void 0?Vt.call(P,B,x):e.call(String(B),P,x)},function(P,x){if(!f&&g||typeof x=="string"&&x.indexOf(C)===-1){var B=d(e,P,this,x);if(B.done)return B.value}var Vt=va(P);P=String(this),(B=typeof x=="function")||(x=String(x));var _r=Vt.global;if(_r){var _e=Vt.unicode;Vt.lastIndex=0}for(var _i=[];;){var _a=Ke(Vt,P);if(_a===null||(_i.push(_a),!_r))break;String(_a[0])===""&&(Vt.lastIndex=xj(P,ta(Vt.lastIndex),_e))}for(_e="",_r=Vt=0;_r<_i.length;_r++){_a=_i[_r];for(var kc=String(_a[0]),_d=Mv(Nv($b(_a.index),P.length),0),_l=[],_h=1;_h<_a.length;_h++)_l.push(Ov(_a[_h]));_a=_a.groups,B?(_l=[kc].concat(_l,_d,P),_a!==void 0&&_l.push(_a),_a=String(x.apply(void 0,_l))):_a=Lv(kc,P,_d,_l,_a,x),_d>=Vt&&(_e+=P.slice(Vt,_d)+_a,Vt=_d+kc.length)}return _e+P.slice(Vt)}]});var Pv=Ef("slice"),Qv=qa("species"),Rv=[].slice,Sv=Math.max;N({target:"Array",proto:!0,forced:!Pv},{slice:function(r,e){var d=qb(this),h=ta(d.length);if(r=xb(r,h),e=xb(e===void 0?h:e,h),gd(d)){var f=d.constructor;if(typeof f!="function"||f!==Array&&!gd(f.prototype)?ha(f)&&(f=f[Qv])===null&&(f=void 0):f=void 0,f===Array||f===void 0)return Rv.call(d,r,e)}for(f=new(f===void 0?Array:f)(Sv(e-r,0)),h=0;r<e;r++,h++)r in d&&Ge(f,h,d[r]);return f.length=h,f}});var Tv=Za.set,Uv=Za.getterFor("Array Iterator"),ld=bj(Array,"Array",function(r,e){Tv(this,{type:"Array Iterator",target:qb(r),index:0,kind:e})},function(){var r=Uv(this),e=r.target,d=r.kind,h=r.index++;return!e||h>=e.length?(r.target=void 0,{value:void 0,done:!0}):d=="keys"?{value:h,done:!1}:d=="values"?{value:e[h],done:!1}:{value:[h,e[h]],done:!1}},"values");Fe.Arguments=Fe.Array,Ld("keys"),Ld("values"),Ld("entries");var to=typeof ArrayBuffer<"u"&&typeof DataView<"u",Le=function(r){if(r===void 0)return 0;r=$b(r);var e=ta(r);if(r!==e)throw RangeError("Wrong length or index");return e},Vv=Math.abs,Ic=Math.pow,Wv=Math.floor,Xv=Math.log,Yv=Math.LN2,yj=function(r){var e=Qa(this),d=ta(e.length),h=arguments.length,f=xb(1<h?arguments[1]:void 0,d);for(d=(h=2<h?arguments[2]:void 0)===void 0?d:xb(h,d);d>f;)e[f++]=r;return e},Zv=Hd.f,$v=Ra.f,Me=Za.get,uo=Za.set,bc=y.ArrayBuffer,Ab=bc,cc=y.DataView,eh=cc&&cc.prototype,vo=Object.prototype,fh=y.RangeError,wo=function(r,e,d){var h,f=Array(d),g=(1<<(d=8*d-e-1))-1,C=g>>1,P=e===23?Ic(2,-24)-Ic(2,-77):0,x=0>r||r===0&&0>1/r?1:0,B=0;if((r=Vv(r))!=r||1/0===r){r=r!=r?1:0;var Vt=g}else Vt=Wv(Xv(r)/Yv),1>r*(h=Ic(2,-Vt))&&(Vt--,h*=2),2<=(r=1<=Vt+C?r+P/h:r+P*Ic(2,1-C))*h&&(Vt++,h/=2),Vt+C>=g?(r=0,Vt=g):1<=Vt+C?(r=(r*h-1)*Ic(2,e),Vt+=C):(r=r*Ic(2,C-1)*Ic(2,e),Vt=0);for(;8<=e;f[B++]=255&r,r/=256,e-=8);for(Vt=Vt<<e|r,d+=e;0<d;f[B++]=255&Vt,Vt/=256,d-=8);return f[--B]|=128*x,f},xo=function(r,e){var d=r.length,h=8*d-e-1,f=(1<<h)-1,g=f>>1;h-=7,--d;var C=r[d--],P=127&C;for(C>>=7;0<h;P=256*P+r[d],d--,h-=8);var x=P&(1<<-h)-1;for(P>>=-h,h+=e;0<h;x=256*x+r[d],d--,h-=8);if(P===0)P=1-g;else{if(P===f)return x?NaN:C?-1/0:1/0;x+=Ic(2,e),P-=g}return(C?-1:1)*x*Ic(2,P-e)},yo=function(r){return[255&r]},zo=function(r){return[255&r,r>>8&255]},Ao=function(r){return[255&r,r>>8&255,r>>16&255,r>>24&255]},Bo=function(r){return r[3]<<24|r[2]<<16|r[1]<<8|r[0]},aw=function(r){return wo(r,23,4)},bw=function(r){return wo(r,52,8)},gh=function(r,e){$v(r.prototype,e,{get:function(){return Me(this)[e]}})},md=function(r,e,d,h){d=Le(d);var f=Me(r);if(d+e>f.byteLength)throw fh("Wrong index");return r=Me(f.buffer).bytes,d+=f.byteOffset,e=r.slice(d,d+e),h?e:e.reverse()},nd=function(r,e,d,h,f,g){d=Le(d);var C=Me(r);if(d+e>C.byteLength)throw fh("Wrong index");for(r=Me(C.buffer).bytes,d+=C.byteOffset,h=h(+f),f=0;f<e;f++)r[d+f]=h[g?f:e-f-1]};if(to){if(!R(function(){bc(1)})||!R(function(){new bc(-1)})||R(function(){return new bc,new bc(1.5),new bc(NaN),bc.name!="ArrayBuffer"})){Ab=function(r){return Gc(this,Ab),new bc(Le(r))};for(var cw=Ab.prototype=bc.prototype,Co=Zv(bc),Do=0,zj;Co.length>Do;)(zj=Co[Do++])in Ab||Na(Ab,zj,bc[zj]);cw.constructor=Ab}Ua&&Vb(eh)!==vo&&Ua(eh,vo);var hh=new cc(new Ab(2)),Eo=eh.setInt8;hh.setInt8(0,2147483648),hh.setInt8(1,2147483649),!hh.getInt8(0)&&hh.getInt8(1)||Hf(eh,{setInt8:function(r,e){Eo.call(this,r,e<<24>>24)},setUint8:function(r,e){Eo.call(this,r,e<<24>>24)}},{unsafe:!0})}else Ab=function(r){Gc(this,Ab,"ArrayBuffer"),r=Le(r),uo(this,{bytes:yj.call(Array(r),0),byteLength:r}),ka||(this.byteLength=r)},cc=function(r,e,d){Gc(this,cc,"DataView"),Gc(r,Ab,"DataView");var h=Me(r).byteLength;if(0>(e=$b(e))||e>h)throw fh("Wrong offset");if(e+(d=d===void 0?h-e:ta(d))>h)throw fh("Wrong length");uo(this,{buffer:r,byteLength:d,byteOffset:e}),ka||(this.buffer=r,this.byteLength=d,this.byteOffset=e)},ka&&(gh(Ab,"byteLength"),gh(cc,"buffer"),gh(cc,"byteLength"),gh(cc,"byteOffset")),Hf(cc.prototype,{getInt8:function(r){return md(this,1,r)[0]<<24>>24},getUint8:function(r){return md(this,1,r)[0]},getInt16:function(r){var e=md(this,2,r,1<arguments.length?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(r){var e=md(this,2,r,1<arguments.length?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(r){return Bo(md(this,4,r,1<arguments.length?arguments[1]:void 0))},getUint32:function(r){return Bo(md(this,4,r,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(r){return xo(md(this,4,r,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(r){return xo(md(this,8,r,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(r,e){nd(this,1,r,yo,e)},setUint8:function(r,e){nd(this,1,r,yo,e)},setInt16:function(r,e){nd(this,2,r,zo,e,2<arguments.length?arguments[2]:void 0)},setUint16:function(r,e){nd(this,2,r,zo,e,2<arguments.length?arguments[2]:void 0)},setInt32:function(r,e){nd(this,4,r,Ao,e,2<arguments.length?arguments[2]:void 0)},setUint32:function(r,e){nd(this,4,r,Ao,e,2<arguments.length?arguments[2]:void 0)},setFloat32:function(r,e){nd(this,4,r,aw,e,2<arguments.length?arguments[2]:void 0)},setFloat64:function(r,e){nd(this,8,r,bw,e,2<arguments.length?arguments[2]:void 0)}});Ec(Ab,"ArrayBuffer"),Ec(cc,"DataView");var Pf={ArrayBuffer:Ab,DataView:cc},Aj=Pf.ArrayBuffer,Fo=Pf.DataView,Go=Aj.prototype.slice,dw=R(function(){return!new Aj(2).slice(1,void 0).byteLength});N({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:dw},{slice:function(r,e){if(Go!==void 0&&e===void 0)return Go.call(va(this),r);var d=va(this).byteLength;r=xb(r,d),e=xb(e===void 0?d:e,d),d=new(kd(this,Aj))(ta(e-r));for(var h=new Fo(this),f=new Fo(d),g=0;r<e;)f.setUint8(g++,h.getUint8(r++));return d}});var ew=Ra.f,ih=y.Int8Array,Bj=ih&&ih.prototype,Ho=y.Uint8ClampedArray,Io=Ho&&Ho.prototype,qc=ih&&Vb(ih),dc=Bj&&Vb(Bj),Jo=Object.prototype,Ko=Jo.isPrototypeOf,Lo=qa("toStringTag"),Cj=Ae("TYPED_ARRAY_TAG"),Jc=to&&!!Ua&&Ff(y.opera)!=="Opera",Mo=!1,Bb,rc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},fw={BigInt64Array:8,BigUint64Array:8},jh=function(r){return!!ha(r)&&(r=Ff(r),Q(rc,r)||Q(fw,r))};for(Bb in rc)y[Bb]||(Jc=!1);if((!Jc||typeof qc!="function"||qc===Function.prototype)&&(qc=function(){throw TypeError("Incorrect invocation")},Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb],qc);if((!Jc||!dc||dc===Jo)&&(dc=qc.prototype,Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb].prototype,dc);if(Jc&&Vb(Io)!==dc&&Ua(Io,dc),ka&&!Q(dc,Lo))for(Bb in Mo=!0,ew(dc,Lo,{get:function(){return ha(this)?this[Cj]:void 0}}),rc)y[Bb]&&Na(y[Bb],Cj,Bb);var Qf=Jc,No=Mo&&Cj,Da=function(r){if(jh(r))return r;throw TypeError("Target is not a typed array")},Ne=function(r){if(Ua){if(Ko.call(qc,r))return r}else for(var e in rc)if(Q(rc,Bb)){var d=y[e];if(d&&(r===d||Ko.call(d,r)))return r}throw TypeError("Target is not a typed array constructor")},Aa=function(r,e,d){if(ka){if(d)for(var h in rc){var f=y[h];if(f&&Q(f.prototype,r))try{delete f.prototype[r]}catch{}}dc[r]&&!d||Ta(dc,r,d?e:Jc&&Bj[r]||e)}},Oo=function(r,e,d){var h,f;if(ka){if(Ua){if(d){for(h in rc)if((f=y[h])&&Q(f,r))try{delete f[r]}catch{}}if(qc[r]&&!d)return;try{return Ta(qc,r,d?e:Jc&&qc[r]||e)}catch{}}for(h in rc)!(f=y[h])||f[r]&&!d||Ta(f,r,e)}},Po=qc,Rf=dc,gw=y.ArrayBuffer,Od=y.Int8Array,Dj=!Qf||!R(function(){Od(1)})||!R(function(){new Od(-1)})||!Tg(function(r){new Od,new Od(null),new Od(1.5),new Od(r)},!0)||R(function(){return new Od(new gw(2),1,void 0).length!==1}),kh=function(r,e){if(0>(r=$b(r)))throw RangeError("The argument can't be less than 0");if(r%e)throw RangeError("Wrong offset");return r},Ej=function(r){var e=Qa(r),d=arguments.length,h=1<d?arguments[1]:void 0,f=h!==void 0,g=Xi(e);if(g!=null&&!Vi(g)){var C=g.call(e),P=C.next;for(e=[];!(g=P.call(C)).done;)e.push(g.value)}for(f&&2<d&&(h=Id(h,arguments[2],2)),g=ta(e.length),C=new(Ne(this))(g),d=0;g>d;d++)C[d]=f?h(e[d],d):e[d];return C},lh=function(r,e,d){var h,f;return Ua&&typeof(h=e.constructor)=="function"&&h!==d&&ha(f=h.prototype)&&f!==d.prototype&&Ua(r,f),r},Sf=$a(function(r){var e=Hd.f,d=Za.get,h=Za.set,f=Ra.f,g=Fb.f,C=Math.round,P=y.RangeError,x=Pf.ArrayBuffer,B=Pf.DataView,Vt=function(_d,_l){var _h=0,rE=_l.length;for(_d=new(Ne(_d))(rE);rE>_h;)_d[_h]=_l[_h++];return _d},_r=function(_d,_l){f(_d,_l,{get:function(){return d(this)[_l]}})},_e=function(_d){var _l;return _d instanceof x||(_l=Ff(_d))=="ArrayBuffer"||_l=="SharedArrayBuffer"},_i=function(_d,_l){return jh(_d)&&typeof _l!="symbol"&&_l in _d&&String(+_l)==String(_l)},_a=function(_d,_l){return _i(_d,_l=lc(_l,!0))?dd(2,_d[_l]):g(_d,_l)},kc=function(_d,_l,_h){return!(_i(_d,_l=lc(_l,!0))&&ha(_h)&&Q(_h,"value"))||Q(_h,"get")||Q(_h,"set")||_h.configurable||Q(_h,"writable")&&!_h.writable||Q(_h,"enumerable")&&!_h.enumerable?f(_d,_l,_h):(_d[_l]=_h.value,_d)};ka?(Qf||(Fb.f=_a,Ra.f=kc,_r(Rf,"buffer"),_r(Rf,"byteOffset"),_r(Rf,"byteLength"),_r(Rf,"length")),N({target:"Object",stat:!0,forced:!Qf},{getOwnPropertyDescriptor:_a,defineProperty:kc}),r.exports=function(_d,_l,_h){var rE=_d.match(/\d+$/)[0]/8,aE=_d+(_h?"Clamped":"")+"Array",yE="get"+_d,gE="set"+_d,bE=y[aE],GE=bE;_d=GE&&GE.prototype;var Qm={},tE=function(EE,pE){f(EE,pE,{get:function(){var TE=d(this);return TE.view[yE](pE*rE+TE.byteOffset,!0)},set:function(TE){var _p=d(this);_h&&(TE=0>(TE=C(TE))?0:255<TE?255:255&TE),_p.view[gE](pE*rE+_p.byteOffset,TE,!0)},enumerable:!0})};Qf?Dj&&(GE=_l(function(EE,pE,TE,_p){return Gc(EE,GE,aE),lh(ha(pE)?_e(pE)?_p!==void 0?new bE(pE,kh(TE,rE),_p):TE!==void 0?new bE(pE,kh(TE,rE)):new bE(pE):jh(pE)?Vt(GE,pE):Ej.call(GE,pE):new bE(Le(pE)),EE,GE)}),Ua&&Ua(GE,Po),Jd(e(bE),function(EE){EE in GE||Na(GE,EE,bE[EE])}),GE.prototype=_d):(GE=_l(function(EE,pE,TE,_p){Gc(EE,GE,aE);var eE=0,cE=0;if(ha(pE)){if(!_e(pE))return jh(pE)?Vt(GE,pE):Ej.call(GE,pE);var SE=pE;if(cE=kh(TE,rE),pE=pE.byteLength,_p===void 0){if(pE%rE||0>(_p=pE-cE))throw P("Wrong length")}else if((_p=ta(_p)*rE)+cE>pE)throw P("Wrong length");pE=_p/rE}else pE=Le(pE),SE=new x(_p=pE*rE);for(h(EE,{buffer:SE,byteOffset:cE,byteLength:_p,length:pE,view:new B(SE)});eE<pE;)tE(EE,eE++)}),Ua&&Ua(GE,Po),_d=GE.prototype=ac(Rf)),_d.constructor!==GE&&Na(_d,"constructor",GE),No&&Na(_d,No,aE),Qm[aE]=GE,N({global:!0,forced:GE!=bE,sham:!Qf},Qm),"BYTES_PER_ELEMENT"in GE||Na(GE,"BYTES_PER_ELEMENT",rE),"BYTES_PER_ELEMENT"in _d||Na(_d,"BYTES_PER_ELEMENT",rE),If(aE)}):r.exports=function(){}});Sf("Uint8",function(r){return function(e,d,h){return r(this,e,d,h)}});var hw=Math.min,iw=[].copyWithin||function(r,e){var d=Qa(this),h=ta(d.length),f=xb(r,h),g=xb(e,h),C=2<arguments.length?arguments[2]:void 0;for(h=hw((C===void 0?h:xb(C,h))-g,h-f),C=1,g<f&&f<g+h&&(C=-1,g+=h-1,f+=h-1);0<h--;)g in d?d[f]=d[g]:delete d[f],f+=C,g+=C;return d};Aa("copyWithin",function(r,e){return iw.call(Da(this),r,e,2<arguments.length?arguments[2]:void 0)}),Aa("every",function(r){return Ju(Da(this),r,1<arguments.length?arguments[1]:void 0)}),Aa("fill",function(r){return yj.apply(Da(this),arguments)}),Aa("filter",function(r){var e=yn(Da(this),r,1<arguments.length?arguments[1]:void 0),d=kd(this,this.constructor),h=0,f=e.length;for(d=new(Ne(d))(f);f>h;)d[h]=e[h++];return d}),Aa("find",function(r){return zn(Da(this),r,1<arguments.length?arguments[1]:void 0)}),Aa("findIndex",function(r){return An(Da(this),r,1<arguments.length?arguments[1]:void 0)}),Aa("forEach",function(r){Jd(Da(this),r,1<arguments.length?arguments[1]:void 0)}),Aa("includes",function(r){return on(Da(this),r,1<arguments.length?arguments[1]:void 0)}),Aa("indexOf",function(r){return Si(Da(this),r,1<arguments.length?arguments[1]:void 0)});var Qo=qa("iterator"),Ro=y.Uint8Array,jw=ld.values,kw=ld.keys,lw=ld.entries,Fj=Ro&&Ro.prototype[Qo],So=!!Fj&&(Fj.name=="values"||Fj.name==null),To=function(){return jw.call(Da(this))};Aa("entries",function(){return lw.call(Da(this))}),Aa("keys",function(){return kw.call(Da(this))}),Aa("values",To,!So),Aa(Qo,To,!So);var mw=[].join;Aa("join",function(r){return mw.apply(Da(this),arguments)});var nw=Math.min,Gj=[].lastIndexOf,Uo=!!Gj&&0>1/[1].lastIndexOf(1,-0),ow=Ee("lastIndexOf"),pw=Uo||!ow?function(r){if(Uo)return Gj.apply(this,arguments)||0;var e=qb(this),d=ta(e.length),h=d-1;for(1<arguments.length&&(h=nw(h,$b(arguments[1]))),0>h&&(h=d+h);0<=h;h--)if(h in e&&e[h]===r)return h||0;return-1}:Gj;Aa("lastIndexOf",function(r){return pw.apply(Da(this),arguments)}),Aa("map",function(r){return xn(Da(this),r,1<arguments.length?arguments[1]:void 0,function(e,d){return new(Ne(kd(e,e.constructor)))(d)})});var Vo=function(r){return function(e,d,h,f){yb(d),e=Qa(e);var g=Af(e),C=ta(e.length),P=r?C-1:0,x=r?-1:1;if(2>h)for(;;){if(P in g){f=g[P],P+=x;break}if(P+=x,r?0>P:C<=P)throw TypeError("Reduce of empty array with no initial value")}for(;r?0<=P:C>P;P+=x)P in g&&(f=d(f,g[P],P,e));return f}},Wo=Vo(!1),qw=Vo(!0);Aa("reduce",function(r){return Wo(Da(this),r,arguments.length,1<arguments.length?arguments[1]:void 0)}),Aa("reduceRight",function(r){return qw(Da(this),r,arguments.length,1<arguments.length?arguments[1]:void 0)});var rw=Math.floor;Aa("reverse",function(){for(var r,e=Da(this).length,d=rw(e/2),h=0;h<d;)r=this[h],this[h++]=this[--e],this[e]=r;return this});var sw=R(function(){new Int8Array(1).set({})});Aa("set",function(r){Da(this);var e=kh(1<arguments.length?arguments[1]:void 0,1),d=this.length,h=Qa(r),f=ta(h.length),g=0;if(f+e>d)throw RangeError("Wrong length");for(;g<f;)this[e+g]=h[g++]},sw);var tw=[].slice,uw=R(function(){new Int8Array(1).slice()});Aa("slice",function(r,e){r=tw.call(Da(this),r,e);var d=kd(this,this.constructor);e=0;var h=r.length;for(d=new(Ne(d))(h);h>e;)d[e]=r[e++];return d},uw),Aa("some",function(r){return Iu(Da(this),r,1<arguments.length?arguments[1]:void 0)});var vw=[].sort;Aa("sort",function(r){return vw.call(Da(this),r)}),Aa("subarray",function(r,e){var d=Da(this),h=d.length;return r=xb(r,h),new(kd(d,d.constructor))(d.buffer,d.byteOffset+r*d.BYTES_PER_ELEMENT,ta((e===void 0?h:xb(e,h))-r))});var mh=y.Int8Array,Xo=[].toLocaleString,ww=[].slice,xw=!!mh&&R(function(){Xo.call(new mh(1))}),yw=R(function(){return[1,2].toLocaleString()!=new mh([1,2]).toLocaleString()})||!R(function(){mh.prototype.toLocaleString.call([1,2])});Aa("toLocaleString",function(){return Xo.apply(xw?ww.call(Da(this)):Da(this),arguments)},yw);var Yo=y.Uint8Array,zw=Yo&&Yo.prototype||{},nh=[].toString,Aw=[].join;R(function(){nh.call({})})&&(nh=function(){return Aw.call(this)}),Aa("toString",nh,zw.toString!=nh);var Zo=Pf.ArrayBuffer;N({global:!0,forced:y.ArrayBuffer!==Zo},{ArrayBuffer:Zo}),If("ArrayBuffer");var Bw=Ra.f,Hj=Function.prototype,Cw=Hj.toString,Dw=/^\s*function ([^ (]*)/;!ka||"name"in Hj||Bw(Hj,"name",{configurable:!0,get:function(){try{return Cw.call(this).match(Dw)[1]}catch{return""}}});var $o=RegExp.prototype,ap=$o.toString,Ew=R(function(){return ap.call({source:"a",flags:"b"})!="/a/b"}),Fw=ap.name!="toString";(Ew||Fw)&&Ta(RegExp.prototype,"toString",function(){var r=va(this),e=String(r.source),d=r.flags;return"/"+e+"/"+(r=String(d===void 0&&r instanceof RegExp&&!("flags"in $o)?tj.call(r):d))},{unsafe:!0});var Gw=Ef("splice"),Hw=Math.max,Iw=Math.min;N({target:"Array",proto:!0,forced:!Gw},{splice:function(r,e){var d,h,f=Qa(this),g=ta(f.length),C=xb(r,g),P=arguments.length;if(P===0?P=d=0:P===1?(P=0,d=g-C):(P-=2,d=Iw(Hw($b(e),0),g-C)),9007199254740991<g+P-d)throw TypeError("Maximum allowed length exceeded");var x=Sg(f,d);for(h=0;h<d;h++){var B=C+h;B in f&&Ge(x,h,f[B])}if(x.length=d,P<d){for(h=C;h<g-d;h++){var Vt=h+P;(B=h+d)in f?f[Vt]=f[B]:delete f[Vt]}for(h=g;h>g-d+P;h--)delete f[h-1]}else if(P>d)for(h=g-d;h>C;h--)Vt=h+P-1,(B=h+d-1)in f?f[Vt]=f[B]:delete f[Vt];for(h=0;h<P;h++)f[h+C]=arguments[h+2];return f.length=g-d+P,x}});var Ij={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Jj=qa("iterator"),bp=qa("toStringTag"),Kj=ld.values,oh;for(oh in Ij){var cp=y[oh],Kc=cp&&cp.prototype;if(Kc){if(Kc[Jj]!==Kj)try{Na(Kc,Jj,Kj)}catch{Kc[Jj]=Kj}if(Kc[bp]||Na(Kc,bp,oh),Ij[oh]){for(var Oe in ld)if(Kc[Oe]!==ld[Oe])try{Na(Kc,Oe,ld[Oe])}catch{Kc[Oe]=ld[Oe]}}}}var dp=Object.is||function(r,e){return r===e?r!==0||1/r==1/e:r!=r&&e!=e};dh("search",1,function(r,e,d){return[function(h){var f=jb(this),g=h==null?void 0:h[r];return g!==void 0?g.call(h,f):new RegExp(h)[r](String(f))},function(h){var f=d(e,h,this);if(f.done)return f.value;h=va(h);var g=String(this);return f=h.lastIndex,dp(f,0)||(h.lastIndex=0),g=Ke(h,g),dp(h.lastIndex,f)||(h.lastIndex=f),g===null?-1:g.index}]}),$a(function(r){(function(e,d){r.exports?r.exports=d(e):d(e)})(typeof self<"u"?self:Ya,function(e){function d(tE){return btoa(tE).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function h(tE){return tE=(tE+="===").slice(0,-tE.length%4),atob(tE.replace(/-/g,"+").replace(/_/g,"/"))}function f(tE){for(var EE=new Uint8Array(tE.length),pE=0;pE<tE.length;pE++)EE[pE]=tE.charCodeAt(pE);return EE}function g(tE){return tE instanceof ArrayBuffer&&(tE=new Uint8Array(tE)),String.fromCharCode.apply(String,tE)}function C(tE){var EE={name:(tE.name||tE||"").toUpperCase().replace("V","v")};switch(EE.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":tE.length&&(EE.length=tE.length);break;case"HMAC":tE.hash&&(EE.hash=C(tE.hash)),tE.length&&(EE.length=tE.length);break;case"RSAES-PKCS1-v1_5":tE.publicExponent&&(EE.publicExponent=new Uint8Array(tE.publicExponent)),tE.modulusLength&&(EE.modulusLength=tE.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":tE.hash&&(EE.hash=C(tE.hash)),tE.publicExponent&&(EE.publicExponent=new Uint8Array(tE.publicExponent)),tE.modulusLength&&(EE.modulusLength=tE.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return EE}function P(tE){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[tE.name][(tE.hash||{}).name||tE.length||""]}function x(tE){(tE instanceof ArrayBuffer||tE instanceof Uint8Array)&&(tE=JSON.parse(decodeURIComponent(escape(g(tE)))));var EE={kty:tE.kty,alg:tE.alg,ext:tE.ext||tE.extractable};switch(EE.kty){case"oct":EE.k=tE.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach(function(pE){pE in tE&&(EE[pE]=tE[pE])});break;default:throw new TypeError("Unsupported key type")}return EE}function B(tE){return tE=x(tE),yE&&(tE.extractable=tE.ext,delete tE.ext),f(unescape(encodeURIComponent(JSON.stringify(tE)))).buffer}function Vt(tE){var EE=_r(tE),pE=!1;switch(2<EE.length&&(pE=!0,EE.shift()),tE={ext:!0},EE[0][0]){case"1.2.840.113549.1.1.1":var TE="n e d p q dp dq qi".split(" ");for(EE=_r(EE[1]),pE&&EE.shift(),pE=0;pE<EE.length;pE++)EE[pE][0]||(EE[pE]=EE[pE].subarray(1)),tE[TE[pE]]=d(g(EE[pE]));tE.kty="RSA";break;default:throw new TypeError("Unsupported key type")}return tE}function _r(tE,EE){if(tE instanceof ArrayBuffer&&(tE=new Uint8Array(tE)),EE||(EE={pos:0,end:tE.length}),2>EE.end-EE.pos||EE.end>tE.length)throw new RangeError("Malformed DER");var pE=tE[EE.pos++],TE=tE[EE.pos++];if(128<=TE){if(TE&=127,EE.end-EE.pos<TE)throw new RangeError("Malformed DER");for(var _p=0;TE--;)_p<<=8,_p|=tE[EE.pos++];TE=_p}if(EE.end-EE.pos<TE)throw new RangeError("Malformed DER");switch(pE){case 2:pE=tE.subarray(EE.pos,EE.pos+=TE);break;case 3:if(tE[EE.pos++])throw Error("Unsupported bit string");TE--;case 4:pE=new Uint8Array(tE.subarray(EE.pos,EE.pos+=TE)).buffer;break;case 5:pE=null;break;case 6:if(!((tE=btoa(g(tE.subarray(EE.pos,EE.pos+=TE))))in bE))throw Error("Unsupported OBJECT ID "+tE);pE=bE[tE];break;case 48:for(pE=[],TE=EE.pos+TE;EE.pos<TE;)pE.push(_r(tE,EE));break;default:throw Error("Unsupported DER tag 0x"+pE.toString(16))}return pE}function _e(tE,EE){EE||(EE=[]);var pE=EE.length+2;if(EE.push(0,0),tE instanceof Uint8Array)for(var TE=2,_p=tE.length,eE=0;eE<_p;eE++)EE.push(tE[eE]);else if(tE instanceof ArrayBuffer)for(TE=4,_p=tE.byteLength,tE=new Uint8Array(tE),eE=0;eE<_p;eE++)EE.push(tE[eE]);else if(tE===null)TE=5,_p=0;else if(typeof tE=="string"&&tE in GE)for(TE=6,_p=(tE=f(atob(GE[tE]))).length,eE=0;eE<_p;eE++)EE.push(tE[eE]);else if(tE instanceof Array){for(eE=0;eE<tE.length;eE++)_e(tE[eE],EE);TE=48,_p=EE.length-pE}else{if(!(X(tE)==="object"&&tE.tag===3&&tE.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+tE);for(TE=3,_p=(tE=new Uint8Array(tE.value)).byteLength,EE.push(0),eE=0;eE<_p;eE++)EE.push(tE[eE]);_p++}if(128<=_p){for(eE=_p,_p=4,EE.splice(pE,0,eE>>24&255,eE>>16&255,eE>>8&255,255&eE);1<_p&&!(eE>>24);)eE<<=8,_p--;4>_p&&EE.splice(pE,4-_p),_p|=128}return EE.splice(pE-2,2,TE,_p),EE}function _i(tE,EE,pE,TE){Object.defineProperties(this,{_key:{value:tE},type:{value:tE.type,enumerable:!0},extractable:{value:pE===void 0?tE.extractable:pE,enumerable:!0},algorithm:{value:EE===void 0?tE.algorithm:EE,enumerable:!0},usages:{value:TE===void 0?tE.usages:TE,enumerable:!0}})}function _a(tE){return tE==="verify"||tE==="encrypt"||tE==="wrapKey"}function kc(tE){return tE==="sign"||tE==="decrypt"||tE==="unwrapKey"}if(typeof Promise!="function")throw"Promise support required";var _d=e.crypto||e.msCrypto;if(_d){var _l=_d.subtle||_d.webkitSubtle;if(_l){var _h=e.Crypto||_d.constructor||Object,rE=e.SubtleCrypto||_l.constructor||Object;e.CryptoKey||e.Key;var aE=-1<e.navigator.userAgent.indexOf("Edge/"),yE=!!e.msCrypto&&!aE,gE=!_d.subtle&&!!_d.webkitSubtle;if(yE||gE){var bE={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},GE={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach(function(tE){var EE=_l[tE];_l[tE]=function(pE,TE,_p){var eE=[].slice.call(arguments);switch(tE){case"generateKey":var cE=C(pE),SE=TE,AE=_p;break;case"importKey":cE=C(_p),SE=eE[3],AE=eE[4],pE==="jwk"&&((TE=x(TE)).alg||(TE.alg=P(cE)),TE.key_ops||(TE.key_ops=TE.kty!=="oct"?"d"in TE?AE.filter(kc):AE.filter(_a):AE.slice()),eE[1]=B(TE));break;case"unwrapKey":cE=eE[4],SE=eE[5],AE=eE[6],eE[2]=_p._key}if(tE==="generateKey"&&cE.name==="HMAC"&&cE.hash)return cE.length=cE.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[cE.hash.name],_l.importKey("raw",_d.getRandomValues(new Uint8Array(cE.length+7>>3)),cE,SE,AE);if(gE&&tE==="generateKey"&&cE.name==="RSASSA-PKCS1-v1_5"&&(!cE.modulusLength||2048<=cE.modulusLength))return(pE=C(pE)).name="RSAES-PKCS1-v1_5",delete pE.hash,_l.generateKey(pE,!0,["encrypt","decrypt"]).then(function(PE){return Promise.all([_l.exportKey("jwk",PE.publicKey),_l.exportKey("jwk",PE.privateKey)])}).then(function(PE){return PE[0].alg=PE[1].alg=P(cE),PE[0].key_ops=AE.filter(_a),PE[1].key_ops=AE.filter(kc),Promise.all([_l.importKey("jwk",PE[0],cE,!0,PE[0].key_ops),_l.importKey("jwk",PE[1],cE,SE,PE[1].key_ops)])}).then(function(PE){return{publicKey:PE[0],privateKey:PE[1]}});if((gE||yE&&(cE.hash||{}).name==="SHA-1")&&tE==="importKey"&&pE==="jwk"&&cE.name==="HMAC"&&TE.kty==="oct")return _l.importKey("raw",f(h(TE.k)),_p,eE[3],eE[4]);if(gE&&tE==="importKey"&&(pE==="spki"||pE==="pkcs8"))return _l.importKey("jwk",Vt(TE),_p,eE[3],eE[4]);if(yE&&tE==="unwrapKey")return _l.decrypt(eE[3],_p,TE).then(function(PE){return _l.importKey(pE,PE,eE[4],eE[5],eE[6])});try{var t_=EE.apply(_l,eE)}catch(PE){return Promise.reject(PE)}return yE&&(t_=new Promise(function(PE,v_){t_.onabort=t_.onerror=function(zE){v_(zE)},t_.oncomplete=function(zE){PE(zE.target.result)}})),t_=t_.then(function(PE){return cE.name!=="HMAC"||cE.length||(cE.length=8*PE.algorithm.length),cE.name.search("RSA")==0&&(cE.modulusLength||(cE.modulusLength=(PE.publicKey||PE).algorithm.modulusLength),cE.publicExponent||(cE.publicExponent=(PE.publicKey||PE).algorithm.publicExponent)),PE.publicKey&&PE.privateKey?{publicKey:new _i(PE.publicKey,cE,SE,AE.filter(_a)),privateKey:new _i(PE.privateKey,cE,SE,AE.filter(kc))}:new _i(PE,cE,SE,AE)})}}),["exportKey","wrapKey"].forEach(function(tE){var EE=_l[tE];_l[tE]=function(pE,TE,_p){var eE=[].slice.call(arguments);switch(tE){case"exportKey":eE[1]=TE._key;break;case"wrapKey":eE[1]=TE._key,eE[2]=_p._key}if((gE||yE&&(TE.algorithm.hash||{}).name==="SHA-1")&&tE==="exportKey"&&pE==="jwk"&&TE.algorithm.name==="HMAC"&&(eE[0]="raw"),!gE||tE!=="exportKey"||pE!=="spki"&&pE!=="pkcs8"||(eE[0]="jwk"),yE&&tE==="wrapKey")return _l.exportKey(pE,TE).then(function(SE){return pE==="jwk"&&(SE=f(unescape(encodeURIComponent(JSON.stringify(x(SE)))))),_l.encrypt(eE[3],_p,SE)});try{var cE=EE.apply(_l,eE)}catch(SE){return Promise.reject(SE)}return yE&&(cE=new Promise(function(SE,AE){cE.onabort=cE.onerror=function(t_){AE(t_)},cE.oncomplete=function(t_){SE(t_.target.result)}})),tE==="exportKey"&&pE==="jwk"&&(cE=cE.then(function(SE){return(gE||yE&&(TE.algorithm.hash||{}).name==="SHA-1")&&TE.algorithm.name==="HMAC"?{kty:"oct",alg:P(TE.algorithm),key_ops:TE.usages.slice(),ext:!0,k:d(g(SE))}:((SE=x(SE)).alg||(SE.alg=P(TE.algorithm)),SE.key_ops||(SE.key_ops=TE.type==="public"?TE.usages.filter(_a):TE.type==="private"?TE.usages.filter(kc):TE.usages.slice()),SE)})),!gE||tE!=="exportKey"||pE!=="spki"&&pE!=="pkcs8"||(cE=cE.then(function(SE){var AE=[["",null]],t_=!1;switch((SE=x(SE)).kty){case"RSA":for(var PE="n e d p q dp dq qi".split(" "),v_=[],zE=0;zE<PE.length&&PE[zE]in SE;zE++){var K_=v_[zE]=f(h(SE[PE[zE]]));128&K_[0]&&(v_[zE]=new Uint8Array(K_.length+1),v_[zE].set(K_,1))}2<v_.length&&(t_=!0,v_.unshift(new Uint8Array([0]))),AE[0][0]="1.2.840.113549.1.1.1";break;default:throw new TypeError("Unsupported key type")}return AE.push(new Uint8Array(_e(v_)).buffer),t_?AE.unshift(new Uint8Array([0])):AE[1]={tag:3,value:AE[1]},new Uint8Array(_e(AE)).buffer})),cE}}),["encrypt","decrypt","sign","verify"].forEach(function(tE){var EE=_l[tE];_l[tE]=function(pE,TE,_p,eE){if(yE&&(!_p.byteLength||eE&&!eE.byteLength))throw Error("Empty input is not allowed");var cE=[].slice.call(arguments),SE=C(pE);if(!yE||tE!=="sign"&&tE!=="verify"||pE!=="RSASSA-PKCS1-v1_5"&&pE!=="HMAC"||(cE[0]={name:pE}),yE&&TE.algorithm.hash&&(cE[0].hash=cE[0].hash||TE.algorithm.hash),yE&&tE==="decrypt"&&SE.name==="AES-GCM"){var AE=pE.tagLength>>3;cE[2]=(_p.buffer||_p).slice(0,_p.byteLength-AE),pE.tag=(_p.buffer||_p).slice(_p.byteLength-AE)}yE&&SE.name==="AES-GCM"&&cE[0].tagLength===void 0&&(cE[0].tagLength=128),cE[1]=TE._key;try{var t_=EE.apply(_l,cE)}catch(PE){return Promise.reject(PE)}return yE&&(t_=new Promise(function(PE,v_){t_.onabort=t_.onerror=function(zE){v_(zE)},t_.oncomplete=function(zE){if(zE=zE.target.result,tE==="encrypt"&&zE instanceof AesGcmEncryptResult){var K_=zE.ciphertext,GS=zE.tag;(zE=new Uint8Array(K_.byteLength+GS.byteLength)).set(new Uint8Array(K_),0),zE.set(new Uint8Array(GS),K_.byteLength),zE=zE.buffer}PE(zE)}})),t_}}),yE){var Qm=_l.digest;_l.digest=function(tE,EE){if(!EE.byteLength)throw Error("Empty input is not allowed");try{var pE=Qm.call(_l,tE,EE)}catch(TE){return Promise.reject(TE)}return pE=new Promise(function(TE,_p){pE.onabort=pE.onerror=function(eE){_p(eE)},pE.oncomplete=function(eE){TE(eE.target.result)}})},e.crypto=Object.create(_d,{getRandomValues:{value:function(tE){return _d.getRandomValues(tE)}},subtle:{value:_l}}),e.CryptoKey=_i}gE&&(_d.subtle=_l,e.Crypto=_h,e.SubtleCrypto=rE,e.CryptoKey=_i)}}}})});var Jw=qa("match"),Lj=function(r){var e;return ha(r)&&((e=r[Jw])!==void 0?!!e:Zb(r)=="RegExp")},Kw=[].push,Lw=Math.min;dh("split",2,function(r,e,d){var h="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||1<".".split(/()()/).length||"".split(/.?/).length?function(f,g){var C=String(jb(this));if((g=g===void 0?4294967295:g>>>0)===0)return[];if(f===void 0)return[C];if(!Lj(f))return e.call(C,f,g);var P,x,B,Vt=[],_r=0;for(f=new RegExp(f.source,(f.ignoreCase?"i":"")+(f.multiline?"m":"")+(f.unicode?"u":"")+(f.sticky?"y":"")+"g");(P=Of.call(f,C))&&!((x=f.lastIndex)>_r&&(Vt.push(C.slice(_r,P.index)),1<P.length&&P.index<C.length&&Kw.apply(Vt,P.slice(1)),B=P[0].length,_r=x,Vt.length>=g));)f.lastIndex===P.index&&f.lastIndex++;return _r===C.length?(B||!f.test(""))&&Vt.push(""):Vt.push(C.slice(_r)),Vt.length>g?Vt.slice(0,g):Vt}:"0".split(void 0,0).length?function(f,g){return f===void 0&&g===0?[]:e.call(this,f,g)}:e;return[function(f,g){var C=jb(this),P=f==null?void 0:f[r];return P!==void 0?P.call(f,C,g):h.call(String(C),f,g)},function(f,g){var C=d(h,f,this,g,h!==e);if(C.done)return C.value;var P=va(f);f=String(this);var x=kd(P,RegExp);if(C=P.unicode,P=new x(pc?"^(?:"+P.source+")":P,(P.ignoreCase?"i":"")+(P.multiline?"m":"")+(P.unicode?"u":"")+(pc?"g":"y")),(g=g===void 0?4294967295:g>>>0)===0)return[];if(f.length===0)return Ke(P,f)===null?[f]:[];var B=0,Vt=0;for(x=[];Vt<f.length;){P.lastIndex=pc?0:Vt;var _r,_e=Ke(P,pc?f.slice(Vt):f);if(_e===null||(_r=Lw(ta(P.lastIndex+(pc?Vt:0)),f.length))===B)Vt=xj(f,Vt,C);else{if(x.push(f.slice(B,Vt)),x.length===g)return x;for(B=1;B<=_e.length-1;B++)if(x.push(_e[B]),x.length===g)return x;Vt=B=_r}}return x.push(f.slice(B)),x}]},pc),function(r){r.console||(r.console={}),r=r.console;for(var e,d=function(){},h=["memory"],f="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");e=h.pop();)r[e]||(r[e]={});for(;e=f.pop();)r[e]||(r[e]=d)}(typeof window>"u"?Ya:window),N({target:"Object",stat:!0},{setPrototypeOf:Ua});var Mw=R(function(){Vb(1)});N({target:"Object",stat:!0,forced:Mw,sham:!Hn},{getPrototypeOf:function(r){return Vb(Qa(r))}});var ep=[].slice,Mj={},Nw=Function.bind||function(r){var e=yb(this),d=ep.call(arguments,1),h=function(){var f=d.concat(ep.call(arguments));if(this instanceof h){var g=f.length;if(!(g in Mj)){for(var C=[],P=0;P<g;P++)C[P]="a["+P+"]";Mj[g]=Function("C,a","return new C("+C.join(",")+")")}f=Mj[g](e,f)}else f=e.apply(r,f);return f};return ha(e.prototype)&&(h.prototype=e.prototype),h},Nj=mc("Reflect","construct"),fp=R(function(){function r(){}return!(Nj(function(){},[],r)instanceof r)}),gp=!R(function(){Nj(function(){})}),hp=fp||gp;N({target:"Reflect",stat:!0,forced:hp,sham:hp},{construct:function(r,e){yb(r),va(e);var d=3>arguments.length?r:yb(arguments[2]);if(gp&&!fp)return Nj(r,e,d);if(r==d){switch(e.length){case 0:return new r;case 1:return new r(e[0]);case 2:return new r(e[0],e[1]);case 3:return new r(e[0],e[1],e[2]);case 4:return new r(e[0],e[1],e[2],e[3])}return(d=[null]).push.apply(d,e),new(Nw.apply(r,d))}d=d.prototype,d=ac(ha(d)?d:Object.prototype);var h=Function.apply.call(r,d,e);return ha(h)?h:d}}),N({target:"Reflect",stat:!0},{get:wl});var ip=Fb.f,Ow=R(function(){ip(1)});N({target:"Object",stat:!0,forced:!ka||Ow,sham:!ka},{getOwnPropertyDescriptor:function(r,e){return ip(qb(r),e)}});var jp=Hd.f,Pw={}.toString,kp=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Oj=function(r){if(kp&&Pw.call(r)=="[object Window]")try{var e=jp(r)}catch{e=kp.slice()}else e=jp(qb(r));return e},lp={f:qa},Qw=Ra.f,ph=function(r){var e=y.Symbol||(y.Symbol={});Q(e,r)||Qw(e,r,{value:lp.f(r)})},rb=Pg("hidden"),mp=qa("toPrimitive"),Rw=Za.set,np=Za.getterFor("Symbol"),Ob=Object.prototype,sb=y.Symbol,Tf=mc("JSON","stringify"),op=Fb.f,od=Ra.f,pp=Oj,Sw=zf,Lc=fd("symbols"),Uf=fd("op-symbols"),Pj=fd("string-to-symbol-registry"),Qj=fd("symbol-to-string-registry"),Tw=fd("wks"),Rj=y.QObject,Sj=!Rj||!Rj.prototype||!Rj.prototype.findChild,Tj=ka&&R(function(){return ac(od({},"a",{get:function(){return od(this,"a",{value:7}).a}})).a!=7})?function(r,e,d){var h=op(Ob,e);h&&delete Ob[e],od(r,e,d),h&&r!==Ob&&od(Ob,e,h)}:od,Uj=function(r,e){var d=Lc[r]=ac(sb.prototype);return Rw(d,{type:"Symbol",tag:r,description:e}),ka||(d.description=e),d},Vj=vn?function(r){return typeof r=="symbol"}:function(r){return Object(r)instanceof sb},qh=function(r,e,d){return r===Ob&&qh(Uf,e,d),va(r),e=lc(e,!0),va(d),Q(Lc,e)?(d.enumerable?(Q(r,rb)&&r[rb][e]&&(r[rb][e]=!1),d=ac(d,{enumerable:dd(0,!1)})):(Q(r,rb)||od(r,rb,dd(1,{})),r[rb][e]=!0),Tj(r,e,d)):od(r,e,d)},qp=function(r,e){va(r);var d=qb(e);return e=Dc(d).concat(Wj(d)),Jd(e,function(h){ka&&!Xj.call(d,h)||qh(r,h,d[h])}),r},Xj=function(r){r=lc(r,!0);var e=Sw.call(this,r);return!(this===Ob&&Q(Lc,r)&&!Q(Uf,r))&&(!(e||!Q(this,r)||!Q(Lc,r)||Q(this,rb)&&this[rb][r])||e)},rp=function(r,e){if(r=qb(r),e=lc(e,!0),r!==Ob||!Q(Lc,e)||Q(Uf,e)){var d=op(r,e);return!d||!Q(Lc,e)||Q(r,rb)&&r[rb][e]||(d.enumerable=!0),d}},sp=function(r){r=pp(qb(r));var e=[];return Jd(r,function(d){Q(Lc,d)||Q(Be,d)||e.push(d)}),e},Wj=function(r){var e=r===Ob;r=pp(e?Uf:qb(r));var d=[];return Jd(r,function(h){!Q(Lc,h)||e&&!Q(Ob,h)||d.push(Lc[h])}),d};if(oc||(sb=function(){if(this instanceof sb)throw TypeError("Symbol is not a constructor");var r=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,e=Ae(r),d=function(h){this===Ob&&d.call(Uf,h),Q(this,rb)&&Q(this[rb],e)&&(this[rb][e]=!1),Tj(this,e,dd(1,h))};return ka&&Sj&&Tj(Ob,e,{configurable:!0,set:d}),Uj(e,r)},Ta(sb.prototype,"toString",function(){return np(this).tag}),Ta(sb,"withoutSetter",function(r){return Uj(Ae(r),r)}),zf=Xj,Ra.f=qh,Fb.f=rp,Hd.f=Oj=sp,Bf.f=Wj,lp.f=function(r){return Uj(qa(r),r)},ka&&(od(sb.prototype,"description",{configurable:!0,get:function(){return np(this).description}}),Ta(Ob,"propertyIsEnumerable",Xj,{unsafe:!0}))),N({global:!0,wrap:!0,forced:!oc,sham:!oc},{Symbol:sb}),Jd(Dc(Tw),function(r){ph(r)}),N({target:"Symbol",stat:!0,forced:!oc},{for:function(r){if(r=String(r),Q(Pj,r))return Pj[r];var e=sb(r);return Pj[r]=e,Qj[e]=r,e},keyFor:function(r){if(!Vj(r))throw TypeError(r+" is not a symbol");if(Q(Qj,r))return Qj[r]},useSetter:function(){Sj=!0},useSimple:function(){Sj=!1}}),N({target:"Object",stat:!0,forced:!oc,sham:!ka},{create:function(r,e){return e===void 0?ac(r):qp(ac(r),e)},defineProperty:qh,defineProperties:qp,getOwnPropertyDescriptor:rp}),N({target:"Object",stat:!0,forced:!oc},{getOwnPropertyNames:sp,getOwnPropertySymbols:Wj}),N({target:"Object",stat:!0,forced:R(function(){Bf.f(1)})},{getOwnPropertySymbols:function(r){return Bf.f(Qa(r))}}),Tf){var Uw=!oc||R(function(){var r=sb();return Tf([r])!="[null]"||Tf({a:r})!="{}"||Tf(Object(r))!="{}"});N({target:"JSON",stat:!0,forced:Uw},{stringify:function(r,e,d){for(var h,f=[r],g=1;arguments.length>g;)f.push(arguments[g++]);if(h=e,(ha(e)||r!==void 0)&&!Vj(r))return gd(e)||(e=function(C,P){if(typeof h=="function"&&(P=h.call(this,C,P)),!Vj(P))return P}),f[1]=e,Tf.apply(null,f)}})}sb.prototype[mp]||Na(sb.prototype,mp,sb.prototype.valueOf),Ec(sb,"Symbol"),Be[rb]=!0;var Vw=Ra.f,Mc=y.Symbol;if(ka&&typeof Mc=="function"&&(!("description"in Mc.prototype)||Mc().description!==void 0)){var tp={},Vf=function(){var r=1>arguments.length||arguments[0]===void 0?void 0:String(arguments[0]),e=this instanceof Vf?new Mc(r):r===void 0?Mc():Mc(r);return r===""&&(tp[e]=!0),e};rn(Vf,Mc);var Yj=Vf.prototype=Mc.prototype;Yj.constructor=Vf;var Ww=Yj.toString,Xw=String(Mc("test"))=="Symbol(test)",Yw=/^Symbol\((.*)\)[^)]+$/;Vw(Yj,"description",{configurable:!0,get:function(){var r=ha(this)?this.valueOf():this,e=Ww.call(r);return Q(tp,r)?"":(r=Xw?e.slice(7,-1):e.replace(Yw,"$1"))===""?void 0:r}}),N({global:!0,forced:!0},{Symbol:Vf})}ph("toStringTag"),Ec(y.JSON,"JSON",!0),Ec(Math,"Math",!0),function(){function r(_e,_i){if(!(_e instanceof _i))throw new TypeError("Cannot call a class as a function")}function e(_e,_i){for(var _a=0;_a<_i.length;_a++){var kc=_i[_a];kc.enumerable=kc.enumerable||!1,kc.configurable=!0,"value"in kc&&(kc.writable=!0),Object.defineProperty(_e,kc.key,kc)}}function d(_e,_i,_a){return _i&&e(_e.prototype,_i),_a&&e(_e,_a),_e}function h(_e,_i){if(typeof _i!="function"&&_i!==null)throw new TypeError("Super expression must either be null or a function");_e.prototype=Object.create(_i&&_i.prototype,{constructor:{value:_e,writable:!0,configurable:!0}}),_i&&g(_e,_i)}function f(_e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(_i){return _i.__proto__||Object.getPrototypeOf(_i)})(_e)}function g(_e,_i){return(g=Object.setPrototypeOf||function(_a,kc){return _a.__proto__=kc,_a})(_e,_i)}function C(_e){if(_e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return _e}function P(_e){var _i=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var _a=f(_e);if(_i){var kc=f(this).constructor;_a=Reflect.construct(_a,arguments,kc)}else _a=_a.apply(this,arguments);return _a=!_a||X(_a)!=="object"&&typeof _a!="function"?C(this):_a}}function x(_e,_i,_a){return(x=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(kc,_d,_l){for(;!Object.prototype.hasOwnProperty.call(kc,_d)&&(kc=f(kc))!==null;);if(kc)return(_d=Object.getOwnPropertyDescriptor(kc,_d)).get?_d.get.call(_l):_d.value})(_e,_i,_a||_e)}var B=function(){function _e(){r(this,_e),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return d(_e,[{key:"addEventListener",value:function(_i,_a,kc){_i in this.listeners||(this.listeners[_i]=[]),this.listeners[_i].push({callback:_a,options:kc})}},{key:"removeEventListener",value:function(_i,_a){if(_i in this.listeners){for(var kc=0,_d=(_i=this.listeners[_i]).length;kc<_d;kc++)if(_i[kc].callback===_a){_i.splice(kc,1);break}}}},{key:"dispatchEvent",value:function(_i){if(_i.type in this.listeners){for(var _a=this.listeners[_i.type].slice(),kc=0,_d=_a.length;kc<_d;kc++){var _l=_a[kc];try{_l.callback.call(this,_i)}catch(_h){Promise.resolve().then(function(){throw _h})}_l.options&&_l.options.once&&this.removeEventListener(_i.type,_l.callback)}return!_i.defaultPrevented}}}]),_e}(),Vt=function(_e){function _i(){r(this,_i);var kc=_a.call(this);return kc.listeners||B.call(C(kc)),Object.defineProperty(C(kc),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(C(kc),"onabort",{value:null,writable:!0,configurable:!0}),kc}h(_i,_e);var _a=P(_i);return d(_i,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(kc){kc.type==="abort"&&(this.aborted=!0,typeof this.onabort=="function"&&this.onabort.call(this,kc)),x(f(_i.prototype),"dispatchEvent",this).call(this,kc)}}]),_i}(B),_r=function(){function _e(){r(this,_e),Object.defineProperty(this,"signal",{value:new Vt,writable:!0,configurable:!0})}return d(_e,[{key:"abort",value:function(){try{var _i=new Event("abort")}catch{typeof document<"u"?document.createEvent?(_i=document.createEvent("Event")).initEvent("abort",!1,!1):(_i=document.createEventObject()).type="abort":_i={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(_i)}},{key:"toString",value:function(){return"[object AbortController]"}}]),_e}();typeof Symbol<"u"&&Symbol.toStringTag&&(_r.prototype[Symbol.toStringTag]="AbortController",Vt.prototype[Symbol.toStringTag]="AbortSignal"),function(_e){if(_e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var _i=!0}else _i=typeof _e.Request=="function"&&!_e.Request.prototype.hasOwnProperty("signal")||!_e.AbortController;_i&&(_e.AbortController=_r,_e.AbortSignal=Vt)}(typeof self<"u"?self:Ya)}();var Zw=Math.floor,$w=Math.log,ax=Math.LOG2E;N({target:"Math",stat:!0},{clz32:function(r){return(r>>>=0)?31-Zw($w(r+.5)*ax):32}});var bx=Math.log,cx=Math.LN2,ss=Math.clz32||function(r){return 31-bx(r>>>0)/cx|0},xd=String.fromCharCode,up={}.toString,Zj=window.Uint8Array,ak=Zj||Array,dx=up.call((window.ArrayBuffer||ak).prototype),bk;xl.prototype.decode=function(r){if(r=r&&r.buffer||r,up.call(r)!==dx)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var e="",d=0,h=0|(r=Zj?new ak(r):r).length;d<h;d=d+32768|0)e+=xd.apply(0,r[Zj?"slice":"subarray"](d,d+32768|0));return e.replace(/[\xc0-\xff][\x80-\xbf]*/g,rs)},window.TextDecoder||(window.TextDecoder=xl),yl.prototype.encode=function(r){for(var e=0|(r=r===void 0?"":(""+r).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,ts)).length,d=new ak(e),h=0;h<e;h=h+1|0)d[h]=r.charCodeAt(h);return d},window.TextEncoder||(window.TextEncoder=yl),function(r){var e,d,h,f,g,C,P,x,B,Vt,_r;(function(_e){_e.LOGIN="LOGIN",_e.LOGIN_SUCCESS="LOGIN_SUCCESS",_e.LOGIN_FAILURE="LOGIN_FAILURE",_e.LOGIN_TIMEOUT="LOGIN_TIMEOUT",_e.INTERRUPTED="INTERRUPTED",_e.LOGOUT="LOGOUT",_e.BANNED_BY_SERVER="BANNED_BY_SERVER",_e.REMOTE_LOGIN="REMOTE_LOGIN"})(e||(e={})),r.ConnectionChangeReason=e,function(_e){_e.DISCONNECTED="DISCONNECTED",_e.CONNECTING="CONNECTING",_e.CONNECTED="CONNECTED",_e.RECONNECTING="RECONNECTING",_e.ABORTED="ABORTED"}(d||(d={})),r.ConnectionState=d,function(_e){_e.IDLE="IDLE",_e.SENT_TO_REMOTE="SENT_TO_REMOTE",_e.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",_e.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",_e.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",_e.CANCELED="CANCELED",_e.FAILURE="FAILURE"}(h||(h={})),r.LocalInvitationState=h,function(_e){_e.INVITATION_RECEIVED="INVITATION_RECEIVED",_e.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",_e.REFUSED="REFUSED",_e.ACCEPTED="ACCEPTED",_e.CANCELED="CANCELED",_e.FAILURE="FAILURE"}(f||(f={})),r.RemoteInvitationState=f,function(_e){_e.UNKNOWN="UNKNOWN",_e.PEER_NO_RESPONSE="PEER_NO_RESPONSE",_e.INVITATION_EXPIRE="INVITATION_EXPIRE",_e.PEER_OFFLINE="PEER_OFFLINE",_e.NOT_LOGGEDIN="NOT_LOGGEDIN"}(g||(g={})),r.LocalInvitationFailureReason=g,function(_e){_e.UNKNOWN="UNKNOWN",_e.PEER_OFFLINE="PEER_OFFLINE",_e.ACCEPT_FAILURE="ACCEPT_FAILURE",_e.INVITATION_EXPIRE="INVITATION_EXPIRE"}(C||(C={})),r.RemoteInvitationFailureReason=C,function(_e){_e.ONLINE="ONLINE",_e.UNREACHABLE="UNREACHABLE",_e.OFFLINE="OFFLINE"}(P||(P={})),r.PeerOnlineState=P,(x||(x={})).ONLINE_STATUS="ONLINE_STATUS",r.PeerSubscriptionOption=x,function(_e){_e.TEXT="TEXT",_e.RAW="RAW",_e.IMAGE="IMAGE",_e.FILE="FILE"}(B||(B={})),r.MessageType=B,function(_e){_e.CN="CN",_e.NA="NA",_e.EU="EU",_e.AS="AS",_e.JP="JP",_e.IN="IN",_e.GLOB="GLOB",_e.OC="OC",_e.SA="SA",_e.AF="AF",_e.OVS="OVS"}(Vt||(Vt={})),r.LegacyAreaCode=Vt,function(_e){_e.GLOBAL="GLOBAL",_e.INDIA="INDIA",_e.JAPAN="JAPAN",_e.ASIA="ASIA",_e.EUROPE="EUROPE",_e.CHINA="CHINA",_e.NORTH_AMERICA="NORTH_AMERICA"}(_r||(_r={})),r.AreaCode=_r}(bk||(bk={}));var S=bk;N({target:"Array",proto:!0},{includes:function(r){return on(this,r,1<arguments.length?arguments[1]:void 0)}}),Ld("includes");var ck=function(r){if(Lj(r))throw TypeError("The method doesn't accept regular expressions");return r},ex=qa("match"),dk=function(r){var e=/./;try{"/./"[r](e)}catch{try{return e[ex]=!1,"/./"[r](e)}catch{}}return!1};N({target:"String",proto:!0,forced:!dk("includes")},{includes:function(r){return!!~String(jb(this)).indexOf(ck(r),1<arguments.length?arguments[1]:void 0)}});var Nc={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0};ph("iterator"),ph("asyncIterator");var ek=Ee("forEach")?[].forEach:function(r){return Jd(this,r,1<arguments.length?arguments[1]:void 0)},vp;for(vp in Ij){var wp=y[vp],rh=wp&&wp.prototype;if(rh&&rh.forEach!==ek)try{Na(rh,"forEach",ek)}catch{rh.forEach=ek}}var fx=[].reverse,xp=[1,2];N({target:"Array",proto:!0,forced:String(xp)===String(xp.reverse())},{reverse:function(){return gd(this)&&(this.length=this.length),fx.call(this)}});var w=$a(function(r){r=function(e){function d(_p,eE,cE){return Object.defineProperty(_p,eE,{value:cE,enumerable:!0,configurable:!0,writable:!0}),_p[eE]}function h(_p,eE,cE,SE){return eE=Object.create((eE&&eE.prototype instanceof g?eE:g).prototype),SE=new _i(SE||[]),eE._invoke=function(AE,t_,PE){var v_=bE;return function(zE,K_){if(v_===Qm)throw Error("Generator is already running");if(v_===tE){if(zE==="throw")throw K_;return kc()}for(PE.method=zE,PE.arg=K_;;){if((zE=PE.delegate)&&(zE=Vt(zE,PE))){if(zE===EE)continue;return zE}if(PE.method==="next")PE.sent=PE._sent=PE.arg;else if(PE.method==="throw"){if(v_===bE)throw v_=tE,PE.arg;PE.dispatchException(PE.arg)}else PE.method==="return"&&PE.abrupt("return",PE.arg);if(v_=Qm,(zE=f(AE,t_,PE)).type==="normal"){if(v_=PE.done?tE:GE,zE.arg===EE)continue;return{value:zE.arg,done:PE.done}}zE.type==="throw"&&(v_=tE,PE.method="throw",PE.arg=zE.arg)}}}(_p,cE,SE),eE}function f(_p,eE,cE){try{return{type:"normal",arg:_p.call(eE,cE)}}catch(SE){return{type:"throw",arg:SE}}}function g(){}function C(){}function P(){}function x(_p){["next","throw","return"].forEach(function(eE){d(_p,eE,function(cE){return this._invoke(eE,cE)})})}function B(_p,eE){function cE(AE,t_,PE,v_){if((AE=f(_p[AE],_p,t_)).type!=="throw"){var zE=AE.arg;return(AE=zE.value)&&X(AE)==="object"&&_h.call(AE,"__await")?eE.resolve(AE.__await).then(function(K_){cE("next",K_,PE,v_)},function(K_){cE("throw",K_,PE,v_)}):eE.resolve(AE).then(function(K_){zE.value=K_,PE(zE)},function(K_){return cE("throw",K_,PE,v_)})}v_(AE.arg)}var SE;this._invoke=function(AE,t_){function PE(){return new eE(function(v_,zE){cE(AE,t_,v_,zE)})}return SE=SE?SE.then(PE,PE):PE()}}function Vt(_p,eE){var cE=_p.iterator[eE.method];if(cE===_d){if(eE.delegate=null,eE.method==="throw"){if(_p.iterator.return&&(eE.method="return",eE.arg=_d,Vt(_p,eE),eE.method==="throw"))return EE;eE.method="throw",eE.arg=new TypeError("The iterator does not provide a 'throw' method")}return EE}return(cE=f(cE,_p.iterator,eE.arg)).type==="throw"?(eE.method="throw",eE.arg=cE.arg,eE.delegate=null,EE):(cE=cE.arg)?cE.done?(eE[_p.resultName]=cE.value,eE.next=_p.nextLoc,eE.method!=="return"&&(eE.method="next",eE.arg=_d),eE.delegate=null,EE):cE:(eE.method="throw",eE.arg=new TypeError("iterator result is not an object"),eE.delegate=null,EE)}function _r(_p){var eE={tryLoc:_p[0]};1 in _p&&(eE.catchLoc=_p[1]),2 in _p&&(eE.finallyLoc=_p[2],eE.afterLoc=_p[3]),this.tryEntries.push(eE)}function _e(_p){var eE=_p.completion||{};eE.type="normal",delete eE.arg,_p.completion=eE}function _i(_p){this.tryEntries=[{tryLoc:"root"}],_p.forEach(_r,this),this.reset(!0)}function _a(_p){if(_p){var eE=_p[aE];if(eE)return eE.call(_p);if(typeof _p.next=="function")return _p;if(!isNaN(_p.length)){var cE=-1;return(eE=function SE(){for(;++cE<_p.length;)if(_h.call(_p,cE))return SE.value=_p[cE],SE.done=!1,SE;return SE.value=_d,SE.done=!0,SE}).next=eE}}return{next:kc}}function kc(){return{value:_d,done:!0}}var _d,_l=Object.prototype,_h=_l.hasOwnProperty,rE=typeof Symbol=="function"?Symbol:{},aE=rE.iterator||"@@iterator",yE=rE.asyncIterator||"@@asyncIterator",gE=rE.toStringTag||"@@toStringTag";try{d({},"")}catch{d=function(eE,cE,SE){return eE[cE]=SE}}e.wrap=h;var bE="suspendedStart",GE="suspendedYield",Qm="executing",tE="completed",EE={};d(rE={},aE,function(){return this});var pE=Object.getPrototypeOf;(pE=pE&&pE(pE(_a([]))))&&pE!==_l&&_h.call(pE,aE)&&(rE=pE);var TE=P.prototype=g.prototype=Object.create(rE);return C.prototype=P,d(TE,"constructor",P),d(P,"constructor",C),C.displayName=d(P,gE,"GeneratorFunction"),e.isGeneratorFunction=function(_p){return!!(_p=typeof _p=="function"&&_p.constructor)&&(_p===C||(_p.displayName||_p.name)==="GeneratorFunction")},e.mark=function(_p){return Object.setPrototypeOf?Object.setPrototypeOf(_p,P):(_p.__proto__=P,d(_p,gE,"GeneratorFunction")),_p.prototype=Object.create(TE),_p},e.awrap=function(_p){return{__await:_p}},x(B.prototype),d(B.prototype,yE,function(){return this}),e.AsyncIterator=B,e.async=function(_p,eE,cE,SE,AE){AE===void 0&&(AE=Promise);var t_=new B(h(_p,eE,cE,SE),AE);return e.isGeneratorFunction(eE)?t_:t_.next().then(function(PE){return PE.done?PE.value:t_.next()})},x(TE),d(TE,gE,"Generator"),d(TE,aE,function(){return this}),d(TE,"toString",function(){return"[object Generator]"}),e.keys=function(_p){var eE,cE=[];for(eE in _p)cE.push(eE);return cE.reverse(),function SE(){for(;cE.length;){var AE=cE.pop();if(AE in _p)return SE.value=AE,SE.done=!1,SE}return SE.done=!0,SE}},e.values=_a,_i.prototype={constructor:_i,reset:function(_p){if(this.next=this.prev=0,this.sent=this._sent=_d,this.done=!1,this.delegate=null,this.method="next",this.arg=_d,this.tryEntries.forEach(_e),!_p)for(var eE in this)eE.charAt(0)==="t"&&_h.call(this,eE)&&!isNaN(+eE.slice(1))&&(this[eE]=_d)},stop:function(){this.done=!0;var _p=this.tryEntries[0].completion;if(_p.type==="throw")throw _p.arg;return this.rval},dispatchException:function(_p){function eE(zE,K_){return t_.type="throw",t_.arg=_p,cE.next=zE,K_&&(cE.method="next",cE.arg=_d),!!K_}if(this.done)throw _p;for(var cE=this,SE=this.tryEntries.length-1;0<=SE;--SE){var AE=this.tryEntries[SE],t_=AE.completion;if(AE.tryLoc==="root")return eE("end");if(AE.tryLoc<=this.prev){var PE=_h.call(AE,"catchLoc"),v_=_h.call(AE,"finallyLoc");if(PE&&v_){if(this.prev<AE.catchLoc)return eE(AE.catchLoc,!0);if(this.prev<AE.finallyLoc)return eE(AE.finallyLoc)}else if(PE){if(this.prev<AE.catchLoc)return eE(AE.catchLoc,!0)}else{if(!v_)throw Error("try statement without catch or finally");if(this.prev<AE.finallyLoc)return eE(AE.finallyLoc)}}}},abrupt:function(_p,eE){for(var cE=this.tryEntries.length-1;0<=cE;--cE){var SE=this.tryEntries[cE];if(SE.tryLoc<=this.prev&&_h.call(SE,"finallyLoc")&&this.prev<SE.finallyLoc){var AE=SE;break}}return AE&&(_p==="break"||_p==="continue")&&AE.tryLoc<=eE&&eE<=AE.finallyLoc&&(AE=null),(cE=AE?AE.completion:{}).type=_p,cE.arg=eE,AE?(this.method="next",this.next=AE.finallyLoc,EE):this.complete(cE)},complete:function(_p,eE){if(_p.type==="throw")throw _p.arg;return _p.type==="break"||_p.type==="continue"?this.next=_p.arg:_p.type==="return"?(this.rval=this.arg=_p.arg,this.method="return",this.next="end"):_p.type==="normal"&&eE&&(this.next=eE),EE},finish:function(_p){for(var eE=this.tryEntries.length-1;0<=eE;--eE){var cE=this.tryEntries[eE];if(cE.finallyLoc===_p)return this.complete(cE.completion,cE.afterLoc),_e(cE),EE}},catch:function(_p){for(var eE=this.tryEntries.length-1;0<=eE;--eE){var cE=this.tryEntries[eE];if(cE.tryLoc===_p){if((_p=cE.completion).type==="throw"){var SE=_p.arg;_e(cE)}return SE}}throw Error("illegal catch attempt")},delegateYield:function(_p,eE,cE){return this.delegate={iterator:_a(_p),resultName:eE,nextLoc:cE},this.method==="next"&&(this.arg=_d),EE}},e}(r.exports);try{regeneratorRuntime=r}catch{(typeof globalThis>"u"?"undefined":X(globalThis))==="object"?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}}),yp=!R(function(){return Object.isExtensible(Object.preventExtensions({}))}),fk=$a(function(r){var e=Ra.f,d=Ae("meta"),h=0,f=Object.isExtensible||function(){return!0},g=function(P){e(P,d,{value:{objectID:"O"+ ++h,weakData:{}}})},C=r.exports={REQUIRED:!1,fastKey:function(P,x){if(!ha(P))return typeof P=="symbol"?P:(typeof P=="string"?"S":"P")+P;if(!Q(P,d)){if(!f(P))return"F";if(!x)return"E";g(P)}return P[d].objectID},getWeakData:function(P,x){if(!Q(P,d)){if(!f(P))return!0;if(!x)return!1;g(P)}return P[d].weakData},onFreeze:function(P){return yp&&C.REQUIRED&&f(P)&&!Q(P,d)&&g(P),P}};Be[d]=!0}),zp=function(r,e,d){var h=r.indexOf("Map")!==-1,f=r.indexOf("Weak")!==-1,g=h?"set":"add",C=y[r],P=C&&C.prototype,x=C,B={},Vt=function(_d){var _l=P[_d];Ta(P,_d,_d=="add"?function(_h){return _l.call(this,_h===0?0:_h),this}:_d=="delete"?function(_h){return!(f&&!ha(_h))&&_l.call(this,_h===0?0:_h)}:_d=="get"?function(_h){return f&&!ha(_h)?void 0:_l.call(this,_h===0?0:_h)}:_d=="has"?function(_h){return!(f&&!ha(_h))&&_l.call(this,_h===0?0:_h)}:function(_h,rE){return _l.call(this,_h===0?0:_h,rE),this})};if(nc(r,typeof C!="function"||!(f||P.forEach&&!R(function(){new C().entries().next()}))))x=d.getConstructor(e,r,h,g),fk.REQUIRED=!0;else if(nc(r,!0)){var _r=new x,_e=_r[g](f?{}:-0,1)!=_r,_i=R(function(){_r.has(1)}),_a=Tg(function(_d){new C(_d)}),kc=!f&&R(function(){for(var _d=new C,_l=5;_l--;)_d[g](_l,_l);return!_d.has(-0)});_a||((x=e(function(_d,_l){return Gc(_d,x,r),_d=lh(new C,_d,x),_l!=null&&Xg(_l,_d[g],{that:_d,AS_ENTRIES:h}),_d})).prototype=P,P.constructor=x),(_i||kc)&&(Vt("delete"),Vt("has"),h&&Vt("get")),(kc||_e)&&Vt(g),f&&P.clear&&delete P.clear}return B[r]=x,N({global:!0,forced:x!=C},B),Ec(x,r),f||d.setStrong(x,r,h),x},gx=Ra.f,Ap=fk.fastKey,Bp=Za.set,gk=Za.getterFor,Cp={getConstructor:function(r,e,d,h){var f=r(function(x,B){Gc(x,f,e),Bp(x,{type:e,index:ac(null),first:void 0,last:void 0,size:0}),ka||(x.size=0),B!=null&&Xg(B,x[h],{that:x,AS_ENTRIES:d})}),g=gk(e),C=function(x,B,Vt){var _r,_e=g(x),_i=P(x,B);return _i?_i.value=Vt:(_e.last=_i={index:_r=Ap(B,!0),key:B,value:Vt,previous:B=_e.last,next:void 0,removed:!1},_e.first||(_e.first=_i),B&&(B.next=_i),ka?_e.size++:x.size++,_r!=="F"&&(_e.index[_r]=_i)),x},P=function(x,B){x=g(x);var Vt=Ap(B);if(Vt!=="F")return x.index[Vt];for(x=x.first;x;x=x.next)if(x.key==B)return x};return Hf(f.prototype,{clear:function(){for(var x=g(this),B=x.index,Vt=x.first;Vt;)Vt.removed=!0,Vt.previous&&(Vt.previous=Vt.previous.next=void 0),delete B[Vt.index],Vt=Vt.next;x.first=x.last=void 0,ka?x.size=0:this.size=0},delete:function(x){var B=g(this);if(x=P(this,x)){var Vt=x.next,_r=x.previous;delete B.index[x.index],x.removed=!0,_r&&(_r.next=Vt),Vt&&(Vt.previous=_r),B.first==x&&(B.first=Vt),B.last==x&&(B.last=_r),ka?B.size--:this.size--}return!!x},forEach:function(x){for(var B,Vt=g(this),_r=Id(x,1<arguments.length?arguments[1]:void 0,3);B=B?B.next:Vt.first;)for(_r(B.value,B.key,this);B&&B.removed;)B=B.previous},has:function(x){return!!P(this,x)}}),Hf(f.prototype,d?{get:function(x){return(x=P(this,x))&&x.value},set:function(x,B){return C(this,x===0?0:x,B)}}:{add:function(x){return C(this,x=x===0?0:x,x)}}),ka&&gx(f.prototype,"size",{get:function(){return g(this).size}}),f},setStrong:function(r,e,d){var h=e+" Iterator",f=gk(e),g=gk(h);bj(r,e,function(C,P){Bp(this,{type:h,target:C,state:f(C),kind:P,last:void 0})},function(){for(var C=g(this),P=C.kind,x=C.last;x&&x.removed;)x=x.previous;return C.target&&(C.last=x=x?x.next:C.state.first)?P=="keys"?{value:x.key,done:!1}:P=="values"?{value:x.value,done:!1}:{value:[x.key,x.value],done:!1}:(C.target=void 0,{value:void 0,done:!0})},d?"entries":"values",!d,!0),If(e)}};zp("Set",function(r){return function(){return r(this,arguments.length?arguments[0]:void 0)}},Cp);var hx=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,ix=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,hk=function(r){return function(e){return e=String(jb(e)),1&r&&(e=e.replace(hx,"")),2&r&&(e=e.replace(ix,"")),e}},ik=hk(3),sh=y.parseInt,jx=/^[+-]?0[Xx]/,Dp=sh(`	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF08`)!==8||sh(`	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF0x16`)!==22?function(r,e){return r=ik(String(r)),sh(r,e>>>0||(jx.test(r)?16:10))}:sh;N({global:!0,forced:parseInt!=Dp},{parseInt:Dp});var kx=Hd.f,lx=Fb.f,mx=Ra.f,pd=y.Number,th=pd.prototype,nx=Zb(ac(th))=="Number",Ep=function(r){var e,d=lc(r,!1);if(typeof d=="string"&&2<d.length){if((r=(d=ik(d)).charCodeAt(0))===43||r===45){if((r=d.charCodeAt(2))===88||r===120)return NaN}else if(r===48){switch(d.charCodeAt(1)){case 66:case 98:r=2;var h=49;break;case 79:case 111:r=8,h=55;break;default:return+d}var f=(d=d.slice(2)).length;for(e=0;e<f;e++){var g=d.charCodeAt(e);if(48>g||g>h)return NaN}return parseInt(d,r)}}return+d};if(nc("Number",!pd(" 0o1")||!pd("0b1")||pd("+0x1"))){for(var Pd=function(r){var e=1>arguments.length?0:r,d=this;return d instanceof Pd&&(nx?R(function(){th.valueOf.call(d)}):Zb(d)!="Number")?lh(new pd(Ep(e)),d,Pd):Ep(e)},Fp=ka?kx(pd):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),jk=0,uh;Fp.length>jk;jk++)Q(pd,uh=Fp[jk])&&!Q(Pd,uh)&&mx(Pd,uh,lx(pd,uh));Pd.prototype=th,th.constructor=Pd,Ta(y,"Number",Pd)}var Gp=qa("isConcatSpreadable"),ox=51<=id||!R(function(){var r=[];return r[Gp]=!1,r.concat()[0]!==r}),px=Ef("concat");N({target:"Array",proto:!0,forced:!ox||!px},{concat:function(r){var e,d=Qa(this),h=Sg(d,0),f=0,g=-1;for(e=arguments.length;g<e;g++){var C=g===-1?d:arguments[g],P=C;if(ha(P)){var x=P[Gp];P=x!==void 0?!!x:gd(P)}else P=!1;if(P){if(9007199254740991<f+(x=ta(C.length)))throw TypeError("Maximum allowed index exceeded");for(P=0;P<x;P++,f++)P in C&&Ge(h,f,C[P])}else{if(9007199254740991<=f)throw TypeError("Maximum allowed index exceeded");Ge(h,f++,C)}}return h.length=f,h}});var kk=mc("Reflect","apply"),qx=Function.apply,rx=!R(function(){kk(function(){})});N({target:"Reflect",stat:!0,forced:rx},{apply:function(r,e,d){return yb(r),va(d),kk?kk(r,e,d):qx.call(r,e,d)}}),N({target:"Reflect",stat:!0},{ownKeys:qn});var sx=Oj,tx=R(function(){return!Object.getOwnPropertyNames(1)});N({target:"Object",stat:!0,forced:tx},{getOwnPropertyNames:sx});var Pe=(typeof Reflect>"u"?"undefined":X(Reflect))==="object"?Reflect:null,Hp=Pe&&typeof Pe.apply=="function"?Pe.apply:function(r,e,d){return Function.prototype.apply.call(r,e,d)},ux=Pe&&typeof Pe.ownKeys=="function"?Pe.ownKeys:Object.getOwnPropertySymbols?function(r){return Object.getOwnPropertyNames(r).concat(Object.getOwnPropertySymbols(r))}:function(r){return Object.getOwnPropertyNames(r)},Ip=Number.isNaN||function(r){return r!=r};ea.EventEmitter=ea,ea.prototype._events=void 0,ea.prototype._eventsCount=0,ea.prototype._maxListeners=void 0;var Jp=10;Object.defineProperty(ea,"defaultMaxListeners",{enumerable:!0,get:function(){return Jp},set:function(r){if(typeof r!="number"||0>r||Ip(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");Jp=r}}),ea.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ea.prototype.setMaxListeners=function(r){if(typeof r!="number"||0>r||Ip(r))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+r+".");return this._maxListeners=r,this},ea.prototype.getMaxListeners=function(){return this._maxListeners===void 0?ea.defaultMaxListeners:this._maxListeners},ea.prototype.emit=function(r){for(var e=[],d=1;d<arguments.length;d++)e.push(arguments[d]);d=r==="error";var h=this._events;if(h!==void 0)d=d&&h.error===void 0;else if(!d)return!1;if(d){var f;throw 0<e.length&&(f=e[0]),f instanceof Error?f:((e=Error("Unhandled error."+(f?" ("+f.message+")":""))).context=f,e)}if((d=h[r])===void 0)return!1;if(typeof d=="function")Hp(d,this,e);else for(h=Cl(d,f=d.length),d=0;d<f;++d)Hp(h[d],this,e);return!0},ea.prototype.addListener=function(r,e){return zl(this,r,e,!1)},ea.prototype.on=ea.prototype.addListener,ea.prototype.prependListener=function(r,e){return zl(this,r,e,!0)},ea.prototype.once=function(r,e){return ng(e),this.on(r,Al(this,r,e)),this},ea.prototype.prependOnceListener=function(r,e){return ng(e),this.prependListener(r,Al(this,r,e)),this},ea.prototype.removeListener=function(r,e){var d;ng(e);var h=this._events;if(h===void 0)return this;var f=h[r];if(f===void 0)return this;if(f===e||f.listener===e)--this._eventsCount==0?this._events=Object.create(null):(delete h[r],h.removeListener&&this.emit("removeListener",r,f.listener||e));else if(typeof f!="function"){var g=-1;for(d=f.length-1;0<=d;d--)if(f[d]===e||f[d].listener===e){var C=f[d].listener;g=d;break}if(0>g)return this;if(g===0)f.shift();else{for(;g+1<f.length;g++)f[g]=f[g+1];f.pop()}f.length===1&&(h[r]=f[0]),h.removeListener!==void 0&&this.emit("removeListener",r,C||e)}return this},ea.prototype.off=ea.prototype.removeListener,ea.prototype.removeAllListeners=function(r){var e=this._events;if(e===void 0)return this;if(e.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):e[r]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete e[r]),this;if(arguments.length===0){var d=Object.keys(e);for(e=0;e<d.length;++e){var h=d[e];h!=="removeListener"&&this.removeAllListeners(h)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(d=e[r])=="function")this.removeListener(r,d);else if(d!==void 0)for(e=d.length-1;0<=e;e--)this.removeListener(r,d[e]);return this},ea.prototype.listeners=function(r){return Bl(this,r,!0)},ea.prototype.rawListeners=function(r){return Bl(this,r,!1)},ea.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):Dl.call(r,e)},ea.prototype.listenerCount=Dl,ea.prototype.eventNames=function(){return 0<this._eventsCount?ux(this._events):[]},ea.once=function(r,e){return new Promise(function(d,h){function f(C){r.removeListener(e,g),h(C)}function g(){typeof r.removeListener=="function"&&r.removeListener("error",f),d([].slice.call(arguments))}El(r,e,g,{once:!0}),e!=="error"&&vs(r,f,{once:!0})})};var Qe=Object.assign,Kp=Object.defineProperty,Lp=!Qe||R(function(){if(ka&&Qe({b:1},Qe(Kp({},"a",{enumerable:!0,get:function(){Kp(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var r={},e={},d=Symbol();return r[d]=7,"abcdefghijklmnopqrst".split("").forEach(function(h){e[h]=h}),Qe({},r)[d]!=7||Dc(Qe({},e)).join("")!="abcdefghijklmnopqrst"})?function(r,e){for(var d=Qa(r),h=arguments.length,f=1,g=Bf.f,C=zf;h>f;)for(var P,x=Af(arguments[f++]),B=g?Dc(x).concat(g(x)):Dc(x),Vt=B.length,_r=0;Vt>_r;)P=B[_r++],(!ka||C.call(x,P))&&(d[P]=x[P]);return d}:Qe;N({target:"Object",stat:!0,forced:Object.assign!==Lp},{assign:Lp}),zp("Map",function(r){return function(){return r(this,arguments.length?arguments[0]:void 0)}},Cp);var vx=Math.log,wx=Math.LN2;N({target:"Math",stat:!0},{log2:function(r){return vx(r)/wx}});var xx=Ra.f,yx=Hd.f,zx=Za.enforce,Ax=qa("match"),sc=y.RegExp,lk=sc.prototype,Wf=/a/g,mk=/a/g,nk=new sc(Wf)!==Wf;if(ka&&nc("RegExp",!nk||pc||R(function(){return mk[Ax]=!1,sc(Wf)!=Wf||sc(mk)==mk||sc(Wf,"i")!="/a/i"}))){for(var Oc=function(r,e){var d,h=this instanceof Oc,f=Lj(r),g=e===void 0;return!h&&f&&r.constructor===Oc&&g||(nk?f&&!g&&(r=r.source):r instanceof Oc&&(g&&(e=tj.call(r)),r=r.source),pc&&(d=!!e&&-1<e.indexOf("y"))&&(e=e.replace(/y/g,"")),r=lh(nk?new sc(r,e):sc(r,e),h?this:lk,Oc),pc&&d&&(zx(r).sticky=!0)),r},Bx=function(r){r in Oc||xx(Oc,r,{configurable:!0,get:function(){return sc[r]},set:function(e){sc[r]=e}})},Mp=yx(sc),Np=0;Mp.length>Np;)Bx(Mp[Np++]);lk.constructor=Oc,Oc.prototype=lk,Ta(y,"RegExp",Oc)}If("RegExp"),Sf("Float32",function(r){return function(e,d,h){return r(this,e,d,h)}}),Sf("Float64",function(r){return function(e,d,h){return r(this,e,d,h)}}),Sf("Uint32",function(r){return function(e,d,h){return r(this,e,d,h)}}),Sf("Uint16",function(r){return function(e,d,h){return r(this,e,d,h)}});var ok=function(r,e){return r===e?0:r==null?e==null?0:-1:e==null?r==null?0:1:typeof r.compare=="function"?r.compare(e):typeof e.compare=="function"?-e.compare(r):r<e?-1:r>e?1:0},pk=[],Op=pk.sort,Cx=R(function(){pk.sort(void 0)}),Dx=R(function(){pk.sort(null)}),Ex=Ee("sort");N({target:"Array",proto:!0,forced:Cx||!Dx||!Ex},{sort:function(r){return r===void 0?Op.call(Qa(this)):Op.call(Qa(this),yb(r))}});var Pp=Object.getPrototypeOf({}),Xf=function(r,e){var d;return r===e||(r==null?r==e:X(r.equiv)==="function"?r.equiv(e):e==null?r==e:X(e.equiv)==="function"?e.equiv(r):X(r)!=="string"&&X(e)!=="string"&&((d=Object.getPrototypeOf(r))!=null&&d!==Pp||(d=Object.getPrototypeOf(e))!=null&&d!==Pp?X(r)!=="function"&&r.length!==void 0&&X(e)!=="function"&&e.length!==void 0?Gx(r,e):r instanceof Set&&e instanceof Set?Hx(r,e):r instanceof Map&&e instanceof Map?Ix(r,e):r instanceof Date&&e instanceof Date?r.getTime()===e.getTime():r instanceof RegExp&&e instanceof RegExp?r.toString()===e.toString():r!=r&&e!=e:Fx(r,e)))},Gx=function(r,e){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf,h=r.length;if(h===e.length)for(;0<=--h&&d(r[h],e[h]););return 0>h},Hx=function(r,e){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;return r.size===e.size&&d(G(r.keys()).sort(),G(e.keys()).sort())},Ix=function(r,e){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;return r.size===e.size&&d(G(r).sort(),G(e).sort())},Fx=function(r,e){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;if(Object.keys(r).length!==Object.keys(e).length)return!1;for(var h in r)if(!e.hasOwnProperty(h)||!d(r[h],e[h]))return!1;return!0},Qp=function(r){var e=1<arguments.length&&arguments[1]!==void 0?arguments[1]:function(d){return d!==void 0?": "+d:""};return function(d){function h(g){return W(this,h),f.call(this,r(g)+e(g))}la(h,d);var f=ma(h);return h}(ef(Error))},Jx=Qp(function(){return"illegal argument(s)"}),vh=function(r){throw new Jx(r)},qk=Qp(function(){return"index out of bounds"}),Rp=1/4294967295,Kx=function(){function r(){W(this,r)}return Ha(r,[{key:"float",value:function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return this.int()*Rp*e}},{key:"norm",value:function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(this.int()*Rp-.5)*e}},{key:"minmax",value:function(e,d){return this.float()*(d-e)+e}}]),r}(),rk=Math.random,Lx=new(function(r){function e(){return W(this,e),d.apply(this,arguments)}la(e,r);var d=ma(e);return Ha(e,[{key:"int",value:function(){return 4294967296*rk()>>>0}},{key:"float",value:function(){var h=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return rk()*h}},{key:"norm",value:function(){var h=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(rk()-.5)*h}}]),e}(Kx)),Vh=Symbol(),Hl=function(){},Mx=fk.onFreeze,sk=Object.freeze,Nx=R(function(){sk(1)});N({target:"Object",stat:!0,forced:Nx,sham:!yp},{freeze:function(r){return sk&&ha(r)?sk(Mx(r)):r}});var Ox=Ee("reduce"),Px=!Hc&&79<id&&83>id;N({target:"Array",proto:!0,forced:!Ox||Px},{reduce:function(r){return Wo(this,r,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Gl=function(r){return r!=null&&typeof r.xform=="function"?r.xform():r},og=function(){function r(e){W(this,r),this.value=e}return Ha(r,[{key:"deref",value:function(){return this.value}}]),r}(),Wh=function(r){return r instanceof og?r.deref():r},xs=function(r,e){return[r,function(d){return d},e]},Qx=w.mark(function(r,e){var d,h,f,g,C,P;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:d=Gl(r)(ws()),h=d[1],f=d[2],g=0;case 4:if(!(g<e.length)){x.next=15;break}if(C=e[g],!((P=f([],C))instanceof og)){x.next=10;break}return x.delegateYield(Wh(h(P.deref())),"t0",9);case 9:return x.abrupt("return");case 10:if(!P.length){x.next=12;break}return x.delegateYield(P,"t1",12);case 12:g++,x.next=4;break;case 15:return x.delegateYield(Wh(h([])),"t2",16);case 16:case"end":return x.stop()}},Qx)}),ys=w.mark(Fl),zs=function(r,e){return[r[0],r[1],e]},Sp=!0;"findIndex"in[]&&Array(1).findIndex(function(){Sp=!1}),N({target:"Array",proto:!0,forced:Sp},{findIndex:function(r){return An(this,r,1<arguments.length?arguments[1]:void 0)}}),Ld("findIndex"),N({target:"Array",proto:!0},{fill:yj}),Ld("fill");var Rx=function(){function r(e){W(this,r),this._length=0,e&&this.into(e)}return Ha(r,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new r(this)}},{key:"empty",value:function(){return new r}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var e,d=this.head;d;)e=d.next,delete d.value,delete d.prev,delete d.next,d=e;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(e){var d=this._length;if(d<e._length)return-1;if(d>e._length)return 1;if(d===0)return 0;d=this.head,e=e.head;for(var h=0;d&&h==0;)h=ok(d.value,e.value),d=d.next,e=e.next;return h}},{key:"equiv",value:function(e){if(!(e instanceof r||e!=null&&typeof e!="function"&&e.length!==void 0)||this._length!==e.length)return!1;if(!this._length||this===e)return!0;for(var d=this.head,h=0;h<e.length;h++){if(!Xf(d.value,e[h]))return!1;d=d.next}return!0}},{key:Symbol.iterator,value:w.mark(function e(){var d;return w.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:d=this.head;case 1:if(!d){h.next=7;break}return h.next=4,d.value;case 4:d=d.next,h.next=1;break;case 7:case"end":return h.stop()}},e,this)})},{key:"seq",value:function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;if(!(e>=d||0>e)){e=this.nthCell(e);var h=this.nthCell(d-1);return d=function f(g){return{first:function(){return g.value},next:function(){return g!==h&&g.next?f(g.next):void 0}}},e?d(e):void 0}}},{key:"cycle",value:w.mark(function e(){return w.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.delegateYield(this,"t0",2);case 2:d.next=0;break;case 4:case"end":return d.stop()}},e,this)})},{key:"$reduce",value:function(e,d){for(var h=this.head;h&&!(d instanceof og);)d=e(d,h.value),h=h.next;return d}},{key:"drop",value:function(){var e=this.head;if(e)return(this.head=e.next)?delete this.head.prev:delete this.tail,this._length--,e.value}},{key:"cons",value:function(e){return e={value:e,next:this.head},this.head?this.head.prev=e:this.tail=e,this.head=e,this._length++,this}},{key:"insertBefore",value:function(e,d){return e||vh("cell is undefined"),d={value:d,next:e,prev:e.prev},e.prev?e.prev.next=d:this.head=d,e.prev=d,this._length++,this}},{key:"insertAfter",value:function(e,d){return e||vh("cell is undefined"),d={value:d,next:e.next,prev:e},e.next?e.next.prev=d:this.tail=d,e.next=d,this._length++,this}},{key:"insertBeforeNth",value:function(e,d){if(0>e&&(e+=this._length),0>=e)return this.cons(d);if(0>e||e>=this._length)throw new qk(e);return this.insertBefore(this.nthCellUnsafe(e),d)}},{key:"insertAfterNth",value:function(e,d){if(0>e&&(e+=this._length),e>=this._length-1)return this.push(d);if(0>e||e>=this._length)throw new qk(e);return this.insertAfter(this.nthCellUnsafe(e),d)}},{key:"insertSorted",value:function(e,d){d=d||ok;for(var h=this.head;h;){if(0>=d(e,h.value))return this.insertBefore(h,e);h=h.next}return this.push(e)}},{key:"find",value:function(e){for(var d=this.head;d;){if(d.value===e)return d;d=d.next}}},{key:"findWith",value:function(e){for(var d=this.head;d;){if(e(d.value))return d;d=d.next}}},{key:"concat",value:function(){for(var e=this.copy(),d=arguments.length,h=Array(d),f=0;f<d;f++)h[f]=arguments[f];for(d=0;d<h.length;d++)e.into(h[d]);return e}},{key:"into",value:function(e){for(var d=0;d<e.length;d++)this.push(e[d])}},{key:"slice",value:function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;e=0>e?e+this._length:e,d=0>d?d+this._length:d,(0>e||0>d)&&vh("invalid indices: ${from} / ${to}");for(var h=new r,f=this.nthCell(e);f&&++e<=d;)h.push(f.value),f=f.next;return h}},{key:"splice",value:function(e){var d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,h=2<arguments.length?arguments[2]:void 0;if(typeof e=="number"){if(0>e&&(e+=this._length),0>e||e>=this._length)throw new qk(e);var f=this.nthCellUnsafe(e)}else f=e;var g=new r;if(0<d)for(;f&&0<d--;)this.remove(f),g.push(f.value),f=f.next;else f&&(f=f.next);if(h)if(f)for(d=0;d<h.length;d++)this.insertBefore(f,h[d]);else for(f=0;f<h.length;f++)this.push(h[f]);return g}},{key:"remove",value:function(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,this._length--,this}},{key:"swap",value:function(e,d){if(e!==d){var h=e.value;e.value=d.value,d.value=h}return this}},{key:"push",value:function(e){return this.tail?(e={value:e,prev:this.tail},this.tail=this.tail.next=e,this._length++,this):this.cons(e)}},{key:"pop",value:function(){var e=this.tail;if(e)return(this.tail=e.prev)?delete this.tail.next:delete this.head,this._length--,e.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(e){return this.head?(this.head.value=e,this):this.cons(e)}},{key:"setTail",value:function(e){return this.tail?(this.tail.value=e,this):this.push(e)}},{key:"setNth",value:function(e,d){var h=this.nthCell(e);return!h&&vh("index out of bounds: ".concat(e)),h.value=d,this}},{key:"nth",value:function(e,d){return(e=this.nthCell(e))?e.value:d}},{key:"nthCell",value:function(e){if(0>e&&(e+=this._length),!(0>e||e>=this._length))return this.nthCellUnsafe(e)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var e=this.peek();return this.pop(),this.cons(e)}}},{key:"map",value:function(e){for(var d=new r,h=this.head;h;)d.push(e(h.value)),h=h.next;return d}},{key:"filter",value:function(e){for(var d=new r,h=this.head;h;)e(h.value)&&d.push(h.value),h=h.next;return d}},{key:"reduce",value:function(e,d){for(var h=this.head;h;)d=e(d,h.value),h=h.next;return d}},{key:"shuffle",value:function(e){var d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:Lx;if(2>this._length)return this;for(e=e??Math.ceil(1.5*Math.log2(this._length));0<e;e--)for(var h=this.head;h;){var f=h.next;.5>d.float()?this.asHead(h):this.asTail(h),h=f}return this}},{key:"sort",value:function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:ok;if(!this._length)return this;for(var d=1;;){var h=this.head;this.tail=this.head=void 0;for(var f=0;h;){f++;for(var g=h,C=0,P=0;P<d&&(C++,g=g.next);P++);for(P=d;0<C||0<P&&g;){if(C===0){var x=g;g=g.next,P--}else g&&P!==0?0>=e(h.value,g.value)?(x=h,h=h.next,C--):(x=g,g=g.next,P--):(x=h,h=h.next,C--);this.tail?this.tail.next=x:this.head=x,x.prev=this.tail,this.tail=x}h=g}if(this.tail.next=void 0,1>=f)return this;d*=2}}},{key:"reverse",value:function(){for(var e=this.head,d=this.tail,h=(this._length>>>1)+(1&this._length);e&&d&&0<h;){var f=e.value;e.value=d.value,d.value=f,e=e.next,d=d.prev,h--}return this}},{key:"asHead",value:function(e){return e===this.head||(this.remove(e),this.head.prev=e,e.next=this.head,e.prev=void 0,this.head=e,this._length++),this}},{key:"asTail",value:function(e){return e===this.tail||(this.remove(e),this.tail.next=e,e.prev=this.tail,e.next=void 0,this.tail=e,this._length++),this}},{key:"toString",value:function(){for(var e=[],d=this.head;d;)e.push(String(d.value)),d=d.next;return e.join(", ")}},{key:"toJSON",value:function(){return G(this)}},{key:"nthCellUnsafe",value:function(e){if(e<=this._length>>1)var d=this.head,h="next";else d=this.tail,h="prev",e=this._length-e-1;for(;0<e--&&d;)d=d[h];return d}}]),r}(),tc=function(){function r(e,d){W(this,r),d=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},d),this.map=d.map(),this.items=new Rx,this._size=0,this.opts=d,e&&this.into(e)}return Ha(r,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return pg(function(e){return[e.k,e]},this.items)}},{key:"keys",value:function(){return pg(function(e){return e.k},this.items)}},{key:"values",value:function(){return pg(function(e){return e.v},this.items)}},{key:"copy",value:function(){var e=this.empty();e.items=this.items.copy();for(var d=e.items.head;d;)e.map.set(d.value.k,d),d=d.next;return e}},{key:"empty",value:function(){return new r(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var e=this.opts.release;if(e){for(var d;d=this.items.drop();)e(d.k,d.v);return!0}return this.items.release()}},{key:"has",value:function(e){return this.map.has(e)}},{key:"get",value:function(e,d){return(e=this.map.get(e))?this.resetEntry(e):d}},{key:"set",value:function(e,d){var h=this.opts.ksize(e)+this.opts.vsize(d),f=this.map.get(e);return this._size+=Math.max(0,h-(f?f.value.s:0)),this.ensureSize()&&this.doSetEntry(f,e,d,h),d}},{key:"into",value:function(e){for(var d=0;d<e.length;d++){var h=e[d];this.set(h[0],h[1])}return this}},{key:"getSet",value:function(e,d){var h=this,f=this.map.get(e);return f?Promise.resolve(this.resetEntry(f)):d().then(function(g){return h.set(e,g)})}},{key:"delete",value:function(e){return!!(e=this.map.get(e))&&(this.removeEntry(e),!0)}},{key:"resetEntry",value:function(e){return this.items.asTail(e),e.value.v}},{key:"ensureSize",value:function(){for(var e=this.opts.release,d=this.opts.maxsize,h=this.opts.maxlen;this._size>d||this.length>=h;){var f=this.items.drop();if(!f)return!1;this.map.delete(f.k),e&&e(f.k,f.v),this._size-=f.s}return!0}},{key:"removeEntry",value:function(e){var d=e.value;this.map.delete(d.k),this.items.remove(e),this.opts.release&&this.opts.release(d.k,d.v),this._size-=d.s}},{key:"doSetEntry",value:function(e,d,h,f){e?(e.value.v=h,e.value.s=f,this.items.asTail(e)):(this.items.push({k:d,v:h,s:f}),this.map.set(d,this.items.tail))}}]),r}(),Sx=function(r){function e(h,f){return W(this,e),f=Object.assign({ttl:36e5},f),d.call(this,h,f)}la(e,r);var d=ma(e);return Ha(e,[{key:"empty",value:function(){return new e(null,this.opts)}},{key:"has",value:function(h){return this.get(h)!==void 0}},{key:"get",value:function(h,f){if(h=this.map.get(h)){if(h.value.t>=Date.now())return this.resetEntry(h);this.removeEntry(h)}return f}},{key:"set",value:function(h,f){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,C=this.opts.ksize(h)+this.opts.vsize(f),P=this.map.get(h);return this._size+=Math.max(0,C-(P?P.value.s:0)),this.ensureSize()&&(g=Date.now()+g,P?(P.value.v=f,P.value.s=C,P.value.t=g,this.items.asTail(P)):(this.items.push({k:h,v:f,s:C,t:g}),this.map.set(h,this.items.tail))),f}},{key:"getSet",value:function(h,f){var g=this,C=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,P=this.get(h);return P?Promise.resolve(P):f().then(function(x){return g.set(h,x,C)})}},{key:"prune",value:function(){for(var h=Date.now(),f=this.items.head;f;)f.value.t<h&&this.removeEntry(f),f=f.next}},{key:"ensureSize",value:function(){for(var h=this.opts.maxsize,f=this.opts.maxlen,g=Date.now(),C=this.items.head;C&&(this._size>h||this.length>=f);)C.value.t<g&&this.removeEntry(C),C=C.next;return Th(wd(e.prototype),"ensureSize",this).call(this)}}]),e}(tc),Tp=X(Ya)=="object"&&Ya&&Ya.Object===Object&&Ya,Tx=(typeof self>"u"?"undefined":X(self))=="object"&&self&&self.Object===Object&&self,Cb=Tp||Tx||Function("return this")(),Pb=Cb.Symbol,Up=Object.prototype,Ux=Up.hasOwnProperty,Vx=Up.toString,Yf=Pb?Pb.toStringTag:void 0,Wx=Object.prototype.toString,Vp=Pb?Pb.toStringTag:void 0,Qd=function(r){if(r==null)r=r===void 0?"[object Undefined]":"[object Null]";else if(Vp&&Vp in Object(r)){var e=Ux.call(r,Yf),d=r[Yf];try{r[Yf]=void 0;var h=!0}catch{}var f=Vx.call(r);h&&(e?r[Yf]=d:delete r[Yf]),r=f}else r=Wx.call(r);return r},lb=function(r){var e=X(r);return r!=null&&(e=="object"||e=="function")},qi=function(r){return!!lb(r)&&((r=Qd(r))=="[object Function]"||r=="[object GeneratorFunction]"||r=="[object AsyncFunction]"||r=="[object Proxy]")},tk=Cb["__core-js_shared__"],Wp=function(){var r=/[^.]+$/.exec(tk&&tk.keys&&tk.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}(),Xx=Function.prototype.toString,Rd=function(r){if(r!=null){try{return Xx.call(r)}catch{}return r+""}return""},Yx=/^\[object .+?Constructor\]$/,Zx=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Sd=function(r,e){return r=r==null?void 0:r[e],!lb(r)||Wp&&Wp in r||!(qi(r)?Zx:Yx).test(Rd(r))?void 0:r},Zf=Sd(Object,"create"),$x=Object.prototype.hasOwnProperty,ay=Object.prototype.hasOwnProperty;zd.prototype.clear=function(){this.__data__=Zf?Zf(null):{},this.size=0},zd.prototype.delete=function(r){return r=this.has(r)&&delete this.__data__[r],this.size-=r?1:0,r},zd.prototype.get=function(r){var e=this.__data__;return Zf?(r=e[r])==="__lodash_hash_undefined__"?void 0:r:$x.call(e,r)?e[r]:void 0},zd.prototype.has=function(r){var e=this.__data__;return Zf?e[r]!==void 0:ay.call(e,r)},zd.prototype.set=function(r,e){var d=this.__data__;return this.size+=this.has(r)?0:1,d[r]=Zf&&e===void 0?"__lodash_hash_undefined__":e,this};var $f=function(r,e){return r===e||r!=r&&e!=e},wh=function(r,e){for(var d=r.length;d--;)if($f(r[d][0],e))return d;return-1},by=Array.prototype.splice;ce.prototype.clear=function(){this.__data__=[],this.size=0},ce.prototype.delete=function(r){var e=this.__data__;return!(0>(r=wh(e,r)))&&(r==e.length-1?e.pop():by.call(e,r,1),--this.size,!0)},ce.prototype.get=function(r){var e=this.__data__;return 0>(r=wh(e,r))?void 0:e[r][1]},ce.prototype.has=function(r){return-1<wh(this.__data__,r)},ce.prototype.set=function(r,e){var d=this.__data__,h=wh(d,r);return 0>h?(++this.size,d.push([r,e])):d[h][1]=e,this};var rg=ce,ag=Sd(Cb,"Map"),xh=function(r,e){r=r.__data__;var d=X(e);return(d=="string"||d=="number"||d=="symbol"||d=="boolean"?e!=="__proto__":e===null)?r[typeof e=="string"?"string":"hash"]:r.map};de.prototype.clear=function(){this.size=0,this.__data__={hash:new zd,map:new(ag||rg),string:new zd}},de.prototype.delete=function(r){return r=xh(this,r).delete(r),this.size-=r?1:0,r},de.prototype.get=function(r){return xh(this,r).get(r)},de.prototype.has=function(r){return xh(this,r).has(r)},de.prototype.set=function(r,e){var d=xh(this,r),h=d.size;return d.set(r,e),this.size+=d.size==h?0:1,this};var qg=de;gf.prototype.add=gf.prototype.push=function(r){return this.__data__.set(r,"__lodash_hash_undefined__"),this},gf.prototype.has=function(r){return this.__data__.has(r)};var Xp=function(r,e,d,h){var f=r.length;for(d+=h?1:-1;h?d--:++d<f;)if(e(r[d],d,r))return d;return-1},cy=function(r){return r!=r},dy=function(r,e){var d;if(d=!(r==null||!r.length)){if(e==e)t:{d=-1;for(var h=r.length;++d<h;)if(r[d]===e){r=d;break t}r=-1}else r=Xp(r,cy,0);d=-1<r}return d},ey=function(r,e,d){for(var h=-1,f=r==null?0:r.length;++h<f;)if(d(e,r[h]))return!0;return!1},fy=function(r,e){return r.has(e)},Re=Sd(Cb,"Set"),gy=function(){},uk=function(r){var e=-1,d=Array(r.size);return r.forEach(function(h){d[++e]=h}),d},hy=1/0,iy=Re&&1/uk(new Re([,-0]))[1]==hy?function(r){return new Re(r)}:gy,vk=function(r,e,d){var h=-1,f=dy,g=r.length,C=!0,P=[],x=P;if(d)C=!1,f=ey;else if(200<=g){if(f=e?null:iy(r))return uk(f);C=!1,f=fy,x=new gf}else x=e?[]:P;t:for(;++h<g;){var B=r[h],Vt=e?e(B):B;if(B=d||B!==0?B:0,C&&Vt==Vt){for(var _r=x.length;_r--;)if(x[_r]===Vt)continue t;e&&x.push(Vt),P.push(B)}else f(x,Vt,d)||(x!==P&&x.push(Vt),P.push(B))}return P},Yp=function(r){for(var e=-1,d=r==null?0:r.length,h={};++e<d;){var f=r[e];h[f[0]]=f[1]}return h},he=function(r,e){for(var d=-1,h=r==null?0:r.length,f=Array(h);++d<h;)f[d]=e(r[d],d,r);return f};ee.prototype.clear=function(){this.__data__=new rg,this.size=0},ee.prototype.delete=function(r){var e=this.__data__;return r=e.delete(r),this.size=e.size,r},ee.prototype.get=function(r){return this.__data__.get(r)},ee.prototype.has=function(r){return this.__data__.has(r)},ee.prototype.set=function(r,e){var d=this.__data__;if(d instanceof rg){var h=d.__data__;if(!ag||199>h.length)return h.push([r,e]),this.size=++d.size,this;d=this.__data__=new qg(h)}return d.set(r,e),this.size=d.size,this};var ge=ee,Is=function(r,e){for(var d=-1,h=r==null?0:r.length;++d<h&&e(r[d],d,r)!==!1;);return r},yh=function(){try{var r=Sd(Object,"defineProperty");return r({},"",{}),r}catch{}}(),bg=function(r,e,d){e=="__proto__"&&yh?yh(r,e,{configurable:!0,enumerable:!0,value:d,writable:!0}):r[e]=d},jy=Object.prototype.hasOwnProperty,Ml=function(r,e,d){var h=r[e];jy.call(r,e)&&$f(h,d)&&(d!==void 0||e in r)||bg(r,e,d)},re=function(r,e,d,h){var f=!d;d||(d={});for(var g=-1,C=e.length;++g<C;){var P=e[g],x=h?h(d[P],r[P],P,d,r):void 0;x===void 0&&(x=r[P]),f?bg(d,P,x):Ml(d,P,x)}return d},gc=function(r){return r!=null&&X(r)=="object"},Zp=function(r){return gc(r)&&Qd(r)=="[object Arguments]"},$p=Object.prototype,ky=$p.hasOwnProperty,ly=$p.propertyIsEnumerable,rf=Zp(function(){return arguments}())?Zp:function(r){return gc(r)&&ky.call(r,"callee")&&!ly.call(r,"callee")},Va=Array.isArray,my=function(){return!1},jf=$a(function(r,e){var d=(e=e&&!e.nodeType&&e)&&r&&!r.nodeType&&r;e=d&&d.exports===e?Cb.Buffer:void 0,r.exports=(e?e.isBuffer:void 0)||my}),ny=/^(?:0|[1-9]\d*)$/,wk=function(r,e){var d=X(r);return!!(e=e??9007199254740991)&&(d=="number"||d!="symbol"&&ny.test(r))&&-1<r&&r%1==0&&r<e},xk=function(r){return typeof r=="number"&&-1<r&&r%1==0&&9007199254740991>=r},Ea={};Ea["[object Float32Array]"]=Ea["[object Float64Array]"]=Ea["[object Int8Array]"]=Ea["[object Int16Array]"]=Ea["[object Int32Array]"]=Ea["[object Uint8Array]"]=Ea["[object Uint8ClampedArray]"]=Ea["[object Uint16Array]"]=Ea["[object Uint32Array]"]=!0,Ea["[object Arguments]"]=Ea["[object Array]"]=Ea["[object ArrayBuffer]"]=Ea["[object Boolean]"]=Ea["[object DataView]"]=Ea["[object Date]"]=Ea["[object Error]"]=Ea["[object Function]"]=Ea["[object Map]"]=Ea["[object Number]"]=Ea["[object Object]"]=Ea["[object RegExp]"]=Ea["[object Set]"]=Ea["[object String]"]=Ea["[object WeakMap]"]=!1;var oy=function(r){return gc(r)&&xk(r.length)&&!!Ea[Qd(r)]},zh=function(r){return function(e){return r(e)}},Se=$a(function(r,e){var d=e&&!e.nodeType&&e;d=(e=d&&r&&!r.nodeType&&r)&&e.exports===d&&Tp.process;t:{try{var h=e&&e.require&&e.require("util").types;if(h){var f=h;break t}f=d&&d.binding&&d.binding("util");break t}catch{}f=void 0}r.exports=f}),aq=Se&&Se.isTypedArray,bi=aq?zh(aq):oy,py=Object.prototype.hasOwnProperty,bq=function(r,e){var d=Va(r),h=!d&&rf(r),f=!d&&!h&&jf(r),g=!d&&!h&&!f&&bi(r);if(d=d||h||f||g){h=r.length;for(var C=String,P=-1,x=Array(h);++P<h;)x[P]=C(P);h=x}else h=[];for(var B in C=h.length,r)!e&&!py.call(r,B)||d&&(B=="length"||f&&(B=="offset"||B=="parent")||g&&(B=="buffer"||B=="byteLength"||B=="byteOffset")||wk(B,C))||h.push(B);return h},qy=Object.prototype,yk=function(r){var e=r&&r.constructor;return r===(typeof e=="function"&&e.prototype||qy)},cq=function(r,e){return function(d){return r(e(d))}},ry=cq(Object.keys,Object),sy=Object.prototype.hasOwnProperty,Ed=function(r){return r!=null&&xk(r.length)&&!qi(r)},Ad=function(r){if(Ed(r))r=bq(r);else if(yk(r)){var e,d=[];for(e in Object(r))sy.call(r,e)&&e!="constructor"&&d.push(e);r=d}else r=ry(r);return r},Es=function(r,e){return r&&re(e,Ad(e),r)},ty=Object.prototype.hasOwnProperty,kf=function(r){if(Ed(r))r=bq(r,!0);else if(lb(r)){var e=yk(r),d=[];for(h in r)(h!="constructor"||!e&&ty.call(r,h))&&d.push(h);r=d}else{var h=[];if(r!=null)for(e in Object(r))h.push(e);r=h}return r},Cs=function(r,e){return r&&re(e,kf(e),r)},Jl=$a(function(r,e){var d=(e=e&&!e.nodeType&&e)&&r&&!r.nodeType&&r,h=(e=d&&d.exports===e?Cb.Buffer:void 0)?e.allocUnsafe:void 0;r.exports=function(f,g){return g?f.slice():(g=f.length,g=h?h(g):new f.constructor(g),f.copy(g),g)}}),Xh=function(r,e){var d=-1,h=r.length;for(e||(e=Array(h));++d<h;)e[d]=r[d];return e},uy=function(r,e){for(var d=-1,h=r==null?0:r.length,f=0,g=[];++d<h;){var C=r[d];e(C,d,r)&&(g[f++]=C)}return g},dq=function(){return[]},vy=Object.prototype.propertyIsEnumerable,eq=Object.getOwnPropertySymbols,zk=eq?function(r){return r==null?[]:(r=Object(r),uy(eq(r),function(e){return vy.call(r,e)}))}:dq,Ds=function(r,e){return re(r,zk(r),e)},ai=function(r,e){for(var d=-1,h=e.length,f=r.length;++d<h;)r[f+d]=e[d];return r},Ak=cq(Object.getPrototypeOf,Object),fq=Object.getOwnPropertySymbols?function(r){for(var e=[];r;)ai(e,zk(r)),r=Ak(r);return e}:dq,Bs=function(r,e){return re(r,fq(r),e)},gq=function(r,e,d){return e=e(r),Va(r)?e:ai(e,d(r))},Yh=function(r){return gq(r,Ad,zk)},Ll=function(r){return gq(r,kf,fq)},Bk=Sd(Cb,"DataView"),Ck=Sd(Cb,"Promise"),Dk=Sd(Cb,"WeakMap"),wy=Rd(Bk),xy=Rd(ag),yy=Rd(Ck),zy=Rd(Re),Ay=Rd(Dk),Td=Qd;(Bk&&Td(new Bk(new ArrayBuffer(1)))!="[object DataView]"||ag&&Td(new ag)!="[object Map]"||Ck&&Td(Ck.resolve())!="[object Promise]"||Re&&Td(new Re)!="[object Set]"||Dk&&Td(new Dk)!="[object WeakMap]")&&(Td=function(r){var e=Qd(r);if(r=(r=e=="[object Object]"?r.constructor:void 0)?Rd(r):"")switch(r){case wy:return"[object DataView]";case xy:return"[object Map]";case yy:return"[object Promise]";case zy:return"[object Set]";case Ay:return"[object WeakMap]"}return e});var hf=Td,By=Object.prototype.hasOwnProperty,As=function(r){var e=r.length,d=new r.constructor(e);return e&&typeof r[0]=="string"&&By.call(r,"index")&&(d.index=r.index,d.input=r.input),d},Ah=Cb.Uint8Array,Ek=function(r){var e=new r.constructor(r.byteLength);return new Ah(e).set(new Ah(r)),e},Cy=/\w*$/,hq=Pb?Pb.prototype:void 0,iq=hq?hq.valueOf:void 0,vm=function(r,e){return e=e?Ek(r.buffer):r.buffer,new r.constructor(e,r.byteOffset,r.length)},Fs=function(r,e,d){var h=r.constructor;switch(e){case"[object ArrayBuffer]":return Ek(r);case"[object Boolean]":case"[object Date]":return new h(+r);case"[object DataView]":return e=d?Ek(r.buffer):r.buffer,new r.constructor(e,r.byteOffset,r.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return vm(r,d);case"[object Map]":return new h;case"[object Number]":case"[object String]":return new h(r);case"[object RegExp]":return(e=new r.constructor(r.source,Cy.exec(r))).lastIndex=r.lastIndex,e;case"[object Set]":return new h;case"[object Symbol]":return iq?Object(iq.call(r)):{}}},jq=Object.create,Dy=function(){function r(){}return function(e){return lb(e)?jq?jq(e):(r.prototype=e,e=new r,r.prototype=void 0,e):{}}}(),Kl=function(r){return typeof r.constructor!="function"||yk(r)?{}:Dy(Ak(r))},Ey=function(r){return gc(r)&&hf(r)=="[object Map]"},kq=Se&&Se.isMap,Hs=kq?zh(kq):Ey,Fy=function(r){return gc(r)&&hf(r)=="[object Set]"},lq=Se&&Se.isSet,Gs=lq?zh(lq):Fy,wa={};wa["[object Arguments]"]=wa["[object Array]"]=wa["[object ArrayBuffer]"]=wa["[object DataView]"]=wa["[object Boolean]"]=wa["[object Date]"]=wa["[object Float32Array]"]=wa["[object Float64Array]"]=wa["[object Int8Array]"]=wa["[object Int16Array]"]=wa["[object Int32Array]"]=wa["[object Map]"]=wa["[object Number]"]=wa["[object Object]"]=wa["[object RegExp]"]=wa["[object Set]"]=wa["[object String]"]=wa["[object Symbol]"]=wa["[object Uint8Array]"]=wa["[object Uint8ClampedArray]"]=wa["[object Uint16Array]"]=wa["[object Uint32Array]"]=!0,wa["[object Error]"]=wa["[object Function]"]=wa["[object WeakMap]"]=!1;var ie=function(r){return X(r)=="symbol"||gc(r)&&Qd(r)=="[object Symbol]"},Gy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hy=/^\w*$/,Fk=function(r,e){if(Va(r))return!1;var d=X(r);return!(d!="number"&&d!="symbol"&&d!="boolean"&&r!=null&&!ie(r))||Hy.test(r)||!Gy.test(r)||e!=null&&r in Object(e)};Zh.Cache=qg;var Iy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jy=/\\(\\)?/g,Ky=function(r){var e=(r=Zh(r,function(d){return e.size===500&&e.clear(),d})).cache;return r}(function(r){var e=[];return r.charCodeAt(0)===46&&e.push(""),r.replace(Iy,function(d,h,f,g){e.push(f?g.replace(Jy,"$1"):h||d)}),e}),Js=1/0,mq=Pb?Pb.prototype:void 0,Ol=mq?mq.toString:void 0,Bh=function(r,e){return Va(r)?r:Fk(r,e)?[r]:Ky(r==null?"":Nl(r))},Ly=1/0,cg=function(r){if(typeof r=="string"||ie(r))return r;var e=r+"";return e=="0"&&1/r==-Ly?"-0":e},Ch=function(r,e){for(var d=0,h=(e=Bh(e,r)).length;r!=null&&d<h;)r=r[cg(e[d++])];return d&&d==h?r:void 0},My=function(r,e){if(!(2>(e=Bh(e,r)).length)){var d=e,h=0,f=-1,g=-1,C=d.length;for(0>h&&(h=-h>C?0:C+h),0>(f=f>C?C:f)&&(f+=C),C=h>f?0:f-h>>>0,h>>>=0,f=Array(C);++g<C;)f[g]=d[g+h];r=Ch(r,f)}return(d=r==null)||(d=e==null?0:e.length,d=delete r[cg(d?e[d-1]:void 0)]),d},nq=Function.prototype.toString,Ny=Object.prototype.hasOwnProperty,Oy=nq.call(Object),wm=function(r){return!(!gc(r)||Qd(r)!="[object Object]")&&((r=Ak(r))===null||typeof(r=Ny.call(r,"constructor")&&r.constructor)=="function"&&r instanceof r&&nq.call(r)==Oy)},Py=function(r){return wm(r)?void 0:r},oq=Pb?Pb.isConcatSpreadable:void 0,Ks=function(r){return Va(r)||rf(r)||!!(oq&&r&&r[oq])},Qy=function(r){return r!=null&&r.length?$h(r,1):[]},Ry=function(r,e,d){switch(d.length){case 0:return r.call(e);case 1:return r.call(e,d[0]);case 2:return r.call(e,d[0],d[1]);case 3:return r.call(e,d[0],d[1],d[2])}return r.apply(e,d)},pq=Math.max,qq=function(r,e,d){return e=pq(e===void 0?r.length-1:e,0),function(){for(var h=arguments,f=-1,g=pq(h.length-e,0),C=Array(g);++f<g;)C[f]=h[e+f];for(f=-1,g=Array(e+1);++f<e;)g[f]=h[f];return g[e]=d(C),Ry(r,this,g)}},Sy=function(r){return function(){return r}},Dh=function(r){return r},Ty=Date.now,rq=function(r){var e=0,d=0;return function(){var h=Ty(),f=16-(h-d);if(d=h,0<f){if(800<=++e)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}(yh?function(r,e){return yh(r,"toString",{configurable:!0,enumerable:!1,value:Sy(e),writable:!0})}:Dh),Gk=function(r){return rq(qq(r,void 0,Qy),r+"")}(function(r,e){var d={};if(r==null)return d;var h=!1;e=he(e,function(g){return g=Bh(g,r),h||(h=1<g.length),g}),re(r,Ll(r),d),h&&(d=fe(d,7,Py));for(var f=e.length;f--;)My(d,e[f]);return d}),Uy=function(r,e,d,h){for(var f=-1,g=r==null?0:r.length;++f<g;){var C=r[f];e(h,C,d(C),r)}return h},um=function(r,e,d){for(var h=-1,f=Object(r),g=(d=d(r)).length;g--;){var C=d[++h];if(e(f[C],C,f)===!1)break}return r},sq=function(r,e){return r&&um(r,e,Ad)},Hk=function(r,e){return function(d,h){if(d==null)return d;if(!Ed(d))return r(d,h);for(var f=d.length,g=-1,C=Object(d);++g<f&&h(C[g],g,C)!==!1;);return d}}(sq),Vy=function(r,e,d,h){return Hk(r,function(f,g,C){e(h,f,d(f),C)}),h},tq=function(r,e){for(var d=-1,h=r==null?0:r.length;++d<h;)if(e(r[d],d,r))return!0;return!1},Pl=function(r,e,d,h,f,g){var C=1&d,P=r.length,x=e.length;if(P!=x&&!(C&&x>P))return!1;x=g.get(r);var B=g.get(e);if(x&&B)return x==e&&B==r;x=-1,B=!0;var Vt=2&d?new gf:void 0;for(g.set(r,e),g.set(e,r);++x<P;){var _r=r[x],_e=e[x];if(h)var _i=C?h(_e,_r,x,e,r,g):h(_r,_e,x,r,e,g);if(_i!==void 0){if(_i)continue;B=!1;break}if(Vt){if(!tq(e,function(_a,kc){if(!Vt.has(kc)&&(_r===_a||f(_r,_a,d,h,g)))return Vt.push(kc)})){B=!1;break}}else if(_r!==_e&&!f(_r,_e,d,h,g)){B=!1;break}}return g.delete(r),g.delete(e),B},Wy=function(r){var e=-1,d=Array(r.size);return r.forEach(function(h,f){d[++e]=[f,h]}),d},uq=Pb?Pb.prototype:void 0,Ik=uq?uq.valueOf:void 0,Ls=function(r,e,d,h,f,g,C){switch(d){case"[object DataView]":if(r.byteLength!=e.byteLength||r.byteOffset!=e.byteOffset)break;r=r.buffer,e=e.buffer;case"[object ArrayBuffer]":if(r.byteLength!=e.byteLength||!g(new Ah(r),new Ah(e)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return $f(+r,+e);case"[object Error]":return r.name==e.name&&r.message==e.message;case"[object RegExp]":case"[object String]":return r==e+"";case"[object Map]":var P=Wy;case"[object Set]":if(P||(P=uk),r.size!=e.size&&!(1&h))break;return(d=C.get(r))?d==e:(h|=2,C.set(r,e),e=Pl(P(r),P(e),h,f,g,C),C.delete(r),e);case"[object Symbol]":if(Ik)return Ik.call(r)==Ik.call(e)}return!1},Ms=Object.prototype.hasOwnProperty,Ql=Object.prototype.hasOwnProperty,Xy=function(r,e,d,h){var f=d.length,g=f,C=!h;if(r==null)return!g;for(r=Object(r);f--;){var P=d[f];if(C&&P[2]?P[1]!==r[P[0]]:!(P[0]in r))return!1}for(;++f<g;){var x=(P=d[f])[0],B=r[x],Vt=P[1];if(C&&P[2]){if(B===void 0&&!(x in r))return!1}else{if(P=new ge,h)var _r=h(B,Vt,x,r,e,P);if(_r===void 0?!je(Vt,B,3,h,P):!_r)return!1}}return!0},Yy=function(r){for(var e=Ad(r),d=e.length;d--;){var h=e[d],f=r[h];e[d]=[h,f,f==f&&!lb(f)]}return e},vq=function(r,e){return function(d){return d!=null&&d[r]===e&&(e!==void 0||r in Object(d))}},Zy=function(r){var e=Yy(r);return e.length==1&&e[0][2]?vq(e[0][0],e[0][1]):function(d){return d===r||Xy(d,r,e)}},$y=function(r,e){return Fk(r)&&e==e&&!lb(e)?vq(cg(r),e):function(d){var h=d==null?void 0:Ch(d,r);if((h=h===void 0?void 0:h)===void 0&&h===e){if(h=d!=null){for(var f=-1,g=(h=Bh(h=r,d)).length,C=!1;++f<g;){var P=cg(h[f]);if(!(C=d!=null&&d!=null&&P in Object(d)))break;d=d[P]}C||++f!=g?h=C:h=!!(g=d==null?0:d.length)&&xk(g)&&wk(P,g)&&(Va(d)||rf(d))}P=h}else P=je(e,h,3);return P}},az=function(r){return function(e){return e==null?void 0:e[r]}},bz=function(r){return function(e){return Ch(e,r)}},Te=function(r){return typeof r=="function"?r:r==null?Dh:X(r)=="object"?Va(r)?$y(r[0],r[1]):Zy(r):Fk(r)?az(cg(r)):bz(r)},Jk=function(r,e){return function(d,h){var f={};return(Va(d)?Uy:Vy)(d,r,Te(h),f)}}(function(r,e,d){bg(r,d,e)}),uc=function(r,e){var d={};return e=Te(e),sq(r,function(h,f,g){bg(d,f,e(h,f,g))}),d};N({target:"String",proto:!0,forced:R(function(){var r="".sub('"');return r!==r.toLowerCase()||3<r.split('"').length})},{sub:function(){return"<sub>"+String(jb(this))+"</sub>"}});var U=xa,Qb=null;try{Qb=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(r){}xa.prototype.__isLong__,Object.defineProperty(xa.prototype,"__isLong__",{value:!0}),xa.isLong=mb;var Sl={},Rl={};xa.fromInt=Bd,xa.fromNumber=Gb,xa.fromBits=ya;var sg=Math.pow;xa.fromString=ci,xa.fromValue=Wb;var ke=4294967296,Tl=ke*ke,Vl=Tl/2,wq=Bd(16777216),Hb=Bd(0);xa.ZERO=Hb;var Cd=Bd(0,!0);xa.UZERO=Cd;var Ue=Bd(1);xa.ONE=Ue;var xq=Bd(1,!0);xa.UONE=xq;var Kk=Bd(-1);xa.NEG_ONE=Kk;var Wl=ya(-1,2147483647,!1);xa.MAX_VALUE=Wl;var Ul=ya(-1,-1,!0);xa.MAX_UNSIGNED_VALUE=Ul;var nb=ya(0,-2147483648,!1);xa.MIN_VALUE=nb;var D=xa.prototype;D.toInt=function(){return this.unsigned?this.low>>>0:this.low},D.toNumber=function(){return this.unsigned?(this.high>>>0)*ke+(this.low>>>0):this.high*ke+(this.low>>>0)},D.toString=function(r){if(2>(r=r||10)||36<r)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(nb)){var e=Gb(r),d=this.div(e);return e=d.mul(e).sub(this),d.toString(r)+e.toInt().toString(r)}return"-"+this.neg().toString(r)}d=Gb(sg(r,6),this.unsigned),e=this;for(var h="";;){var f=e.div(d),g=(e.sub(f.mul(d)).toInt()>>>0).toString(r);if((e=f).isZero())return g+h;for(;6>g.length;)g="0"+g;h=""+g+h}},D.getHighBits=function(){return this.high},D.getHighBitsUnsigned=function(){return this.high>>>0},D.getLowBits=function(){return this.low},D.getLowBitsUnsigned=function(){return this.low>>>0},D.getNumBitsAbs=function(){if(this.isNegative())return this.eq(nb)?64:this.neg().getNumBitsAbs();for(var r=this.high!=0?this.high:this.low,e=31;0<e&&!(r&1<<e);e--);return this.high!=0?e+33:e+1},D.isZero=function(){return this.high===0&&this.low===0},D.eqz=D.isZero,D.isNegative=function(){return!this.unsigned&&0>this.high},D.isPositive=function(){return this.unsigned||0<=this.high},D.isOdd=function(){return(1&this.low)==1},D.isEven=function(){return(1&this.low)==0},D.equals=function(r){return mb(r)||(r=Wb(r)),(this.unsigned===r.unsigned||this.high>>>31!=1||r.high>>>31!=1)&&this.high===r.high&&this.low===r.low},D.eq=D.equals,D.notEquals=function(r){return!this.eq(r)},D.neq=D.notEquals,D.ne=D.notEquals,D.lessThan=function(r){return 0>this.comp(r)},D.lt=D.lessThan,D.lessThanOrEqual=function(r){return 0>=this.comp(r)},D.lte=D.lessThanOrEqual,D.le=D.lessThanOrEqual,D.greaterThan=function(r){return 0<this.comp(r)},D.gt=D.greaterThan,D.greaterThanOrEqual=function(r){return 0<=this.comp(r)},D.gte=D.greaterThanOrEqual,D.ge=D.greaterThanOrEqual,D.compare=function(r){if(mb(r)||(r=Wb(r)),this.eq(r))return 0;var e=this.isNegative(),d=r.isNegative();return e&&!d?-1:!e&&d?1:this.unsigned?r.high>>>0>this.high>>>0||r.high===this.high&&r.low>>>0>this.low>>>0?-1:1:this.sub(r).isNegative()?-1:1},D.comp=D.compare,D.negate=function(){return!this.unsigned&&this.eq(nb)?nb:this.not().add(Ue)},D.neg=D.negate,D.add=function(r){mb(r)||(r=Wb(r));var e=this.high>>>16,d=65535&this.high,h=this.low>>>16,f=r.high>>>16,g=65535&r.high,C=r.low>>>16;return h=(C=((r=(65535&this.low)+(65535&r.low))>>>16)+(h+C))>>>16,ya((65535&C)<<16|65535&r,(e=((h+=d+g)>>>16)+(e+f)&65535)<<16|65535&h,this.unsigned)},D.subtract=function(r){return mb(r)||(r=Wb(r)),this.add(r.neg())},D.sub=D.subtract,D.multiply=function(r){if(this.isZero())return Hb;if(mb(r)||(r=Wb(r)),Qb){var e=Qb.mul(this.low,this.high,r.low,r.high);return ya(e,Qb.get_high(),this.unsigned)}if(r.isZero())return Hb;if(this.eq(nb))return r.isOdd()?nb:Hb;if(r.eq(nb))return this.isOdd()?nb:Hb;if(this.isNegative())return r.isNegative()?this.neg().mul(r.neg()):this.neg().mul(r).neg();if(r.isNegative())return this.mul(r.neg()).neg();if(this.lt(wq)&&r.lt(wq))return Gb(this.toNumber()*r.toNumber(),this.unsigned);e=this.high>>>16;var d=65535&this.high,h=this.low>>>16,f=65535&this.low,g=r.high>>>16,C=65535&r.high,P=r.low>>>16,x=f*(r=65535&r.low),B=(x>>>16)+h*r,Vt=B>>>16;Vt+=(B=(65535&B)+f*P)>>>16;var _r=(Vt+=d*r)>>>16;return ya((65535&B)<<16|65535&x,(_r=(_r+=(Vt=(65535&Vt)+h*P)>>>16)+((Vt=(65535&Vt)+f*C)>>>16)+(e*r+d*P+h*C+f*g)&65535)<<16|65535&Vt,this.unsigned)},D.mul=D.multiply,D.divide=function(r){if(mb(r)||(r=Wb(r)),r.isZero())throw Error("division by zero");if(Qb)return this.unsigned||this.high!==-2147483648||r.low!==-1||r.high!==-1?ya(r=(this.unsigned?Qb.div_u:Qb.div_s)(this.low,this.high,r.low,r.high),Qb.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Cd:Hb;if(this.unsigned){if(r.unsigned||(r=r.toUnsigned()),r.gt(this))return Cd;if(r.gt(this.shru(1)))return xq;var e=Cd}else{if(this.eq(nb)){if(r.eq(Ue)||r.eq(Kk))return nb;if(r.eq(nb))return Ue;var d=this.shr(1).div(r).shl(1);if(d.eq(Hb))return r.isNegative()?Ue:Kk;var h=this.sub(r.mul(d));return d.add(h.div(r))}if(r.eq(nb))return this.unsigned?Cd:Hb;if(this.isNegative())return r.isNegative()?this.neg().div(r.neg()):this.neg().div(r).neg();if(r.isNegative())return this.div(r.neg()).neg();e=Hb}for(h=this;h.gte(r);){d=Math.max(1,Math.floor(h.toNumber()/r.toNumber()));var f=Math.ceil(Math.log(d)/Math.LN2);f=48>=f?1:sg(2,f-48);for(var g=Gb(d),C=g.mul(r);C.isNegative()||C.gt(h);)C=(g=Gb(d-=f,this.unsigned)).mul(r);g.isZero()&&(g=Ue),e=e.add(g),h=h.sub(C)}return e},D.div=D.divide,D.modulo=function(r){return mb(r)||(r=Wb(r)),Qb?ya(r=(this.unsigned?Qb.rem_u:Qb.rem_s)(this.low,this.high,r.low,r.high),Qb.get_high(),this.unsigned):this.sub(this.div(r).mul(r))},D.mod=D.modulo,D.rem=D.modulo,D.not=function(){return ya(~this.low,~this.high,this.unsigned)},D.and=function(r){return mb(r)||(r=Wb(r)),ya(this.low&r.low,this.high&r.high,this.unsigned)},D.or=function(r){return mb(r)||(r=Wb(r)),ya(this.low|r.low,this.high|r.high,this.unsigned)},D.xor=function(r){return mb(r)||(r=Wb(r)),ya(this.low^r.low,this.high^r.high,this.unsigned)},D.shiftLeft=function(r){return mb(r)&&(r=r.toInt()),(r&=63)==0?this:32>r?ya(this.low<<r,this.high<<r|this.low>>>32-r,this.unsigned):ya(0,this.low<<r-32,this.unsigned)},D.shl=D.shiftLeft,D.shiftRight=function(r){return mb(r)&&(r=r.toInt()),(r&=63)==0?this:32>r?ya(this.low>>>r|this.high<<32-r,this.high>>r,this.unsigned):ya(this.high>>r-32,0<=this.high?0:-1,this.unsigned)},D.shr=D.shiftRight,D.shiftRightUnsigned=function(r){if(mb(r)&&(r=r.toInt()),(r&=63)===0)return this;var e=this.high;return 32>r?ya(this.low>>>r|e<<32-r,e>>>r,this.unsigned):ya(r===32?e:e>>>r-32,0,this.unsigned)},D.shru=D.shiftRightUnsigned,D.shr_u=D.shiftRightUnsigned,D.toSigned=function(){return this.unsigned?ya(this.low,this.high,!1):this},D.toUnsigned=function(){return this.unsigned?this:ya(this.low,this.high,!0)},D.toBytes=function(r){return r?this.toBytesLE():this.toBytesBE()},D.toBytesLE=function(){var r=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&r,r>>>8&255,r>>>16&255,r>>>24]},D.toBytesBE=function(){var r=this.high,e=this.low;return[r>>>24,r>>>16&255,r>>>8&255,255&r,e>>>24,e>>>16&255,e>>>8&255,255&e]},xa.fromBytes=function(r,e,d){return d?xa.fromBytesLE(r,e):xa.fromBytesBE(r,e)},xa.fromBytesLE=function(r,e){return new xa(r[0]|r[1]<<8|r[2]<<16|r[3]<<24,r[4]|r[5]<<8|r[6]<<16|r[7]<<24,e)},xa.fromBytesBE=function(r,e){return new xa(r[4]<<24|r[5]<<16|r[6]<<8|r[7],r[0]<<24|r[1]<<16|r[2]<<8|r[3],e)};var di=function(r,e){return(di=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,h){d.__proto__=h}||function(d,h){for(var f in h)h.hasOwnProperty(f)&&(d[f]=h[f])})(r,e)},Lk=!1,Ib={Promise:void 0,set useDeprecatedSynchronousErrorHandling(r){r?console.warn(`DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: 
`+Error().stack):Lk&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),Lk=r},get useDeprecatedSynchronousErrorHandling(){return Lk}},Eh={closed:!0,next:function(r){},error:function(r){if(Ib.useDeprecatedSynchronousErrorHandling)throw r;me(r)},complete:function(){}},Jb=Array.isArray||function(r){return r&&typeof r.length=="number"},lf=function(){function r(e){return Error.call(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(d,h){return h+1+") "+d.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e,this}return r.prototype=Object.create(Error.prototype),r}(),Oa=function(){function r(e){this.closed=!1,this._subscriptions=this._parentOrParents=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return r.prototype.unsubscribe=function(){if(!this.closed){var e=this._parentOrParents,d=this._ctorUnsubscribe,h=this._unsubscribe,f=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,e instanceof r)e.remove(this);else if(e!==null)for(var g=0;g<e.length;++g)e[g].remove(this);if(le(h)){d&&(this._unsubscribe=void 0);try{h.call(this)}catch(P){var C=P instanceof lf?Xl(P.errors):[P]}}if(Jb(f)){for(g=-1,e=f.length;++g<e;)if(ei(d=f[g]))try{d.unsubscribe()}catch(P){C=C||[],P instanceof lf?C=C.concat(Xl(P.errors)):C.push(P)}}if(C)throw new lf(C)}},r.prototype.add=function(e){var d=e;if(!e)return r.EMPTY;switch(X(e)){case"function":d=new r(e);case"object":if(d===this||d.closed||typeof d.unsubscribe!="function")return d;if(this.closed)return d.unsubscribe(),d;d instanceof r||(e=d,(d=new r)._subscriptions=[e]);break;default:throw Error("unrecognized teardown "+e+" added to Subscription.")}if((e=d._parentOrParents)===null)d._parentOrParents=this;else if(e instanceof r){if(e===this)return d;d._parentOrParents=[e,this]}else{if(e.indexOf(this)!==-1)return d;e.push(this)}return(e=this._subscriptions)===null?this._subscriptions=[d]:e.push(d),d},r.prototype.remove=function(e){var d=this._subscriptions;d&&(e=d.indexOf(e))!==-1&&d.splice(e,1)},r.EMPTY=function(e){return e.closed=!0,e}(new r),r}(),Fh=typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),ia=function(r){function e(d,h,f){var g=r.call(this)||this;switch(g.syncErrorValue=null,g.syncErrorThrown=!1,g.syncErrorThrowable=!1,g.isStopped=!1,arguments.length){case 0:g.destination=Eh;break;case 1:if(!d){g.destination=Eh;break}if(X(d)==="object"){d instanceof e?(g.syncErrorThrowable=d.syncErrorThrowable,g.destination=d,d.add(g)):(g.syncErrorThrowable=!0,g.destination=new yq(g,d));break}default:g.syncErrorThrowable=!0,g.destination=new yq(g,d,h,f)}return g}return O(e,r),e.prototype[Fh]=function(){return this},e.create=function(d,h,f){return(d=new e(d,h,f)).syncErrorThrowable=!1,d},e.prototype.next=function(d){this.isStopped||this._next(d)},e.prototype.error=function(d){this.isStopped||(this.isStopped=!0,this._error(d))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this))},e.prototype._next=function(d){this.destination.next(d)},e.prototype._error=function(d){this.destination.error(d),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var d=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=d,this},e}(Oa),yq=function(r){function e(d,h,f,g){var C=r.call(this)||this;if(C._parentSubscriber=d,d=C,le(h))var P=h;else h&&(P=h.next,f=h.error,g=h.complete,h!==Eh&&(le((d=Object.create(h)).unsubscribe)&&C.add(d.unsubscribe.bind(d)),d.unsubscribe=C.unsubscribe.bind(C)));return C._context=d,C._next=P,C._error=f,C._complete=g,C}return O(e,r),e.prototype.next=function(d){if(!this.isStopped&&this._next){var h=this._parentSubscriber;Ib.useDeprecatedSynchronousErrorHandling&&h.syncErrorThrowable?this.__tryOrSetError(h,this._next,d)&&this.unsubscribe():this.__tryOrUnsub(this._next,d)}},e.prototype.error=function(d){if(!this.isStopped){var h=this._parentSubscriber,f=Ib.useDeprecatedSynchronousErrorHandling;if(this._error)f&&h.syncErrorThrowable?this.__tryOrSetError(h,this._error,d):this.__tryOrUnsub(this._error,d),this.unsubscribe();else if(h.syncErrorThrowable)f?(h.syncErrorValue=d,h.syncErrorThrown=!0):me(d),this.unsubscribe();else{if(this.unsubscribe(),f)throw d;me(d)}}},e.prototype.complete=function(){var d=this;if(!this.isStopped){var h=this._parentSubscriber;if(this._complete){var f=function(){return d._complete.call(d._context)};Ib.useDeprecatedSynchronousErrorHandling&&h.syncErrorThrowable?this.__tryOrSetError(h,f):this.__tryOrUnsub(f)}this.unsubscribe()}},e.prototype.__tryOrUnsub=function(d,h){try{d.call(this._context,h)}catch(f){if(this.unsubscribe(),Ib.useDeprecatedSynchronousErrorHandling)throw f;me(f)}},e.prototype.__tryOrSetError=function(d,h,f){if(!Ib.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{h.call(this._context,f)}catch(g){return Ib.useDeprecatedSynchronousErrorHandling?(d.syncErrorValue=g,d.syncErrorThrown=!0):me(g),!0}return!1},e.prototype._unsubscribe=function(){var d=this._parentSubscriber;this._parentSubscriber=this._context=null,d.unsubscribe()},e}(ia),ne=typeof Symbol=="function"&&Symbol.observable||"@@observable",Y=function(){function r(e){this._isScalar=!1,e&&(this._subscribe=e)}return r.prototype.lift=function(e){var d=new r;return d.source=this,d.operator=e,d},r.prototype.subscribe=function(e,d,h){var f=this.operator;t:{if(e){if(e instanceof ia)break t;if(e[Fh]){e=e[Fh]();break t}}e=e||d||h?new ia(e,d,h):new ia(Eh)}if(f?e.add(f.call(e,this.source)):e.add(this.source||Ib.useDeprecatedSynchronousErrorHandling&&!e.syncErrorThrowable?this._subscribe(e):this._trySubscribe(e)),Ib.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable&&(e.syncErrorThrowable=!1,e.syncErrorThrown))throw e.syncErrorValue;return e},r.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(d){Ib.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=d),fi(e)?e.error(d):console.warn(d)}},r.prototype.forEach=function(e,d){var h=this;return new(d=Zl(d))(function(f,g){var C=h.subscribe(function(P){try{e(P)}catch(x){g(x),C&&C.unsubscribe()}},g,f)})},r.prototype._subscribe=function(e){var d=this.source;return d&&d.subscribe(e)},r.prototype[ne]=function(){return this},r.prototype.pipe=function(){for(var e=[],d=0;d<arguments.length;d++)e[d]=arguments[d];return e.length===0?this:Yl(e)(this)},r.prototype.toPromise=function(e){var d=this;return new(e=Zl(e))(function(h,f){var g;d.subscribe(function(C){return g=C},function(C){return f(C)},function(){return h(g)})})},r.create=function(e){return new r(e)},r}(),qd=function(){function r(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return r.prototype=Object.create(Error.prototype),r}(),zq=function(r){function e(d,h){var f=r.call(this)||this;return f.subject=d,f.subscriber=h,f.closed=!1,f}return O(e,r),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var d=this.subject,h=d.observers;this.subject=null,!h||h.length===0||d.isStopped||d.closed||(d=h.indexOf(this.subscriber))!==-1&&h.splice(d,1)}},e}(Oa),Aq=function(r){function e(d){var h=r.call(this,d)||this;return h.destination=d,h}return O(e,r),e}(ia),Pa=function(r){function e(){var d=r.call(this)||this;return d.observers=[],d.closed=!1,d.isStopped=!1,d.hasError=!1,d.thrownError=null,d}return O(e,r),e.prototype[Fh]=function(){return new Aq(this)},e.prototype.lift=function(d){var h=new Bq(this,this);return h.operator=d,h},e.prototype.next=function(d){if(this.closed)throw new qd;if(!this.isStopped){var h=this.observers,f=h.length;h=h.slice();for(var g=0;g<f;g++)h[g].next(d)}},e.prototype.error=function(d){if(this.closed)throw new qd;this.hasError=!0,this.thrownError=d,this.isStopped=!0;var h=this.observers,f=h.length;h=h.slice();for(var g=0;g<f;g++)h[g].error(d);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new qd;this.isStopped=!0;var d=this.observers,h=d.length;d=d.slice();for(var f=0;f<h;f++)d[f].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},e.prototype._trySubscribe=function(d){if(this.closed)throw new qd;return r.prototype._trySubscribe.call(this,d)},e.prototype._subscribe=function(d){if(this.closed)throw new qd;return this.hasError?(d.error(this.thrownError),Oa.EMPTY):this.isStopped?(d.complete(),Oa.EMPTY):(this.observers.push(d),new zq(this,d))},e.prototype.asObservable=function(){var d=new Y;return d.source=this,d},e.create=function(d,h){return new Bq(d,h)},e}(Y),Bq=function(r){function e(d,h){var f=r.call(this)||this;return f.destination=d,f.source=h,f}return O(e,r),e.prototype.next=function(d){var h=this.destination;h&&h.next&&h.next(d)},e.prototype.error=function(d){var h=this.destination;h&&h.error&&this.destination.error(d)},e.prototype.complete=function(){var d=this.destination;d&&d.complete&&this.destination.complete()},e.prototype._subscribe=function(d){return this.source?this.source.subscribe(d):Oa.EMPTY},e}(Pa),Ns=function(){function r(e){this.connectable=e}return r.prototype.call=function(e,d){var h=this.connectable;return h._refCount++,e=new cz(e,h),d=d.subscribe(e),e.closed||(e.connection=h.connect()),d},r}(),cz=function(r){function e(d,h){return(d=r.call(this,d)||this).connectable=h,d}return O(e,r),e.prototype._unsubscribe=function(){var d=this.connectable;if(d){this.connectable=null;var h=d._refCount;0>=h?this.connection=null:(d._refCount=h-1,1<h?this.connection=null:(h=this.connection,d=d._connection,this.connection=null,!d||h&&d!==h||d.unsubscribe()))}else this.connection=null},e}(ia),Cq=function(r){function e(d,h){var f=r.call(this)||this;return f.source=d,f.subjectFactory=h,f._refCount=0,f._isComplete=!1,f}return O(e,r),e.prototype._subscribe=function(d){return this.getSubject().subscribe(d)},e.prototype.getSubject=function(){var d=this._subject;return d&&!d.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var d=this._connection;return d||(this._isComplete=!1,(d=this._connection=new Oa).add(this.source.subscribe(new dz(this.getSubject(),this))),d.closed&&(this._connection=null,d=Oa.EMPTY)),d},e.prototype.refCount=function(){return $l()(this)},e}(Y),At=function(){var r=Cq.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:r._subscribe},_isComplete:{value:r._isComplete,writable:!0},getSubject:{value:r.getSubject},connect:{value:r.connect},refCount:{value:r.refCount}}}(),dz=function(r){function e(d,h){return(d=r.call(this,d)||this).connectable=h,d}return O(e,r),e.prototype._error=function(d){this._unsubscribe(),r.prototype._error.call(this,d)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),r.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var d=this.connectable;if(d){this.connectable=null;var h=d._connection;d._refCount=0,d._subject=null,d._connection=null,h&&h.unsubscribe()}},e}(Aq);(function(r){function e(d,h){return(d=r.call(this,d)||this).connectable=h,d}O(e,r),e.prototype._unsubscribe=function(){var d=this.connectable;if(d){this.connectable=null;var h=d._refCount;0>=h?this.connection=null:(d._refCount=h-1,1<h?this.connection=null:(h=this.connection,d=d._connection,this.connection=null,!d||h&&d!==h||d.unsubscribe()))}else this.connection=null}})(ia),function(r){function e(d,h,f,g,C){return(d=r.call(this,d)||this).keySelector=h,d.elementSelector=f,d.durationSelector=g,d.subjectSelector=C,d.groups=null,d.attemptedToUnsubscribe=!1,d.count=0,d}O(e,r),e.prototype._next=function(d){try{var h=this.keySelector(d)}catch(f){return void this.error(f)}this._group(d,h)},e.prototype._group=function(d,h){var f=this.groups;f||(f=this.groups=new Map);var g=f.get(h);if(this.elementSelector)try{var C=this.elementSelector(d)}catch(P){this.error(P)}else C=d;if(!g&&(g=this.subjectSelector?this.subjectSelector():new Pa,f.set(h,g),d=new Mk(h,g,this),this.destination.next(d),this.durationSelector)){d=void 0;try{d=this.durationSelector(new Mk(h,g))}catch(P){return void this.error(P)}this.add(d.subscribe(new ez(h,g,this)))}g.closed||g.next(C)},e.prototype._error=function(d){var h=this.groups;h&&(h.forEach(function(f,g){f.error(d)}),h.clear()),this.destination.error(d)},e.prototype._complete=function(){var d=this.groups;d&&(d.forEach(function(h,f){h.complete()}),d.clear()),this.destination.complete()},e.prototype.removeGroup=function(d){this.groups.delete(d)},e.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,this.count===0&&r.prototype.unsubscribe.call(this))}}(ia);var ez=function(r){function e(d,h,f){var g=r.call(this,h)||this;return g.key=d,g.group=h,g.parent=f,g}return O(e,r),e.prototype._next=function(d){this.complete()},e.prototype._unsubscribe=function(){var d=this.parent,h=this.key;this.key=this.parent=null,d&&d.removeGroup(h)},e}(ia),Mk=function(r){function e(d,h,f){var g=r.call(this)||this;return g.key=d,g.groupSubject=h,g.refCountSubscription=f,g}return O(e,r),e.prototype._subscribe=function(d){var h=new Oa,f=this.refCountSubscription,g=this.groupSubject;return f&&!f.closed&&h.add(new fz(f)),h.add(g.subscribe(d)),h},e}(Y),fz=function(r){function e(d){var h=r.call(this)||this;return h.parent=d,d.count++,h}return O(e,r),e.prototype.unsubscribe=function(){var d=this.parent;d.closed||this.closed||(r.prototype.unsubscribe.call(this),--d.count,d.count===0&&d.attemptedToUnsubscribe&&d.unsubscribe())},e}(Oa),gz=function(r){function e(d){var h=r.call(this)||this;return h._value=d,h}return O(e,r),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(d){var h=r.prototype._subscribe.call(this,d);return h&&!h.closed&&d.next(this._value),h},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new qd;return this._value},e.prototype.next=function(d){r.prototype.next.call(this,this._value=d)},e}(Pa),dg=function(r){function e(d,h){var f=r.call(this,d,h)||this;return f.scheduler=d,f.work=h,f.pending=!1,f}return O(e,r),e.prototype.schedule=function(d,h){if(h===void 0&&(h=0),this.closed)return this;this.state=d,d=this.id;var f=this.scheduler;return d!=null&&(this.id=this.recycleAsyncId(f,d,h)),this.pending=!0,this.delay=h,this.id=this.id||this.requestAsyncId(f,this.id,h),this},e.prototype.requestAsyncId=function(d,h,f){return f===void 0&&(f=0),setInterval(d.flush.bind(d,this),f)},e.prototype.recycleAsyncId=function(d,h,f){if(f===void 0&&(f=0),f!==null&&this.delay===f&&this.pending===!1)return h;clearInterval(h)},e.prototype.execute=function(d,h){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(d=this._execute(d,h))?d:void(this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},e.prototype._execute=function(d,h){h=!1;var f=void 0;try{this.work(d)}catch(g){h=!0,f=!!g&&g||Error(g)}if(h)return this.unsubscribe(),f},e.prototype._unsubscribe=function(){var d=this.id,h=this.scheduler,f=h.actions,g=f.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,g!==-1&&f.splice(g,1),d!=null&&(this.id=this.recycleAsyncId(h,d,null)),this.delay=null},e}(function(r){function e(d,h){return r.call(this)||this}return O(e,r),e.prototype.schedule=function(d,h){return this},e}(Oa)),hz=function(r){function e(d,h){var f=r.call(this,d,h)||this;return f.scheduler=d,f.work=h,f}return O(e,r),e.prototype.schedule=function(d,h){return h===void 0&&(h=0),0<h?r.prototype.schedule.call(this,d,h):(this.delay=h,this.state=d,this.scheduler.flush(this),this)},e.prototype.execute=function(d,h){return 0<h||this.closed?r.prototype.execute.call(this,d,h):this._execute(d,h)},e.prototype.requestAsyncId=function(d,h,f){return f===void 0&&(f=0),f!==null&&0<f||f===null&&0<this.delay?r.prototype.requestAsyncId.call(this,d,h,f):d.flush(this)},e}(dg),Nk=function(){function r(e,d){d===void 0&&(d=r.now),this.SchedulerAction=e,this.now=d}return r.prototype.schedule=function(e,d,h){return d===void 0&&(d=0),new this.SchedulerAction(this,e).schedule(h,d)},r.now=function(){return Date.now()},r}(),eg=function(r){function e(d,h){h===void 0&&(h=Nk.now);var f=r.call(this,d,function(){return e.delegate&&e.delegate!==f?e.delegate.now():h()})||this;return f.actions=[],f.active=!1,f.scheduled=void 0,f}return O(e,r),e.prototype.schedule=function(d,h,f){return h===void 0&&(h=0),e.delegate&&e.delegate!==this?e.delegate.schedule(d,h,f):r.prototype.schedule.call(this,d,h,f)},e.prototype.flush=function(d){var h=this.actions;if(this.active)h.push(d);else{var f;this.active=!0;do if(f=d.execute(d.state,d.delay))break;while(d=h.shift());if(this.active=!1,f){for(;d=h.shift();)d.unsubscribe();throw f}}},e}(Nk),fg=new(function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return O(e,r),e}(eg))(hz),vb=new Y(function(r){return r.complete()}),am=function(r){return function(e){for(var d=0,h=r.length;d<h&&!e.closed;d++)e.next(r[d]);e.complete()}},Ok;(function(r){r.NEXT="N",r.ERROR="E",r.COMPLETE="C"})(Ok||(Ok={}));var Ve=function(){function r(e,d,h){this.kind=e,this.value=d,this.error=h,this.hasValue=e==="N"}return r.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},r.prototype.do=function(e,d,h){switch(this.kind){case"N":return e&&e(this.value);case"E":return d&&d(this.error);case"C":return h&&h()}},r.prototype.accept=function(e,d,h){return e&&typeof e.next=="function"?this.observe(e):this.do(e,d,h)},r.prototype.toObservable=function(){switch(this.kind){case"N":return bb(this.value);case"E":return Z(this.error);case"C":return mf()}throw Error("unexpected notification kind value")},r.createNext=function(e){return e!==void 0?new r("N",e):r.undefinedValueNotification},r.createError=function(e){return new r("E",void 0,e)},r.createComplete=function(){return r.completeNotification},r.completeNotification=new r("C"),r.undefinedValueNotification=new r("N",void 0),r}(),Rs=function(){function r(e,d){d===void 0&&(d=0),this.scheduler=e,this.delay=d}return r.prototype.call=function(e,d){return d.subscribe(new Dq(e,this.scheduler,this.delay))},r}(),Dq=function(r){function e(d,h,f){return f===void 0&&(f=0),(d=r.call(this,d)||this).scheduler=h,d.delay=f,d}return O(e,r),e.dispatch=function(d){d.notification.observe(d.destination),this.unsubscribe()},e.prototype.scheduleMessage=function(d){this.destination.add(this.scheduler.schedule(e.dispatch,this.delay,new iz(d,this.destination)))},e.prototype._next=function(d){this.scheduleMessage(Ve.createNext(d))},e.prototype._error=function(d){this.scheduleMessage(Ve.createError(d)),this.unsubscribe()},e.prototype._complete=function(){this.scheduleMessage(Ve.createComplete()),this.unsubscribe()},e}(ia),iz=function(r,e){this.notification=r,this.destination=e},qe=function(r){function e(d,h,f){d===void 0&&(d=Number.POSITIVE_INFINITY),h===void 0&&(h=Number.POSITIVE_INFINITY);var g=r.call(this)||this;return g.scheduler=f,g._events=[],g._infiniteTimeWindow=!1,g._bufferSize=1>d?1:d,g._windowTime=1>h?1:h,h===Number.POSITIVE_INFINITY?(g._infiniteTimeWindow=!0,g.next=g.nextInfiniteTimeWindow):g.next=g.nextTimeWindow,g}return O(e,r),e.prototype.nextInfiniteTimeWindow=function(d){if(!this.isStopped){var h=this._events;h.push(d),h.length>this._bufferSize&&h.shift()}r.prototype.next.call(this,d)},e.prototype.nextTimeWindow=function(d){this.isStopped||(this._events.push(new jz(this._getNow(),d)),this._trimBufferThenGetEvents()),r.prototype.next.call(this,d)},e.prototype._subscribe=function(d){var h=this._infiniteTimeWindow,f=h?this._events:this._trimBufferThenGetEvents(),g=this.scheduler,C=f.length;if(this.closed)throw new qd;if(this.isStopped||this.hasError)var P=Oa.EMPTY;else this.observers.push(d),P=new zq(this,d);if(g&&d.add(d=new Dq(d,g)),h)for(h=0;h<C&&!d.closed;h++)d.next(f[h]);else for(h=0;h<C&&!d.closed;h++)d.next(f[h].value);return this.hasError?d.error(this.thrownError):this.isStopped&&d.complete(),P},e.prototype._getNow=function(){return(this.scheduler||fg).now()},e.prototype._trimBufferThenGetEvents=function(){for(var d=this._getNow(),h=this._bufferSize,f=this._windowTime,g=this._events,C=g.length,P=0;P<C&&!(d-g[P].time<f);)P++;return C>h&&(P=Math.max(P,C-h)),0<P&&g.splice(0,P),g},e}(Pa),jz=function(r,e){this.time=r,this.value=e},of=function(r){function e(){var d=r!==null&&r.apply(this,arguments)||this;return d.value=null,d.hasNext=!1,d.hasCompleted=!1,d}return O(e,r),e.prototype._subscribe=function(d){return this.hasError?(d.error(this.thrownError),Oa.EMPTY):this.hasCompleted&&this.hasNext?(d.next(this.value),d.complete(),Oa.EMPTY):r.prototype._subscribe.call(this,d)},e.prototype.next=function(d){this.hasCompleted||(this.value=d,this.hasNext=!0)},e.prototype.error=function(d){this.hasCompleted||r.prototype.error.call(this,d)},e.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&r.prototype.next.call(this,this.value),r.prototype.complete.call(this)},e}(Pa),kz=1,lz=Promise.resolve(),ii={},Eq={setImmediate:function(r){var e=kz++;return ii[e]=!0,lz.then(function(){return bm(e)&&r()}),e},clearImmediate:function(r){bm(r)}},mz=function(r){function e(d,h){var f=r.call(this,d,h)||this;return f.scheduler=d,f.work=h,f}return O(e,r),e.prototype.requestAsyncId=function(d,h,f){return f===void 0&&(f=0),f!==null&&0<f?r.prototype.requestAsyncId.call(this,d,h,f):(d.actions.push(this),d.scheduled||(d.scheduled=Eq.setImmediate(d.flush.bind(d,null))))},e.prototype.recycleAsyncId=function(d,h,f){if(f===void 0&&(f=0),f!==null&&0<f||f===null&&0<this.delay)return r.prototype.recycleAsyncId.call(this,d,h,f);d.actions.length===0&&(Eq.clearImmediate(h),d.scheduled=void 0)},e}(dg),ri=new(function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return O(e,r),e.prototype.flush=function(d){this.active=!0,this.scheduled=void 0;var h,f=this.actions,g=-1,C=f.length;d=d||f.shift();do if(h=d.execute(d.state,d.delay))break;while(++g<C&&(d=f.shift()));if(this.active=!1,h){for(;++g<C&&(d=f.shift());)d.unsubscribe();throw h}},e}(eg))(mz),nz=ri,Pk=new eg(dg),bd=Pk,oz=function(r){function e(d,h){var f=r.call(this,d,h)||this;return f.scheduler=d,f.work=h,f}return O(e,r),e.prototype.requestAsyncId=function(d,h,f){return f===void 0&&(f=0),f!==null&&0<f?r.prototype.requestAsyncId.call(this,d,h,f):(d.actions.push(this),d.scheduled||(d.scheduled=requestAnimationFrame(function(){return d.flush(null)})))},e.prototype.recycleAsyncId=function(d,h,f){if(f===void 0&&(f=0),f!==null&&0<f||f===null&&0<this.delay)return r.prototype.recycleAsyncId.call(this,d,h,f);d.actions.length===0&&(cancelAnimationFrame(h),d.scheduled=void 0)},e}(dg),Fq=new(function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return O(e,r),e.prototype.flush=function(d){this.active=!0,this.scheduled=void 0;var h,f=this.actions,g=-1,C=f.length;d=d||f.shift();do if(h=d.execute(d.state,d.delay))break;while(++g<C&&(d=f.shift()));if(this.active=!1,h){for(;++g<C&&(d=f.shift());)d.unsubscribe();throw h}},e}(eg))(oz),pz=function(r){function e(d,h){d===void 0&&(d=Gq),h===void 0&&(h=Number.POSITIVE_INFINITY);var f=r.call(this,d,function(){return f.frame})||this;return f.maxFrames=h,f.frame=0,f.index=-1,f}return O(e,r),e.prototype.flush=function(){for(var d,h,f=this.actions,g=this.maxFrames;(h=f[0])&&h.delay<=g&&(f.shift(),this.frame=h.delay,!(d=h.execute(h.state,h.delay))););if(d){for(;h=f.shift();)h.unsubscribe();throw d}},e.frameTimeFactor=10,e}(eg),Gq=function(r){function e(d,h,f){f===void 0&&(f=d.index+=1);var g=r.call(this,d,h)||this;return g.scheduler=d,g.work=h,g.index=f,g.active=!0,g.index=d.index=f,g}return O(e,r),e.prototype.schedule=function(d,h){if(h===void 0&&(h=0),!this.id)return r.prototype.schedule.call(this,d,h);this.active=!1;var f=new e(this.scheduler,this.work);return this.add(f),f.schedule(d,h)},e.prototype.requestAsyncId=function(d,h,f){return f===void 0&&(f=0),this.delay=d.frame+f,(d=d.actions).push(this),d.sort(e.sortActions),!0},e.prototype.recycleAsyncId=function(d,h,f){},e.prototype._execute=function(d,h){if(this.active===!0)return r.prototype._execute.call(this,d,h)},e.sortActions=function(d,h){return d.delay===h.delay?d.index===h.index?0:d.index>h.index?1:-1:d.delay>h.delay?1:-1},e}(dg),Qk=function(){function r(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return r.prototype=Object.create(Error.prototype),r}(),vg=function(){function r(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return r.prototype=Object.create(Error.prototype),r}(),pb=function(){function r(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return r.prototype=Object.create(Error.prototype),r}(),Ss=function(){function r(e,d){this.project=e,this.thisArg=d}return r.prototype.call=function(e,d){return d.subscribe(new qz(e,this.project,this.thisArg))},r}(),qz=function(r){function e(d,h,f){return(d=r.call(this,d)||this).project=h,d.count=0,d.thisArg=f||d,d}return O(e,r),e.prototype._next=function(d){try{var h=this.project.call(this.thisArg,d,this.count++)}catch(f){return void this.destination.error(f)}this.destination.next(h)},e}(ia),Rk=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return O(e,r),e.prototype.notifyNext=function(d,h,f,g,C){this.destination.next(h)},e.prototype.notifyError=function(d,h){this.destination.error(d)},e.prototype.notifyComplete=function(d){this.destination.complete()},e}(ia),Xs=function(r){function e(d,h,f){var g=r.call(this)||this;return g.parent=d,g.outerValue=h,g.outerIndex=f,g.index=0,g}return O(e,r),e.prototype._next=function(d){this.parent.notifyNext(this.outerValue,d,this.outerIndex,this.index++,this)},e.prototype._error=function(d){this.parent.notifyError(d,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(ia),rz=function(r){return function(e){return r.then(function(d){e.closed||(e.next(d),e.complete())},function(d){return e.error(d)}).then(null,me),e}},$c=typeof Symbol=="function"&&Symbol.iterator?Symbol.iterator:"@@iterator",sz=function(r){return function(e){for(var d=r[$c]();;){var h=void 0;try{h=d.next()}catch(f){return e.error(f),e}if(h.done){e.complete();break}if(e.next(h.value),e.closed)break}return typeof d.return=="function"&&e.add(function(){d.return&&d.return()}),e}},tz=function(r){return function(e){var d=r[ne]();if(typeof d.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return d.subscribe(e)}},hm=function(r){return r&&typeof r.length=="number"&&typeof r!="function"},pf=function(r){if(r&&typeof r[ne]=="function")return tz(r);if(hm(r))return am(r);if(fm(r))return rz(r);if(r&&typeof r[$c]=="function")return sz(r);throw r=ei(r)?"an invalid object":"'"+r+"'",new TypeError("You provided "+r+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},Hq={},vz=function(){function r(e){this.resultSelector=e}return r.prototype.call=function(e,d){return d.subscribe(new uz(e,this.resultSelector))},r}(),uz=function(r){function e(d,h){return(d=r.call(this,d)||this).resultSelector=h,d.active=0,d.values=[],d.observables=[],d}return O(e,r),e.prototype._next=function(d){this.values.push(Hq),this.observables.push(d)},e.prototype._complete=function(){var d=this.observables,h=d.length;if(h===0)this.destination.complete();else{this.toRespond=this.active=h;for(var f=0;f<h;f++)this.add(ji(this,d[f],void 0,f))}},e.prototype.notifyComplete=function(d){--this.active==0&&this.destination.complete()},e.prototype.notifyNext=function(d,h,f){var g=(d=this.values)[f];g=this.toRespond?g===Hq?--this.toRespond:this.toRespond:0,d[f]=h,g===0&&(this.resultSelector?this._tryResultSelector(d):this.destination.next(d.slice()))},e.prototype._tryResultSelector=function(d){try{var h=this.resultSelector.apply(this,d)}catch(f){return void this.destination.error(f)}this.destination.next(h)},e}(Rk),vc=function(r){function e(d){var h=r.call(this)||this;return h.parent=d,h}return O(e,r),e.prototype._next=function(d){this.parent.notifyNext(d)},e.prototype._error=function(d){this.parent.notifyError(d),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(ia);(function(r){function e(d,h,f){var g=r.call(this)||this;return g.parent=d,g.outerValue=h,g.outerIndex=f,g}O(e,r),e.prototype._next=function(d){this.parent.notifyNext(this.outerValue,d,this.outerIndex,this)},e.prototype._error=function(d){this.parent.notifyError(d),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}})(ia);var wc=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return O(e,r),e.prototype.notifyNext=function(d){this.destination.next(d)},e.prototype.notifyError=function(d){this.destination.error(d)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(ia);(function(r){function e(){return r!==null&&r.apply(this,arguments)||this}O(e,r),e.prototype.notifyNext=function(d,h,f,g){this.destination.next(h)},e.prototype.notifyError=function(d){this.destination.error(d)},e.prototype.notifyComplete=function(d){this.destination.complete()}})(ia);var at=function(){function r(e,d){d===void 0&&(d=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=d}return r.prototype.call=function(e,d){return d.subscribe(new wz(e,this.project,this.concurrent))},r}(),wz=function(r){function e(d,h,f){return f===void 0&&(f=Number.POSITIVE_INFINITY),(d=r.call(this,d)||this).project=h,d.concurrent=f,d.hasCompleted=!1,d.buffer=[],d.active=0,d.index=0,d}return O(e,r),e.prototype._next=function(d){this.active<this.concurrent?this._tryNext(d):this.buffer.push(d)},e.prototype._tryNext=function(d){var h=this.index++;try{var f=this.project(d,h)}catch(g){return void this.destination.error(g)}this.active++,this._innerSub(f)},e.prototype._innerSub=function(d){var h=new vc(this),f=this.destination;f.add(h),(d=ic(d,h))!==h&&f.add(d)},e.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(d){this.destination.next(d)},e.prototype.notifyComplete=function(){var d=this.buffer;this.active--,0<d.length?this._next(d.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},e}(wc),Sk=y.parseFloat,Iq=-1/0!=1/Sk(`	
\v\f\r Â áââââââââââââ¯âã\u2028\u2029\uFEFF-0`)?function(r){r=ik(String(r));var e=Sk(r);return e===0&&r.charAt(0)=="-"?-0:e}:Sk;N({global:!0,forced:parseFloat!=Iq},{parseFloat:Iq});var Tk=new Y(hc),ft=function(){function r(e,d){this.predicate=e,this.thisArg=d}return r.prototype.call=function(e,d){return d.subscribe(new xz(e,this.predicate,this.thisArg))},r}(),xz=function(r){function e(d,h,f){return(d=r.call(this,d)||this).predicate=h,d.thisArg=f,d.count=0,d}return O(e,r),e.prototype._next=function(d){try{var h=this.predicate.call(this.thisArg,d,this.count++)}catch(f){return void this.destination.error(f)}h&&this.destination.next(d)},e}(ia),gt=function(){function r(){}return r.prototype.call=function(e,d){return d.subscribe(new yz(e))},r}(),yz=function(r){function e(d){return(d=r.call(this,d)||this).hasFirst=!1,d.observables=[],d.subscriptions=[],d}return O(e,r),e.prototype._next=function(d){this.observables.push(d)},e.prototype._complete=function(){var d=this.observables,h=d.length;if(h===0)this.destination.complete();else{for(var f=0;f<h&&!this.hasFirst;f++){var g=ji(this,d[f],void 0,f);this.subscriptions&&this.subscriptions.push(g),this.add(g)}this.observables=null}},e.prototype.notifyNext=function(d,h,f){if(!this.hasFirst){for(this.hasFirst=!0,d=0;d<this.subscriptions.length;d++)if(d!==f){var g=this.subscriptions[d];g.unsubscribe(),this.remove(g)}this.subscriptions=null}this.destination.next(h)},e}(Rk),jt=function(){function r(e){this.resultSelector=e}return r.prototype.call=function(e,d){return d.subscribe(new zz(e,this.resultSelector))},r}(),zz=function(r){function e(d,h,f){return(d=r.call(this,d)||this).resultSelector=h,d.iterators=[],d.active=0,d.resultSelector=typeof h=="function"?h:void 0,d}return O(e,r),e.prototype._next=function(d){var h=this.iterators;Jb(d)?h.push(new Az(d)):typeof d[$c]=="function"?h.push(new Bz(d[$c]())):h.push(new Cz(this.destination,this,d))},e.prototype._complete=function(){var d=this.iterators,h=d.length;if(this.unsubscribe(),h===0)this.destination.complete();else{this.active=h;for(var f=0;f<h;f++){var g=d[f];g.stillUnsubscribed?this.destination.add(g.subscribe()):this.active--}}},e.prototype.notifyInactive=function(){this.active--,this.active===0&&this.destination.complete()},e.prototype.checkIterators=function(){for(var d=this.iterators,h=d.length,f=this.destination,g=0;g<h;g++){var C=d[g];if(typeof C.hasValue=="function"&&!C.hasValue())return}var P=!1,x=[];for(g=0;g<h;g++){var B=(C=d[g]).next();if(C.hasCompleted()&&(P=!0),B.done)return void f.complete();x.push(B.value)}this.resultSelector?this._tryresultSelector(x):f.next(x),P&&f.complete()},e.prototype._tryresultSelector=function(d){try{var h=this.resultSelector.apply(this,d)}catch(f){return void this.destination.error(f)}this.destination.next(h)},e}(ia),Bz=function(){function r(e){this.iterator=e,this.nextResult=e.next()}return r.prototype.hasValue=function(){return!0},r.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},r.prototype.hasCompleted=function(){var e=this.nextResult;return!(!e||!e.done)},r}(),Az=function(){function r(e){this.array=e,this.length=this.index=0,this.length=e.length}return r.prototype[$c]=function(){return this},r.prototype.next=function(e){e=this.index++;var d=this.array;return e<this.length?{value:d[e],done:!1}:{value:null,done:!0}},r.prototype.hasValue=function(){return this.array.length>this.index},r.prototype.hasCompleted=function(){return this.array.length===this.index},r}(),Cz=function(r){function e(d,h,f){return(d=r.call(this,d)||this).parent=h,d.observable=f,d.stillUnsubscribed=!0,d.buffer=[],d.isComplete=!1,d}return O(e,r),e.prototype[$c]=function(){return this},e.prototype.next=function(){var d=this.buffer;return d.length===0&&this.isComplete?{value:null,done:!0}:{value:d.shift(),done:!1}},e.prototype.hasValue=function(){return 0<this.buffer.length},e.prototype.hasCompleted=function(){return this.buffer.length===0&&this.isComplete},e.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},e.prototype.notifyNext=function(d){this.buffer.push(d),this.parent.checkIterators()},e.prototype.subscribe=function(){return ic(this.observable,new vc(this))},e}(wc),Dz=Object.freeze({__proto__:null,Observable:Y,ConnectableObservable:Cq,GroupedObservable:Mk,observable:ne,Subject:Pa,BehaviorSubject:gz,ReplaySubject:qe,AsyncSubject:of,asap:nz,asapScheduler:ri,async:bd,asyncScheduler:Pk,queue:fg,queueScheduler:fg,animationFrame:Fq,animationFrameScheduler:Fq,VirtualTimeScheduler:pz,VirtualAction:Gq,Scheduler:Nk,Subscription:Oa,Subscriber:ia,Notification:Ve,get NotificationKind(){return Ok},pipe:gi,noop:hc,identity:Yc,isObservable:function(r){return!!r&&(r instanceof Y||typeof r.lift=="function"&&typeof r.subscribe=="function")},ArgumentOutOfRangeError:Qk,EmptyError:vg,ObjectUnsubscribedError:qd,UnsubscriptionError:lf,TimeoutError:pb,bindCallback:cm,bindNodeCallback:dm,combineLatest:function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var d=e=void 0;return Zc(r[r.length-1])&&(d=r.pop()),typeof r[r.length-1]=="function"&&(e=r.pop()),r.length===1&&Jb(r[0])&&(r=r[0]),nf(r,d).lift(new vz(e))},concat:im,defer:ad,empty:mf,forkJoin:jm,from:Kb,fromEvent:gb,fromEventPattern:lm,generate:function(r,e,d,h,f){if(arguments.length==1){var g=r.initialState;e=r.condition,d=r.iterate;var C=r.resultSelector||Yc;f=r.scheduler}else h===void 0||Zc(h)?(g=r,C=Yc,f=h):(g=r,C=h);return new Y(function(P){var x=g;if(f)return f.schedule(bt,0,{subscriber:P,iterate:d,condition:e,resultSelector:C,state:x});for(;;){if(e){var B=void 0;try{B=e(x)}catch(Vt){P.error(Vt);break}if(!B){P.complete();break}}B=void 0;try{B=C(x)}catch(Vt){P.error(Vt);break}if(P.next(B),P.closed)break;try{x=d(x)}catch(Vt){P.error(Vt);break}}})},iif:function(r,e,d){return e===void 0&&(e=vb),d===void 0&&(d=vb),ad(function(){return r()?e:d})},interval:mm,merge:Xb,never:function(){return Tk},of:bb,onErrorResumeNext:li,pairs:function(r,e){return new Y(e?function(d){var h=Object.keys(r),f=new Oa;return f.add(e.schedule(dt,0,{keys:h,index:0,subscriber:d,subscription:f,obj:r})),f}:function(d){for(var h=Object.keys(r),f=0;f<h.length&&!d.closed;f++){var g=h[f];r.hasOwnProperty(g)&&d.next([g,r[g]])}d.complete()})},partition:function(r,e,d){return[wb(e,d)(new Y(pf(r))),wb(et(e,d))(new Y(pf(r)))]},race:Ca,range:function(r,e,d){return r===void 0&&(r=0),new Y(function(h){e===void 0&&(e=r,r=0);var f=0,g=r;if(d)return d.schedule(ht,0,{index:f,count:e,start:r,subscriber:h});for(;;){if(f++>=e){h.complete();break}if(h.next(g++),h.closed)break}})},throwError:Z,timer:Bc,using:function(r,e){return new Y(function(d){try{var h=r()}catch(C){return void d.error(C)}try{var f=e(h)}catch(C){return void d.error(C)}var g=(f?Kb(f):vb).subscribe(d);return function(){g.unsubscribe(),h&&h.unsubscribe()}})},zip:mi,scheduled:gm,EMPTY:vb,NEVER:Tk,config:Ib}),kt=function(){function r(e){this.selector=e}return r.prototype.call=function(e,d){return d.subscribe(new Ez(e,this.selector,this.caught))},r}(),Ez=function(r){function e(d,h,f){return(d=r.call(this,d)||this).selector=h,d.caught=f,d}return O(e,r),e.prototype.error=function(d){if(!this.isStopped){var h=void 0;try{h=this.selector(d,this.caught)}catch(f){return void r.prototype.error.call(this,f)}this._unsubscribeAndRecycle(),d=new vc(this),this.add(d),(h=ic(h,d))!==d&&this.add(h)}},e}(wc),lt=function(){function r(e){this.defaultValue=e}return r.prototype.call=function(e,d){return d.subscribe(new Fz(e,this.defaultValue))},r}(),Fz=function(r){function e(d,h){return(d=r.call(this,d)||this).defaultValue=h,d.isEmpty=!0,d}return O(e,r),e.prototype._next=function(d){this.isEmpty=!1,this.destination.next(d)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}(ia),mt=function(){function r(e,d){this.delay=e,this.scheduler=d}return r.prototype.call=function(e,d){return d.subscribe(new Gz(e,this.delay,this.scheduler))},r}(),Gz=function(r){function e(d,h,f){return(d=r.call(this,d)||this).delay=h,d.scheduler=f,d.queue=[],d.active=!1,d.errored=!1,d}return O(e,r),e.dispatch=function(d){for(var h=d.source,f=h.queue,g=d.scheduler,C=d.destination;0<f.length&&0>=f[0].time-g.now();)f.shift().notification.observe(C);0<f.length?(h=Math.max(0,f[0].time-g.now()),this.schedule(d,h)):(this.unsubscribe(),h.active=!1)},e.prototype._schedule=function(d){this.active=!0,this.destination.add(d.schedule(e.dispatch,this.delay,{source:this,destination:this.destination,scheduler:d}))},e.prototype.scheduleNotification=function(d){if(this.errored!==!0){var h=this.scheduler;d=new Hz(h.now()+this.delay,d),this.queue.push(d),this.active===!1&&this._schedule(h)}},e.prototype._next=function(d){this.scheduleNotification(Ve.createNext(d))},e.prototype._error=function(d){this.errored=!0,this.queue=[],this.destination.error(d),this.unsubscribe()},e.prototype._complete=function(){this.scheduleNotification(Ve.createComplete()),this.unsubscribe()},e}(ia),Hz=function(r,e){this.time=r,this.notification=e},nt=function(){function r(e,d){this.keySelector=e,this.flushes=d}return r.prototype.call=function(e,d){return d.subscribe(new Iz(e,this.keySelector,this.flushes))},r}(),Iz=function(r){function e(d,h,f){return(d=r.call(this,d)||this).keySelector=h,d.values=new Set,f&&d.add(ic(f,new vc(d))),d}return O(e,r),e.prototype.notifyNext=function(){this.values.clear()},e.prototype.notifyError=function(d){this._error(d)},e.prototype._next=function(d){this.keySelector?this._useKeySelector(d):this._finalizeNext(d,d)},e.prototype._useKeySelector=function(d){var h=this.destination;try{var f=this.keySelector(d)}catch(g){return void h.error(g)}this._finalizeNext(f,d)},e.prototype._finalizeNext=function(d,h){var f=this.values;f.has(d)||(f.add(d),this.destination.next(h))},e}(wc),pt=function(){function r(e){this.errorFactory=e}return r.prototype.call=function(e,d){return d.subscribe(new Jz(e,this.errorFactory))},r}(),Jz=function(r){function e(d,h){return(d=r.call(this,d)||this).errorFactory=h,d.hasValue=!1,d}return O(e,r),e.prototype._next=function(d){this.hasValue=!0,this.destination.next(d)},e.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var d=void 0;try{d=this.errorFactory()}catch(h){d=h}this.destination.error(d)},e}(ia),qt=function(){function r(e){if(this.total=e,0>this.total)throw new Qk}return r.prototype.call=function(e,d){return d.subscribe(new Kz(e,this.total))},r}(),Kz=function(r){function e(d,h){return(d=r.call(this,d)||this).total=h,d.count=0,d}return O(e,r),e.prototype._next=function(d){var h=this.total,f=++this.count;f<=h&&(this.destination.next(d),f===h&&(this.destination.complete(),this.unsubscribe()))},e}(ia),rt=function(){function r(e){this.project=e}return r.prototype.call=function(e,d){return d.subscribe(new Lz(e,this.project))},r}(),Lz=function(r){function e(d,h){return(d=r.call(this,d)||this).project=h,d.hasSubscription=!1,d.hasCompleted=!1,d.index=0,d}return O(e,r),e.prototype._next=function(d){this.hasSubscription||this.tryNext(d)},e.prototype.tryNext=function(d){var h=this.index++;try{var f=this.project(d,h)}catch(g){return void this.destination.error(g)}this.hasSubscription=!0,this._innerSub(f)},e.prototype._innerSub=function(d){var h=new vc(this),f=this.destination;f.add(h),(d=ic(d,h))!==h&&f.add(d)},e.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(d){this.destination.next(d)},e.prototype.notifyError=function(d){this.destination.error(d)},e.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},e}(wc),st=function(){function r(e){this.callback=e}return r.prototype.call=function(e,d){return d.subscribe(new Mz(e,this.callback))},r}(),Mz=function(r){function e(d,h){return(d=r.call(this,d)||this).add(new Oa(h)),d}return O(e,r),e}(ia),ut=function(){function r(){}return r.prototype.call=function(e,d){return d.subscribe(new Nz(e))},r}(),Nz=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return O(e,r),e.prototype._next=function(d){},e}(ia),vt=function(){function r(e){if(this.total=e,0>this.total)throw new Qk}return r.prototype.call=function(e,d){return d.subscribe(new Oz(e,this.total))},r}(),Oz=function(r){function e(d,h){return(d=r.call(this,d)||this).total=h,d.ring=[],d.count=0,d}return O(e,r),e.prototype._next=function(d){var h=this.ring,f=this.total,g=this.count++;h.length<f?h.push(d):h[g%f]=d},e.prototype._complete=function(){var d=this.destination,h=this.count;if(0<h)for(var f=this.count>=this.total?this.total:this.count,g=this.ring,C=0;C<f;C++){var P=h++%f;d.next(g[P])}d.complete()},e}(ia),wt=function(){function r(e){this.value=e}return r.prototype.call=function(e,d){return d.subscribe(new Pz(e,this.value))},r}(),Pz=function(r){function e(d,h){return(d=r.call(this,d)||this).value=h,d}return O(e,r),e.prototype._next=function(d){this.destination.next(this.value)},e}(ia),xt=function(){function r(e,d,h){h===void 0&&(h=!1),this.accumulator=e,this.seed=d,this.hasSeed=h}return r.prototype.call=function(e,d){return d.subscribe(new Qz(e,this.accumulator,this.seed,this.hasSeed))},r}(),Qz=function(r){function e(d,h,f,g){return(d=r.call(this,d)||this).accumulator=h,d._seed=f,d.hasSeed=g,d.index=0,d}return O(e,r),Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(d){this.hasSeed=!0,this._seed=d},enumerable:!0,configurable:!0}),e.prototype._next=function(d){if(this.hasSeed)return this._tryNext(d);this.seed=d,this.destination.next(d)},e.prototype._tryNext=function(d){var h=this.index++;try{var f=this.accumulator(this.seed,d,h)}catch(g){this.destination.error(g)}this.seed=f,this.destination.next(f)},e}(ia),zt=function(){function r(e,d){this.subjectFactory=e,this.selector=d}return r.prototype.call=function(e,d){var h=this.selector,f=this.subjectFactory();return(e=h(f).subscribe(e)).add(d.subscribe(f)),e},r}(),Bt=function(){function r(e,d){this.notifier=e,this.source=d}return r.prototype.call=function(e,d){return d.subscribe(new Rz(e,this.notifier,this.source))},r}(),Rz=function(r){function e(d,h,f){return(d=r.call(this,d)||this).notifier=h,d.source=f,d}return O(e,r),e.prototype.error=function(d){if(!this.isStopped){var h=this.errors,f=this.retries,g=this.retriesSubscription;if(f)this.retriesSubscription=this.errors=void 0;else{h=new Pa;try{f=(0,this.notifier)(h)}catch(C){return r.prototype.error.call(this,C)}g=ic(f,new vc(this))}this._unsubscribeAndRecycle(),this.errors=h,this.retries=f,this.retriesSubscription=g,h.next(d)}},e.prototype._unsubscribe=function(){var d=this.errors,h=this.retriesSubscription;d&&(d.unsubscribe(),this.errors=void 0),h&&(h.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},e.prototype.notifyNext=function(){var d=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=d,this.source.subscribe(this)},e}(wc),Et=function(){function r(e){this.project=e}return r.prototype.call=function(e,d){return d.subscribe(new Sz(e,this.project))},r}(),Sz=function(r){function e(d,h){return(d=r.call(this,d)||this).project=h,d.index=0,d}return O(e,r),e.prototype._next=function(d){var h=this.index++;try{var f=this.project(d,h)}catch(g){return void this.destination.error(g)}this._innerSub(f)},e.prototype._innerSub=function(d){var h=this.innerSubscription;h&&h.unsubscribe(),h=new vc(this);var f=this.destination;f.add(h),this.innerSubscription=ic(d,h),this.innerSubscription!==h&&f.add(this.innerSubscription)},e.prototype._complete=function(){var d=this.innerSubscription;d&&!d.closed||r.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=void 0},e.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&r.prototype._complete.call(this)},e.prototype.notifyNext=function(d){this.destination.next(d)},e}(wc),Ft=function(){function r(e){this.notifier=e}return r.prototype.call=function(e,d){e=new Tz(e);var h=ic(this.notifier,new vc(e));return h&&!e.seenValue?(e.add(h),d.subscribe(e)):e},r}(),Tz=function(r){function e(d){return(d=r.call(this,d)||this).seenValue=!1,d}return O(e,r),e.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},e.prototype.notifyComplete=function(){},e}(wc),Ht=function(){function r(e,d){this.predicate=e,this.inclusive=d}return r.prototype.call=function(e,d){return d.subscribe(new Uz(e,this.predicate,this.inclusive))},r}(),Uz=function(r){function e(d,h,f){return(d=r.call(this,d)||this).predicate=h,d.inclusive=f,d.index=0,d}return O(e,r),e.prototype._next=function(d){var h=this.destination;try{var f=this.predicate(d,this.index++)}catch(g){return void h.error(g)}this.nextOrComplete(d,f)},e.prototype.nextOrComplete=function(d,h){var f=this.destination;h?f.next(d):(this.inclusive&&f.next(d),f.complete())},e}(ia),It=function(){function r(e,d,h){this.nextOrObserver=e,this.error=d,this.complete=h}return r.prototype.call=function(e,d){return d.subscribe(new Vz(e,this.nextOrObserver,this.error,this.complete))},r}(),Vz=function(r){function e(d,h,f,g){return(d=r.call(this,d)||this)._tapNext=hc,d._tapError=hc,d._tapComplete=hc,d._tapError=f||hc,d._tapComplete=g||hc,le(h)?(d._context=d,d._tapNext=h):h&&(d._context=h,d._tapNext=h.next||hc,d._tapError=h.error||hc,d._tapComplete=h.complete||hc),d}return O(e,r),e.prototype._next=function(d){try{this._tapNext.call(this._context,d)}catch(h){return void this.destination.error(h)}this.destination.next(d)},e.prototype._error=function(d){try{this._tapError.call(this._context,d)}catch(h){return void this.destination.error(h)}this.destination.error(d)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(d){return void this.destination.error(d)}return this.destination.complete()},e}(ia),Kt={leading:!0,trailing:!1};(function(r){function e(d,h,f,g){var C=r.call(this,d)||this;return C.destination=d,C.durationSelector=h,C._leading=f,C._trailing=g,C._hasValue=!1,C}O(e,r),e.prototype._next=function(d){this._hasValue=!0,this._sendValue=d,this._throttled||(this._leading?this.send():this.throttle(d))},e.prototype.send=function(){var d=this._sendValue;this._hasValue&&(this.destination.next(d),this.throttle(d)),this._hasValue=!1,this._sendValue=void 0},e.prototype.throttle=function(d){(d=this.tryDurationSelector(d))&&this.add(this._throttled=ic(d,new vc(this)))},e.prototype.tryDurationSelector=function(d){try{return this.durationSelector(d)}catch(h){return this.destination.error(h),null}},e.prototype.throttlingDone=function(){var d=this._throttled,h=this._trailing;d&&d.unsubscribe(),this._throttled=void 0,h&&this.send()},e.prototype.notifyNext=function(){this.throttlingDone()},e.prototype.notifyComplete=function(){this.throttlingDone()}})(wc);for(var Lt=function(){function r(e,d,h,f){this.duration=e,this.scheduler=d,this.leading=h,this.trailing=f}return r.prototype.call=function(e,d){return d.subscribe(new Wz(e,this.duration,this.scheduler,this.leading,this.trailing))},r}(),Wz=function(r){function e(d,h,f,g,C){return(d=r.call(this,d)||this).duration=h,d.scheduler=f,d.leading=g,d.trailing=C,d._hasTrailingValue=!1,d._trailingValue=null,d}return O(e,r),e.prototype._next=function(d){this.throttled?this.trailing&&(this._trailingValue=d,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Mt,this.duration,{subscriber:this})),this.leading?this.destination.next(d):this.trailing&&(this._trailingValue=d,this._hasTrailingValue=!0))},e.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},e.prototype.clearThrottle=function(){var d=this.throttled;d&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),d.unsubscribe(),this.remove(d),this.throttled=null)},e}(ia),Ot=function(){function r(e,d,h,f){this.waitFor=e,this.absoluteTimeout=d,this.withObservable=h,this.scheduler=f}return r.prototype.call=function(e,d){return d.subscribe(new Xz(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},r}(),Xz=function(r){function e(d,h,f,g,C){return(d=r.call(this,d)||this).absoluteTimeout=h,d.waitFor=f,d.withObservable=g,d.scheduler=C,d.scheduleTimeout(),d}return O(e,r),e.dispatchTimeout=function(d){var h=d.withObservable;d._unsubscribeAndRecycle(),d.add(ic(h,new vc(d)))},e.prototype.scheduleTimeout=function(){var d=this.action;d?this.action=d.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(e.dispatchTimeout,this.waitFor,this))},e.prototype._next=function(d){this.absoluteTimeout||this.scheduleTimeout(),r.prototype._next.call(this,d)},e.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},e}(wc),Qt=function(){function r(e,d){this.observables=e,this.project=d}return r.prototype.call=function(e,d){return d.subscribe(new Yz(e,this.observables,this.project))},r}(),Yz=function(r){function e(d,h,f){(d=r.call(this,d)||this).observables=h,d.project=f,d.toRespond=[],f=h.length,d.values=Array(f);for(var g=0;g<f;g++)d.toRespond.push(g);for(g=0;g<f;g++)d.add(ji(d,h[g],void 0,g));return d}return O(e,r),e.prototype.notifyNext=function(d,h,f){this.values[f]=h,0<(d=this.toRespond).length&&(f=d.indexOf(f))!==-1&&d.splice(f,1)},e.prototype.notifyComplete=function(){},e.prototype._next=function(d){this.toRespond.length===0&&(d=[d].concat(this.values),this.project?this._tryProject(d):this.destination.next(d))},e.prototype._tryProject=function(d){try{var h=this.project.apply(this,d)}catch(f){return void this.destination.error(f)}this.destination.next(h)},e}(Rk),Jq=$a(function(r){var e=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(e){var d=new Uint8Array(16);r.exports=function(){return e(d),d}}else{var h=Array(16);r.exports=function(){for(var f,g=0;16>g;g++)!(3&g)&&(f=4294967296*Math.random()),h[g]=f>>>((3&g)<<3)&255;return h}}}),ab=[],Gh=0;256>Gh;++Gh)ab[Gh]=(Gh+256).toString(16).substr(1);var Kq=function(r,e){return e=e||0,[ab[r[e++]],ab[r[e++]],ab[r[e++]],ab[r[e++]],"-",ab[r[e++]],ab[r[e++]],"-",ab[r[e++]],ab[r[e++]],"-",ab[r[e++]],ab[r[e++]],"-",ab[r[e++]],ab[r[e++]],ab[r[e++]],ab[r[e++]],ab[r[e++]],ab[r[e++]]].join("")},Ud=function(r,e,d){if(d=e&&d||0,typeof r=="string"&&(e=r==="binary"?Array(16):null,r=null),(r=(r=r||{}).random||(r.rng||Jq)())[6]=15&r[6]|64,r[8]=63&r[8]|128,e)for(var h=0;16>h;++h)e[d+h]=r[h];return e||Kq(r)},gg=Ud(),Uk=!1,Pc,rd,Vk,Wk,sd,Vd,ec,We,Rb,Xk,Qc,Wd,Rc,Sc,Tc,Xe,Uc,Vc;(function(r){r[r.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",r[r.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",r[r.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",r[r.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",r[r.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",r[r.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",r[r.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"})(Pc||(Pc={})),function(r){r[r.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",r[r.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",r[r.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",r[r.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",r[r.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",r[r.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(rd||(rd={})),function(r){r[r.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(Vk||(Vk={})),function(r){r[r.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Wk||(Wk={})),function(r){r[r.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",r[r.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",r[r.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",r[r.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",r[r.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",r[r.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(sd||(sd={})),function(r){r[r.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",r[r.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",r[r.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",r[r.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",r[r.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(Vd||(Vd={})),function(r){r[r.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",r[r.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",r[r.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",r[r.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",r[r.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",r[r.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",r[r.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",r[r.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",r[r.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",r[r.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",r[r.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(ec||(ec={})),function(r){r[r.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",r[r.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",r[r.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",r[r.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(We||(We={})),function(r){r[r.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",r[r.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",r[r.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",r[r.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",r[r.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",r[r.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",r[r.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",r[r.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",r[r.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",r[r.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",r[r.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(Rb||(Rb={})),function(r){r[r.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Xk||(Xk={})),function(r){r[r.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",r[r.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",r[r.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",r[r.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",r[r.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",r[r.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",r[r.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Qc||(Qc={})),function(r){r[r.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",r[r.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",r[r.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",r[r.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",r[r.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(Wd||(Wd={})),function(r){r[r.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",r[r.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",r[r.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",r[r.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",r[r.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",r[r.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",r[r.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",r[r.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(Rc||(Rc={})),function(r){r[r.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",r[r.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",r[r.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",r[r.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",r[r.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",r[r.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",r[r.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(Sc||(Sc={})),function(r){r[r.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",r[r.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",r[r.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",r[r.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",r[r.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",r[r.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",r[r.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(Tc||(Tc={})),function(r){r[r.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",r[r.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",r[r.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",r[r.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(Xe||(Xe={})),function(r){r[r.UPLOAD_MEDIA_ERR_FAILURE=1]="UPLOAD_MEDIA_ERR_FAILURE",r[r.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="UPLOAD_MEDIA_ERR_INVALID_ARGUMENT",r[r.UPLOAD_MEDIA_ERR_TIMEOUT=3]="UPLOAD_MEDIA_ERR_TIMEOUT",r[r.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW=4]="UPLOAD_MEDIA_ERR_SIZE_OVERFLOW",r[r.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",r[r.UPLOAD_MEDIA_ERR_INTERRUPTED=6]="UPLOAD_MEDIA_ERR_INTERRUPTED",r[r.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="UPLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Uc||(Uc={})),function(r){r[r.DOWNLOAD_MEDIA_ERR_FAILURE=1]="DOWNLOAD_MEDIA_ERR_FAILURE",r[r.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT",r[r.DOWNLOAD_MEDIA_ERR_TIMEOUT=3]="DOWNLOAD_MEDIA_ERR_TIMEOUT",r[r.DOWNLOAD_MEDIA_ERR_NOT_EXIST=4]="DOWNLOAD_MEDIA_ERR_NOT_EXIST",r[r.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",r[r.DOWNLOAD_MEDIA_ERR_INTERRUPTED=6]="DOWNLOAD_MEDIA_ERR_INTERRUPTED",r[r.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Vc||(Vc={}));var Sb=Pc.ATTRIBUTE_OPERATION_ERR_FAILURE,Ja=Pc.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,se=Pc.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;Pc.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var Lq=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,Tb=Pc.ATTRIBUTE_OPERATION_ERR_TIMEOUT,Ub=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,hg=rd.CHANNEL_MESSAGE_ERR_FAILURE,Yk=rd.CHANNEL_MESSAGE_ERR_TIMEOUT,Mq=rd.CHANNEL_MESSAGE_ERR_TOO_OFTEN,Hh=rd.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE;rd.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL;var ig=rd.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,Zz=Vk.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,Nq=Wk.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var Oq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var Pq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,$z=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var aA=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,bA=sd.GET_MEMBERS_ERR_FAILURE,cA=sd.GET_MEMBERS_ERR_REJECTED;sd.GET_MEMBERS_ERR_TIMEOUT,sd.GET_MEMBERS_ERR_TOO_OFTEN;var dA=sd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,eA=sd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,xc=Vd.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,fA=Vd.INVITATION_API_CALL_ERR_NOT_STARTED,Ih=Vd.INVITATION_API_CALL_ERR_ALREADY_END,Qq=Vd.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,gA=Vd.INVITATION_API_CALL_ERR_ALREADY_SENT,Rq=ec.JOIN_CHANNEL_ERR_FAILURE;ec.JOIN_CHANNEL_ERR_REJECTED;var hA=ec.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,Sq=ec.JOIN_CHANNEL_TIMEOUT,Tq=ec.JOIN_CHANNEL_ERR_EXCEED_LIMIT,Uq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED;ec.JOIN_CHANNEL_ERR_TOO_OFTEN;var Vq=ec.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Wq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Xq=We.LEAVE_CHANNEL_ERR_FAILURE,Yq=We.LEAVE_CHANNEL_ERR_REJECTED,iA=We.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,jA=We.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,Zq=Rb.LOGIN_ERR_UNKNOWN,jg=Rb.LOGIN_ERR_REJECTED,Jh=Rb.LOGIN_ERR_INVALID_ARGUMENT,$q=Rb.LOGIN_ERR_INVALID_APP_ID,ar=Rb.LOGIN_ERR_INVALID_TOKEN,Kh=Rb.LOGIN_ERR_TOKEN_EXPIRED;Rb.LOGIN_ERR_NOT_AUTHORIZED;var kA=Rb.LOGIN_ERR_ALREADY_LOGIN,lA=Rb.LOGIN_ERR_TIMEOUT,mA=Rb.LOGIN_ERR_TOO_OFTEN,br=Xk.LOGOUT_ERR_USER_NOT_LOGGED_IN,cr=Qc.PEER_MESSAGE_ERR_FAILURE,Zk=Qc.PEER_MESSAGE_ERR_TIMEOUT,dr=Qc.PEER_MESSAGE_ERR_TOO_OFTEN,$k=Qc.PEER_MESSAGE_ERR_INVALID_USERID,ve=Qc.PEER_MESSAGE_ERR_INVALID_MESSAGE,al=Qc.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,nA=Qc.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE,er=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var oA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var pA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,qA=Rc.RENEW_TOKEN_ERR_FAILURE,rA=Rc.RENEW_TOKEN_ERR_INVALID_ARGUMENT;Rc.RENEW_TOKEN_ERR_REJECTED,Rc.RENEW_TOKEN_ERR_TOO_OFTEN;var sA=Rc.RENEW_TOKEN_ERR_TOKEN_EXPIRED,tA=Rc.RENEW_TOKEN_ERR_INVALID_TOKEN,uA=Rc.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,fr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,kg=Tc.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var vA=Tc.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var gr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,bl=Tc.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var lg=Uc.UPLOAD_MEDIA_ERR_FAILURE,wf=Uc.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT,Lh=Uc.UPLOAD_MEDIA_ERR_TIMEOUT,wA=Uc.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW,xA=Uc.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,hr=Uc.UPLOAD_MEDIA_ERR_INTERRUPTED,yA=Uc.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN,mg=Vc.DOWNLOAD_MEDIA_ERR_FAILURE,cl=Vc.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT,zA=Vc.DOWNLOAD_MEDIA_ERR_TIMEOUT,AA=Vc.DOWNLOAD_MEDIA_ERR_NOT_EXIST,BA=Vc.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,ir=Vc.DOWNLOAD_MEDIA_ERR_INTERRUPTED,CA=Vc.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN,DA=function(r,e){var d;return Hk(r,function(h,f,g){return!(d=e(h,f,g))}),!!d},Mh=function(r,e,d){if(!lb(d))return!1;var h=X(e);return!!(h=="number"?Ed(d)&&wk(e,d.length):h=="string"&&e in d)&&$f(d[e],r)},dl=function(r,e,d){var h=Va(r)?tq:DA;return d&&Mh(r,e,d)&&(e=void 0),h(r,Te(e))},EA=function(r,e){var d=-1,h=Ed(r)?Array(r.length):[];return Hk(r,function(f,g,C){h[++d]=e(f,g,C)}),h},FA=function(r,e){var d=r.length;for(r.sort(e);d--;)r[d]=r[d].value;return r},GA=function(r,e,d){e=e.length?he(e,function(f){return Va(f)?function(g){return Ch(g,f.length===1?f[0]:f)}:f}):[Dh];var h=-1;return e=he(e,zh(Te)),r=EA(r,function(f,g,C){return{criteria:he(e,function(P){return P(f)}),index:++h,value:f}}),FA(r,function(f,g){t:{for(var C=-1,P=f.criteria,x=g.criteria,B=P.length,Vt=d.length;++C<B;){e:{var _r=P[C],_e=x[C];if(_r!==_e){var _i=_r!==void 0,_a=_r===null,kc=_r==_r,_d=ie(_r),_l=_e!==void 0,_h=_e===null,rE=_e==_e,aE=ie(_e);if(!_h&&!aE&&!_d&&_r>_e||_d&&_l&&rE&&!_h&&!aE||_a&&_l&&rE||!_i&&rE||!kc){_r=1;break e}if(!_a&&!_d&&!aE&&_r<_e||aE&&_i&&kc&&!_a&&!_d||_h&&_i&&kc||!_l&&kc||!rE){_r=-1;break e}}_r=0}if(_r){f=C>=Vt?_r:_r*(d[C]=="desc"?-1:1);break t}}f=f.index-g.index}return f})},jr=function(r,e){return rq(qq(r,e,Dh),r+"")},kr=jr(function(r,e){if(r==null)return[];var d=e.length;return 1<d&&Mh(r,e[0],e[1])?e=[]:2<d&&Mh(e[0],e[1],e[2])&&(e=[e[0]]),GA(r,$h(e,1),[])}),lr=function(r){if(r.__esModule)return r;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(r).forEach(function(d){var h=Object.getOwnPropertyDescriptor(r,d);Object.defineProperty(e,d,h.get?h:{enumerable:!0,get:function(){return r[d]}})}),e}(Dz),mr=$a(function(r,e){Object.defineProperty(e,"__esModule",{value:!0});var d=[],h=function(f,g){return new WebSocket(f,g)};e.normalClosureMessage="Normal closure",e.default=function(f,g){var C=(g=g===void 0?{protocols:d,makeWebSocket:h}:g).protocols,P=C===void 0?d:C,x=(g=g.makeWebSocket)===void 0?h:g;return new lr.Observable(function(B){var Vt,_r=new lr.Subject,_e=x(f,P),_i=!1,_a=!1,kc=function(_d){if(Vt)throw _i=!0,_d=Error("Web socket message factory function called more than once"),B.error(_d),_d;return Vt=_d.subscribe(function(_l){_e.send(_l)}),_r};return _e.onopen=function(){_a?(_i=!0,_e.close()):B.next(kc)},_e.onmessage=function(_d){_r.next(_d.data)},_e.onerror=function(_d){_i=!0,B.error(Error(_d.message))},_e.onclose=function(_d){_i||(_i=!0,_a?(B.complete(),_r.complete()):B.error(Error(_d.code===1e3?e.normalClosureMessage:_d.reason)))},function(){_a=!0,Vt&&Vt.unsubscribe(),_i||(_i=!0,_e.close())}})}});(function(r){r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")&&r.default})(mr);var pi=function(r,e,d){(d===void 0||$f(r[e],d))&&(d!==void 0||e in r)||bg(r,e,d)},oi=function(r,e){if((e!=="constructor"||typeof r[e]!="function")&&e!="__proto__")return r[e]},HA=function(r){return jr(function(e,d){var h=-1,f=d.length,g=1<f?d[f-1]:void 0,C=2<f?d[2]:void 0;for(g=3<r.length&&typeof g=="function"?(f--,g):void 0,C&&Mh(d[0],d[1],C)&&(g=3>f?void 0:g,f=1),e=Object(e);++h<f;)(C=d[h])&&r(e,C,h,g);return e})}(function(r,e,d,h){tm(r,e,d,h)}),IA=Math.floor,JA=Math.random,nr=function(r,e){return r+IA(JA()*(e-r+1))},or=function(r){var e=r.length;return e?r[nr(0,e-1)]:void 0},KA=function(r,e){return he(e,function(d){return r[d]})},Ni=function(r){return r==null?[]:KA(r,Ad(r))},LA=function(r){return or(Ni(r))},bn=function(r){return(Va(r)?or:LA)(r)},xm=[],ym=function(r,e){return new WebSocket(r,e)},MA=Math.floor;N({target:"Number",stat:!0},{isInteger:function(r){return!ha(r)&&isFinite(r)&&MA(r)===r}}),Oo("from",Ej,Dj);var NA=function(r,e){for(var d=Array(arguments.length-1),h=0,f=2,g=!0;f<arguments.length;)d[h++]=arguments[f++];return new Promise(function(C,P){d[h]=function(x){if(g)if(g=!1,x)P(x);else{for(var B=Array(arguments.length-1),Vt=0;Vt<B.length;)B[Vt++]=arguments[Vt];C.apply(null,B)}};try{r.apply(e||null,d)}catch(x){g&&(g=!1,P(x))}})},OA=$a(function(r,e){e.length=function(f){var g=f.length;if(!g)return 0;for(var C=0;1<--g%4&&f.charAt(g)==="=";)++C;return Math.ceil(3*f.length)/4-C};var d=Array(64),h=Array(123);for(r=0;64>r;)h[d[r]=26>r?r+65:52>r?r+71:62>r?r-4:r-59|43]=r++;e.encode=function(f,g,C){for(var P,x=null,B=[],Vt=0,_r=0;g<C;){var _e=f[g++];switch(_r){case 0:B[Vt++]=d[_e>>2],P=(3&_e)<<4,_r=1;break;case 1:B[Vt++]=d[P|_e>>4],P=(15&_e)<<2,_r=2;break;case 2:B[Vt++]=d[P|_e>>6],B[Vt++]=d[63&_e],_r=0}8191<Vt&&((x||(x=[])).push(String.fromCharCode.apply(String,B)),Vt=0)}return _r&&(B[Vt++]=d[P],B[Vt++]=61,_r===1&&(B[Vt++]=61)),x?(Vt&&x.push(String.fromCharCode.apply(String,B.slice(0,Vt))),x.join("")):String.fromCharCode.apply(String,B.slice(0,Vt))},e.decode=function(f,g,C){for(var P,x=C,B=0,Vt=0;Vt<f.length;){var _r=f.charCodeAt(Vt++);if(_r===61&&1<B)break;if((_r=h[_r])===void 0)throw Error("invalid encoding");switch(B){case 0:P=_r,B=1;break;case 1:g[C++]=P<<2|(48&_r)>>4,P=_r,B=2;break;case 2:g[C++]=(15&P)<<4|(60&_r)>>2,P=_r,B=3;break;case 3:g[C++]=(3&P)<<6|_r,B=0}}if(B===1)throw Error("invalid encoding");return C-x},e.test=function(f){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(f)}});yg.prototype.on=function(r,e,d){return(this._listeners[r]||(this._listeners[r]=[])).push({fn:e,ctx:d||this}),this},yg.prototype.off=function(r,e){if(r===void 0)this._listeners={};else if(e===void 0)this._listeners[r]=[];else{r=this._listeners[r];for(var d=0;d<r.length;)r[d].fn===e?r.splice(d,1):++d}return this},yg.prototype.emit=function(r){var e=this._listeners[r];if(e){for(var d=[],h=1;h<arguments.length;)d.push(arguments[h++]);for(h=0;h<e.length;)e[h].fn.apply(e[h++].ctx,d)}return this};var PA=zm(zm),QA=function(c){try{var a=eval("quire".replace(/^/,"re"))(c);if(a&&(a.length||Object.keys(a).length))return a}catch(r){}return null},RA=$a(function(r,e){e.length=function(d){for(var h,f=0,g=0;g<d.length;++g)128>(h=d.charCodeAt(g))?f+=1:2048>h?f+=2:(64512&h)==55296&&(64512&d.charCodeAt(g+1))==56320?(++g,f+=4):f+=3;return f},e.read=function(d,h,f){if(1>f-h)return"";for(var g,C=null,P=[],x=0;h<f;)128>(g=d[h++])?P[x++]=g:191<g&&224>g?P[x++]=(31&g)<<6|63&d[h++]:239<g&&365>g?(g=((7&g)<<18|(63&d[h++])<<12|(63&d[h++])<<6|63&d[h++])-65536,P[x++]=55296+(g>>10),P[x++]=56320+(1023&g)):P[x++]=(15&g)<<12|(63&d[h++])<<6|63&d[h++],8191<x&&((C||(C=[])).push(String.fromCharCode.apply(String,P)),x=0);return C?(x&&C.push(String.fromCharCode.apply(String,P.slice(0,x))),C.join("")):String.fromCharCode.apply(String,P.slice(0,x))},e.write=function(d,h,f){for(var g,C,P=f,x=0;x<d.length;++x)128>(g=d.charCodeAt(x))?h[f++]=g:(2048>g?h[f++]=g>>6|192:((64512&g)==55296&&(64512&(C=d.charCodeAt(x+1)))==56320?(g=65536+((1023&g)<<10)+(1023&C),++x,h[f++]=g>>18|240,h[f++]=g>>12&63|128):h[f++]=g>>12|224,h[f++]=g>>6&63|128),h[f++]=63&g|128);return f-P}}),SA=function(r,e,d){var h=d||8192,f=h>>>1,g=null,C=h;return function(P){return 1>P||P>f?r(P):(C+P>h&&(g=r(h),C=0),P=e.call(g,C,C+=P),7&C&&(C=1+(7|C)),P)}},Xd=Wa.zero=new Wa(0,0);Xd.toNumber=function(){return 0},Xd.zzEncode=Xd.zzDecode=function(){return this},Xd.length=function(){return 1};var TA=Wa.zeroHash="\0\0\0\0\0\0\0\0";Wa.fromNumber=function(r){if(r===0)return Xd;var e=0>r;e&&(r=-r);var d=r>>>0;return r=(r-d)/4294967296>>>0,e&&(r=~r>>>0,d=~d>>>0,4294967295<++d&&(d=0,4294967295<++r&&(r=0))),new Wa(d,r)},Wa.from=function(r){if(typeof r=="number")return Wa.fromNumber(r);if(V.isString(r)){if(!V.Long)return Wa.fromNumber(parseInt(r,10));r=V.Long.fromString(r)}return r.low||r.high?new Wa(r.low>>>0,r.high>>>0):Xd},Wa.prototype.toNumber=function(r){if(!r&&this.hi>>>31){r=1+~this.lo>>>0;var e=~this.hi>>>0;return r||(e=e+1>>>0),-(r+4294967296*e)}return this.lo+4294967296*this.hi},Wa.prototype.toLong=function(r){return V.Long?new V.Long(0|this.lo,0|this.hi,!!r):{low:0|this.lo,high:0|this.hi,unsigned:!!r}};var td=String.prototype.charCodeAt;Wa.fromHash=function(r){return r===TA?Xd:new Wa((td.call(r,0)|td.call(r,1)<<8|td.call(r,2)<<16|td.call(r,3)<<24)>>>0,(td.call(r,4)|td.call(r,5)<<8|td.call(r,6)<<16|td.call(r,7)<<24)>>>0)},Wa.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Wa.prototype.zzEncode=function(){var r=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^r)>>>0,this.lo=(this.lo<<1^r)>>>0,this},Wa.prototype.zzDecode=function(){var r=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^r)>>>0,this.hi=(this.hi>>>1^r)>>>0,this},Wa.prototype.length=function(){var r=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,d=this.hi>>>24;return d===0?e===0?16384>r?128>r?1:2:2097152>r?3:4:16384>e?128>e?5:6:2097152>e?7:8:128>d?9:10};var V=$a(function(r,e){function d(f,g,C){for(var P=Object.keys(g),x=0;x<P.length;++x)f[P[x]]!==void 0&&C||(f[P[x]]=g[P[x]]);return f}function h(f){function g(C,P){if(!(this instanceof g))return new g(C,P);Object.defineProperty(this,"message",{get:function(){return C}}),Error.captureStackTrace?Error.captureStackTrace(this,g):Object.defineProperty(this,"stack",{value:Error().stack||""}),P&&d(this,P)}return(g.prototype=Object.create(Error.prototype)).constructor=g,Object.defineProperty(g.prototype,"name",{get:function(){return f}}),g.prototype.toString=function(){return this.name+": "+this.message},g}e.asPromise=NA,e.base64=OA,e.EventEmitter=yg,e.float=PA,e.inquire=QA,e.utf8=RA,e.pool=SA,e.LongBits=Wa,e.isNode=!!(Ya!==void 0&&Ya&&Ya.process&&Ya.process.versions&&Ya.process.versions.node),e.global=e.isNode&&Ya||typeof window<"u"&&window||typeof self<"u"&&self||Ya,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(f){return typeof f=="number"&&isFinite(f)&&Math.floor(f)===f},e.isString=function(f){return typeof f=="string"||f instanceof String},e.isObject=function(f){return f&&X(f)==="object"},e.isset=e.isSet=function(f,g){var C=f[g];return!(C==null||!f.hasOwnProperty(g))&&(X(C)!=="object"||0<(Array.isArray(C)?C.length:Object.keys(C).length))},e.Buffer=function(){try{var f=e.inquire("buffer").Buffer;return f.prototype.utf8Write?f:null}catch{return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(f){return typeof f=="number"?e.Buffer?e._Buffer_allocUnsafe(f):new e.Array(f):e.Buffer?e._Buffer_from(f):typeof Uint8Array>"u"?f:new Uint8Array(f)},e.Array=typeof Uint8Array<"u"?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(f){return f?e.LongBits.from(f).toHash():e.LongBits.zeroHash},e.longFromHash=function(f,g){return f=e.LongBits.fromHash(f),e.Long?e.Long.fromBits(f.lo,f.hi,g):f.toNumber(!!g)},e.merge=d,e.lcFirst=function(f){return f.charAt(0).toLowerCase()+f.substring(1)},e.newError=h,e.ProtocolError=h("ProtocolError"),e.oneOfGetter=function(f){for(var g={},C=0;C<f.length;++C)g[f[C]]=1;return function(){for(var P=Object.keys(this),x=P.length-1;-1<x;--x)if(g[P[x]]===1&&this[P[x]]!==void 0&&this[P[x]]!==null)return P[x]}},e.oneOfSetter=function(f){return function(g){for(var C=0;C<f.length;++C)f[C]!==g&&delete this[f[C]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var f=e.Buffer;f?(e._Buffer_from=f.from!==Uint8Array.from&&f.from||function(g,C){return new f(g,C)},e._Buffer_allocUnsafe=f.allocUnsafe||function(g){return new f(g)}):e._Buffer_from=e._Buffer_allocUnsafe=null}}),xi=ja,el,Nh=V.LongBits,pr=V.base64,qr=V.utf8,rr=function(){return V.Buffer?function(){return(ja.create=function(){return new el})()}:function(){return new ja}};ja.create=rr(),ja.alloc=function(r){return new V.Array(r)},V.Array!==Array&&(ja.alloc=V.pool(ja.alloc,V.Array.prototype.subarray)),ja.prototype._push=function(r,e,d){return this.tail=this.tail.next=new sf(r,e,d),this.len+=e,this},ui.prototype=Object.create(sf.prototype),ui.prototype.fn=function(r,e,d){for(;127<r;)e[d++]=127&r|128,r>>>=7;e[d]=r},ja.prototype.uint32=function(r){return this.len+=(this.tail=this.tail.next=new ui(128>(r>>>=0)?1:16384>r?2:2097152>r?3:268435456>r?4:5,r)).len,this},ja.prototype.int32=function(r){return 0>r?this._push(vi,10,Nh.fromNumber(r)):this.uint32(r)},ja.prototype.sint32=function(r){return this.uint32((r<<1^r>>31)>>>0)},ja.prototype.uint64=function(r){return r=Nh.from(r),this._push(vi,r.length(),r)},ja.prototype.int64=ja.prototype.uint64,ja.prototype.sint64=function(r){return r=Nh.from(r).zzEncode(),this._push(vi,r.length(),r)},ja.prototype.bool=function(r){return this._push(ti,1,r?1:0)},ja.prototype.fixed32=function(r){return this._push(wi,4,r>>>0)},ja.prototype.sfixed32=ja.prototype.fixed32,ja.prototype.fixed64=function(r){return r=Nh.from(r),this._push(wi,4,r.lo)._push(wi,4,r.hi)},ja.prototype.sfixed64=ja.prototype.fixed64,ja.prototype.float=function(r){return this._push(V.float.writeFloatLE,4,r)},ja.prototype.double=function(r){return this._push(V.float.writeDoubleLE,8,r)};var UA=V.Array.prototype.set?function(r,e,d){e.set(r,d)}:function(r,e,d){for(var h=0;h<r.length;++h)e[d+h]=r[h]};ja.prototype.bytes=function(r){var e=r.length>>>0;if(!e)return this._push(ti,1,0);if(V.isString(r)){var d=ja.alloc(e=pr.length(r));pr.decode(r,d,0),r=d}return this.uint32(e)._push(UA,e,r)},ja.prototype.string=function(r){var e=qr.length(r);return e?this.uint32(e)._push(qr.write,e,r):this._push(ti,1,0)},ja.prototype.fork=function(){return this.states=new Tt(this),this.head=this.tail=new sf(si,0,0),this.len=0,this},ja.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new sf(si,0,0),this.len=0),this},ja.prototype.ldelim=function(){var r=this.head,e=this.tail,d=this.len;return this.reset().uint32(d),d&&(this.tail.next=r.next,this.tail=e,this.len+=d),this},ja.prototype.finish=function(){for(var r=this.head.next,e=this.constructor.alloc(this.len),d=0;r;)r.fn(r.val,e,d),d+=r.len,r=r.next;return e},ja._configure=function(r){el=r,ja.create=rr(),el._configure()},(jc.prototype=Object.create(xi.prototype)).constructor=jc,jc._configure=function(){jc.alloc=V._Buffer_allocUnsafe,jc.writeBytesBuffer=V.Buffer&&V.Buffer.prototype instanceof Uint8Array&&V.Buffer.prototype.set.name==="set"?function(r,e,d){e.set(r,d)}:function(r,e,d){if(r.copy)r.copy(e,d,0,r.length);else for(var h=0;h<r.length;)e[d++]=r[h++]}},jc.prototype.bytes=function(r){V.isString(r)&&(r=V._Buffer_from(r,"base64"));var e=r.length>>>0;return this.uint32(e),e&&this._push(jc.writeBytesBuffer,e,r),this},jc.prototype.string=function(r){var e=V.Buffer.byteLength(r);return this.uint32(e),e&&this._push(Ut,e,r),this},jc._configure();var zi=La,fl,Em=V.LongBits,VA=V.utf8,sr=typeof Uint8Array<"u"?function(r){if(r instanceof Uint8Array||Array.isArray(r))return new La(r);throw Error("illegal buffer")}:function(r){if(Array.isArray(r))return new La(r);throw Error("illegal buffer")},tr=function(){return V.Buffer?function(r){return(La.create=function(e){return V.Buffer.isBuffer(e)?new fl(e):sr(e)})(r)}:sr};La.create=tr(),La.prototype._slice=V.Array.prototype.subarray||V.Array.prototype.slice,La.prototype.uint32=function(){var r=4294967295;return function(){if(r=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++]||(r=(r|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])||(r=(r|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])||(r=(r|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])||(r=(r|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++]))return r;if((this.pos+=5)>this.len)throw this.pos=this.len,Yb(this,10);return r}}(),La.prototype.int32=function(){return 0|this.uint32()},La.prototype.sint32=function(){var r=this.uint32();return r>>>1^-(1&r)|0},La.prototype.bool=function(){return this.uint32()!==0},La.prototype.fixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return zg(this.buf,this.pos+=4)},La.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return 0|zg(this.buf,this.pos+=4)},La.prototype.float=function(){if(this.pos+4>this.len)throw Yb(this,4);var r=V.float.readFloatLE(this.buf,this.pos);return this.pos+=4,r},La.prototype.double=function(){if(this.pos+8>this.len)throw Yb(this,4);var r=V.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,r},La.prototype.bytes=function(){var r=this.uint32(),e=this.pos,d=this.pos+r;if(d>this.len)throw Yb(this,r);return this.pos+=r,Array.isArray(this.buf)?this.buf.slice(e,d):e===d?new this.buf.constructor(0):this._slice.call(this.buf,e,d)},La.prototype.string=function(){var r=this.bytes();return VA.read(r,0,r.length)},La.prototype.skip=function(r){if(typeof r=="number"){if(this.pos+r>this.len)throw Yb(this,r);this.pos+=r}else do if(this.pos>=this.len)throw Yb(this);while(128&this.buf[this.pos++]);return this},La.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=7&this.uint32())!=4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this},La._configure=function(r){fl=r,La.create=tr(),fl._configure();var e=V.Long?"toLong":"toNumber";V.merge(La.prototype,{int64:function(){return yi.call(this)[e](!1)},uint64:function(){return yi.call(this)[e](!0)},sint64:function(){return yi.call(this).zzDecode()[e](!1)},fixed64:function(){return Fm.call(this)[e](!0)},sfixed64:function(){return Fm.call(this)[e](!1)}})},(Fd.prototype=Object.create(zi.prototype)).constructor=Fd,Fd._configure=function(){V.Buffer&&(Fd.prototype._slice=V.Buffer.prototype.slice)},Fd.prototype.string=function(){var r=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+r,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+r,this.len))},Fd._configure(),(tf.prototype=Object.create(V.EventEmitter.prototype)).constructor=tf,tf.prototype.rpcCall=function r(e,d,h,f,g){if(!f)throw TypeError("request must be specified");var C=this;if(!g)return V.asPromise(r,C,e,d,h,f);if(C.rpcImpl)try{return C.rpcImpl(e,d[C.requestDelimited?"encodeDelimited":"encode"](f).finish(),function(P,x){if(P)return C.emit("error",P,e),g(P);if(x!==null){if(!(x instanceof h))try{x=h[C.responseDelimited?"decodeDelimited":"decode"](x)}catch(B){return C.emit("error",B,e),g(B)}return C.emit("data",x,e),g(null,x)}C.end(!0)})}catch(P){C.emit("error",P,e),setTimeout(function(){g(P)},0)}else setTimeout(function(){g(Error("already ended"))},0)},tf.prototype.end=function(r){return this.rpcImpl&&(r||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var WA=$a(function(r,e){e.Service=tf}),XA={},fc=$a(function(r,e){function d(){h.util._configure(),h.Writer._configure(h.BufferWriter),h.Reader._configure(h.BufferReader)}var h=e;h.build="minimal",h.Writer=xi,h.BufferWriter=jc,h.Reader=zi,h.BufferReader=Fd,h.util=V,h.rpc=WA,h.roots=XA,h.configure=d,d()});fc.util.Long=U,fc.configure();var u=fc.Reader,L=fc.Writer,q=fc.util,t=fc.roots.default||(fc.roots.default={}),YA=t.URI=function(){var r={},e=Object.create(r);return e[r[0]="Unknown"]=0,e[r[1]="PingUri"]=1,e[r[2]="PongUri"]=2,e[r[11]="UserJoinUri"]=11,e[r[12]="UserRespUri"]=12,e[r[21]="UserQuitUri"]=21,e[r[22]="UserDropUri"]=22,e[r[31]="GroupEnterUri"]=31,e[r[32]="GroupLeaveUri"]=32,e[r[33]="GroupReplyUri"]=33,e[r[36]="GroupEnterNoticeUri"]=36,e[r[37]="GroupLeaveNoticeUri"]=37,e[r[38]="GroupEventNoticeUri"]=38,e[r[39]="GroupCountNoticeUri"]=39,e[r[41]="UserStatusListUri"]=41,e[r[42]="UserStatusResultUri"]=42,e[r[51]="GroupStatusListUri"]=51,e[r[52]="GroupStatusResultUri"]=52,e[r[55]="GroupAllUsersListUri"]=55,e[r[56]="GroupAllUsersResultUri"]=56,e[r[100]="MessageUri"]=100,e[r[101]="AckUri"]=101,e[r[115]="FileUploadIndexGetUri"]=115,e[r[116]="FileUploadIndexRetUri"]=116,e[r[117]="FileUploadIndexSetUri"]=117,e[r[118]="FileUploadIndexFinUri"]=118,e[r[119]="FileUploadIndexErrUri"]=119,e[r[125]="FileDownloadIndexGetUri"]=125,e[r[126]="FileDownloadIndexRetUri"]=126,e[r[127]="FileDownloadIndexErrUri"]=127,e[r[201]="UserJoinNoticeUri"]=201,e[r[202]="UserQuitNoticeUri"]=202,e[r[203]="UserWaitNoticeUri"]=203,e[r[301]="UserAttributeGetUri"]=301,e[r[302]="UserAttributeRetUri"]=302,e[r[303]="UserAttributeSetUri"]=303,e[r[304]="UserAttributeModUri"]=304,e[r[305]="UserAttributeDelUri"]=305,e[r[307]="UserAttributeRspUri"]=307,e[r[308]="UserAttributeErrUri"]=308,e[r[311]="UserAttributeKeysGetUri"]=311,e[r[312]="UserAttributeKeysRetUri"]=312,e[r[351]="GroupAttributeGetUri"]=351,e[r[352]="GroupAttributeRetUri"]=352,e[r[353]="GroupAttributeSetUri"]=353,e[r[354]="GroupAttributeModUri"]=354,e[r[355]="GroupAttributeDelUri"]=355,e[r[356]="GroupAttributeAltUri"]=356,e[r[357]="GroupAttributeRspUri"]=357,e[r[358]="GroupAttributeErrUri"]=358,e[r[361]="GroupAttributeKeysGetUri"]=361,e[r[362]="GroupAttributeKeysRetUri"]=362,e[r[401]="SubscribeUserStatusUri"]=401,e[r[402]="UnsubscribeUserStatusUri"]=402,e[r[499]="SubscribeResponseUri"]=499,e}(),Oh=t.Wrapper=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.uri=0,r.prototype.data=q.newBuffer([]),r.encode=function(e,d){return d||(d=L.create()),e.uri!=null&&Object.hasOwnProperty.call(e,"uri")&&d.uint32(8).int32(e.uri),e.data!=null&&Object.hasOwnProperty.call(e,"data")&&d.uint32(18).bytes(e.data),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.Wrapper;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.uri=e.int32();break;case 2:h.data=e.bytes();break;default:e.skipType(7&f)}}return h},r}(),ZA=t.Ping=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.ms!=null&&Object.hasOwnProperty.call(e,"ms")&&d.uint32(16).uint64(e.ms),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.Ping;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.ms=e.uint64();break;default:e.skipType(7&f)}}return h},r}(),$A=t.Pong=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.ms!=null&&Object.hasOwnProperty.call(e,"ms")&&d.uint32(16).uint64(e.ms),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.Pong;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.ms=e.uint64();break;default:e.skipType(7&f)}}return h},r}(),aB=t.UserJoin=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.opt=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.account="",r.prototype.ticket="",r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.opt!=null&&Object.hasOwnProperty.call(e,"opt")&&d.uint32(16).uint64(e.opt),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(24).uint64(e.instance),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(34).string(e.account),e.ticket!=null&&Object.hasOwnProperty.call(e,"ticket")&&d.uint32(42).string(e.ticket),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserJoin;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.opt=e.uint64();break;case 3:h.instance=e.uint64();break;case 4:h.account=e.string();break;case 5:h.ticket=e.string();break;default:e.skipType(7&f)}}return h},r}(),bB=t.UserResp=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.account="",r.prototype.code=0,r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(18).string(e.account),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&d.uint32(24).uint32(e.code),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserResp;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.account=e.string();break;case 3:h.code=e.uint32();break;default:e.skipType(7&f)}}return h},r}(),cB=t.UserQuit=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.encode=function(e,d){return d||(d=L.create()),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserQuit;e.pos<d;){var f=e.uint32();e.skipType(7&f)}return h},r}(),dB=t.UserDrop=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.code=0,r.encode=function(e,d){return d||(d=L.create()),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&d.uint32(8).uint32(e.code),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserDrop;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.code=e.uint32();break;default:e.skipType(7&f)}}return h},r}(),eB=t.GroupEnter=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.account="",r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(18).string(e.account),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupEnter;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.account=e.string();break;default:e.skipType(7&f)}}return h},r}(),fB=t.GroupLeave=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.account="",r.encode=function(e,d){return d||(d=L.create()),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(10).string(e.account),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupLeave;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.account=e.string();break;default:e.skipType(7&f)}}return h},r}(),gB=t.GroupReply=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.account="",r.prototype.code=0,r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(18).string(e.account),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&d.uint32(24).uint32(e.code),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupReply;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.account=e.string();break;case 3:h.code=e.uint32();break;default:e.skipType(7&f)}}return h},r}(),ur=t.GroupLeaveNotice=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.user="",r.prototype.group="",r.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.size=0,r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.user!=null&&Object.hasOwnProperty.call(e,"user")&&d.uint32(18).string(e.user),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(26).string(e.group),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(32).uint64(e.instance),e.size!=null&&Object.hasOwnProperty.call(e,"size")&&d.uint32(40).uint32(e.size),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupLeaveNotice;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.user=e.string();break;case 3:h.group=e.string();break;case 4:h.instance=e.uint64();break;case 5:h.size=e.uint32();break;default:e.skipType(7&f)}}return h},r}(),vr=t.GroupEnterNotice=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.user="",r.prototype.group="",r.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.size=0,r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.user!=null&&Object.hasOwnProperty.call(e,"user")&&d.uint32(18).string(e.user),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(26).string(e.group),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(32).uint64(e.instance),e.size!=null&&Object.hasOwnProperty.call(e,"size")&&d.uint32(40).uint32(e.size),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupEnterNotice;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.user=e.string();break;case 3:h.group=e.string();break;case 4:h.instance=e.uint64();break;case 5:h.size=e.uint32();break;default:e.skipType(7&f)}}return h},r}(),wr=t.Message=function(){function r(e){if(this.MiscMap={},e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.options=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.src="",r.prototype.dst="",r.prototype.payload=q.newBuffer([]),r.prototype.MiscMap=q.emptyObject,r.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,r.encode=function(e,d){if(d||(d=L.create()),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(8).uint64(e.instance),e.dialogue!=null&&Object.hasOwnProperty.call(e,"dialogue")&&d.uint32(16).uint64(e.dialogue),e.sequence!=null&&Object.hasOwnProperty.call(e,"sequence")&&d.uint32(24).uint64(e.sequence),e.options!=null&&Object.hasOwnProperty.call(e,"options")&&d.uint32(32).uint64(e.options),e.src!=null&&Object.hasOwnProperty.call(e,"src")&&d.uint32(42).string(e.src),e.dst!=null&&Object.hasOwnProperty.call(e,"dst")&&d.uint32(50).string(e.dst),e.payload!=null&&Object.hasOwnProperty.call(e,"payload")&&d.uint32(58).bytes(e.payload),e.MiscMap!=null&&Object.hasOwnProperty.call(e,"MiscMap"))for(var h=Object.keys(e.MiscMap),f=0;f<h.length;++f)d.uint32(66).fork().uint32(10).string(h[f]).uint32(18).bytes(e.MiscMap[h[f]]).ldelim();return e.ms!=null&&Object.hasOwnProperty.call(e,"ms")&&d.uint32(72).uint64(e.ms),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h,f,g=new t.Message;e.pos<d;)switch(h=e.uint32(),h>>>3){case 1:g.instance=e.uint64();break;case 2:g.dialogue=e.uint64();break;case 3:g.sequence=e.uint64();break;case 4:g.options=e.uint64();break;case 5:g.src=e.string();break;case 6:g.dst=e.string();break;case 7:g.payload=e.bytes();break;case 8:g.MiscMap===q.emptyObject&&(g.MiscMap={});var C=e.uint32()+e.pos;for(h="",f=[];e.pos<C;){var P=e.uint32();switch(P>>>3){case 1:h=e.string();break;case 2:f=e.bytes();break;default:e.skipType(7&P)}}g.MiscMap[h]=f;break;case 9:g.ms=e.uint64();break;default:e.skipType(7&h)}return g},r}(),xr=t.Ack=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.code=0,r.encode=function(e,d){return d||(d=L.create()),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(8).uint64(e.instance),e.dialogue!=null&&Object.hasOwnProperty.call(e,"dialogue")&&d.uint32(16).uint64(e.dialogue),e.sequence!=null&&Object.hasOwnProperty.call(e,"sequence")&&d.uint32(24).uint64(e.sequence),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&d.uint32(32).uint32(e.code),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.Ack;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.instance=e.uint64();break;case 2:h.dialogue=e.uint64();break;case 3:h.sequence=e.uint64();break;case 4:h.code=e.uint32();break;default:e.skipType(7&f)}}return h},r}(),hB=t.FileUploadIndexGet=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.hash=q.newBuffer([]),r.prototype.size=0,r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.hash!=null&&Object.hasOwnProperty.call(e,"hash")&&d.uint32(18).bytes(e.hash),e.size!=null&&Object.hasOwnProperty.call(e,"size")&&d.uint32(24).uint32(e.size),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.FileUploadIndexGet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.hash=e.bytes();break;case 3:h.size=e.uint32();break;default:e.skipType(7&f)}}return h},r}(),iB=t.FileUploadIndexRet=function(){function r(e){if(this.servers=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.unit=0,r.prototype.servers=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.unit!=null&&Object.hasOwnProperty.call(e,"unit")&&d.uint32(16).uint32(e.unit),e.servers!=null&&e.servers.length){d.uint32(26).fork();for(var h=0;h<e.servers.length;++h)d.uint32(e.servers[h]);d.ldelim()}return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.FileUploadIndexRet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.unit=e.uint32();break;case 3:if(h.servers&&h.servers.length||(h.servers=[]),(7&f)==2)for(f=e.uint32()+e.pos;e.pos<f;)h.servers.push(e.uint32());else h.servers.push(e.uint32());break;default:e.skipType(7&f)}}return h},r}(),jB=t.FileUploadIndexSet=function(){function r(e){if(this.servers=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.hash=q.newBuffer([]),r.prototype.unit=0,r.prototype.servers=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.hash!=null&&Object.hasOwnProperty.call(e,"hash")&&d.uint32(18).bytes(e.hash),e.unit!=null&&Object.hasOwnProperty.call(e,"unit")&&d.uint32(24).uint32(e.unit),e.servers!=null&&e.servers.length){d.uint32(34).fork();for(var h=0;h<e.servers.length;++h)d.uint32(e.servers[h]);d.ldelim()}return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.FileUploadIndexSet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.hash=e.bytes();break;case 3:h.unit=e.uint32();break;case 4:if(h.servers&&h.servers.length||(h.servers=[]),(7&f)==2)for(f=e.uint32()+e.pos;e.pos<f;)h.servers.push(e.uint32());else h.servers.push(e.uint32());break;default:e.skipType(7&f)}}return h},r}(),kB=t.FileUploadIndexFin=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.zone=0,r.prototype.unit=0,r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.zone!=null&&Object.hasOwnProperty.call(e,"zone")&&d.uint32(16).uint32(e.zone),e.unit!=null&&Object.hasOwnProperty.call(e,"unit")&&d.uint32(24).uint32(e.unit),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.FileUploadIndexFin;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.zone=e.uint32();break;case 3:h.unit=e.uint32();break;default:e.skipType(7&f)}}return h},r}(),lB=t.FileUploadIndexErr=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.code=0,r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&d.uint32(16).uint32(e.code),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.FileUploadIndexErr;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.code=e.uint32();break;default:e.skipType(7&f)}}return h},r}(),mB=t.FileDownloadIndexGet=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.zone=0,r.prototype.hash=q.newBuffer([]),r.prototype.size=0,r.prototype.unit=0,r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.zone!=null&&Object.hasOwnProperty.call(e,"zone")&&d.uint32(16).uint32(e.zone),e.hash!=null&&Object.hasOwnProperty.call(e,"hash")&&d.uint32(26).bytes(e.hash),e.size!=null&&Object.hasOwnProperty.call(e,"size")&&d.uint32(32).uint32(e.size),e.unit!=null&&Object.hasOwnProperty.call(e,"unit")&&d.uint32(40).uint32(e.unit),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.FileDownloadIndexGet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.zone=e.uint32();break;case 3:h.hash=e.bytes();break;case 4:h.size=e.uint32();break;case 5:h.unit=e.uint32();break;default:e.skipType(7&f)}}return h},r}(),nB=t.FileDownloadIndexRet=function(){function r(e){if(this.servers=[],this.backups=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.unit=0,r.prototype.zone=0,r.prototype.servers=q.emptyArray,r.prototype.backups=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.unit!=null&&Object.hasOwnProperty.call(e,"unit")&&d.uint32(16).uint32(e.unit),e.zone!=null&&Object.hasOwnProperty.call(e,"zone")&&d.uint32(24).uint32(e.zone),e.servers!=null&&e.servers.length){d.uint32(34).fork();for(var h=0;h<e.servers.length;++h)d.uint32(e.servers[h]);d.ldelim()}if(e.backups!=null&&e.backups.length){for(d.uint32(42).fork(),h=0;h<e.backups.length;++h)d.uint32(e.backups[h]);d.ldelim()}return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.FileDownloadIndexRet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.unit=e.uint32();break;case 3:h.zone=e.uint32();break;case 4:if(h.servers&&h.servers.length||(h.servers=[]),(7&f)==2)for(f=e.uint32()+e.pos;e.pos<f;)h.servers.push(e.uint32());else h.servers.push(e.uint32());break;case 5:if(h.backups&&h.backups.length||(h.backups=[]),(7&f)==2)for(f=e.uint32()+e.pos;e.pos<f;)h.backups.push(e.uint32());else h.backups.push(e.uint32());break;default:e.skipType(7&f)}}return h},r}(),oB=t.FileDownloadIndexErr=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.code=0,r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&d.uint32(16).uint32(e.code),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.FileDownloadIndexErr;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.code=e.uint32();break;default:e.skipType(7&f)}}return h},r}(),pB=t.GroupAllUsersList=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.group="",r.prototype.pageSize=0,r.prototype.pageNumber=0,r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(18).string(e.group),e.pageSize!=null&&Object.hasOwnProperty.call(e,"pageSize")&&d.uint32(24).uint32(e.pageSize),e.pageNumber!=null&&Object.hasOwnProperty.call(e,"pageNumber")&&d.uint32(32).uint32(e.pageNumber),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAllUsersList;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.group=e.string();break;case 3:h.pageSize=e.uint32();break;case 4:h.pageNumber=e.uint32();break;default:e.skipType(7&f)}}return h},r}(),qB=t.GroupAllUsersResult=function(){function r(e){if(this.memberInfos=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.group="",r.prototype.totalSize=0,r.prototype.pageSize=0,r.prototype.pageNumber=0,r.prototype.memberInfos=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(18).string(e.group),e.totalSize!=null&&Object.hasOwnProperty.call(e,"totalSize")&&d.uint32(24).uint32(e.totalSize),e.pageSize!=null&&Object.hasOwnProperty.call(e,"pageSize")&&d.uint32(32).uint32(e.pageSize),e.pageNumber!=null&&Object.hasOwnProperty.call(e,"pageNumber")&&d.uint32(40).uint32(e.pageNumber),e.memberInfos!=null&&e.memberInfos.length)for(var h=0;h<e.memberInfos.length;++h)t.GroupAllUsersResult.MemberInfo.encode(e.memberInfos[h],d.uint32(50).fork()).ldelim();return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAllUsersResult;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.group=e.string();break;case 3:h.totalSize=e.uint32();break;case 4:h.pageSize=e.uint32();break;case 5:h.pageNumber=e.uint32();break;case 6:h.memberInfos&&h.memberInfos.length||(h.memberInfos=[]),h.memberInfos.push(t.GroupAllUsersResult.MemberInfo.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},r.MemberInfo=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(d,h){return h||(h=L.create()),d.account!=null&&Object.hasOwnProperty.call(d,"account")&&h.uint32(10).string(d.account),d.ts!=null&&Object.hasOwnProperty.call(d,"ts")&&h.uint32(16).uint32(d.ts),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.GroupAllUsersResult.MemberInfo;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.account=d.string();break;case 2:f.ts=d.uint32();break;default:d.skipType(7&g)}}return f},e}(),r}(),rB=t.UserStatusList=function(){function r(e){if(this.users=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.users=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.users!=null&&e.users.length)for(var h=0;h<e.users.length;++h)d.uint32(18).string(e.users[h]);return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserStatusList;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.users&&h.users.length||(h.users=[]),h.users.push(e.string());break;default:e.skipType(7&f)}}return h},r}(),sB=t.UserStatusResult=function(){function r(e){if(this.userInfos=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.userInfos=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.userInfos!=null&&e.userInfos.length)for(var h=0;h<e.userInfos.length;++h)t.UserStatusResult.UserStatusInfo.encode(e.userInfos[h],d.uint32(18).fork()).ldelim();return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserStatusResult;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.userInfos&&h.userInfos.length||(h.userInfos=[]),h.userInfos.push(t.UserStatusResult.UserStatusInfo.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},r.UserStatusInfo=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(d,h){return h||(h=L.create()),d.account!=null&&Object.hasOwnProperty.call(d,"account")&&h.uint32(10).string(d.account),d.ts!=null&&Object.hasOwnProperty.call(d,"ts")&&h.uint32(16).uint32(d.ts),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.UserStatusResult.UserStatusInfo;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.account=d.string();break;case 2:f.ts=d.uint32();break;default:d.skipType(7&g)}}return f},e}(),r}(),tB=t.UserAttributeGet=function(){function r(e){if(this.attributes=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.account="",r.prototype.attributes=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(18).string(e.account),e.attributes!=null&&e.attributes.length)for(var h=0;h<e.attributes.length;++h)d.uint32(26).string(e.attributes[h]);return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserAttributeGet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.account=e.string();break;case 3:h.attributes&&h.attributes.length||(h.attributes=[]),h.attributes.push(e.string());break;default:e.skipType(7&f)}}return h},r}(),uB=t.UserAttributeRet=function(){function r(e){if(this.attributeInfos=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.attributeInfos=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.attributeInfos!=null&&e.attributeInfos.length)for(var h=0;h<e.attributeInfos.length;++h)t.UserAttributeRet.AttributeInfo.encode(e.attributeInfos[h],d.uint32(18).fork()).ldelim();return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserAttributeRet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.attributeInfos&&h.attributeInfos.length||(h.attributeInfos=[]),h.attributeInfos.push(t.UserAttributeRet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},r.AttributeInfo=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.key="",e.prototype.value="",e.encode=function(d,h){return h||(h=L.create()),d.key!=null&&Object.hasOwnProperty.call(d,"key")&&h.uint32(10).string(d.key),d.value!=null&&Object.hasOwnProperty.call(d,"value")&&h.uint32(18).string(d.value),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.UserAttributeRet.AttributeInfo;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.key=d.string();break;case 2:f.value=d.string();break;default:d.skipType(7&g)}}return f},e}(),r}(),vB=t.UserAttributeSet=function(){function r(e){if(this.attributeInfos=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.account="",r.prototype.attributeInfos=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(18).string(e.account),e.attributeInfos!=null&&e.attributeInfos.length)for(var h=0;h<e.attributeInfos.length;++h)t.UserAttributeSet.AttributeInfo.encode(e.attributeInfos[h],d.uint32(26).fork()).ldelim();return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserAttributeSet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.account=e.string();break;case 3:h.attributeInfos&&h.attributeInfos.length||(h.attributeInfos=[]),h.attributeInfos.push(t.UserAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},r.AttributeInfo=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.key="",e.prototype.value="",e.encode=function(d,h){return h||(h=L.create()),d.key!=null&&Object.hasOwnProperty.call(d,"key")&&h.uint32(10).string(d.key),d.value!=null&&Object.hasOwnProperty.call(d,"value")&&h.uint32(18).string(d.value),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.UserAttributeSet.AttributeInfo;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.key=d.string();break;case 2:f.value=d.string();break;default:d.skipType(7&g)}}return f},e}(),r}(),wB=t.UserAttributeMod=function(){function r(e){if(this.attributeInfos=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.account="",r.prototype.attributeInfos=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(18).string(e.account),e.attributeInfos!=null&&e.attributeInfos.length)for(var h=0;h<e.attributeInfos.length;++h)t.UserAttributeMod.AttributeInfo.encode(e.attributeInfos[h],d.uint32(26).fork()).ldelim();return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserAttributeMod;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.account=e.string();break;case 3:h.attributeInfos&&h.attributeInfos.length||(h.attributeInfos=[]),h.attributeInfos.push(t.UserAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},r.AttributeInfo=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.key="",e.prototype.value="",e.encode=function(d,h){return h||(h=L.create()),d.key!=null&&Object.hasOwnProperty.call(d,"key")&&h.uint32(10).string(d.key),d.value!=null&&Object.hasOwnProperty.call(d,"value")&&h.uint32(18).string(d.value),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.UserAttributeMod.AttributeInfo;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.key=d.string();break;case 2:f.value=d.string();break;default:d.skipType(7&g)}}return f},e}(),r}(),xB=t.UserAttributeDel=function(){function r(e){if(this.attributes=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.account="",r.prototype.attributes=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(18).string(e.account),e.attributes!=null&&e.attributes.length)for(var h=0;h<e.attributes.length;++h)d.uint32(26).string(e.attributes[h]);return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserAttributeDel;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.account=e.string();break;case 3:h.attributes&&h.attributes.length||(h.attributes=[]),h.attributes.push(e.string());break;default:e.skipType(7&f)}}return h},r}(),yB=t.UserAttributeErr=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.code=0,r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&d.uint32(16).uint32(e.code),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserAttributeErr;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.code=e.uint32();break;default:e.skipType(7&f)}}return h},r}(),zB=t.UserAttributeKeysGet=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.account="",r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.account!=null&&Object.hasOwnProperty.call(e,"account")&&d.uint32(18).string(e.account),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserAttributeKeysGet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.account=e.string();break;default:e.skipType(7&f)}}return h},r}(),AB=t.UserAttributeKeysRet=function(){function r(e){if(this.keys=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.keys=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.keys!=null&&e.keys.length)for(var h=0;h<e.keys.length;++h)d.uint32(18).string(e.keys[h]);return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserAttributeKeysRet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.keys&&h.keys.length||(h.keys=[]),h.keys.push(e.string());break;default:e.skipType(7&f)}}return h},r}(),BB=t.UserAttributeRsp=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserAttributeRsp;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;default:e.skipType(7&f)}}return h},r}(),CB=t.GroupStatusList=function(){function r(e){if(this.groups=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.groups=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.groups!=null&&e.groups.length)for(var h=0;h<e.groups.length;++h)d.uint32(18).string(e.groups[h]);return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupStatusList;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.groups&&h.groups.length||(h.groups=[]),h.groups.push(e.string());break;default:e.skipType(7&f)}}return h},r}(),DB=t.GroupStatusResult=function(){function r(e){if(this.groupInfos=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.groupInfos=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.groupInfos!=null&&e.groupInfos.length)for(var h=0;h<e.groupInfos.length;++h)t.GroupStatusResult.GroupInfo.encode(e.groupInfos[h],d.uint32(18).fork()).ldelim();return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupStatusResult;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.groupInfos&&h.groupInfos.length||(h.groupInfos=[]),h.groupInfos.push(t.GroupStatusResult.GroupInfo.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},r.GroupInfo=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.group="",e.prototype.memberCount=0,e.encode=function(d,h){return h||(h=L.create()),d.group!=null&&Object.hasOwnProperty.call(d,"group")&&h.uint32(10).string(d.group),d.memberCount!=null&&Object.hasOwnProperty.call(d,"memberCount")&&h.uint32(16).uint32(d.memberCount),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.GroupStatusResult.GroupInfo;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.group=d.string();break;case 2:f.memberCount=d.uint32();break;default:d.skipType(7&g)}}return f},e}(),r}(),EB=t.GroupCountNotice=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.group="",r.prototype.size=0,r.encode=function(e,d){return d||(d=L.create()),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(8).uint64(e.instance),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(16).uint64(e.seq),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(26).string(e.group),e.size!=null&&Object.hasOwnProperty.call(e,"size")&&d.uint32(32).uint32(e.size),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupCountNotice;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.instance=e.uint64();break;case 2:h.seq=e.uint64();break;case 3:h.group=e.string();break;case 4:h.size=e.uint32();break;default:e.skipType(7&f)}}return h},r}(),FB=t.GroupAttributeGet=function(){function r(e){if(this.attributes=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.group="",r.prototype.attributes=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(18).string(e.group),e.attributes!=null&&e.attributes.length)for(var h=0;h<e.attributes.length;++h)d.uint32(26).string(e.attributes[h]);return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeGet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.group=e.string();break;case 3:h.attributes&&h.attributes.length||(h.attributes=[]),h.attributes.push(e.string());break;default:e.skipType(7&f)}}return h},r}(),GB=t.GroupAttributeRet=function(){function r(e){if(this.attributeMaps=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.attributeMaps=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.attributeMaps!=null&&e.attributeMaps.length)for(var h=0;h<e.attributeMaps.length;++h)t.GroupAttributeRet.AttributeMap.encode(e.attributeMaps[h],d.uint32(18).fork()).ldelim();return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeRet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.attributeMaps&&h.attributeMaps.length||(h.attributeMaps=[]),h.attributeMaps.push(t.GroupAttributeRet.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},r.AttributeMap=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(d,h){return h||(h=L.create()),d.key!=null&&Object.hasOwnProperty.call(d,"key")&&h.uint32(10).string(d.key),d.value!=null&&Object.hasOwnProperty.call(d,"value")&&h.uint32(18).string(d.value),d.origin!=null&&Object.hasOwnProperty.call(d,"origin")&&h.uint32(26).string(d.origin),d.ms!=null&&Object.hasOwnProperty.call(d,"ms")&&h.uint32(32).uint64(d.ms),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.GroupAttributeRet.AttributeMap;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.key=d.string();break;case 2:f.value=d.string();break;case 3:f.origin=d.string();break;case 4:f.ms=d.uint64();break;default:d.skipType(7&g)}}return f},e}(),r}(),HB=t.GroupAttributeSet=function(){function r(e){if(this.attributeInfos=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.group="",r.prototype.broadcast=!1,r.prototype.attributeInfos=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(18).string(e.group),e.broadcast!=null&&Object.hasOwnProperty.call(e,"broadcast")&&d.uint32(24).bool(e.broadcast),e.attributeInfos!=null&&e.attributeInfos.length)for(var h=0;h<e.attributeInfos.length;++h)t.GroupAttributeSet.AttributeInfo.encode(e.attributeInfos[h],d.uint32(34).fork()).ldelim();return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeSet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.group=e.string();break;case 3:h.broadcast=e.bool();break;case 4:h.attributeInfos&&h.attributeInfos.length||(h.attributeInfos=[]),h.attributeInfos.push(t.GroupAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},r.AttributeInfo=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.key="",e.prototype.value="",e.encode=function(d,h){return h||(h=L.create()),d.key!=null&&Object.hasOwnProperty.call(d,"key")&&h.uint32(10).string(d.key),d.value!=null&&Object.hasOwnProperty.call(d,"value")&&h.uint32(18).string(d.value),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.GroupAttributeSet.AttributeInfo;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.key=d.string();break;case 2:f.value=d.string();break;default:d.skipType(7&g)}}return f},e}(),r}(),IB=t.GroupAttributeMod=function(){function r(e){if(this.attributeInfos=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.group="",r.prototype.broadcast=!1,r.prototype.attributeInfos=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(18).string(e.group),e.broadcast!=null&&Object.hasOwnProperty.call(e,"broadcast")&&d.uint32(24).bool(e.broadcast),e.attributeInfos!=null&&e.attributeInfos.length)for(var h=0;h<e.attributeInfos.length;++h)t.GroupAttributeMod.AttributeInfo.encode(e.attributeInfos[h],d.uint32(34).fork()).ldelim();return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeMod;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.group=e.string();break;case 3:h.broadcast=e.bool();break;case 4:h.attributeInfos&&h.attributeInfos.length||(h.attributeInfos=[]),h.attributeInfos.push(t.GroupAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},r.AttributeInfo=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.key="",e.prototype.value="",e.encode=function(d,h){return h||(h=L.create()),d.key!=null&&Object.hasOwnProperty.call(d,"key")&&h.uint32(10).string(d.key),d.value!=null&&Object.hasOwnProperty.call(d,"value")&&h.uint32(18).string(d.value),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.GroupAttributeMod.AttributeInfo;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.key=d.string();break;case 2:f.value=d.string();break;default:d.skipType(7&g)}}return f},e}(),r}(),JB=t.GroupAttributeDel=function(){function r(e){if(this.attributes=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.group="",r.prototype.broadcast=!1,r.prototype.attributes=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(18).string(e.group),e.broadcast!=null&&Object.hasOwnProperty.call(e,"broadcast")&&d.uint32(24).bool(e.broadcast),e.attributes!=null&&e.attributes.length)for(var h=0;h<e.attributes.length;++h)d.uint32(34).string(e.attributes[h]);return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeDel;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.group=e.string();break;case 3:h.broadcast=e.bool();break;case 4:h.attributes&&h.attributes.length||(h.attributes=[]),h.attributes.push(e.string());break;default:e.skipType(7&f)}}return h},r}(),KB=t.GroupAttributeAlt=function(){function r(e){if(this.attributeMaps=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.group="",r.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.attributeMaps=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(18).string(e.group),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(24).uint64(e.instance),e.attributeMaps!=null&&e.attributeMaps.length)for(var h=0;h<e.attributeMaps.length;++h)t.GroupAttributeAlt.AttributeMap.encode(e.attributeMaps[h],d.uint32(34).fork()).ldelim();return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeAlt;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.group=e.string();break;case 3:h.instance=e.uint64();break;case 4:h.attributeMaps&&h.attributeMaps.length||(h.attributeMaps=[]),h.attributeMaps.push(t.GroupAttributeAlt.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},r.AttributeMap=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(d,h){return h||(h=L.create()),d.key!=null&&Object.hasOwnProperty.call(d,"key")&&h.uint32(10).string(d.key),d.value!=null&&Object.hasOwnProperty.call(d,"value")&&h.uint32(18).string(d.value),d.origin!=null&&Object.hasOwnProperty.call(d,"origin")&&h.uint32(26).string(d.origin),d.ms!=null&&Object.hasOwnProperty.call(d,"ms")&&h.uint32(32).uint64(d.ms),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.GroupAttributeAlt.AttributeMap;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.key=d.string();break;case 2:f.value=d.string();break;case 3:f.origin=d.string();break;case 4:f.ms=d.uint64();break;default:d.skipType(7&g)}}return f},e}(),r}(),LB=t.GroupAttributeRsp=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeRsp;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;default:e.skipType(7&f)}}return h},r}(),MB=t.GroupAttributeErr=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.code=0,r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&d.uint32(16).uint32(e.code),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeErr;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.code=e.uint32();break;default:e.skipType(7&f)}}return h},r}(),NB=t.GroupAttributeKeysGet=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.group="",r.encode=function(e,d){return d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.group!=null&&Object.hasOwnProperty.call(e,"group")&&d.uint32(18).string(e.group),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeKeysGet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.group=e.string();break;default:e.skipType(7&f)}}return h},r}(),OB=t.GroupAttributeKeysRet=function(){function r(e){if(this.keys=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.keys=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.keys!=null&&e.keys.length)for(var h=0;h<e.keys.length;++h)d.uint32(18).string(e.keys[h]);return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.GroupAttributeKeysRet;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.keys&&h.keys.length||(h.keys=[]),h.keys.push(e.string());break;default:e.skipType(7&f)}}return h},r}(),PB=t.SubscribeUserStatus=function(){function r(e){if(this.users=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.users=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.users!=null&&e.users.length)for(var h=0;h<e.users.length;++h)d.uint32(18).string(e.users[h]);return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.SubscribeUserStatus;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.users&&h.users.length||(h.users=[]),h.users.push(e.string());break;default:e.skipType(7&f)}}return h},r}(),QB=t.UnsubscribeUserStatus=function(){function r(e){if(this.users=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.users=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.users!=null&&e.users.length)for(var h=0;h<e.users.length;++h)d.uint32(18).string(e.users[h]);return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UnsubscribeUserStatus;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.users&&h.users.length||(h.users=[]),h.users.push(e.string());break;default:e.skipType(7&f)}}return h},r}(),RB=t.UserJoinNotice=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.user="",r.encode=function(e,d){return d||(d=L.create()),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(8).uint64(e.instance),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(16).uint64(e.seq),e.user!=null&&Object.hasOwnProperty.call(e,"user")&&d.uint32(26).string(e.user),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserJoinNotice;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.instance=e.uint64();break;case 2:h.seq=e.uint64();break;case 3:h.user=e.string();break;default:e.skipType(7&f)}}return h},r}(),SB=t.UserQuitNotice=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.user="",r.encode=function(e,d){return d||(d=L.create()),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(8).uint64(e.instance),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(16).uint64(e.seq),e.user!=null&&Object.hasOwnProperty.call(e,"user")&&d.uint32(26).string(e.user),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserQuitNotice;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.instance=e.uint64();break;case 2:h.seq=e.uint64();break;case 3:h.user=e.string();break;default:e.skipType(7&f)}}return h},r}(),TB=t.UserWaitNotice=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.user="",r.encode=function(e,d){return d||(d=L.create()),e.instance!=null&&Object.hasOwnProperty.call(e,"instance")&&d.uint32(8).uint64(e.instance),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(16).uint64(e.seq),e.user!=null&&Object.hasOwnProperty.call(e,"user")&&d.uint32(26).string(e.user),d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.UserWaitNotice;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.instance=e.uint64();break;case 2:h.seq=e.uint64();break;case 3:h.user=e.string();break;default:e.skipType(7&f)}}return h},r}(),UB=t.SubscribeResponse=function(){function r(e){if(this.errors=[],e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,r.prototype.errors=q.emptyArray,r.encode=function(e,d){if(d||(d=L.create()),e.seq!=null&&Object.hasOwnProperty.call(e,"seq")&&d.uint32(8).uint64(e.seq),e.errors!=null&&e.errors.length)for(var h=0;h<e.errors.length;++h)t.SubscribeResponse.SubscribeErrorsType.encode(e.errors[h],d.uint32(18).fork()).ldelim();return d},r.decode=function(e,d){e instanceof u||(e=u.create(e)),d=d===void 0?e.len:e.pos+d;for(var h=new t.SubscribeResponse;e.pos<d;){var f=e.uint32();switch(f>>>3){case 1:h.seq=e.uint64();break;case 2:h.errors&&h.errors.length||(h.errors=[]),h.errors.push(t.SubscribeResponse.SubscribeErrorsType.decode(e,e.uint32()));break;default:e.skipType(7&f)}}return h},r.SubscribeErrorsType=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.account="",e.prototype.code=0,e.encode=function(d,h){return h||(h=L.create()),d.account!=null&&Object.hasOwnProperty.call(d,"account")&&h.uint32(10).string(d.account),d.code!=null&&Object.hasOwnProperty.call(d,"code")&&h.uint32(16).uint32(d.code),h},e.decode=function(d,h){d instanceof u||(d=u.create(d)),h=h===void 0?d.len:d.pos+h;for(var f=new t.SubscribeResponse.SubscribeErrorsType;d.pos<h;){var g=d.uint32();switch(g>>>3){case 1:f.account=d.string();break;case 2:f.code=d.uint32();break;default:d.skipType(7&g)}}return f},e}(),r}(),VB=Object.freeze({__proto__:null,URI:YA,Wrapper:Oh,Ping:ZA,Pong:$A,UserJoin:aB,UserResp:bB,UserQuit:cB,UserDrop:dB,GroupEnter:eB,GroupLeave:fB,GroupReply:gB,GroupLeaveNotice:ur,GroupEnterNotice:vr,Message:wr,Ack:xr,FileUploadIndexGet:hB,FileUploadIndexRet:iB,FileUploadIndexSet:jB,FileUploadIndexFin:kB,FileUploadIndexErr:lB,FileDownloadIndexGet:mB,FileDownloadIndexRet:nB,FileDownloadIndexErr:oB,GroupAllUsersList:pB,GroupAllUsersResult:qB,UserStatusList:rB,UserStatusResult:sB,UserAttributeGet:tB,UserAttributeRet:uB,UserAttributeSet:vB,UserAttributeMod:wB,UserAttributeDel:xB,UserAttributeErr:yB,UserAttributeKeysGet:zB,UserAttributeKeysRet:AB,UserAttributeRsp:BB,GroupStatusList:CB,GroupStatusResult:DB,GroupCountNotice:EB,GroupAttributeGet:FB,GroupAttributeRet:GB,GroupAttributeSet:HB,GroupAttributeMod:IB,GroupAttributeDel:JB,GroupAttributeAlt:KB,GroupAttributeRsp:LB,GroupAttributeErr:MB,GroupAttributeKeysGet:NB,GroupAttributeKeysRet:OB,SubscribeUserStatus:PB,UnsubscribeUserStatus:QB,UserJoinNotice:RB,UserQuitNotice:SB,UserWaitNotice:TB,SubscribeResponse:UB,default:t}),WB=Math.ceil,yr=function(r){return function(e,d,h){var f=(e=String(jb(e))).length;return h=h===void 0?" ":String(h),(d=ta(d))<=f||h==""?e:(d-=f,(f=Pn.call(h,WB(d/h.length))).length>d&&(f=f.slice(0,d)),r?e+f:f+e)}},XB=yr(!1),YB=yr(!0),zr=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(De);N({target:"String",proto:!0,forced:zr},{padEnd:function(r){return YB(this,r,1<arguments.length?arguments[1]:void 0)}});var ZB=zf,Ar=function(r){return function(e){e=qb(e);for(var d,h=Dc(e),f=h.length,g=0,C=[];f>g;)d=h[g++],ka&&!ZB.call(e,d)||C.push(r?[d,e[d]]:e[d]);return C}},$B=Ar(!0),aC=Ar(!1);N({target:"Object",stat:!0},{entries:function(r){return $B(r)}});var bC=Fb.f,Br="".endsWith,cC=Math.min,Cr=dk("endsWith"),dC=!Cr&&!!function(){var r=bC(String.prototype,"endsWith");return r&&!r.writable}();N({target:"String",proto:!0,forced:!dC&&!Cr},{endsWith:function(r){var e=String(jb(this));ck(r);var d=1<arguments.length?arguments[1]:void 0,h=ta(e.length);return d=d===void 0?h:cC(ta(d),h),h=String(r),Br?Br.call(e,h,d):e.slice(d-h.length,d)===h}}),dh("match",1,function(r,e,d){return[function(h){var f=jb(this),g=h==null?void 0:h[r];return g!==void 0?g.call(h,f):new RegExp(h)[r](String(f))},function(h){var f=d(e,h,this);if(f.done)return f.value;if(h=va(h),f=String(this),!h.global)return Ke(h,f);var g=h.unicode;h.lastIndex=0;for(var C,P=[],x=0;(C=Ke(h,f))!==null;)C=String(C[0]),P[x]=C,C===""&&(h.lastIndex=xj(f,ta(h.lastIndex),g)),x++;return x===0?null:P}]});var eC=Fb.f,Dr="".startsWith,fC=Math.min,Er=dk("startsWith"),gC=!Er&&!!function(){var r=eC(String.prototype,"startsWith");return r&&!r.writable}();N({target:"String",proto:!0,forced:!gC&&!Er},{startsWith:function(r){var e=String(jb(this));ck(r);var d=ta(fC(1<arguments.length?arguments[1]:void 0,e.length)),h=String(r);return Dr?Dr.call(e,h,d):e.slice(d,d+h.length)===h}});var Nm=function(r){var e=/(%?)(%([jds]))/g,d=Array.prototype.slice.call(arguments,1);return d.length&&(r=r.replace(e,function(h,f,g,C){switch(g=d.shift(),C){case"s":g=""+g;break;case"d":g=Number(g);break;case"j":g=JSON.stringify(g)}return f?(d.unshift(g),h):g})),d.length&&(r+=" "+d.join(" ")),""+(r=r.replace(/%{2,2}/g,"%"))},hC=/\s/,iC=function(r){for(var e=r.length;e--&&hC.test(r.charAt(e)););return e},jC=/^\s+/,Fr=NaN,kC=/^[-+]0x[0-9a-f]+$/i,lC=/^0b[01]+$/i,mC=/^0o[0-7]+$/i,nC=parseInt,gl=function(r){if(typeof r=="number")return r;if(ie(r))return Fr;if(lb(r)&&(r=typeof r.valueOf=="function"?r.valueOf():r,r=lb(r)?r+"":r),typeof r!="string")return r===0?r:+r;r=r&&r.slice(0,iC(r)+1).replace(jC,"");var e=lC.test(r);return e||mC.test(r)?nC(r.slice(2),e?2:8):kC.test(r)?Fr:+r},oC=Math.max,pC=Math.min,qC=function(r,e,d){function h(_h){var rE=x,aE=B;return x=B=void 0,_i=_h,Vt=r.apply(aE,rE)}function f(_h){var rE=_h-_e;return _h-=_i,_e===void 0||rE>=e||0>rE||kc&&_h>=_l}function g(){var _h=Cb.Date.now();if(f(_h))return C(_h);var rE=setTimeout,aE=_h-_i;_h=e-(_h-_e),aE=kc?pC(_h,_l-aE):_h,_r=rE(g,aE)}function C(_h){return _r=void 0,_d&&x?h(_h):(x=B=void 0,Vt)}function P(){var _h=Cb.Date.now(),rE=f(_h);if(x=arguments,B=this,_e=_h,rE){if(_r===void 0)return _i=_h=_e,_r=setTimeout(g,e),_a?h(_h):Vt;if(kc)return clearTimeout(_r),_r=setTimeout(g,e),h(_e)}return _r===void 0&&(_r=setTimeout(g,e)),Vt}var x,B,Vt,_r,_e,_i=0,_a=!1,kc=!1,_d=!0;if(typeof r!="function")throw new TypeError("Expected a function");if(e=gl(e)||0,lb(d)){_a=!!d.leading;var _l=(kc="maxWait"in d)?oC(gl(d.maxWait)||0,e):_l;_d="trailing"in d?!!d.trailing:_d}return P.cancel=function(){_r!==void 0&&clearTimeout(_r),_i=0,x=_e=B=_r=void 0},P.flush=function(){return _r===void 0?Vt:C(Cb.Date.now())},P},yc=function(r){function e(h,f){return W(this,e),m(n(h=d.call(this,Mm(h,f))),"originalError",void 0),m(n(h),"code",void 0),m(n(h),"serverCode",void 0),typeof f=="number"?h.code=f:typeof f=="string"?h.name=f:f!==void 0&&(f.originalError&&(h.originalError=f.originalError),f.code!==void 0&&(h.code=f.code),f.serverCode!==void 0&&(h.serverCode=f.serverCode)),h}la(e,r);var d=ma(e);return e}(ef(Error)),Ia=function(r){function e(h,f){return W(this,e),m(n(h=d.call(this,Mm(h,f))),"name","RtmInternalError"),m(n(h),"code",void 0),h.code=f,h}la(e,r);var d=ma(e);return e}(ef(Error)),Ph=function(){return function(r){function e(h){W(this,e);var f=Object.keys(h);return d.call(this,h[f[0]],f[0])}la(e,r);var d=ma(e);return e}(Ia)},Fa=Ph(),db=function(r){function e(){W(this,e);for(var h=arguments.length,f=Array(h),g=0;g<h;g++)f[g]=arguments[g];return m(n(h=d.call.apply(d,[this].concat(f))),"name","RtmTimeoutError"),h}la(e,r);var d=ma(e);return e}(yc),I=function(r){function e(){W(this,e);for(var h=arguments.length,f=Array(h),g=0;g<h;g++)f[g]=arguments[g];return m(n(h=d.call.apply(d,[this].concat(f))),"name","RtmInvalidArgumentError"),h}la(e,r);var d=ma(e);return e}(yc),K=function(r){function e(){W(this,e);for(var h=arguments.length,f=Array(h),g=0;g<h;g++)f[g]=arguments[g];return m(n(h=d.call.apply(d,[this].concat(f))),"name","RtmInvalidStatusError"),h}la(e,r);var d=ma(e);return e}(yc),hl=function(r){function e(){W(this,e);for(var h=arguments.length,f=Array(h),g=0;g<h;g++)f[g]=arguments[g];return m(n(h=d.call.apply(d,[this].concat(f))),"name","RtmInterruptedError"),h}la(e,r);var d=ma(e);return e}(yc),ib=function(r){function e(){W(this,e);for(var h=arguments.length,f=Array(h),g=0;g<h;g++)f[g]=arguments[g];return m(n(h=d.call.apply(d,[this].concat(f))),"name","RtmLimitExceededError"),h}la(e,r);var d=ma(e);return e}(yc),rC=function(r){function e(){W(this,e);for(var h=arguments.length,f=Array(h),g=0;g<h;g++)f[g]=arguments[g];return m(n(h=d.call.apply(d,[this].concat(f))),"name","RtmInvokeTooOftenError"),h}la(e,r);var d=ma(e);return e}(yc),da=function(r){function e(){W(this,e);for(var h=arguments.length,f=Array(h),g=0;g<h;g++)f[g]=arguments[g];return m(n(h=d.call.apply(d,[this].concat(f))),"name","RtmUnavailableError"),m(n(h),"serverCode",void 0),m(n(h),"statusCode",void 0),h}la(e,r);var d=ma(e);return e}(yc),Ye=function(r){function e(){W(this,e);for(var h=arguments.length,f=Array(h),g=0;g<h;g++)f[g]=arguments[g];return m(n(h=d.call.apply(d,[this].concat(f))),"name","RtmUnauthenticatedError"),m(n(h),"serverCode",void 0),h}la(e,r);var d=ma(e);return e}(yc),Wc=function(r){function e(){W(this,e);for(var h=arguments.length,f=Array(h),g=0;g<h;g++)f[g]=arguments[g];return m(n(h=d.call.apply(d,[this].concat(f))),"name","RtmUnknownError"),h}la(e,r);var d=ma(e);return e}(yc),Sa=function(r){return r instanceof db||r instanceof pb},sa=function(r){return r instanceof yc},Yd=function(r,e,d){return['Executing "%s.%s" timed out after %ds',r,e,d/1e3]},Lm=new Map,sC=function(){var r=new Date;return"".concat(r.toISOString().split("T")[1].replace(/\..+/,""),".").concat(r.getMilliseconds())},xf=Object.keys,Hg=Object.entries.bind(Object),Cg=function(r){return typeof r=="string"?r.endsWith(".")?r:"".concat(r,"."):r},Sm=function(r){for(var e="",d=(r=new Uint8Array(r)).byteLength,h=-1;++h<d;)e+=String.fromCharCode(r[h]);return e=btoa(e),"data:;base64,".concat(e)},tC=R(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1});N({target:"Date",proto:!0,forced:tC},{toJSON:function(r){r=Qa(this);var e=lc(r);return typeof e!="number"||isFinite(e)?r.toISOString():null}}),N({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var $t=Object.prototype.hasOwnProperty,Gr=function(r,e,d){return JSON.stringify(Ym(r),e,d)};Gr.ensureProperties=Ym;var uC=function(r,e){e=e||{};var d=X(r);if(d==="string"&&0<r.length)return au(r);if(d==="number"&&isFinite(r))return e.long?r=864e5<=(e=Math.abs(r))?Jg(r,e,864e5,"day"):36e5<=e?Jg(r,e,36e5,"hour"):6e4<=e?Jg(r,e,6e4,"minute"):1e3<=e?Jg(r,e,1e3,"second"):r+" ms":r=864e5<=(e=Math.abs(r))?Math.round(r/864e5)+"d":36e5<=e?Math.round(r/36e5)+"h":6e4<=e?Math.round(r/6e4)+"m":1e3<=e?Math.round(r/1e3)+"s":r+"ms",r;throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))},vC=function(r){function e(f){function g(){for(var x=arguments.length,B=Array(x),Vt=0;Vt<x;Vt++)B[Vt]=arguments[Vt];if(g.enabled){x=Number(new Date),g.diff=x-(C||x),g.prev=C,C=g.curr=x,B[0]=e.coerce(B[0]),typeof B[0]!="string"&&B.unshift("%O");var _r=0;B[0]=B[0].replace(/%([a-zA-Z%])/g,function(_e,_i){return _e==="%%"?"%":(_r++,typeof(_i=e.formatters[_i])=="function"&&(_e=_i.call(g,B[_r]),B.splice(_r,1),_r--),_e)}),e.formatArgs.call(g,B),(g.log||e.log).apply(g,B)}}var C,P=null;return g.namespace=f,g.useColors=e.useColors(),g.color=e.selectColor(f),g.extend=d,g.destroy=e.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:function(){return P===null?e.enabled(f):P},set:function(x){P=x}}),typeof e.init=="function"&&e.init(g),g}function d(f,g){return(f=e(this.namespace+(g===void 0?":":g)+f)).log=this.log,f}function h(f){return f.toString().substring(2,f.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(f){return f instanceof Error?f.stack||f.message:f},e.disable=function(){var f=[].concat(G(e.names.map(h)),G(e.skips.map(h).map(function(g){return"-"+g}))).join(",");return e.enable(""),f},e.enable=function(f){e.save(f),e.names=[],e.skips=[];var g,C=(typeof f=="string"?f:"").split(/[\s,]+/),P=C.length;for(g=0;g<P;g++)C[g]&&((f=C[g].replace(/\*/g,".*?"))[0]==="-"?e.skips.push(new RegExp("^"+f.substr(1)+"$")):e.names.push(new RegExp("^"+f+"$")))},e.enabled=function(f){if(f[f.length-1]==="*")return!0;var g,C=0;for(g=e.skips.length;C<g;C++)if(e.skips[C].test(f))return!1;for(C=0,g=e.names.length;C<g;C++)if(e.names[C].test(f))return!0;return!1},e.humanize=uC,e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(r).forEach(function(f){e[f]=r[f]}),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(f){for(var g=0,C=0;C<f.length;C++)g=(g<<5)-g+f.charCodeAt(C),g|=0;return e.colors[Math.abs(g)%e.colors.length]},e.enable(e.load()),e},Hr=$a(function(r,e){e.formatArgs=function(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),this.useColors){var f="color: "+this.color;h.splice(1,0,f,"color: inherit");var g=0,C=0;h[0].replace(/%[a-zA-Z%]/g,function(P){P!=="%%"&&(g++,P==="%c"&&(C=g))}),h.splice(C,0,f)}},e.save=function(h){try{h?e.storage.setItem("debug",h):e.storage.removeItem("debug")}catch{}},e.load=function(){try{var h=e.storage.getItem("debug")}catch{}return!h&&typeof process<"u"&&"env"in process&&(h={}.DEBUG),h},e.useColors=function(){return!(typeof window>"u"||!window.process||window.process.type!=="renderer"&&!window.process.__nwjs)||(typeof navigator>"u"||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};t:{try{var d=localStorage;break t}catch{}d=void 0}e.storage=d,e.destroy=function(){var h=!1;return function(){h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),e.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),e.log=console.debug||console.log||function(){},r.exports=vC(e),r.exports.formatters.j=function(h){try{return JSON.stringify(h)}catch(f){return"[UnexpectedJSONParseError]: "+f.message}}}),Ir=Hr("RTM:DEBUG"),Ze;Ir.enabled=!1,function(r){r[r.Uploading=0]="Uploading",r[r.Free=1]="Free"}(Ze||(Ze={}));var wC=function(){function r(e){W(this,r),m(this,"uploadRequest",void 0),m(this,"uploadState",void 0),m(this,"uploadResendCount",void 0),m(this,"LogCache",void 0),m(this,"LogsToPost",void 0),m(this,"processId",void 0),m(this,"sdkVersion",void 0),m(this,"logId",void 0),m(this,"rtmConfig",void 0),this.processId=e.processId,this.sdkVersion=e.sdkVersion,this.rtmConfig=e.rtmConfig,this.uploadRequest=e.uploadRequest,this.uploadState=Ze.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return Ha(r,[{key:"upload",value:function(e){this.LogCache.push(e),this.uploadState===Ze.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(e){var d=this;this.uploadState=Ze.Uploading,setTimeout(J(w.mark(function h(){var f,g,C;return w.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return f={sdk_version:d.sdkVersion,process_id:d.processId,payload:JSON.stringify(e)},P.prev=1,P.next=4,d.uploadRequest(f,(g=d.rtmConfig.enableCloudProxy)!==null&&g!==void 0&&g);case 4:if(!Uk){P.next=6;break}throw Error("RTM is busy");case 6:P.next=13;break;case 8:return P.prev=8,P.t0=P.catch(1),C=2>d.uploadResendCount++?2e3:1e4,setTimeout(function(){return d.postLog(d.LogsToPost)},C),P.abrupt("return");case 13:if(Ir('The logs uploaded for "process-'.concat(gg,'"')),d.LogCache.length!==0){P.next=17;break}return d.uploadState=Ze.Free,P.abrupt("return");case 17:d.uploadResendCount=0,d.LogsToPost=40>d.LogCache.length?d.LogCache.splice(0,d.LogCache.length):d.LogCache.splice(0,40),d.postLog(d.LogsToPost);case 20:case"end":return P.stop()}},h,null,[[1,8]])})),Zd.getParameter("LOG_UPLOAD_INTERVAL"))}}]),r}(),Jr=function(r,e,d,h,f,g,C,P){var x=0;for(C=!!C&&Id(C,P,3);x<h;){if(x in d){if(P=C?C(d[x],x,e):d[x],0<g&&gd(P))f=Jr(r,e,P,ta(P.length),f,g-1)-1;else{if(9007199254740991<=f)throw TypeError("Exceed the acceptable array length");r[f]=P}f++}x++}return f},xC=Jr;N({target:"Array",proto:!0},{flat:function(){var r=arguments.length?arguments[0]:void 0,e=Qa(this),d=ta(e.length),h=Sg(e,0);return h.length=xC(h,e,e,d,0,r===void 0?1:$b(r)),h}}),N({target:"Object",stat:!0},{values:function(r){return aC(r)}});var yC=["CODE"],Db,ud,F;(function(r){r.CHINA="CN",r.ASIA="AS",r.NORTH_AMERICA="NA",r.EUROPE="EU",r.JAPAN="JP",r.INDIA="IN",r.OCEANIA="OC",r.SOUTH_AMERICA="SA",r.AFRICA="AF",r.OVERSEA="OVERSEA",r.GLOBAL="GLOBAL"})(F||(F={}));var zC={CN:F.CHINA,NA:F.NORTH_AMERICA,EU:F.EUROPE,AS:F.ASIA,JP:F.JAPAN,IN:F.INDIA,GLOB:F.GLOBAL,AF:F.AFRICA,OC:F.OVERSEA,OVS:F.OVERSEA,SA:F.SOUTH_AMERICA},Kg=Wm((Db={},m(Db,F.ASIA,{CODE:F.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.NORTH_AMERICA,{CODE:F.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.EUROPE,{CODE:F.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.JAPAN,{CODE:F.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.INDIA,{CODE:F.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OVERSEA,{CODE:F.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),m(Db,F.GLOBAL,{CODE:F.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OCEANIA,{CODE:F.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.SOUTH_AMERICA,{CODE:F.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.AFRICA,{CODE:F.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.CHINA,{CODE:F.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),Db)),yf=(ud={},m(ud,F.ASIA,[F.CHINA,F.JAPAN,F.INDIA]),m(ud,F.EUROPE,[]),m(ud,F.NORTH_AMERICA,[]),m(ud,F.SOUTH_AMERICA,[]),m(ud,F.OCEANIA,[]),m(ud,F.AFRICA,[]),ud),Kr=[F.OVERSEA,F.GLOBAL,F.CHINA,F.NORTH_AMERICA,F.EUROPE,F.ASIA,F.JAPAN,F.INDIA,F.OCEANIA,F.SOUTH_AMERICA,F.AFRICA],Zm=function(r){return Object.values(yf).flat().includes(r)},cu=function(r){var e;return(e=Hg(yf).find(function(d){return(d=ra(d,2))[0],d[1].includes(r)}))===null||e===void 0?void 0:e[0]},AC=function(r){return r.sort(function(e,d){return Kr.indexOf(e)-Kr.indexOf(d)})},xe=function(r){var e=new Set;if((r=AC(r).slice(0,3).map(function(d){var h=Kg[d];if(h===void 0)throw new Ia("invalid area key");return d=h.CODE,h=ff(h,yC),e.add(d),h})).length===0)throw new Ia("areas cannot be empty");return ua({CODES:e},r.reduce(function(d,h){for(var f=0,g=Hg(d);f<g.length;f++){var C=ra(g[f],2),P=C[0];C=C[1],d[P]=Array.from(new Set([].concat(G(h[P]),G(C))))}return d}))},M,Lr=function(){var r=J(w.mark(function e(d,h){var f,g,C,P,x,B=arguments;return w.wrap(function(Vt){for(;;)switch(Vt.prev=Vt.next){case 0:if(!(2<(g=2<B.length&&B[2]!==void 0?B[2]:0))){Vt.next=3;break}return Vt.abrupt("return");case 3:return C={withCredentials:!0,body:d,timeout:2e4},P=0<g?(M==null?void 0:M.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(M==null?void 0:M.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",x=h?"https://".concat((f=M==null?void 0:M.PROXY_NGINX[0])!==null&&f!==void 0?f:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(P,"&p=443&d=upload/v1"):"https://".concat(P,"/upload/v1"),Vt.next=8,te(x,C).catch(function(_r){return Lr(d,h,g+1)});case 8:case"end":return Vt.stop()}},e)}));return function(e,d){return r.apply(this,arguments)}}(),Mr=new wC({processId:"process-".concat(gg),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.4.3-17-g1e27aa38"),uploadRequest:Lr,rtmConfig:{}}),il="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),Nr="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),Or="serverReceivedTs isOfflineMessage enableHistoricalMessaging enableOfflineMessaging hasPeerReceived messageType enableNotificationToChannelMembers lastUpdateTs".split(" "),BC="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),ye=function(r){if(typeof r=="string")return oa(r);if(Array.isArray(r)&&r.every(function(g){return typeof g=="string"}))return r.map(function(g){return oa(g)});if(!Il(r)){for(var e={},d=0;d<Or.length;d++){var h=Or[d];h in r&&(e[h]=r[h])}if(0<Object.keys(e).length)return e;if(5>Object.keys(r).length){for(d=0,r=Object.entries(r);d<r.length;d++){var f=ra(r[d],2);h=f[0],f=f[1],il.includes(h)?e[h]="[Hidden Info]":e[oa(h)]=typeof f=="string"?oa(f):"[Sensitive Info]"}return e}return"[Sensitive Info]"}return r},Pr=function(r){return X(r)==="object"?yd(r)?Vm(fe(r,5),il,Nr):r.constructor&&r.constructor.name:r},Qr=function(r,e){return r instanceof Error?r.message:typeof r!="string"?JSON.stringify(Vm(fe(r,5),il,Nr)):(e=e.map(function(d){return d instanceof Error?d.message:X(d)==="object"?Gr(Array.isArray(d)?d.map(Pr):Pr(d)):d}),Nm.apply(void 0,[r.replace(/%[%Oo]/g,function(d){return d==="%%"?"%":d==="%o"||d==="%O"?"%s":d})].concat(G(e))))},CC=1,Rr=function(r,e,d){var h=Hr(r);return h.enabled=!0,h.log=d,h.useColors=!1,function(f){for(var g=arguments.length,C=Array(1<g?g-1:0),P=1;P<g;P++)C[P-1]=arguments[P];if(e.enableLogUpload){g=Cg(f);var x=Qr(g,C);Mr.upload({log_item_id:"".concat(CC++),log_level:r,payload_str:"[".concat(sC(),"] ").concat(r," - ").concat(256<x.length?x.slice(0,256):x)})}switch(g=function(B){var Vt=x||Qr(Cg(f),C),_r=Nc.LOG_HANDLER;typeof _r=="function"&&_r({level:B,message:Vt}),h(Vt)},r){case"RTM:INFO":e.logFilter.info&&g("log");break;case"RTM:WARN":e.logFilter.warn&&g("warning");break;case"RTM:ERROR":e.logFilter.error&&g("error");break;case"RTM:TRACK":e.logFilter.track&&g("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":e.logFilter.debug&&g("debug");break;case"RTM:DEBUG":e.logFilter.debug&&g("debug")}}},jl,Sr=function(r){return function(e){var d=jl===1||r===void 0?"":"Ins#".concat(r," ");return"".concat(d).concat(e)}},kl=function(r,e,d){var h=Sr(jl);return Rr("RTM:".concat(e),d,function(f){return r(h(f))})},tb=function(){return function(r){function e(h,f){var g=2<arguments.length&&arguments[2]!==void 0&&arguments[2];W(this,e);var C=d.call(this);if(m(n(C),"logError",void 0),m(n(C),"invokeTracker",void 0),m(n(C),"resultTracker",void 0),m(n(C),"errorTracker",void 0),m(n(C),"eventTracker",void 0),m(n(C),"info",void 0),m(n(C),"warn",void 0),m(n(C),"log",void 0),m(n(C),"genLogger",void 0),m(n(C),"loggerId",void 0),m(n(C),"logger",void 0),m(n(C),"name",void 0),C.logger=h,C.name=f,C.loggerId=h.loggerId,C.info=h.info,C.warn=h.warn,C.logError=h.logError,C.genLogger=h.genLogger,C.log=h.genLogger("RTM:DEBUG","<".concat(f,"> ")),C.invokeTracker=h.genTracker("Invoke"),C.eventTracker=h.genTracker("Event"),C.resultTracker=h.genTracker("Result"),C.errorTracker=h.genTracker("Error"),g){var P=C.emit.bind(n(C));C.emit=function(){for(var x=arguments.length,B=Array(x),Vt=0;Vt<x;Vt++)B[Vt]=arguments[Vt];x=B[0],Vt=B.slice(1);var _r=BC.includes(x);C.eventTracker.apply(C,["%s: ".concat(0<Vt.length?"%s emitted with args: ".concat(Vt.map(function(){return"%o"})):"%s emitted"),f,x].concat(G(_r?Vt.map(ye):Vt)));try{P.apply(void 0,B)}catch(_e){C.logError("Caught in the callback function of the event %s",x,_e)}}}return C}la(e,r);var d=ma(e);return e}(ea)},DC=function(r){return kl(console.log.bind(console),"INFO",r)},EC=function(r){return kl(console.warn.bind(console),"WARN",r)},FC=function(r){return kl(console.error.bind(console),"ERROR",r)},Tr=function(r,e){return function(d){var h=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"",f=Sr(r),g=console.debug.bind(console),C=Rr(d,e,function(P){return g(f(P))});return function(P){for(var x=arguments.length,B=Array(1<x?x-1:0),Vt=1;Vt<x;Vt++)B[Vt-1]=arguments[Vt];return C.apply(void 0,[h+P].concat(B))}}},GC=function(r,e){return function(d){return Tr(r,e)("RTM:TRACK","[".concat(d,"] "))}},Li=t.URI,eu=Oh,HC=ff(VB,["Wrapper"]),$m=Gk(HC,"URI"),Ur=function(r,e){var d=-1,h=r.length,f=h-1;for(e=e===void 0?h:e;++d<e;){var g=r[h=nr(d,f)];r[h]=r[d],r[d]=g}return r.length=e,r},IC=function(r){return Ur(Xh(r))},JC=function(r){return Ur(Ni(r))},$e=function(r){return(Va(r)?IC:JC)(r)},af={0:9591,1:9593},$d=function(r){return"https://".concat(r,"/api/v1")},KC=bb.apply(void 0,G($e(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map($d)))),LC=bb.apply(void 0,G($e(["ap-web-1.agora.io","ap-web-2.agora.io"].map($d)))),MC=bb.apply(void 0,G($e(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map($d)))),NC=bb.apply(void 0,G($e(["ap-web-3.agora.io","ap-web-4.agora.io"].map($d)))),ll=Ph(),ml=function(r){function e(h,f,g,C,P,x){W(this,e);var B=d.call(this,P,Ai("Socket-",P.loggerId));if(m(n(B),"isActiveClose",!1),m(n(B),"loggedIn",!1),m(n(B),"useNewDomain",void 0),m(n(B),"receivedPacket",new Pa),m(n(B),"open$",void 0),m(n(B),"input$",new Pa),m(n(B),"userJoin$",new Pa),m(n(B),"attemptsSinceLastError",0),m(n(B),"message$",new Pa),m(n(B),"socket$",void 0),m(n(B),"toClose",new Pa),m(n(B),"toReconnect",new Pa),m(n(B),"sendLogger",void 0),m(n(B),"receiveLogger",void 0),m(n(B),"ip",void 0),m(n(B),"env",void 0),m(n(B),"ticket",void 0),m(n(B),"context",void 0),m(n(B),"getDomain",function(){return an(B.ip,B.useNewDomain)}),m(n(B),"socketReconnector",function(_e){var _i=function(_a){return B.attemptsSinceLastError+=1,B.warn("The %s of Env %d reconnecting %s",B.name,B.env,_a.message),Bc(3e3)};return _e.pipe(Ga(function(_a){return B.log("socket connection closed"),B.loggedIn=!1,2<=B.attemptsSinceLastError?(B.warn("socket connection failure"),B.emit("connectionFailure"),B.close(),Z(_a)):B.isActiveClose?vb:(B.emit("reconnect"),B.useNewDomain=!B.useNewDomain,Z(_a))}),oe(function(_a){return _a.pipe(Cc(_i))}))}),B.ip=h,B.env=f,B.ticket=g,B.context=C,B.useNewDomain=x??.5<=Math.random(),B.sendLogger=B.genLogger("RTM:MSG:SEND"),B.receiveLogger=B.genLogger("RTM:MSG:RECV"),f!==0&&f!==1)throw new ll({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});if(!Gm(h))throw new ll({IP_NOT_VALID:"The ip from ap is not valid"});var Vt=af[f];B.log("Opening websocket address %s for the Env %d",B.ip,B.env);var _r=Xb(B.input$,B.userJoin$.pipe(Rt(2)),B.message$).pipe(ba(function(_e){return Oh.encode(_e).finish()}));return h=Xb(St("",{protocols:[],makeWebSocket:function(){if(B.context.config.enableCloudProxy){if(B.context.cloudProxyServers.length===0)throw B.logError("No cloud proxy server to connect"),new da;var _e="wss://".concat(an(bn(B.context.cloudProxyServers),!1),"/");_e=we(_e,"sid",B.context.sid),_e=we(_e,"remote_port",Vt.toString()),_e=we(_e,"remote_ip",B.ip),_e=we(_e,"token",B.context.key),_e=new WebSocket(_e)}else _e=new WebSocket("wss://".concat(B.getDomain(),":").concat(Vt));return _e.binaryType="arraybuffer",_e}}),B.toReconnect),B.socket$=Ca(h,Tk.pipe(hb(15e3),Ga(function(_e){return Sa(_e)&&B.warn("socket open timed out"),Z(_e)}))).pipe(ba(function(_e){if(_e instanceof Error)throw B.warn("Env_%d: Force reconnect the socket",B.env),_e;return _e(_r).pipe(ba(function(_i){return Oh.decode(new Uint8Array(_i))}))}),B.socketReconnector),B.open$=B.socket$.pipe(ca(function(_e){B.log("Websocket opened",B.name),_e.subscribe(function(_i){var _a=_i.data;_i=Li[_i.uri].slice(0,-3),_a=$m[_i].decode(_a);var kc=HA({},Gk(_a,"toJSON"),function(rE,aE){return aE instanceof U?Km(aE):aE}),_d=!1;if((_a instanceof vr||_a instanceof ur)&&_a.instance.lessThanOrEqual(4294967295)&&(_d=!0),_a instanceof wr||_a instanceof xr){var _l=_a.instance,_h=_a.sequence;(_a.dialogue.lessThanOrEqual(4294967295)||_l.lessThanOrEqual(4294967295)||_h.lessThan(1))&&(_d=!0)}_d?B.warn("Env_%d: Illegal %s, abandoned %o",B.env,_i,kc):(_i!=="Pong"&&B.receiveLogger("Env_%d: %s %o",B.env,_i,kc),B.receivedPacket.next([_i,_a]))},function(){})}),qf(void 0),ob(B.toClose),pe()),B}la(e,r);var d=ma(e);return Ha(e,[{key:"address",get:function(){return"".concat(this.ip,":").concat(af[this.env])}},{key:"sendPacket",value:function(h,f){if(h!=="Ping"){var g=uc(f,function(C){return C instanceof U?Km(C):C});this.sendLogger("Env_%d: %s %o",this.env,h,g)}f=du(h,f),h==="UserJoin"?this.userJoin$.next(f):h==="Message"?this.message$.next(f):this.input$.next(f)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(h){var f=this;return this.receivedPacket.pipe(ca(function(g){var C=ra(g,2);g=C[0],C=C[1],g==="UserResp"&&(f.attemptsSinceLastError=0,f.loggedIn=!0),g==="UserDrop"&&f.emit("socketUserDrop",C)}),wb(function(g){return ra(g,1)[0]===h}),ba(function(g){return ra(g,2)[1]}))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new ll({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),e}(tb());N({target:"String",proto:!0,forced:zr},{padStart:function(r){return XB(this,r,1<arguments.length?arguments[1]:void 0)}});var OC=function(r){var e=xf(Kg);r=Yt(r);for(var d=0;d<e.length;d++){var h=Kg[e[d]];if(h!=null&&h.AP_DOMAINS.includes(r)||h!=null&&h.AP_BACKUP_DOMAINS.includes(r)||h!=null&&h.PROXY_AP.includes(r))return[h.CODE]}return[F.CHINA,F.GLOBAL]},PC={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},Vr={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},QC=[100,101,102],Qh=/web-(\d)/,Wr=function(r){function e(h,f){var g=2<arguments.length&&arguments[2]!==void 0&&arguments[2];W(this,e);var C=d.call(this,f,"AccessPoint");return m(n(C),"handleUniLbsError",function(P,x){var B=P;if(4<P.toString().length){var Vt=P.toString().padStart(8,"0"),_r=parseInt(Vt.slice(0,4),10);if(Vt=parseInt(Vt.slice(4,8),10),_r===201)B=Vt;else if(_r===101&&!QC.includes(Vt))return Z(Error("service is currently unavailable"))}if(_r=B.toString(),!Object.keys(Vr).includes(_r))return(P=new da(["Login is rejected by the server. The response code is %d",P],jg)).serverCode=B,Z(P);switch(_r=Vr[_r],B=PC[_r],_r){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(x=new Ye(B,$q)).serverCode=P,Z(x);case"INVALID_USER_ID":return(x=new Ye(B,Jh)).serverCode=P,Z(x);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(x=new Ye(B,Kh)).serverCode=P,Z(x);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(x=new Ye(B,ar)).serverCode=P,Z(x);case"CANNOT_MEET_AREA_DEMAND":return(x=OC(x)).forEach(function(_e){return C.failedAreas.add(_e)}),C.failedAreas.size===(M===void 0?2:M.CODES.size)?((x=new I(B,jg)).serverCode=P,Z(x)):Z(Error("ap ".concat(x.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(x=new da(B,jg)).serverCode=P,Z(x);default:return Z(Im("ApResErrType",_r))}}),m(n(C),"getApEdgeInfo$",void 0),m(n(C),"getApEdgeInfoEndFirst$",void 0),m(n(C),"apFinish$",new Pa),m(n(C),"retryCount",0),m(n(C),"failedAreas",new Set),m(n(C),"usedUrl",[]),m(n(C),"newDomainUsed",!1),m(n(C),"backupNewDomainUsed",!1),m(n(C),"genUrl",function(){return M===void 0?mi.apply(void 0,G($e([KC,LC]))).pipe(ni(function(P){return bb.apply(void 0,G(P))})):bb.apply(void 0,G(M.AP_DOMAINS.slice(0,3).map($d)))}),m(n(C),"genBackupUrl",function(){return M===void 0?mi.apply(void 0,G($e([MC,NC]))).pipe(ni(function(P){return bb.apply(void 0,G(P))})):bb.apply(void 0,G(M.AP_BACKUP_DOMAINS.slice(0,3).map($d)))}),m(n(C),"getApUrl$",function(P){var x,B;return C.genUrl().pipe(wb(function(Vt){return(!C.newDomainUsed||!Vt.includes("sd-rtn.com"))&&(Vt.includes("sd-rtn.com")&&(C.newDomainUsed=!0),!dl(C.usedUrl,function(_r){var _e;return _r===((_e=Vt.match(Qh))===null||_e===void 0?void 0:_e[1])}))}),ca(function(Vt){var _r;M===void 0&&typeof(Vt=(_r=Vt.match(Qh))===null||_r===void 0?void 0:_r[1])=="string"&&C.usedUrl.push(Vt)}),Ka(P?Math.max(Nc.RECONNECTING_AP_NUM,(x=M==null?void 0:M.CODES.size)!==null&&x!==void 0?x:0):(B=M==null?void 0:M.CODES.size)!==null&&B!==void 0?B:2),Dd(function(){return e.runOutOfUrlSymbol}),Ga(function(Vt,_r){return C.newDomainUsed=!1,Vt===e.runOutOfUrlSymbol?(C.usedUrl=[],_r):Z(Vt)}))}),m(n(C),"getBackupApUrl$",function(P){var x,B;return C.genBackupUrl().pipe(wb(function(Vt){return(!C.backupNewDomainUsed||!Vt.includes("sd-rtn.com"))&&(Vt.includes("sd-rtn.com")&&(C.backupNewDomainUsed=!0),!dl(C.usedUrl,function(_r){var _e;return _r===((_e=Vt.match(Qh))===null||_e===void 0?void 0:_e[1])}))}),ca(function(Vt){var _r;M===void 0&&typeof(Vt=(_r=Vt.match(Qh))===null||_r===void 0?void 0:_r[1])=="string"&&C.usedUrl.push(Vt)}),Ka(P?Math.max(Nc.RECONNECTING_AP_NUM,(x=M==null?void 0:M.CODES.size)!==null&&x!==void 0?x:0):(B=M==null?void 0:M.CODES.size)!==null&&B!==void 0?B:2),Dd(function(){return e.runOutOfUrlSymbol}),Ga(function(Vt,_r){return C.backupNewDomainUsed=!1,Vt===e.runOutOfUrlSymbol?(C.usedUrl=[],_r):Z(Vt)}))}),m(n(C),"getProxyApUrl$",function(P){var x,B;return bb.apply(void 0,G(((M==null?void 0:M.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map($d))).pipe(Ka(P?Math.max(Nc.RECONNECTING_AP_NUM,(x=M==null?void 0:M.CODES.size)!==null&&x!==void 0?x:0):(B=M==null?void 0:M.CODES.size)!==null&&B!==void 0?B:2))}),m(n(C),"context",void 0),m(n(C),"fetchCloudProxy",function(P,x){var B=Ai("AP-",C.loggerId);C.log("The AccessPoint requests %s(%s)",P,B);var Vt=new AbortController;return C.apFinish$.pipe(Ka(1)).subscribe(function(){return Vt.abort()}),ad(J(w.mark(function _r(){var _e;return w.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:return _e=Ag(0,Number.MAX_SAFE_INTEGER),C.log("%s request opid: %d",B,_e),_i.abrupt("return",te(P,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:C.context.sid,opid:_e,appid:C.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:x??C.context.key,cname:C.context.uid,uid:0,detail:ua({},M===void 0?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(_a){return _a===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):_a}).join(",")})}}]},signal:Vt.signal}));case 3:case"end":return _i.stop()}},_r)}))).pipe(Ga(function(_r){return _r.name!=="AbortError"&&(C.logError(_r),C.warn("The AP server %s request failure",P,_r)),vb}),cb(function(){var _r=J(w.mark(function _e(_i){var _a,kc,_d,_l,_h,rE,aE,yE,gE,bE,GE,Qm,tE,EE,pE,TE,_p,eE,cE;return w.wrap(function(SE){for(;;)switch(SE.prev=SE.next){case 0:if(_a=_i.responseText,kc=JSON.parse(_a),C.log("The %s response is %o",B,kc),((_d=kc.response_body)===void 0||_d.length===0||_d.some(function(AE){var t_;return((t_=AE.buffer)===null||t_===void 0?void 0:t_.code)===void 0||AE.uri!==23}))&&Z(new da("cloud proxy response_body not valid",jg)),(_l=_d.filter(function(AE){return AE.buffer.code!==0})).length===0){SE.next=14;break}if((_h=_l.find(function(AE){return AE.buffer.flag===128}))===void 0){SE.next=12;break}return SE.abrupt("return",C.handleUniLbsError(_h.buffer.code,P));case 12:return C.logError("cloud proxy error response"),SE.abrupt("return",C.handleUniLbsError(_l[0].buffer.code,P));case 14:for(rE=[],aE=0;aE<_d.length;aE++)if(((bE=_d[aE])==null||(yE=bE.buffer)===null||yE===void 0?void 0:yE.flag)===262144)(GE=bE.buffer)===null||GE===void 0||(Qm=GE.edges_services)===null||Qm===void 0||(tE=Qm.forEach)===null||tE===void 0||tE.call(Qm,function(AE){Gm(AE=AE.ip)&&C.context.cloudProxyServers.indexOf(AE)===-1&&(C.log("got cloud proxy server: %s",AE),C.context.cloudProxyServers.push(AE))});else if((bE==null||(gE=bE.buffer)===null||gE===void 0?void 0:gE.flag)===128){for(_p=function(AE,t_){var PE=t_[AE];rE.some(function(v_){return v_.ip===PE.ip})||rE.push({ip:PE.ip,ticket:bE.buffer.cert})},eE=0,cE=bE.buffer.edges_services;eE<cE.length;eE++)_p(eE,cE);C.context.rtmArea=(EE=(pE=bE.buffer)===null||pE===void 0||(TE=pE.detail)===null||TE===void 0?void 0:TE[9])!==null&&EE!==void 0?EE:""}return SE.abrupt("return",bb.apply(void 0,G(rE).concat([fg])));case 19:case"end":return SE.stop()}},_e)}));return function(_e){return _r.apply(this,arguments)}}()),Ga(function(_r){return sa(_r)?Z(_r):vb}),tg(),wb(function(_r){return _r!==void 0&&typeof _r.ip=="string"&&typeof _r.ticket=="string"}))}),m(n(C),"fetchAp",function(P,x){var B=Ai("AP-",C.loggerId);C.log("The AccessPoint requests %s(%s)",P,B);var Vt=new AbortController;return C.apFinish$.pipe(Ka(1)).subscribe(function(){return Vt.abort()}),ad(J(w.mark(function _r(){var _e;return w.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:return _e=Ag(0,Number.MAX_SAFE_INTEGER),C.log("%s request opid: %d",B,_e),_i.abrupt("return",te(P,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:_e,key:x||C.context.key,cname:C.context.uid,detail:ua({},M===void 0?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(_a){return _a===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):_a}).join(",")}),uid:0,sid:C.context.sid},signal:Vt.signal}));case 3:case"end":return _i.stop()}},_r)}))).pipe(Ga(function(_r){return _r.name!=="AbortError"&&(C.logError(_r),C.warn("The AP server %s request failure",P,_r)),vb}),cb(function(){var _r=J(w.mark(function _e(_i){var _a,kc,_d,_l,_h,rE,aE;return w.wrap(function(yE){for(;;)switch(yE.prev=yE.next){case 0:if(_a=_i.responseText,kc=JSON.parse(_a),C.log("The %s response is %o",B,kc),_l=(_d=kc).code,_h=_d.addresses,rE=_d.detail,_l===0){yE.next=6;break}return yE.abrupt("return",C.handleUniLbsError(_l,P));case 6:if((aE=_h).length!==0){yE.next=11;break}return yE.abrupt("return",Z(Error("No available edge address to connect")));case 11:return C.context.rtmArea=rE==null?void 0:rE[9],yE.abrupt("return",bb.apply(void 0,G(aE).concat([fg])));case 13:case"end":return yE.stop()}},_e)}));return function(_e){return _r.apply(this,arguments)}}()),tg(),Ga(function(_r){return sa(_r)?Z(_r):vb}),wb(function(_r){return _r!==void 0&&typeof _r.ip=="string"&&typeof _r.ticket=="string"}))}),C.context=h,C.getApEdgeInfoEndFirst$=function(){var P=0<arguments.length&&arguments[0]!==void 0&&arguments[0];return Bc(0,P||g?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(1),ca(function(){C.retryCount+=1}),cb(function(){return C.context.config.enableCloudProxy?C.getProxyApUrl$(P||g):(4<=C.retryCount&&(C.retryCount=0),3>=C.retryCount?C.getApUrl$(P||g):C.getBackupApUrl$(P||g))}),cb(function(x){return C.context.config.enableCloudProxy?C.fetchCloudProxy(x):C.fetchAp(x)}),Ga(function(x){return x instanceof pb&&C.warn("AP request timeout"),Z(x)}),om(function(x){return x.ip}),ob(C.apFinish$))},C.getApEdgeInfo$=function(P){return Bc(0,P||g?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(8),ca(function(){C.retryCount+=1}),cb(function(){return C.context.config.enableCloudProxy?C.getProxyApUrl$(P||g):3>=C.retryCount?C.getApUrl$(P||g):C.getBackupApUrl$(P||g)}),cb(function(x){return(C.context.config.enableCloudProxy?C.fetchCloudProxy(x):C.fetchAp(x)).pipe()}),Ga(function(x){return x instanceof pb&&C.warn("AP request timeout"),Z(x)}),om(function(x){return x.ip}),ob(C.apFinish$))},C}la(e,r);var d=ma(e);return Ha(e,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),e}(tb());m(Wr,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var Xr=Ph(),Yr=function(r){function e(h,f,g){W(this,e);var C=d.call(this,f,"Connection");m(n(C),"apClient",void 0),m(n(C),"lastOpenSockets",[new qe(1),new qe(1)]),m(n(C),"curOpenSockets",[void 0,void 0]),m(n(C),"ipIterator",0),m(n(C),"firstEnv",.5<=Math.random()?1:0),m(n(C),"firstSocketOpener",void 0),m(n(C),"secondSocketOpener",void 0),m(n(C),"firstOpenKeeperSubject",new Pa),m(n(C),"secondOpenKeeperSubject",new Pa),m(n(C),"edgeInfoReplayed",void 0),m(n(C),"firstEnvOpenSocket",void 0),m(n(C),"firstOpenKeeperSub",void 0),m(n(C),"secondOpenKeeperSub",void 0),m(n(C),"context",void 0),m(n(C),"logger",void 0),C.context=h,C.logger=f,C.apClient=new Wr(C.context,f),C.apClient.apFinish$.subscribe(function(){C.log("Ap client fetch finished")});var P,x=[];return C.edgeInfoReplayed=C.apClient.getApEdgeInfo$(g).pipe(oe(function(B){return B.pipe(ca(function(Vt){if(sa(Vt))throw Vt}),cd(g?Zd.getParameter("RECONNECTING_AP_INTERVAL"):900),ob(Bc(2e4)))}),wb(function(B){return!dl(x,B)}),Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),ca(function(B){x.push(B),C.log("An edge info got %o",B)}),ca({error:function(B){C.emit("connectionInitFailure",B)}}),wg(function(){C.apClient.clearUp()}),sm()),C.firstEnvOpenSocket=C.edgeInfoReplayed.pipe(cb(function(B){if(B===void 0)return Z(Error("Invalid edge info"));var Vt=new ml(B.ip,C.firstEnv,B.ticket,C.context,f,P);return C.firstEnv=C.firstEnv===1?0:1,Vt.on("connectionFailure",function(){return C.onSocketConnectionFailure(Vt)}),P=!Vt.useNewDomain,Vt.open$.pipe(qf(Vt))}),ca(function(B){C.log("The websocket of ENV_%d opened to %s:%d",B.env,B.ip,af[B.env]),C.curOpenSockets[B.env]=B,C.lastOpenSockets[B.env].next(B),C.firstEnv=B.env,C.openSecondSocket(B.env,B.ip,B.useNewDomain)}),Ka(1),pe()),C.firstSocketOpener=C.firstEnvOpenSocket.pipe(cb(function(B){return B.open$.pipe(ca(function(){C.log("The websocket of first ENV_%d re-opened to %s:%d",B.env,B.ip,af[B.env]),C.curOpenSockets[B.env]=B,C.lastOpenSockets[B.env].next(B)}))})),h=C.firstOpenKeeperSubject.pipe(Cc(Yc)),C.firstOpenKeeperSub=h.subscribe({error:C.logError}),C}la(e,r);var d=ma(e);return Ha(e,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(h,f){if(![0,1].includes(h))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});var g=h===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var C=this.curOpenSockets[h];this.curOpenSockets[h]=void 0,C&&(C.isActiveClose=!0,setTimeout(function(){C.close()},f)),g!==void 0&&setTimeout(function(){g==null||g.unsubscribe()},f)}},{key:"waitClosing",value:function(h){var f=this;return h.isActiveClose=!0,h.open$.pipe(tt(),Ga(function(g){return g.message===mr.normalClosureMessage?vb:Z(g)}),hb(5e3),Ga(function(g){return g instanceof pb?(f.warn("Force closing the ENV_%d connection",h.env),vb):Z(g)}))}},{key:"onSocketConnectionFailure",value:function(h){var f=[0,1].filter(function(g){return g!==h.env})[0];(f=this.curOpenSockets[f])&&f.loggedIn?this.reopenSocketWithApRequest(h.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(h,f,g){var C=this,P=h===1?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(rm(function(x,B){return[].concat(G(x),[B])},[]),ba(function(x){return kr(x,function(B){return Jm(f,B.ip)}).slice(-1)[0]}),Ka(1),cb(function(x){if(x===void 0)return Z(Error("Invalid edge info"));var B=new ml(x.ip,P,x.ticket,C.context,C.logger,g);return B.on("connectionFailure",function(){return C.onSocketConnectionFailure(B)}),B.open$.pipe(ca(function(){C.lastOpenSockets[P].next(B),C.curOpenSockets[P]=B}))}),pe()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Cc(Yc)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(h){var f=this,g=[0,1].filter(function(x){return x!==h})[0];if((g=this.curOpenSockets[g])!==void 0){var C,P=g.ip;g=this.apClient.getApEdgeInfoEndFirst$(!0).pipe(Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),oe(function(x){return x.pipe(ca(function(B){if(B.code===Kh)f.emit("tokenExpired"),f.apClient.apFinish$.next(void 0);else if(sa(B))throw B}),cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")),ob(Bc(15e3)))}),ca(function(x){f.log("An edge info got %o",x)}),wg(function(){f.apClient.clearUp()})).pipe(rm(function(x,B){return[].concat(G(x),[B])},[]),ba(function(x){return(x=kr(x,function(B){return Jm(P,B.ip)})).length-1>=f.ipIterator?x.slice(-f.ipIterator++-1)[0]:(f.ipIterator=0,x.slice(-1)[0])}),Dd(),cb(function(x){if(x===void 0)return Z(Error("Invalid edge info"));var B=new ml(x.ip,h,x.ticket,f.context,f.logger,C);return B.on("connectionFailure",function(){return f.onSocketConnectionFailure(B)}),C=!B.useNewDomain,B.open$.pipe(qf(B))}),ca(function(x){f.log("The websocket of ENV_%d re-opened to %s:%d using ap",x.env,x.ip,af[x.env]),f.curOpenSockets[h]=x,f.lastOpenSockets[h].next(x)}),cb(function(x){return x.open$.pipe(ca(function(){f.log("The websocket of ENV_%d re-opened to %s:%d",x.env,x.ip,af[x.env]),f.curOpenSockets[h]=x,f.lastOpenSockets[h].next(x)}))}),pe()),h===this.firstEnv?this.firstOpenKeeperSubject.next(g):this.secondOpenKeeperSubject.next(g)}}}]),e}(tb()),Xc=fc.Writer,na=fc.util,zc=fc.roots.default||(fc.roots.default={}),RC=zc.Session=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.sid="",r.prototype.userId="",r.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,r.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,r.prototype.appId="",r.prototype.ver="",r.prototype.buildno=0,r.prototype.installId="",r.prototype.os=0,r.prototype.did="",r.prototype.index=null,r.prototype.token="",r.prototype.version=0,r.prototype.subVersion=0,r.encode=function(e,d){return d||(d=Xc.create()),e.sid!=null&&Object.hasOwnProperty.call(e,"sid")&&d.uint32(10).string(e.sid),e.userId!=null&&Object.hasOwnProperty.call(e,"userId")&&d.uint32(18).string(e.userId),e.lts!=null&&Object.hasOwnProperty.call(e,"lts")&&d.uint32(24).int64(e.lts),e.elapse!=null&&Object.hasOwnProperty.call(e,"elapse")&&d.uint32(32).int64(e.elapse),e.appId!=null&&Object.hasOwnProperty.call(e,"appId")&&d.uint32(42).string(e.appId),e.ver!=null&&Object.hasOwnProperty.call(e,"ver")&&d.uint32(50).string(e.ver),e.buildno!=null&&Object.hasOwnProperty.call(e,"buildno")&&d.uint32(56).int32(e.buildno),e.installId!=null&&Object.hasOwnProperty.call(e,"installId")&&d.uint32(66).string(e.installId),e.os!=null&&Object.hasOwnProperty.call(e,"os")&&d.uint32(128).int32(e.os),e.did!=null&&Object.hasOwnProperty.call(e,"did")&&d.uint32(138).string(e.did),e.index!=null&&Object.hasOwnProperty.call(e,"index")&&zc.Session.CommonIndex.encode(e.index,d.uint32(162).fork()).ldelim(),e.token!=null&&Object.hasOwnProperty.call(e,"token")&&d.uint32(170).string(e.token),e.version!=null&&Object.hasOwnProperty.call(e,"version")&&d.uint32(176).int32(e.version),e.subVersion!=null&&Object.hasOwnProperty.call(e,"subVersion")&&d.uint32(184).int32(e.subVersion),d},r.CommonIndex=function(){function e(d){if(d)for(var h=Object.keys(d),f=0;f<h.length;++f)d[h[f]]!=null&&(this[h[f]]=d[h[f]])}return e.prototype.index1="",e.prototype.index2="",e.prototype.index3="",e.encode=function(d,h){return h||(h=Xc.create()),d.index1!=null&&Object.hasOwnProperty.call(d,"index1")&&h.uint32(10).string(d.index1),d.index2!=null&&Object.hasOwnProperty.call(d,"index2")&&h.uint32(18).string(d.index2),d.index3!=null&&Object.hasOwnProperty.call(d,"index3")&&h.uint32(26).string(d.index3),h},e}(),r}(),SC=zc.Link=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.sid="",r.prototype.userId="",r.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,r.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,r.prototype.ec=0,r.prototype.sc=0,r.prototype.destServerIp="",r.prototype.ackedServerIp="",r.prototype.responseTime=0,r.encode=function(e,d){return d||(d=Xc.create()),e.sid!=null&&Object.hasOwnProperty.call(e,"sid")&&d.uint32(10).string(e.sid),e.userId!=null&&Object.hasOwnProperty.call(e,"userId")&&d.uint32(18).string(e.userId),e.lts!=null&&Object.hasOwnProperty.call(e,"lts")&&d.uint32(24).int64(e.lts),e.elapse!=null&&Object.hasOwnProperty.call(e,"elapse")&&d.uint32(32).int64(e.elapse),e.ec!=null&&Object.hasOwnProperty.call(e,"ec")&&d.uint32(40).int32(e.ec),e.sc!=null&&Object.hasOwnProperty.call(e,"sc")&&d.uint32(48).int32(e.sc),e.destServerIp!=null&&Object.hasOwnProperty.call(e,"destServerIp")&&d.uint32(58).string(e.destServerIp),e.ackedServerIp!=null&&Object.hasOwnProperty.call(e,"ackedServerIp")&&d.uint32(66).string(e.ackedServerIp),e.responseTime!=null&&Object.hasOwnProperty.call(e,"responseTime")&&d.uint32(72).int32(e.responseTime),d},r}(),TC=zc.Logout=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.sid="",r.prototype.userId="",r.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,r.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,r.encode=function(e,d){return d||(d=Xc.create()),e.sid!=null&&Object.hasOwnProperty.call(e,"sid")&&d.uint32(10).string(e.sid),e.userId!=null&&Object.hasOwnProperty.call(e,"userId")&&d.uint32(18).string(e.userId),e.lts!=null&&Object.hasOwnProperty.call(e,"lts")&&d.uint32(24).int64(e.lts),e.elapse!=null&&Object.hasOwnProperty.call(e,"elapse")&&d.uint32(32).int64(e.elapse),d},r}(),UC=zc.KickedOff=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.sid="",r.prototype.userId="",r.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,r.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,r.prototype.linkId=0,r.prototype.code=0,r.prototype.server="",r.prototype.serverCode=0,r.encode=function(e,d){return d||(d=Xc.create()),e.sid!=null&&Object.hasOwnProperty.call(e,"sid")&&d.uint32(10).string(e.sid),e.userId!=null&&Object.hasOwnProperty.call(e,"userId")&&d.uint32(18).string(e.userId),e.lts!=null&&Object.hasOwnProperty.call(e,"lts")&&d.uint32(24).int64(e.lts),e.elapse!=null&&Object.hasOwnProperty.call(e,"elapse")&&d.uint32(32).int64(e.elapse),e.linkId!=null&&Object.hasOwnProperty.call(e,"linkId")&&d.uint32(48).int32(e.linkId),e.code!=null&&Object.hasOwnProperty.call(e,"code")&&d.uint32(56).int32(e.code),e.server!=null&&Object.hasOwnProperty.call(e,"server")&&d.uint32(66).string(e.server),e.serverCode!=null&&Object.hasOwnProperty.call(e,"serverCode")&&d.uint32(72).int32(e.serverCode),d},r}(),VC=zc.ChnJoin=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.sid="",r.prototype.userId="",r.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,r.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,r.prototype.cname="",r.prototype.errCode=0,r.encode=function(e,d){return d||(d=Xc.create()),e.sid!=null&&Object.hasOwnProperty.call(e,"sid")&&d.uint32(10).string(e.sid),e.userId!=null&&Object.hasOwnProperty.call(e,"userId")&&d.uint32(18).string(e.userId),e.lts!=null&&Object.hasOwnProperty.call(e,"lts")&&d.uint32(24).int64(e.lts),e.elapse!=null&&Object.hasOwnProperty.call(e,"elapse")&&d.uint32(32).int64(e.elapse),e.cname!=null&&Object.hasOwnProperty.call(e,"cname")&&d.uint32(50).string(e.cname),e.errCode!=null&&Object.hasOwnProperty.call(e,"errCode")&&d.uint32(56).int32(e.errCode),d},r}(),WC=zc.ChnJoinRes=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.sid="",r.prototype.userId="",r.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,r.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,r.prototype.cname="",r.prototype.errCode=0,r.prototype.serverErrCode=0,r.encode=function(e,d){return d||(d=Xc.create()),e.sid!=null&&Object.hasOwnProperty.call(e,"sid")&&d.uint32(10).string(e.sid),e.userId!=null&&Object.hasOwnProperty.call(e,"userId")&&d.uint32(18).string(e.userId),e.lts!=null&&Object.hasOwnProperty.call(e,"lts")&&d.uint32(24).int64(e.lts),e.elapse!=null&&Object.hasOwnProperty.call(e,"elapse")&&d.uint32(32).int64(e.elapse),e.cname!=null&&Object.hasOwnProperty.call(e,"cname")&&d.uint32(50).string(e.cname),e.errCode!=null&&Object.hasOwnProperty.call(e,"errCode")&&d.uint32(56).int32(e.errCode),e.serverErrCode!=null&&Object.hasOwnProperty.call(e,"serverErrCode")&&d.uint32(64).int32(e.serverErrCode),d},r}(),XC=zc.ChnLeave=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.sid="",r.prototype.userId="",r.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,r.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,r.prototype.cname="",r.prototype.errCode=0,r.encode=function(e,d){return d||(d=Xc.create()),e.sid!=null&&Object.hasOwnProperty.call(e,"sid")&&d.uint32(10).string(e.sid),e.userId!=null&&Object.hasOwnProperty.call(e,"userId")&&d.uint32(18).string(e.userId),e.lts!=null&&Object.hasOwnProperty.call(e,"lts")&&d.uint32(24).int64(e.lts),e.elapse!=null&&Object.hasOwnProperty.call(e,"elapse")&&d.uint32(32).int64(e.elapse),e.cname!=null&&Object.hasOwnProperty.call(e,"cname")&&d.uint32(50).string(e.cname),e.errCode!=null&&Object.hasOwnProperty.call(e,"errCode")&&d.uint32(56).int32(e.errCode),d},r}(),YC=zc.ConnectionStateChange=function(){function r(e){if(e)for(var d=Object.keys(e),h=0;h<d.length;++h)e[d[h]]!=null&&(this[d[h]]=e[d[h]])}return r.prototype.sid="",r.prototype.userId="",r.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,r.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,r.prototype.oldState=0,r.prototype.newState=0,r.prototype.reason=0,r.prototype.reconnId=0,r.encode=function(e,d){return d||(d=Xc.create()),e.sid!=null&&Object.hasOwnProperty.call(e,"sid")&&d.uint32(10).string(e.sid),e.userId!=null&&Object.hasOwnProperty.call(e,"userId")&&d.uint32(18).string(e.userId),e.lts!=null&&Object.hasOwnProperty.call(e,"lts")&&d.uint32(24).int64(e.lts),e.elapse!=null&&Object.hasOwnProperty.call(e,"elapse")&&d.uint32(32).int64(e.elapse),e.oldState!=null&&Object.hasOwnProperty.call(e,"oldState")&&d.uint32(40).int32(e.oldState),e.newState!=null&&Object.hasOwnProperty.call(e,"newState")&&d.uint32(48).int32(e.newState),e.reason!=null&&Object.hasOwnProperty.call(e,"reason")&&d.uint32(56).int32(e.reason),e.reconnId!=null&&Object.hasOwnProperty.call(e,"reconnId")&&d.uint32(64).int32(e.reconnId),d},r}(),fu=Object.freeze({__proto__:null,Session:RC,Link:SC,Logout:TC,KickedOff:UC,ChnJoin:VC,ChnJoinRes:WC,ChnLeave:XC,ConnectionStateChange:YC,default:zc}),gu=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191}}),ZC=function(r){function e(h,f,g){return W(this,e),m(n(g=d.call(this,g,"Context")),"_token",void 0),m(n(g),"config",void 0),m(n(g),"_uid",void 0),m(n(g),"_sid",void 0),m(n(g),"_area","CN"),m(n(g),"appId",void 0),m(n(g),"enableCloudProxy",!1),m(n(g),"cloudProxyServers",[]),g.appId=h,g.config=f,g}la(e,r);var d=ma(e);return Ha(e,[{key:"token",set:function(h){this._token=typeof h=="string"&&h?h:void 0}},{key:"uid",get:function(){if(typeof this._uid=="string"&&this._uid)return this._uid;throw new Ia("Cannot get illegal uid")},set:function(h){if(this.log("The user ID is set to %s",oa(h)),!za(h))throw new Ia;this._uid=h}},{key:"key",get:function(){if(typeof this._token=="string"&&this._token)return this._token;if(typeof this.appId=="string"&&this.appId)return this.appId;throw new Ia("Cannot get illegal key")}},{key:"sid",get:function(){if(typeof this._sid=="string"&&this._sid)return this._sid;throw new Ia("Cannot get illegal sid")},set:function(h){if(this.log("sid is set to %s",h),typeof h!="string"||!h)throw new Ia;this._sid=h}},{key:"rtmArea",get:function(){if(typeof this._area=="string"&&this._area)return this._area;throw new Ia("Cannot get illegal area")},set:function(h){this.log("area is set to %s",h),typeof h=="string"&&h?this._area=h:this.warn("set area failed")}}]),e}(tb()),$C=!!Fc&&R(function(){Fc.prototype.finally.call({then:function(){}},function(){})});if(N({target:"Promise",proto:!0,real:!0,forced:$C},{finally:function(r){var e=kd(this,mc("Promise")),d=typeof r=="function";return this.then(d?function(h){return mj(e,r()).then(function(){return h})}:r,d?function(h){return mj(e,r()).then(function(){throw h})}:r)}}),typeof Fc=="function"){var Zr=mc("Promise").prototype.finally;Fc.prototype.finally!==Zr&&Ta(Fc.prototype,"finally",Zr,{unsafe:!0})}var aD=function(){var r=J(w.mark(function e(d){return w.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.t0=Uint8Array,h.next=3,crypto.subtle.digest("SHA-256",d);case 3:return h.t1=h.sent,h.abrupt("return",new h.t0(h.t1));case 5:case"end":return h.stop()}},e)}));return function(e){return r.apply(this,arguments)}}(),$r=function(r){return Array.from(r).map(function(e){return e.toString(16).padStart(2,"0")}).join("")},bD=function(r){if(typeof r!="string")throw new TypeError("Expected input to be a string");if(r.length%2!=0)throw new RangeError("Expected string to be an even number of characters");for(var e=new Uint8Array(r.length/2),d=0;d<r.length;d+=2)e[d/2]=parseInt(r.substring(d,d+2),16);return e},as=function(r){return btoa(String.fromCharCode.apply(String,G(r))).replace(/={1,2}$/,"")},bs=function(){var r=J(w.mark(function e(d){var h;return w.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.prev=0,f.next=3,crypto.subtle.digest("SHA-1",d);case 3:h=f.sent,f.next=9;break;case 6:f.prev=6,f.t0=f.catch(0),h=sha1.arrayBuffer(d);case 9:return f.abrupt("return",as(new Uint8Array(h)));case 10:case"end":return f.stop()}},e,null,[[0,6]])}));return function(e){return r.apply(this,arguments)}}(),cs=function(r,e,d,h){h[e]=!0,d.has(r)?d.get(r).add(e):d.set(r,new Set([e]))},cD=function(r){switch(r){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:return"application/octet-stream"}},ds=function(r){function e(h,f,g,C){W(this,e);var P=d.call(this,g,"ChunkDownloadManager");if(m(n(P),"abortController",new AbortController),m(n(P),"downloadedSize",0),m(n(P),"successCount",0),m(n(P),"timer",void 0),m(n(P),"chunks",[]),m(n(P),"retUnit",void 0),m(n(P),"singleThread",!1),m(n(P),"initialized",!1),m(n(P),"ee",void 0),m(n(P),"chunkCount",void 0),m(n(P),"aborted",!1),m(n(P),"serverToIndices",new Map),m(n(P),"backupToIndices",new Map),m(n(P),"indexToBackupServers",[]),m(n(P),"busyBackupServers",new Map),m(n(P),"downloadingChunks",new Set),m(n(P),"metaInfo",void 0),m(n(P),"transHandler",void 0),P.metaInfo=h,P.transHandler=f,P.ee=C===void 0?new ea:C,g=h.size,h=h.unit,g===0)throw new Ia("size cannot be 0");return f.cancelSignal!==void 0&&f.cancelSignal.addEventListener("abort",function(){P.abortController.abort()},{once:!0}),P.abortController.signal.addEventListener("abort",function(){P.aborted=!0},{once:!0}),P.chunkCount=Math.ceil(g/(32768*h)),P}la(e,r);var d=ma(e);return Ha(e,[{key:"setInfoByResponse",value:function(h){var f=this,g=h.serverList,C=h.backupList;if(h=h.unit,g.length<this.chunkCount&&C.length<this.chunkCount)throw new Ia("servers is not enough");this.updateProgress(0),this.initialized=!0;var P=Array(this.chunkCount).fill(!1);if(g.forEach(function(x,B){return x.forEach(function(Vt){return cs(Vt,B,f.serverToIndices,P)})}),C.forEach(function(x,B){return x.forEach(function(Vt){return cs(Vt,B,f.backupToIndices,P)})}),P.some(function(){return!1}))throw new da("Not enough servers to download",mg);this.indexToBackupServers=C.map(function(x){return new Set(x)}),this.retUnit=h}},{key:"downloadChunks",value:function(){this.aborted?this.warn("downloadChunks after abort, ignored"):this.serverToIndices.size===1&&Array.from(this.serverToIndices.keys())[0]===0?this.serversDownload(this.backupToIndices):1<=this.serverToIndices.size?this.serversDownload(this.serverToIndices,!0):this.ee.emit("error",new da("not enough servers to download",mg))}},{key:"updateProgress",value:function(h){var f=this,g=this.downloadedSize+h;this.downloadedSize>this.metaInfo.size?(this.warn("Invalid download size, overflowed"),this.ee.emit("error",new Wc("Invalid download size",mg))):(this.downloadedSize=g,this.timer!==void 0&&h!==0&&(clearTimeout(this.timer),this.timer=void 0),this.timer===void 0&&this.successCount!==this.chunkCount&&(this.timer=setTimeout(function(){f.ee.emit("timedOut"),f.abortController.abort()},12e4)),this.initialized&&h===0||this.transHandler.onOperationProgress===void 0||this.transHandler.onOperationProgress({totalSize:this.metaInfo.size,currentSize:this.downloadedSize}))}},{key:"getPayload",value:function(){for(var h=0,f=0,g=this.chunks;f<g.length;f++)h+=g[f].byteLength;if(h!==this.metaInfo.size)throw new Ia("invalid chunks total size");h=new Uint8Array(h),g=f=0;for(var C=this.chunks;g<C.length;g++){var P=C[g];h.set(new Uint8Array(P),f),f+=P.byteLength}return f=Array.from(h.subarray(0,4)).map(function(x){return x.toString(16)}).join("").toUpperCase(),Zt(h.buffer,cD(f))}},{key:"getDownloadUrl",value:function(h){var f=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(h).split(".").join("-"),".edge.").concat(f,":9601/api/v1/chuck/download")}},{key:"serversDownload",value:function(){var h=J(w.mark(function f(g){var C,P=this,x=arguments;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return C=1<x.length&&x[1]!==void 0&&x[1],B.next=3,Promise.all(Array.from(g.entries()).map(function(Vt){return Vt=ra(Vt,2),P.postDownloadRequest(Vt[0],Array.from(Vt[1]),C).catch(function(_r){_r.statusCode===404?(P.ee.emit("notExist"),P.abortController.abort()):_r.name!=="AbortError"&&(Sa(_r)?P.singleThread?(P.abortController.abort(),P.ee.emit("timedOut")):(P.warn("%d download timed out after %d, retrying use single thread",_r.index,P.singleThread?6e4:3e4),P.abortController.abort(),P.singleThread=!0,P.ee.emit("multiTimeOut")):(P.ee.emit("error",_r),P.abortController.abort()))})}));case 3:case"end":return B.stop()}},f)}));return function(f){return h.apply(this,arguments)}}()},{key:"postDownloadRequest",value:function(){var h=J(w.mark(function f(g,C,P){var x,B,Vt,_r,_e,_i,_a,kc,_d,_l=this;return w.wrap(function(_h){for(;;)switch(_h.prev=_h.next){case 0:if(_d=function(){return(_d=J(w.mark(function rE(aE){var yE,gE,bE,GE,Qm,tE,EE,pE,TE;return w.wrap(function(_p){for(;;)switch(_p.prev=_p.next){case 0:if(_p.prev=0,aE!==void 0||g!==0){_p.next=5;break}throw new Ia("Invalid serverIp");case 5:yE=aE===void 0?_a.getDownloadUrl(g):aE;case 6:return _a.downloadingChunks.add(x),_p.next=9,_i(yE);case 9:return gE=_p.sent,bE=gE.responseData,_a.downloadingChunks.delete(x),_p.abrupt("return",bE);case 15:if(_p.prev=15,_p.t0=_p.catch(0),_a.downloadingChunks.delete(x),C.unshift(x),_a.metaInfo.useNewDomain=!1,_p.t0.name!=="AbortError"){_p.next=22;break}throw _p.t0;case 22:if(!Sa(_p.t0)){_p.next=25;break}throw _p.t0.index=x,_p.t0;case 25:if(GE=_r,_r+=1,!(2>GE)){_p.next=30;break}return _p.t0 instanceof Ia||_a.warn("%o, %d download failed, retrying",_p.t0,x),_p.abrupt("return",kc());case 30:if(_p.t0.statusCode!==504){_p.next=34;break}throw(Qm=new db("download server timed out",{originalError:_p.t0,serverCode:504})).index=x,Qm;case 34:if(!P||GE!==2||_e[0]===0){_p.next=45;break}return _p.t0 instanceof Ia||_a.warn("%d download failed, using backup: %d, %o",x,_e[0],_p.t0),_p.next=38,_a.busyBackupServers.get(_e[0]);case 38:return tE=kc(_a.getDownloadUrl(_e[0])),_a.busyBackupServers.set(_e[0],tE),_p.next=42,tE;case 42:return EE=_p.sent,_a.busyBackupServers.delete(_e[0]),_p.abrupt("return",EE);case 45:if(!(P&&2<GE&&_e[1]!==void 0&&_e[1]!==0)){_p.next=56;break}return _a.warn("%d download failed, using backup 1: %d",x,_e[1]),_p.next=49,_a.busyBackupServers.get(_e[1]);case 49:return pE=kc(_a.getDownloadUrl(_e[1])),_a.busyBackupServers.set(_e[1],pE),_p.next=53,pE;case 53:return TE=_p.sent,_a.busyBackupServers.delete(_e[1]),_p.abrupt("return",TE);case 56:throw _p.t0.index=x,_p.t0;case 58:case"end":return _p.stop()}},rE,null,[[0,15]])}))).apply(this,arguments)},kc=function(rE){return _d.apply(this,arguments)},!this.aborted){_h.next=4;break}throw new Ia("download already aborted");case 4:if((x=C.shift())!==void 0){_h.next=8;break}return this.log("%s download finished",g),_h.abrupt("return");case 8:if(!(this.singleThread&&0<this.downloadingChunks.size)){_h.next=10;break}return _h.abrupt("return");case 10:if(!this.downloadingChunks.has(x)){_h.next=13;break}return this.log("%s already downloading, return",x),_h.abrupt("return");case 13:if(this.chunks[x]===void 0){_h.next=19;break}return this.successCount===this.chunkCount&&(this.log("chunks all download"),this.ee.emit("finished")),this.log("%s already downloaded, do next",x),_h.next=18,this.postDownloadRequest(g,C,P);case 18:return _h.abrupt("return");case 19:return B=new FormData,Vt={hash:hu(this.metaInfo.hashHexStr),unit:this.retUnit===void 0?this.metaInfo.unit:this.retUnit,instance:this.metaInfo.instance,loginOpt:this.metaInfo.loginOpt,ticket:this.metaInfo.ticket,index:x},B.append("parameter",JSON.stringify(Vt)),_r=0,_e=Array.from(this.indexToBackupServers[x]),_i=function(rE){return te(rE,{body:B,signal:_l.abortController.signal,timeout:_l.singleThread?12e4:3e4},{useBinaryResponse:!0})},_a=this,_h.next=28,kc().then(function(rE){return _l.chunks[x]!==void 0?_l.log("chunk %d download duplicated",x):(_l.chunks[x]=rE,_l.log("chunk %d downloaded",x),_l.successCount+=1,_l.updateProgress(_l.chunks[x].byteLength)),_l.successCount===_l.chunkCount&&(_l.log("chunks all download"),_l.ee.emit("finished")),_l.singleThread?(_l.downloadChunks(),Promise.resolve()):_l.postDownloadRequest(g,C,P)});case 28:case"end":return _h.stop()}},f,this)}));return function(f,g,C){return h.apply(this,arguments)}}()}]),e}(tb()),es=function(r){function e(h,f,g,C){W(this,e);var P=d.call(this,g,"ChunkUploadManager");if(m(n(P),"chunkCount",0),m(n(P),"chunks",[]),m(n(P),"uploadedChunks",[]),m(n(P),"totalFailures",0),m(n(P),"timer",void 0),m(n(P),"initState","uninitialized"),m(n(P),"ee",void 0),m(n(P),"unit",0),m(n(P),"uploadedSize",0),m(n(P),"singleThread",!1),m(n(P),"abortController",new AbortController),m(n(P),"servers",[]),m(n(P),"aborted",!1),m(n(P),"metaInfo",void 0),m(n(P),"transHandler",void 0),P.metaInfo=h,P.transHandler=f,P.ee=C===void 0?new ea:C,h.file.length===0)throw new I("file not found or is empty",wf);return f.cancelSignal!==void 0&&f.cancelSignal.addEventListener("abort",function(){P.abortController.abort()},{once:!0}),P.abortController.signal.addEventListener("abort",function(){P.aborted=!0},{once:!0}),P}la(e,r);var d=ma(e);return Ha(e,[{key:"initChunks",value:function(){var h=J(w.mark(function f(g){var C,P,x,B,Vt,_r=this;return w.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(this.initState!=="initialized"&&this.initState!=="initializing"){_e.next=2;break}throw new Ia("cannot re-initialize");case 2:for(this.initState="initializing",this.unit=g,C=this.sliceFile(g,this.metaInfo.file),this.chunkCount=C.length,P=[],x=function(_i,_a){var kc=(_i=ra(_a[_i],2))[0],_d=_i[1];_i=bs(_d).then(function(_l){_r.chunks[kc]={payload:_d,sha1:_l,uploadedTo:void 0,index:kc,processed:!1}}),P.push(_i)},B=0,Vt=Array.from(C.entries());B<Vt.length;B++)x(B,Vt);return _e.next=11,Promise.all(P);case 11:this.updateProgress(0),this.initState="initialized",this.log("upload chunks initialized");case 14:case"end":return _e.stop()}},f,this)}));return function(f){return h.apply(this,arguments)}}()},{key:"uploadToServers",value:function(){var h=this;if(!this.aborted){for(var f=this.chunks.filter(function(P){return!P.processed}),g=function(P){var x=f[P],B=h.servers.filter(function(_r){return!_r.isUploading}).sort(function(_r,_e){return _r.successCount-_e.successCount}).sort(function(_r,_e){return _r.failureCount-_e.failureCount})[0];if(B===void 0||1<B.failureCount)return h.log("Upload server not available, waiting"),h.ee.emit("serverUsedUp"),Om(1e3).then(function(){h.totalFailures>2*h.chunkCount&&h.ee.emit("error"),h.totalFailures+=1,B!==void 0&&(B.failureCount=0),h.uploadToServers()}).catch(function(){}),"break";x.processed=!0,B.isUploading=!0,h.log("uploading chunk %d to server %s",x.index,Dg(B.ip));var Vt=h.getUploadUrl(B.ip);return J(w.mark(function _r(){var _e;return w.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:return _i.prev=0,_i.next=3,h.postChunk(x.payload,Vt,x.index);case 3:_e=h.chunks.findIndex(function(_a){return _a===x}),x.uploadedTo=B.ip,h.chunks.splice(_e,1),h.uploadedChunks.push(x),B.successCount+=1,B.isUploading=!1,h.updateProgress(x.payload.byteLength),h.log("upload chunk %d successfully",x.index),_i.next=31;break;case 13:if(_i.prev=13,_i.t0=_i.catch(0),B.isUploading=!1,x.processed=!1,_i.t0.statusCode!==504&&!Sa(_i.t0)){_i.next=27;break}if(h.singleThread){_i.next=24;break}return h.warn("%d upload timed out after %d, retrying use single thread",x.index,h.singleThread?12e4:3e4),h.abortController.abort(),h.singleThread=!0,h.ee.emit("multiTimeOut"),_i.abrupt("return");case 24:return h.ee.emit("timedOut"),h.abortController.abort(),_i.abrupt("return");case 27:return h.metaInfo.useNewDomain=!1,B.failureCount+=1,_i.next=31,Om(1e3);case 31:h.uploadedChunks.length===h.chunkCount?(h.log("chunks uploaded"),h.ee.emit("finished")):(h.singleThread||h.chunks.filter(function(_a){return!_a.processed}).length===1)&&h.uploadToServers();case 32:case"end":return _i.stop()}},_r,null,[[0,13]])}))(),h.singleThread?"break":void 0},C=0;C<f.length&&g(C)!=="break";C++);f.length===0&&this.uploadedChunks.length!==this.chunkCount&&this.log("%d chunks left uploading",this.chunkCount-this.uploadedChunks.length)}}},{key:"getUploadServerIPs",value:function(){var h=!0,f=[],g=G(this.uploadedChunks).sort(function(x,B){return x.index-B.index}),C=0;for(g=Array.from(g.values());C<g.length;C++){var P=g[C].uploadedTo;if(P===void 0){h=!1;break}f.push(P)}if(!h)throw new Ia("some chunks not uploaded, cannot get upload server ips");return f}},{key:"addServers",value:function(h){var f=this;h.forEach(function(g){var C=f.servers.findIndex(function(P){return P.ip===g});C!==-1?f.servers[C].failureCount=0:(f.log("server %s added",Dg(g)),f.servers.push({successCount:0,isUploading:!1,ip:g,failureCount:0}))})}},{key:"updateProgress",value:function(h){var f=this,g=h!==void 0?this.uploadedSize+h:this.metaInfo.file.length;g>this.metaInfo.file.length?(this.warn("Invalid upload size, overflowed"),this.ee.emit("error",new Wc("Invalid upload size",lg))):(this.uploadedSize=g,this.timer!==void 0&&h!==0&&(clearTimeout(this.timer),this.timer=void 0),this.timer===void 0&&h!==void 0&&this.uploadedChunks.length!==this.chunkCount&&(this.timer=setTimeout(function(){f.ee.emit("timedOut"),f.abortController.abort()},12e4)),this.initState==="initialized"&&h===0||this.transHandler.onOperationProgress===void 0||this.transHandler.onOperationProgress({totalSize:this.metaInfo.file.length,currentSize:this.uploadedSize}))}},{key:"sliceFile",value:function(h,f){var g=0,C=[],P=f.length;for(h*=32768;g<P;)C.push(f.slice(g,g+h)),g+=h;return this.log("chunks split into %d",C.length),C}},{key:"postChunk",value:function(){var h=J(w.mark(function f(g,C,P){var x,B,Vt,_r,_e,_i,_a,kc;return w.wrap(function(_d){for(;;)switch(_d.prev=_d.next){case 0:if(!this.aborted){_d.next=2;break}throw new Ia("upload already aborted");case 2:if(this.unit!==void 0){_d.next=4;break}throw new Ia("unit is undefined");case 4:return x=this.metaInfo,B=x.ticket,Vt=x.instance,_r=x.loginOpt,_e=x.hashStr,_d.t0=P,_d.t1=_e,_d.next=9,bs(g);case 9:return _d.t2=_d.sent,_d.t3=this.unit,_d.t4=B,_d.t5=Vt,_d.t6=_r,_i={index:_d.t0,hash:_d.t1,sha1:_d.t2,unit:_d.t3,ticket:_d.t4,instance:_d.t5,loginOpt:_d.t6},(_a=new FormData).append("parameter",JSON.stringify(_i)),_a.append("payload",new Blob([g])),_d.next=20,te(C,{headers:{Accept:"application/json"},body:_a,timeout:this.singleThread?12e4:3e4,signal:this.abortController.signal});case 20:if(kc=_d.sent,kc.status===201){_d.next=24;break}throw new da("uploading chunk ".concat(P," failed"));case 24:case"end":return _d.stop()}},f,this)}));return function(f,g,C){return h.apply(this,arguments)}}()},{key:"getUploadUrl",value:function(h){var f=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(h).split(".").join("-"),".edge.").concat(f,":9601/api/v1/chuck/upload")}}]),e}(tb()),fs=function(r){function e(h){W(this,e);var f=d.call(this,h,"MediaTaskManager");return m(n(f),"isProcessing",!1),m(n(f),"authInfo",void 0),m(n(f),"taskFinishers",{}),m(n(f),"mediaTasks",new Map),m(n(f),"ongoingTask",void 0),f.on("connectionStateChanged",function(g){if(g===S.ConnectionState.ABORTED||g===S.ConnectionState.DISCONNECTED){f.ongoingTask!==void 0&&f.cancelTask(f.ongoingTask),g=0;for(var C=Array.from(f.mediaTasks.entries());g<C.length;g++){var P=ra(C[g],2)[1];f.cancelTask(P)}f.mediaTasks.clear(),f.taskFinishers={}}else g===S.ConnectionState.RECONNECTING?f.ongoingTask!==void 0&&f.ongoingTask.manager.abortController.abort():g===S.ConnectionState.CONNECTED&&f.ongoingTask!==void 0&&f.ongoingTask.manager.ee.emit("reconnected")}),f}la(e,r);var d=ma(e);return Ha(e,[{key:"setAuthInfo",value:function(h){this.authInfo=h}},{key:"waitMediaTask",value:function(h){var f=this;return new Promise(function(g,C){f.taskFinishers[h]={resolve:g,reject:C},f.isProcessing||f.processMediaTask()}).finally(function(){f.ongoingTask!==void 0&&f.ongoingTask.manager.timer!==void 0&&clearTimeout(f.ongoingTask.manager.timer),delete f.taskFinishers[h],f.mediaTasks.size!==0?f.processMediaTask():f.isProcessing=!1})}},{key:"addUploadTask",value:function(h,f,g,C){var P=h.file;if(h=h.hash,this.authInfo===void 0)throw new Ia("session not found");if(this.mediaTasks.size>=e.MAX_PENDING_TASK_COUNT-1)throw new ib("Upload media failed, exceed max pending jobs",xA);return C=new es({hashStr:as(h),file:P,ticket:this.authInfo.ticket,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),useNewDomain:this.authInfo.useNewDomain},C,this.logger),P=Ud(),this.mediaTasks.set(P,{type:"UPLOAD",manager:C,hash:h,setter:g,fetcher:f,taskId:P}),P}},{key:"addDownloadTask",value:function(h,f,g){var C=h.hashHexStr,P=h.size,x=h.unit;if(h=h.zone,this.authInfo===void 0)throw new Ia("session not found");if(this.mediaTasks.size>=e.MAX_PENDING_TASK_COUNT-1)throw new ib("Download media failed, exceed max pending jobs",BA);return g=new ds({hashHexStr:C,ticket:this.authInfo.ticket,useNewDomain:this.authInfo.useNewDomain,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),size:P,zone:h,unit:x},g,this.logger),C=Ud(),this.mediaTasks.set(C,{type:"DOWNLOAD",manager:g,fetcher:f,taskId:C}),C}},{key:"doDownloadTaskImpl",value:function(){var h=J(w.mark(function f(g,C){var P,x,B,Vt,_r,_e,_i,_a,kc=this,_d=arguments;return w.wrap(function(_l){for(;;)switch(_l.prev=_l.next){case 0:return P=2<_d.length&&_d[2]!==void 0&&_d[2],B=x=g.manager,P&&(x=new ds(B.metaInfo,B.transHandler,this.logger,B.ee)),Vt=g.fetcher,_l.next=7,Vt();case 7:if(_r=_l.sent,_e=_r.serverList,_i=_r.backupList,_a=_r.unit,!P||_a===B.retUnit){_l.next=13;break}throw new da("download unit is different, reject to continue",mg);case 13:P&&(g.manager=x,x.downloadedSize=B.downloadedSize,x.successCount=B.successCount,x.timer=B.timer,x.chunks=B.chunks,x.initialized=B.initialized,x.singleThread=B.singleThread,x.updateProgress(0)),x.ee.once("reconnected",function(){x.ee.removeAllListeners(),kc.doDownloadTaskImpl(g,C,!0).catch(function(_h){C.reject(_h)})}),x.ee.once("multiTimeOut",function(){x.ee.removeAllListeners(),kc.doDownloadTaskImpl(g,C,!0).catch(function(_h){C.reject(_h)})}),x.ee.once("error",function(_h){x.ee.removeAllListeners(),C.reject(new da(["download file file, index %d",_h.index],{code:mg,originalError:_h}))}),x.ee.once("notExist",function(){x.abortController.abort(),x.ee.removeAllListeners(),C.reject(new da("download file not found",AA))}),x.ee.once("timedOut",function(){x.ee.removeAllListeners(),x.abortController.abort(),C.reject(new db("download timed out",zA))}),x.transHandler.cancelSignal!==void 0&&x.transHandler.cancelSignal.addEventListener("abort",function(){C.reject(new hl("Downloading canceled",ir))},{once:!0}),x.ee.once("finished",function(){C.resolve({type:"DOWNLOAD",payload:x.getPayload()})}),x.setInfoByResponse({serverList:_e,backupList:_i,unit:_a}),x.downloadChunks();case 23:case"end":return _l.stop()}},f,this)}));return function(f,g){return h.apply(this,arguments)}}()},{key:"doDownloadTask",value:function(h,f){var g=this,C=2<arguments.length&&arguments[2]!==void 0&&arguments[2],P=h.taskId;return C||(this.mediaTasks.delete(P),this.ongoingTask=h),new Promise(function(x,B){g.doDownloadTaskImpl(h,f,C).then(x).catch(B)})}},{key:"doUploadTaskImpl",value:function(){var h=J(w.mark(function f(g,C){var P,x,B,Vt,_r,_e,_i,_a,kc,_d=this,_l=arguments;return w.wrap(function(_h){for(;;)switch(_h.prev=_h.next){case 0:return P=2<_l.length&&_l[2]!==void 0&&_l[2],B=x=g.manager,P&&(x=new es(B.metaInfo,B.transHandler,this.logger,B.ee)),Vt=g.fetcher,_r=new Pa,_i=new Promise(function(rE,aE){var yE=Vt(),gE=yE.ret,bE=yE.err,GE=yE.timeout;yE.fin.pipe(ob(_r)).subscribe({next:function(Qm){C.resolve({type:"UPLOAD",retUnit:Qm.unit,zone:Qm.zone})},complete:function(){rE({hasExist:!0}),_r.next(),_r.complete()}}),gE.pipe(ob(_r),cb(function(){var Qm=J(w.mark(function tE(EE){var pE,TE;return w.wrap(function(_p){for(;;)switch(_p.prev=_p.next){case 0:if(pE=EE.servers,TE=EE.unit,P&&B.unit!==TE?C.reject(new da("upload unit is different, reject to continue",lg)):P&&(g.manager=x,x.chunkCount=B.chunkCount,x.chunks=B.chunks,x.totalFailures=B.totalFailures,x.uploadedChunks=B.uploadedChunks,x.timer=B.timer,x.initState=B.initState,x.unit=B.unit,x.uploadedSize=B.uploadedSize,x.singleThread=B.singleThread,x.updateProgress(0)),x.addServers(pE),x.initState!=="uninitialized"){_p.next=7;break}return _e=x.initChunks(TE),_p.next=7,_e;case 7:case"end":return _p.stop()}},tE)}));return function(tE){return Qm.apply(this,arguments)}}())).subscribe({complete:function(){return rE({hasExist:!1})},error:aE}),yE=function(Qm){x.initState!=="uninitialized"&&_e?rE(_e.then(function(){return{hasExist:!1}})):aE(Qm)},bE.pipe(ob(_r)).subscribe({error:yE}),GE.pipe(ob(_r)).subscribe({error:yE})}),_h.next=9,_i;case 9:if(_a=_h.sent,!_a.hasExist){_h.next=15;break}return x.updateProgress(),this.log("file already exists, skipping upload"),_h.abrupt("return");case 15:_r.next(),_r.complete(),this.log("chunks initialization promise resolved"),kc=gb(x.ee,"serverUsedUp").pipe(Gt(function(){return x.chunkCount!==x.uploadedChunks.length}),Jt(5e3,void 0,{leading:!1}),pm(function(){return Vt().ret})).subscribe(function(rE){x.addServers(rE.servers)}),x.ee.once("reconnected",function(){x.ee.removeAllListeners(),_d.doUploadTask(g,C,!0).catch(function(rE){C.reject(rE)})}),x.ee.once("multiTimeOut",function(){x.ee.removeAllListeners(),_d.doUploadTask(g,C,!0).catch(function(rE){C.reject(rE)})}),x.ee.once("timedOut",function(){kc.unsubscribe(),x.ee.removeAllListeners(),x.abortController.abort(),C.reject(new db("upload timed out",Lh))}),x.ee.once("error",function(rE){kc.unsubscribe(),x.ee.removeAllListeners(),x.abortController.abort(),C.reject(rE||new da("upload error",lg))}),x.transHandler.cancelSignal!==void 0&&x.transHandler.cancelSignal.addEventListener("abort",function(){C.reject(new hl("Uploading canceled",hr))},{once:!0}),x.ee.once("finished",J(w.mark(function rE(){var aE,yE,gE;return w.wrap(function(bE){for(;;)switch(bE.prev=bE.next){case 0:return kc.unsubscribe(),bE.next=3,g.setter(x.unit,x.getUploadServerIPs());case 3:aE=bE.sent,yE=aE.zone,gE=aE.unit,x.ee.removeAllListeners(),C.resolve({type:"UPLOAD",retUnit:gE,zone:yE});case 8:case"end":return bE.stop()}},rE)}))),x.uploadToServers();case 26:case"end":return _h.stop()}},f,this)}));return function(f,g){return h.apply(this,arguments)}}()},{key:"doUploadTask",value:function(h,f){var g=this,C=2<arguments.length&&arguments[2]!==void 0&&arguments[2],P=h.taskId;return C||(this.mediaTasks.delete(P),this.ongoingTask=h),new Promise(function(x,B){g.doUploadTaskImpl(h,f,C).then(x).catch(B)})}},{key:"processMediaTask",value:function(){var h=J(w.mark(function f(){var g,C,P;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(this.mediaTasks.size!==0){x.next=2;break}throw Error("no upload tasks");case 2:if(this.isProcessing=!0,g=this.mediaTasks.keys().next().value,(C=this.taskFinishers[g])!==void 0){x.next=7;break}throw Error("top task not found");case 7:if((P=this.mediaTasks.get(g))!==void 0){x.next=10;break}throw new Ia("task invalid");case 10:if(P.type!=="UPLOAD"){x.next=15;break}return x.next=13,this.doUploadTask(P,C).catch(function(B){P.manager.ee.removeAllListeners(),C.reject(B)});case 13:x.next=18;break;case 15:if(P.type!=="DOWNLOAD"){x.next=18;break}return x.next=18,this.doDownloadTask(P,C).catch(function(B){P.manager.ee.removeAllListeners(),C.reject(B)});case 18:case"end":return x.stop()}},f,this)}));return function(){return h.apply(this,arguments)}}()},{key:"cancelTask",value:function(h){var f=h.type==="DOWNLOAD"?ir:hr;h.manager.ee.removeAllListeners(),h.manager.abortController.abort(),this.taskFinishers[h.taskId]!==void 0&&this.taskFinishers[h.taskId].reject(new hl("User logged out or kicked off, media task canceled",f))}}]),e}(tb());m(fs,"MAX_PENDING_TASK_COUNT",9),Oo("of",function(){for(var r=0,e=arguments.length,d=new(Ne(this))(e);e>r;)d[r]=arguments[r++];return d},Dj);var gs=1/0,dD=Math.max,ju=function(r,e,d){var h=Object(r);if(!Ed(r)){var f=Te(e);r=Ad(r),e=function(g){return f(h[g],g,h)}}return-1<(e=function(g,C,P){var x=g==null?0:g.length;if(!x)return-1;if(P==null)P=0;else{var B=(P=P?(P=gl(P))===gs||P===-gs?17976931348623157e292*(0>P?-1:1):P==P?P:0:P===0?P:0)%1;P=P==P?B?P-B:P:0}return 0>P&&(P=dD(x+P,0)),Xp(g,Te(C),P)}(r,e,d))?h[f?r[e]:e]:void 0},iu=function(r,e){return r&&r.length?vk(r,void 0,typeof e=="function"?e:void 0):[]},hs=function(){function r(){W(this,r),m(this,"size",0),m(this,"fields",new Map)}return Ha(r,[{key:"define",value:function(e,d,h){if(this.size+=h,64<this.size)throw new RangeError("the struct over 64 bits is not supported");Mg(d={val:0,isNumber:d==="number",isBoolean:d==="boolean",oneof:d==="number"||d==="boolean"?void 0:d,len:h}),this.fields.set(e,d)}},{key:"set",value:function(e,d){if(!(e=this.fields.get(e)))throw Error("field not found");var h=e.oneof;if(!U.isLong(d)&&typeof d!="number")if(typeof d=="boolean")d=d?1:0;else{if(h===void 0)throw Error("invalid field type");if((d=h[d])===void 0)throw Error("field type not found")}Mg(e,d),e.val=d}},{key:"toNumber",value:function(){for(var e=0,d=0,h=0,f=Array.from(this.fields);h<f.length;h++){var g=ra(f[h],2)[1],C=g.len;(g=g.val)!==void 0&&(e+=U.fromValue(g).shiftLeft(d).toNumber(),d+=C)}return e}},{key:"toLong",value:function(){for(var e=U.fromNumber(0,!0),d=0,h=0,f=Array.from(this.fields);h<f.length;h++){var g=ra(f[h],2)[1],C=g.len;(g=g.val)!==void 0&&(e=U.fromValue(g).shiftLeft(d).add(e),d+=C)}return e}},{key:"assert",value:function(e,d){function h(C){if(!U.isLong(C)&&typeof C!="number")if(typeof C=="boolean")C=C?1:0;else{if(g===void 0)throw Error("invalid field type");if((C=g[C])===void 0)throw Error("field type not found")}return Mg(f,C),Lg(C,f.val)}var f=this.fields.get(e);if(!f)throw Error("field not found");var g=f.oneof;if(!Array.isArray(d))return h(d);if(d.length===1)return h(d[0]);if(d.every(function(C){return typeof C=="string"})&&g!==void 0)return d.some(function(C){return h(C)});throw Error("invalid valueTypes")}},{key:"from",value:function(e){e=U.fromValue(e);for(var d=0,h=0,f=Array.from(this.fields);h<f.length;h++){var g=ra(f[h],2)[1],C=g.len,P=U.fromNumber(Math.pow(2,C)-1,!0).shiftLeft(d);Mg(g,P=e.and(P).shiftRightUnsigned(d)),g.val=P,d+=C}}},{key:"typeOf",value:function(e){if((e=this.fields.get(e))!==void 0){var d=e.oneof;if(e=e.val,d!==void 0){var h=0;for(d=Object.entries(d);h<d.length;h++){var f=ra(d[h],2),g=f[0];if(Lg(e,f[1]))return g}}}throw new TypeError("can only get type of oneof type")}}]),r}(),is=function(r){function e(h){W(this,e);var f=d.call(this);return f.define("Rejoin","boolean",1),f.define("Unused","number",31),f.define("Platform","number",8),f.define("Version","number",12),f.define("Subversion","number",12),f.set("Platform",7),f.set("Version",4),f.set("Subversion",203),f.set("Rejoin",h),f}la(e,r);var d=ma(e);return e}(hs),eD=ua(ua(ua(ua({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),{PeerImageMessage:6,ChannelImageMessage:7,VendorImageMessage:8}),{PeerFileMessage:15,ChannelFileMessage:16,VendorFileMessage:17}),js={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},fD=ua(ua({},eD),js),gD={Uncompressed:0,Zlib:1},ae=function(r){function e(h){W(this,e);var f=d.call(this);if(f.define("MessageType",fD,8),f.define("BroadcastJumps","number",2),f.define("ToCache","boolean",1),f.define("FromCache","boolean",1),f.define("CompressionMethod",gD,2),f.define("IterationNumber","number",4),f.define("BufferedMessage","boolean",1),f.define("ToArchive","boolean",1),f.define("FromArchive","boolean",1),typeof h=="number"||U.isLong(h))f.from(h);else if(h!==void 0){var g=0;for(h=Hg(h);g<h.length;g++){var C=ra(h[g],2);f.set(C[0],C[1])}}return f}la(e,r);var d=ma(e);return Ha(e,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(h){var f=this;return h!==void 0?this.assert("MessageType",h):xf(js).some(function(g){return f.assert("MessageType",g)})}},{key:"isFileMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","ChannelFileMessage","VendorFileMessage"])}},{key:"isImageMessage",value:function(){return this.assert("MessageType",["PeerImageMessage","ChannelImageMessage","VendorImageMessage"])}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","PeerTextMessage","PeerImageMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),e}(hs),hD=function(r){function e(h){return W(this,e),m(n(h=d.call(this,h,"ChatManager")),"dialogueLru",new Sx(void 0,{maxlen:1e4,ttl:1e4})),h}la(e,r);var d=ma(e);return Ha(e,[{key:"getChatInfo",value:function(h){var f=this.dialogueLru.get(h);if(this.dialogueLru.prune(),f){var g=f.dialogue,C={dialogue:g,sequence:f=f.sequence.add(1)};return this.dialogueLru.set(h,{dialogue:g,sequence:f}),C}return g={dialogue:Bg(),sequence:U.fromNumber(1,!0)},this.dialogueLru.set(h,g),g}}]),e}(tb()),v={};X(module)=="object"&&(module.exports=v),v.parse=function(r,e){var d,h=v.bin.readUshort,f=v.bin.readUint,g={};for(d=(r=new Uint8Array(r)).length-4;f(r,d)!=101010256;)d--;var C=h(r,d=d+4+4);h(r,d+=2),f(r,d+=2),d=f(r,d+=4);for(var P=0;P<C;P++){f(r,d),d+=4,d+=4,d+=4,f(r,d+=4);var x=f(r,d+=4),B=f(r,d+=4),Vt=h(r,d+=4),_r=h(r,d+2),_e=h(r,d+4);d+=6;var _i=f(r,d+=8);d+=4,d+=Vt+_r+_e,v._readLocal(r,_i,g,x,B,e)}return g},v._readLocal=function(r,e,d,h,f,g){var C=v.bin.readUshort,P=v.bin.readUint;P(r,e),C(r,e+=4),C(r,e+=2);var x=C(r,e+=2);P(r,e+=2),P(r,e+=4),P=C(r,e=e+4+8);var B=C(r,e+=2);if(e+=2,C=v.bin.readUTF8(r,e,P),e=e+P+B,g)d[C]={size:f,csize:h};else if(r=new Uint8Array(r.buffer,e),x==0)d[C]=new Uint8Array(r.buffer.slice(e,e+h));else{if(x!=8)throw"unknown compression method: "+x;e=new Uint8Array(f),v.inflateRaw(r,e),d[C]=e}},v.inflateRaw=function(r,e){return v.F.inflate(r,e)},v.inflate=function(r,e){return r[0],r[1],v.inflateRaw(new Uint8Array(r.buffer,r.byteOffset+2,r.length-2),e)},v.deflate=function(r,e){e==null&&(e={level:6});var d=0,h=new Uint8Array(50+Math.floor(1.1*r.length));return h[d]=120,h[d+1]=156,d=v.F.deflateRaw(r,h,d+2,e.level),r=v.adler(r,0,r.length),h[d+0]=r>>>24&255,h[d+1]=r>>>16&255,h[d+2]=r>>>8&255,h[d+3]=r>>>0&255,new Uint8Array(h.buffer,0,d+4)},v.deflateRaw=function(r,e){e==null&&(e={level:6});var d=new Uint8Array(50+Math.floor(1.1*r.length)),h=v.F.deflateRaw(r,d,h,e.level);return new Uint8Array(d.buffer,0,h)},v.encode=function(r,e){e==null&&(e=!1);var d,h=0,f=v.bin.writeUint,g=v.bin.writeUshort,C={};for(d in r){var P=!v._noNeed(d)&&!e,x=r[d],B=v.crc.crc(x,0,x.length);C[d]={cpr:P,usize:x.length,crc:B,file:P?v.deflateRaw(x):x}}for(d in C)h+=C[d].file.length+30+46+2*v.bin.sizeUTF8(d);for(d in r=new Uint8Array(h+22),e=0,x=[],C)B=C[d],x.push(e),e=v._writeHeader(r,e,d,B,0);for(d in h=0,P=e,C)B=C[d],x.push(e),e=v._writeHeader(r,e,d,B,1,x[h++]);return C=e-P,f(r,e,101010256),g(r,e=e+4+4,h),g(r,e+=2,h),f(r,e+=2,C),f(r,e+4,P),r.buffer},v._noNeed=function(r){return r=r.split(".").pop().toLowerCase(),"png,jpg,jpeg,zip".indexOf(r)!=-1},v._writeHeader=function(r,e,d,h,f,g){var C=v.bin.writeUint,P=v.bin.writeUshort,x=h.file;return C(r,e,f==0?67324752:33639248),e+=4,f==1&&(e+=2),P(r,e,20),P(r,e+=2,0),P(r,e+=2,h.cpr?8:0),C(r,e+=2,0),C(r,e+=4,h.crc),C(r,e+=4,x.length),C(r,e+=4,h.usize),P(r,e+=4,v.bin.sizeUTF8(d)),P(r,e+=2,0),e+=2,f==1&&(C(r,e=e+2+2+6,g),e+=4),e+=d=v.bin.writeUTF8(r,e,d),f==0&&(r.set(x,e),e+=x.length),e},v.crc={table:function(){for(var r=new Uint32Array(256),e=0;256>e;e++){for(var d=e,h=0;8>h;h++)d=1&d?3988292384^d>>>1:d>>>1;r[e]=d}return r}(),update:function(r,e,d,h){for(var f=0;f<h;f++)r=v.crc.table[255&(r^e[d+f])]^r>>>8;return r},crc:function(r,e,d){return 4294967295^v.crc.update(4294967295,r,e,d)}},v.adler=function(r,e,d){var h=1,f=0,g=e;for(e+=d;g<e;){for(d=Math.min(g+5552,e);g<d;)f+=h+=r[g++];h%=65521,f%=65521}return f<<16|h},v.bin={readUshort:function(r,e){return r[e]|r[e+1]<<8},writeUshort:function(r,e,d){r[e]=255&d,r[e+1]=d>>8&255},readUint:function(r,e){return 16777216*r[e+3]+(r[e+2]<<16|r[e+1]<<8|r[e])},writeUint:function(r,e,d){r[e]=255&d,r[e+1]=d>>8&255,r[e+2]=d>>16&255,r[e+3]=d>>24&255},readASCII:function(r,e,d){for(var h="",f=0;f<d;f++)h+=String.fromCharCode(r[e+f]);return h},writeASCII:function(r,e,d){for(var h=0;h<d.length;h++)r[e+h]=d.charCodeAt(h)},pad:function(r){return 2>r.length?"0"+r:r},readUTF8:function(r,e,d){for(var h,f="",g=0;g<d;g++)f+="%"+v.bin.pad(r[e+g].toString(16));try{h=decodeURIComponent(f)}catch{return v.bin.readASCII(r,e,d)}return h},writeUTF8:function(r,e,d){for(var h=d.length,f=0,g=0;g<h;g++){var C=d.charCodeAt(g);if(!(4294967168&C))r[e+f]=C,f++;else if(!(4294965248&C))r[e+f]=192|C>>6,r[e+f+1]=128|C>>0&63,f+=2;else if(!(4294901760&C))r[e+f]=224|C>>12,r[e+f+1]=128|C>>6&63,r[e+f+2]=128|C>>0&63,f+=3;else{if(4292870144&C)throw"e";r[e+f]=240|C>>18,r[e+f+1]=128|C>>12&63,r[e+f+2]=128|C>>6&63,r[e+f+3]=128|C>>0&63,f+=4}}return f},sizeUTF8:function(r){for(var e=r.length,d=0,h=0;h<e;h++){var f=r.charCodeAt(h);if(!(4294967168&f))d++;else if(!(4294965248&f))d+=2;else if(!(4294901760&f))d+=3;else{if(4292870144&f)throw"e";d+=4}}return d}},v.F={},v.F.deflateRaw=function(r,e,d,h){var f=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][h],g=v.F.U,C=v.F._goodIndex;v.F._hash;var P=v.F._putsE,x=0;d<<=3;var B=0,Vt=r.length;if(h==0){for(;x<Vt;){var _r=Math.min(65535,Vt-x);P(e,d,x+_r==Vt?1:0),d=v.F._copyExact(r,x,_r,e,d+8),x+=_r}return d>>>3}P=g.lits,h=g.strt;var _e=g.prev,_i=0,_a=0,kc=0,_d=0,_l=0;for(2<Vt&&(h[_l=v.F._hash(r,0)]=0),x=0;x<Vt;x++){if(_r=_l,x+1<Vt-2){_l=v.F._hash(r,x+1);var _h=x+1&32767;_e[_h]=h[_l],h[_l]=_h}if(B<=x){if((14e3<_i||26697<_a)&&100<Vt-x&&(B<x&&(P[_i]=x-B,_i+=2,B=x),d=v.F._writeBlock(x==Vt-1||B==Vt?1:0,P,_i,_d,r,kc,x-kc,e,d),_i=_a=_d=0,kc=x),_h=0,x<Vt-2&&(_h=v.F._bestMatch(r,x,_e,_r,Math.min(f[2],Vt-x),f[3])),_h!=0){_r=_h>>>16,_h&=65535;var rE=C(_r,g.of0);g.lhst[257+rE]++;var aE=C(_h,g.df0);g.dhst[aE]++,_d+=g.exb[rE]+g.dxb[aE],P[_i]=_r<<23|x-B,P[_i+1]=_h<<16|rE<<8|aE,_i+=2,B=x+_r}else g.lhst[r[x]]++;_a++}}for(kc==x&&r.length!=0||(B<x&&(P[_i]=x-B,_i+=2),d=v.F._writeBlock(1,P,_i,_d,r,kc,x-kc,e,d));7&d;)d++;return d>>>3},v.F._bestMatch=function(r,e,d,h,f,g){var C=32767&e,P=d[C],x=C-P+32768&32767;if(P==C||h!=v.F._hash(r,e-x))return 0;for(var B=h=0,Vt=Math.min(32767,e);x<=Vt&&--g!=0&&P!=C;){if((h==0||r[e+h]==r[e+h-x])&&(C=v.F._howLong(r,e,x))>h){if(B=x,(h=C)>=f)break;x+2<C&&(C=x+2);for(var _r=0,_e=0;_e<C-2;_e++){var _i=e-x+_e+32768&32767,_a=_i-d[_i]+32768&32767;_a>_r&&(_r=_a,P=_i)}}x+=(C=P)-(P=d[C])+32768&32767}return h<<16|B},v.F._howLong=function(r,e,d){if(r[e]!=r[e-d]||r[e+1]!=r[e+1-d]||r[e+2]!=r[e+2-d])return 0;var h=e,f=Math.min(r.length,e+258);for(e+=3;e<f&&r[e]==r[e-d];)e++;return e-h},v.F._hash=function(r,e){return(r[e]<<8|r[e+1])+(r[e+2]<<4)&65535},v.saved=0,v.F._writeBlock=function(r,e,d,h,f,g,C,P,x){var B=v.F.U,Vt=v.F._putsF,_r=v.F._putsE;B.lhst[256]++;var _e=v.F.getTrees(),_i=_e[0],_a=_e[1],kc=_e[2],_d=_e[3],_l=_e[4],_h=_e[5],rE=_e[6];_e=_e[7];var aE=32+(x+3&7?8-(x+3&7):0)+(C<<3),yE=h+v.F.contSize(B.fltree,B.lhst)+v.F.contSize(B.fdtree,B.dhst);h=h+v.F.contSize(B.ltree,B.lhst)+v.F.contSize(B.dtree,B.dhst),h+=14+3*_h+v.F.contSize(B.itree,B.ihst)+(2*B.ihst[16]+3*B.ihst[17]+7*B.ihst[18]);for(var gE=0;286>gE;gE++)B.lhst[gE]=0;for(gE=0;30>gE;gE++)B.dhst[gE]=0;for(gE=0;19>gE;gE++)B.ihst[gE]=0;if(aE=aE<yE&&aE<h?0:yE<h?1:2,Vt(P,x,r),Vt(P,x+1,aE),x+=3,aE==0){for(;7&x;)x++;x=v.F._copyExact(f,g,C,P,x)}else{if(aE==1)var bE=B.fltree,GE=B.fdtree;if(aE==2){for(v.F.makeCodes(B.ltree,_i),v.F.revCodes(B.ltree,_i),v.F.makeCodes(B.dtree,_a),v.F.revCodes(B.dtree,_a),v.F.makeCodes(B.itree,kc),v.F.revCodes(B.itree,kc),bE=B.ltree,GE=B.dtree,_r(P,x,_d-257),_r(P,x+=5,_l-1),_r(P,x+=5,_h-4),x+=4,r=0;r<_h;r++)_r(P,x+3*r,B.itree[1+(B.ordr[r]<<1)]);x=v.F._codeTiny(rE,B.itree,P,x+3*_h),x=v.F._codeTiny(_e,B.itree,P,x)}for(_h=0;_h<d;_h+=2){for(rE=(r=e[_h])>>>23,r=g+(8388607&r);g<r;)x=v.F._writeLit(f[g++],bE,P,x);rE!=0&&(r=(_i=e[_h+1])>>16,C=_i>>8&255,_i&=255,_r(P,x=v.F._writeLit(257+C,bE,P,x),rE-B.of0[C]),x+=B.exb[C],Vt(P,x=v.F._writeLit(_i,GE,P,x),r-B.df0[_i]),x+=B.dxb[_i],g+=rE)}x=v.F._writeLit(256,bE,P,x)}return x},v.F._copyExact=function(r,e,d,h,f){var g=f>>>3;return h[g]=d,h[g+1]=d>>>8,h[g+2]=255-h[g],h[g+3]=255-h[g+1],g+=4,h.set(new Uint8Array(r.buffer,e,d),g),f+(d+4<<3)},v.F.getTrees=function(){for(var r=v.F.U,e=v.F._hufTree(r.lhst,r.ltree,15),d=v.F._hufTree(r.dhst,r.dtree,15),h=[],f=v.F._lenCodes(r.ltree,h),g=[],C=v.F._lenCodes(r.dtree,g),P=0;P<h.length;P+=2)r.ihst[h[P]]++;for(P=0;P<g.length;P+=2)r.ihst[g[P]]++;P=v.F._hufTree(r.ihst,r.itree,7);for(var x=19;4<x&&r.itree[1+(r.ordr[x-1]<<1)]==0;)x--;return[e,d,P,f,C,x,h,g]},v.F.getSecond=function(r){for(var e=[],d=0;d<r.length;d+=2)e.push(r[d+1]);return e},v.F.nonZero=function(r){for(var e="",d=0;d<r.length;d+=2)r[d+1]!=0&&(e+=(d>>1)+",");return e},v.F.contSize=function(r,e){for(var d=0,h=0;h<e.length;h++)d+=e[h]*r[1+(h<<1)];return d},v.F._codeTiny=function(r,e,d,h){for(var f=0;f<r.length;f+=2){var g=r[f],C=r[f+1];h=v.F._writeLit(g,e,d,h);var P=g==16?2:g==17?3:7;15<g&&(v.F._putsE(d,h,C,P),h+=P)}return h},v.F._lenCodes=function(r,e){for(var d=r.length;d!=2&&r[d-1]==0;)d-=2;for(var h=0;h<d;h+=2){var f=r[h+1],g=h+3<d?r[h+3]:-1,C=h+5<d?r[h+5]:-1,P=h==0?-1:r[h-1];if(f==0&&g==f&&C==f){for(g=h+5;g+2<d&&r[g+2]==f;)g+=2;11>(f=Math.min(g+1-h>>>1,138))?e.push(17,f-3):e.push(18,f-11),h+=2*f-2}else if(f==P&&g==f&&C==f){for(g=h+5;g+2<d&&r[g+2]==f;)g+=2;f=Math.min(g+1-h>>>1,6),e.push(16,f-3),h+=2*f-2}else e.push(f,0)}return d>>>1},v.F._hufTree=function(r,e,d){var h=[],f=r.length,g=e.length,C=0;for(C=0;C<g;C+=2)e[C]=0,e[C+1]=0;for(C=0;C<f;C++)r[C]!=0&&h.push({lit:C,f:r[C]});if(r=h.length,f=h.slice(0),r==0)return 0;if(r==1)return e[1+((d=h[0].lit)<<1)]=1,e[1+((d==0?1:0)<<1)]=1;h.sort(function(Vt,_r){return Vt.f-_r.f}),C=h[0],g=h[1];var P=0,x=1,B=2;for(h[0]={lit:-1,f:C.f+g.f,l:C,r:g,d:0};x!=r-1;)C=P!=x&&(B==r||h[P].f<h[B].f)?h[P++]:h[B++],g=P!=x&&(B==r||h[P].f<h[B].f)?h[P++]:h[B++],h[x++]={lit:-1,f:C.f+g.f,l:C,r:g};for((h=v.F.setDepth(h[x-1],0))>d&&(v.F.restrictDepth(f,d,h),h=d),C=0;C<r;C++)e[1+(f[C].lit<<1)]=f[C].d;return h},v.F.setDepth=function(r,e){return r.lit!=-1?r.d=e:Math.max(v.F.setDepth(r.l,e+1),v.F.setDepth(r.r,e+1))},v.F.restrictDepth=function(r,e,d){var h=0,f=1<<d-e,g=0;for(r.sort(function(P,x){return x.d==P.d?P.f-x.f:x.d-P.d}),h=0;h<r.length&&r[h].d>e;h++){var C=r[h].d;r[h].d=e,g+=f-(1<<d-C)}for(g>>>=d-e;0<g;)(C=r[h].d)<e?(r[h].d++,g-=1<<e-C-1):h++;for(;0<=h;h--)r[h].d==e&&0>g&&(r[h].d--,g++);g!=0&&console.log("debt left")},v.F._goodIndex=function(r,e){var d=0;return e[16|d]<=r&&(d|=16),e[8|d]<=r&&(d|=8),e[4|d]<=r&&(d|=4),e[2|d]<=r&&(d|=2),e[1|d]<=r&&(d|=1),d},v.F._writeLit=function(r,e,d,h){return v.F._putsF(d,h,e[r<<1]),h+e[1+(r<<1)]},v.F.inflate=function(r,e){var d=Uint8Array;if(r[0]==3&&r[1]==0)return e||new d(0);var h=v.F,f=h._bitsF,g=h._bitsE,C=h._decodeTiny,P=h.makeCodes,x=h.codes2map,B=h._get17,Vt=h.U,_r=e==null;_r&&(e=new d(r.length>>>2<<3));for(var _e,_i,_a,kc,_d=0,_l=0,_h=_i=0,rE=0;_d==0;)if(_d=f(r,rE,1),_e=f(r,rE+1,2),rE+=3,_e==0)7&rE&&(rE+=8-(7&rE)),_e=r[(rE=4+(rE>>>3))-4]|r[rE-3]<<8,_r&&(e=v.F._check(e,_h+_e)),e.set(new d(r.buffer,r.byteOffset+rE,_e),_h),rE=rE+_e<<3,_h+=_e;else{if(_r&&(e=v.F._check(e,_h+131072)),_e==1&&(_a=Vt.flmap,kc=Vt.fdmap,_l=511,_i=31),_e==2){for(_i=g(r,rE,5)+257,_e=g(r,rE+5,5)+1,_a=g(r,rE+10,4)+4,rE+=14,kc=0;38>kc;kc+=2)Vt.itree[kc]=0,Vt.itree[kc+1]=0;for(_l=1,kc=0;kc<_a;kc++){var aE=g(r,rE+3*kc,3);Vt.itree[1+(Vt.ordr[kc]<<1)]=aE,aE>_l&&(_l=aE)}rE+=3*_a,P(Vt.itree,_l),x(Vt.itree,_l,Vt.imap),_a=Vt.lmap,kc=Vt.dmap,rE=C(Vt.imap,(1<<_l)-1,_i+_e,r,rE,Vt.ttree),_l=(1<<(aE=h._copyOut(Vt.ttree,0,_i,Vt.ltree)))-1,_i=(1<<(_e=h._copyOut(Vt.ttree,_i,_e,Vt.dtree)))-1,P(Vt.ltree,aE),x(Vt.ltree,aE,_a),P(Vt.dtree,_e),x(Vt.dtree,_e,kc)}for(;;)if(rE+=15&(_e=_a[B(r,rE)&_l]),(aE=_e>>>4)>>>8==0)e[_h++]=aE;else{if(aE==256)break;_e=_h+aE-254,264<aE&&(_e=_h+((aE=Vt.ldef[aE-257])>>>3)+g(r,rE,7&aE),rE+=7&aE),rE+=15&(aE=kc[B(r,rE)&_i]);var yE=((aE=Vt.ddef[aE>>>4])>>>4)+f(r,rE,15&aE);for(rE+=15&aE,_r&&(e=v.F._check(e,_h+131072));_h<_e;)e[_h]=e[_h++-yE],e[_h]=e[_h++-yE],e[_h]=e[_h++-yE],e[_h]=e[_h++-yE];_h=_e}}return e.length==_h?e:e.slice(0,_h)},v.F._check=function(r,e){var d=r.length;return e<=d?r:((e=new Uint8Array(Math.max(d<<1,e))).set(r,0),e)},v.F._decodeTiny=function(r,e,d,h,f,g){for(var C=v.F._bitsE,P=v.F._get17,x=0;x<d;){var B=r[P(h,f)&e];f+=15&B;var Vt=B>>>4;if(15>=Vt)g[x]=Vt,x++;else{var _r=B=0;for(Vt==16?(_r=3+C(h,f,2),f+=2,B=g[x-1]):Vt==17?(_r=3+C(h,f,3),f+=3):Vt==18&&(_r=11+C(h,f,7),f+=7),Vt=x+_r;x<Vt;)g[x]=B,x++}}return f},v.F._copyOut=function(r,e,d,h){for(var f=0,g=0,C=h.length>>>1;g<d;){var P=r[g+e];h[g<<1]=0,h[1+(g<<1)]=P,P>f&&(f=P),g++}for(;g<C;)h[g<<1]=0,h[1+(g<<1)]=0,g++;return f},v.F.makeCodes=function(r,e){var d,h,f=v.F.U,g=r.length,C=f.bl_count;for(d=0;d<=e;d++)C[d]=0;for(d=1;d<g;d+=2)C[r[d]]++;for(f=f.next_code,d=0,C[0]=0,h=1;h<=e;h++)d=d+C[h-1]<<1,f[h]=d;for(e=0;e<g;e+=2)(C=r[e+1])!=0&&(r[e]=f[C],f[C]++)},v.F.codes2map=function(r,e,d){for(var h=r.length,f=v.F.U.rev15,g=0;g<h;g+=2)if(r[g+1]!=0){var C=r[g+1],P=g>>1<<4|C,x=e-C;for(x=(C=r[g]<<x)+(1<<x);C!=x;)d[f[C]>>>15-e]=P,C++}},v.F.revCodes=function(r,e){for(var d=v.F.U.rev15,h=15-e,f=0;f<r.length;f+=2)r[f]=d[r[f]<<e-r[f+1]]>>>h},v.F._putsE=function(r,e,d){d<<=7&e,r[e>>>=3]|=d,r[e+1]|=d>>>8},v.F._putsF=function(r,e,d){d<<=7&e,r[e>>>=3]|=d,r[e+1]|=d>>>8,r[e+2]|=d>>>16},v.F._bitsE=function(r,e,d){return(r[e>>>3]|r[1+(e>>>3)]<<8)>>>(7&e)&(1<<d)-1},v.F._bitsF=function(r,e,d){return(r[e>>>3]|r[1+(e>>>3)]<<8|r[2+(e>>>3)]<<16)>>>(7&e)&(1<<d)-1},v.F._get17=function(r,e){return(r[e>>>3]|r[1+(e>>>3)]<<8|r[2+(e>>>3)]<<16)>>>(7&e)},v.F._get25=function(r,e){return(r[e>>>3]|r[1+(e>>>3)]<<8|r[2+(e>>>3)]<<16|r[3+(e>>>3)]<<24)>>>(7&e)},v.F.U=function(){var r=Uint16Array,e=Uint32Array;return{next_code:new r(16),bl_count:new r(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new r(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new e(32),flmap:new r(512),fltree:[],fdmap:new r(32),fdtree:[],lmap:new r(32768),ltree:[],ttree:[],dmap:new r(32768),dtree:[],imap:new r(512),itree:[],rev15:new r(32768),lhst:new e(286),dhst:new e(30),ihst:new e(19),lits:new e(15e3),strt:new r(65536),prev:new r(32768)}}(),function(){function r(f,g,C){for(;g--!=0;)f.push(0,C)}for(var e=v.F.U,d=0;32768>d;d++){var h=d;h=(4278255360&(h=(4042322160&(h=(3435973836&(h=(2863311530&h)>>>1|(1431655765&h)<<1))>>>2|(858993459&h)<<2))>>>4|(252645135&h)<<4))>>>8|(16711935&h)<<8,e.rev15[d]=(h>>>16|h<<16)>>>17}for(d=0;32>d;d++)e.ldef[d]=e.of0[d]<<3|e.exb[d],e.ddef[d]=e.df0[d]<<4|e.dxb[d];r(e.fltree,144,8),r(e.fltree,112,9),r(e.fltree,24,7),r(e.fltree,8,8),v.F.makeCodes(e.fltree,9),v.F.codes2map(e.fltree,9,e.flmap),v.F.revCodes(e.fltree,9),r(e.fdtree,32,5),v.F.makeCodes(e.fdtree,5),v.F.codes2map(e.fdtree,5,e.fdmap),v.F.revCodes(e.fdtree,5),r(e.itree,19,0),r(e.ltree,286,0),r(e.dtree,30,0),r(e.ttree,320,0)}();var iD=["backups","servers"],jD=["backups","servers"],kD=["group"],nl=v.inflate,ks=v.deflate,ls=function(r){function e(h,f,g,C){W(this,e);var P=d.call(this,C,"Session");return m(n(P),"chatManager",void 0),m(n(P),"joinedChannels",new Set),m(n(P),"msgDedupLru",new tc(void 0,{maxlen:200})),m(n(P),"startTime",Date.now()),m(n(P),"seq",U.fromNumber(1,!0)),m(n(P),"userJoinOptions",new is(!1)),m(n(P),"seqSentStatuses",[!1,!1]),m(n(P),"dialogueSequenceLru",new tc(void 0,{maxlen:1e4})),m(n(P),"loggedOut",!1),m(n(P),"messageSentTimes",[]),m(n(P),"curLoginSockets",[void 0,void 0]),m(n(P),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),m(n(P),"lastLoginSockets",[new qe(1),new qe(1)]),m(n(P),"dialPendingMsgSubjectMap",new Map),m(n(P),"context",void 0),m(n(P),"connection",void 0),m(n(P),"instanceId",void 0),m(n(P),"registerSocketsFailureListener",function(){P.connection.once("socketsFailure",function(){P.log("socketsFailure, creating a new connection"),ad(function(){return P.connection.removeAllListeners(),P.connection=new Yr(P.context,P.logger,!0),P.loginHandler(15e3,!0)}).pipe(oe(function(x){return x.pipe(cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")))}),ob(P.connection.apClient.apFinish$)).subscribe(function(){P.log("new connection connected")})}),P.connection.listenerCount("tokenExpired")===0&&P.connection.on("tokenExpired",function(){P.emit("tokenExpired")})}),P.context=h,P.connection=f,P.instanceId=g,P.chatManager=new hD(C),P.log("The instanceId is %s",P.instanceId.toString()),P}la(e,r);var d=ma(e);return Ha(e,[{key:"fetchFileUploadIndexGet",value:function(h){var f=h.hash,g=h.size;if((h=this.getLoginSockets()).length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return h.forEach(function(P){P.sendPacket("FileUploadIndexGet",{seq:C,hash:f,size:g})}),{ret:Ca.apply(void 0,G(h.map(function(P){return P.fromReceived("FileUploadIndexRet").pipe(aa(function(x){return C.eq(x.seq)}))}))),fin:Ca.apply(void 0,G(h.map(function(P){return P.fromReceived("FileUploadIndexFin").pipe(aa(function(x){return C.eq(x.seq)}))}))),err:Xb.apply(void 0,G(h.map(function(P){return P.fromReceived("FileUploadIndexErr").pipe(aa(function(x){return C.eq(x.seq)}),ba(function(x){throw new da(["The media message upload failure, code %d",x.code],lg)}))}))),timeout:e.genTimeoutError(Lh)}}},{key:"requestFileUploadIndexSet",value:function(h){var f=h.hash,g=h.unit,C=h.servers;if((h=this.getLoginSockets()).length===0)throw new K("Client is not logged in");var P=this.incGetSeq();return h.forEach(function(x){x.sendPacket("FileUploadIndexSet",{seq:P,servers:C,hash:f,unit:g})}),Ca.apply(void 0,[e.genTimeoutError(Lh)].concat(G(h.map(function(x){return x.fromReceived("FileUploadIndexErr").pipe(aa(function(B){return P.eq(B.seq)}),ba(function(B){throw new da(["FileUploadIndexSet failure, code %d",B.code],lg)}))})),G(h.map(function(x){return x.fromReceived("FileUploadIndexFin").pipe(aa(function(B){return P.eq(B.seq)}))}))))}},{key:"requestFileDownloadIndexGet",value:function(h){var f=h.size,g=h.zone,C=h.unit,P=h.hash,x=this.getLoginSockets();if(x.length===0)throw new K("Client is not logged in");var B=this.incGetSeq();return x.forEach(function(Vt){Vt.sendPacket("FileDownloadIndexGet",{seq:B,size:f,zone:g,unit:C,hash:P})}),h=Ca.apply(void 0,G(x.map(function(Vt){return Vt.fromReceived("FileDownloadIndexRet").pipe(aa(function(_r){return B.eq(_r.seq)}))}))).pipe(ba(function(Vt){var _r=Vt.backups,_e=Vt.servers;return Vt=ff(Vt,iD),ua({backupList:_r.map(function(_i){return[_i]}),serverList:_e.map(function(_i){return[_i]})},Vt)}),cd(500)),x=jm(x.map(function(Vt){return Vt.fromReceived("FileDownloadIndexRet").pipe(aa(function(_r){return B.eq(_r.seq)}))})),Ca(h,x.pipe(ba(function(Vt){return Vt.reduce(function(_r,_e){var _i=_r.backupList,_a=_r.serverList;_r=_e.backups;var kc=_e.servers;return _e=ff(_e,jD),ua({backupList:_r.map(function(_d,_l){return[_d].concat(G(_i!==void 0&&Array.isArray(_i[_l])?_i[_l]:[]))}),serverList:kc.map(function(_d,_l){return[_d].concat(G(_i!==void 0&&Array.isArray(_a[_l])?_a[_l]:[]))})},_e)},{})})),e.genTimeoutError(Lh))}},{key:"loginHandler",value:function(){var h=this,f=0<arguments.length&&arguments[0]!==void 0?arguments[0]:2e4,g=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(this.loggedOut&&g)throw new K("Already logged out, request ignored");g&&this.registerSocketsFailureListener(),this.connection.initConnection();var C=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),P=Date.now();return C.forEach(function(x,B){var Vt=h.loginSocketSubs[B].login;Vt!==void 0&&Vt.unsubscribe(),h.loginSocketSubs[B].login=x.pipe(ca(function(_r){var _e;h.curLoginSockets[B]=_r;var _i=Date.now();eb("Link",{ackedServerIp:_r.address,destServerIp:_r.ip,ec:0,sc:0,elapse:fb(h.startTime),lts:U.fromNumber(_i),responseTime:P-_i,sid:Xa(h.instanceId),userId:h.context.uid},(_e=h.context.config.enableCloudProxy)!==null&&_e!==void 0&&_e),h.emit("userJoined",_r.env),g&&h.connection.apClient.apFinish$.next(void 0)})).subscribe(h.lastLoginSockets[B])}),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Xb.apply(void 0,G(C).concat([gb(this.connection,"connectionInitFailure").pipe(ca(function(x){throw sa(x)||Sa(x)?x:new da("Login failure",{code:Zq,originalError:x})}))])).pipe(Ka(1),hb(f),Ga(function(x){return x instanceof pb&&h.warn("Client login timeout"),x&&x.code===Kh&&(h.connection.emit("tokenExpired"),h.connection.apClient.apFinish$.next(void 0)),h.clearSockets(0,g),Z(x)}),ca(function(){g||h.registerSocketsFailureListener()}),wg(function(){g||h.connection.apClient.apFinish$.next(void 0)}))}},{key:"logoutHandler",value:function(){var h=J(w.mark(function f(){var g,C,P,x=this;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),g=this.getLoginSockets(),C=g.map(function(Vt){return Vt.sendPacket("UserQuit",{}),x.connection.waitClosing(Vt)}),this.clearSockets(5e3),P=g.map(function(Vt){return Vt.env}),[0,1].filter(function(Vt){return!P.includes(Vt)}).forEach(function(Vt){x.connection.closeSocket(Vt,0)}),B.abrupt("return",Xb.apply(void 0,G(C)).toPromise());case 9:case"end":return B.stop()}},f,this)}));return function(){return h.apply(this,arguments)}}()},{key:"requestChannelJoin",value:function(){var h=J(w.mark(function f(g,C){var P,x,B,Vt=this;return w.wrap(function(_r){for(;;)switch(_r.prev=_r.next){case 0:if(this.getLoginSockets().length!==0){_r.next=2;break}throw new K("Client is not logged in. Cannot join the channel",Vq);case 2:return P=gb(this,"channelLeft").pipe(wb(function(_e){return _e===g}),Ka(1)),x=this.incGetSeq(),(B=this.lastLoginSockets.map(function(_e){return _e.pipe(Cc(function(_i,_a){_a!==0&&Vt.incSeqIfNeeded(_i.env);var kc=_a===0?x:Vt.seq;return _i.sendPacket("GroupEnter",{account:C,seq:kc}),_i.fromReceived("GroupReply").pipe(aa(function(_d){return kc.eq(_d.seq)}),ca(function(_d){if((_d=_d.code)!==0)throw new da(["Channel join failure. The response code is %d",_d],Rq)}))}),ob(P),pe())})).forEach(function(_e,_i){var _a=function(){return Vt.loginSocketSubs[_i].channels.delete(g.channelId)};Vt.loginSocketSubs[_i].channels.set(g.channelId,_e.subscribe({error:_a,complete:_a}))}),_r.next=8,Xb.apply(void 0,G(B)).pipe(Ka(1),hb(1e4),Ga(function(_e){return _e instanceof pb&&Vt.warn("Channel join timeout"),Z(_e)})).toPromise();case 8:this.joinedChannels.add(g);case 9:case"end":return _r.stop()}},f,this)}));return function(f,g){return h.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(h,f){this.emit("channelLeft",h),this.joinedChannels.delete(h),this.getLoginSockets().forEach(function(g){g.sendPacket("GroupLeave",{account:f})})}},{key:"requestChannelMemberList",value:function(h){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in. Cannot get the channel members",cA);var g=this.incGetSeq();return f.forEach(function(C){C.sendPacket("GroupAllUsersList",{group:h,pageNumber:0,pageSize:200,seq:g})}),Ca.apply(void 0,[e.genTimeoutError(Pq)].concat(G(f.map(function(C){return C.fromReceived("GroupAllUsersResult").pipe(aa(function(P){var x=P.seq;return P.group===h&&g.eq(x)}))}))))}},{key:"requestPeersOnlineStatus",value:function(h){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();return f.forEach(function(C){C.sendPacket("UserStatusList",{users:h,seq:g})}),Ca.apply(void 0,[e.genTimeoutError(oA)].concat(G(f.map(function(C){return C.fromReceived("UserStatusResult").pipe(aa(function(P){return g.eq(P.seq)}))}))))}},{key:"requestSetLocalUserAttributes",value:function(h,f){var g=this,C=this.getLoginSockets();if(C.length===0)throw new K("Client is not logged in");var P=this.incGetSeq();return C.forEach(function(x,B){f!==void 0&&B!==f||x.sendPacket("UserAttributeSet",{account:g.context.uid,attributeInfos:Object.entries(h).map(function(Vt){return{key:(Vt=ra(Vt,2))[0],value:Vt[1]}}),seq:P})}),Ca.apply(void 0,G(C.map(function(x){return x.fromReceived("UserAttributeErr").pipe(aa(function(B){return P.eq(B.seq)}),ba(function(B){throw new da(["The user attributes set failure, code %d",B.code],Sb)}))})).concat([e.genTimeoutError(Tb)],G(C.map(function(x){return x.fromReceived("UserAttributeRsp").pipe(aa(function(B){return P.eq(B.seq)}))}))))}},{key:"requestSetChannelAttributes",value:function(h,f,g){var C=this.getLoginSockets();if(C.length===0)throw new K("Client is not logged in");var P=this.incGetSeq();return C.forEach(function(x){x.sendPacket("GroupAttributeSet",{broadcast:g,group:h,attributeInfos:Object.entries(f).map(function(B){return{key:(B=ra(B,2))[0],value:B[1]}}),seq:P})}),Ca.apply(void 0,G(C.map(function(x){return x.fromReceived("GroupAttributeErr").pipe(aa(function(B){return P.eq(B.seq)}),ba(function(B){throw new da(["The group attributes set failure, code %d",B.code],Sb)}))})).concat([e.genTimeoutError(Tb)],G(C.map(function(x){return x.fromReceived("GroupAttributeRsp").pipe(aa(function(B){return P.eq(B.seq)}))}))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(h){var f=this,g=this.getLoginSockets();if(g.length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return g.forEach(function(P){P.sendPacket("UserAttributeMod",{account:f.context.uid,attributeInfos:Object.entries(h).map(function(x){return{key:(x=ra(x,2))[0],value:x[1]}}),seq:C})}),Ca.apply(void 0,G(g.map(function(P){return P.fromReceived("UserAttributeErr").pipe(aa(function(x){return C.eq(x.seq)}),ba(function(x){throw new da(["The user attributes add or update failure, code %d",x.code],Sb)}))})).concat([e.genTimeoutError(Tb)],G(g.map(function(P){return P.fromReceived("UserAttributeRsp").pipe(aa(function(x){return C.eq(x.seq)}))}))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(h,f,g){var C=this.getLoginSockets();if(C.length===0)throw new K("Client is not logged in");var P=this.incGetSeq();return C.forEach(function(x){x.sendPacket("GroupAttributeMod",{broadcast:g,group:h,attributeInfos:Object.entries(f).map(function(B){return{key:(B=ra(B,2))[0],value:B[1]}}),seq:P})}),Ca.apply(void 0,G(C.map(function(x){return x.fromReceived("GroupAttributeErr").pipe(aa(function(B){return P.eq(B.seq)}),ba(function(B){throw new da(["The group attributes add or update failure, code %d",B.code],Sb)}))})).concat([e.genTimeoutError(Tb)],G(C.map(function(x){return x.fromReceived("GroupAttributeRsp").pipe(aa(function(B){return P.eq(B.seq)}))}))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(h){var f=this,g=this.getLoginSockets();if(g.length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return g.forEach(function(P){P.sendPacket("UserAttributeDel",{account:f.context.uid,attributes:h,seq:C})}),Ca.apply(void 0,G(g.map(function(P){return P.fromReceived("UserAttributeErr").pipe(aa(function(x){return C.eq(x.seq)}),ba(function(x){throw new da(["The user attributes delete failure, code %d",x.code],Sb)}))})).concat([e.genTimeoutError(Tb)],G(g.map(function(P){return P.fromReceived("UserAttributeRsp").pipe(aa(function(x){return C.eq(x.seq)}))}))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(h,f,g){var C=this.getLoginSockets();if(C.length===0)throw new K("Client is not logged in");var P=this.incGetSeq();return C.forEach(function(x){x.sendPacket("GroupAttributeDel",{group:h,broadcast:g,attributes:f,seq:P})}),Ca.apply(void 0,G(C.map(function(x){return x.fromReceived("GroupAttributeErr").pipe(aa(function(B){return P.eq(B.seq)}),ba(function(B){throw new da(["The channel attributes delete failure, code %d",B.code],Sb)}))})).concat([e.genTimeoutError(Tb)],G(C.map(function(x){return x.fromReceived("GroupAttributeRsp").pipe(aa(function(B){return P.eq(B.seq)}))}))))}},{key:"requestClearLocalUserAttributes",value:function(){var h=this,f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();return f.forEach(function(C){C.sendPacket("UserAttributeSet",{account:h.context.uid,seq:g,attributeInfos:[]})}),Ca.apply(void 0,G(f.map(function(C){return C.fromReceived("UserAttributeErr").pipe(aa(function(P){return g.eq(P.seq)}),ba(function(P){throw new da(["The user attributes clear failure, code %d",P.code],Sb)}))})).concat([e.genTimeoutError(Tb)],G(f.map(function(C){return C.fromReceived("UserAttributeRsp").pipe(aa(function(P){return g.eq(P.seq)}))}))))}},{key:"requestClearChannelAttributes",value:function(h,f){var g=this.getLoginSockets();if(g.length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return g.forEach(function(P){P.sendPacket("GroupAttributeSet",{group:h,seq:C,attributeInfos:[],broadcast:f})}),Ca.apply(void 0,G(g.map(function(P){return P.fromReceived("GroupAttributeErr").pipe(aa(function(x){return C.eq(x.seq)}),ba(function(x){throw new da(["The channel attributes clear failure, code %d",x.code],Sb)}))})).concat([e.genTimeoutError(Tb)],G(g.map(function(P){return P.fromReceived("GroupAttributeRsp").pipe(aa(function(x){return C.eq(x.seq)}))}))))}},{key:"requestGetUserAttributesByKeys",value:function(h,f){var g=this.getLoginSockets();if(g.length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return g.forEach(function(P){P.sendPacket("UserAttributeGet",{account:h,seq:C,attributes:f})}),Ca.apply(void 0,[e.genTimeoutError(Tb)].concat(G(g.map(function(P){return P.fromReceived("UserAttributeErr").pipe(aa(function(x){return C.eq(x.seq)}),ba(function(x){throw(x=x.code)===10008?new da("The user requested is not online",Lq):new Wc(["User attribute operation unknown error code: %d",x],Sb)}))})),G(g.map(function(P){return P.fromReceived("UserAttributeRet").pipe(aa(function(x){return C.eq(x.seq)}))}))))}},{key:"requestGetChannelAttributesByKeys",value:function(h,f){var g=this.getLoginSockets();if(g.length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return g.forEach(function(P){P.sendPacket("GroupAttributeGet",{group:h,seq:C,attributes:f})}),Ca.apply(void 0,[e.genTimeoutError(Tb)].concat(G(g.map(function(P){return P.fromReceived("GroupAttributeErr").pipe(aa(function(x){return C.eq(x.seq)}),ba(function(x){throw new da(["The channel attributes get failure, code %d",x.code],Sb)}))})),G(g.map(function(P){return P.fromReceived("GroupAttributeRet").pipe(aa(function(x){return C.eq(x.seq)}))}))))}},{key:"requestGetUserAttributeKeys",value:function(h){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();return f.forEach(function(C){C.sendPacket("UserAttributeKeysGet",{account:h,seq:g})}),Ca.apply(void 0,[e.genTimeoutError(Tb)].concat(G(f.map(function(C){return C.fromReceived("UserAttributeErr").pipe(aa(function(P){return g.eq(P.seq)}),ba(function(P){throw(P=P.code)===10008?new da("The user requested is not online",Lq):new Wc(["User attribute operation unknown error code: %d",P],Sb)}))})),G(f.map(function(C){return C.fromReceived("UserAttributeKeysRet").pipe(aa(function(P){return g.eq(P.seq)}))}))))}},{key:"requestGetChannelAttributesKeys",value:function(h){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();return f.forEach(function(C){C.sendPacket("GroupAttributeKeysGet",{group:h,seq:g})}),Ca.apply(void 0,[e.genTimeoutError(Tb)].concat(G(f.map(function(C){return C.fromReceived("GroupAttributeErr").pipe(aa(function(P){return g.eq(P.seq)}),ba(function(P){throw new Wc(["Channel attribute operation unknown error code: %d",P.code],Sb)}))})),G(f.map(function(C){return C.fromReceived("GroupAttributeKeysRet").pipe(aa(function(P){return g.eq(P.seq)}))}))))}},{key:"requestGetChannelMemberCount",value:function(h){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();return f.forEach(function(C){C.sendPacket("GroupStatusList",{groups:h,seq:g})}),Ca.apply(void 0,[e.genTimeoutError(Pq)].concat(G(f.map(function(C){return C.fromReceived("GroupStatusResult").pipe(aa(function(P){return g.eq(P.seq)}))}))))}},{key:"requestSubscribePeersOnlineStatus",value:function(h){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();return f.forEach(function(C){C.sendPacket("SubscribeUserStatus",{seq:g,users:h})}),Ca.apply(void 0,[e.genTimeoutError(vA)].concat(G(f.map(function(C){return C.fromReceived("SubscribeResponse").pipe(aa(function(P){return g.eq(P.seq)}))}))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(h){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var g=this.incGetSeq();f.forEach(function(C){C.sendPacket("UnsubscribeUserStatus",{seq:g,users:h})})}},{key:"sendInvitationMessage",value:function(){var h=J(w.mark(function f(g){var C,P,x,B,Vt,_r,_e,_i,_a,kc,_d,_l,_h=this;return w.wrap(function(rE){for(;;)switch(rE.prev=rE.next){case 0:if(C=g.peerId,P=g.callId,x=g.extra,B=g.isAcceptAck,Vt=g.channelId,_r=g.type,_e={callId:P},B===void 0){rE.next=6;break}if(_r==="CallAccept"){rE.next=5;break}throw Error("invalid invitation type");case 5:_e.type=B?"ack":"request";case 6:return _e.channel=Vt,(_r==="CallInvite"||_r==="CallCancel"||_r==="CallReject"||_r==="CallAccept"&&B===!1)&&x!==void 0&&(_e.extra=x),_i=Bg(),this.log("The sent invitation body is %o",_e),_a=function(aE){return{MiscMap:{},sequence:U.fromNumber(1),dialogue:_i,instance:_h.instanceId,dst:C,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:aE,MessageType:_r}).toLong(),payload:new TextEncoder().encode(JSON.stringify(_e)),src:_h.context.uid}},rE.next=14,Kb(this.sendMessageToRetry(_a,!0)).pipe(hb(1e4),Ga(function(aE){return aE instanceof pb&&_h.warn("Send invitation timeout"),Z(aE)})).toPromise();case 14:return kc=rE.sent,_d=kc.code,_l=kc.retryTimes,rE.abrupt("return",{hasPeerReceived:_d===0,hasReSent:_l!==0});case 18:case"end":return rE.stop()}},f,this)}));return function(f){return h.apply(this,arguments)}}()},{key:"sendMediaMessage",value:function(){var h=J(w.mark(function f(g,C,P,x,B,Vt){var _r,_e,_i,_a,kc,_d,_l,_h,rE,aE,yE,gE,bE,GE,Qm,tE,EE,pE,TE,_p,eE,cE,SE,AE,t_,PE,v_,zE,K_,GS=this;return w.wrap(function(vT){for(;;)switch(vT.prev=vT.next){case 0:if(_e=C.width,_i=_e===void 0?0:_e,_a=C.height,kc=_a===void 0?0:_a,_d=C.fileName,_l=_d===void 0?"":_d,_h=C.description,rE=_h===void 0?"":_h,aE=C.thumbnail,yE=aE===void 0?new Blob:aE,gE=C.thumbnailHeight,bE=gE===void 0?0:gE,GE=C.thumbnailWidth,Qm=GE===void 0?0:GE,tE=C.size,EE=tE===void 0?0:tE,pE=C.mediaId,TE=B.enableOfflineMessaging,_p=B.enableHistoricalMessaging,za(P)){vT.next=4;break}throw new I("The send message arguments are not valid",x?$k:hg);case 4:if(!(32768<new Blob([_l,yE,rE]).size)){vT.next=6;break}throw new I("The size of message overflowed ",x?ve:Hh);case 6:return eE=this.chatManager.getChatInfo(P),cE=eE.dialogue,SE=eE.sequence,AE=this.instanceId,this.log('A%s media message is sending to %s: "'.concat(AE,"-").concat(cE,"#").concat(SE,'"'),x?" peer":" channel",oa(P)),m(_r={},"media_description",rE),m(_r,"media_width",_i),m(_r,"media_height",kc),m(_r,"media_thumbnailwidth",Qm),m(_r,"media_thumbnailheight",bE),m(_r,"media_size",EE),m(_r,"media_id",pE),m(_r,"media_filename",_l),t_=uc(_r,function(NS){return new TextEncoder().encode(NS.toString())}),vT.t0=Uint8Array,vT.next=14,Ji(yE);case 14:return vT.t1=vT.sent,t_.media_thumbnail=new vT.t0(vT.t1),PE=x&&g==="IMAGE"?"PeerImageMessage":x&&g==="FILE"?"PeerFileMessage":x||g!=="IMAGE"?"ChannelFileMessage":"ChannelImageMessage",v_=function(NS){return{MiscMap:t_,sequence:SE,dialogue:cE,instance:AE,dst:P,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:NS,CompressionMethod:"Uncompressed",MessageType:PE,ToCache:TE,ToArchive:_p}).toLong(),payload:new Uint8Array,src:GS.context.uid}},vT.next=20,Kb(this.sendMessageToRetry(v_,!0)).pipe(hb(Vt===void 0?1e4:Vt),Ga(function(NS){return NS instanceof pb&&GS.warn("Send message timeout"),Z(NS)})).toPromise();case 20:if(zE=vT.sent,(K_=zE.code)!==2){vT.next=24;break}throw new da("The peer does not support this type of message",nA);case 24:return vT.abrupt("return",{hasPeerReceived:K_===0});case 25:case"end":return vT.stop()}},f,this)}));return function(f,g,C,P,x,B){return h.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var h=J(w.mark(function f(g,C,P,x,B,Vt){var _r,_e,_i,_a,kc,_d,_l,_h,rE,aE,yE=this;return w.wrap(function(gE){for(;;)switch(gE.prev=gE.next){case 0:if(_r=B.enableOfflineMessaging,_e=B.enableHistoricalMessaging,za(P)&&g instanceof Uint8Array&&typeof C=="string"){gE.next=3;break}throw new I("The send message arguments are not valid",x?$k:hg);case 3:if(!(32768<g.byteLength+new Blob([C]).size)){gE.next=5;break}throw new ib("The message size is over the 32KB limit",x?ve:Hh);case 5:return _i=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=g.byteLength,_a=this.chatManager.getChatInfo(P),kc=_a.dialogue,_d=_a.sequence,_l=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(_l,"-").concat(kc,"#").concat(_d,'"'),_i?" compressed":"",x?"peer":"channel",oa(P)),_h=function(bE){return{MiscMap:{description:new TextEncoder().encode(C)},sequence:_d,dialogue:kc,instance:_l,dst:P,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:bE,CompressionMethod:_i?"Zlib":"Uncompressed",MessageType:x?"PeerRawMessage":"ChannelRawMessage",ToCache:_r,ToArchive:_e}).toLong(),payload:_i?ks(g):g,src:yE.context.uid}},gE.next=12,Kb(this.sendMessageToRetry(_h,!0)).pipe(hb(Vt===void 0?1e4:Vt),Ga(function(bE){return bE instanceof pb&&yE.warn("Send message timeout"),Z(bE)})).toPromise();case 12:return rE=gE.sent,aE=rE.code,gE.abrupt("return",{hasPeerReceived:aE===0});case 15:case"end":return gE.stop()}},f,this)}));return function(f,g,C,P,x,B){return h.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var h=J(w.mark(function f(g,C,P,x,B){var Vt,_r,_e,_i,_a,kc,_d,_l,_h,rE,aE,yE=this;return w.wrap(function(gE){for(;;)switch(gE.prev=gE.next){case 0:if(Vt=x.enableOfflineMessaging,_r=x.enableHistoricalMessaging,za(C)){gE.next=3;break}throw new I("The send message arguments are not valid",P?$k:hg);case 3:if(!(32768<new Blob([g]).size)){gE.next=5;break}throw new ib("The message size is over the 32KB limit",P?ve:Hh);case 5:return _e=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([g]).size,_i=this.chatManager.getChatInfo(C),_a=_i.dialogue,kc=_i.sequence,_d=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(_d,"-").concat(_a,"#").concat(kc,'"'),_e?" compressed":"",P?"peer":"channel",oa(C)),_l=new TextEncoder().encode(g),_h=function(bE){return{MiscMap:{},sequence:kc,dialogue:_a,instance:_d,dst:C,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:bE,CompressionMethod:_e?"Zlib":"Uncompressed",MessageType:P?"PeerTextMessage":"ChannelTextMessage",ToCache:Vt,ToArchive:_r}).toLong(),payload:_e?ks(_l):_l,src:yE.context.uid}},gE.next=13,Kb(this.sendMessageToRetry(_h,!0)).pipe(hb(B===void 0?1e4:B),Ga(function(bE){return bE instanceof pb&&yE.warn("Send message timeout"),Z(bE)})).toPromise();case 13:return rE=gE.sent,aE=rE.code,gE.abrupt("return",{hasPeerReceived:aE===0});case 16:case"end":return gE.stop()}},f,this)}));return function(f,g,C,P,x){return h.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(h,f){Object.entries(this.loginSocketSubs[h]).forEach(function(g){var C=(g=ra(g,2))[1];g[0]==="channels"&&f||(Array.isArray(C)||C instanceof Map?C.forEach(function(P){return P.unsubscribe()}):C&&C.unsubscribe())}),this.loginSocketSubs[h]={channels:f?this.loginSocketSubs[h].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var h=J(w.mark(function f(g,C){var P,x,B,Vt,_r,_e,_i,_a,kc,_d=this,_l=arguments;return w.wrap(function(_h){for(;;)switch(_h.prev=_h.next){case 0:if(P=2<_l.length&&_l[2]!==void 0?_l[2]:0,this.log("Attempt to send the message ".concat(C?" with retrying, %o":"without retrying"),{retryTimes:P}),(x=this.getLoginSockets()).length!==0){_h.next=5;break}throw Error("no logged-in sockets");case 5:return B=g(P),x.forEach(function(rE){rE.sendPacket("Message",B)}),Vt=B.dialogue,_r=B.sequence,_e=B.instance,_i=x.map(function(rE){return rE.fromReceived("Ack").pipe(wb(function(aE){return Vt.eq(aE.dialogue)&&_r.eq(aE.sequence)&&_e.eq(aE.instance)}))}),_h.prev=9,_h.next=12,Xb.apply(void 0,G(_i)).pipe(hb(6e3),Ga(function(rE){return Sa(rE)&&_d.warn("Message send timeout, retry times %d",P),Z(rE)}),Ka(1)).toPromise();case 12:return _a=_h.sent,kc=_a.code,this.log("The message has been acked, %o",{code:kc}),_h.abrupt("return",{code:kc,retryTimes:P});case 18:if(_h.prev=18,_h.t0=_h.catch(9),!(_h.t0 instanceof pb&&C)){_h.next=22;break}return _h.abrupt("return",this.sendMessageToRetry(g,!1,P+1));case 22:throw _h.t0;case 23:case"end":return _h.stop()}},f,this,[[9,18]])}));return function(f,g){return h.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var h=this;this.lastLoginSockets.map(function(f){return f.pipe(Cc(function(g){return Bc(0,2750).pipe(ca(function(){h.incSeqIfNeeded(g.env),g.sendPacket("Ping",{ms:U.fromNumber(Date.now(),!0),seq:h.seq})}))}))}).forEach(function(f,g){var C=h.loginSocketSubs[g].keepAlive;C!==void 0&&C.unsubscribe(),h.loginSocketSubs[g].keepAlive=f.subscribe({error:function(){}})})}},{key:"initKeepAliveReconnector",value:function(){var h=this;this.lastLoginSockets.map(function(f){return f.pipe(Cc(function(g){var C,P=!1,x=g.userJoin$.pipe(ca(function(){P=!0})),B=g.input$.pipe(ca(function(Vt){Li[Vt.uri].slice(0,-3)!=="Ping"&&(P=!1)}));return Xb(Bc(15e3,1e4).pipe(Pt(g.receivedPacket),ca(function(Vt){Vt=ra(Vt,2),Vt=ra(Vt[1],2)[1],C!==Vt||P||g.forceReconnect(),C=Vt})),x,B)}))}).forEach(function(f,g){var C=h.loginSocketSubs[g].keepAliveReconnector;C!==void 0&&C.unsubscribe(),h.loginSocketSubs[g].keepAliveReconnector=f.subscribe({error:function(){}})})}},{key:"initLoginReceiver",value:function(){var h=this;this.lastLoginSockets.map(function(f){return f.pipe(Cc(function(g){return Xb(gb(g,"reconnect").pipe(ca(h.onSocketReconnect(g))),g.fromReceived("Message").pipe(ca(h.onMessage(g))),g.fromReceived("GroupEnterNotice").pipe(ca(h.onGroupEnterNotice())),g.fromReceived("GroupLeaveNotice").pipe(ca(h.onGroupLeaveNotice())),g.fromReceived("GroupCountNotice").pipe(ca(h.onGroupCountNotice())),g.fromReceived("GroupAttributeAlt").pipe(ca(h.onGroupAttributeAlt())),g.fromReceived("UserJoinNotice").pipe(ca(h.onUserNotice(S.PeerOnlineState.ONLINE))),g.fromReceived("UserQuitNotice").pipe(ca(h.onUserNotice(S.PeerOnlineState.OFFLINE))),g.fromReceived("UserWaitNotice").pipe(ca(h.onUserNotice(S.PeerOnlineState.UNREACHABLE)))).pipe(qf(void 0))}))}).forEach(function(f,g){h.loginSocketSubs[g].receivers.push(f.subscribe({error:function(){}}))})}},{key:"requestSocketLogin",value:function(h,f,g){var C=this;return im(ad(function(){C.userJoinOptions=new is(f),h.sendPacket("UserJoin",{account:C.context.uid,instance:C.instanceId,opt:C.userJoinOptions.toLong(),seq:g,ticket:h.ticket})}),h.fromReceived("UserResp").pipe(aa(function(P){return g.eq(P.seq)}),ca(function(P){if((P=P.code)!==0)throw C.clearSockets(),C.logError("Connected to gateway success but the Rtm server rejected login"),new da(["Login failure. The response code from the RTM service is %d",P],jg);C.log("ENV_%d logged in",h.env)}),qf(h),hb(15e3))).pipe(wb(function(P){return P!==void 0}),Ga(function(P){return P instanceof pb&&C.warn("Login response timeout, rejoin: %s",f),Z(P)}))}},{key:"getSocketLoginObservables",value:function(h,f){var g=this;return h.map(function(C){return C.pipe(ca(function(P){P.listenerCount("socketUserDrop")===0&&P.on("socketUserDrop",function(x){return g.onUserDrop(x,P)})}),Cc(function(P,x){return g.incSeqIfNeeded(P.env),g.requestSocketLogin(P,x!==0,x===0?f:g.seq)}),pe())})}},{key:"incSeqIfNeeded",value:function(h){if(![0,1].includes(h))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[h]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[h]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var h=this.curLoginSockets,f=-1,g=h==null?0:h.length,C=0,P=[];++f<g;){var x=h[f];x&&(P[C++]=x)}return P}},{key:"emitMessage",value:function(h,f){var g=h.options,C=h.payload,P=h.src,x=h.dst,B=h.instance,Vt=h.dialogue,_r=h.sequence,_e=h.ms,_i=h.MiscMap;this.dialogueSequenceLru.set(Vt.toString(),_r),B="".concat(B,"-").concat(Vt,"#").concat(_r),this.msgDedupLru.has(B)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",f,B):(this.msgDedupLru.set(B,void 0),f=new ae(g),this.lastLoginSockets.forEach(function(){var _a=J(w.mark(function kc(_d){var _l;return w.wrap(function(_h){for(;;)switch(_h.prev=_h.next){case 0:return _h.next=2,_d.pipe(Ka(1)).toPromise();case 2:_l=_h.sent,e.sendMessageAck(h,_l);case 4:case"end":return _h.stop()}},kc)}));return function(kc){return _a.apply(this,arguments)}}()),g=f.isZlibCompressed(),f.isInvitation()?(x=pa(g?nl(Xm(C,Uint8Array.of(0,0,0,0))):C),x=JSON.parse(x),this.log("The received invitation body is %o",x),this.emit("invitationMessage",{body:x,type:f.getInvitationType(),peerId:P,serverReceivedTs:_e.toNumber()})):f.isTextMessage()?(_i=f.isPeerTextMessage(),C=pa(g?nl(Xm(C,Uint8Array.of(0,0,0,0))):C),this.info("Received a %s %s text message from %s to %s, %s",g?" compressed":"",_i?"peer":"channel",oa(P),oa(x),B),_i?(P={text:C,peerId:P,properties:{serverReceivedTs:_e.toNumber(),isOfflineMessage:f.isFromCache()}},this.emit("peerTextMessage",P)):this.emit("channelTextMessage",{channelId:x,memberId:P,text:C,properties:{serverReceivedTs:_e.toNumber(),isOfflineMessage:!1}})):f.isRawMessage()?(Vt=f.isRawPeerMessage(),_i=(_i=_i.description)===void 0?"":pa(_i),C=g?nl(C):C,this.info("Received a %s %s raw message from %s to %s, %s",g?" compressed":"",Vt?"peer":"channel",oa(P),oa(x),B),Vt?(P={desc:_i,raw:C,peerId:P,properties:{serverReceivedTs:_e.toNumber(),isOfflineMessage:f.isFromCache()}},this.emit("peerRawMessage",P)):this.emit("channelRawMessage",{desc:_i,raw:C,channelId:x,memberId:P,properties:{serverReceivedTs:_e.toNumber(),isOfflineMessage:!1}})):(f.isImageMessage()||f.isFileMessage())&&(C=f.isPeerMessage(),this.info("Received a %s media message from %s to %s, %s",C?"peer":"channel",oa(P),oa(x),B),C?this.emit("peerMediaMessage",{messageType:f.isImageMessage()?"IMAGE":"FILE",details:_i,peerId:P,properties:{serverReceivedTs:_e.toNumber(),isOfflineMessage:f.isFromCache()}}):this.emit("channelMediaMessage",{messageType:f.isImageMessage()?"IMAGE":"FILE",details:_i,memberId:P,channelId:x,properties:{serverReceivedTs:_e.toNumber(),isOfflineMessage:f.isFromCache()}})))}},{key:"onSocketReconnect",value:function(h){var f=this;return function(){var g=[0,1].filter(function(C){return C!==h.env})[0];(g=f.connection.curOpenSockets[g])&&!g.loggedIn&&f.emit("connectionLost")}}},{key:"onUserDrop",value:function(h,f){var g;h=h.code,eb("KickedOff",{code:0,elapse:fb(this.startTime),linkId:parseInt(f.name.split("-")[1],10),lts:U.fromNumber(Date.now()),server:f.address,serverCode:h,sid:Xa(this.instanceId),userId:this.context.uid},(g=this.context.config.enableCloudProxy)!==null&&g!==void 0&&g),h===10006||h===10001?this.warn("Login too often and kicked off, reconnect and login"):h===10009?(this.warn("The instance ID conflicts, reconnecting"),this.instanceId=Bg(),this.context.sid=Xa(this.instanceId),this.emit("instanceChanged",this.instanceId)):[11,14,15,16].includes(h)&&(this.emit("userDrop",h),this.clearSockets())}},{key:"clearSockets",value:function(){var h=this,f=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,g=1<arguments.length&&arguments[1]!==void 0&&arguments[1];[0,1].forEach(function(C){h.cleanLoginSubs(C,g),h.connection.closeSocket(C,f)})}},{key:"onMessage",value:function(h){var f=this;return function(g){var C=g.dialogue,P=g.instance,x=g.sequence,B=g.options;if(g.src===f.context.uid)f.log("The message is from the local account, ignored");else{var Vt=C.toString(),_r=f.dialPendingMsgSubjectMap.get(Vt);if(C="".concat(P,"-").concat(C,"#").concat(x),_r)_r.next(g),f.log("Env_%d: The dialogue has pending messages, next: %s",h.env,C);else{var _e=f.dialogueSequenceLru.get(Vt);if(_r=!_e&&x.eq(1),P=_e!==void 0&&x.sub(_e).eq(1),_r||P)f.emitMessage(g,h.env);else{if(_e){if(x.lte(_e))return;f.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",h.env,C)}else f.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",h.env,C);x=new Pa,f.dialPendingMsgSubjectMap.set(Vt,x);var _i=x.pipe(Qs(Pk),xg(function(_a,kc){return[].concat(G(_a),[kc])},[]),ba(function(_a){return G(_a).sort(function(kc,_d){return kc=kc.sequence,_d=_d.sequence,kc.eq(_d)?0:kc.gt(_d)?1:-1})}),sm(1));B=!(B=new ae(B)).isFromCache()&&!B.isBufferedMessage(),_i.pipe(ob(Bc(B?750:1500)),aa(function(_a){if(2>_a.length)return!1;for(var kc=_e===void 0?U.fromNumber(1,!0):_e.add(1),_d=0;_d<_a.length;kc=kc.add(1),_d++)if(!_a[_d].sequence.eq(kc))return!1;return!0}),wg(function(){f.dialPendingMsgSubjectMap.delete(Vt)})).subscribe(function(_a){_a.forEach(function(kc){f.emitMessage(kc,h.env),f.log("Env_%d: The message queue has fully ordered, emitting: %s",h.env,"".concat(kc.instance,"-").concat(kc.dialogue,"#").concat(kc.sequence))})},function(_a){_a instanceof vg&&_i.pipe(Ka(1)).subscribe(function(kc){return kc.forEach(function(_d){f.log("Env_%d: The message pending queue expired, emitting: %s",h.env,"".concat(_d.instance,"-").concat(_d.dialogue,"#").concat(_d.sequence)),f.emitMessage(_d,h.env)})})}),x.next(g)}}}}}},{key:"onGroupEnterNotice",value:function(){var h=this;return function(f){h.emit("memberNotice",{channelId:f.group,seq:f.seq,instance:f.instance,memberId:f.user,type:"MemberJoined",size:f.size})}}},{key:"onGroupLeaveNotice",value:function(){var h=this;return function(f){h.emit("memberNotice",{channelId:f.group,seq:f.seq,instance:f.instance,memberId:f.user,type:"MemberLeft",size:f.size})}}},{key:"onGroupCountNotice",value:function(){var h=this;return function(f){h.emit("memberNotice",{channelId:f.group,seq:f.seq,instance:f.instance,type:"MemberCountUpdated",size:f.size})}}},{key:"onGroupAttributeAlt",value:function(){var h=this;return function(f){var g=f.group;f=ff(f,kD),h.emit("channelAttributesUpdated",ua({channelId:g},f))}}},{key:"onUserNotice",value:function(h){var f=this;return function(g){f.emit("peerOnlineStatusChanged",{peerId:g.user,instance:g.instance,seq:g.seq,state:h})}}}],[{key:"sendMessageAck",value:function(h,f){var g=new ae(h.options);(g.isInvitation()||g.isPeerMessage())&&f.sendPacket("Ack",{code:0,dialogue:h.dialogue,instance:h.instance,sequence:h.sequence})}}]),e}(tb());m(ls,"genTimeoutError",function(r,e){return bb(void 0).pipe(cd(e===void 0?1e4:e),ba(function(){throw new db(["Request timed out after %ds",e===void 0?1e4:e],r)}))});var ms,ol,pl=0,ql=0;Ud.v1=function(r,e,d){d=e&&d||0;var h=e||[],f=(r=r||{}).node||ms,g=r.clockseq!==void 0?r.clockseq:ol;if(f==null||g==null){var C=Jq();f==null&&(f=ms=[1|C[0],C[1],C[2],C[3],C[4],C[5]]),g==null&&(g=ol=16383&(C[6]<<8|C[7]))}C=r.msecs!==void 0?r.msecs:new Date().getTime();var P=r.nsecs!==void 0?r.nsecs:ql+1,x=C-pl+(P-ql)/1e4;if(0>x&&r.clockseq===void 0&&(g=g+1&16383),(0>x||C>pl)&&r.nsecs===void 0&&(P=0),1e4<=P)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(pl=C,ql=P,ol=g,r=(1e4*(268435455&(C+=122192928e5))+P)%4294967296,h[d++]=r>>>24&255,h[d++]=r>>>16&255,h[d++]=r>>>8&255,h[d++]=255&r,r=C/4294967296*1e4&268435455,h[d++]=r>>>8&255,h[d++]=255&r,h[d++]=r>>>24&15|16,h[d++]=r>>>16&255,h[d++]=g>>>8|128,h[d++]=255&g,g=0;6>g;++g)h[d+g]=f[g];return e||Kq(h)},Ud.v4=Ud;var rl=Ph(),vd,bf=S.LocalInvitationFailureReason,Ba=S.LocalInvitationState,lD=(vd=function(r){function e(h,f,g){W(this,e);var C=d.call(this,g,"RtmLocalInvitation",!0);return m(n(C),"state",Ba.IDLE),m(n(C),"localInvitationEnd$",Ca(gb(n(C),"LocalInvitationAccepted"),gb(n(C),"LocalInvitationRefused"),gb(n(C),"LocalInvitationFailure"),gb(n(C),"LocalInvitationCanceled")).pipe(Ka(1))),m(n(C),"callId",Ud.v4()),m(n(C),"_content",""),m(n(C),"_channelId",""),m(n(C),"_response",""),m(n(C),"calleeId",void 0),m(n(C),"logger",void 0),m(n(C),"getSession",void 0),C.calleeId=h,C.getSession=f,C.logger=g,C}la(e,r);var d=ma(e);return Ha(e,[{key:"channelId",get:function(){return this._channelId},set:function(h){this.state!==Ba.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=h)}},{key:"content",get:function(){return this._content},set:function(h){this.log("set content for %s",this.callId),this._content=h}},{key:"response",get:function(){return this._response},set:function(h){throw new I('Cannot set the "response" of the LocalInvitation instance.',xc)}},{key:"send",value:function(){var h,f=this;if(this.state===Ba.SENT_TO_REMOTE||this.state===Ba.RECEIVED_BY_REMOTE)throw new K("The local invitation send failure. The call invitation has already been sent.",gA);if(this.isLocalInvitationEnd())throw new K("The local invitation send failure. The call invitation has ended.",Ih);if(0<this._channelId.length&&!za(this._channelId))throw new I("Illegal invitation channel ID",xc);if(!za(this.calleeId))throw new I("Illegal invitation callee user ID",xc);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',xc);this.state=Ba.SENT_TO_REMOTE,ad(J(w.mark(function g(){var C,P,x;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,f.getSession().sendInvitationMessage({peerId:f.calleeId,callId:f.callId,extra:f._content,type:"CallInvite",channelId:f._channelId});case 2:if(C=B.sent,P=C.hasPeerReceived,x=C.hasReSent,!f.isLocalInvitationEnd()){B.next=7;break}throw new db("send invitation timeout");case 7:if(f.log("The local invitation has sent to the callee"),P||x){B.next=11;break}throw h=new rl({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(P){B.next=14;break}throw h=new rl({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return B.stop()}},g)}))).pipe(oe(function(g){return g.pipe(ca(function(C){if(!(C instanceof rl))throw C}),cd(2e3))}),hb(3e4),Ga(function(g){return Sa(g)&&f.warn("local invitation ack timed out"),Z(g)}),ob(this.localInvitationEnd$)).subscribe({next:function(){f.state===Ba.RECEIVED_BY_REMOTE?f.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):f.state!==Ba.SENT_TO_REMOTE?f.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(f.info("The peer received the local invitation %s.",f.callId),f.state=Ba.RECEIVED_BY_REMOTE,f.emit("LocalInvitationReceivedByPeer"),f.localInvitationEnd$.pipe(hb(6e4),Ga(function(g){return Sa(g)&&f.warn("local invitation expired"),Z(g)})).subscribe({error:function(){f.state=Ba.FAILURE,f.emit("LocalInvitationFailure",bf.INVITATION_EXPIRE)}}))},error:function(g){f.isLocalInvitationEnd()?f.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(f.state=Ba.FAILURE,Sa(g)&&h?h.code==="PEER_NOT_ONLINE"?f.emit("LocalInvitationFailure",bf.PEER_OFFLINE):h.code==="RESENT_AND_OFFLINE"&&f.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):Sa(g)?f.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):g.name==="RtmInvalidStatusError"?f.emit("LocalInvitationFailure",bf.NOT_LOGGEDIN):f.emit("LocalInvitationFailure",bf.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new K("The local invitation cancel failure",Ih);if(this.state===Ba.IDLE)throw new K("The local invitation has not been sent",fA);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',xc);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Ba.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(h){if(this.isLocalInvitationEnd()&&this.state!==Ba.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Ba.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Ba.ACCEPTED_BY_REMOTE,this._response=h,this.emit("LocalInvitationAccepted",h))}}},{key:"onRefuseReceived",value:function(h){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote refuse it?");this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=h,this.state=Ba.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",h)}}},{key:"isLocalInvitationEnd",value:function(){return[Ba.CANCELED,Ba.FAILURE,Ba.ACCEPTED_BY_REMOTE,Ba.REFUSED_BY_REMOTE].includes(this.state)}}]),e}(tb()),fa(vd.prototype,"send",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"send"),vd.prototype),fa(vd.prototype,"cancel",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"cancel"),vd.prototype),vd),Rh=S.RemoteInvitationFailureReason,kb=S.RemoteInvitationState,mD=function(r){function e(h){var f=h.invitationChannel,g=h.extraContent,C=h.callId,P=h.callerId,x=h.logger;h=h.getSession,W(this,e);var B=d.call(this,x,"RtmRemoteInvitation",!0);return m(n(B),"state",kb.INVITATION_RECEIVED),m(n(B),"remoteInvitationEnd$",Ca(gb(n(B),"RemoteInvitationCanceled"),gb(n(B),"RemoteInvitationRefused"),gb(n(B),"RemoteInvitationAccepted"),gb(n(B),"RemoteInvitationFailure")).pipe(Ka(1))),m(n(B),"callerId",void 0),m(n(B),"callId",void 0),m(n(B),"_getSession",void 0),m(n(B),"logger",void 0),m(n(B),"_content",void 0),m(n(B),"_channelId",void 0),m(n(B),"_response",""),B._channelId=f,B._content=g,B.callId=C,B.callerId=P,B._getSession=h,B.logger=x,B.remoteInvitationEnd$.pipe(hb(6e4),Ga(function(Vt){return Sa(Vt)&&B.warn("Remote invitation expired"),Z(Vt)})).subscribe({error:function(){B.state=kb.FAILURE,B.emit("RemoteInvitationFailure",Rh.INVITATION_EXPIRE)}}),B}la(e,r);var d=ma(e);return Ha(e,[{key:"channelId",get:function(){return this._channelId},set:function(h){throw new I('Cannot set the "response" of the RemoteInvitation instance.',xc)}},{key:"content",get:function(){return this._content},set:function(h){throw new I('Cannot set the "content" of the RemoteInvitation instance.',xc)}},{key:"response",get:function(){return this._response},set:function(h){this._response=h}},{key:"accept",value:function(){var h,f=this;if(this.isRemoteInvitationEnd())throw new K("The local invitation has ended. Cannot accept.",Ih);if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',xc);this.state=kb.ACCEPT_SENT_TO_LOCAL,Xb(mm(1e3).pipe(cb(function(){return ad(J(w.mark(function g(){return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.abrupt("return",f._getSession().sendInvitationMessage({peerId:f.callerId,callId:f.callId,extra:f.response,type:"CallAccept",isAcceptAck:!1,channelId:f.channelId}));case 1:case"end":return C.stop()}},g)})))}),wb(function(g){return h=g.hasPeerReceived}),Ka(1)),gb(this,"RemoteInvitationAccepted")).pipe(hb(5e3),ob(this.remoteInvitationEnd$)).subscribe({error:function(g){if(f.logError(g),f.state=kb.FAILURE,Sa(g))switch(h){case void 0:case!0:return void f.emit("RemoteInvitationFailure",Rh.ACCEPT_FAILURE);case!1:return void f.emit("RemoteInvitationFailure",Rh.PEER_OFFLINE)}f.emit("RemoteInvitationFailure",Rh.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(this.isRemoteInvitationEnd())throw new K("The invitation is end. Cannot refuse",Ih);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',xc);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=kb.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(h){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===kb.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=h,this.state=kb.CANCELED,this.emit("RemoteInvitationCanceled",h))}},{key:"onAcceptAckReceived",value:function(){this.state!==kb.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=kb.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[kb.ACCEPTED,kb.REFUSED,kb.CANCELED,kb.FAILURE].includes(this.state)}}]),e}(tb()),nD=function(r){function e(h,f){W(this,e);var g=d.call(this,f,"InvitationManager");return m(n(g),"getSession",void 0),m(n(g),"invitationDispatcher",new ea.EventEmitter),m(n(g),"outgoingLocalInvitations",new Map),m(n(g),"receivedRemoteInvitations",new tc(void 0,{maxlen:1e4})),m(n(g),"logger",void 0),g.getSession=cn(h),g.logger=f,g.invitationDispatcher.on("remoteInvitationToManager",function(C){var P=C.callId,x=C.extra,B=C.callerId;C=C.channelId,g.receivedRemoteInvitations.has(P)||((x=new mD({callerId:B,callId:P,getSession:g.getSession,logger:f,extraContent:x,invitationChannel:C})).remoteInvitationEnd$.subscribe(function(){g.receivedRemoteInvitations.delete(P)}),g.receivedRemoteInvitations.set(P,x),g.emit("remoteInvitationInstance",x))}),g.invitationDispatcher.on("acceptAckToRemoteInvitation",function(C){(C=g.receivedRemoteInvitations.get(C.callId))&&C.onAcceptAckReceived()}),g.invitationDispatcher.on("cancelToRemoteInvitation",function(C){var P=C.extra;(C=g.receivedRemoteInvitations.get(C.callId))&&C.onCancelReceived(P)}),g.invitationDispatcher.on("acceptToLocalInvitation",function(C){var P=C.extra;(C=g.outgoingLocalInvitations.get(C.callId))&&C.onAcceptReceived(P)}),g.invitationDispatcher.on("refuseToLocalInvitation",function(C){var P=C.extra;(C=g.outgoingLocalInvitations.get(C.callId))&&C.onRefuseReceived(P)}),g}la(e,r);var d=ma(e);return Ha(e,[{key:"invitationMessageHandler",value:function(h){var f=h.body,g=f.callId,C=f.extra;C=C===void 0?"":C;var P=f.type,x=(f=f.channel)===void 0?"":f,B=h.type;switch(f=h.peerId,h=h.serverReceivedTs,B){case"CallAccept":P==="ack"?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:g}):P==="request"&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:g,extra:C});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:g,callerId:f,extra:C,channelId:x});break;case"CallCancel":if(g==="0"){g="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(x,"_").concat(C),this.getSession().emit("peerTextMessage",{peerId:f,properties:{serverReceivedTs:h,isOfflineMessage:!1},text:g});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:g,extra:C});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:g,extra:C});break;default:throw Im("invitationType",B)}}},{key:"genLocalInvitation",value:function(h){var f=this,g=new lD(h,this.getSession,this.logger);return g.localInvitationEnd$.subscribe(function(){f.outgoingLocalInvitations.delete(g.callId)}),this.outgoingLocalInvitations.set(g.callId,g),g}}]),e}(tb()),oD=function(r,e,d){var h=!0,f=!0;if(typeof r!="function")throw new TypeError("Expected a function");return lb(d)&&(h="leading"in d?!!d.leading:h,f="trailing"in d?!!d.trailing:f),qC(r,e,{leading:h,maxWait:e,trailing:f})},ub,cf;(function(r){r[r.JOINED=0]="JOINED",r[r.LEFT=1]="LEFT"})(cf||(cf={}));var ns=S.ConnectionState,pD=(ub=function(r){function e(h,f,g,C){W(this,e);var P=d.call(this,C,"RtmChannel",!0);return m(n(P),"onMemberCountUpdated",oD(function(x){x!==P.memberCount&&(P.memberCount=x,P.emit("MemberCountUpdated",x))},1e3)),m(n(P),"getSession",void 0),m(n(P),"memberCount",0),m(n(P),"memberJoinedLru",new tc(void 0,{maxlen:1e4})),m(n(P),"memberLeftLru",new tc(void 0,{maxlen:1e4})),m(n(P),"memberJoinStateLru",new tc(void 0,{maxlen:1e4})),m(n(P),"attributesSeqLru",new tc(void 0,{maxlen:1e4})),m(n(P),"channelId",void 0),m(n(P),"client",void 0),m(n(P),"onAttributesUpdated",function(x){var B=x.channelId,Vt=x.attributeMaps,_r=x.seq;x=x.instance.toString();var _e=P.attributesSeqLru.get(x);if((!_e||_r.greaterThan(_e))&&(P.attributesSeqLru.set(x,_r),B===P.channelId)){for(B={},_r=0;_r<Vt.length;_r++){var _i=Vt[_r];x=_i.key,_e=_i.ms;var _a=_i.value;if(_i=_i.origin,typeof x!="string"||!U.isLong(_e)||typeof _a!="string"||!za(_i))break;B[x]={value:_a,lastUpdateUserId:_i,lastUpdateTs:_e.toNumber()}}P.emit("AttributesUpdated",B)}}),m(n(P),"onChannelTextMessage",function(x){var B=x.memberId,Vt=x.text,_r=x.properties;x.channelId===P.channelId&&P.emit("ChannelMessage",{text:Vt,messageType:S.MessageType.TEXT},B,_r)}),m(n(P),"onChannelMediaMessage",function(x){var B=x.memberId,Vt=x.properties,_r=x.details,_e=x.messageType;x.channelId===P.channelId&&(_e==="FILE"?P.emit("ChannelMessage",{messageType:S.MessageType.FILE,size:parseInt(pa(_r.media_size),10),description:pa(_r.media_description),fileName:pa(_r.media_filename),mediaId:pa(_r.media_id),thumbnail:new Blob([_r.media_thumbnail])},B,Vt):_e==="IMAGE"&&P.emit("ChannelMessage",{messageType:S.MessageType.IMAGE,size:parseInt(pa(_r.media_size),10),description:pa(_r.media_description),fileName:pa(_r.media_filename),mediaId:pa(_r.media_id),thumbnail:new Blob([_r.media_thumbnail]),height:parseInt(pa(_r.media_height),10),width:parseInt(pa(_r.media_width),10),thumbnailHeight:parseInt(pa(_r.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(_r.media_thumbnailwidth),10)},B,Vt))}),m(n(P),"onChannelRawMessage",function(x){var B=x.desc,Vt=x.raw,_r=x.memberId,_e=x.properties;x.channelId===P.channelId&&P.emit("ChannelMessage",{messageType:S.MessageType.RAW,rawMessage:Vt,description:B},_r,_e)}),m(n(P),"onMemberNotice",function(x){var B=x.memberId,Vt=x.type,_r=x.size;if(x.channelId===P.channelId){var _e=x.instance.toString();x=x.seq.toString();var _i={MemberLeft:P.memberLeftLru,MemberJoined:P.memberJoinedLru,MemberCountUpdated:void 0}[Vt];if(_i){if(_i.has(_e+x))return void P.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",Vt,x,oa(P.channelId),oa(B||""));if(_i.set(_e+x,void 0),typeof B!="string")return;if(B!==P.getSession().context.uid&&((_e=P.memberJoinStateLru.get(B))===cf.JOINED&&Vt==="MemberJoined"||_e===cf.LEFT&&Vt==="MemberLeft"))return void P.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",Vt,x,oa(P.channelId),oa(B||""));P.memberJoinStateLru.set(B,Vt==="MemberJoined"?cf.JOINED:cf.LEFT)}P.info("Channel %s - %s, memberId: %s",Vt,oa(P.channelId),Vt==="MemberCountUpdated"?"[unknown]":oa(B||"")),_e=B===P.getSession().context.uid,Vt==="MemberLeft"&&za(B)||Vt==="MemberJoined"&&za(B)?(_e||P.emit(Vt,B),P.onMemberCountUpdated(_r)):Vt==="MemberCountUpdated"&&typeof _r=="number"&&P.onMemberCountUpdated(_r)}}),P.getSession=cn(f),P.channelId=h,P.client=g,P.info("A channel created, id %s",oa(h)),P}la(e,r);var d=ma(e);return Ha(e,[{key:"join",value:function(){var h=J(w.mark(function f(){var g,C,P,x,B,Vt,_r;return w.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(za(this.channelId)){_e.next=2;break}throw new I(["The %s in the arguments is invalid","channelId"],hA);case 2:_e.prev=2,g=this.getSession(),_e.next=9;break;case 6:throw _e.prev=6,_e.t0=_e.catch(2),new K("The client is not logged in. Cannot do the operation",Vq);case 9:if(!g.joinedChannels.has(this)){_e.next=12;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:g.context.uid,elapse:fb(g.startTime),errCode:Uq,sid:Xa(g.instanceId)},(C=this.client.context.config.enableCloudProxy)!==null&&C!==void 0&&C),new K("The channel has joined. Cannot rejoin",Uq);case 12:if(_e.prev=12,this.log("Joining the channel %s",oa(this.channelId)),!this.hasOtherChannelJoined()){_e.next=17;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:g.context.uid,elapse:fb(g.startTime),errCode:Wq,sid:Xa(g.instanceId)},(B=this.client.context.config.enableCloudProxy)!==null&&B!==void 0&&B),new K("A channel of the same channel ID has already joined. Cannot rejoin",Wq);case 17:if(g.joinedChannels.size!==20){_e.next=20;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:g.context.uid,elapse:fb(g.startTime),errCode:Tq,sid:Xa(g.instanceId)},(Vt=this.client.context.config.enableCloudProxy)!==null&&Vt!==void 0&&Vt),new ib("The joined channels has exceeded the limit of 20",Tq);case 20:return eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:g.context.uid,elapse:fb(g.startTime),errCode:0,sid:Xa(g.instanceId)},(P=this.client.context.config.enableCloudProxy)!==null&&P!==void 0&&P),_e.next=23,g.requestChannelJoin(this,this.channelId);case 23:eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(g.startTime),errCode:0,sid:Xa(g.instanceId),serverErrCode:0,userId:g.context.uid},(x=this.client.context.config.enableCloudProxy)!==null&&x!==void 0&&x),this.info("The channel %s joined successfully",oa(this.channelId)),g.on("channelTextMessage",this.onChannelTextMessage),g.on("channelRawMessage",this.onChannelRawMessage),g.on("channelMediaMessage",this.onChannelMediaMessage),g.on("memberNotice",this.onMemberNotice),g.on("channelAttributesUpdated",this.onAttributesUpdated),_e.next=41;break;case 32:if(_e.prev=32,_e.t1=_e.catch(12),this.logError(_e.t1),!sa(_e.t1)){_e.next=37;break}throw _e.t1;case 37:if(!Sa(_e.t1)){_e.next=40;break}throw eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(g.startTime),errCode:Sq,sid:Xa(g.instanceId),serverErrCode:0,userId:g.context.uid},(_r=this.client.context.config.enableCloudProxy)!==null&&_r!==void 0&&_r),new db(["Join channel %s timed out",oa(this.channelId)],Sq);case 40:throw new Wc(["The channel %s join failure",oa(this.channelId)],{code:Rq,originalError:_e.t1});case 41:case"end":return _e.stop()}},f,this,[[2,6],[12,32]])}));return function(){return h.apply(this,arguments)}}()},{key:"leave",value:function(){var h=J(w.mark(function f(){var g,C,P,x;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:B.prev=0,C=this.getSession(),B.next=7;break;case 4:throw B.prev=4,B.t0=B.catch(0),new K("The client is not logged in. Cannot do the operation",jA);case 7:if(C.joinedChannels.has(this)){B.next=9;break}throw new K("The channel does not join. Cannot do the operation",iA);case 9:B.prev=9,C.requestChannelLeave(this,this.channelId),this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,C.removeListener("channelTextMessage",this.onChannelTextMessage),C.removeListener("channelRawMessage",this.onChannelRawMessage),C.removeListener("channelMediaMessage",this.onChannelMediaMessage),C.removeListener("memberNotice",this.onMemberNotice),C.removeListener("channelAttributesUpdated",this.onAttributesUpdated),B.next=32;break;case 23:if(B.prev=23,B.t1=B.catch(9),this.logError(B.t1),!sa(B.t1)){B.next=30;break}throw B.t1.code===void 0&&(B.t1.code=Yq),eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(C.startTime),errCode:Yq,sid:Xa(C.instanceId),userId:C.context.uid},(x=this.client.context.config.enableCloudProxy)!==null&&x!==void 0&&x),B.t1;case 30:throw eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(C.startTime),errCode:Xq,sid:Xa(C.instanceId),userId:C.context.uid},(P=this.client.context.config.enableCloudProxy)!==null&&P!==void 0&&P),new Wc("The channel leave failure",{code:Xq,originalError:B.t1});case 32:eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(C.startTime),errCode:0,sid:Xa(C.instanceId),userId:C.context.uid},(g=this.client.context.config.enableCloudProxy)!==null&&g!==void 0&&g);case 33:case"end":return B.stop()}},f,this,[[0,4],[9,23]])}));return function(){return h.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var h=J(w.mark(function f(g){var C,P,x,B,Vt,_r=this,_e=arguments;return w.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:C=1<_e.length&&_e[1]!==void 0?_e[1]:{},P=C.enableHistoricalMessaging,x=P!==void 0&&P,Tm(g,Hh),_i.prev=2,B=this.getSession(),_i.next=9;break;case 6:throw _i.prev=6,_i.t0=_i.catch(2),new K("The client is not logged in. Cannot do the operation",ig);case 9:if(B.joinedChannels.has(this)){_i.next=11;break}throw new K("The channel does not join. Cannot do the operation",ig);case 11:if(this.client.connectionState!==ns.RECONNECTING){_i.next=16;break}return Vt=Date.now(),_i.next=15,new Promise(function(_a,kc){var _d=function(){var _h=J(w.mark(function rE(){var aE;return w.wrap(function(yE){for(;;)switch(yE.prev=yE.next){case 0:return aE=Date.now()-Vt,yE.prev=1,yE.next=4,Gg({message:g,peerId:_r.channelId,toPeer:!1,session:_r.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:aE,logger:_r.logger,options:{enableHistoricalMessaging:x,enableOfflineMessaging:!1}});case 4:_a(),yE.next=12;break;case 7:yE.prev=7,yE.t0=yE.catch(1),Sa(yE.t0)&&kc(new db(Yd(_r.name,"sendMessageToPeer",1e4),Yk)),sa(yE.t0)&&kc(yE.t0),kc(new da("Channel message send failure",{code:hg,originalError:yE.t0}));case 12:return yE.prev=12,clearTimeout(_l),yE.finish(12);case 15:case"end":return yE.stop()}},rE,null,[[1,7,12,15]])}));return function(){return _h.apply(this,arguments)}}();_r.client.internalEmitter.once("RECONNECTED",_d);var _l=setTimeout(function(){_r.client.internalEmitter.off("RECONNECTED",_d),kc(new db(Yd(_r.name,"sendMessageToPeer",1e4),Yk))},9e3)});case 15:return _i.abrupt("return");case 16:if(this.client.connectionState===ns.CONNECTED){_i.next=18;break}throw new K("The client is not logged in. Cannot do the operation",ig);case 18:return _i.prev=18,_i.next=21,Gg({message:g,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:0,logger:this.logger,options:{enableHistoricalMessaging:x,enableOfflineMessaging:!1}});case 21:_i.next=31;break;case 23:if(_i.prev=23,_i.t1=_i.catch(18),!Sa(_i.t1)){_i.next=27;break}throw new db(Yd(this.name,"sendMessage",1e4),Yk);case 27:if(!sa(_i.t1)){_i.next=30;break}throw this.logError(_i.t1),_i.t1;case 30:throw new Wc("The channel message send failure",hg);case 31:case"end":return _i.stop()}},f,this,[[2,6],[18,23]])}));return function(f){return h.apply(this,arguments)}}()},{key:"getMembers",value:function(){var h=J(w.mark(function f(){var g,C,P;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:x.prev=0,x.prev=1,g=this.getSession(),x.next=8;break;case 5:throw x.prev=5,x.t0=x.catch(1),new K("The client is not logged in. Cannot do the operation",eA);case 8:if(g.joinedChannels.has(this)){x.next=10;break}throw new K("The channel does not join. Cannot do the operation",dA);case 10:return C=this.getSession().requestChannelMemberList(this.channelId),x.next=13,C.pipe(ba(function(B){return B.memberInfos.map(function(Vt){return Vt.account})})).toPromise();case 13:return P=x.sent,this.info("Channel %s - get members success, %o",oa(this.channelId),P.map(oa)),x.abrupt("return",P);case 18:if(x.prev=18,x.t1=x.catch(0),!sa(x.t1)){x.next=23;break}throw this.logError(x.t1),x.t1;case 23:throw new Wc("The channel members get failure",bA);case 24:case"end":return x.stop()}},f,this,[[0,18],[1,5]])}));return function(){return h.apply(this,arguments)}}()},{key:"hasOtherChannelJoined",value:function(){var h=this;return!this.getSession().joinedChannels.has(this)&&Array.from(this.getSession().joinedChannels).some(function(f){return f.channelId===h.channelId})}}]),e}(tb()),fa(ub.prototype,"join",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"join"),ub.prototype),fa(ub.prototype,"leave",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"leave"),ub.prototype),fa(ub.prototype,"sendMessage",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"sendMessage"),ub.prototype),fa(ub.prototype,"getMembers",[Ma],Object.getOwnPropertyDescriptor(ub.prototype,"getMembers"),ub.prototype),ub),E,Eb=S.ConnectionChangeReason,T=S.ConnectionState,os={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},qD={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8},rD=(E=function(r){function e(h,f,g,C){W(this,e);var P=d.call(this,f,"RtmClient",!0);return m(n(P),"connectionState",T.DISCONNECTED),m(n(P),"internalEmitter",new ea),m(n(P),"context",void 0),m(n(P),"attributes",{}),m(n(P),"loginPromise",void 0),m(n(P),"attributeDrafts",new Set),m(n(P),"session",void 0),m(n(P),"lastLoginTime",void 0),m(n(P),"reconnId",0),m(n(P),"channelAttributesCacheLru",new tc(void 0,{maxlen:1e4})),m(n(P),"invitationManager",void 0),m(n(P),"subscribedPeerStatusCache",{}),m(n(P),"peerStatusSeqLru",new tc(void 0,{maxlen:1e4})),m(n(P),"peerUnreachableTimers",{}),m(n(P),"mediaTaskManager",void 0),m(n(P),"setParameters",void 0),m(n(P),"updateConfig",void 0),m(n(P),"userDropHandler",function(x){if(P.connectionState!==T.ABORTED)switch(x){case 11:P.logError("Kicked off by remote session"),P.onConnectionStateChanged(T.ABORTED,Eb.REMOTE_LOGIN);break;case 14:case 15:case 16:P.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[x])),P.onConnectionStateChanged(T.ABORTED,Eb.BANNED_BY_SERVER);break;default:P.logError("User kicked off for unknown code: ".concat(x)),P.onConnectionStateChanged(T.ABORTED,Eb.INTERRUPTED)}}),P.context=new ZC(h,g,f),P.mediaTaskManager=new fs(f),P.context.config=g,P.internalEmitter.setMaxListeners(512),P.setParameters=C.bind(n(P)),P.updateConfig=C.bind(n(P)),P.invitationManager=new nD(function(){return P.session},f),P.invitationManager.on("remoteInvitationInstance",function(x){P.emit("RemoteInvitationReceived",x)}),P}la(e,r);var d=ma(e);return Ha(e,[{key:"renewToken",value:function(){var h=J(w.mark(function f(g){var C,P,x,B=this;return w.wrap(function(Vt){for(;;)switch(Vt.prev=Vt.next){case 0:if(typeof g=="string"&&g.length!==0){Vt.next=2;break}throw new I("Invalid argument",rA);case 2:if(this.connectionState!==T.ABORTED){Vt.next=5;break}return Vt.next=5,new Promise(function(){});case 5:if(this.connectionState===T.CONNECTED||this.connectionState===T.RECONNECTING){Vt.next=7;break}throw new K("The client is not logged in",uA);case 7:if(this.session!==void 0){Vt.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return Vt.prev=9,C=this.context.token,this.context.token=g,Vt.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe(Dd(function(){return Error("No available edge address to connect")}),oe(function(_r){return _r.pipe(ca(function(_e){if(sa(_e))throw _e}),cd(2500),Ka(4))}),Ka(1),hb(2e4),Ga(function(_r){return Sa(_r)&&B.warn("renewToken timed out"),Z(_r)})).toPromise();case 14:P=Vt.sent,x=P.ticket,Vt.next=27;break;case 18:if(Vt.prev=18,Vt.t0=Vt.catch(9),this.context.token=C,Vt.t0.code!==$q&&Vt.t0.code!==ar){Vt.next=23;break}throw new Ye("Invalid token",tA);case 23:if(Vt.t0.code!==Kh){Vt.next=25;break}throw new Ye("The token expired",sA);case 25:if(!Sa(Vt.t0)){Vt.next=27;break}throw new db("Renew token timed out",qA);case 27:this.session.curLoginSockets.filter(function(_r){return _r!==void 0}).forEach(function(_r){return _r.ticket=x});case 28:case"end":return Vt.stop()}},f,this,[[9,18]])}));return function(f){return h.apply(this,arguments)}}()},{key:"queryPeersOnlineStatus",value:function(){var h=J(w.mark(function f(g){var C,P,x=this;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(this.connectionState===T.CONNECTED){B.next=2;break}throw new K("The client is not logged in",pA);case 2:if(this.session!==void 0){B.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(g)||g.length===0||g.some(function(Vt){return!za(Vt)})||256<g.length)){B.next=6;break}throw new I("invalid arguments",er);case 6:return B.next=8,this.session.requestPeersOnlineStatus(g).toPromise();case 8:return C=B.sent,P=uc(Jk(C.userInfos,"account"),function(Vt){return!!Vt.ts}),Object.keys(P).forEach(function(Vt){if(Vt in x.subscribedPeerStatusCache&&x.subscribedPeerStatusCache[Vt]!==S.PeerOnlineState.UNREACHABLE){var _r=P[Vt]?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE;x.emit("PeersOnlineStatusChanged",m({},Vt,_r)),x.subscribedPeerStatusCache[Vt]=_r}}),B.abrupt("return",P);case 12:case"end":return B.stop()}},f,this)}));return function(f){return h.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var h=J(w.mark(function f(g){var C,P,x,B,Vt,_r,_e,_i=this;return w.wrap(function(_a){for(;;)switch(_a.prev=_a.next){case 0:if(this.connectionState===T.CONNECTED){_a.next=2;break}throw new K("The client is not logged in",aA);case 2:if(this.session!==void 0){_a.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(g)&&g.every(function(kc){return typeof kc=="string"})&&g.length!==0){_a.next=6;break}throw new I("Invalid arguments: channelIds",Oq);case 6:if(!(32<g.length)){_a.next=8;break}throw new I("getChannelMemberCount exceed limit of 32 channelIds",$z);case 8:C=0;case 9:if(!(C<g.length)){_a.next=16;break}if(za(P=g[C])){_a.next=13;break}throw new I(["getChannelMemberCount channel id %s is invalid",P],Oq);case 13:C++,_a.next=9;break;case 16:return _a.next=18,this.session.requestGetChannelMemberCount(g).toPromise();case 18:for(x=_a.sent,B=x.groupInfos,Vt={},_r=function(kc){var _d=(kc=B[kc]).group,_l=kc.memberCount;za(_d)&&typeof _l=="number"&&(_i.session.joinedChannels.forEach(function(_h){_h.channelId===_d&&_h.onMemberCountUpdated(_l)}),Vt[_d]=_l)},_e=0;_e<B.length;_e++)_r(_e);return _a.abrupt("return",Vt);case 24:case"end":return _a.stop()}},f,this)}));return function(f){return h.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var h=J(w.mark(function f(g){var C,P;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(uf({attributes:g,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){x.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(this.session!==void 0){x.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return C=this.session.requestSetLocalUserAttributes(g).toPromise(),P={attribute:g,promise:C},this.attributeDrafts.add(P),x.prev=8,x.next=11,C;case 11:this.attributes=g,x.next=19;break;case 14:if(x.prev=14,x.t0=x.catch(8),!sa(x.t0)){x.next=18;break}throw x.t0;case 18:throw new I("arguments is not valid",Ja);case 19:return x.prev=19,this.attributeDrafts.delete(P),x.finish(19);case 22:case"end":return x.stop()}},f,this,[[8,14,19,22]])}));return function(f){return h.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var h=J(w.mark(function f(g,C){var P,x,B,Vt,_r,_e=arguments;return w.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:if(P=2<_e.length&&_e[2]!==void 0?_e[2]:{},x=P.enableNotificationToChannelMembers,B=x!==void 0&&x,uf({attributes:C,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){_i.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){_i.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return Vt=this.session.requestSetChannelAttributes(g,C,B).toPromise(),_i.prev=7,_i.next=10,Vt;case 10:_r=uc(C,function(_a){return new Blob([_a]).size}),this.channelAttributesCacheLru.set(g,_r),_i.next=19;break;case 14:if(_i.prev=14,_i.t0=_i.catch(7),!sa(_i.t0)){_i.next=18;break}throw _i.t0;case 18:throw new I("arguments is not valid",Ja);case 19:case"end":return _i.stop()}},f,this,[[7,14]])}));return function(f,g){return h.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var h=J(w.mark(function f(g){var C,P,x;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(C=ua(ua({},this.attributes),g),uf({attributes:g,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),uf({attributes:C,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){B.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(this.session!==void 0){B.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return P=this.session.requestAddOrUpdateLocalUserAttributes(g).toPromise(),x={attribute:C,promise:P},this.attributeDrafts.add(x),B.prev=10,B.next=13,P;case 13:this.attributes=C,B.next=21;break;case 16:if(B.prev=16,B.t0=B.catch(10),!sa(B.t0)){B.next=20;break}throw B.t0;case 20:throw new I("arguments is not valid",er);case 21:return B.prev=21,this.attributeDrafts.delete(x),B.finish(21);case 24:case"end":return B.stop()}},f,this,[[10,16,21,24]])}));return function(f){return h.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var h=J(w.mark(function f(g,C){var P,x,B,Vt,_r,_e,_i,_a=arguments;return w.wrap(function(kc){for(;;)switch(kc.prev=kc.next){case 0:if(P=2<_a.length&&_a[2]!==void 0?_a[2]:{},x=P.enableNotificationToChannelMembers,B=x!==void 0&&x,Vt=this.channelAttributesCacheLru.get(g,{}),_r=uc(C,function(_d){return new Blob([_d]).size}),_e=ua(ua({},Vt),_r),uf({attributes:C,attrSizeMap:_e,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){kc.next=7;break}throw new K("The client is not logged in",Ub);case 7:if(this.session!==void 0){kc.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return _i=this.session.requestAddOrUpdateChannelAttributes(g,C,B).toPromise(),kc.prev=10,kc.next=13,_i;case 13:this.channelAttributesCacheLru.set(g,_e),kc.next=21;break;case 16:if(kc.prev=16,kc.t0=kc.catch(10),!sa(kc.t0)){kc.next=20;break}throw kc.t0;case 20:throw new I("arguments is not valid",Ja);case 21:case"end":return kc.stop()}},f,this,[[10,16]])}));return function(f,g){return h.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var h=J(w.mark(function f(g){var C,P,x,B;return w.wrap(function(Vt){for(;;)switch(Vt.prev=Vt.next){case 0:if(Array.isArray(g)&&g.length!==0&&!g.some(function(_r){return _r.length===0})){Vt.next=2;break}throw new K("arguments is not valid",Ja);case 2:if(this.connectionState===T.CONNECTED){Vt.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){Vt.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return C=this.session.requestDeleteLocalUserAttributesByKeys(g).toPromise(),P={attribute:Gk(this.attributes,g),promise:C},this.attributeDrafts.add(P),Vt.prev=9,Vt.next=12,C;case 12:for(x=0;x<g.length;x++)B=g[x],delete this.attributes[B];Vt.next=20;break;case 15:if(Vt.prev=15,Vt.t0=Vt.catch(9),!sa(Vt.t0)){Vt.next=19;break}throw Vt.t0;case 19:throw new I("arguments is not valid",Ja);case 20:return Vt.prev=20,this.attributeDrafts.delete(P),Vt.finish(20);case 23:case"end":return Vt.stop()}},f,this,[[9,15,20,23]])}));return function(f){return h.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var h=J(w.mark(function f(g,C){var P,x,B,Vt,_r,_e,_i,_a=arguments;return w.wrap(function(kc){for(;;)switch(kc.prev=kc.next){case 0:if(P=2<_a.length&&_a[2]!==void 0?_a[2]:{},x=P.enableNotificationToChannelMembers,B=x!==void 0&&x,Array.isArray(C)&&C.length!==0&&za(g)&&!C.some(function(_d){return _d.length===0||512<_d.length})){kc.next=3;break}throw new K("arguments is not valid",Ja);case 3:if(this.connectionState===T.CONNECTED){kc.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(this.session!==void 0){kc.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return Vt=this.session.requestDeleteChannelAttributesByKeys(g,C,B).toPromise(),kc.prev=8,kc.next=11,Vt;case 11:if(_r=this.channelAttributesCacheLru.get(g))for(_e=0;_e<C.length;_e++)_i=C[_e],delete _r[_i];kc.next=20;break;case 15:if(kc.prev=15,kc.t0=kc.catch(8),!sa(kc.t0)){kc.next=19;break}throw kc.t0;case 19:throw new I("arguments is not valid",Ja);case 20:case"end":return kc.stop()}},f,this,[[8,15]])}));return function(f,g){return h.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var h=J(w.mark(function f(){var g,C;return w.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(this.connectionState===T.CONNECTED){P.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){P.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return g=this.session.requestClearLocalUserAttributes().toPromise(),C={attribute:{},promise:g},this.attributeDrafts.add(C),P.prev=7,P.next=10,g;case 10:this.attributes={},P.next=18;break;case 13:if(P.prev=13,P.t0=P.catch(7),!sa(P.t0)){P.next=17;break}throw P.t0;case 17:throw new I("arguments is not valid",Ja);case 18:return P.prev=18,this.attributeDrafts.delete(C),P.finish(18);case 21:case"end":return P.stop()}},f,this,[[7,13,18,21]])}));return function(){return h.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var h=J(w.mark(function f(g){var C,P,x,B,Vt=arguments;return w.wrap(function(_r){for(;;)switch(_r.prev=_r.next){case 0:if(C=1<Vt.length&&Vt[1]!==void 0?Vt[1]:{},P=C.enableNotificationToChannelMembers,x=P!==void 0&&P,this.connectionState===T.CONNECTED){_r.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(this.session!==void 0){_r.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return B=this.session.requestClearChannelAttributes(g,x).toPromise(),_r.prev=6,_r.next=9,B;case 9:this.channelAttributesCacheLru.delete(g),_r.next=17;break;case 12:if(_r.prev=12,_r.t0=_r.catch(6),!sa(_r.t0)){_r.next=16;break}throw _r.t0;case 16:throw new I("arguments is not valid",Ja);case 17:case"end":return _r.stop()}},f,this,[[6,12]])}));return function(f){return h.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var h=J(w.mark(function f(g){var C,P,x;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(za(g)){B.next=2;break}throw new I("Not a valid user ID",Ja);case 2:if(this.connectionState===T.CONNECTED){B.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){B.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return B.prev=6,B.next=9,this.session.requestGetUserAttributeKeys(g).toPromise();case 9:return C=B.sent,P=C.keys,B.next=13,this.session.requestGetUserAttributesByKeys(g,P.slice(0,512)).toPromise();case 13:x=B.sent,B.next=21;break;case 16:if(B.prev=16,B.t0=B.catch(6),!sa(B.t0)){B.next=20;break}throw B.t0;case 20:throw new I("arguments is not valid",Ja);case 21:return B.abrupt("return",Yp(x.attributeInfos.map(function(Vt){return[Vt.key,Vt.value]})));case 22:case"end":return B.stop()}},f,this,[[6,16]])}));return function(f){return h.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var h=J(w.mark(function f(g){var C,P,x,B,Vt,_r,_e,_i,_a,kc,_d;return w.wrap(function(_l){for(;;)switch(_l.prev=_l.next){case 0:if(za(g)){_l.next=2;break}throw new I("Not a valid channel ID",Ja);case 2:if(this.connectionState===T.CONNECTED){_l.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){_l.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return _l.prev=6,_l.next=9,this.session.requestGetChannelAttributesKeys(g).toPromise();case 9:return C=_l.sent,P=C.keys,_l.next=13,this.session.requestGetChannelAttributesByKeys(g,P).toPromise();case 13:x=_l.sent,B=x.attributeMaps,_l.next=22;break;case 17:if(_l.prev=17,_l.t0=_l.catch(6),!sa(_l.t0)){_l.next=21;break}throw _l.t0;case 21:throw new I("arguments is not valid",Ja);case 22:Vt={},_r=0;case 24:if(!(_r<B.length)){_l.next=32;break}if(_e=B[_r],_i=_e.key,_a=_e.ms,kc=_e.value,_d=_e.origin,typeof _i=="string"&&U.isLong(_a)&&typeof kc=="string"&&za(_d)){_l.next=28;break}return _l.abrupt("break",32);case 28:Vt[_i]={value:kc,lastUpdateUserId:_d,lastUpdateTs:_a.toNumber()};case 29:_r++,_l.next=24;break;case 32:return this.channelAttributesCacheLru.set(g,uc(Vt,function(_h){return new Blob([_h.value]).size})),_l.abrupt("return",Vt);case 34:case"end":return _l.stop()}},f,this,[[6,17]])}));return function(f){return h.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var h=J(w.mark(function f(g,C){var P,x,B,Vt,_r,_e,_i,_a,kc,_d;return w.wrap(function(_l){for(;;)switch(_l.prev=_l.next){case 0:if(this.connectionState===T.CONNECTED){_l.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){_l.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(g,C),_l.prev=5,_l.next=8,this.session.requestGetChannelAttributesByKeys(g,C).toPromise();case 8:P=_l.sent,x=P.attributeMaps,_l.next=17;break;case 12:if(_l.prev=12,_l.t0=_l.catch(5),!sa(_l.t0)){_l.next=16;break}throw _l.t0;case 16:throw new I("arguments is not valid",Ja);case 17:B={},Vt=this.channelAttributesCacheLru.get(g,{}),_r=0;case 20:if(!(_r<x.length)){_l.next=29;break}if(_e=x[_r],_i=_e.key,_a=_e.ms,kc=_e.value,_d=_e.origin,typeof _i=="string"&&U.isLong(_a)&&typeof kc=="string"&&za(_d)){_l.next=24;break}return _l.abrupt("break",29);case 24:Vt[_i]=new Blob([kc]).size,B[_i]={value:kc,lastUpdateUserId:_d,lastUpdateTs:_a.toNumber()};case 26:_r++,_l.next=20;break;case 29:return this.channelAttributesCacheLru.set(g,Vt),_l.abrupt("return",B);case 31:case"end":return _l.stop()}},f,this,[[5,12]])}));return function(f,g){return h.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var h=J(w.mark(function f(g,C){var P;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(this.connectionState===T.CONNECTED){x.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){x.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(g,C),x.prev=5,x.next=8,this.session.requestGetUserAttributesByKeys(g,C).toPromise();case 8:P=x.sent,x.next=16;break;case 11:if(x.prev=11,x.t0=x.catch(5),!sa(x.t0)){x.next=15;break}throw x.t0;case 15:throw new I("arguments is not valid",Ja);case 16:return x.abrupt("return",Yp(P.attributeInfos.map(function(B){return[B.key,B.value]})));case 17:case"end":return x.stop()}},f,this,[[5,11]])}));return function(f,g){return h.apply(this,arguments)}}()},{key:"login",value:function(){var h=J(w.mark(function f(g){var C,P,x,B,Vt=this;return w.wrap(function(_r){for(;;)switch(_r.prev=_r.next){case 0:if(Uk=!0,C=Bg(),P=g.token,g.token===this.context.appId&&(P=void 0),setTimeout(function(){var _e;eb("Session",{appId:Vt.context.appId,did:navigator.userAgent,elapse:fb(Vt.session&&Vt.session.startTime),index:{index1:g.uid,index2:Vt.context.appId,index3:"enableLogUpload=".concat(Vt.context.config.enableLogUpload)},installId:gg,lts:U.fromNumber(Date.now()),os:7,sid:Xa(C),token:P||"",userId:g.uid,ver:"1.4.3-203",buildno:603,subVersion:203,version:4},(_e=Vt.context.config.enableCloudProxy)!==null&&_e!==void 0&&_e)},1e4),yd(g)&&za(g.uid)){_r.next=7;break}throw new I("not a valid user id",Jh);case 7:if(typeof P!="string"||!P){_r.next=11;break}this.context.token=P,_r.next=13;break;case 11:if(typeof P=="string"||P==null){_r.next=13;break}throw new I('The "token" is not a valid string.',Jh);case 13:return x=Date.now(),this.context.sid=Xa(C),this.loginPromise=this.loginImpl({uid:g.uid,instanceId:C}),this.info("RTM Client logging in as ".concat(oa(g.uid))),_r.prev=17,_r.next=20,this.loginPromise;case 20:_r.next=27;break;case 22:throw _r.prev=22,_r.t0=_r.catch(17),sa(_r.t0)&&eb("Link",{ackedServerIp:"",destServerIp:"",ec:_r.t0.code||1,sc:_r.t0.serverCode,elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),responseTime:Date.now()-x,sid:Xa(C),userId:g.uid},(B=this.context.config.enableCloudProxy)!==null&&B!==void 0&&B),this.context.token=void 0,_r.t0;case 27:return _r.prev=27,this.loginPromise=void 0,_r.finish(27);case 30:Uk=!1;case 31:case"end":return _r.stop()}},f,this,[[17,22,27,30]])}));return function(f){return h.apply(this,arguments)}}()},{key:"logout",value:function(){var h=J(w.mark(function f(){var g;return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(!this.loginPromise){C.next=3;break}return C.next=3,this.loginPromise;case 3:if(this.connectionState!==T.DISCONNECTED){C.next=6;break}throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);case 6:if(this.connectionState!==T.ABORTED){C.next=10;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),C.abrupt("return");case 10:if(this.session!==void 0){C.next=13;break}return this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),C.abrupt("return");case 13:return eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},(g=this.context.config.enableCloudProxy)!==null&&g!==void 0&&g),C.next=16,this.session.logoutHandler();case 16:this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),this.log("Log out success");case 18:case"end":return C.stop()}},f,this)}));return function(){return h.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var h,f=this;if(this.connectionState===T.DISCONNECTED)throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);this.connectionState===T.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):this.session!==void 0&&(eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},(h=this.context.config.enableCloudProxy)!==null&&h!==void 0&&h),this.session.logoutHandler().then(function(){f.log("Log out success")})),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var h=J(w.mark(function f(g,C){var P,x,B,Vt,_r,_e,_i=this,_a=arguments;return w.wrap(function(kc){for(;;)switch(kc.prev=kc.next){case 0:if(P=2<_a.length&&_a[2]!==void 0?_a[2]:{},x=P.enableOfflineMessaging,B=x!==void 0&&x,Vt=P.enableHistoricalMessaging,_r=Vt!==void 0&&Vt,Tm(g,ve),this.connectionState!==T.RECONNECTING){kc.next=5;break}return _e=Date.now(),kc.abrupt("return",new Promise(function(_d,_l){var _h=function(){var aE=J(w.mark(function yE(){var gE;return w.wrap(function(bE){for(;;)switch(bE.prev=bE.next){case 0:if(_i.session!==void 0){bE.next=2;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return gE=Date.now()-_e,bE.prev=3,bE.t0=_d,bE.next=7,Gg({message:g,peerId:C,toPeer:!0,session:_i.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:gE,logger:_i.logger,options:{enableHistoricalMessaging:_r,enableOfflineMessaging:B}});case 7:bE.t1=bE.sent,(0,bE.t0)(bE.t1),bE.next=16;break;case 11:bE.prev=11,bE.t2=bE.catch(3),Sa(bE.t2)&&_l(new db(Yd(_i.name,"sendMessageToPeer",1e4),Zk)),sa(bE.t2)&&_l(bE.t2),_l(new da("Peer-to-peer message send failure",{code:cr,originalError:bE.t2}));case 16:return bE.prev=16,clearTimeout(rE),bE.finish(16);case 19:case"end":return bE.stop()}},yE,null,[[3,11,16,19]])}));return function(){return aE.apply(this,arguments)}}();_i.internalEmitter.once("RECONNECTED",_h);var rE=setTimeout(function(){_i.internalEmitter.off("RECONNECTED",_h),_l(new db(Yd(_i.name,"sendMessageToPeer",1e4),Zk))},9e3)}));case 5:if(this.connectionState===T.CONNECTED){kc.next=7;break}throw new K("Failed to send the peer-to-peer message. The client is not logged in",al);case 7:if(this.session!==void 0){kc.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return kc.prev=9,kc.next=12,Gg({message:g,peerId:C,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:0,logger:this.logger,options:{enableHistoricalMessaging:_r,enableOfflineMessaging:B}});case 12:return kc.abrupt("return",kc.sent);case 15:if(kc.prev=15,kc.t0=kc.catch(9),!Sa(kc.t0)){kc.next=19;break}throw new db(Yd(this.name,"sendMessageToPeer",1e4),Zk);case 19:if(!sa(kc.t0)){kc.next=21;break}throw kc.t0;case 21:throw new da("Peer-to-peer message send failure",{code:cr,originalError:kc.t0});case 22:case"end":return kc.stop()}},f,this,[[9,15]])}));return function(f,g){return h.apply(this,arguments)}}()},{key:"createChannel",value:function(h){var f=this;if(!za(h))throw new I(["The %s in the arguments is invalid",Object.keys({channelId:h})[0]],Zz);return new pD(h,function(){return f.session},this,this.logger)}},{key:"createLocalInvitation",value:function(h){if(!za(h))throw new I(["The %s in the arguments is invalid",Object.keys({calleeId:h})[0]],xc);return this.invitationManager.genLocalInvitation(h)}},{key:"subscribePeersOnlineStatus",value:function(){var h=J(w.mark(function f(g){var C,P,x,B,Vt,_r,_e,_i,_a,kc,_d,_l,_h,rE=this;return w.wrap(function(aE){for(;;)switch(aE.prev=aE.next){case 0:if(this.connectionState===T.CONNECTED){aE.next=2;break}throw new K("The client is not logged in",bl);case 2:if(this.session!==void 0){aE.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(g)&&g.length!==0){aE.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:C=0;case 7:if(!(C<g.length)){aE.next=14;break}if(za(P=g[C])){aE.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",P],kg);case 11:C++,aE.next=7;break;case 14:if(!(512<(x=g&&g.length?vk(g):[]).length+Object.keys(this.subscribedPeerStatusCache).length)){aE.next=17;break}throw new ib("Subscribed peers overflows",gr);case 17:return aE.next=19,this.session.requestSubscribePeersOnlineStatus(x).toPromise();case 19:B=aE.sent,Vt=B.errors,_r=[],_e=[],_i=0;case 24:if(!(_i<Vt.length)){aE.next=32;break}if(_a=Vt[_i],kc=_a.code,typeof(_d=_a.account)=="string"){aE.next=28;break}throw new da("Returned account is invalid",fr);case 28:kc!==0&&_r.push(_d);case 29:_i++,aE.next=24;break;case 32:for(_l=0;_l<x.length;_l++)_h=x[_l],_r.includes(_h)||(_e.push(_h),this.subscribedPeerStatusCache[_h]=void 0);if(this.session.requestPeersOnlineStatus(_e).pipe(ba(function(yE){return uc(Jk(yE.userInfos,"account"),function(gE){return!!gE.ts})})).subscribe(function(yE){yE=uc(yE,function(gE,bE){return gE=gE?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,rE.subscribedPeerStatusCache[bE]=gE}),rE.emit("PeersOnlineStatusChanged",yE)}),_r.length===0){aE.next=36;break}throw new da("Subscription failed",fr);case 36:case"end":return aE.stop()}},f,this)}));return function(f){return h.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var h=J(w.mark(function f(g){var C,P,x,B,Vt;return w.wrap(function(_r){for(;;)switch(_r.prev=_r.next){case 0:if(this.connectionState===T.CONNECTED){_r.next=2;break}throw new K("The client is not logged in",bl);case 2:if(this.session!==void 0){_r.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(g)&&g.length!==0){_r.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:C=0;case 7:if(!(C<g.length)){_r.next=14;break}if(za(P=g[C])){_r.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",P],kg);case 11:C++,_r.next=7;break;case 14:if(!(512<g.length)){_r.next=16;break}throw new ib("Unsubscribed peers overflows",gr);case 16:for(x=g&&g.length?vk(g):[],this.session.requestUnsubscribePeersOnlineStatus(x),B=0;B<x.length;B++)Vt=x[B],delete this.subscribedPeerStatusCache[Vt];case 19:case"end":return _r.stop()}},f,this)}));return function(f){return h.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var h=J(w.mark(function f(g){return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(this.connectionState===T.CONNECTED){C.next=2;break}throw new K("The client is not logged in",bl);case 2:if(g!==S.PeerSubscriptionOption.ONLINE_STATUS){C.next=4;break}return C.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new I("Subscription option not supported",kg);case 5:case"end":return C.stop()}},f,this)}));return function(f){return h.apply(this,arguments)}}()},{key:"createMessage",value:function(h){return h.messageType==="IMAGE"?ua({width:0,height:0,fileName:"",description:"",thumbnail:new Blob,thumbnailWidth:0,thumbnailHeight:0,size:0},h):h.messageType==="FILE"?ua({fileName:"",description:"",thumbnail:new Blob,size:0},h):h}},{key:"downloadMedia",value:function(){var h=J(w.mark(function f(g){var C,P,x,B,Vt,_r,_e,_i,_a,kc,_d,_l,_h,rE,aE=this,yE=arguments;return w.wrap(function(gE){for(;;)switch(gE.prev=gE.next){case 0:if(C=1<yE.length&&yE[1]!==void 0?yE[1]:{},typeof g=="string"){gE.next=3;break}throw new I("invalid mediaId format",cl);case 3:if(gE.prev=3,P=g.split("z"),x=ra(P,3),B=x[0],Vt=x[1],_r=x[2],_e=B.slice(1,65),_i=bD(_e),_a=parseInt(B.slice(65),10),kc=parseInt(Vt,10),_d=parseInt(_r,10),!(Number.isNaN(_a)||Number.isNaN(kc)||Number.isNaN(_d))){gE.next=12;break}throw new I("Invalid mediaId content",cl);case 12:gE.next=19;break;case 14:if(gE.prev=14,gE.t0=gE.catch(3),!sa(gE.t0)){gE.next=18;break}throw gE.t0;case 18:throw new I("parse mediaId failure",{code:cl,originalError:gE.t0});case 19:if(this.connectionState===T.CONNECTED){gE.next=21;break}throw new K("The client is not logged in, cannot download",CA);case 21:if(this.session!==void 0){gE.next=23;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 23:return _l=this.mediaTaskManager.addDownloadTask({unit:kc,zone:_a,hashHexStr:_e,size:_d},function(){if(aE.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return aE.session.requestFileDownloadIndexGet({hash:_i,zone:_a,unit:kc,size:_d}).toPromise()},C),gE.next=26,this.mediaTaskManager.waitMediaTask(_l);case 26:return _h=gE.sent,rE=_h.payload,gE.abrupt("return",rE);case 29:case"end":return gE.stop()}},f,this,[[3,14]])}));return function(f){return h.apply(this,arguments)}}()},{key:"createMediaMessageByUploading",value:function(){var h=J(w.mark(function f(g){var C,P,x,B,Vt,_r,_e,_i,_a,kc,_d,_l,_h,rE,aE,yE,gE,bE,GE,Qm,tE,EE,pE,TE,_p=this,eE=arguments;return w.wrap(function(cE){for(;;)switch(cE.prev=cE.next){case 0:if(C=1<eE.length&&eE[1]!==void 0?eE[1]:{},P=2<eE.length&&eE[2]!==void 0?eE[2]:{},yd(C)){cE.next=4;break}throw new I("Invalid params",wf);case 4:if(x="thumbnailWidth"in C||"thumbnailHeight"in C||"width"in C||"height"in C,B=C.messageType,Vt=B===void 0?x?"IMAGE":"FILE":B,_r=C.description,_e=_r===void 0?"":_r,_i=C.fileName,_a=_i===void 0?"":_i,kc=C.thumbnail,typeof C.messageType=="string"&&typeof _e=="string"&&typeof _a=="string"&&(Pm(kc)||kc===void 0)&&Pm(g)){cE.next=8;break}throw new I("Invalid message params type",wf);case 8:if(!x||Vt!=="FILE"){cE.next=10;break}throw new I("Invalid message params, unexpected field in RtmFileMessage",wf);case 10:if(!(33554432<(_d=g.size))){cE.next=13;break}throw new ib("The payload size overflow 32 MB",wA);case 13:return cE.next=15,Ji(g);case 15:return _l=cE.sent,cE.next=18,aD(_l);case 18:if(_h=cE.sent,this.connectionState===T.CONNECTED){cE.next=21;break}throw new K("The client is not logged in",yA);case 21:if(Vt!=="IMAGE"){cE.next=29;break}return cE.next=24,Xt(C,_l);case 24:rE=cE.sent,aE=rE.height,yE=rE.width,gE=rE.thumbnailWidth,bE=rE.thumbnailHeight;case 29:return GE=this.mediaTaskManager.addUploadTask({file:new Uint8Array(_l),hash:_h},function(){if(_p.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return _p.session.fetchFileUploadIndexGet({hash:_h,size:_d})},function(SE,AE){if(_p.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return _p.session.requestFileUploadIndexSet({hash:_h,unit:SE,servers:AE}).toPromise()},P),cE.next=32,this.mediaTaskManager.waitMediaTask(GE);case 32:if(Qm=cE.sent,tE=Qm.zone,EE=Qm.retUnit,Vt!=="IMAGE"){cE.next=38;break}return pE={height:aE,width:yE,fileName:_a,size:_d,description:_e,thumbnail:kc,messageType:Vt,thumbnailWidth:gE,thumbnailHeight:bE,mediaId:"0".concat($r(_h)).concat(tE,"z").concat(EE,"z").concat(_d,"z").concat(aE,"z").concat(yE)},cE.abrupt("return",pE);case 38:return TE={fileName:_a,size:_d,description:_e,mediaId:"0".concat($r(_h)).concat(tE,"z").concat(EE,"z").concat(_d),thumbnail:kc,messageType:Vt},cE.abrupt("return",TE);case 40:case"end":return cE.stop()}},f,this)}));return function(f){return h.apply(this,arguments)}}()},{key:"loginImpl",value:function(){var h=J(w.mark(function f(g){var C,P,x,B,Vt=this;return w.wrap(function(_r){for(;;)switch(_r.prev=_r.next){case 0:if(C=g.uid,P=g.instanceId,!(this.lastLoginTime!==void 0&&500>Date.now()-this.lastLoginTime)){_r.next=4;break}throw new rC(["The frequency of login exceeded the limit of %d queries per second",2],mA);case 4:if(this.connectionState===T.DISCONNECTED){_r.next=6;break}throw new K("The SDK is either logging in or has logged in the Agora RTM system",kA);case 6:_r.prev=6,this.context.uid=C,_r.next=13;break;case 10:throw _r.prev=10,_r.t0=_r.catch(6),new I(["The %s in the arguments is invalid",Object.keys({uid:C})[0]],Jh);case 13:return this.onConnectionStateChanged(T.CONNECTING,Eb.LOGIN),this.session=x=new ls(this.context,new Yr(this.context,this.logger,!1),P,this.logger),B=function(){Vt.connectionState===T.CONNECTED&&(Vt.onConnectionStateChanged(T.RECONNECTING,Eb.INTERRUPTED),Vt.session)&&Vt.session.once("userJoined",function(){Vt.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS)})},x.on("connectionLost",B),x.on("tokenExpired",function(){Vt.emit("TokenExpired")}),x.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",function(_e){Vt.emit("MessageFromPeer",{text:_e.text,messageType:S.MessageType.TEXT},_e.peerId,_e.properties)}),this.session.on("peerMediaMessage",function(_e){var _i=_e.peerId,_a=_e.properties,kc=_e.messageType;_e=_e.details,kc==="FILE"?Vt.emit("MessageFromPeer",{messageType:S.MessageType.FILE,size:parseInt(pa(_e.media_size),10),description:pa(_e.media_description),fileName:pa(_e.media_filename),mediaId:pa(_e.media_id),thumbnail:new Blob([_e.media_thumbnail])},_i,_a):kc==="IMAGE"&&Vt.emit("MessageFromPeer",{messageType:S.MessageType.IMAGE,size:parseInt(pa(_e.media_size),10),description:pa(_e.media_description),fileName:pa(_e.media_filename),mediaId:pa(_e.media_id),thumbnail:new Blob([_e.media_thumbnail]),height:parseInt(pa(_e.media_height),10),width:parseInt(pa(_e.media_width),10),thumbnailHeight:parseInt(pa(_e.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(_e.media_thumbnailwidth),10)},_i,_a)}),this.session.on("peerRawMessage",function(_e){Vt.emit("MessageFromPeer",{rawMessage:_e.raw,description:_e.desc,messageType:S.MessageType.RAW},_e.peerId,_e.properties)}),x.on("instanceChanged",function(_e){return P=_e}),x.on("peerOnlineStatusChanged",function(_e){var _i=_e.instance.toString()+_e.state,_a=Vt.peerStatusSeqLru.get(_i);!_a||_e.seq.greaterThan(_a)?(Vt.peerStatusSeqLru.set(_i,_e.seq),_e.state!==Vt.subscribedPeerStatusCache[_e.peerId]&&Vt.emit("PeersOnlineStatusChanged",m({},_e.peerId,_e.state)),Vt.subscribedPeerStatusCache[_e.peerId]=_e.state,clearTimeout(Vt.peerUnreachableTimers[_i]),_e.state===S.PeerOnlineState.UNREACHABLE&&(Vt.peerUnreachableTimers[_i]=setTimeout(function(){Vt.subscribedPeerStatusCache[_e.peerId]===S.PeerOnlineState.UNREACHABLE&&(Vt.subscribedPeerStatusCache[_e.peerId]=S.PeerOnlineState.ONLINE,Vt.emit("PeersOnlineStatusChanged",m({},_e.peerId,S.PeerOnlineState.ONLINE)))},3e4))):Vt.log("peerOnlineStatusChanged dedup for %s, %d",_i,_e.seq.toNumber())}),x.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),x.on("channelAttributesUpdated",function(_e){var _i=_e.channelId;_e=_e.attributeMaps;for(var _a={},kc=0;kc<_e.length;kc++){var _d=_e[kc],_l=_d.key,_h=_d.ms,rE=_d.value;if(_d=_d.origin,typeof _l!="string"||!U.isLong(_h)||typeof rE!="string"||!za(_d))break;_a[_l]=new Blob([rE]).size}Vt.channelAttributesCacheLru.set(_i,_a)}),x.on("userJoined",function(_e){if(Object.keys(Vt.attributes).length!==0){if(Vt.session===void 0)return;Vt.session.requestSetLocalUserAttributes(Vt.attributes,_e).toPromise()}if(Vt.attributeDrafts.size!==0)for(var _i=function(_d,_l){var _h=(_d=_l[_d]).attribute;_d.promise.then(function(){Vt.session!==void 0&&Vt.session.requestSetLocalUserAttributes(_h,_e).toPromise()})},_a=0,kc=Array.from(Vt.attributeDrafts);_a<kc.length;_a++)_i(_a,kc);Object.keys(Vt.subscribedPeerStatusCache).length!==0&&x.requestSubscribePeersOnlineStatus(Object.keys(Vt.subscribedPeerStatusCache))}),this.lastLoginTime=Date.now(),_r.prev=29,_r.next=32,x.loginHandler().toPromise();case 32:this.mediaTaskManager.setAuthInfo({ticket:x.connection.curOpenSockets.filter(function(_e){return _e!==void 0})[0].ticket,instance:x.instanceId,useNewDomain:.5<=Math.random(),loginOpt:x.userJoinOptions.toLong()}),_r.next=44;break;case 35:if(_r.prev=35,_r.t1=_r.catch(29),!Sa(_r.t1)){_r.next=40;break}throw this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_TIMEOUT),new db(Yd(this.name,"login",2e4),lA);case 40:if(this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_FAILURE),!sa(_r.t1)){_r.next=43;break}throw _r.t1;case 43:throw new da("Login failure",{code:Zq,originalError:_r.t1});case 44:this.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS);case 45:case"end":return _r.stop()}},f,this,[[6,10],[29,35]])}));return function(f){return h.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(h,f){var g,C=this;h===T.RECONNECTING&&(this.reconnId+=1),eb("ConnectionStateChange",{elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),newState:os[h],oldState:os[this.connectionState],reason:qD[f],sid:Xa(this.session&&this.session.instanceId||U.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},(g=this.context.config.enableCloudProxy)!==null&&g!==void 0&&g),this.connectionState===T.RECONNECTING&&h===T.CONNECTED&&(Object.keys(this.subscribedPeerStatusCache).length!==0&&this.session!==void 0&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(ba(function(P){return uc(Jk(P.userInfos,"account"),function(x){return!!x.ts})})).subscribe(function(P){P=uc(P,function(x,B){return x=x?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,C.subscribedPeerStatusCache[B]=x}),C.emit("PeersOnlineStatusChanged",P)}),this.internalEmitter.emit("RECONNECTED")),this.connectionState=h,h!==T.ABORTED&&h!==T.DISCONNECTED||(this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.joinedChannels.clear(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.session=void 0,this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.mediaTaskManager.emit("connectionStateChanged",h),this.emit("ConnectionStateChanged",h,f)}}]),e}(tb()),fa(E.prototype,"renewToken",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"renewToken"),E.prototype),fa(E.prototype,"queryPeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersOnlineStatus"),E.prototype),fa(E.prototype,"getChannelMemberCount",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelMemberCount"),E.prototype),fa(E.prototype,"setLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setLocalUserAttributes"),E.prototype),fa(E.prototype,"setChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setChannelAttributes"),E.prototype),fa(E.prototype,"addOrUpdateLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateLocalUserAttributes"),E.prototype),fa(E.prototype,"addOrUpdateChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateChannelAttributes"),E.prototype),fa(E.prototype,"deleteLocalUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteLocalUserAttributesByKeys"),E.prototype),fa(E.prototype,"deleteChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteChannelAttributesByKeys"),E.prototype),fa(E.prototype,"clearLocalUserAttributes",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"clearLocalUserAttributes"),E.prototype),fa(E.prototype,"clearChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"clearChannelAttributes"),E.prototype),fa(E.prototype,"getUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributes"),E.prototype),fa(E.prototype,"getChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributes"),E.prototype),fa(E.prototype,"getChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributesByKeys"),E.prototype),fa(E.prototype,"getUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributesByKeys"),E.prototype),fa(E.prototype,"login",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"login"),E.prototype),fa(E.prototype,"logout",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logout"),E.prototype),fa(E.prototype,"logoutSync",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logoutSync"),E.prototype),fa(E.prototype,"sendMessageToPeer",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"sendMessageToPeer"),E.prototype),fa(E.prototype,"createChannel",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createChannel"),E.prototype),fa(E.prototype,"createLocalInvitation",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createLocalInvitation"),E.prototype),fa(E.prototype,"subscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"subscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"unsubscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"unsubscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"queryPeersBySubscriptionOption",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersBySubscriptionOption"),E.prototype),fa(E.prototype,"createMessage",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMessage"),E.prototype),fa(E.prototype,"downloadMedia",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"downloadMedia"),E.prototype),fa(E.prototype,"createMediaMessageByUploading",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMediaMessageByUploading"),E.prototype),E),ps={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},qs={enableLogUpload:!1,logFilter:ps.LOG_FILTER_INFO,enableCloudProxy:!1},Zd=ua(ua({createInstance:function(r){var e=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},d=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(r))throw new I(["The %s in the arguments is invalid",Object.keys({appId:r})[0]],Nq);var h=Object.keys(e).filter(function(Vt){return!(Vt in qs)});if(h.length!==0)throw new I("Invalid RTM config: ".concat(h.join(", ")),Nq);var f=ua(ua({},qs),e);if(d!==void 0&&(!Array.isArray(d)||d.length===0))throw new I("Invalid area config");if(d!=null){if(!d.every(function(Vt){return Vt in S.LegacyAreaCode}))throw new I("Invalid area codes: ".concat(d.filter(function(Vt){return!(Vt in S)}).join(", ")));M=xe(d.map(function(Vt){return zC[Vt]}))}d=jl=Ya.__global_unique_id__=(Ya.__global_unique_id__||0)+1;var g=DC(f);h=EC(f);var C=FC(f),P=GC(d,f),x=Tr(d,f),B=x("RTM:DEBUG","<Entry> ");return Mr.rtmConfig=f,g("The Agora RTM Web SDK version is %s","1.4.3-203"),e.enableCloudProxy&&g("RTM cloud proxy enabled"),e.enableLogUpload&&g("Log upload enabled"),M&&B("Area is set to %s",Array.from(M.CODES).map(function(Vt){return xf(F).find(function(_r){return F[_r]===Vt})}).join(", ")),B("Creating an RtmClient instance"),B('The Git commit ID is "'.concat("v1.4.3-17-g1e27aa38",'"')),B("The App ID is %s",Um(r,4,10,"*".repeat(6))),g("The process ID is %s",gg),B("The build is %s","v1.4.3-17-g1e27aa38"),B("NODE_ENV is %s","production"),new rD(r,{genLogger:x,genTracker:P,info:g,warn:h,logError:C,loggerId:d},f,function(Vt){for(var _r=0,_e=xf(Vt);_r<_e.length;_r++){var _i=_e[_r];try{var _a=Vt[_i];_a!=null&&(Vt.enableCloudProxy&&g("RTM cloud proxy enabled"),Vt.enableLogUpload&&g("Log upload enabled"),f[_i]=_a)}catch{throw new I(["The %s in the arguments is invalid",_i],void 0)}}})},BUILD:"v1.4.3-17-g1e27aa38",VERSION:"1.4.3-203",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:gg,ConnectionChangeReason:S.ConnectionChangeReason,ConnectionState:S.ConnectionState,LocalInvitationFailureReason:S.LocalInvitationFailureReason,LocalInvitationState:S.LocalInvitationState,RemoteInvitationFailureReason:S.RemoteInvitationFailureReason,RemoteInvitationState:S.RemoteInvitationState,MessageType:S.MessageType,PeerOnlineState:S.PeerOnlineState,PeerSubscriptionOption:S.PeerSubscriptionOption},ps),{},{setParameter:function(r,e){Object.keys(Nc).includes(r)&&(Nc[r]=e)},getParameter:function(r){return Nc[r]},setArea:function(r){var e=r.areaCodes;if(r=r.excludedArea,!Array.isArray(e)||e.length===0||!e.every(function(d){return d in S.AreaCode}))throw new I("Invalid area config");if(r!==void 0&&r===S.AreaCode.GLOBAL)throw new I("Excluded area cannot be global");if(r===void 0)M=xe(e.map(function(d){return F[d]}));else{if(e.includes(r))throw new I("Excluded area cannot be in areaCodes");if(!(r in F))throw new I("Invalid excludedArea:",r);M=bu({areas:e.map(function(d){return F[d]}),excludedArea:F[r]})}}});return Zd})})(agoraRtmSdk,agoraRtmSdk.exports);var agoraRtmSdkExports=agoraRtmSdk.exports;const AgoraRTM__default=getDefaultExportFromCjs(agoraRtmSdkExports);var createClient=function r(e,d,h){var f;function g(){return f||(f=AgoraRTM__default.createInstance(e,d,h)),f}return function(){return g()}},AreaCode;(function(r){r.GLOBAL="GLOBAL",r.INDIA="INDIA",r.JAPAN="JAPAN",r.ASIA="ASIA",r.EUROPE="EUROPE",r.CHINA="CHINA",r.NORTH_AMERICA="NORTH_AMERICA"})(AreaCode||(AreaCode={}));const APP_ID="83d163cf0e5c4e7a86b996057621147a",token=null,config={mode:"rtc",codec:"vp8",APP_ID,token},useRTCClient=createClient$1(config),useRTMClient=createClient(config.APP_ID),useMicrophoneAndCameraTracks=createMicrophoneAndCameraTracks(),PACKET_TYPES=Object.create(null);PACKET_TYPES.open="0";PACKET_TYPES.close="1";PACKET_TYPES.ping="2";PACKET_TYPES.pong="3";PACKET_TYPES.message="4";PACKET_TYPES.upgrade="5";PACKET_TYPES.noop="6";const PACKET_TYPES_REVERSE=Object.create(null);Object.keys(PACKET_TYPES).forEach(r=>{PACKET_TYPES_REVERSE[PACKET_TYPES[r]]=r});const ERROR_PACKET={type:"error",data:"parser error"},withNativeBlob$1=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",withNativeArrayBuffer$2=typeof ArrayBuffer=="function",isView$1=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,encodePacket=({type:r,data:e},d,h)=>withNativeBlob$1&&e instanceof Blob?d?h(e):encodeBlobAsBase64(e,h):withNativeArrayBuffer$2&&(e instanceof ArrayBuffer||isView$1(e))?d?h(e):encodeBlobAsBase64(new Blob([e]),h):h(PACKET_TYPES[r]+(e||"")),encodeBlobAsBase64=(r,e)=>{const d=new FileReader;return d.onload=function(){const h=d.result.split(",")[1];e("b"+(h||""))},d.readAsDataURL(r)};function toArray(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}let TEXT_ENCODER;function encodePacketToBinary(r,e){if(withNativeBlob$1&&r.data instanceof Blob)return r.data.arrayBuffer().then(toArray).then(e);if(withNativeArrayBuffer$2&&(r.data instanceof ArrayBuffer||isView$1(r.data)))return e(toArray(r.data));encodePacket(r,!1,d=>{TEXT_ENCODER||(TEXT_ENCODER=new TextEncoder),e(TEXT_ENCODER.encode(d))})}const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup$1=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<chars.length;r++)lookup$1[chars.charCodeAt(r)]=r;const decode$1=r=>{let e=r.length*.75,d=r.length,h,f=0,g,C,P,x;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);const B=new ArrayBuffer(e),Vt=new Uint8Array(B);for(h=0;h<d;h+=4)g=lookup$1[r.charCodeAt(h)],C=lookup$1[r.charCodeAt(h+1)],P=lookup$1[r.charCodeAt(h+2)],x=lookup$1[r.charCodeAt(h+3)],Vt[f++]=g<<2|C>>4,Vt[f++]=(C&15)<<4|P>>2,Vt[f++]=(P&3)<<6|x&63;return B},withNativeArrayBuffer$1=typeof ArrayBuffer=="function",decodePacket=(r,e)=>{if(typeof r!="string")return{type:"message",data:mapBinary(r,e)};const d=r.charAt(0);return d==="b"?{type:"message",data:decodeBase64Packet(r.substring(1),e)}:PACKET_TYPES_REVERSE[d]?r.length>1?{type:PACKET_TYPES_REVERSE[d],data:r.substring(1)}:{type:PACKET_TYPES_REVERSE[d]}:ERROR_PACKET},decodeBase64Packet=(r,e)=>{if(withNativeArrayBuffer$1){const d=decode$1(r);return mapBinary(d,e)}else return{base64:!0,data:r}},mapBinary=(r,e)=>{switch(e){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},SEPARATOR=String.fromCharCode(30),encodePayload=(r,e)=>{const d=r.length,h=new Array(d);let f=0;r.forEach((g,C)=>{encodePacket(g,!1,P=>{h[C]=P,++f===d&&e(h.join(SEPARATOR))})})},decodePayload=(r,e)=>{const d=r.split(SEPARATOR),h=[];for(let f=0;f<d.length;f++){const g=decodePacket(d[f],e);if(h.push(g),g.type==="error")break}return h};function createPacketEncoderStream(){return new TransformStream({transform(r,e){encodePacketToBinary(r,d=>{const h=d.length;let f;if(h<126)f=new Uint8Array(1),new DataView(f.buffer).setUint8(0,h);else if(h<65536){f=new Uint8Array(3);const g=new DataView(f.buffer);g.setUint8(0,126),g.setUint16(1,h)}else{f=new Uint8Array(9);const g=new DataView(f.buffer);g.setUint8(0,127),g.setBigUint64(1,BigInt(h))}r.data&&typeof r.data!="string"&&(f[0]|=128),e.enqueue(f),e.enqueue(d)})}})}let TEXT_DECODER;function totalLength(r){return r.reduce((e,d)=>e+d.length,0)}function concatChunks(r,e){if(r[0].length===e)return r.shift();const d=new Uint8Array(e);let h=0;for(let f=0;f<e;f++)d[f]=r[0][h++],h===r[0].length&&(r.shift(),h=0);return r.length&&h<r[0].length&&(r[0]=r[0].slice(h)),d}function createPacketDecoderStream(r,e){TEXT_DECODER||(TEXT_DECODER=new TextDecoder);const d=[];let h=0,f=-1,g=!1;return new TransformStream({transform(C,P){for(d.push(C);;){if(h===0){if(totalLength(d)<1)break;const x=concatChunks(d,1);g=(x[0]&128)===128,f=x[0]&127,f<126?h=3:f===126?h=1:h=2}else if(h===1){if(totalLength(d)<2)break;const x=concatChunks(d,2);f=new DataView(x.buffer,x.byteOffset,x.length).getUint16(0),h=3}else if(h===2){if(totalLength(d)<8)break;const x=concatChunks(d,8),B=new DataView(x.buffer,x.byteOffset,x.length),Vt=B.getUint32(0);if(Vt>Math.pow(2,53-32)-1){P.enqueue(ERROR_PACKET);break}f=Vt*Math.pow(2,32)+B.getUint32(4),h=3}else{if(totalLength(d)<f)break;const x=concatChunks(d,f);P.enqueue(decodePacket(g?x:TEXT_DECODER.decode(x),e)),h=0}if(f===0||f>r){P.enqueue(ERROR_PACKET);break}}}})}const protocol$1=4;function Emitter(r){if(r)return mixin(r)}function mixin(r){for(var e in Emitter.prototype)r[e]=Emitter.prototype[e];return r}Emitter.prototype.on=Emitter.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};Emitter.prototype.once=function(r,e){function d(){this.off(r,d),e.apply(this,arguments)}return d.fn=e,this.on(r,d),this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var d=this._callbacks["$"+r];if(!d)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var h,f=0;f<d.length;f++)if(h=d[f],h===e||h.fn===e){d.splice(f,1);break}return d.length===0&&delete this._callbacks["$"+r],this};Emitter.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),d=this._callbacks["$"+r],h=1;h<arguments.length;h++)e[h-1]=arguments[h];if(d){d=d.slice(0);for(var h=0,f=d.length;h<f;++h)d[h].apply(this,e)}return this};Emitter.prototype.emitReserved=Emitter.prototype.emit;Emitter.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};Emitter.prototype.hasListeners=function(r){return!!this.listeners(r).length};const globalThisShim=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function pick(r,...e){return e.reduce((d,h)=>(r.hasOwnProperty(h)&&(d[h]=r[h]),d),{})}const NATIVE_SET_TIMEOUT=globalThisShim.setTimeout,NATIVE_CLEAR_TIMEOUT=globalThisShim.clearTimeout;function installTimerFunctions(r,e){e.useNativeTimers?(r.setTimeoutFn=NATIVE_SET_TIMEOUT.bind(globalThisShim),r.clearTimeoutFn=NATIVE_CLEAR_TIMEOUT.bind(globalThisShim)):(r.setTimeoutFn=globalThisShim.setTimeout.bind(globalThisShim),r.clearTimeoutFn=globalThisShim.clearTimeout.bind(globalThisShim))}const BASE64_OVERHEAD=1.33;function byteLength(r){return typeof r=="string"?utf8Length(r):Math.ceil((r.byteLength||r.size)*BASE64_OVERHEAD)}function utf8Length(r){let e=0,d=0;for(let h=0,f=r.length;h<f;h++)e=r.charCodeAt(h),e<128?d+=1:e<2048?d+=2:e<55296||e>=57344?d+=3:(h++,d+=4);return d}function encode$1(r){let e="";for(let d in r)r.hasOwnProperty(d)&&(e.length&&(e+="&"),e+=encodeURIComponent(d)+"="+encodeURIComponent(r[d]));return e}function decode(r){let e={},d=r.split("&");for(let h=0,f=d.length;h<f;h++){let g=d[h].split("=");e[decodeURIComponent(g[0])]=decodeURIComponent(g[1])}return e}class TransportError extends Error{constructor(e,d,h){super(e),this.description=d,this.context=h,this.type="TransportError"}}class Transport extends Emitter{constructor(e){super(),this.writable=!1,installTimerFunctions(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,d,h){return super.emitReserved("error",new TransportError(e,d,h)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const d=decodePacket(e,this.socket.binaryType);this.onPacket(d)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,d={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(d)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const d=encode$1(e);return d.length?"?"+d:""}}const alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),length=64,map={};let seed=0,i=0,prev;function encode(r){let e="";do e=alphabet[r%length]+e,r=Math.floor(r/length);while(r>0);return e}function yeast(){const r=encode(+new Date);return r!==prev?(seed=0,prev=r):r+"."+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;let value=!1;try{value=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch(r){}const hasCORS=value;function XHR(r){const e=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||hasCORS))return new XMLHttpRequest}catch{}if(!e)try{return new globalThisShim[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function createCookieJar(){}function empty(){}const hasXHR2=function(){return new XHR({xdomain:!1}).responseType!=null}();class Polling extends Transport{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const h=location.protocol==="https:";let f=location.port;f||(f=h?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||f!==e.port}const d=e&&e.forceBase64;this.supportsBinary=hasXHR2&&!d,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const d=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let h=0;this.polling&&(h++,this.once("pollComplete",function(){--h||d()})),this.writable||(h++,this.once("drain",function(){--h||d()}))}else d()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const d=h=>{if(this.readyState==="opening"&&h.type==="open"&&this.onOpen(),h.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(h)};decodePayload(e,this.socket.binaryType).forEach(d),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,encodePayload(e,d=>{this.doWrite(d,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",d=this.query||{};return this.opts.timestampRequests!==!1&&(d[this.opts.timestampParam]=yeast()),!this.supportsBinary&&!d.sid&&(d.b64=1),this.createUri(e,d)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Request(this.uri(),e)}doWrite(e,d){const h=this.request({method:"POST",data:e});h.on("success",d),h.on("error",(f,g)=>{this.onError("xhr post error",f,g)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(d,h)=>{this.onError("xhr poll error",d,h)}),this.pollXhr=e}}class Request extends Emitter{constructor(e,d){super(),installTimerFunctions(this,d),this.opts=d,this.method=d.method||"GET",this.uri=e,this.data=d.data!==void 0?d.data:null,this.create()}create(){var e;const d=pick(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");d.xdomain=!!this.opts.xd;const h=this.xhr=new XHR(d);try{h.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){h.setDisableHeaderCheck&&h.setDisableHeaderCheck(!0);for(let f in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(f)&&h.setRequestHeader(f,this.opts.extraHeaders[f])}}catch{}if(this.method==="POST")try{h.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{h.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(h),"withCredentials"in h&&(h.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(h.timeout=this.opts.requestTimeout),h.onreadystatechange=()=>{var f;h.readyState===3&&((f=this.opts.cookieJar)===null||f===void 0||f.parseCookies(h)),h.readyState===4&&(h.status===200||h.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof h.status=="number"?h.status:0)},0))},h.send(this.data)}catch(f){this.setTimeoutFn(()=>{this.onError(f)},0);return}typeof document<"u"&&(this.index=Request.requestsCount++,Request.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=empty,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete Request.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}Request.requestsCount=0;Request.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",unloadHandler);else if(typeof addEventListener=="function"){const r="onpagehide"in globalThisShim?"pagehide":"unload";addEventListener(r,unloadHandler,!1)}}function unloadHandler(){for(let r in Request.requests)Request.requests.hasOwnProperty(r)&&Request.requests[r].abort()}const nextTick=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,d)=>d(e,0))(),WebSocket$1=globalThisShim.WebSocket||globalThisShim.MozWebSocket,usingBrowserWebSocket=!0,defaultBinaryType="arraybuffer",isReactNative=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class WS extends Transport{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),d=this.opts.protocols,h=isReactNative?{}:pick(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(h.headers=this.opts.extraHeaders);try{this.ws=usingBrowserWebSocket&&!isReactNative?d?new WebSocket$1(e,d):new WebSocket$1(e):new WebSocket$1(e,d,h)}catch(f){return this.emitReserved("error",f)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let d=0;d<e.length;d++){const h=e[d],f=d===e.length-1;encodePacket(h,this.supportsBinary,g=>{const C={};try{usingBrowserWebSocket&&this.ws.send(g)}catch{}f&&nextTick(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",d=this.query||{};return this.opts.timestampRequests&&(d[this.opts.timestampParam]=yeast()),this.supportsBinary||(d.b64=1),this.createUri(e,d)}check(){return!!WebSocket$1}}class WT extends Transport{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{const d=createPacketDecoderStream(Number.MAX_SAFE_INTEGER,this.socket.binaryType),h=e.readable.pipeThrough(d).getReader(),f=createPacketEncoderStream();f.readable.pipeTo(e.writable),this.writer=f.writable.getWriter();const g=()=>{h.read().then(({done:P,value:x})=>{P||(this.onPacket(x),g())}).catch(P=>{})};g();const C={type:"open"};this.query.sid&&(C.data=`{"sid":"${this.query.sid}"}`),this.writer.write(C).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let d=0;d<e.length;d++){const h=e[d],f=d===e.length-1;this.writer.write(h).then(()=>{f&&nextTick(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}}const transports={websocket:WS,webtransport:WT,polling:Polling},re=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function parse(r){const e=r,d=r.indexOf("["),h=r.indexOf("]");d!=-1&&h!=-1&&(r=r.substring(0,d)+r.substring(d,h).replace(/:/g,";")+r.substring(h,r.length));let f=re.exec(r||""),g={},C=14;for(;C--;)g[parts[C]]=f[C]||"";return d!=-1&&h!=-1&&(g.source=e,g.host=g.host.substring(1,g.host.length-1).replace(/;/g,":"),g.authority=g.authority.replace("[","").replace("]","").replace(/;/g,":"),g.ipv6uri=!0),g.pathNames=pathNames(g,g.path),g.queryKey=queryKey(g,g.query),g}function pathNames(r,e){const d=/\/{2,9}/g,h=e.replace(d,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&h.splice(0,1),e.slice(-1)=="/"&&h.splice(h.length-1,1),h}function queryKey(r,e){const d={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(h,f,g){f&&(d[f]=g)}),d}let Socket$1=class KI extends Emitter{constructor(e,d={}){super(),this.binaryType=defaultBinaryType,this.writeBuffer=[],e&&typeof e=="object"&&(d=e,e=null),e?(e=parse(e),d.hostname=e.host,d.secure=e.protocol==="https"||e.protocol==="wss",d.port=e.port,e.query&&(d.query=e.query)):d.host&&(d.hostname=parse(d.host).host),installTimerFunctions(this,d),this.secure=d.secure!=null?d.secure:typeof location<"u"&&location.protocol==="https:",d.hostname&&!d.port&&(d.port=this.secure?"443":"80"),this.hostname=d.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=d.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=d.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},d),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const d=Object.assign({},this.opts.query);d.EIO=protocol$1,d.transport=e,this.id&&(d.sid=this.id);const h=Object.assign({},this.opts,{query:d,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new transports[e](h)}open(){let e;if(this.opts.rememberUpgrade&&KI.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",d=>this.onClose("transport close",d))}probe(e){let d=this.createTransport(e),h=!1;KI.priorWebsocketSuccess=!1;const f=()=>{h||(d.send([{type:"ping",data:"probe"}]),d.once("packet",_r=>{if(!h)if(_r.type==="pong"&&_r.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",d),!d)return;KI.priorWebsocketSuccess=d.name==="websocket",this.transport.pause(()=>{h||this.readyState!=="closed"&&(Vt(),this.setTransport(d),d.send([{type:"upgrade"}]),this.emitReserved("upgrade",d),d=null,this.upgrading=!1,this.flush())})}else{const _e=new Error("probe error");_e.transport=d.name,this.emitReserved("upgradeError",_e)}}))};function g(){h||(h=!0,Vt(),d.close(),d=null)}const C=_r=>{const _e=new Error("probe error: "+_r);_e.transport=d.name,g(),this.emitReserved("upgradeError",_e)};function P(){C("transport closed")}function x(){C("socket closed")}function B(_r){d&&_r.name!==d.name&&g()}const Vt=()=>{d.removeListener("open",f),d.removeListener("error",C),d.removeListener("close",P),this.off("close",x),this.off("upgrading",B)};d.once("open",f),d.once("error",C),d.once("close",P),this.once("close",x),this.once("upgrading",B),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{h||d.open()},200):d.open()}onOpen(){if(this.readyState="open",KI.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const d=this.upgrades.length;for(;e<d;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const d=new Error("server error");d.code=e.data,this.onError(d);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let d=1;for(let h=0;h<this.writeBuffer.length;h++){const f=this.writeBuffer[h].data;if(f&&(d+=byteLength(f)),h>0&&d>this.maxPayload)return this.writeBuffer.slice(0,h);d+=2}return this.writeBuffer}write(e,d,h){return this.sendPacket("message",e,d,h),this}send(e,d,h){return this.sendPacket("message",e,d,h),this}sendPacket(e,d,h,f){if(typeof d=="function"&&(f=d,d=void 0),typeof h=="function"&&(f=h,h=null),this.readyState==="closing"||this.readyState==="closed")return;h=h||{},h.compress=h.compress!==!1;const g={type:e,data:d,options:h};this.emitReserved("packetCreate",g),this.writeBuffer.push(g),f&&this.once("flush",f),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},d=()=>{this.off("upgrade",d),this.off("upgradeError",d),e()},h=()=>{this.once("upgrade",d),this.once("upgradeError",d)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?h():e()}):this.upgrading?h():e()),this}onError(e){KI.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,d){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,d),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const d=[];let h=0;const f=e.length;for(;h<f;h++)~this.transports.indexOf(e[h])&&d.push(e[h]);return d}};Socket$1.protocol=protocol$1;function url(r,e="",d){let h=r;d=d||typeof location<"u"&&location,r==null&&(r=d.protocol+"//"+d.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=d.protocol+r:r=d.host+r),/^(https?|wss?):\/\//.test(r)||(typeof d<"u"?r=d.protocol+"//"+r:r="https://"+r),h=parse(r)),h.port||(/^(http|ws)$/.test(h.protocol)?h.port="80":/^(http|ws)s$/.test(h.protocol)&&(h.port="443")),h.path=h.path||"/";const g=h.host.indexOf(":")!==-1?"["+h.host+"]":h.host;return h.id=h.protocol+"://"+g+":"+h.port+e,h.href=h.protocol+"://"+g+(d&&d.port===h.port?"":":"+h.port),h}const withNativeArrayBuffer=typeof ArrayBuffer=="function",isView=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,toString=Object.prototype.toString,withNativeBlob=typeof Blob=="function"||typeof Blob<"u"&&toString.call(Blob)==="[object BlobConstructor]",withNativeFile=typeof File=="function"||typeof File<"u"&&toString.call(File)==="[object FileConstructor]";function isBinary(r){return withNativeArrayBuffer&&(r instanceof ArrayBuffer||isView(r))||withNativeBlob&&r instanceof Blob||withNativeFile&&r instanceof File}function hasBinary(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let d=0,h=r.length;d<h;d++)if(hasBinary(r[d]))return!0;return!1}if(isBinary(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return hasBinary(r.toJSON(),!0);for(const d in r)if(Object.prototype.hasOwnProperty.call(r,d)&&hasBinary(r[d]))return!0;return!1}function deconstructPacket(r){const e=[],d=r.data,h=r;return h.data=_deconstructPacket(d,e),h.attachments=e.length,{packet:h,buffers:e}}function _deconstructPacket(r,e){if(!r)return r;if(isBinary(r)){const d={_placeholder:!0,num:e.length};return e.push(r),d}else if(Array.isArray(r)){const d=new Array(r.length);for(let h=0;h<r.length;h++)d[h]=_deconstructPacket(r[h],e);return d}else if(typeof r=="object"&&!(r instanceof Date)){const d={};for(const h in r)Object.prototype.hasOwnProperty.call(r,h)&&(d[h]=_deconstructPacket(r[h],e));return d}return r}function reconstructPacket(r,e){return r.data=_reconstructPacket(r.data,e),delete r.attachments,r}function _reconstructPacket(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let d=0;d<r.length;d++)r[d]=_reconstructPacket(r[d],e);else if(typeof r=="object")for(const d in r)Object.prototype.hasOwnProperty.call(r,d)&&(r[d]=_reconstructPacket(r[d],e));return r}const RESERVED_EVENTS$1=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],protocol=5;var PacketType;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(PacketType||(PacketType={}));class Encoder{constructor(e){this.replacer=e}encode(e){return(e.type===PacketType.EVENT||e.type===PacketType.ACK)&&hasBinary(e)?this.encodeAsBinary({type:e.type===PacketType.EVENT?PacketType.BINARY_EVENT:PacketType.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let d=""+e.type;return(e.type===PacketType.BINARY_EVENT||e.type===PacketType.BINARY_ACK)&&(d+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(d+=e.nsp+","),e.id!=null&&(d+=e.id),e.data!=null&&(d+=JSON.stringify(e.data,this.replacer)),d}encodeAsBinary(e){const d=deconstructPacket(e),h=this.encodeAsString(d.packet),f=d.buffers;return f.unshift(h),f}}function isObject(r){return Object.prototype.toString.call(r)==="[object Object]"}class Decoder extends Emitter{constructor(e){super(),this.reviver=e}add(e){let d;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");d=this.decodeString(e);const h=d.type===PacketType.BINARY_EVENT;h||d.type===PacketType.BINARY_ACK?(d.type=h?PacketType.EVENT:PacketType.ACK,this.reconstructor=new BinaryReconstructor(d),d.attachments===0&&super.emitReserved("decoded",d)):super.emitReserved("decoded",d)}else if(isBinary(e)||e.base64)if(this.reconstructor)d=this.reconstructor.takeBinaryData(e),d&&(this.reconstructor=null,super.emitReserved("decoded",d));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let d=0;const h={type:Number(e.charAt(0))};if(PacketType[h.type]===void 0)throw new Error("unknown packet type "+h.type);if(h.type===PacketType.BINARY_EVENT||h.type===PacketType.BINARY_ACK){const g=d+1;for(;e.charAt(++d)!=="-"&&d!=e.length;);const C=e.substring(g,d);if(C!=Number(C)||e.charAt(d)!=="-")throw new Error("Illegal attachments");h.attachments=Number(C)}if(e.charAt(d+1)==="/"){const g=d+1;for(;++d&&!(e.charAt(d)===","||d===e.length););h.nsp=e.substring(g,d)}else h.nsp="/";const f=e.charAt(d+1);if(f!==""&&Number(f)==f){const g=d+1;for(;++d;){const C=e.charAt(d);if(C==null||Number(C)!=C){--d;break}if(d===e.length)break}h.id=Number(e.substring(g,d+1))}if(e.charAt(++d)){const g=this.tryParse(e.substr(d));if(Decoder.isPayloadValid(h.type,g))h.data=g;else throw new Error("invalid payload")}return h}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,d){switch(e){case PacketType.CONNECT:return isObject(d);case PacketType.DISCONNECT:return d===void 0;case PacketType.CONNECT_ERROR:return typeof d=="string"||isObject(d);case PacketType.EVENT:case PacketType.BINARY_EVENT:return Array.isArray(d)&&(typeof d[0]=="number"||typeof d[0]=="string"&&RESERVED_EVENTS$1.indexOf(d[0])===-1);case PacketType.ACK:case PacketType.BINARY_ACK:return Array.isArray(d)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class BinaryReconstructor{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const d=reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),d}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const parser=Object.freeze(Object.defineProperty({__proto__:null,Decoder,Encoder,get PacketType(){return PacketType},protocol},Symbol.toStringTag,{value:"Module"}));function on(r,e,d){return r.on(e,d),function(){r.off(e,d)}}const RESERVED_EVENTS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Socket extends Emitter{constructor(e,d,h){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=d,h&&h.auth&&(this.auth=h.auth),this._opts=Object.assign({},h),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[on(e,"open",this.onopen.bind(this)),on(e,"packet",this.onpacket.bind(this)),on(e,"error",this.onerror.bind(this)),on(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...d){if(RESERVED_EVENTS.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(d.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(d),this;const h={type:PacketType.EVENT,data:d};if(h.options={},h.options.compress=this.flags.compress!==!1,typeof d[d.length-1]=="function"){const C=this.ids++,P=d.pop();this._registerAckCallback(C,P),h.id=C}const f=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!f||!this.connected)||(this.connected?(this.notifyOutgoingListeners(h),this.packet(h)):this.sendBuffer.push(h)),this.flags={},this}_registerAckCallback(e,d){var h;const f=(h=this.flags.timeout)!==null&&h!==void 0?h:this._opts.ackTimeout;if(f===void 0){this.acks[e]=d;return}const g=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let C=0;C<this.sendBuffer.length;C++)this.sendBuffer[C].id===e&&this.sendBuffer.splice(C,1);d.call(this,new Error("operation has timed out"))},f);this.acks[e]=(...C)=>{this.io.clearTimeoutFn(g),d.apply(this,[null,...C])}}emitWithAck(e,...d){const h=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((f,g)=>{d.push((C,P)=>h?C?g(C):f(P):f(C)),this.emit(e,...d)})}_addToQueue(e){let d;typeof e[e.length-1]=="function"&&(d=e.pop());const h={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((f,...g)=>h!==this._queue[0]?void 0:(f!==null?h.tryCount>this._opts.retries&&(this._queue.shift(),d&&d(f)):(this._queue.shift(),d&&d(null,...g)),h.pending=!1,this._drainQueue())),this._queue.push(h),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const d=this._queue[0];d.pending&&!e||(d.pending=!0,d.tryCount++,this.flags=d.flags,this.emit.apply(this,d.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:PacketType.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,d){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,d)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case PacketType.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case PacketType.EVENT:case PacketType.BINARY_EVENT:this.onevent(e);break;case PacketType.ACK:case PacketType.BINARY_ACK:this.onack(e);break;case PacketType.DISCONNECT:this.ondisconnect();break;case PacketType.CONNECT_ERROR:this.destroy();const h=new Error(e.data.message);h.data=e.data.data,this.emitReserved("connect_error",h);break}}onevent(e){const d=e.data||[];e.id!=null&&d.push(this.ack(e.id)),this.connected?this.emitEvent(d):this.receiveBuffer.push(Object.freeze(d))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const d=this._anyListeners.slice();for(const h of d)h.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const d=this;let h=!1;return function(...f){h||(h=!0,d.packet({type:PacketType.ACK,id:e,data:f}))}}onack(e){const d=this.acks[e.id];typeof d=="function"&&(d.apply(this,e.data),delete this.acks[e.id])}onconnect(e,d){this.id=e,this.recovered=d&&this._pid===d,this._pid=d,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:PacketType.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const d=this._anyListeners;for(let h=0;h<d.length;h++)if(e===d[h])return d.splice(h,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const d=this._anyOutgoingListeners;for(let h=0;h<d.length;h++)if(e===d[h])return d.splice(h,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const d=this._anyOutgoingListeners.slice();for(const h of d)h.apply(this,e.data)}}}function Backoff(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),d=Math.floor(e*this.jitter*r);r=Math.floor(e*10)&1?r+d:r-d}return Math.min(r,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(r){this.ms=r};Backoff.prototype.setMax=function(r){this.max=r};Backoff.prototype.setJitter=function(r){this.jitter=r};class Manager extends Emitter{constructor(e,d){var h;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(d=e,e=void 0),d=d||{},d.path=d.path||"/socket.io",this.opts=d,installTimerFunctions(this,d),this.reconnection(d.reconnection!==!1),this.reconnectionAttempts(d.reconnectionAttempts||1/0),this.reconnectionDelay(d.reconnectionDelay||1e3),this.reconnectionDelayMax(d.reconnectionDelayMax||5e3),this.randomizationFactor((h=d.randomizationFactor)!==null&&h!==void 0?h:.5),this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(d.timeout==null?2e4:d.timeout),this._readyState="closed",this.uri=e;const f=d.parser||parser;this.encoder=new f.Encoder,this.decoder=new f.Decoder,this._autoConnect=d.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var d;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(d=this.backoff)===null||d===void 0||d.setMin(e),this)}randomizationFactor(e){var d;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(d=this.backoff)===null||d===void 0||d.setJitter(e),this)}reconnectionDelayMax(e){var d;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(d=this.backoff)===null||d===void 0||d.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Socket$1(this.uri,this.opts);const d=this.engine,h=this;this._readyState="opening",this.skipReconnect=!1;const f=on(d,"open",function(){h.onopen(),e&&e()}),g=P=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",P),e?e(P):this.maybeReconnectOnOpen()},C=on(d,"error",g);if(this._timeout!==!1){const P=this._timeout,x=this.setTimeoutFn(()=>{f(),g(new Error("timeout")),d.close()},P);this.opts.autoUnref&&x.unref(),this.subs.push(()=>{this.clearTimeoutFn(x)})}return this.subs.push(f),this.subs.push(C),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(on(e,"ping",this.onping.bind(this)),on(e,"data",this.ondata.bind(this)),on(e,"error",this.onerror.bind(this)),on(e,"close",this.onclose.bind(this)),on(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(d){this.onclose("parse error",d)}}ondecoded(e){nextTick(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,d){let h=this.nsps[e];return h?this._autoConnect&&!h.active&&h.connect():(h=new Socket(this,e,d),this.nsps[e]=h),h}_destroy(e){const d=Object.keys(this.nsps);for(const h of d)if(this.nsps[h].active)return;this._close()}_packet(e){const d=this.encoder.encode(e);for(let h=0;h<d.length;h++)this.engine.write(d[h],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,d){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,d),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const d=this.backoff.duration();this._reconnecting=!0;const h=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(f=>{f?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",f)):e.onreconnect()}))},d);this.opts.autoUnref&&h.unref(),this.subs.push(()=>{this.clearTimeoutFn(h)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const cache={};function lookup(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};const d=url(r,e.path||"/socket.io"),h=d.source,f=d.id,g=d.path,C=cache[f]&&g in cache[f].nsps,P=e.forceNew||e["force new connection"]||e.multiplex===!1||C;let x;return P?x=new Manager(h,e):(cache[f]||(cache[f]=new Manager(h,e)),x=cache[f]),d.query&&!e.query&&(e.query=d.queryKey),x.socket(d.path,e)}Object.assign(lookup,{Manager,Socket,io:lookup,connect:lookup});export{AgoraVideoPlayer as A,person1 as a,useRTMClient as b,useMicrophoneAndCameraTracks as c,config as d,lookup as l,person3 as p,useRTCClient as u};
